<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] The meaning of NewTokenLandingPage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=%5BOwasp-csrfguard%5D%20The%20meaning%20of%20NewTokenLandingPage&In-Reply-To=CAP7S1R9nU46xr-ubc3Bscp7gw20x-oLQ4P-%3D2YhEUsxK-wcreA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000065.html">
   <LINK REL="Next"  HREF="000066.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] The meaning of NewTokenLandingPage</H1>
    <B>Patrick Radtke</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=%5BOwasp-csrfguard%5D%20The%20meaning%20of%20NewTokenLandingPage&In-Reply-To=CAP7S1R9nU46xr-ubc3Bscp7gw20x-oLQ4P-%3D2YhEUsxK-wcreA%40mail.gmail.com"
       TITLE="[Owasp-csrfguard] The meaning of NewTokenLandingPage">pradtke at stanford.edu
       </A><BR>
    <I>Thu Jul 21 20:19:05 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000065.html">[Owasp-csrfguard] The meaning of NewTokenLandingPage
</A></li>
        <LI>Next message: <A HREF="000066.html">[Owasp-csrfguard] The meaning of NewTokenLandingPage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67">[ date ]</a>
              <a href="thread.html#67">[ thread ]</a>
              <a href="subject.html#67">[ subject ]</a>
              <a href="author.html#67">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 7/14/11 3:44 AM, Anders B&#229;tstrand wrote:
&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> I am trying to use CSRFGuard in an application, but I am having some 
</I>&gt;<i> troubles. First, let me start with a question about NewTokenLandingPage.
</I>&gt;<i>
</I>&gt;<i> If I read the source code correct, the NewTokenLandingPage is written 
</I>&gt;<i> to the response if session.isNew(), even if you visit an unprotected 
</I>&gt;<i> page.
</I>&gt;<i>
</I>&gt;<i> I do not see the purpose of this, as the page does not require a 
</I>&gt;<i> token. Is there someone that would like to elaborate on the meaning of 
</I>&gt;<i> the NewTokenLandingPage?
</I>&gt;<i>
</I>&gt;<i> The code I am talking about is in CsrfGuardFilter.java:
</I>&gt;<i>
</I>&gt;<i> if(session.isNew()) {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> csrfGuard.writeLandingPage(httpRequest, redirectResponse);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> } else if(csrfGuard.isValidRequest(httpRequest, redirectResponse)) {
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> filterChain.doFilter(httpRequest, redirectResponse);
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> } else {
</I>&gt;<i> /** invalid request - nothing to do - actions already executed **/
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> }
</I>We started moving our app to the white list approach as well.
We filter '/*' and then white list other things and have run into the 
same issue you describe.
For us the whole concept of NewTokenLandingPage is a non starter for us 
since we need to support
browsers with javascript disabled.

I removed the whole 'NewTokenLandingPage' landing page from the code 
CsrfGuardFilter
and now everything works. Non javascript users don't just get a blank page.
I think an option to disable NewTokenLandingPage may be the way to go.
I am also not sure the purpose of NewTokenLandingPage, since 
CsrfGuardListener
creates the token when the session is established. Maybe Eric Sheridan 
can weigh in.

Anyhow, the code changes we are deploying with are currently:

     if(csrfGuard.isValidRequest(httpRequest, redirectResponse)) {
                 filterChain.doFilter(httpRequest, redirectResponse);
             } else {
                 /** invalid request - nothing to do - actions already 
executed **/
             }

I'd be happy to set up a branch on github tomorrow for anyone that wants 
to pull this
change (and a redirect bug fix)

-Patrick
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000065.html">[Owasp-csrfguard] The meaning of NewTokenLandingPage
</A></li>
	<LI>Next message: <A HREF="000066.html">[Owasp-csrfguard] The meaning of NewTokenLandingPage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#67">[ date ]</a>
              <a href="thread.html#67">[ thread ]</a>
              <a href="subject.html#67">[ subject ]</a>
              <a href="author.html#67">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
