From parthasarathy.kesavaraj at gmail.com  Sun Mar  3 10:31:04 2013
From: parthasarathy.kesavaraj at gmail.com (Parthasarathy Kesavaraj)
Date: Sun, 3 Mar 2013 16:01:04 +0530
Subject: [Owasp-csrfguard] Nullpointer exception in weblogic
Message-ID: <CAOYXFibzN2FZVB+dKWhWh1VYvWxYgMr7BD=8ijNKY1B-C0ULSg@mail.gmail.com>

I tried to enable CSRFGuard filter in my project in welogic 10.3.6.

The version of OWASP CSRFGurard i have downloaded is OWASP CSRFGuard
3.0.0.503 (ALPHA)<https://github.com/downloads/esheri3/OWASP-CSRFGuard/Owasp-CsrfGuard-3.0.0.503.tar.gz>
 -

I am getting exception when i am logging to my application and i have given
below the exception log.

Please help.

TIA.

<User defined listener org.owasp.csrfguard.CsrfGuardListener failed:
java.lang.RuntimeException: java.lang.NullPointerException.
java.lang.RuntimeException: java.lang.NullPointerException
at
org.owasp.csrfguard.CsrfGuardListener.newInstance(CsrfGuardListener.java:49)
at
org.owasp.csrfguard.CsrfGuardListener.sessionCreated(CsrfGuardListener.java:24)
at
weblogic.servlet.internal.EventsManager.notifySessionLifetimeEvent(EventsManager.java:275)
at
weblogic.servlet.internal.session.MemorySessionData.<init>(MemorySessionData.java:10)
at
weblogic.servlet.internal.session.MemorySessionContext.getNewSession(MemorySessionContext.java:28)
at
weblogic.servlet.internal.ServletRequestImpl$SessionHelper.getNewSession(ServletRequestImpl.java:2929)
at
weblogic.servlet.internal.ServletRequestImpl$SessionHelper.updateSessionId(ServletRequestImpl.java:3004)
at
weblogic.servlet.security.internal.SecurityModule.generateNewSession(SecurityModule.java:319)
at
weblogic.servlet.security.internal.SecurityModule.login(SecurityModule.java:306)
at
weblogic.servlet.security.internal.FormSecurityModule.processJSecurityCheck(FormSecurityModule.java:302)
at
weblogic.servlet.security.internal.FormSecurityModule.checkUserPerm(FormSecurityModule.java:213)
at
weblogic.servlet.security.internal.FormSecurityModule.checkAccess(FormSecurityModule.java:96)
at
weblogic.servlet.security.internal.ServletSecurityManager.checkAccess(ServletSecurityManager.java:82)
at
weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:2209)
at
weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2179)
at
weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1490)
at weblogic.work.ExecuteThread.execute(ExecuteThread.java:256)
at weblogic.work.ExecuteThread.run(ExecuteThread.java:221)
Caused By: java.lang.NullPointerException
at java.io.File.<init>(File.java:222)
at
org.owasp.csrfguard.CsrfGuardListener.getResourceStream(CsrfGuardListener.java:72)
at
org.owasp.csrfguard.CsrfGuardListener.newInstance(CsrfGuardListener.java:46)
at
org.owasp.csrfguard.CsrfGuardListener.sessionCreated(CsrfGuardListener.java:24)
at
weblogic.servlet.internal.EventsManager.notifySessionLifetimeEvent(EventsManager.java:275)
at
weblogic.servlet.internal.session.MemorySessionData.<init>(MemorySessionData.java:10)
at
weblogic.servlet.internal.session.MemorySessionContext.getNewSession(MemorySessionContext.java:28)
at
weblogic.servlet.internal.ServletRequestImpl$SessionHelper.getNewSession(ServletRequestImpl.java:2929)
at
weblogic.servlet.internal.ServletRequestImpl$SessionHelper.updateSessionId(ServletRequestImpl.java:3004)
at
weblogic.servlet.security.internal.SecurityModule.generateNewSession(SecurityModule.java:319)
at
weblogic.servlet.security.internal.SecurityModule.login(SecurityModule.java:306)
at
weblogic.servlet.security.internal.FormSecurityModule.processJSecurityCheck(FormSecurityModule.java:302)
at
weblogic.servlet.security.internal.FormSecurityModule.checkUserPerm(FormSecurityModule.java:213)
at
weblogic.servlet.security.internal.FormSecurityModule.checkAccess(FormSecurityModule.java:96)
at
weblogic.servlet.security.internal.ServletSecurityManager.checkAccess(ServletSecurityManager.java:82)
at
weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:2209)
at
weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2179)
at
weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1490)
at weblogic.work.ExecuteThread.execute(ExecuteThread.java:256)
at weblogic.work.ExecuteThread.run(ExecuteThread.java:221)

-- 
Regards
Partha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130303/8e95a34a/attachment.html>

From MCheung at tmrs.com  Tue Mar  5 17:49:31 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Tue, 5 Mar 2013 17:49:31 +0000
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <512FD538.6070209@stanford.edu>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>

First of all, Thanks Patrick for providing the download link.

I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.

Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.


1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 

2. What is the difference?

3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?

4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?


Thanks,
Ming



-----Original Message-----
From: Patrick Radtke [mailto:pradtke at stanford.edu] 
Sent: Thursday, February 28, 2013 4:08 PM
To: Cheung, Ming
Cc: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

https://github.com/esheri3/OWASP-CSRFGuard


On 2/28/13 1:25 PM, Cheung, Ming wrote:
> RA layer request failed
>
> svn: Server sent unexpected return value (405 Method Not Allowed) in 
> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>
> Thanks,
>
> Ming
>
> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
> *Sent:* Thursday, February 28, 2013 3:08 PM
> *To:* owasp-csrfguard at lists.owasp.org
> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>
> Hi There,
>
> The CSRFGuard failed on certain pages of my application, Could someone 
> please point me to the SVN repository for downloading the java source?
>
> Thanks,
>
> Ming
>
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
> intended only for the use of the individual or entity to which it is 
> addressed and may contain information that is privileged, 
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any use, 
> dissemination, forwarding, distribution, or copying of the 
> communication is strictly prohibited. Please notify the sender 
> immediately by e-mail if you have received this communication by 
> mistake and delete all copies of the original message and attachments 
> from your system.
> ###################################################################
>
>
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 

From eric.sheridan at owasp.org  Tue Mar  5 18:17:15 2013
From: eric.sheridan at owasp.org (Eric Sheridan)
Date: Tue, 05 Mar 2013 13:17:15 -0500
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
Message-ID: <513636AB.60307@owasp.org>

This is a fairly common problem. Does anyone want to take a crack at
directly editing the Wiki article summarizing what they've done to get
up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

On 3/5/13 12:49 PM, Cheung, Ming wrote:
> First of all, Thanks Patrick for providing the download link.
> 
> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> 
> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.
> 
> 
> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
> 
> 2. What is the difference?
> 
> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
> 
> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> 
> 
> Thanks,
> Ming
> 
> 
> 
> -----Original Message-----
> From: Patrick Radtke [mailto:pradtke at stanford.edu] 
> Sent: Thursday, February 28, 2013 4:08 PM
> To: Cheung, Ming
> Cc: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> 
> https://github.com/esheri3/OWASP-CSRFGuard
> 
> 
> On 2/28/13 1:25 PM, Cheung, Ming wrote:
>> RA layer request failed
>>
>> svn: Server sent unexpected return value (405 Method Not Allowed) in 
>> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>>
>> Thanks,
>>
>> Ming
>>
>> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
>> *Sent:* Thursday, February 28, 2013 3:08 PM
>> *To:* owasp-csrfguard at lists.owasp.org
>> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
>> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>>
>> Hi There,
>>
>> The CSRFGuard failed on certain pages of my application, Could someone 
>> please point me to the SVN repository for downloading the java source?
>>
>> Thanks,
>>
>> Ming
>>
>> ###################################################################
>> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
>> intended only for the use of the individual or entity to which it is 
>> addressed and may contain information that is privileged, 
>> confidential, and exempt from disclosure under applicable law.
>> If you are not the intended recipient, you are notified that any use, 
>> dissemination, forwarding, distribution, or copying of the 
>> communication is strictly prohibited. Please notify the sender 
>> immediately by e-mail if you have received this communication by 
>> mistake and delete all copies of the original message and attachments 
>> from your system.
>> ###################################################################
>>
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
> 
> 
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments,
> is intended only for the use of the individual or entity to which
> it is addressed and may contain information that is privileged,
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any
> use, dissemination, forwarding, distribution, or copying of the
> communication is strictly prohibited. Please notify the sender
> immediately by e-mail if you have received this communication by
> mistake and delete all copies of the original message and
> attachments from your system.
> ################################################################### 
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> 

From MCheung at tmrs.com  Tue Mar  5 19:58:45 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Tue, 5 Mar 2013 19:58:45 +0000
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <513636AB.60307@owasp.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>

Regardless which listener I tried, I always got java.lang.NullPointerException with the following CsrfGuard code, Could someone please advice?


Here is the call stacks:

[3/5/13 13:53:56:747 CST] 00000015 servlet       E com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught exception created in one of the service methods of the servlet Logon in application CityPortal. Exception created : java.lang.NullPointerException
	at com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
	at com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
	at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
	at org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
	at com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
	at com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
	at com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
	at com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
	at com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
	at org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
	at org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
	at org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
	at org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
	at org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
	at org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
	at org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
	...


Thanks,
Ming


-----Original Message-----
From: Eric Sheridan [mailto:eric.sheridan at owasp.org] 
Sent: Tuesday, March 05, 2013 12:17 PM
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

This is a fairly common problem. Does anyone want to take a crack at directly editing the Wiki article summarizing what they've done to get up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

On 3/5/13 12:49 PM, Cheung, Ming wrote:
> First of all, Thanks Patrick for providing the download link.
> 
> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> 
> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.
> 
> 
> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
> 
> 2. What is the difference?
> 
> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
> 
> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> 
> 
> Thanks,
> Ming
> 
> 
> 
> -----Original Message-----
> From: Patrick Radtke [mailto:pradtke at stanford.edu]
> Sent: Thursday, February 28, 2013 4:08 PM
> To: Cheung, Ming
> Cc: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha 
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> 
> https://github.com/esheri3/OWASP-CSRFGuard
> 
> 
> On 2/28/13 1:25 PM, Cheung, Ming wrote:
>> RA layer request failed
>>
>> svn: Server sent unexpected return value (405 Method Not Allowed) in 
>> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>>
>> Thanks,
>>
>> Ming
>>
>> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
>> *Sent:* Thursday, February 28, 2013 3:08 PM
>> *To:* owasp-csrfguard at lists.owasp.org
>> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
>> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>>
>> Hi There,
>>
>> The CSRFGuard failed on certain pages of my application, Could 
>> someone please point me to the SVN repository for downloading the java source?
>>
>> Thanks,
>>
>> Ming
>>
>> ###################################################################
>> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
>> intended only for the use of the individual or entity to which it is 
>> addressed and may contain information that is privileged, 
>> confidential, and exempt from disclosure under applicable law.
>> If you are not the intended recipient, you are notified that any use, 
>> dissemination, forwarding, distribution, or copying of the 
>> communication is strictly prohibited. Please notify the sender 
>> immediately by e-mail if you have received this communication by 
>> mistake and delete all copies of the original message and attachments 
>> from your system.
>> ###################################################################
>>
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
> 
> 
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
> intended only for the use of the individual or entity to which it is 
> addressed and may contain information that is privileged, 
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any use, 
> dissemination, forwarding, distribution, or copying of the 
> communication is strictly prohibited. Please notify the sender 
> immediately by e-mail if you have received this communication by 
> mistake and delete all copies of the original message and attachments 
> from your system.
> ###################################################################
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> 
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 

From MCheung at tmrs.com  Wed Mar  6 20:58:09 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Wed, 6 Mar 2013 20:58:09 +0000
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8A86@Post.intra.tmrs.org>

When was Owasp Token was inserted into the http servlet request object as a parameter?

Within CsrfGuard.verifyPageToken(HttpServeltRequest) method, the following line returns null although I already defined the page within the tag <filter-name>CSRFGuard</filter-name> on web.xml. Could someone please tell me how to make sure the token is set on the request before hitting this line?

	String tokenFromRequest = request.getParameter(getTokenName());

Thanks,
Ming


-----Original Message-----
From: Cheung, Ming [mailto:MCheung at tmrs.com] 
Sent: Tuesday, March 05, 2013 1:59 PM
To: Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

Regardless which listener I tried, I always got java.lang.NullPointerException with the following CsrfGuard code, Could someone please advice?


Here is the call stacks:

[3/5/13 13:53:56:747 CST] 00000015 servlet       E com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught exception created in one of the service methods of the servlet Logon in application CityPortal. Exception created : java.lang.NullPointerException
	at com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
	at com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
	at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
	at org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
	at com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
	at com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
	at com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
	at com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
	at com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
	at org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
	at org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
	at org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
	at org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
	at org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
	at org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
	at org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
	...


Thanks,
Ming


-----Original Message-----
From: Eric Sheridan [mailto:eric.sheridan at owasp.org]
Sent: Tuesday, March 05, 2013 12:17 PM
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

This is a fairly common problem. Does anyone want to take a crack at directly editing the Wiki article summarizing what they've done to get up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

On 3/5/13 12:49 PM, Cheung, Ming wrote:
> First of all, Thanks Patrick for providing the download link.
> 
> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> 
> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.
> 
> 
> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
> 
> 2. What is the difference?
> 
> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
> 
> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> 
> 
> Thanks,
> Ming
> 
> 
> 
> -----Original Message-----
> From: Patrick Radtke [mailto:pradtke at stanford.edu]
> Sent: Thursday, February 28, 2013 4:08 PM
> To: Cheung, Ming
> Cc: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha 
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> 
> https://github.com/esheri3/OWASP-CSRFGuard
> 
> 
> On 2/28/13 1:25 PM, Cheung, Ming wrote:
>> RA layer request failed
>>
>> svn: Server sent unexpected return value (405 Method Not Allowed) in 
>> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>>
>> Thanks,
>>
>> Ming
>>
>> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
>> *Sent:* Thursday, February 28, 2013 3:08 PM
>> *To:* owasp-csrfguard at lists.owasp.org
>> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
>> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>>
>> Hi There,
>>
>> The CSRFGuard failed on certain pages of my application, Could 
>> someone please point me to the SVN repository for downloading the java source?
>>
>> Thanks,
>>
>> Ming
>>
>> ###################################################################
>> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
>> intended only for the use of the individual or entity to which it is 
>> addressed and may contain information that is privileged, 
>> confidential, and exempt from disclosure under applicable law.
>> If you are not the intended recipient, you are notified that any use, 
>> dissemination, forwarding, distribution, or copying of the 
>> communication is strictly prohibited. Please notify the sender 
>> immediately by e-mail if you have received this communication by 
>> mistake and delete all copies of the original message and attachments 
>> from your system.
>> ###################################################################
>>
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
> 
> 
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
> intended only for the use of the individual or entity to which it is 
> addressed and may contain information that is privileged, 
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any use, 
> dissemination, forwarding, distribution, or copying of the 
> communication is strictly prohibited. Please notify the sender 
> immediately by e-mail if you have received this communication by 
> mistake and delete all copies of the original message and attachments 
> from your system.
> ###################################################################
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> 
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 

From parthasarathy.kesavaraj at gmail.com  Thu Mar  7 09:08:24 2013
From: parthasarathy.kesavaraj at gmail.com (Parthasarathy Kesavaraj)
Date: Thu, 7 Mar 2013 14:38:24 +0530
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
Message-ID: <CAOYXFibkab-Pch85wvsGXmY6EpQpfAMpNacXAVJo3mUpso7Vmg@mail.gmail.com>

I have done a build from GITHub and done the necessary steps. But
session.isNew() is always becoming true while loading my login page and so,
the request is going in a loop. Got stuck on this one full day. if i change
the logic of token creation , then the request and session tokens are not
matching.

On Wed, Mar 6, 2013 at 1:28 AM, Cheung, Ming <MCheung at tmrs.com> wrote:

> Regardless which listener I tried, I always got
> java.lang.NullPointerException with the following CsrfGuard code, Could
> someone please advice?
>
>
> Here is the call stacks:
>
> [3/5/13 13:53:56:747 CST] 00000015 servlet       E
> com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught
> exception created in one of the service methods of the servlet Logon in
> application CityPortal. Exception created : java.lang.NullPointerException
>         at
> com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
>         at
> com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
>         at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
>         at
> org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
>         at
> com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
>         at
> com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
>         at
> com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
>         at
> com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
>         at
> com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
>         at
> com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
>         at
> com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
>         at
> com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
>         at
> com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
>         at
> org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
>         at
> org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
>         at
> org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
>         at
> org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
>         at
> org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
>         at
> org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
>         at
> org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
>         at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
>         at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
>         ...
>
>
> Thanks,
> Ming
>
>
> -----Original Message-----
> From: Eric Sheridan [mailto:eric.sheridan at owasp.org]
> Sent: Tuesday, March 05, 2013 12:17 PM
> To: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>
> This is a fairly common problem. Does anyone want to take a crack at
> directly editing the Wiki article summarizing what they've done to get up
> and running?
>
> Sincerely,
> Eric Sheridan
> (twitter) @eric_sheridan
> (blog) http://ericsheridan.blogspot.com
>
> On 3/5/13 12:49 PM, Cheung, Ming wrote:
> > First of all, Thanks Patrick for providing the download link.
> >
> > I just learned the download link is NOT for the Alpha version OWASP
> CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> >
> > Does anyone have the instructions on how to use the latest CSRFguard
> from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions,
> https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out
> of date.
> >
> >
> > 1. Which Listener should be use? CsrfGuardHttpSessionListener or
> CsrfGuardServletContextListener?
> >
> > 2. What is the difference?
> >
> > 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or
> CsrfGuard?
> >
> > 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA)
> works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page
> with "Required token is missing from the request", therefore, does anyone
> has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> >
> >
> > Thanks,
> > Ming
> >
> >
> >
> > -----Original Message-----
> > From: Patrick Radtke [mailto:pradtke at stanford.edu]
> > Sent: Thursday, February 28, 2013 4:08 PM
> > To: Cheung, Ming
> > Cc: owasp-csrfguard at lists.owasp.org
> > Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha
> > version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> >
> > https://github.com/esheri3/OWASP-CSRFGuard
> >
> >
> > On 2/28/13 1:25 PM, Cheung, Ming wrote:
> >> RA layer request failed
> >>
> >> svn: Server sent unexpected return value (405 Method Not Allowed) in
> >> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
> >>
> >> Thanks,
> >>
> >> Ming
> >>
> >> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
> >> *Sent:* Thursday, February 28, 2013 3:08 PM
> >> *To:* owasp-csrfguard at lists.owasp.org
> >> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha
> >> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> >>
> >> Hi There,
> >>
> >> The CSRFGuard failed on certain pages of my application, Could
> >> someone please point me to the SVN repository for downloading the java
> source?
> >>
> >> Thanks,
> >>
> >> Ming
> >>
> >> ###################################################################
> >> CONFIDENTIALITY NOTICE: This communication, including attachments, is
> >> intended only for the use of the individual or entity to which it is
> >> addressed and may contain information that is privileged,
> >> confidential, and exempt from disclosure under applicable law.
> >> If you are not the intended recipient, you are notified that any use,
> >> dissemination, forwarding, distribution, or copying of the
> >> communication is strictly prohibited. Please notify the sender
> >> immediately by e-mail if you have received this communication by
> >> mistake and delete all copies of the original message and attachments
> >> from your system.
> >> ###################################################################
> >>
> >>
> >>
> >> _______________________________________________
> >> Owasp-csrfguard mailing list
> >> Owasp-csrfguard at lists.owasp.org
> >> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> >>
> >
> >
> > ###################################################################
> > CONFIDENTIALITY NOTICE: This communication, including attachments, is
> > intended only for the use of the individual or entity to which it is
> > addressed and may contain information that is privileged,
> > confidential, and exempt from disclosure under applicable law.
> > If you are not the intended recipient, you are notified that any use,
> > dissemination, forwarding, distribution, or copying of the
> > communication is strictly prohibited. Please notify the sender
> > immediately by e-mail if you have received this communication by
> > mistake and delete all copies of the original message and attachments
> > from your system.
> > ###################################################################
> > _______________________________________________
> > Owasp-csrfguard mailing list
> > Owasp-csrfguard at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> >
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments,
> is intended only for the use of the individual or entity to which
> it is addressed and may contain information that is privileged,
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any
> use, dissemination, forwarding, distribution, or copying of the
> communication is strictly prohibited. Please notify the sender
> immediately by e-mail if you have received this communication by
> mistake and delete all copies of the original message and
> attachments from your system.
> ###################################################################
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>



-- 
Regards
Partha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130307/86a7208c/attachment-0001.html>

From pradtke at stanford.edu  Thu Mar  7 17:59:39 2013
From: pradtke at stanford.edu (Patrick Radtke)
Date: Thu, 07 Mar 2013 09:59:39 -0800
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <CAOYXFibkab-Pch85wvsGXmY6EpQpfAMpNacXAVJo3mUpso7Vmg@mail.gmail.com>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
	<CAOYXFibkab-Pch85wvsGXmY6EpQpfAMpNacXAVJo3mUpso7Vmg@mail.gmail.com>
Message-ID: <5138D58B.6080102@stanford.edu>

Try excluding your login page from CSRF protection.
See
https://www.owasp.org/index.php/CSRFGuard_3_Configuration#Unprotected_Pages


On 3/7/13 1:08 AM, Parthasarathy Kesavaraj wrote:
> I have done a build from GITHub and done the necessary steps. But
> session.isNew() is always becoming true while loading my login page and
> so, the request is going in a loop. Got stuck on this one full day. if i
> change the logic of token creation , then the request and session tokens
> are not matching.
>
> On Wed, Mar 6, 2013 at 1:28 AM, Cheung, Ming <MCheung at tmrs.com
> <mailto:MCheung at tmrs.com>> wrote:
>
>     Regardless which listener I tried, I always got
>     java.lang.NullPointerException with the following CsrfGuard code,
>     Could someone please advice?
>
>
>     Here is the call stacks:
>
>     [3/5/13 13:53:56:747 CST] 00000015 servlet       E
>     com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E:
>     Uncaught exception created in one of the service methods of the
>     servlet Logon in application CityPortal. Exception created :
>     java.lang.NullPointerException
>              at
>     com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
>              at
>     com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
>              at
>     org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
>              at
>     org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
>              at
>     com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
>              at
>     com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
>              at
>     com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
>              at
>     com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
>              at
>     com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
>              at
>     com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
>              at
>     com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
>              at
>     com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
>              at
>     com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
>              at
>     org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
>              at
>     org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
>              at
>     org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
>              at
>     org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
>              at
>     org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
>              at
>     org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
>              at
>     org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
>              at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
>              at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
>              ...
>
>
>     Thanks,
>     Ming
>
>
>     -----Original Message-----
>     From: Eric Sheridan [mailto:eric.sheridan at owasp.org
>     <mailto:eric.sheridan at owasp.org>]
>     Sent: Tuesday, March 05, 2013 12:17 PM
>     To: owasp-csrfguard at lists.owasp.org
>     <mailto:owasp-csrfguard at lists.owasp.org>
>     Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha
>     version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>
>     This is a fairly common problem. Does anyone want to take a crack at
>     directly editing the Wiki article summarizing what they've done to
>     get up and running?
>
>     Sincerely,
>     Eric Sheridan
>     (twitter) @eric_sheridan
>     (blog) http://ericsheridan.blogspot.com
>
>     On 3/5/13 12:49 PM, Cheung, Ming wrote:
>      > First of all, Thanks Patrick for providing the download link.
>      >
>      > I just learned the download link is NOT for the Alpha version
>     OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
>      >
>      > Does anyone have the instructions on how to use the latest
>     CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA)
>     instructions,
>     https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already
>     out of date.
>      >
>      >
>      > 1. Which Listener should be use? CsrfGuardHttpSessionListener or
>     CsrfGuardServletContextListener?
>      >
>      > 2. What is the difference?
>      >
>      > 3. Which Guard class should be added to the Web.xml?
>     CsrfGuardFilter? Or CsrfGuard?
>      >
>      > 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503
>     (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one
>     single page with "Required token is missing from the request",
>     therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
>      >
>      >
>      > Thanks,
>      > Ming
>      >
>      >
>      >
>      > -----Original Message-----
>      > From: Patrick Radtke [mailto:pradtke at stanford.edu
>     <mailto:pradtke at stanford.edu>]
>      > Sent: Thursday, February 28, 2013 4:08 PM
>      > To: Cheung, Ming
>      > Cc: owasp-csrfguard at lists.owasp.org
>     <mailto:owasp-csrfguard at lists.owasp.org>
>      > Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha
>      > version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>      >
>      > https://github.com/esheri3/OWASP-CSRFGuard
>      >
>      >
>      > On 2/28/13 1:25 PM, Cheung, Ming wrote:
>      >> RA layer request failed
>      >>
>      >> svn: Server sent unexpected return value (405 Method Not Allowed) in
>      >> response to OPTIONS request for
>     'http://owaspcsrfguard.googlecode.com'
>      >>
>      >> Thanks,
>      >>
>      >> Ming
>      >>
>      >> *From:*Cheung, Ming [mailto:MCheung at tmrs.com
>     <mailto:MCheung at tmrs.com>]
>      >> *Sent:* Thursday, February 28, 2013 3:08 PM
>      >> *To:* owasp-csrfguard at lists.owasp.org
>     <mailto:owasp-csrfguard at lists.owasp.org>
>      >> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha
>      >> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>      >>
>      >> Hi There,
>      >>
>      >> The CSRFGuard failed on certain pages of my application, Could
>      >> someone please point me to the SVN repository for downloading
>     the java source?
>      >>
>      >> Thanks,
>      >>
>      >> Ming
>      >>
>      >> ###################################################################
>      >> CONFIDENTIALITY NOTICE: This communication, including
>     attachments, is
>      >> intended only for the use of the individual or entity to which it is
>      >> addressed and may contain information that is privileged,
>      >> confidential, and exempt from disclosure under applicable law.
>      >> If you are not the intended recipient, you are notified that any
>     use,
>      >> dissemination, forwarding, distribution, or copying of the
>      >> communication is strictly prohibited. Please notify the sender
>      >> immediately by e-mail if you have received this communication by
>      >> mistake and delete all copies of the original message and
>     attachments
>      >> from your system.
>      >> ###################################################################
>      >>
>      >>
>      >>
>      >> _______________________________________________
>      >> Owasp-csrfguard mailing list
>      >> Owasp-csrfguard at lists.owasp.org
>     <mailto:Owasp-csrfguard at lists.owasp.org>
>      >> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>      >>
>      >
>      >
>      > ###################################################################
>      > CONFIDENTIALITY NOTICE: This communication, including attachments, is
>      > intended only for the use of the individual or entity to which it is
>      > addressed and may contain information that is privileged,
>      > confidential, and exempt from disclosure under applicable law.
>      > If you are not the intended recipient, you are notified that any use,
>      > dissemination, forwarding, distribution, or copying of the
>      > communication is strictly prohibited. Please notify the sender
>      > immediately by e-mail if you have received this communication by
>      > mistake and delete all copies of the original message and attachments
>      > from your system.
>      > ###################################################################
>      > _______________________________________________
>      > Owasp-csrfguard mailing list
>      > Owasp-csrfguard at lists.owasp.org
>     <mailto:Owasp-csrfguard at lists.owasp.org>
>      > https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>      >
>     _______________________________________________
>     Owasp-csrfguard mailing list
>     Owasp-csrfguard at lists.owasp.org <mailto:Owasp-csrfguard at lists.owasp.org>
>     https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>     ###################################################################
>     CONFIDENTIALITY NOTICE: This communication, including attachments,
>     is intended only for the use of the individual or entity to which
>     it is addressed and may contain information that is privileged,
>     confidential, and exempt from disclosure under applicable law.
>     If you are not the intended recipient, you are notified that any
>     use, dissemination, forwarding, distribution, or copying of the
>     communication is strictly prohibited. Please notify the sender
>     immediately by e-mail if you have received this communication by
>     mistake and delete all copies of the original message and
>     attachments from your system.
>     ###################################################################
>     _______________________________________________
>     Owasp-csrfguard mailing list
>     Owasp-csrfguard at lists.owasp.org <mailto:Owasp-csrfguard at lists.owasp.org>
>     https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>
>
>
> --
> Regards
> Partha
>
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>


From rajesh_punjabi at hotmail.com  Mon Mar 18 05:01:01 2013
From: rajesh_punjabi at hotmail.com (Rajesh Punjabi)
Date: Sun, 17 Mar 2013 22:01:01 -0700
Subject: [Owasp-csrfguard] How do I redirect for Invalid token for an
 AJAX
Message-ID: <BAY170-W579BE076748DCB25393E6BFCE80@phx.gbl>

Would appreciate if someone could share your experiences with this problem.  Essentially for AJAX requests when the token is amiss, how do we take care of the error handling.  Ideally, want to take the user to a error page and invalidate the session.
Appreciate your help. 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130317/249877fd/attachment.html>

From MCheung at tmrs.com  Mon Mar 18 14:59:18 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Mon, 18 Mar 2013 14:59:18 +0000
Subject: [Owasp-csrfguard] How do I redirect for Invalid token for an
 AJAX
In-Reply-To: <BAY170-W579BE076748DCB25393E6BFCE80@phx.gbl>
References: <BAY170-W579BE076748DCB25393E6BFCE80@phx.gbl>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F15BD@Post.intra.tmrs.org>

Here is the way I did that,


1)      In the Owasp.CsrfGuard.prop file,  Set the following property to a jsp page,

a.       org.owasp.csrfguard.action.Redirect.Page=/<MyAppliactionName>/error/CsrfAttackRedirect.jsp   /// where </MyApplicationName> is same as your URL https://myCompany.com/<MyApplicationName>/Login<https://myCompany.com/%3cMyApplicationName%3e/Login>.

2)      In the CsrfAttackRedirect.jsp, add a line to forward to your Logout servlet

a.
        <body>

        <% if (request.getParameter("user")==null){ %>

        <jsp:forward page="/Logoff" >
            <jsp:param name="CsrfAttack" value="CsrfAttactkDetected" />
             <jps:param name="AnyKeyName" value="AnyValue" />
        </jsp:forward>

        <%}%>
        </body>


3)  Since you are already in logoff servlet, you can do invalidation and any other things as you want before forward back to a display JSP.


Thanks,
Ming

From: Rajesh Punjabi [mailto:rajesh_punjabi at hotmail.com]
Sent: Monday, March 18, 2013 12:01 AM
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] How do I redirect for Invalid token for an AJAX

Would appreciate if someone could share your experiences with this problem.  Essentially for AJAX requests when the token is amiss, how do we take care of the error handling.  Ideally, want to take the user to a error page and invalidate the session.

Appreciate your help.

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130318/fca22114/attachment.html>

From rajesh_punjabi at hotmail.com  Mon Mar 18 17:14:58 2013
From: rajesh_punjabi at hotmail.com (Rajesh Punjabi)
Date: Mon, 18 Mar 2013 10:14:58 -0700
Subject: [Owasp-csrfguard] How do I redirect for Invalid token for an
 AJAX
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F15BD@Post.intra.tmrs.org>
References: <BAY170-W579BE076748DCB25393E6BFCE80@phx.gbl>,
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F15BD@Post.intra.tmrs.org>
Message-ID: <BAY170-W13761DE985D470929403299FCE80@phx.gbl>

Thanks Ming for the response.   I do have a similar setup as you mentioned but it works for page request only.  It doesnt seem to work for AJAX requests.   Does it work for you for AJAX requests too when lets say a REST call is the protected URL?
Thanks,Rajesh

From: MCheung at tmrs.com
To: rajesh_punjabi at hotmail.com; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] How do I redirect for Invalid token for an AJAX
Date: Mon, 18 Mar 2013 14:59:18 +0000









Here is the way I did that,
 
1)     
In the Owasp.CsrfGuard.prop file,  Set the following property to a jsp page,

a.      
org.owasp.csrfguard.action.Redirect.Page=/<MyAppliactionName>/error/CsrfAttackRedirect.jsp   /// where </MyApplicationName> is same as your URL
https://myCompany.com/<MyApplicationName>/Login.
2)     
In the CsrfAttackRedirect.jsp, add a line to forward to your Logout servlet

a.      
 
        <body> 

          
        <%
if (request.getParameter("user")==null){
%>

        
        <jsp:forward
page="/Logoff"
> 
           
<jsp:param
name="CsrfAttack"
value="CsrfAttactkDetected"
/>
             <jps:param name=?AnyKeyName? value=?AnyValue? />
       
</jsp:forward>

        
        <%}%> 

        </body>
 

3) 
Since you are already in logoff servlet, you can do invalidation and any other things as you want before forward back to a display JSP.
 
 


Thanks,
Ming

 


From: Rajesh Punjabi [mailto:rajesh_punjabi at hotmail.com]


Sent: Monday, March 18, 2013 12:01 AM

To: owasp-csrfguard at lists.owasp.org

Subject: Re: [Owasp-csrfguard] How do I redirect for Invalid token for an AJAX


 

Would appreciate if someone could share your experiences with this problem.  Essentially for AJAX requests when the token is amiss, how do we take care of the error handling.  Ideally, want
 to take the user to a error page and invalidate the session.

 


Appreciate your help.



###################################################################

CONFIDENTIALITY NOTICE: This communication, including attachments,

is intended only for the use of the individual or entity to which

it is addressed and may contain information that is privileged,

confidential, and exempt from disclosure under applicable law.

If you are not the intended recipient, you are notified that any

use, dissemination, forwarding, distribution, or copying of the

communication is strictly prohibited. Please notify the sender

immediately by e-mail if you have received this communication by

mistake and delete all copies of the original message and

attachments from your system.

###################################################################
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130318/b416fedd/attachment-0001.html>

From MCheung at tmrs.com  Mon Mar 18 17:18:29 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Mon, 18 Mar 2013 17:18:29 +0000
Subject: [Owasp-csrfguard] How do I redirect for Invalid token for an
 AJAX
In-Reply-To: <BAY170-W13761DE985D470929403299FCE80@phx.gbl>
References: <BAY170-W579BE076748DCB25393E6BFCE80@phx.gbl>,
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F15BD@Post.intra.tmrs.org>
	<BAY170-W13761DE985D470929403299FCE80@phx.gbl>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F25E4@Post.intra.tmrs.org>

Rajesh,

I did not use any AJAX or REST in my application, my application only uses simple servlet and jsp.

Thanks,
Ming

From: Rajesh Punjabi [mailto:rajesh_punjabi at hotmail.com]
Sent: Monday, March 18, 2013 12:15 PM
To: Cheung, Ming; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] How do I redirect for Invalid token for an AJAX

Thanks Ming for the response.   I do have a similar setup as you mentioned but it works for page request only.  It doesnt seem to work for AJAX requests.
Does it work for you for AJAX requests too when lets say a REST call is the protected URL?

Thanks,
Rajesh
________________________________
From: MCheung at tmrs.com<mailto:MCheung at tmrs.com>
To: rajesh_punjabi at hotmail.com<mailto:rajesh_punjabi at hotmail.com>; owasp-csrfguard at lists.owasp.org<mailto:owasp-csrfguard at lists.owasp.org>
Subject: RE: [Owasp-csrfguard] How do I redirect for Invalid token for an AJAX
Date: Mon, 18 Mar 2013 14:59:18 +0000
Here is the way I did that,

1)      In the Owasp.CsrfGuard.prop file,  Set the following property to a jsp page,
a.       org.owasp.csrfguard.action.Redirect.Page=/<MyAppliactionName>/error/CsrfAttackRedirect.jsp   /// where </MyApplicationName> is same as your URL https://myCompany.com/<MyApplicationName>/Login<https://myCompany.com/%3cMyApplicationName%3e/Login>.
2)      In the CsrfAttackRedirect.jsp, add a line to forward to your Logout servlet
a.
        <body>

        <% if (request.getParameter("user")==null){ %>

        <jsp:forward page="/Logoff" >
            <jsp:param name="CsrfAttack" value="CsrfAttactkDetected" />
             <jps:param name="AnyKeyName" value="AnyValue" />
        </jsp:forward>

        <%}%>
        </body>

3)  Since you are already in logoff servlet, you can do invalidation and any other things as you want before forward back to a display JSP.


Thanks,
Ming

From: Rajesh Punjabi [mailto:rajesh_punjabi at hotmail.com]
Sent: Monday, March 18, 2013 12:01 AM
To: owasp-csrfguard at lists.owasp.org<mailto:owasp-csrfguard at lists.owasp.org>
Subject: Re: [Owasp-csrfguard] How do I redirect for Invalid token for an AJAX

Would appreciate if someone could share your experiences with this problem.  Essentially for AJAX requests when the token is amiss, how do we take care of the error handling.  Ideally, want to take the user to a error page and invalidate the session.

Appreciate your help.
###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
###################################################################

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130318/ce1c1b8a/attachment-0001.html>

From MCheung at tmrs.com  Wed Mar 20 18:08:40 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Wed, 20 Mar 2013 18:08:40 +0000
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37B7@Post.intra.tmrs.org>

I learned the NULLPointer Exception was due to the initial request to the server. As we know, since it was the very first request, there was no session established yet. Therefore, session was null. As a result, the NullPointerException was thrown.

To work around with this NPE issue, I modified the org.owasp.csrfguard.CsrfGuard.UpdateToken method as the following, It seems work fine. Should UpdateToken consider the Null pointer issue if the session is not present? Or I might miss something that I am not aware of?


	public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() && !found) {
				String theElement = (String)en.nextElement();
				System.out.println("theElmeent = " + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
		} else {

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format("unable to generate the random token - %s", e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		}
	}

Thanks,
Ming

-----Original Message-----
From: Cheung, Ming [mailto:MCheung at tmrs.com] 
Sent: Tuesday, March 05, 2013 1:59 PM
To: Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

Regardless which listener I tried, I always got java.lang.NullPointerException with the following CsrfGuard code, Could someone please advice?


Here is the call stacks:

[3/5/13 13:53:56:747 CST] 00000015 servlet       E com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught exception created in one of the service methods of the servlet Logon in application CityPortal. Exception created : java.lang.NullPointerException
	at com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
	at com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
	at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
	at org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
	at com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
	at com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
	at com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
	at com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
	at com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
	at org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
	at org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
	at org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
	at org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
	at org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
	at org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
	at org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
	...


Thanks,
Ming


-----Original Message-----
From: Eric Sheridan [mailto:eric.sheridan at owasp.org]
Sent: Tuesday, March 05, 2013 12:17 PM
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

This is a fairly common problem. Does anyone want to take a crack at directly editing the Wiki article summarizing what they've done to get up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

On 3/5/13 12:49 PM, Cheung, Ming wrote:
> First of all, Thanks Patrick for providing the download link.
> 
> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> 
> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.
> 
> 
> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
> 
> 2. What is the difference?
> 
> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
> 
> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> 
> 
> Thanks,
> Ming
> 
> 
> 
> -----Original Message-----
> From: Patrick Radtke [mailto:pradtke at stanford.edu]
> Sent: Thursday, February 28, 2013 4:08 PM
> To: Cheung, Ming
> Cc: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha 
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> 
> https://github.com/esheri3/OWASP-CSRFGuard
> 
> 
> On 2/28/13 1:25 PM, Cheung, Ming wrote:
>> RA layer request failed
>>
>> svn: Server sent unexpected return value (405 Method Not Allowed) in 
>> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>>
>> Thanks,
>>
>> Ming
>>
>> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
>> *Sent:* Thursday, February 28, 2013 3:08 PM
>> *To:* owasp-csrfguard at lists.owasp.org
>> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
>> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>>
>> Hi There,
>>
>> The CSRFGuard failed on certain pages of my application, Could 
>> someone please point me to the SVN repository for downloading the java source?
>>
>> Thanks,
>>
>> Ming
>>
>> ###################################################################
>> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
>> intended only for the use of the individual or entity to which it is 
>> addressed and may contain information that is privileged, 
>> confidential, and exempt from disclosure under applicable law.
>> If you are not the intended recipient, you are notified that any use, 
>> dissemination, forwarding, distribution, or copying of the 
>> communication is strictly prohibited. Please notify the sender 
>> immediately by e-mail if you have received this communication by 
>> mistake and delete all copies of the original message and attachments 
>> from your system.
>> ###################################################################
>>
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
> 
> 
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
> intended only for the use of the individual or entity to which it is 
> addressed and may contain information that is privileged, 
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any use, 
> dissemination, forwarding, distribution, or copying of the 
> communication is strictly prohibited. Please notify the sender 
> immediately by e-mail if you have received this communication by 
> mistake and delete all copies of the original message and attachments 
> from your system.
> ###################################################################
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> 
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

From MCheung at tmrs.com  Wed Mar 20 21:02:30 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Wed, 20 Mar 2013 21:02:30 +0000
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37B7@Post.intra.tmrs.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37B7@Post.intra.tmrs.org>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37EA@Post.intra.tmrs.org>

Sorry, I copied and pasted a wrong version in previous email. This is the right one I am using.



      public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() && !found) {
				String theElement = (String)en.nextElement();
				System.out.println("theElmeent = " + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
	

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format("unable to generate the random token - %s", e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		
	}

Thanks,
Ming


-----Original Message-----
From: Cheung, Ming 
Sent: Wednesday, March 20, 2013 1:09 PM
To: Cheung, Ming; Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

I learned the NULLPointer Exception was due to the initial request to the server. As we know, since it was the very first request, there was no session established yet. Therefore, session was null. As a result, the NullPointerException was thrown.

To work around with this NPE issue, I modified the org.owasp.csrfguard.CsrfGuard.UpdateToken method as the following, It seems work fine. Should UpdateToken consider the Null pointer issue if the session is not present? Or I might miss something that I am not aware of?


	public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() && !found) {
				String theElement = (String)en.nextElement();
				System.out.println("theElmeent = " + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
		} else {

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format("unable to generate the random token - %s", e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		}
	}

Thanks,
Ming

-----Original Message-----
From: Cheung, Ming [mailto:MCheung at tmrs.com]
Sent: Tuesday, March 05, 2013 1:59 PM
To: Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

Regardless which listener I tried, I always got java.lang.NullPointerException with the following CsrfGuard code, Could someone please advice?


Here is the call stacks:

[3/5/13 13:53:56:747 CST] 00000015 servlet       E com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught exception created in one of the service methods of the servlet Logon in application CityPortal. Exception created : java.lang.NullPointerException
	at com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
	at com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
	at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
	at org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
	at com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
	at com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
	at com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
	at com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
	at com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
	at org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
	at org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
	at org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
	at org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
	at org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
	at org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
	at org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
	...


Thanks,
Ming


-----Original Message-----
From: Eric Sheridan [mailto:eric.sheridan at owasp.org]
Sent: Tuesday, March 05, 2013 12:17 PM
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

This is a fairly common problem. Does anyone want to take a crack at directly editing the Wiki article summarizing what they've done to get up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

On 3/5/13 12:49 PM, Cheung, Ming wrote:
> First of all, Thanks Patrick for providing the download link.
> 
> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> 
> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.
> 
> 
> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
> 
> 2. What is the difference?
> 
> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
> 
> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> 
> 
> Thanks,
> Ming
> 
> 
> 
> -----Original Message-----
> From: Patrick Radtke [mailto:pradtke at stanford.edu]
> Sent: Thursday, February 28, 2013 4:08 PM
> To: Cheung, Ming
> Cc: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha 
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> 
> https://github.com/esheri3/OWASP-CSRFGuard
> 
> 
> On 2/28/13 1:25 PM, Cheung, Ming wrote:
>> RA layer request failed
>>
>> svn: Server sent unexpected return value (405 Method Not Allowed) in 
>> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>>
>> Thanks,
>>
>> Ming
>>
>> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
>> *Sent:* Thursday, February 28, 2013 3:08 PM
>> *To:* owasp-csrfguard at lists.owasp.org
>> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
>> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>>
>> Hi There,
>>
>> The CSRFGuard failed on certain pages of my application, Could 
>> someone please point me to the SVN repository for downloading the java source?
>>
>> Thanks,
>>
>> Ming
>>
>> ###################################################################
>> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
>> intended only for the use of the individual or entity to which it is 
>> addressed and may contain information that is privileged, 
>> confidential, and exempt from disclosure under applicable law.
>> If you are not the intended recipient, you are notified that any use, 
>> dissemination, forwarding, distribution, or copying of the 
>> communication is strictly prohibited. Please notify the sender 
>> immediately by e-mail if you have received this communication by 
>> mistake and delete all copies of the original message and attachments 
>> from your system.
>> ###################################################################
>>
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
> 
> 
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
> intended only for the use of the individual or entity to which it is 
> addressed and may contain information that is privileged, 
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any use, 
> dissemination, forwarding, distribution, or copying of the 
> communication is strictly prohibited. Please notify the sender 
> immediately by e-mail if you have received this communication by 
> mistake and delete all copies of the original message and attachments 
> from your system.
> ###################################################################
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> 
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

From MCheung at tmrs.com  Thu Mar 21 21:01:43 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Thu, 21 Mar 2013 21:01:43 +0000
Subject: [Owasp-csrfguard] Where is the SVN repository for Alpha version
 OWASP CSRFGuard 3.0.0.503 (ALPHA)
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37EA@Post.intra.tmrs.org>
References: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85E4@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E85FC@Post.intra.tmrs.org>
	<512FD538.6070209@stanford.edu>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8914@Post.intra.tmrs.org>
	<513636AB.60307@owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086E8963@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37B7@Post.intra.tmrs.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37EA@Post.intra.tmrs.org>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F38B3@Post.intra.tmrs.org>

The Previous change runs with CsrfGuardHttpSessionListener. However, I don't think CsrfGuard is enabled because I could not see any OWASP_CSRFTOKEN key-value pair shown on the URL.


After I switched to use CsrfGuardServletContextListener, CsrfGuard was broken again. In order to make it run. I did the similar change to JavaScriptServlet.writeJavaScript(HttpServletRequest, HttpServletResponse) method. The trick was to inject the token with the following 3 lines.

	csrfGuard.updateTokens(request);
	tokenValue = (String) session.getAttribute(csrfGuard.getSessionKey());
	code = code.replaceAll(TOKEN_VALUE_IDENTIFIER, tokenValue);

Here is my modified version of the JavaScriptServlet.writeJavaScript();


private void writeJavaScript(HttpServletRequest request, HttpServletResponse response) throws IOException {
		HttpSession session = request.getSession(true);
		CsrfGuard csrfGuard = CsrfGuard.getInstance();

		/** cannot cache if rotate or token-per-page is enabled **/
		if (csrfGuard.isRotateEnabled() || csrfGuard.isTokenPerPageEnabled()) {
			response.setHeader("Cache-Control", "no-cache, no-store");
			response.setHeader("Pragma", "no-cache");
			response.setHeader("Expires", "0");
		} else {
			response.setHeader("Cache-Control", cacheControl);
		}

		response.setContentType("text/javascript");

		/** build dynamic javascript **/
		String code = templateCode;

		code = code.replaceAll(TOKEN_NAME_IDENTIFIER, csrfGuard.getTokenName());
		
	
		///  mcheung
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;
		/// avoid the NULL pointer exception error
		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = csrfGuard.getSessionKey();
			while (en.hasMoreElements() && !found) {
				String theElement = (String)en.nextElement();
				System.out.println("theElmeent = " + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(csrfGuard.getSessionKey());
			if (tokenValue != null) {
				code = code.replaceAll(TOKEN_VALUE_IDENTIFIER, tokenValue);
			} else {
				/// generate token value and replace at here
				csrfGuard.updateTokens(request);
				tokenValue = (String) session.getAttribute(csrfGuard.getSessionKey());
				code = code.replaceAll(TOKEN_VALUE_IDENTIFIER, tokenValue);
				
			}
		}
		
		///code = code.replaceAll(TOKEN_VALUE_IDENTIFIER, (String) session.getAttribute(csrfGuard.getSessionKey()));
///
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


		code = code.replaceAll(INJECT_INTO_FORMS_IDENTIFIER, injectIntoForms);
		code = code.replaceAll(INJECT_INTO_ATTRIBUTES_IDENTIFIER, injectIntoAttributes);
		code = code.replaceAll(INJECT_INTO_XHR_IDENTIFIER, String.valueOf(csrfGuard.isAjaxEnabled()));
		code = code.replaceAll(TOKENS_PER_PAGE_IDENTIFIER, String.valueOf(csrfGuard.isTokenPerPageEnabled()));
		code = code.replaceAll(DOMAIN_ORIGIN_IDENTIFIER, parseDomain(request.getRequestURL()));
		code = code.replaceAll(DOMAIN_STRICT_IDENTIFIER, domainStrict);
		code = code.replaceAll(CONTEXT_PATH_IDENTIFIER, request.getContextPath());
		code = code.replaceAll(SERVLET_PATH_IDENTIFIER, request.getContextPath() + request.getServletPath());
		code = code.replaceAll(X_REQUESTED_WITH_IDENTIFIER, xRequestedWith);

		/** write dynamic javascript **/
		OutputStream output = null;
		PrintWriter writer = null;

		try {
			output = response.getOutputStream();
			writer = new PrintWriter(output);

			writer.write(code);
			writer.flush();
		} finally {
			Writers.close(writer);
			Streams.close(output);
		}
	}

Could someone please investigate and advice what is the best approach to address this issue (Null Pointer of Session object and blank value of OWASP_CSRFTOKEN object?



Thanks,
Ming


-----Original Message-----
From: Cheung, Ming 
Sent: Wednesday, March 20, 2013 4:03 PM
To: Cheung, Ming; Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

Sorry, I copied and pasted a wrong version in previous email. This is the right one I am using.



      public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() && !found) {
				String theElement = (String)en.nextElement();
				System.out.println("theElmeent = " + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
	

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format("unable to generate the random token - %s", e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		
	}

Thanks,
Ming


-----Original Message-----
From: Cheung, Ming
Sent: Wednesday, March 20, 2013 1:09 PM
To: Cheung, Ming; Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

I learned the NULLPointer Exception was due to the initial request to the server. As we know, since it was the very first request, there was no session established yet. Therefore, session was null. As a result, the NullPointerException was thrown.

To work around with this NPE issue, I modified the org.owasp.csrfguard.CsrfGuard.UpdateToken method as the following, It seems work fine. Should UpdateToken consider the Null pointer issue if the session is not present? Or I might miss something that I am not aware of?


	public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() && !found) {
				String theElement = (String)en.nextElement();
				System.out.println("theElmeent = " + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
		} else {

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format("unable to generate the random token - %s", e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		}
	}

Thanks,
Ming

-----Original Message-----
From: Cheung, Ming [mailto:MCheung at tmrs.com]
Sent: Tuesday, March 05, 2013 1:59 PM
To: Eric Sheridan; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

Regardless which listener I tried, I always got java.lang.NullPointerException with the following CsrfGuard code, Could someone please advice?


Here is the call stacks:

[3/5/13 13:53:56:747 CST] 00000015 servlet       E com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught exception created in one of the service methods of the servlet Logon in application CityPortal. Exception created : java.lang.NullPointerException
	at com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
	at com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
	at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
	at org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
	at com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
	at com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
	at com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
	at com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
	at com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
	at org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
	at org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
	at org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
	at org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
	at org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
	at org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
	at org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
	...


Thanks,
Ming


-----Original Message-----
From: Eric Sheridan [mailto:eric.sheridan at owasp.org]
Sent: Tuesday, March 05, 2013 12:17 PM
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

This is a fairly common problem. Does anyone want to take a crack at directly editing the Wiki article summarizing what they've done to get up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

On 3/5/13 12:49 PM, Cheung, Ming wrote:
> First of all, Thanks Patrick for providing the download link.
> 
> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
> 
> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, https://www.owasp.org/index.php/CSRFGuard_3_Installation, is already out of date.
> 
> 
> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
> 
> 2. What is the difference?
> 
> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
> 
> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with "Required token is missing from the request", therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
> 
> 
> Thanks,
> Ming
> 
> 
> 
> -----Original Message-----
> From: Patrick Radtke [mailto:pradtke at stanford.edu]
> Sent: Thursday, February 28, 2013 4:08 PM
> To: Cheung, Ming
> Cc: owasp-csrfguard at lists.owasp.org
> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha 
> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
> 
> https://github.com/esheri3/OWASP-CSRFGuard
> 
> 
> On 2/28/13 1:25 PM, Cheung, Ming wrote:
>> RA layer request failed
>>
>> svn: Server sent unexpected return value (405 Method Not Allowed) in 
>> response to OPTIONS request for 'http://owaspcsrfguard.googlecode.com'
>>
>> Thanks,
>>
>> Ming
>>
>> *From:*Cheung, Ming [mailto:MCheung at tmrs.com]
>> *Sent:* Thursday, February 28, 2013 3:08 PM
>> *To:* owasp-csrfguard at lists.owasp.org
>> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
>> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
>>
>> Hi There,
>>
>> The CSRFGuard failed on certain pages of my application, Could 
>> someone please point me to the SVN repository for downloading the java source?
>>
>> Thanks,
>>
>> Ming
>>
>> ###################################################################
>> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
>> intended only for the use of the individual or entity to which it is 
>> addressed and may contain information that is privileged, 
>> confidential, and exempt from disclosure under applicable law.
>> If you are not the intended recipient, you are notified that any use, 
>> dissemination, forwarding, distribution, or copying of the 
>> communication is strictly prohibited. Please notify the sender 
>> immediately by e-mail if you have received this communication by 
>> mistake and delete all copies of the original message and attachments 
>> from your system.
>> ###################################################################
>>
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
> 
> 
> ###################################################################
> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
> intended only for the use of the individual or entity to which it is 
> addressed and may contain information that is privileged, 
> confidential, and exempt from disclosure under applicable law.
> If you are not the intended recipient, you are notified that any use, 
> dissemination, forwarding, distribution, or copying of the 
> communication is strictly prohibited. Please notify the sender 
> immediately by e-mail if you have received this communication by 
> mistake and delete all copies of the original message and attachments 
> from your system.
> ###################################################################
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> 
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

