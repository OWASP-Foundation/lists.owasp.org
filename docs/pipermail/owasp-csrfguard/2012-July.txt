From amolsw at gmail.com  Wed Jul 11 20:04:54 2012
From: amolsw at gmail.com (Amol Walunjkar)
Date: Wed, 11 Jul 2012 16:04:54 -0400
Subject: [Owasp-csrfguard] Fwd: <csrf:a> tag issue
In-Reply-To: <CAKK7c1rJdAyuBuKE66YguPFfcBGEg1OZjYqDx_apmcOrjRigFQ@mail.gmail.com>
References: <CAKK7c1rJdAyuBuKE66YguPFfcBGEg1OZjYqDx_apmcOrjRigFQ@mail.gmail.com>
Message-ID: <CAKK7c1pqW4YHUNfCCt0DtQexTJMbX+LD8yftCQBcd56r8edE_Q@mail.gmail.com>

Hi,

I am using *<csrf:a>* tag for creating a hyperlink and for its *href *attribute
I am using jsp expression as below

<csrf:a href="myservlet?name=*<%=somename%>*" ></csrf:a>

in above statement, "somename" is a jsp variable and provided by using jsp
expression.
Now when the form get submitted to the server, the *somename *parameter
value does not get transfer properly. Instead of sending the runtime value
for the variable "somename" it send the value as *<%=somename%>.
*This is NOT a problem when using regular <a> tag and only when I am using
<csrf:a> tag I am getting this problem

Is it known problem with this tag ?
Please suggest the solution

-- 
Regards,
Amol



-- 
Regards,
Amol
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120711/2d35fdaf/attachment.html>

From pradtke at stanford.edu  Thu Jul 12 16:48:58 2012
From: pradtke at stanford.edu (Patrick Radtke)
Date: Thu, 12 Jul 2012 09:48:58 -0700
Subject: [Owasp-csrfguard] Fwd: <csrf:a> tag issue
In-Reply-To: <CAKK7c1pqW4YHUNfCCt0DtQexTJMbX+LD8yftCQBcd56r8edE_Q@mail.gmail.com>
References: <CAKK7c1rJdAyuBuKE66YguPFfcBGEg1OZjYqDx_apmcOrjRigFQ@mail.gmail.com>
	<CAKK7c1pqW4YHUNfCCt0DtQexTJMbX+LD8yftCQBcd56r8edE_Q@mail.gmail.com>
Message-ID: <4FFEFFFA.5090708@stanford.edu>

You are mixing JSP scriplets with JSTL tags. That is generally 
considered bad practice. The JSTL tag only can know EL variables and 
won't resolve your scriplet variables.

On 7/11/12 1:04 PM, Amol Walunjkar wrote:
> Hi,
>
> I am using *<csrf:a>* tag for creating a hyperlink and for its *href
> *attribute I am using jsp expression as below
>
> <csrf:a href="myservlet?name=*/<%=somename%>/*" ></csrf:a>
>
> in above statement, "somename" is a jsp variable and provided by using
> jsp expression.
> Now when the form get submitted to the server, the */somename
> /*parameter value does not get transfer properly. Instead of sending the
> runtime value for the variable "somename" it send the value as
> */<%=somename%>.
> /*This is NOT a problem when using regular <a> tag and only when I am
> using <csrf:a> tag I am getting this problem
>
> Is it known problem with this tag ?
> Please suggest the solution
>
> --
> Regards,
> Amol
>
>
>
> --
> Regards,
> Amol
>
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>



From igor.trivunic at ze.com  Wed Jul 18 15:03:48 2012
From: igor.trivunic at ze.com (Igor Trivunic)
Date: Wed, 18 Jul 2012 15:03:48 +0000
Subject: [Owasp-csrfguard] CSRF Guard implementation inconsistencies
Message-ID: <3A77D8B6FA6BEB4F8128EA17EB1978521CDBAE30@EXCHANGE-01B.zepower.com>

Hello,

I've been trying to implement CSRFGuard3 it into our application for some time now and have run into several problems. Since I was not successful in finding a solution online, I thought I would contact you with a couple of questions. Perhaps you can shed some light on a couple of problem areas that seem quite difficult to debug due to their inconsistencies.  I am not asking for help in debugging my application, just want to see whether you've observed similar behavior anywhere and if you're aware of what the correct approach to resolution was.

The problem that I have is that behavior is very different between FireFox and IE, as well as between localhost and server it is deployed on. For example, http://localhost:8080/zema works fine on both browsers. However, IE will not let you log in if you use the machine name instead, so http://wrk-it-72:8080/zema
will not let you log in. So, for IE you cannot log in to the deployed version on the server either, only localhost.

Debugging into any of the Action classes shows valid CSRF tokens being passed around just fine as does inspecting the forms on the page source.

The inconsistency part stems from the fact that certain links will work fine on FireFox, but after the next scheduled build they will start to produce CSRF attack errors and redirect me to the error page. Since this does not happen on my local machine it proves quite difficult to debug. I have accessed my local machine from others' computers and was not able to replicate the problems; Everything worked fine. I've attached a screenshot from Fiddler of this happening. As you can see the CSRF security token has suddenly changed, and the link no longer works. This is sometimes a problem, and sometimes works just fine. I should mention that the session ID has not changed, just the CSRF security token has.  In this particular case javascript generates the link and I inject the token manually as follows:

function startCurveDebugger(curveId, ownerId, effectiveDate) {
  var url = '<html:rewrite page='/curve/curveDebugger.jsp'/>';
  if (curveId != null && ownerId != null && effectiveDate != null) {
    url += "?curveId=" + curveId + "&ownerId=" + ownerId + "&effectiveDate=" + effectiveDate;
  }
  var OWASP_CSRFTOKEN = document.getElementsByName("OWASP_CSRFTOKEN")[0].value;
  if(url.indexOf("?") == -1) {
    url += "?";
  }
  else {
    url += "&";
  }
  url += "OWASP_CSRFTOKEN=" + OWASP_CSRFTOKEN;

  window.top.inputWin = window.top;
  window.open(url, '_new');
}

Furthermore, logging in on IE to application running on localhost is inconsistent in that it always reports javascript errors and they are always different. Almost like some part of CSRF is preventing javascript from running fully. This causes parts of the application to not load properly, or causes broken links etc. This is probably the biggest issue I am facing as it renders the application completely useless in Internet Explorer.

Our application uses struts and navigation is mostly done between JSP and struts Action classes with JavaScript generating some of the links as well (as shown above). I'm assuming a CSRF implementation on a similar setup has been performed with success before?

To implement this I have configured things as follows:


*         The filter mapping for CSRFGuard has been set to <url-pattern>*.jsp</url-pattern> and <url-pattern>*.do</url-pattern>

*         Inject into forms/attributes are both 'true' and domain-strict is 'false'

*         The referrer-pattern was alternated between using localhost, machine name, and having it removed entirely with varying results, but no conclusive solution.

*         The unprotected pages are: JavaScriptServlet, index.jsp (home page and same page designated as new token landing page), error page, /zema/images*, /zema/styles* (The last two were added as CSS was causing CSRF errors and I had to modify your JavaScript as follows to fix this: )

      /** inject tokens as query string parameters into url **/
      function injectTokenAttribute(element, attr, tokenName, tokenValue, pageTokens) {
            var location = element.getAttribute(attr);

            // skip over any images and CSS urls
            var skip = false;
            if(location != null && (location.indexOf('/styles/') != -1 || location.indexOf('images/') != -1)) {
              skip = true;
            }

            if(location != null && isValidUrl(location)) {
                  var uri = parseUri(location);
                  var value = (pageTokens[uri] != null ? pageTokens[uri] : tokenValue);

                  if(!skip) {
                  if(location.indexOf('?') != -1) {
                        location = location + '&' + tokenName + '=' + value;
                  } else {
                        location = location + '?' + tokenName + '=' + value;
                  }
                  }

                  try {
                        element.setAttribute(attr, location);
                  } catch (e) {
                        // attempted to set/update unsupported attribute
                  }
            }
      }

*         The 'TokenPerPage' and 'TokenPerPagePrecreate' properties are both set to 'false'.

*         The propery 'org.owasp.csrfguard.Protect'is currently commented out, but un-commenting and setting to 'false' did not make a difference.

*         The remaining properties were left unchanged from default.


If you have seen or heard of similar behavior I would be interested in hearing more on what kind of steps were taken to resolve it!

Thanks in advance,

Igor Trivunic
Application Developer
ZE PowerGroup Inc.
#170-5920 No. 2 Road
Richmond, BC, Canada, V7C-4R9
Phone: (604) 244-1475 Ext. 306
Emai: igor.trivunic at ze.com<mailto:igor.trivunic at ze.com> Website: www.ze.com<http://www.ze.com/>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120718/efca25c5/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: csrf_token_changing.png
Type: image/png
Size: 152050 bytes
Desc: csrf_token_changing.png
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120718/efca25c5/attachment-0001.png>

From amolsw at gmail.com  Wed Jul 25 19:12:38 2012
From: amolsw at gmail.com (Amol Walunjkar)
Date: Wed, 25 Jul 2012 15:12:38 -0400
Subject: [Owasp-csrfguard] Token landing page issue when accessing
	application URL
Message-ID: <CAKK7c1pWqJsadL2_FB2eoi1bTW5Ax9eCodvx7CN8-55Ef9ReGw@mail.gmail.com>

Hi,

We have one requirement in our application. In this, the user of our
application will receive an email which contains a hyperlink using which he
can directly go to one of the functionality of the application.
We have utilized OSWAP framework for providing security against CSRF.
In the properties file we have set the "NewTokenLandingPage" property to
home page our application.
Now the problem is that, when user launch the hyperlink from the email he
received to access specific functionality he is always taken to the home
page instead of the directed URL in the email.
In the documentation it is said that all query-string form parameters sent
with the original request will be discarded. But then, if we have to
implement such behavior in application which is the solution for this.

Does the current OSWAP framework for CSRF support such custom requirement ?

Please advice

Thanks in advance

-- 
Regards,
Amol
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120725/055d8f09/attachment.html>

From Radhika.Krishnan at uth.tmc.edu  Fri Jul 27 13:20:07 2012
From: Radhika.Krishnan at uth.tmc.edu (Krishnan, Radhika)
Date: Fri, 27 Jul 2012 08:20:07 -0500
Subject: [Owasp-csrfguard] Token landing page issue when
	accessing	application URL
In-Reply-To: <CAKK7c1pWqJsadL2_FB2eoi1bTW5Ax9eCodvx7CN8-55Ef9ReGw@mail.gmail.com>
References: <CAKK7c1pWqJsadL2_FB2eoi1bTW5Ax9eCodvx7CN8-55Ef9ReGw@mail.gmail.com>
Message-ID: <9CBD05955C5C2346AED18D7B5237BF0F5A6A1E692A@UTHCMS3.uthouston.edu>

Has anybody implemented csrfguard for JSF application?

Thanks,
Radhika

From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of Amol Walunjkar
Sent: Wednesday, July 25, 2012 2:13 PM
To: owasp-csrfguard at lists.owasp.org
Subject: [Owasp-csrfguard] Token landing page issue when accessing application URL

Hi,

We have one requirement in our application. In this, the user of our application will receive an email which contains a hyperlink using which he can directly go to one of the functionality of the application.
We have utilized OSWAP framework for providing security against CSRF.
In the properties file we have set the "NewTokenLandingPage" property to home page our application.
Now the problem is that, when user launch the hyperlink from the email he received to access specific functionality he is always taken to the home page instead of the directed URL in the email.
In the documentation it is said that all query-string form parameters sent with the original request will be discarded. But then, if we have to implement such behavior in application which is the solution for this.

Does the current OSWAP framework for CSRF support such custom requirement ?

Please advice

Thanks in advance

--
Regards,
Amol
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120727/92a7ed1a/attachment.html>

From pradtke at stanford.edu  Fri Jul 27 16:51:47 2012
From: pradtke at stanford.edu (Patrick Radtke)
Date: Fri, 27 Jul 2012 09:51:47 -0700
Subject: [Owasp-csrfguard] Token landing page issue when accessing
 application URL
In-Reply-To: <CAKK7c1pWqJsadL2_FB2eoi1bTW5Ax9eCodvx7CN8-55Ef9ReGw@mail.gmail.com>
References: <CAKK7c1pWqJsadL2_FB2eoi1bTW5Ax9eCodvx7CN8-55Ef9ReGw@mail.gmail.com>
Message-ID: <5012C723.8000801@stanford.edu>

Why are you using 'NewTokenLandingPage'?
IMHO if you want users to have direct access to a URL, don't protect 
that URL with CSRFGuard.

-Patrick



On 7/25/12 12:12 PM, Amol Walunjkar wrote:
> Hi,
>
> We have one requirement in our application. In this, the user of our
> application will receive an email which contains a hyperlink using which
> he can directly go to one of the functionality of the application.
> We have utilized OSWAP framework for providing security against CSRF.
> In the properties file we have set the "NewTokenLandingPage" property to
> home page our application.
> Now the problem is that, when user launch the hyperlink from the email
> he received to access specific functionality he is always taken to the
> home page instead of the directed URL in the email.
> In the documentation it is said that all query-string form parameters
> sent with the original request will be discarded. But then, if we have
> to implement such behavior in application which is the solution for this.
>
> Does the current OSWAP framework for CSRF support such custom requirement ?
>
> Please advice
>
> Thanks in advance
>
> --
> Regards,
> Amol
>
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>


