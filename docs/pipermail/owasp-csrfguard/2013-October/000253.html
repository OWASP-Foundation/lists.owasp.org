<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] first request is not protected?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20first%20request%20is%20not%20protected%3F&In-Reply-To=%3C524B3B5D.1010500%40stanford.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000252.html">
   <LINK REL="Next"  HREF="000255.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] first request is not protected?</H1>
    <B>Patrick Radtke</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20first%20request%20is%20not%20protected%3F&In-Reply-To=%3C524B3B5D.1010500%40stanford.edu%3E"
       TITLE="[Owasp-csrfguard] first request is not protected?">pradtke at stanford.edu
       </A><BR>
    <I>Tue Oct  1 21:15:09 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000252.html">[Owasp-csrfguard] first request is not protected?
</A></li>
        <LI>Next message: <A HREF="000255.html">[Owasp-csrfguard] problems with dynamic images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#253">[ date ]</a>
              <a href="thread.html#253">[ thread ]</a>
              <a href="subject.html#253">[ subject ]</a>
              <a href="author.html#253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I know in your original email you stated the app was sessionless. Where 
are you storing the CSRFGuard session data? In our Single sign on 
scenarios we create the session prior to the CsrfGuardFilter filter 
running, so this hadn't been an issue.




On 10/1/13 12:17 PM, Chris Hyzer wrote:
&gt;<i> Not sure if this is the culprit... but I don't really understand it: (from CsrfGuardFilter)
</I>&gt;<i>
</I>&gt;<i> 			if (session == null) {
</I>&gt;<i> 				// If there is no session, no harm can be done
</I>&gt;<i> 				filterChain.doFilter(httpRequest, (HttpServletResponse) response);
</I>&gt;<i> 				return;
</I>&gt;<i> 			}
</I>&gt;<i>
</I>&gt;<i> Isnt it possible a request to come not from an existing session that would be single-signed on with a cookie, and authenticated, authorized, and perform the action?  Seems like this shouldn't pass through, but should be checked by csrfguard (even if it is an option to do so for people who want it).  I guess this assumes the Java session timeout is exactly the same or greater than the authentication timeout.  At Penn that is not the case.  You could be timed out from the Java app, but the single sign on cookie will get you right back in without redirect or user-input, I think this is a gap.  Another use case is you have a bunch of apps on one apache, you are logged in to one, the single sign on cookie is valid, but you have no session on another, it would be vulnerable to CSRF.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Chris
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Chris Hyzer
</I>&gt;<i> Sent: Tuesday, October 01, 2013 1:11 AM
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> Subject: first request is not protected?
</I>&gt;<i>
</I>&gt;<i> I have a protected URL: /whatever, and the first request can go through CSRFguard, but subsequent requests cannot (they go to the error page).  Shouldn't the first request by default be protected unless that page is allowed in the properties file?  Is there a setting I can change to make the first request be protected?  Granted I understand that users will need to login, but I would prefer if all requests to protected resources are protected unless the CSRF token is there.  I tried this setting and it didn't seem to work...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> # New Token Redirect Page
</I>&gt;<i> #
</I>&gt;<i> # Defines where to send a user if the token is being generated for the first time.
</I>&gt;<i> # Failure to define a redirect page will allow CSRF attacks to work for unauthenticated
</I>&gt;<i> # users
</I>&gt;<i> org.owasp.csrfguard.NewTokenRedirectPage=/myApp/assets/html/csrfError.html
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Chris
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-csrfguard mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000252.html">[Owasp-csrfguard] first request is not protected?
</A></li>
	<LI>Next message: <A HREF="000255.html">[Owasp-csrfguard] problems with dynamic images
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#253">[ date ]</a>
              <a href="thread.html#253">[ thread ]</a>
              <a href="subject.html#253">[ subject ]</a>
              <a href="author.html#253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
