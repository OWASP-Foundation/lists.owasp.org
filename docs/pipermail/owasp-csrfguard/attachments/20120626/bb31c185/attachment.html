<tt>
&lt;span&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;One&nbsp;of&nbsp;the&nbsp;things&nbsp;I&#39;ve&nbsp;noticed&nbsp;with&nbsp;the&nbsp;javascript&nbsp;DOM&nbsp;manipulation&nbsp;is&nbsp;that&nbsp;it&nbsp;rewrites&nbsp;link&nbsp;and&nbsp;script&nbsp;src&nbsp;attributes&nbsp;in&nbsp;the&nbsp;head&nbsp;block.&nbsp;But&nbsp;they&#39;ve&nbsp;already&nbsp;potentially&nbsp;loaded,&nbsp;so&nbsp;we&nbsp;get&nbsp;things&nbsp;like&nbsp;css&nbsp;and&nbsp;javascript&nbsp;files&nbsp;loaded&nbsp;again.&nbsp;This&nbsp;leads&nbsp;to&nbsp;a&nbsp;rather&nbsp;nasty&nbsp;FoUC&nbsp;(Flash&nbsp;of&nbsp;Unstyled&nbsp;Content). &lt;/span&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;I&#39;ve&nbsp;tweaked&nbsp;the&nbsp;csrf&nbsp;js&nbsp;to&nbsp;only&nbsp;rewrite&nbsp;forms,&nbsp;src&nbsp;and&nbsp;hrefs&nbsp;within&nbsp;the&nbsp;document&nbsp;body&nbsp;as&nbsp;an&nbsp;interim&nbsp;measure.&nbsp;Obviously&nbsp;this&nbsp;introduces&nbsp;holes.&nbsp;Even&nbsp;with&nbsp;this&nbsp;interim&nbsp;measure,&nbsp;images&nbsp;etc&nbsp;within&nbsp;the&nbsp;document&nbsp;body&nbsp;can&nbsp;potentially&nbsp;be&nbsp;reloaded&nbsp;due&nbsp;to&nbsp;the&nbsp;rewrite.&lt;/div&gt;<br>
<br>
&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
<br>
I&nbsp;particularly&nbsp;like&nbsp;the&nbsp;js&nbsp;approach&nbsp;though&nbsp;as&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;provide&nbsp;CSRF&nbsp;protection&nbsp;to&nbsp;apps&nbsp;sitting&nbsp;behind&nbsp;ours.&nbsp;They&nbsp;can&nbsp;just&nbsp;include&nbsp;the&nbsp;csfr&nbsp;js&nbsp;in&nbsp;their&nbsp;pages&nbsp;and&nbsp;off&nbsp;they&nbsp;go. &lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;<br>
<br>
&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style=&quot;color:rgb(34,34,34);font-family:arial,sans-serif;font-size:13px;background-color:rgb(255,255,255)&quot;&gt;So&nbsp;what&#39;s&nbsp;the&nbsp;best&nbsp;way&nbsp;forward&nbsp;with&nbsp;this?&nbsp;Is&nbsp;my&nbsp;interim&nbsp;fix&nbsp;appropriate?&nbsp;And&nbsp;I&nbsp;better&nbsp;hard-rendering&nbsp;the&nbsp;tokens&nbsp;in&nbsp;the&nbsp;page?&lt;/div&gt;<br>
<br>

</tt>
