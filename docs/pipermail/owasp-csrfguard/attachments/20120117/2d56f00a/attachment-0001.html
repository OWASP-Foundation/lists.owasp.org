<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;style&gt;&lt;!--<br>
.hmmessage&nbsp;P<br>
{<br>
margin:0px;<br>
padding:0px<br>
}<br>
body.hmmessage<br>
{<br>
font-size:&nbsp;10pt;<br>
font-family:Tahoma<br>
}<br>
--&gt;&lt;/style&gt;&lt;/head&gt;<br>
&lt;body&nbsp;class='hmmessage'&gt;&lt;div&nbsp;dir='ltr'&gt;<br>
&lt;br&gt;Hello,&nbsp;I&nbsp;was&nbsp;having&nbsp;problems&nbsp;with&nbsp;the&nbsp;the&nbsp;dynamic&nbsp;DOM&nbsp;manipulation&nbsp;solution&nbsp;within&nbsp;certain&nbsp;browsers&nbsp;and&nbsp;I&nbsp;modified&nbsp;the&nbsp;javascript&nbsp;file&nbsp;to&nbsp;fix&nbsp;certain&nbsp;issues.&lt;br&gt;&lt;br&gt;I&nbsp;propose&nbsp;that&nbsp;these&nbsp;changes&nbsp;are&nbsp;investigated&nbsp;if&nbsp;they&nbsp;are&nbsp;indeed&nbsp;useless:&lt;br&gt;&lt;br&gt;In&nbsp;Firefox:&lt;br&gt;&lt;br&gt;Issue:&nbsp;DOM&nbsp;flickering&nbsp;problem&nbsp;where&nbsp;all&nbsp;the&nbsp;text&nbsp;in&nbsp;the&nbsp;page&nbsp;is&nbsp;displayed&nbsp;for&nbsp;a&nbsp;very&nbsp;brief&nbsp;moment&nbsp;without&nbsp;any&nbsp;formatting.&lt;br&gt;&lt;br&gt;Solution:&nbsp;I&nbsp;hide&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;document&nbsp;before&nbsp;the&nbsp;token&nbsp;is&nbsp;injected&nbsp;into&nbsp;each&nbsp;tag&nbsp;and&nbsp;then&nbsp;redisplay&nbsp;it&nbsp;once&nbsp;all&nbsp;the&nbsp;tags&nbsp;are&nbsp;modified&nbsp;with&nbsp;the&nbsp;setTImeOut&nbsp;javascript&nbsp;function:&lt;br&gt;&lt;br&gt;Code:&nbsp;&lt;br&gt;function&nbsp;injectTokens(tokenName,&nbsp;tokenValue)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;document.body.style.display&nbsp;='none';&lt;/b&gt;&lt;br&gt;...&lt;br&gt;&lt;br&gt;addEvent(window,'load',&nbsp;function()&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;injectTokens(&quot;%TOKEN_NAME%&quot;,&nbsp;&quot;%TOKEN_VALUE%&quot;);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&lt;br&gt;&lt;b&gt;addEvent(window,'load',&nbsp;function()&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/b&gt;&lt;b&gt;&nbsp;setTimeout(&quot;document.body.style.display&nbsp;='block'&quot;,&nbsp;200);&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});&nbsp;&lt;/b&gt;&lt;br&gt;...&lt;br&gt;&lt;br&gt;In&nbsp;IE:&lt;br&gt;&lt;br&gt;Issue:&nbsp;When&nbsp;accessing&nbsp;a&nbsp;page&nbsp;that&nbsp;contained&nbsp;the&nbsp;JavascriptServlet&nbsp;&lt;script&gt;&nbsp;tag,&nbsp;the&nbsp;form&nbsp;within&nbsp;the&nbsp;page&nbsp;was&nbsp;being&nbsp;resubmitted&nbsp;to&nbsp;the&nbsp;server&nbsp;after&nbsp;the&nbsp;page&nbsp;was&nbsp;already&nbsp;displayed.&nbsp;I&nbsp;am&nbsp;not&nbsp;certain&nbsp;but&nbsp;I&nbsp;believe&nbsp;that&nbsp;if&nbsp;you&nbsp;dynamically&nbsp;modify&nbsp;the&nbsp;action&nbsp;attribute&nbsp;of&nbsp;a&nbsp;&lt;form&gt;&nbsp;tag&nbsp;(or&nbsp;the&nbsp;src&nbsp;attribute&nbsp;of&nbsp;an&nbsp;&lt;img&gt;&nbsp;tag)&nbsp;the&nbsp;page&nbsp;is&nbsp;resubmitted&nbsp;only&nbsp;in&nbsp;IE.&nbsp;This&nbsp;was&nbsp;causing&nbsp;the&nbsp;token&nbsp;to&nbsp;be&nbsp;updated&nbsp;to&nbsp;a&nbsp;new&nbsp;value&nbsp;(if&nbsp;org.owasp.csrfguard.Rotate=true)&nbsp;different&nbsp;from&nbsp;the&nbsp;token&nbsp;contained&nbsp;in&nbsp;the&nbsp;links&nbsp;of&nbsp;the&nbsp;page&nbsp;that&nbsp;is&nbsp;already&nbsp;displayed.&nbsp;If&nbsp;you&nbsp;selected&nbsp;a&nbsp;link&nbsp;to&nbsp;a&nbsp;protected&nbsp;page&nbsp;from&nbsp;the&nbsp;displayed&nbsp;page&nbsp;that&nbsp;contained&nbsp;the&nbsp;&nbsp;JavascriptServlet&nbsp;&lt;script&gt;&nbsp;tag,&nbsp;this&nbsp;would&nbsp;lead&nbsp;to&nbsp;an&nbsp;CSRF&nbsp;attack&nbsp;detection.&lt;br&gt;&lt;br&gt;Solution:&nbsp;I&nbsp;ignored&nbsp;certain&nbsp;tags&nbsp;in&nbsp;the&nbsp;token&nbsp;injection&nbsp;function&nbsp;and&nbsp;also&nbsp;removed&nbsp;injecting&nbsp;a&nbsp;token&nbsp;attribute&nbsp;in&nbsp;the&nbsp;action&nbsp;attribute&nbsp;of&nbsp;a&nbsp;&lt;form&gt;&nbsp;tag.&nbsp;This&nbsp;will&nbsp;only&nbsp;work&nbsp;if&nbsp;images,&nbsp;scripts&nbsp;and&nbsp;css&nbsp;links&nbsp;are&nbsp;unprotected:&lt;br&gt;&lt;br&gt;Code:&lt;br&gt;function&nbsp;injectTokens(tokenName,&nbsp;tokenValue)&nbsp;{&lt;br&gt;...&lt;br&gt;&lt;br&gt;&lt;b&gt;if(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;element.tagName.toLowerCase()&nbsp;!=&nbsp;&quot;script&quot;&nbsp;&lt;br&gt;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;element.tagName.toLowerCase()&nbsp;!=&nbsp;&quot;img&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;element.tagName.toLowerCase()&nbsp;!=&nbsp;&quot;image&quot;&lt;br&gt;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;element.tagName.toLowerCase()&nbsp;!=&nbsp;&quot;link&quot;)&lt;br&gt;{&lt;/b&gt;&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/**&nbsp;inject&nbsp;into&nbsp;form&nbsp;**/&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(element.tagName.toLowerCase()&nbsp;==&nbsp;&quot;form&quot;)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(%INJECT_FORMS%&nbsp;==&nbsp;true)&nbsp;{&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;injectTokenForm(element,&nbsp;tokenName,&nbsp;tokenValue,&nbsp;pageTokens);&nbsp;//&nbsp;this&nbsp;should&nbsp;be&nbsp;enough&nbsp;for&nbsp;a&nbsp;form&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;b&gt;&nbsp;//&nbsp;injectTokenAttribute(element,&nbsp;&quot;action&quot;,&nbsp;tokenName,&nbsp;tokenValue,&nbsp;pageTokens);&lt;/b&gt;&lt;br&gt;&nbsp;...&lt;br&gt;&lt;b&gt;}&lt;/b&gt;&lt;br&gt;&lt;br&gt;I&nbsp;hope&nbsp;this&nbsp;can&nbsp;help&nbsp;certain&nbsp;users&nbsp;that&nbsp;have&nbsp;come&nbsp;across&nbsp;the&nbsp;same&nbsp;issues.&lt;br&gt;&lt;br&gt;Daniel&nbsp;Fiore.&lt;br&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;&lt;/body&gt;<br>
&lt;/html&gt;
</tt>
