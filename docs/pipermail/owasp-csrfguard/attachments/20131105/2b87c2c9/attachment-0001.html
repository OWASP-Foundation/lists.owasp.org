<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi&nbsp;Younes&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;been&nbsp;using&nbsp;CSRFGuard&nbsp;for&nbsp;a&nbsp;while&nbsp;now&nbsp;and&nbsp;haven&#39;t&nbsp;faced&nbsp;this&nbsp;problem.&nbsp; From&nbsp;your&nbsp;first&nbsp;post&nbsp;I&nbsp;believe&nbsp;you&nbsp;are&nbsp;using&nbsp;Apache&nbsp;Tomcat,&nbsp;which&nbsp;is&nbsp;what&nbsp;we&nbsp;use&nbsp;for&nbsp;our&nbsp;application&nbsp;as&nbsp;well&nbsp;so&nbsp;our&nbsp;usage&nbsp;seems&nbsp;to&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;yours.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;looked&nbsp;through&nbsp;the&nbsp;code&nbsp;for&nbsp;the&nbsp;JavaScript&nbsp;servlet&nbsp;and&nbsp;do&nbsp;not&nbsp;see&nbsp;any&nbsp;obvious&nbsp;reason&nbsp;why&nbsp;you&nbsp;should&nbsp;be&nbsp;getting&nbsp;the&nbsp;reported&nbsp;error.&nbsp; Could&nbsp;you&nbsp;help&nbsp;out&nbsp;by&nbsp;providing&nbsp;the&nbsp;following&nbsp;details:&lt;/div&gt;&lt;div&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&gt;&lt;li&gt;Java&nbsp;version&nbsp;you&nbsp;are&nbsp;using.&lt;/li&gt;&lt;li&gt;Tomcat&nbsp;version&nbsp;you&nbsp;are&nbsp;using.&lt;/li&gt;&lt;li&gt;Complete&nbsp;stack&nbsp;trace&nbsp;for&nbsp;the&nbsp;error,&nbsp;including&nbsp;all&nbsp;logged&nbsp;causes.&lt;/li&gt;&lt;li&gt;Whether&nbsp;you&nbsp;get&nbsp;the&nbsp;error&nbsp;all&nbsp;the&nbsp;time&nbsp;or&nbsp;only&nbsp;in&nbsp;some&nbsp;instances.&nbsp; If&nbsp;only&nbsp;occasionally,&nbsp;any&nbsp;steps&nbsp;to&nbsp;reproduce&nbsp;the&nbsp;error&nbsp;would&nbsp;be&nbsp;good.&lt;/li&gt;<br>
&lt;/ol&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers&lt;/div&gt;&lt;div&gt;~&nbsp;Manish&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Sat,&nbsp;Nov&nbsp;2,&nbsp;2013&nbsp;at&nbsp;5:30&nbsp;PM,&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-csrfguard-request@lists.owasp.org&quot;&nbsp;target=&quot;_blank&quot;&gt;owasp-csrfguard-request@lists.owasp.org&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;Send&nbsp;Owasp-csrfguard&nbsp;mailing&nbsp;list&nbsp;submissions&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-csrfguard@lists.owasp.org&quot;&gt;owasp-csrfguard@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;subscribe&nbsp;or&nbsp;unsubscribe&nbsp;via&nbsp;the&nbsp;World&nbsp;Wide&nbsp;Web,&nbsp;visit&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&lt;/a&gt;&lt;br&gt;<br>
or,&nbsp;via&nbsp;email,&nbsp;send&nbsp;a&nbsp;message&nbsp;with&nbsp;subject&nbsp;or&nbsp;body&nbsp;&#39;help&#39;&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-csrfguard-request@lists.owasp.org&quot;&gt;owasp-csrfguard-request@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;reach&nbsp;the&nbsp;person&nbsp;managing&nbsp;the&nbsp;list&nbsp;at&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-csrfguard-owner@lists.owasp.org&quot;&gt;owasp-csrfguard-owner@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;replying,&nbsp;please&nbsp;edit&nbsp;your&nbsp;Subject&nbsp;line&nbsp;so&nbsp;it&nbsp;is&nbsp;more&nbsp;specific&lt;br&gt;<br>
than&nbsp;&quot;Re:&nbsp;Contents&nbsp;of&nbsp;Owasp-csrfguard&nbsp;digest...&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Today&#39;s&nbsp;Topics:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; 1.&nbsp;OWASP-CSRF&nbsp;Guard&nbsp;-&nbsp;Probleme&nbsp;with&nbsp;the&nbsp; &nbsp; &nbsp; JavaScriptServlet&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp;(younes&nbsp;quoulali)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
----------------------------------------------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;1&lt;br&gt;<br>
Date:&nbsp;Fri,&nbsp;1&nbsp;Nov&nbsp;2013&nbsp;17:58:30&nbsp;+0000&lt;br&gt;<br>
From:&nbsp;younes&nbsp;quoulali&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:yquoulali@gmail.com&quot;&gt;yquoulali@gmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-csrfguard@lists.owasp.org&quot;&gt;owasp-csrfguard@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;[Owasp-csrfguard]&nbsp;OWASP-CSRF&nbsp;Guard&nbsp;-&nbsp;Probleme&nbsp;with&nbsp;the&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;JavaScriptServlet&lt;br&gt;<br>
Message-ID:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;CAPEPW-GC=&lt;a&nbsp;href=&quot;mailto:p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ@mail.gmail.com&quot;&gt;p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ@mail.gmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=&quot;iso-8859-1&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Hello,&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;have&nbsp;implemented&nbsp;the&nbsp;OWASP&nbsp;CSRF&nbsp;guard&nbsp;solution,&nbsp;all&nbsp;work&nbsp;properly&nbsp;like&nbsp;i&lt;br&gt;<br>
expect,&nbsp;but&nbsp;on&nbsp;other&nbsp;side,&nbsp;i&nbsp;got&nbsp;an&nbsp;exception&nbsp;in&nbsp;the&nbsp;logs:&lt;br&gt;<br>
&lt;br&gt;<br>
INFO&nbsp; &nbsp;|&nbsp;jvm&nbsp;1&nbsp; &nbsp; |&nbsp;main&nbsp; &nbsp; |&nbsp;2013/11/01&nbsp;16:44:02.760&nbsp;|&nbsp;nov.&nbsp;01,&nbsp;2013&lt;br&gt;<br>
4:44:02&nbsp;PM&nbsp;org.apache.catalina.core.StandardWrapperValve&nbsp;invoke&lt;br&gt;<br>
INFO&nbsp; &nbsp;|&nbsp;jvm&nbsp;1&nbsp; &nbsp; |&nbsp;main&nbsp; &nbsp; |&nbsp;2013/11/01&nbsp;16:44:02.803&nbsp;|&nbsp;SEVERE:&lt;br&gt;<br>
&quot;Servlet.service()&quot;&nbsp;pour&nbsp;la&nbsp;servlet&nbsp;JavaScriptServlet&nbsp;a&nbsp;g?n?r?&nbsp;une&nbsp;exception&lt;br&gt;<br>
INFO&nbsp; &nbsp;|&nbsp;jvm&nbsp;1&nbsp; &nbsp; |&nbsp;main&nbsp; &nbsp; |&nbsp;2013/11/01&nbsp;16:44:02.857&nbsp;|&lt;br&gt;<br>
java.lang.IllegalStateException&lt;br&gt;<br>
&lt;br&gt;<br>
After&nbsp;debugging,&nbsp;i&nbsp;found&nbsp;that&nbsp;the&nbsp;root&nbsp;exception&nbsp;happen&nbsp;in&nbsp;the&nbsp;method&lt;br&gt;<br>
writeJavaScript()&nbsp;when&nbsp;it&nbsp;try&nbsp;to&nbsp;close&nbsp;the&nbsp;outputStream&lt;br&gt;<br>
(Streams.close(output);):&nbsp;java.io.IOException:&nbsp;This&nbsp;output&nbsp;stream&nbsp;has&lt;br&gt;<br>
already&nbsp;been&nbsp;closed&lt;br&gt;<br>
&lt;br&gt;<br>
i&nbsp;would&nbsp;override&nbsp;this&nbsp;servlet&nbsp;to&nbsp;catch&nbsp;this&nbsp;exception,&nbsp;but&nbsp;it&nbsp;is&nbsp;a&nbsp;final&lt;br&gt;<br>
class.&lt;br&gt;<br>
&lt;br&gt;<br>
Anyone&nbsp;had&nbsp;an&nbsp;idea&nbsp;how&nbsp;to&nbsp;fix&nbsp;this&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Best&nbsp;regards.&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
--&lt;br&gt;<br>
Quoulali&nbsp;Younes&lt;br&gt;<br>
--------------&nbsp;next&nbsp;part&nbsp;--------------&lt;br&gt;<br>
An&nbsp;HTML&nbsp;attachment&nbsp;was&nbsp;scrubbed...&lt;br&gt;<br>
URL:&nbsp;&lt;&lt;a&nbsp;href=&quot;http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html&lt;/a&gt;&gt;&lt;br&gt;<br>
<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Owasp-csrfguard&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Owasp-csrfguard@lists.owasp.org&quot;&gt;Owasp-csrfguard@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
End&nbsp;of&nbsp;Owasp-csrfguard&nbsp;Digest,&nbsp;Vol&nbsp;39,&nbsp;Issue&nbsp;1&lt;br&gt;<br>
**********************************************&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
