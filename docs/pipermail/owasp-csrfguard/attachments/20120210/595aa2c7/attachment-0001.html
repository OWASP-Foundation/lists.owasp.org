<tt>
Hi&nbsp;Eric,&nbsp;Manish,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Even&nbsp;more.&nbsp;In&nbsp;our&nbsp;application&nbsp;we&nbsp;have&nbsp;need&nbsp;to&nbsp;protect&nbsp;mostly&nbsp;ajax&nbsp;requests,&nbsp;but&nbsp;rotate&nbsp;tokens&nbsp;(in&nbsp;&#39;master&#39;&nbsp;git&nbsp;code)&nbsp;doesn&#39;t&nbsp;make&nbsp;sense&nbsp;for&nbsp;ajax&nbsp;requests,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;support&nbsp;for&nbsp;different&nbsp;tokens&nbsp;for&nbsp;unique&nbsp;ajax&nbsp;requests&nbsp;(all&nbsp;ajax&nbsp;requests&nbsp;use&nbsp;the&nbsp;session&nbsp;token&nbsp;actually).&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;I&nbsp;extended&nbsp;logic&nbsp;to&nbsp;support&nbsp;tokenPerRequest&nbsp;(different&nbsp;tokens&nbsp;for&nbsp;each&nbsp;unique&nbsp;ajax&nbsp;request).&nbsp;This&nbsp;extension&nbsp;is&nbsp;still&nbsp;under&nbsp;development,&nbsp;but&nbsp;postponed&nbsp;as&nbsp;yet,&nbsp;because&nbsp;of&nbsp;the&nbsp;other&nbsp;tasks,&nbsp;I&nbsp;plan&nbsp;to&nbsp;finish&nbsp;changes&nbsp;and&nbsp;merge&nbsp;with&nbsp;trunk&nbsp;of&nbsp;our&nbsp;application&nbsp;this&nbsp;Spring.&nbsp;We&nbsp;plan&nbsp;to&nbsp;use&nbsp;most&nbsp;restrictive&nbsp;settings:&nbsp;token&nbsp;rotation,&nbsp;and&nbsp;tokenPerRequest.&nbsp;This&nbsp;allows&nbsp;to&nbsp;minimize&nbsp;attack&nbsp;window.&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Support&nbsp;unique&nbsp;tokens&nbsp;for&nbsp;ajax&nbsp;requests&nbsp;is&nbsp;very&nbsp;important&nbsp;in&nbsp;the&nbsp;light&nbsp;of&nbsp;Web&nbsp;2.0&nbsp;applications,&nbsp;where&nbsp;everything&nbsp;is&nbsp;ajax&nbsp;and&nbsp;javascript&nbsp;generation&nbsp;of&nbsp;the&nbsp;page&nbsp;rules. &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Also&nbsp;important&nbsp;feature&nbsp;is&nbsp;to&nbsp;protect&nbsp;only&nbsp;certain&nbsp;ajax&nbsp;requests,&nbsp;which&nbsp;is&nbsp;done&nbsp;now.&nbsp;Feature&nbsp;allows&nbsp;to&nbsp;define&nbsp;set&nbsp;of&nbsp;the&nbsp;parameter&nbsp;names&nbsp;and&nbsp;values&nbsp;of&nbsp;protected&nbsp;requests,&nbsp;so&nbsp;application&nbsp;definitely&nbsp;knows&nbsp;which&nbsp;requests&nbsp;to&nbsp;protect&nbsp;and&nbsp;which&nbsp;not&nbsp;(we&nbsp;have&nbsp;some&nbsp;read-only&nbsp;requests,&nbsp;which&nbsp;share&nbsp;resources&nbsp;and&nbsp;shouldn&#39;t&nbsp;be&nbsp;protected,&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;need&nbsp;for&nbsp;attaching&nbsp;token&nbsp;for&nbsp;them,&nbsp;increasing&nbsp;possibility&nbsp;for&nbsp;steal&nbsp;token).&lt;/div&gt;<br>
<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Anton.&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2012/2/10&nbsp;eric&nbsp;sheridan&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:eric.sheridan@owasp.org&quot;&nbsp;target=&quot;_blank&quot;&gt;eric.sheridan@owasp.org&lt;/a&gt;&gt;&lt;/span&gt;&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;<br>
<br>
<br>
I&#39;m&nbsp;actually&nbsp;not&nbsp;crazy&nbsp;about&nbsp;the&nbsp;token&nbsp;rotation&nbsp;feature.&nbsp;I&nbsp;wrote&nbsp;the&lt;br&gt;<br>
first&nbsp;iteration&nbsp;but&nbsp;it,&nbsp;coupled&nbsp;with&nbsp;the&nbsp;&#39;per&nbsp;page&nbsp;token&#39;&nbsp;feature,&lt;br&gt;<br>
seems&nbsp;to&nbsp;add&nbsp;more&nbsp;bandwidth&nbsp;to&nbsp;requests.&lt;br&gt;<br>
&lt;br&gt;<br>
Does&nbsp;anybody&nbsp;make&nbsp;use&nbsp;of&nbsp;either&nbsp;of&nbsp;these&nbsp;features&nbsp;and&nbsp;find&nbsp;them&lt;br&gt;<br>
valuable?&nbsp;Do&nbsp;you&nbsp;notice&nbsp;a&nbsp;spike&nbsp;in&nbsp;traffic?&lt;br&gt;<br>
&lt;br&gt;<br>
-Eric&lt;br&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;br&gt;<br>
On&nbsp;Tue,&nbsp;Jan&nbsp;31,&nbsp;2012&nbsp;at&nbsp;4:44&nbsp;PM,&nbsp;Manish&nbsp;Sharma&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:manish2aug@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;manish2aug@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&nbsp;Hi,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;implemented&nbsp;OWASP&nbsp;CSRF&nbsp;Gurad&nbsp;with&nbsp;my&nbsp;application,&nbsp;I&nbsp;have&nbsp;some&nbsp;queries,&nbsp;can&lt;br&gt;<br>
&gt;&nbsp;you&nbsp;please&nbsp;answer&nbsp;the&nbsp;following.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;1)&nbsp;I&nbsp;am&nbsp;disabling&nbsp;the&nbsp;Rotate&nbsp;feature&nbsp;so&nbsp;that&nbsp;the&nbsp;tokens&nbsp;wont&nbsp;be&nbsp;refreshed&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;session.&nbsp;Is&nbsp;it&nbsp;correct&nbsp;and&nbsp;will&nbsp;it&nbsp;not&nbsp;add&nbsp;any&nbsp;vulnerability&nbsp;?&lt;br&gt;<br>
&gt;&nbsp;2)&nbsp;As&nbsp;per&nbsp;the&nbsp;application&nbsp;we&nbsp;need&nbsp;to&nbsp;use&nbsp;the&nbsp;wild&nbsp;cards&nbsp;in&nbsp;our&nbsp;unprotected&lt;br&gt;<br>
&gt;&nbsp;pages&nbsp;list,&nbsp;so&nbsp;I&nbsp;made&nbsp;some&nbsp;changes&nbsp;to&nbsp;isUriMatched()&nbsp;method.&lt;br&gt;<br>
&gt;&nbsp;   &nbsp;I&nbsp;added&nbsp;the&nbsp;following&nbsp;piece&nbsp;of&nbsp;code&nbsp;in&nbsp;this&nbsp;method.&nbsp;Please&nbsp;verify&nbsp;and&nbsp;if&lt;br&gt;<br>
&gt;&nbsp;it&nbsp;is&nbsp;correct&nbsp;then&nbsp;can&nbsp;this&nbsp;piece&nbsp;of&nbsp;code&nbsp;can&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;CSRF&nbsp;Api&nbsp;in&lt;br&gt;<br>
&gt;&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;   &nbsp;coming&nbsp;version.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp; e.g.&lt;br&gt;<br>
&gt;&nbsp;/mobile-server/xhtml/user/*/slogin.xhtml&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;The&nbsp;page&nbsp;slogin.xhtml&nbsp;can&nbsp;be&nbsp;called&nbsp;in&nbsp;either&nbsp;way,&nbsp;but&nbsp;behind&nbsp;the&nbsp;scene&nbsp;same&lt;br&gt;<br>
&gt;&nbsp;jsp&nbsp;is&nbsp;called.&lt;br&gt;<br>
&gt;&nbsp;Following&nbsp;two&nbsp;different&nbsp;calls&nbsp;will&nbsp;invoke&nbsp;the&nbsp;same&nbsp;jsp.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;/s1mobile-server/xhtml/user/EP/slogin.xhtml&lt;br&gt;<br>
&gt;&nbsp;/s1mobile-server/xhtml/user/CID/slogin.xhtml&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Where&nbsp;EP&nbsp;and&nbsp;CID&nbsp;are&nbsp;branding&nbsp;group&nbsp;code&nbsp;which&nbsp;will&nbsp;be&nbsp;decided&nbsp;by&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;client.&lt;br&gt;<br>
&gt;&nbsp;To&nbsp;handle&nbsp;this&nbsp;I&nbsp;added&nbsp;the&nbsp;following&nbsp;code.&lt;br&gt;<br>
&gt;&nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;     &nbsp;Case&nbsp;0:&nbsp;Generic&nbsp;match&nbsp;using&nbsp;wild&nbsp;cards&lt;br&gt;<br>
&gt;&nbsp;     &nbsp;*/&lt;br&gt;<br>
&gt;&nbsp;     &nbsp;if(testPath.contains(&quot;/*/&quot;))&lt;br&gt;<br>
&gt;&nbsp;     &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;//&nbsp;Use&nbsp;of&nbsp;wild&nbsp;card&nbsp;to&nbsp;define&nbsp;a&nbsp;directory&nbsp;of&nbsp;any&nbsp;name&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;int&nbsp;index&nbsp;=&nbsp;testPath.indexOf(&quot;/*/&quot;);&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;String&nbsp;exactInitialTestPath&nbsp;=&nbsp;testPath.substring(0,index+1);&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;String&nbsp;newTestPath&nbsp;=&nbsp;testPath.substring(index+2);&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;if(index+1&gt;requestPath.length())&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;           &nbsp;return&nbsp;false;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;}&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;String&nbsp;exactInitialRequestPath&nbsp;=&nbsp;requestPath.substring(0,index+1);&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*&nbsp;Condition:&nbsp;In&nbsp;case&nbsp;if&nbsp;directory&nbsp;name&nbsp;is&nbsp;valid.&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*&nbsp;Check&nbsp;of&nbsp;initial&nbsp;part&nbsp;matching.&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*/&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;if(!exactInitialTestPath.equals(exactInitialRequestPath))&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;           &nbsp;return&nbsp;false;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;}&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;String&nbsp;remainingRequestPath&nbsp;=&nbsp;requestPath.substring(index+1);&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*&nbsp;Allowing&nbsp;the&nbsp;case&nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*/&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;if(remainingRequestPath.length()==1&nbsp;&amp;&amp;&lt;br&gt;<br>
&gt;&nbsp;remainingRequestPath.equals(&quot;*&quot;))&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;           &nbsp;return&nbsp;true;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;}&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;int&nbsp;dirIindex&nbsp;=&nbsp;remainingRequestPath.indexOf(&quot;/&quot;);&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*&nbsp;If&nbsp;no&nbsp;valid&nbsp;directory&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*/&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;if(dirIindex==-1)&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;           &nbsp;return&nbsp;false;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;}&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;String&nbsp;dirName&nbsp;=&nbsp;remainingRequestPath.substring(0,dirIindex);&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;if(dirIindex&gt;remainingRequestPath.length())&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;           &nbsp;return&nbsp;false;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;}&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;String&nbsp;newRequestPath&nbsp;=&nbsp;remainingRequestPath.substring(dirIindex);&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*&nbsp;Condition:&nbsp;Check&nbsp;for&nbsp;valid&nbsp;characters&nbsp;for&nbsp;a&nbsp;directory&nbsp;name&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*/&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;if(dirName.contains(&quot;/&quot;)&lt;br&gt;<br>
&gt;&nbsp;              &nbsp;||dirName.contains(&quot;:&quot;)||dirName.contains(&quot;*&quot;)&lt;br&gt;<br>
&gt;&nbsp;              &nbsp;||dirName.contains(&quot;?&quot;)||dirName.contains(&quot;\&quot;&quot;)&lt;br&gt;<br>
&gt;&nbsp;              &nbsp;||dirName.contains(&quot;&lt;&quot;)||dirName.contains(&quot;&gt;&quot;)&lt;br&gt;<br>
&gt;&nbsp;              &nbsp;||dirName.contains(&quot;|&quot;)||dirName.contains(&quot;&amp;&quot;)&lt;br&gt;<br>
&gt;&nbsp;              &nbsp;||dirName.contains(&quot;\\&quot;))&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;{&lt;br&gt;<br>
&gt;&nbsp;           &nbsp;return&nbsp;false;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;}&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;/*&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*&nbsp;Call&nbsp;this&nbsp;method&nbsp;again&nbsp;for&nbsp;checking&nbsp;the&nbsp;remaining&nbsp;part&nbsp;of&nbsp;the&lt;br&gt;<br>
&gt;&nbsp;request&nbsp;path.&lt;br&gt;<br>
&gt;&nbsp;         &nbsp;*/&lt;br&gt;<br>
&gt;&nbsp;        &nbsp;return&nbsp;isUriMatch(newTestPath,&nbsp;newRequestPath);&lt;br&gt;<br>
&gt;&nbsp;     &nbsp;}&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;-------------------------&lt;br&gt;<br>
&gt;&nbsp;Thanks&nbsp;&amp;&nbsp;Regards&lt;br&gt;<br>
&gt;&nbsp;Manish&nbsp;Kumar&lt;br&gt;<br>
&gt;&nbsp;|&nbsp;Mob:&nbsp;&lt;a&nbsp;href=&quot;tel:%2B27-742650187&quot;&nbsp;value=&quot;+27742650187&quot;&nbsp;target=&quot;_blank&quot;&gt;+27-742650187&lt;/a&gt;&nbsp;|&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:manish2aug@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;manish2aug@gmail.com&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;/div&gt;&gt;&nbsp;_______________________________________________&lt;br&gt;<br>
&gt;&nbsp;Owasp-csrfguard&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;mailto:Owasp-csrfguard@lists.owasp.org&quot;&nbsp;target=&quot;_blank&quot;&gt;Owasp-csrfguard@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&gt;&nbsp;&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&lt;/a&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Owasp-csrfguard&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Owasp-csrfguard@lists.owasp.org&quot;&nbsp;target=&quot;_blank&quot;&gt;Owasp-csrfguard@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-csrfguard&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
