<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] First implementation of csrfguard getting errors.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=%5BOwasp-csrfguard%5D%20First%20implementation%20of%20csrfguard%20getting%20errors.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000078.html">
   <LINK REL="Next"  HREF="000080.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] First implementation of csrfguard getting errors.</H1>
    <B>Steve Dittmann</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=%5BOwasp-csrfguard%5D%20First%20implementation%20of%20csrfguard%20getting%20errors.&In-Reply-To="
       TITLE="[Owasp-csrfguard] First implementation of csrfguard getting errors.">sdittm1 at gmail.com
       </A><BR>
    <I>Thu Aug 25 20:45:45 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000078.html">[Owasp-csrfguard] Latest CsrfGuard GA release
</A></li>
        <LI>Next message: <A HREF="000080.html">[Owasp-csrfguard] First implementation of csrfguard getting	errors.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79">[ date ]</a>
              <a href="thread.html#79">[ thread ]</a>
              <a href="subject.html#79">[ subject ]</a>
              <a href="author.html#79">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

This is my first attempt to implement csrfguard.

I've added the Owasp.CsrfGuard.jar to the WEB-INF\lib and
the Owasp.CsrfGuard.properties to the WEB-INF folder.

It also has been added to the classpath:

CLASSPATH=;contrib.jar;;:\bea\WLSERV~1.0\common\eval\pointbase\lib\pbclient51.jar;C:\bea\WLSERV~1.0\server\lib\xqrl.jar;C:\apps\GTS\d_whsldm\deploy\d_whsldm\sdd_local\lib\com.ibm.mq.jar;C:\apps\GTS\d_whsldm\deploy\d_whsldm\sdd_local\prop\log4j.properties;C:\apps\GTS\d_whsldm\deploy\d_whsldm\sdd_local\lib\Owasp.CsrfGuard.jar;

I'm receiving the below errors on my localhost when I attempt to access the
login page.


Cutoff Date is Wed Aug 24 17:22:47 PDT 2011
&lt;Aug 25, 2011 5:23:10 PM PDT&gt; &lt;Warning&gt; &lt;HTTP&gt; &lt;BEA-101162&gt; &lt;User defined
listener org.owasp.csrfguard.CsrfGuardListener failed:
java.lang.RuntimeException: java.lang.NullPointerException.
java.lang.RuntimeException: java.lang.NullPointerException
        at
org.owasp.csrfguard.CsrfGuardListener.newInstance(CsrfGuardListener.java:49)
        at
org.owasp.csrfguard.CsrfGuardListener.sessionCreated(CsrfGuardListener.java:24)
        at
weblogic.servlet.internal.EventsManager.notifySessionLifetimeEvent(EventsManager.java:257)
        at
weblogic.servlet.internal.session.MemorySessionData.&lt;init&gt;(MemorySessionData.java:10)
        at
weblogic.servlet.internal.session.MemorySessionContext.getNewSession(MemorySessionContext.java:28)
        Truncated. see log file for complete stacktrace
java.lang.NullPointerException
        at java.io.File.&lt;init&gt;(File.java:194)
        at
org.owasp.csrfguard.CsrfGuardListener.getResourceStream(CsrfGuardListener.java:72)
        at
org.owasp.csrfguard.CsrfGuardListener.newInstance(CsrfGuardListener.java:46)
        at
org.owasp.csrfguard.CsrfGuardListener.sessionCreated(CsrfGuardListener.java:24)
        at
weblogic.servlet.internal.EventsManager.notifySessionLifetimeEvent(EventsManager.java:257)
        Truncated. see log file for complete stacktrace
&gt;<i>
</I>&lt;Aug 25, 2011 5:23:10 PM PDT&gt; &lt;Error&gt; &lt;HTTP&gt; &lt;BEA-101020&gt;
&lt;[<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">weblogic.servlet.internal.WebAppServletContext at 19de9c9</A> - Servlet failed
with Exception
java.lang.NullPointerException
        at
org.owasp.csrfguard.CsrfGuardFilter.doFilter(CsrfGuardFilter.java:53)
        at
weblogic.servlet.internal.FilterChainImpl.doFilter(FilterChainImpl.java:42)
        at
weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.run(WebAppServletContext.java:3393)
        at
weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:321)
        at weblogic.security.service.SecurityManager.runAs(Unknown Source)
        Truncated. see log file for complete stacktrace


Below is the Web.xml:

&lt;web-app&gt;
&lt;display-name&gt;SDDWeb&lt;/display-name&gt;
 &lt;context-param&gt;
&lt;param-name&gt;Owasp.CsrfGuard.Config&lt;/param-name&gt;
&lt;param-value&gt;WEB-INF/Owasp.CsrfGuard.properties&lt;/param-value&gt;
&lt;/context-param&gt;
 &lt;context-param&gt;
&lt;param-name&gt;Owasp.CsrfGuard.Config.Print&lt;/param-name&gt;
&lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;
 &lt;listener&gt;
&lt;listener-class&gt;org.owasp.csrfguard.CsrfGuardListener&lt;/listener-class&gt;
&lt;/listener&gt;


&lt;filter&gt;
&lt;filter-name&gt;CSRFGuard&lt;/filter-name&gt;
&lt;filter-class&gt;org.owasp.csrfguard.CsrfGuardFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
&lt;filter-name&gt;CSRFGuard&lt;/filter-name&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;


&lt;filter&gt;
    &lt;filter-name&gt;SessionFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.sig.sdd.ui.utils.SddSessionFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
    &lt;param-name&gt;findSessionAttribute&lt;/param-name&gt;
    &lt;param-value&gt;user&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
    &lt;param-name&gt;message&lt;/param-name&gt;
    &lt;param-value&gt;error.session.expired&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
    &lt;param-name&gt;notFoundFoward&lt;/param-name&gt;
    &lt;param-value&gt;/sdd.do&lt;/param-value&gt;
    &lt;/init-param&gt;
   &lt;/filter&gt;
   &lt;filter-mapping&gt;
    &lt;filter-name&gt;SessionFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
   &lt;/filter-mapping&gt;
    &lt;filter-mapping&gt;
    &lt;filter-name&gt;SessionFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
   &lt;/filter-mapping&gt;
   &lt;listener&gt;
           &lt;listener-class&gt;
             com.sig.sdd.ui.utils.ReceiptListener
           &lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;listener&gt;

&lt;listener-class&gt;com.sig.sdd.ui.utils.DynaContentInitListener&lt;/listener-class&gt;
   &lt;/listener&gt;
  &lt;servlet&gt;
      &lt;servlet-name&gt;action&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.apache.struts.action.ActionServlet&lt;/servlet-class&gt;
      &lt;init-param&gt;
        &lt;param-name&gt;config&lt;/param-name&gt;
        &lt;param-value&gt;/WEB-INF/struts-config.xml&lt;/param-value&gt;
      &lt;/init-param&gt;
      &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;


    &lt;!-- Action Servlet Mapping --&gt;
    &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;action&lt;/servlet-name&gt;
      &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;AddressBook&lt;/servlet-name&gt;

&lt;servlet-class&gt;com.eXtropia.app.servlet.ExtropiaServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
          &lt;param-name&gt;ConfigFile&lt;/param-name&gt;
          &lt;param-value&gt;/WEB-INF/addressbook.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
         &lt;param-name&gt;Reloadable&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;display-name&gt;AddressBook&lt;/display-name&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
            &lt;servlet-name&gt;AddressBook&lt;/servlet-name&gt;
            &lt;url-pattern&gt;AddressBook&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;


    &lt;servlet&gt;
         &lt;servlet-name&gt;JavaScriptServlet&lt;/servlet-name&gt;

 &lt;servlet-class&gt;org.owasp.csrfguard.servlet.JavaScriptServlet&lt;/servlet-class&gt;
         &lt;init-param&gt;
             &lt;param-name&gt;source-file&lt;/param-name&gt;
             &lt;param-value&gt;WEB-INF/Owasp.CsrfGuard.js&lt;/param-value&gt;
         &lt;/init-param&gt;
         &lt;init-param&gt;
             &lt;param-name&gt;inject-into-forms&lt;/param-name&gt;
             &lt;param-value&gt;true&lt;/param-value&gt;
         &lt;/init-param&gt;
         &lt;init-param&gt;
             &lt;param-name&gt;inject-into-attributes&lt;/param-name&gt;
             &lt;param-value&gt;true&lt;/param-value&gt;
         &lt;/init-param&gt;
        &lt;init-param&gt;
             &lt;param-name&gt;domain-strict&lt;/param-name&gt;
             &lt;param-value&gt;false&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
             &lt;param-name&gt;referer-pattern&lt;/param-name&gt;
             &lt;param-value&gt;.*localhost.*&lt;/param-value&gt;
        &lt;/init-param&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
     &lt;servlet-name&gt;JavaScriptServlet&lt;/servlet-name&gt;
     &lt;url-pattern&gt;/JavaScriptServlet&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;


    &lt;!-- The Welcome File List --&gt;
    &lt;welcome-file-list&gt;
      &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;

    &lt;!-- Application Tag Library Descriptor --&gt;
    &lt;taglib&gt;
      &lt;taglib-uri&gt;/WEB-INF/app.tld&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/app.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

    &lt;!-- Struts Tag Library Descriptors --&gt;
    &lt;taglib&gt;
      &lt;taglib-uri&gt;/WEB-INF/struts-bean.tld&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/struts-bean.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

    &lt;taglib&gt;
      &lt;taglib-uri&gt;/WEB-INF/struts-html.tld&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/struts-html.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

    &lt;taglib&gt;
      &lt;taglib-uri&gt;/WEB-INF/struts-logic.tld&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/struts-logic.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

    &lt;taglib&gt;
      &lt;taglib-uri&gt;/view-taglib&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/view.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

    &lt;taglib&gt;
      &lt;taglib-uri&gt;/webdb-taglib&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/webdb.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

    &lt;taglib&gt;
      &lt;taglib-uri&gt;/auth-taglib&lt;/taglib-uri&gt;
      &lt;taglib-location&gt;/WEB-INF/auth.tld&lt;/taglib-location&gt;
    &lt;/taglib&gt;

  &lt;session-config&gt;
    &lt;session-timeout&gt;30&lt;/session-timeout&gt;
  &lt;/session-config&gt;
  &lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;error.jsp&lt;/location&gt;
  &lt;/error-page&gt;
  &lt;error-page&gt;
    &lt;error-code&gt;500&lt;/error-code&gt;
    &lt;location&gt;error.jsp&lt;/location&gt;
  &lt;/error-page&gt;
&lt;/web-app&gt;


Any ideas?

Thanks in advance.

Steve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20110825/cb67e32a/attachment.html">https://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20110825/cb67e32a/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000078.html">[Owasp-csrfguard] Latest CsrfGuard GA release
</A></li>
	<LI>Next message: <A HREF="000080.html">[Owasp-csrfguard] First implementation of csrfguard getting	errors.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#79">[ date ]</a>
              <a href="thread.html#79">[ thread ]</a>
              <a href="subject.html#79">[ subject ]</a>
              <a href="author.html#79">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
