<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] can't get it to work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20can%27t%20get%20it%20to%20work&In-Reply-To=%3C6EBBE0CE-B1CA-4A78-9521-A8091ECC717C%40allthisisthat.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000217.html">
   <LINK REL="Next"  HREF="000219.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] can't get it to work</H1>
    <B>Ray</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20can%27t%20get%20it%20to%20work&In-Reply-To=%3C6EBBE0CE-B1CA-4A78-9521-A8091ECC717C%40allthisisthat.com%3E"
       TITLE="[Owasp-csrfguard] can't get it to work">ray at allthisisthat.com
       </A><BR>
    <I>Mon Jul 22 14:56:58 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000217.html">[Owasp-csrfguard] can't get it to work
</A></li>
        <LI>Next message: <A HREF="000219.html">[Owasp-csrfguard] CSRFGuard problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#218">[ date ]</a>
              <a href="thread.html#218">[ thread ]</a>
              <a href="subject.html#218">[ subject ]</a>
              <a href="author.html#218">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you, Manish.  As I noted earlier, there are certainly issues with this problem which I don't understand.  One thing we will do is to customize some of our properties during build.  Of course, som expression language capability would be great, if possible without sacrificing security.  This is also true for some relaxation of the strictness of the URL rules,

Thanks again,
Ray Clough


On Jul 21, 2013, at 8:50 PM, &quot;Manish Java&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">manish.in.java at gmail.com</A>&gt; wrote:

&gt;<i> Hi Ray
</I>&gt;<i>  
</I>&gt;<i> I recently ported CSRFGuard from ANT to Maven build system and had the chance to go through the source code during the migration process.  Looking through the code I got the feeling that Eric Sheridan (the project lead for CSRFGuard) wanted CSRFGuard to be a completely standalone library that did not have any dependencies on any other libraries.  I felt this because I came across some classes and code snippets that are readily available in other common libraries, such as, Apache Commons.
</I>&gt;<i>  
</I>&gt;<i> I think that the design decision to keep CSRFGuard as a standalone library is not a bad one.  Creating dependencies on third-party code that has not been scanned for security vulnerabilities could be risky for a security related project like CSRFGuard.
</I>&gt;<i>  
</I>&gt;<i> Having said that, I also take your point about the expression handlers.  I will look through the source code this week to see whether this can be changed.  If I can find an easy way to get the changes in, I will liaise with Eric to see if a version upgrade can be released.
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> Best regards
</I>&gt;<i> ~ Manish
</I>&gt;<i>  
</I>&gt;<i> From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>] 
</I>&gt;<i> Sent: 18 July 2013 03:08
</I>&gt;<i> To: Manish Java
</I>&gt;<i> Cc: Clough_Ray_allthisisthat; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i>  
</I>&gt;<i> Thanks very much.  I got it going now.  Too bad Expression Language tags not allowed, and also would be nice to allow something like /myapp/something/*.xyz or 'myapp/*/*.xyz.  Then we could do /myapp/*/*.css, for example, to allow css coming from libraries to be allowed, but still not specifying *.css, which allows css from anywhere.  Same is true, of course for images and js, etc.  But we can't have everything, or at least so I've been told (and I always believe what people tell me).  Maybe there are good reasons for the strictness of the three allowed patterns which I don't yet understand.
</I>&gt;<i> 
</I>&gt;<i> - Ray Clough
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ---------------------------- Original Message ----------------------------
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> From: &quot;Manish Java&quot; 
</I>&gt;<i> Date: Tue, July 16, 2013 11:14 pm
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>
</I>&gt;<i> Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>
</I>&gt;<i> --------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> {C}
</I>&gt;<i> 
</I>&gt;<i> Hi Ray
</I>&gt;<i> 
</I>&gt;<i> I have found the following steps to be useful when working with CSRFGuard:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 1.      Find out the context root for the application (say, / or /myapp or /drbms in your case);
</I>&gt;<i> 
</I>&gt;<i> 2.      Decide on which resources you would like to protect;
</I>&gt;<i> 
</I>&gt;<i> 3.      Decide on which resources you do not need to protect (possibly images, CSS files, JavaScript files, plain HTML files, etc.);
</I>&gt;<i> 
</I>&gt;<i> 4.      First configure the unprotected resources in the CSRFGuard configuration file, using org.owasp.csrfguard.unprotected configuration directives.  Make sure that you prefix the URLs with the context root.  An example configuration is given below:
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.unprotected.CSS=/myapp/css/*
</I>&gt;<i> org.owasp.csrfguard.unprotected.HTML=/myapp/html/*
</I>&gt;<i> org.owasp.csrfguard.unprotected.Image=/myapp/image/*
</I>&gt;<i> org.owasp.csrfguard.unprotected.JavaScript=/myapp/script/*
</I>&gt;<i> org.owasp.csrfguard.unprotected.PDF=/myapp/pdf/*
</I>&gt;<i> 
</I>&gt;<i> 5.      Add configuration settings for the protected resources, as per application requirements.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> In our application we typically do the following:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 1.      Configure the application root (/) as the new token landing page.  All this does is to ensure that any malicious attacker looking to target a specific page in any possible way is automatically redirected to the application&#8217;s home page (/).  In our applications the home page either does not present any sensitive data or automatically redirects to the login page, depending on the application.
</I>&gt;<i> 
</I>&gt;<i> 2.      We typically leave the login page unprotected as many users of our applications are likely to bookmark the login page.  In any case, the login page does not have any sensitive information so it is fine to leave it unprotected.
</I>&gt;<i> 
</I>&gt;<i> 3.      Our CSRFGuard properties file is generated on a per-environment through our Maven build.  This allows us to use different context roots for different environments and frees us up from having to maintain separate properties files.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> If you have any further questions, please feel free to reply to this thread.  I will be happy to take a look at any issue you might be facing with CSRFGuard.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Cheers
</I>&gt;<i> 
</I>&gt;<i> ~ Manish
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Date: Wed, 17 Jul 2013 00:26:30 +0100
</I>&gt;<i> 
</I>&gt;<i> From: &quot;Tom Barber&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> To: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> 
</I>&gt;<i> Subject: Re: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i> Message-ID: &lt;004f01ce827b$e779f1c0$b66dd540$@gmail.com&gt;
</I>&gt;<i> 
</I>&gt;<i> Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;<i> 
</I>&gt;<i> Hi Ray, Glad that helped!
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> # Case 2: longest path prefix match, beginning / and ending /*
</I>&gt;<i> 
</I>&gt;<i> So in the example you provided, that would be:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> &quot;/img/*&quot;
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> This unprotects all files within the img directory. Another option would be
</I>&gt;<i> 
</I>&gt;<i> for:
</I>&gt;<i> 
</I>&gt;<i> # Case 3: extension match, beginning *.
</I>&gt;<i> 
</I>&gt;<i> &quot;*.gif&quot; for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Good luck!
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Tom
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>]
</I>&gt;<i> 
</I>&gt;<i> Sent: 16 July 2013 23:30
</I>&gt;<i> 
</I>&gt;<i> To: Tom Barber
</I>&gt;<i> 
</I>&gt;<i> Cc: Clough_Ray_allthisisthat; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> 
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> You Rule!  It does indeed work, but now all my requests for images, css, etc all fail with missing token messages.  I tried adding the config property org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif, error:required token is missing from the request).  What am I missing now?
</I>&gt;<i> 
</I>&gt;<i> Any ideas?
</I>&gt;<i> 
</I>&gt;<i> Also, I am now leaving the login page unprotected, which can't be a very good idea.  Is there a better method using the NewTokenLandingPage?  I still have that config setting, but it never goes there.  Should the NewTokenLandingPage redirect to the login page, or what does it do?  There isn't much discussion of this in the documentation, AFAIK.
</I>&gt;<i> 
</I>&gt;<i> Thanks very much for the help so far - there was some danger of me going berserk, which is now receding into the distance.
</I>&gt;<i> 
</I>&gt;<i> - Ray Clough
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> ---------------------------- Original Message ----------------------------
</I>&gt;<i> 
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i> From: &quot;Tom Barber&quot;
</I>&gt;<i> 
</I>&gt;<i> Date: Tue, July 16, 2013 2:30 pm
</I>&gt;<i> 
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> --------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> {C}
</I>&gt;<i> 
</I>&gt;<i> Hi Ray,
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I'm not certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> # Case 1: exact match between request uri and unprotected page
</I>&gt;<i> 
</I>&gt;<i> # Case 2: longest path prefix match, beginning / and ending /*
</I>&gt;<i> 
</I>&gt;<i> # Case 3: extension match, beginning *.
</I>&gt;<i> 
</I>&gt;<i> # Default: requested resource must be validated by CSRFGuard
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> In your case you seem to have used wildcard in an unsupported manner &quot;/login*&quot; . Perhaps you could specify the exact uri &quot;drbms/login.seam&quot;
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Let me know if you have any luck.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Tom
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [ &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>
</I>&gt;<i> 
</I>&gt;<i> Sent: 16 July 2013 21:44
</I>&gt;<i> 
</I>&gt;<i> To:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> 
</I>&gt;<i> Subject: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I am unable to get the CsrfGuard filter to work.  Regardless of the properties I set, the app tries to go to the login page, and I get this log
</I>&gt;<i> 
</I>&gt;<i> message:
</I>&gt;<i> 
</I>&gt;<i> [Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery
</I>&gt;<i> 
</I>&gt;<i> (CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)
</I>&gt;<i> 
</I>&gt;<i> Obviously I am doing something wrong.  Here is my configuration file
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.UseNewTokenLandingPage=true
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenPerPage=true
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenPerPagePrecreate=false
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.Ajax=false
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.unprotected.Index=/login*
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery
</I>&gt;<i> 
</I>&gt;<i> (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,
</I>&gt;<i> 
</I>&gt;<i> error:%exception_message%)
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenLength=32
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.PRNG=SHA1PRNG
</I>&gt;<i> 
</I>&gt;<i> When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.
</I>&gt;<i> 
</I>&gt;<i> I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page but not using a New Token Landing Page.  Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.  Is that correct?  Also, all the examples use jsp, not facelets.  Are there any issues with this difference?  I built the project from source using the latest code.
</I>&gt;<i> 
</I>&gt;<i> Any help you could offer would be greatly appreciated.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Thank you,
</I>&gt;<i> 
</I>&gt;<i> Ray Clough
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> -------------- next part --------------
</I>&gt;<i> 
</I>&gt;<i> An HTML attachment was scrubbed...
</I>&gt;<i> 
</I>&gt;<i> URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> ------------------------------
</I>&gt;<i> 
</I>&gt;<i> Message: 2
</I>&gt;<i> 
</I>&gt;<i> Date: Wed, 17 Jul 2013 00:58:23 +0100
</I>&gt;<i> 
</I>&gt;<i> From: &quot;Tom Barber&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> To: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> 
</I>&gt;<i> Subject: Re: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i> Message-ID: &lt;000401ce8280$5bbed1a0$133c74e0$@gmail.com&gt;
</I>&gt;<i> 
</I>&gt;<i> Content-Type: text/plain; charset=&quot;us-ascii&quot;
</I>&gt;<i> 
</I>&gt;<i> P.S. I meant &quot;/drbms/img/*&quot; - I found that you usually need to include the context root
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From: Tom Barber [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>]
</I>&gt;<i> 
</I>&gt;<i> Sent: 17 July 2013 00:27
</I>&gt;<i> 
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>
</I>&gt;<i> 
</I>&gt;<i> Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> 
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Hi Ray, Glad that helped!
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> # Case 2: longest path prefix match, beginning / and ending /*
</I>&gt;<i> 
</I>&gt;<i> So in the example you provided, that would be:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> &quot;/img/*&quot;
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> This unprotects all files within the img directory. Another option would be
</I>&gt;<i> 
</I>&gt;<i> for:
</I>&gt;<i> 
</I>&gt;<i> # Case 3: extension match, beginning *.
</I>&gt;<i> 
</I>&gt;<i> &quot;*.gif&quot; for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Good luck!
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Tom
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>]
</I>&gt;<i> 
</I>&gt;<i> Sent: 16 July 2013 23:30
</I>&gt;<i> 
</I>&gt;<i> To: Tom Barber
</I>&gt;<i> 
</I>&gt;<i> Cc: Clough_Ray_allthisisthat; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> You Rule!  It does indeed work, but now all my requests for images, css, etc
</I>&gt;<i> 
</I>&gt;<i> all fail with missing token messages.  I tried adding the config property
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a
</I>&gt;<i> 
</I>&gt;<i> ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack
</I>&gt;<i> 
</I>&gt;<i> thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif,
</I>&gt;<i> 
</I>&gt;<i> error:required token is missing from the request).  What am I missing now?
</I>&gt;<i> 
</I>&gt;<i> Any ideas?
</I>&gt;<i> 
</I>&gt;<i> Also, I am now leaving the login page unprotected, which can't be a very
</I>&gt;<i> 
</I>&gt;<i> good idea.  Is there a better method using the NewTokenLandingPage?  I still
</I>&gt;<i> 
</I>&gt;<i> have that config setting, but it never goes there.  Should the
</I>&gt;<i> 
</I>&gt;<i> NewTokenLandingPage redirect to the login page, or what does it do?  There
</I>&gt;<i> 
</I>&gt;<i> isn't much discussion of this in the documentation, AFAIK.
</I>&gt;<i> 
</I>&gt;<i> Thanks very much for the help so far - there was some danger of me going
</I>&gt;<i> 
</I>&gt;<i> berserk, which is now receding into the distance.
</I>&gt;<i> 
</I>&gt;<i> - Ray Clough
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> ---------------------------- Original Message ----------------------------
</I>&gt;<i> 
</I>&gt;<i> Subject: RE: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i> From: &quot;Tom Barber&quot;
</I>&gt;<i> 
</I>&gt;<i> Date: Tue, July 16, 2013 2:30 pm
</I>&gt;<i> 
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> --------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> {C}
</I>&gt;<i> 
</I>&gt;<i> Hi Ray,
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I'm not certain this is the case, but I believe I know the problem. If you
</I>&gt;<i> 
</I>&gt;<i> look at the comments above the unprotected section of the property files the
</I>&gt;<i> 
</I>&gt;<i> options it gives you are:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> # Case 1: exact match between request uri and unprotected page
</I>&gt;<i> 
</I>&gt;<i> # Case 2: longest path prefix match, beginning / and ending /*
</I>&gt;<i> 
</I>&gt;<i> # Case 3: extension match, beginning *.
</I>&gt;<i> 
</I>&gt;<i> # Default: requested resource must be validated by CSRFGuard
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> In your case you seem to have used wildcard in an unsupported manner
</I>&gt;<i> 
</I>&gt;<i> &quot;/login*&quot; . Perhaps you could specify the exact uri &quot;drbms/login.seam&quot;
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Let me know if you have any luck.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Tom
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> From:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [
</I>&gt;<i> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of
</I>&gt;<i> 
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>
</I>&gt;<i> 
</I>&gt;<i> Sent: 16 July 2013 21:44
</I>&gt;<i> 
</I>&gt;<i> To:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> 
</I>&gt;<i> Subject: [Owasp-csrfguard] can't get it to work
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> I am unable to get the CsrfGuard filter to work.  Regardless of the
</I>&gt;<i> 
</I>&gt;<i> properties I set, the app tries to go to the login page, and I get this log
</I>&gt;<i> 
</I>&gt;<i> message:
</I>&gt;<i> 
</I>&gt;<i> [Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery
</I>&gt;<i> 
</I>&gt;<i> (CSRF) attack thwarted (user:, ip:127.0.0.1,
</I>&gt;<i> 
</I>&gt;<i> uri:/drbms/login.seam, error:required token is missing from the request)
</I>&gt;<i> 
</I>&gt;<i> Obviously I am doing something wrong.  Here is my configuration file
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.UseNewTokenLandingPage=true
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenPerPage=true
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenPerPagePrecreate=false
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.Ajax=false
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.unprotected.Index=/login*
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery
</I>&gt;<i> 
</I>&gt;<i> (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,
</I>&gt;<i> 
</I>&gt;<i> error:%exception_message%)
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.TokenLength=32
</I>&gt;<i> 
</I>&gt;<i> org.owasp.csrfguard.PRNG=SHA1PRNG
</I>&gt;<i> 
</I>&gt;<i> When the server starts, I see the config properties output to the console,
</I>&gt;<i> 
</I>&gt;<i> so I know the config file is being read correctly.
</I>&gt;<i> 
</I>&gt;<i> I have tried various combinations of using a NewTokenLandingPage with the
</I>&gt;<i> 
</I>&gt;<i> login page protected, and un-protecting the login page but not using a New
</I>&gt;<i> 
</I>&gt;<i> Token Landing Page.  Also, I have seen no info on what the New Token Landing
</I>&gt;<i> 
</I>&gt;<i> Page needs to do - If I can ever get it to appear, my guess is that it needs
</I>&gt;<i> 
</I>&gt;<i> to redirect to the login page.  Is that correct?  Also, all the examples use
</I>&gt;<i> 
</I>&gt;<i> jsp, not facelets.  Are there any issues with this difference?  I built the
</I>&gt;<i> 
</I>&gt;<i> project from source using the latest code.
</I>&gt;<i> 
</I>&gt;<i> Any help you could offer would be greatly appreciated.
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Thank you,
</I>&gt;<i> 
</I>&gt;<i> Ray Clough
</I>&gt;<i> 
</I>&gt;<i>  
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130722/558d8a40/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130722/558d8a40/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000217.html">[Owasp-csrfguard] can't get it to work
</A></li>
	<LI>Next message: <A HREF="000219.html">[Owasp-csrfguard] CSRFGuard problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#218">[ date ]</a>
              <a href="thread.html#218">[ thread ]</a>
              <a href="subject.html#218">[ subject ]</a>
              <a href="author.html#218">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
