<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] can't get it to work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20can%27t%20get%20it%20to%20work&In-Reply-To=%3C002e01ce826b%24bb843b80%24328cb280%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000212.html">
   <LINK REL="Next"  HREF="000214.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] can't get it to work</H1>
    <B>Tom Barber</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20can%27t%20get%20it%20to%20work&In-Reply-To=%3C002e01ce826b%24bb843b80%24328cb280%24%40gmail.com%3E"
       TITLE="[Owasp-csrfguard] can't get it to work">tom.a.barber at gmail.com
       </A><BR>
    <I>Tue Jul 16 21:30:45 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000212.html">[Owasp-csrfguard] can't get it to work
</A></li>
        <LI>Next message: <A HREF="000214.html">[Owasp-csrfguard] can't get it to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#213">[ date ]</a>
              <a href="thread.html#213">[ thread ]</a>
              <a href="subject.html#213">[ subject ]</a>
              <a href="author.html#213">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ray,

 

I&#8217;m not certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner &#8220;/login*&#8221; . Perhaps you could specify the exact uri &#8220;drbms/login.seam&#8221;

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>
Sent: 16 July 2013 21:44
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the properties I set, the app tries to go to the login page, and I get this log message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:&lt;anonymous&gt;, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
org.owasp.csrfguard.UseNewTokenLandingPage=true
org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
org.owasp.csrfguard.TokenPerPage=true
org.owasp.csrfguard.TokenPerPagePrecreate=false
org.owasp.csrfguard.Ajax=false
org.owasp.csrfguard.unprotected.Index=/login*
org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%, error:%exception_message%)
org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
org.owasp.csrfguard.TokenLength=32
org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page but not using a New Token Landing Page.  Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.  Is that correct?  Also, all the examples use jsp, not facelets.  Are there any issues with this difference?  I built the project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130716/2d29d98c/attachment.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130716/2d29d98c/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000212.html">[Owasp-csrfguard] can't get it to work
</A></li>
	<LI>Next message: <A HREF="000214.html">[Owasp-csrfguard] can't get it to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#213">[ date ]</a>
              <a href="thread.html#213">[ thread ]</a>
              <a href="subject.html#213">[ subject ]</a>
              <a href="author.html#213">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
