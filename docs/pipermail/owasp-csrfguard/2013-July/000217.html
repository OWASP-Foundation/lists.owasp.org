<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] can't get it to work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20can%27t%20get%20it%20to%20work&In-Reply-To=%3C003901ce8341%2484212280%248c636780%24%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000216.html">
   <LINK REL="Next"  HREF="000218.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] can't get it to work</H1>
    <B>Tom Barber</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20can%27t%20get%20it%20to%20work&In-Reply-To=%3C003901ce8341%2484212280%248c636780%24%40gmail.com%3E"
       TITLE="[Owasp-csrfguard] can't get it to work">tom.a.barber at gmail.com
       </A><BR>
    <I>Wed Jul 17 23:01:03 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000216.html">[Owasp-csrfguard] can't get it to work
</A></li>
        <LI>Next message: <A HREF="000218.html">[Owasp-csrfguard] can't get it to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#217">[ date ]</a>
              <a href="thread.html#217">[ thread ]</a>
              <a href="subject.html#217">[ subject ]</a>
              <a href="author.html#217">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yeah, I&#8217;ve thought the same. The only reason I found out about the precise required nature of the expressions was through trying to do the same as you.

 

Glad you got it up and running ok.

 

Tom

 

From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>] 
Sent: 17 July 2013 22:38
To: Manish Java
Cc: Clough_Ray_allthisisthat; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>
Subject: RE: [Owasp-csrfguard] can't get it to work

 

Thanks very much.  I got it going now.  Too bad Expression Language tags not allowed, and also would be nice to allow something like /myapp/something/*.xyz or 'myapp/*/*.xyz.  Then we could do /myapp/*/*.css, for example, to allow css coming from libraries to be allowed, but still not specifying *.css, which allows css from anywhere.  Same is true, of course for images and js, etc.  But we can't have everything, or at least so I've been told (and I always believe what people tell me).  Maybe there are good reasons for the strictness of the three allowed patterns which I don't yet understand.

- Ray Clough


---------------------------- Original Message ----------------------------
Subject: RE: [Owasp-csrfguard] can't get it to work
From: &quot;Manish Java&quot; 
Date: Tue, July 16, 2013 11:14 pm
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; 
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; 
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt; 
--------------------------------------------------------------------------

{C}

Hi Ray

I have found the following steps to be useful when working with CSRFGuard:

 

1.      Find out the context root for the application (say, / or /myapp or /drbms in your case);

2.      Decide on which resources you would like to protect;

3.      Decide on which resources you do not need to protect (possibly images, CSS files, JavaScript files, plain HTML files, etc.);

4.      First configure the unprotected resources in the CSRFGuard configuration file, using org.owasp.csrfguard.unprotected configuration directives.  Make sure that you prefix the URLs with the context root.  An example configuration is given below:

org.owasp.csrfguard.unprotected.CSS=/myapp/css/*
org.owasp.csrfguard.unprotected.HTML=/myapp/html/*
org.owasp.csrfguard.unprotected.Image=/myapp/image/*
org.owasp.csrfguard.unprotected.JavaScript=/myapp/script/*
org.owasp.csrfguard.unprotected.PDF=/myapp/pdf/*

5.      Add configuration settings for the protected resources, as per application requirements.

 

In our application we typically do the following:

 

1.      Configure the application root (/) as the new token landing page.  All this does is to ensure that any malicious attacker looking to target a specific page in any possible way is automatically redirected to the application&#8217;s home page (/).  In our applications the home page either does not present any sensitive data or automatically redirects to the login page, depending on the application.

2.      We typically leave the login page unprotected as many users of our applications are likely to bookmark the login page.  In any case, the login page does not have any sensitive information so it is fine to leave it unprotected.

3.      Our CSRFGuard properties file is generated on a per-environment through our Maven build.  This allows us to use different context roots for different environments and frees us up from having to maintain separate properties files.

 

If you have any further questions, please feel free to reply to this thread.  I will be happy to take a look at any issue you might be facing with CSRFGuard.

 

Cheers

~ Manish

 

Date: Wed, 17 Jul 2013 00:26:30 +0100

From: &quot;Tom Barber&quot; &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt;

To: &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;

Cc:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>

Subject: Re: [Owasp-csrfguard] can't get it to work

Message-ID: &lt; &lt;mailto:004f01ce827b$e779f1c0$b66dd540$@gmail.com&gt; 004f01ce827b$e779f1c0$b66dd540$@gmail.com&gt;

Content-Type: text/plain; charset=&quot;us-ascii&quot;

Hi Ray, Glad that helped!

 

I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:

 

# Case 2: longest path prefix match, beginning / and ending /*

So in the example you provided, that would be:

 

&quot;/img/*&quot;

 

This unprotects all files within the img directory. Another option would be

for:

# Case 3: extension match, beginning *.

&quot;*.gif&quot; for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.

 

As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)

 

Good luck!

 

Tom

 

From:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> [ &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>]

Sent: 16 July 2013 23:30

To: Tom Barber

Cc: Clough_Ray_allthisisthat;  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>

Subject: RE: [Owasp-csrfguard] can't get it to work

 

You Rule!  It does indeed work, but now all my requests for images, css, etc all fail with missing token messages.  I tried adding the config property org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif, error:required token is missing from the request).  What am I missing now?

Any ideas?

Also, I am now leaving the login page unprotected, which can't be a very good idea.  Is there a better method using the NewTokenLandingPage?  I still have that config setting, but it never goes there.  Should the NewTokenLandingPage redirect to the login page, or what does it do?  There isn't much discussion of this in the documentation, AFAIK.

Thanks very much for the help so far - there was some danger of me going berserk, which is now receding into the distance.

- Ray Clough

 

 

---------------------------- Original Message ----------------------------

Subject: RE: [Owasp-csrfguard] can't get it to work

From: &quot;Tom Barber&quot; 

Date: Tue, July 16, 2013 2:30 pm

To:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;

--------------------------------------------------------------------------

{C} 

Hi Ray,

 

I'm not certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner &quot;/login*&quot; . Perhaps you could specify the exact uri &quot;drbms/login.seam&quot;

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From:  &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [ &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>

Sent: 16 July 2013 21:44

To:  &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>

Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the properties I set, the app tries to go to the login page, and I get this log

message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger

org.owasp.csrfguard.UseNewTokenLandingPage=true

org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html

org.owasp.csrfguard.TokenPerPage=true

org.owasp.csrfguard.TokenPerPagePrecreate=false

org.owasp.csrfguard.Ajax=false

org.owasp.csrfguard.unprotected.Index=/login*

org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log

org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,

error:%exception_message%)

org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN

org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN

org.owasp.csrfguard.TokenLength=32

org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page but not using a New Token Landing Page.  Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.  Is that correct?  Also, all the examples use jsp, not facelets.  Are there any issues with this difference?  I built the project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

 

-------------- next part --------------

An HTML attachment was scrubbed...

URL: &lt; &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html</A>&gt; <A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html</A>&gt;

------------------------------

Message: 2

Date: Wed, 17 Jul 2013 00:58:23 +0100

From: &quot;Tom Barber&quot; &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt;

To: &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;

Cc:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>

Subject: Re: [Owasp-csrfguard] can't get it to work

Message-ID: &lt; &lt;mailto:000401ce8280$5bbed1a0$133c74e0$@gmail.com&gt; 000401ce8280$5bbed1a0$133c74e0$@gmail.com&gt;

Content-Type: text/plain; charset=&quot;us-ascii&quot;

P.S. I meant &quot;/drbms/img/*&quot; - I found that you usually need to include the context root 

 

From: Tom Barber [ &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">tom.a.barber at gmail.com</A>]

Sent: 17 July 2013 00:27

To:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>

Cc:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>

Subject: RE: [Owasp-csrfguard] can't get it to work

 

Hi Ray, Glad that helped!

 

I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:

 

# Case 2: longest path prefix match, beginning / and ending /*

So in the example you provided, that would be:

 

&quot;/img/*&quot;

 

This unprotects all files within the img directory. Another option would be

for:

# Case 3: extension match, beginning *.

&quot;*.gif&quot; for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.

 

As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)

 

Good luck!

 

Tom

 

From:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; [ &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>]

Sent: 16 July 2013 23:30

To: Tom Barber

Cc: Clough_Ray_allthisisthat;  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;

Subject: RE: [Owasp-csrfguard] can't get it to work

 

You Rule!  It does indeed work, but now all my requests for images, css, etc

all fail with missing token messages.  I tried adding the config property

org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a

ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack

thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif,

error:required token is missing from the request).  What am I missing now?

Any ideas?

Also, I am now leaving the login page unprotected, which can't be a very

good idea.  Is there a better method using the NewTokenLandingPage?  I still

have that config setting, but it never goes there.  Should the

NewTokenLandingPage redirect to the login page, or what does it do?  There

isn't much discussion of this in the documentation, AFAIK.

Thanks very much for the help so far - there was some danger of me going

berserk, which is now receding into the distance.

- Ray Clough

 

 

---------------------------- Original Message ----------------------------

Subject: RE: [Owasp-csrfguard] can't get it to work

From: &quot;Tom Barber&quot; 

Date: Tue, July 16, 2013 2:30 pm

To:  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A> &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; 

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A> &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; 

--------------------------------------------------------------------------

{C} 

Hi Ray,

 

I'm not certain this is the case, but I believe I know the problem. If you

look at the comments above the unprotected section of the property files the

options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner

&quot;/login*&quot; . Perhaps you could specify the exact uri &quot;drbms/login.seam&quot;

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From:  &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [

&lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt;

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of

&lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt;  &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ray at allthisisthat.com</A>

Sent: 16 July 2013 21:44

To:  &lt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt;

 &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>

Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the

properties I set, the app tries to go to the login page, and I get this log

message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:, ip:127.0.0.1,

uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger

org.owasp.csrfguard.UseNewTokenLandingPage=true

org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html

org.owasp.csrfguard.TokenPerPage=true

org.owasp.csrfguard.TokenPerPagePrecreate=false

org.owasp.csrfguard.Ajax=false

org.owasp.csrfguard.unprotected.Index=/login*

org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log

org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,

error:%exception_message%)

org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN

org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN

org.owasp.csrfguard.TokenLength=32

org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console,

so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the

login page protected, and un-protecting the login page but not using a New

Token Landing Page.  Also, I have seen no info on what the New Token Landing

Page needs to do - If I can ever get it to appear, my guess is that it needs

to redirect to the login page.  Is that correct?  Also, all the examples use

jsp, not facelets.  Are there any issues with this difference?  I built the

project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130718/a07dbd38/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130718/a07dbd38/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000216.html">[Owasp-csrfguard] can't get it to work
</A></li>
	<LI>Next message: <A HREF="000218.html">[Owasp-csrfguard] can't get it to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#217">[ date ]</a>
              <a href="thread.html#217">[ thread ]</a>
              <a href="subject.html#217">[ subject ]</a>
              <a href="author.html#217">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
