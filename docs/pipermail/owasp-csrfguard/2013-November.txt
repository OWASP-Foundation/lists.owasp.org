From yquoulali at gmail.com  Fri Nov  1 17:58:30 2013
From: yquoulali at gmail.com (younes quoulali)
Date: Fri, 1 Nov 2013 17:58:30 +0000
Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
	JavaScriptServlet
Message-ID: <CAPEPW-GC=p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ@mail.gmail.com>

Hello,

I have implemented the OWASP CSRF guard solution, all work properly like i
expect, but on other side, i got an exception in the logs:

INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
"Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une exception
INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
java.lang.IllegalStateException

After debugging, i found that the root exception happen in the method
writeJavaScript() when it try to close the outputStream
(Streams.close(output);): java.io.IOException: This output stream has
already been closed

i would override this servlet to catch this exception, but it is a final
class.

Anyone had an idea how to fix this ?


Best regards.


--
Quoulali Younes
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment.html>

From yquoulali at gmail.com  Mon Nov  4 09:27:39 2013
From: yquoulali at gmail.com (younes quoulali)
Date: Mon, 4 Nov 2013 09:27:39 +0000
Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
	JavaScriptServlet
In-Reply-To: <04BE669BEE19E54BBDC2A9A2585BB6886CE75F7A@exch-mbx01.exchange.upenn.edu>
References: <CAPEPW-GC=p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ@mail.gmail.com>
	<04BE669BEE19E54BBDC2A9A2585BB6886CE75F7A@exch-mbx01.exchange.upenn.edu>
Message-ID: <CAPEPW-G3Pydaa5F5d80VcgZmnUzH=KQnY6TRh-c1o5NtH7RA6Q@mail.gmail.com>

Hello Chris,

I attached the web.xml and csrfguard properties.

Thank you
Best Regards.


2013/11/1 Chris Hyzer <mchyzer at isc.upenn.edu>

>  Might want to post a sanitized version of your web.xml and csrfguard
> properties config?
>
>
>
> Thanks,
>
> Chris
>
>
>
> *From:* owasp-csrfguard-bounces at lists.owasp.org [mailto:
> owasp-csrfguard-bounces at lists.owasp.org] *On Behalf Of *younes quoulali
> *Sent:* Friday, November 01, 2013 1:59 PM
> *To:* owasp-csrfguard at lists.owasp.org
> *Subject:* [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
> JavaScriptServlet
>
>
>
> Hello,
>
>
>
> I have implemented the OWASP CSRF guard solution, all work properly like i
> expect, but on other side, i got an exception in the logs:
>
>
>
> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
> 4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
>
> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
> "Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une exception
>
> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
> java.lang.IllegalStateException
>
>
>
> After debugging, i found that the root exception happen in the method
> writeJavaScript() when it try to close the outputStream
> (Streams.close(output);): java.io.IOException: This output stream has
> already been closed
>
>
>
> i would override this servlet to catch this exception, but it is a final
> class.
>
>
>
> Anyone had an idea how to fix this ?
>
>
>
>
>
> Best regards.
>
>
>
>
>
> --
>
> Quoulali Younes
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131104/bcd4a552/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: web.xml
Type: text/xml
Size: 15877 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131104/bcd4a552/attachment-0001.xml>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Owasp.CsrfGuard.properties
Type: application/octet-stream
Size: 15723 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131104/bcd4a552/attachment-0001.obj>

From manish.in.java at gmail.com  Tue Nov  5 12:06:21 2013
From: manish.in.java at gmail.com (Manish Java)
Date: Tue, 5 Nov 2013 17:36:21 +0530
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
In-Reply-To: <mailman.21.1383393604.6041.owasp-csrfguard@lists.owasp.org>
References: <mailman.21.1383393604.6041.owasp-csrfguard@lists.owasp.org>
Message-ID: <CAFQ4Oy3jwYoaJ7_QGxpxQ=GXHKTauxE1CHmRaWOU2ftWQjtOOg@mail.gmail.com>

Hi Younes

I have been using CSRFGuard for a while now and haven't faced this problem.
 From your first post I believe you are using Apache Tomcat, which is what
we use for our application as well so our usage seems to be the same as
yours.

I have looked through the code for the JavaScript servlet and do not see
any obvious reason why you should be getting the reported error.  Could you
help out by providing the following details:



   1. Java version you are using.
   2. Tomcat version you are using.
   3. Complete stack trace for the error, including all logged causes.
   4. Whether you get the error all the time or only in some instances.  If
   only occasionally, any steps to reproduce the error would be good.


Cheers
~ Manish


On Sat, Nov 2, 2013 at 5:30 PM, <owasp-csrfguard-request at lists.owasp.org>wrote:

> Send Owasp-csrfguard mailing list submissions to
>         owasp-csrfguard at lists.owasp.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> or, via email, send a message with subject or body 'help' to
>         owasp-csrfguard-request at lists.owasp.org
>
> You can reach the person managing the list at
>         owasp-csrfguard-owner at lists.owasp.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-csrfguard digest..."
>
>
> Today's Topics:
>
>    1. OWASP-CSRF Guard - Probleme with the      JavaScriptServlet
>       (younes quoulali)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Fri, 1 Nov 2013 17:58:30 +0000
> From: younes quoulali <yquoulali at gmail.com>
> To: owasp-csrfguard at lists.owasp.org
> Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
>         JavaScriptServlet
> Message-ID:
>         <CAPEPW-GC=
> p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ at mail.gmail.com>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Hello,
>
> I have implemented the OWASP CSRF guard solution, all work properly like i
> expect, but on other side, i got an exception in the logs:
>
> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
> 4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
> "Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une
> exception
> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
> java.lang.IllegalStateException
>
> After debugging, i found that the root exception happen in the method
> writeJavaScript() when it try to close the outputStream
> (Streams.close(output);): java.io.IOException: This output stream has
> already been closed
>
> i would override this servlet to catch this exception, but it is a final
> class.
>
> Anyone had an idea how to fix this ?
>
>
> Best regards.
>
>
> --
> Quoulali Younes
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html
> >
>
> ------------------------------
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>
> End of Owasp-csrfguard Digest, Vol 39, Issue 1
> **********************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131105/2b87c2c9/attachment.html>

From azzeddine.ramrami at owasp.org  Tue Nov  5 18:50:03 2013
From: azzeddine.ramrami at owasp.org (OWASP)
Date: Tue, 5 Nov 2013 19:50:03 +0100
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
Message-ID: <52793ddd.b3bbb40a.511f.54fd@mx.google.com>

Hi Younes,
I am Azzeddine RAMRAMI the CSRFGuard project leader.
I mentioned by Manish please provide all informations and I will investigate to solve your issue:

:



1. Java version
2.Tomcat version you are using.
3.Complete stack trace for the error or a copy of the log files.
Thanks.
Azzeddine

-----Original Message-----
From: Manish Java
Sent: 05/11/2013 13:07
To: owasp-csrfguard at lists.owasp.org; yquoulali at gmail.com
Subject: Re: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1

Hi Younes



I have been using CSRFGuard for a while now and haven't faced this problem.  From your first post I believe you are using Apache Tomcat, which is what we use for our application as well so our usage seems to be the same as yours.
 



I have looked through the code for the JavaScript servlet and do not see any obvious reason why you should be getting the reported error.  Could you help out by providing the following details:

 





Java version you are using.
Tomcat version you are using.
Complete stack trace for the error, including all logged causes.
Whether you get the error all the time or only in some instances.  If only occasionally, any steps to reproduce the error would be good.
 



Cheers

~ Manish




On Sat, Nov 2, 2013 at 5:30 PM, <owasp-csrfguard-request at lists.owasp.org> wrote:
 
Send Owasp-csrfguard mailing list submissions to
         owasp-csrfguard at lists.owasp.org
 
To subscribe or unsubscribe via the World Wide Web, visit
         https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
 or, via email, send a message with subject or body 'help' to
         owasp-csrfguard-request at lists.owasp.org
 
You can reach the person managing the list at
         owasp-csrfguard-owner at lists.owasp.org
 
When replying, please edit your Subject line so it is more specific
 than "Re: Contents of Owasp-csrfguard digest..."
 

Today's Topics:
 
   1. OWASP-CSRF Guard - Probleme with the      JavaScriptServlet
       (younes quoulali)
 

----------------------------------------------------------------------
 
Message: 1
 Date: Fri, 1 Nov 2013 17:58:30 +0000
 From: younes quoulali <yquoulali at gmail.com>
 To: owasp-csrfguard at lists.owasp.org
 Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
         JavaScriptServlet
 Message-ID:
         <CAPEPW-GC=p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ at mail.gmail.com>
 Content-Type: text/plain; charset="iso-8859-1"
 
Hello,
 
I have implemented the OWASP CSRF guard solution, all work properly like i
 expect, but on other side, i got an exception in the logs:
 
INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
 4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
 INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
 "Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une exception
 INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
 java.lang.IllegalStateException
 
After debugging, i found that the root exception happen in the method
 writeJavaScript() when it try to close the outputStream
 (Streams.close(output);): java.io.IOException: This output stream has
 already been closed
 
i would override this servlet to catch this exception, but it is a final
 class.
 
Anyone had an idea how to fix this ?
 

Best regards.
 

--
 Quoulali Younes
 -------------- next part --------------
 An HTML attachment was scrubbed...
 URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html>

 ------------------------------
 
_______________________________________________
 Owasp-csrfguard mailing list
 Owasp-csrfguard at lists.owasp.org
 https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
 

End of Owasp-csrfguard Digest, Vol 39, Issue 1
 **********************************************
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131105/68a24aef/attachment.html>

From yquoulali at gmail.com  Thu Nov  7 09:37:13 2013
From: yquoulali at gmail.com (younes quoulali)
Date: Thu, 7 Nov 2013 09:37:13 +0000
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
In-Reply-To: <52793ddd.b3bbb40a.511f.54fd@mx.google.com>
References: <52793ddd.b3bbb40a.511f.54fd@mx.google.com>
Message-ID: <CAPEPW-HBuOhBx96YosuGLgkQoCBZwMO4d1vspdPqCdPsWE_8hA@mail.gmail.com>

Hello,

Thanks for your reply. Sorry to not reply in the time, because it was a
holiday here.

For information i go this error on an Hybris platform on tomcat6 server.

Thes are my settings (extracted from the console logs):

Cluster:     disabled
Tenant:      master
OS:          Windows 7 6.1, amd64
Database:    Pool: hybris - oracle, table prefix:
DUMP - jdbc:oracle:thin:@10.42.0.28:1521:testdatabase
Platform:    4.8.0
Java:       Oracle Corporation
              Java(TM) SE Runtime Environment, 1.7.0_21-b11
C:\Program Files\Java\jdk1.7.0_21\jre
VM Locale:   language=fr,country=FR,region=null
Server type: tomcat

The log does not contain a detailled trace, the "java.io.IOException: This
output stream has already been closed" i got it by debuging the
JavascriptServlet int the writeJavaScript()  method when it try to close
the outputStream (Streams.close(output);):

This is the exceotion got in logs:

INFO   | jvm 1    | main    | 2013/11/04 16:20:21.545 | nov. 04, 2013
4:20:21 PM org.apache.catalina.core.StandardWrapperValve invoke
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.546 | SEVERE:
"Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une exception
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.548 |
java.lang.IllegalStateException
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.549 | at
org.apache.catalina.connector.ResponseFacade.sendRedirect(ResponseFacade.java:435)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.551 | at
com.citadium.ecom.web.filters.ExceptionManager.error(ExceptionManager.java:47)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.553 | at
com.citadium.ecom.web.filters.UnexpectedExceptionManagerFilter.doFilterInternal(UnexpectedExceptionManagerFilter.java:35)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.570 | at
org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.573 | at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.578 | at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.591 | at
org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.595 | at
org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.597 | at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.599 | at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.687 | at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.689 | at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.690 | at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.692 | at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.693 | at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.707 | at
org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:615)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.712 | at
org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.731 | at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:859)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.734 | at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:602)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.736 | at
org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:396)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.789 | at
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.791 | at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.793 | at
java.lang.Thread.run(Thread.java:722)

Thanks
Best regards.


2013/11/5 OWASP <azzeddine.ramrami at owasp.org>

> Hi Younes,
> I am Azzeddine RAMRAMI the CSRFGuard project leader.
> I mentioned by Manish please provide all informations and I will
> investigate to solve your issue:
>
> :
>
>
>
> 1. Java version
> 2.Tomcat version you are using.
> 3.Complete stack trace for the error or a copy of the log files.
> Thanks.
> Azzeddine
> ------------------------------
> From: Manish Java
> Sent: 05/11/2013 13:07
> To: owasp-csrfguard at lists.owasp.org; yquoulali at gmail.com
> Subject: Re: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
>
>
> Hi Younes
>
> I have been using CSRFGuard for a while now and haven't faced this
> problem.  From your first post I believe you are using Apache Tomcat, which
> is what we use for our application as well so our usage seems to be the
> same as yours.
>
> I have looked through the code for the JavaScript servlet and do not see
> any obvious reason why you should be getting the reported error.  Could you
> help out by providing the following details:
>
>
>
>    1. Java version you are using.
>    2. Tomcat version you are using.
>    3. Complete stack trace for the error, including all logged causes.
>    4. Whether you get the error all the time or only in some instances.
>     If only occasionally, any steps to reproduce the error would be good.
>
>
> Cheers
> ~ Manish
>
>
> On Sat, Nov 2, 2013 at 5:30 PM, <owasp-csrfguard-request at lists.owasp.org>wrote:
>
>> Send Owasp-csrfguard mailing list submissions to
>>         owasp-csrfguard at lists.owasp.org
>>
>> To subscribe or unsubscribe via the World Wide Web, visit
>>         https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>> or, via email, send a message with subject or body 'help' to
>>         owasp-csrfguard-request at lists.owasp.org
>>
>> You can reach the person managing the list at
>>         owasp-csrfguard-owner at lists.owasp.org
>>
>> When replying, please edit your Subject line so it is more specific
>> than "Re: Contents of Owasp-csrfguard digest..."
>>
>>
>> Today's Topics:
>>
>>    1. OWASP-CSRF Guard - Probleme with the      JavaScriptServlet
>>       (younes quoulali)
>>
>>
>> ----------------------------------------------------------------------
>>
>> Message: 1
>> Date: Fri, 1 Nov 2013 17:58:30 +0000
>> From: younes quoulali <yquoulali at gmail.com>
>> To: owasp-csrfguard at lists.owasp.org
>> Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
>>         JavaScriptServlet
>> Message-ID:
>>         <CAPEPW-GC=
>> p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ at mail.gmail.com>
>> Content-Type: text/plain; charset="iso-8859-1"
>>
>> Hello,
>>
>> I have implemented the OWASP CSRF guard solution, all work properly like i
>> expect, but on other side, i got an exception in the logs:
>>
>> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
>> 4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
>> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
>> "Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une
>> exception
>> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
>> java.lang.IllegalStateException
>>
>> After debugging, i found that the root exception happen in the method
>> writeJavaScript() when it try to close the outputStream
>> (Streams.close(output);): java.io.IOException: This output stream has
>> already been closed
>>
>> i would override this servlet to catch this exception, but it is a final
>> class.
>>
>> Anyone had an idea how to fix this ?
>>
>>
>> Best regards.
>>
>>
>> --
>> Quoulali Younes
>> -------------- next part --------------
>> An HTML attachment was scrubbed...
>> URL: <
>> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html
>> >
>>
>> ------------------------------
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
>>
>> End of Owasp-csrfguard Digest, Vol 39, Issue 1
>> **********************************************
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131107/8528fb2e/attachment.html>

From azzeddine.ramrami at owasp.org  Thu Nov  7 21:52:22 2013
From: azzeddine.ramrami at owasp.org (Azzeddine Ramrami)
Date: Thu, 7 Nov 2013 22:52:22 +0100
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
In-Reply-To: <CAPEPW-HBuOhBx96YosuGLgkQoCBZwMO4d1vspdPqCdPsWE_8hA@mail.gmail.com>
References: <52793ddd.b3bbb40a.511f.54fd@mx.google.com>
	<CAPEPW-HBuOhBx96YosuGLgkQoCBZwMO4d1vspdPqCdPsWE_8hA@mail.gmail.com>
Message-ID: <CAL4seLFAjCi3TfwwaOApP1+RHEy0NUGO2Cz6XBq3yBHTXfGgiQ@mail.gmail.com>

Hi Younes,
I prefer to help you using skype for example.
My skype ID is azzeddine.ramrami
Thanks.
Azzeddine


On Thu, Nov 7, 2013 at 10:37 AM, younes quoulali <yquoulali at gmail.com>wrote:

> Hello,
>
> Thanks for your reply. Sorry to not reply in the time, because it was a
> holiday here.
>
> For information i go this error on an Hybris platform on tomcat6 server.
>
> Thes are my settings (extracted from the console logs):
>
> Cluster:     disabled
> Tenant:      master
> OS:          Windows 7 6.1, amd64
> Database:    Pool: hybris - oracle, table prefix:
> DUMP - jdbc:oracle:thin:@10.42.0.28:1521:testdatabase
> Platform:    4.8.0
> Java:       Oracle Corporation
>               Java(TM) SE Runtime Environment, 1.7.0_21-b11
> C:\Program Files\Java\jdk1.7.0_21\jre
> VM Locale:   language=fr,country=FR,region=null
> Server type: tomcat
>
> The log does not contain a detailled trace, the "java.io.IOException: This
> output stream has already been closed" i got it by debuging the
> JavascriptServlet int the writeJavaScript()  method when it try to close
> the outputStream (Streams.close(output);):
>
> This is the exceotion got in logs:
>
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.545 | nov. 04, 2013
> 4:20:21 PM org.apache.catalina.core.StandardWrapperValve invoke
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.546 | SEVERE:
> "Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une exception
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.548 |
> java.lang.IllegalStateException
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.549 | at
> org.apache.catalina.connector.ResponseFacade.sendRedirect(ResponseFacade.java:435)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.551 | at
> com.citadium.ecom.web.filters.ExceptionManager.error(ExceptionManager.java:47)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.553 | at
> com.citadium.ecom.web.filters.UnexpectedExceptionManagerFilter.doFilterInternal(UnexpectedExceptionManagerFilter.java:35)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.570 | at
> org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.573 | at
> org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.578 | at
> org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.591 | at
> org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.595 | at
> org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.597 | at
> org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.599 | at
> org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.687 | at
> org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.689 | at
> org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.690 | at
> org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.692 | at
> org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.693 | at
> org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.707 | at
> org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:615)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.712 | at
> org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.731 | at
> org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:859)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.734 | at
> org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:602)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.736 | at
> org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:396)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.789 | at
> java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.791 | at
> java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
> INFO   | jvm 1    | main    | 2013/11/04 16:20:21.793 | at
> java.lang.Thread.run(Thread.java:722)
>
> Thanks
> Best regards.
>
>
> 2013/11/5 OWASP <azzeddine.ramrami at owasp.org>
>
>> Hi Younes,
>> I am Azzeddine RAMRAMI the CSRFGuard project leader.
>> I mentioned by Manish please provide all informations and I will
>> investigate to solve your issue:
>>
>> :
>>
>>
>>
>> 1. Java version
>> 2.Tomcat version you are using.
>> 3.Complete stack trace for the error or a copy of the log files.
>> Thanks.
>> Azzeddine
>> ------------------------------
>> From: Manish Java
>> Sent: 05/11/2013 13:07
>> To: owasp-csrfguard at lists.owasp.org; yquoulali at gmail.com
>> Subject: Re: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
>>
>>
>> Hi Younes
>>
>> I have been using CSRFGuard for a while now and haven't faced this
>> problem.  From your first post I believe you are using Apache Tomcat, which
>> is what we use for our application as well so our usage seems to be the
>> same as yours.
>>
>> I have looked through the code for the JavaScript servlet and do not see
>> any obvious reason why you should be getting the reported error.  Could you
>> help out by providing the following details:
>>
>>
>>
>>    1. Java version you are using.
>>    2. Tomcat version you are using.
>>    3. Complete stack trace for the error, including all logged causes.
>>    4. Whether you get the error all the time or only in some instances.
>>     If only occasionally, any steps to reproduce the error would be good.
>>
>>
>> Cheers
>> ~ Manish
>>
>>
>> On Sat, Nov 2, 2013 at 5:30 PM, <owasp-csrfguard-request at lists.owasp.org>wrote:
>>
>>> Send Owasp-csrfguard mailing list submissions to
>>>         owasp-csrfguard at lists.owasp.org
>>>
>>> To subscribe or unsubscribe via the World Wide Web, visit
>>>         https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>> or, via email, send a message with subject or body 'help' to
>>>         owasp-csrfguard-request at lists.owasp.org
>>>
>>> You can reach the person managing the list at
>>>         owasp-csrfguard-owner at lists.owasp.org
>>>
>>> When replying, please edit your Subject line so it is more specific
>>> than "Re: Contents of Owasp-csrfguard digest..."
>>>
>>>
>>> Today's Topics:
>>>
>>>    1. OWASP-CSRF Guard - Probleme with the      JavaScriptServlet
>>>       (younes quoulali)
>>>
>>>
>>> ----------------------------------------------------------------------
>>>
>>> Message: 1
>>> Date: Fri, 1 Nov 2013 17:58:30 +0000
>>> From: younes quoulali <yquoulali at gmail.com>
>>> To: owasp-csrfguard at lists.owasp.org
>>> Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
>>>         JavaScriptServlet
>>> Message-ID:
>>>         <CAPEPW-GC=
>>> p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ at mail.gmail.com>
>>> Content-Type: text/plain; charset="iso-8859-1"
>>>
>>> Hello,
>>>
>>> I have implemented the OWASP CSRF guard solution, all work properly like
>>> i
>>> expect, but on other side, i got an exception in the logs:
>>>
>>> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
>>> 4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
>>> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
>>> "Servlet.service()" pour la servlet JavaScriptServlet a g?n?r? une
>>> exception
>>> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
>>> java.lang.IllegalStateException
>>>
>>> After debugging, i found that the root exception happen in the method
>>> writeJavaScript() when it try to close the outputStream
>>> (Streams.close(output);): java.io.IOException: This output stream has
>>> already been closed
>>>
>>> i would override this servlet to catch this exception, but it is a final
>>> class.
>>>
>>> Anyone had an idea how to fix this ?
>>>
>>>
>>> Best regards.
>>>
>>>
>>> --
>>> Quoulali Younes
>>> -------------- next part --------------
>>> An HTML attachment was scrubbed...
>>> URL: <
>>> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html
>>> >
>>>
>>> ------------------------------
>>>
>>> _______________________________________________
>>> Owasp-csrfguard mailing list
>>> Owasp-csrfguard at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>>
>>>
>>> End of Owasp-csrfguard Digest, Vol 39, Issue 1
>>> **********************************************
>>>
>>
>>
>


-- 
Azzeddine RAMRAMI
+33 6 65 48 90 04.
Enterprise Security Architect
OWASP Leader (Morocco Chapter)
Mozilla Security Projects Mentor
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131107/7cb7004e/attachment.html>

From PKhambayatkar at Fiberlink.com  Fri Nov  8 08:56:31 2013
From: PKhambayatkar at Fiberlink.com (Pranav Khambayatkar)
Date: Fri, 8 Nov 2013 03:56:31 -0500
Subject: [Owasp-csrfguard] Need help with CSRFGuard3 library usage
Message-ID: <CEA2A517.65AAD%pkhambayatkar@fiberlink.com>

Hi All,
First of all thanks for this library. I am trying to integrate it for the web application running on tomcat and built using Spring 2.5.6.

I am getting an issue to get this working for a landing page which itself uses ajax and href/src links while loading.
And JavaScriptServlet gets called on load of the window. Hence, I get CSRF attacks initially and then on load, tokens get injected using JavaScriptServlet and it reloads again.

Can you provide some help regarding this as it should not reload and should be able to inject tokens dynamically while load? Anything else I am missing?

Thanks in advance,
Pranav

________________________________
Fiberlink Disclaimer: The information transmitted is intended only for the person or entity to which it is addressed and may contain confidential and/or privileged material. Any review, retransmission, dissemination or other use of, or taking of any action in reliance upon, this information by persons or entities other than the intended recipient is prohibited. If you received this in error, please contact the sender and delete the material from any computer.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131108/b579aa68/attachment-0001.html>

