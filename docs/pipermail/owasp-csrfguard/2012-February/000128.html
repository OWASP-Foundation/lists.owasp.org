<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Please%20Suggest%3B%0A%20Is%20disabling%20the%20Rotate%20feature%20correct%3F%20How%20to%20pass%20wild%20cards%20in%0A%20unprotected%20page%20list%3F&In-Reply-To=%3CCAGzcv2Yvyy%2Bh0w6jN20Vvto4%2B5son9CKGNeNfc2ahAHCAB_-rw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000124.html">
   <LINK REL="Next"  HREF="000130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?</H1>
    <B>Anton Fomin</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Please%20Suggest%3B%0A%20Is%20disabling%20the%20Rotate%20feature%20correct%3F%20How%20to%20pass%20wild%20cards%20in%0A%20unprotected%20page%20list%3F&In-Reply-To=%3CCAGzcv2Yvyy%2Bh0w6jN20Vvto4%2B5son9CKGNeNfc2ahAHCAB_-rw%40mail.gmail.com%3E"
       TITLE="[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?">afomin at jaspersoft.com
       </A><BR>
    <I>Fri Feb 10 15:41:41 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000124.html">[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
</A></li>
        <LI>Next message: <A HREF="000130.html">[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#128">[ date ]</a>
              <a href="thread.html#128">[ thread ]</a>
              <a href="subject.html#128">[ subject ]</a>
              <a href="author.html#128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Eric, Manish,

Even more. In our application we have need to protect mostly ajax requests,
but rotate tokens (in 'master' git code) doesn't make sense for ajax
requests, because there is no support for different tokens for unique ajax
requests (all ajax requests use the session token actually).

So I extended logic to support tokenPerRequest (different tokens for each
unique ajax request). This extension is still under development, but
postponed as yet, because of the other tasks, I plan to finish changes and
merge with trunk of our application this Spring. We plan to use most
restrictive settings: token rotation, and tokenPerRequest. This allows to
minimize attack window.

Support unique tokens for ajax requests is very important in the light of
Web 2.0 applications, where everything is ajax and javascript generation of
the page rules.

Also important feature is to protect only certain ajax requests, which is
done now. Feature allows to define set of the parameter names and values of
protected requests, so application definitely knows which requests to
protect and which not (we have some read-only requests, which share
resources and shouldn't be protected, so there is no need for attaching
token for them, increasing possibility for steal token).

Anton.

2012/2/10 eric sheridan &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">eric.sheridan at owasp.org</A>&gt;

&gt;<i> I'm actually not crazy about the token rotation feature. I wrote the
</I>&gt;<i> first iteration but it, coupled with the 'per page token' feature,
</I>&gt;<i> seems to add more bandwidth to requests.
</I>&gt;<i>
</I>&gt;<i> Does anybody make use of either of these features and find them
</I>&gt;<i> valuable? Do you notice a spike in traffic?
</I>&gt;<i>
</I>&gt;<i> -Eric
</I>&gt;<i>
</I>&gt;<i> On Tue, Jan 31, 2012 at 4:44 PM, Manish Sharma &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">manish2aug at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Hi,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I implemented OWASP CSRF Gurad with my application, I have some queries,
</I>&gt;<i> can
</I>&gt;<i> &gt; you please answer the following.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) I am disabling the Rotate feature so that the tokens wont be
</I>&gt;<i> refreshed in
</I>&gt;<i> &gt; session. Is it correct and will it not add any vulnerability ?
</I>&gt;<i> &gt; 2) As per the application we need to use the wild cards in our
</I>&gt;<i> unprotected
</I>&gt;<i> &gt; pages list, so I made some changes to isUriMatched() method.
</I>&gt;<i> &gt;     I added the following piece of code in this method. Please verify
</I>&gt;<i> and if
</I>&gt;<i> &gt; it is correct then can this piece of code can be added to the CSRF Api in
</I>&gt;<i> &gt; the
</I>&gt;<i> &gt;     coming version.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  e.g.
</I>&gt;<i> &gt; /mobile-server/xhtml/user/*/slogin.xhtml
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The page slogin.xhtml can be called in either way, but behind the scene
</I>&gt;<i> same
</I>&gt;<i> &gt; jsp is called.
</I>&gt;<i> &gt; Following two different calls will invoke the same jsp.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; /s1mobile-server/xhtml/user/EP/slogin.xhtml
</I>&gt;<i> &gt; /s1mobile-server/xhtml/user/CID/slogin.xhtml
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Where EP and CID are branding group code which will be decided by the
</I>&gt;<i> &gt; client.
</I>&gt;<i> &gt; To handle this I added the following code.
</I>&gt;<i> &gt; /*
</I>&gt;<i> &gt;       Case 0: Generic match using wild cards
</I>&gt;<i> &gt;       */
</I>&gt;<i> &gt;       if(testPath.contains(&quot;/*/&quot;))
</I>&gt;<i> &gt;       {
</I>&gt;<i> &gt;          // Use of wild card to define a directory of any name
</I>&gt;<i> &gt;          int index = testPath.indexOf(&quot;/*/&quot;);
</I>&gt;<i> &gt;          String exactInitialTestPath = testPath.substring(0,index+1);
</I>&gt;<i> &gt;          String newTestPath = testPath.substring(index+2);
</I>&gt;<i> &gt;          if(index+1&gt;requestPath.length())
</I>&gt;<i> &gt;          {
</I>&gt;<i> &gt;             return false;
</I>&gt;<i> &gt;          }
</I>&gt;<i> &gt;          String exactInitialRequestPath =
</I>&gt;<i> requestPath.substring(0,index+1);
</I>&gt;<i> &gt;          /*
</I>&gt;<i> &gt;           * Condition: In case if directory name is valid.
</I>&gt;<i> &gt;           * Check of initial part matching.
</I>&gt;<i> &gt;           */
</I>&gt;<i> &gt;          if(!exactInitialTestPath.equals(exactInitialRequestPath))
</I>&gt;<i> &gt;          {
</I>&gt;<i> &gt;             return false;
</I>&gt;<i> &gt;          }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;          String remainingRequestPath = requestPath.substring(index+1);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;          /*
</I>&gt;<i> &gt;           * Allowing the case /*
</I>&gt;<i> &gt;           */
</I>&gt;<i> &gt;          if(remainingRequestPath.length()==1 &amp;&amp;
</I>&gt;<i> &gt; remainingRequestPath.equals(&quot;*&quot;))
</I>&gt;<i> &gt;          {
</I>&gt;<i> &gt;             return true;
</I>&gt;<i> &gt;          }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;          int dirIindex = remainingRequestPath.indexOf(&quot;/&quot;);
</I>&gt;<i> &gt;          /*
</I>&gt;<i> &gt;           * If no valid directory
</I>&gt;<i> &gt;           */
</I>&gt;<i> &gt;          if(dirIindex==-1)
</I>&gt;<i> &gt;          {
</I>&gt;<i> &gt;             return false;
</I>&gt;<i> &gt;          }
</I>&gt;<i> &gt;          String dirName = remainingRequestPath.substring(0,dirIindex);
</I>&gt;<i> &gt;          if(dirIindex&gt;remainingRequestPath.length())
</I>&gt;<i> &gt;          {
</I>&gt;<i> &gt;             return false;
</I>&gt;<i> &gt;          }
</I>&gt;<i> &gt;          String newRequestPath =
</I>&gt;<i> remainingRequestPath.substring(dirIindex);
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;          /*
</I>&gt;<i> &gt;           * Condition: Check for valid characters for a directory name
</I>&gt;<i> &gt;           */
</I>&gt;<i> &gt;          if(dirName.contains(&quot;/&quot;)
</I>&gt;<i> &gt;                ||dirName.contains(&quot;:&quot;)||dirName.contains(&quot;*&quot;)
</I>&gt;<i> &gt;                ||dirName.contains(&quot;?&quot;)||dirName.contains(&quot;\&quot;&quot;)
</I>&gt;<i> &gt;                ||dirName.contains(&quot;&lt;&quot;)||dirName.contains(&quot;&gt;&quot;)
</I>&gt;<i> &gt;                ||dirName.contains(&quot;|&quot;)||dirName.contains(&quot;&amp;&quot;)
</I>&gt;<i> &gt;                ||dirName.contains(&quot;\\&quot;))
</I>&gt;<i> &gt;          {
</I>&gt;<i> &gt;             return false;
</I>&gt;<i> &gt;          }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;          /*
</I>&gt;<i> &gt;           * Call this method again for checking the remaining part of the
</I>&gt;<i> &gt; request path.
</I>&gt;<i> &gt;           */
</I>&gt;<i> &gt;          return isUriMatch(newTestPath, newRequestPath);
</I>&gt;<i> &gt;       }
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -------------------------
</I>&gt;<i> &gt; Thanks &amp; Regards
</I>&gt;<i> &gt; Manish Kumar
</I>&gt;<i> &gt; | Mob: +27-742650187 |
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">manish2aug at gmail.com</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Owasp-csrfguard mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;<i> &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-csrfguard mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120210/595aa2c7/attachment.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120210/595aa2c7/attachment.html</A>&gt;
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000124.html">[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
</A></li>
	<LI>Next message: <A HREF="000130.html">[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#128">[ date ]</a>
              <a href="thread.html#128">[ thread ]</a>
              <a href="subject.html#128">[ subject ]</a>
              <a href="author.html#128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
