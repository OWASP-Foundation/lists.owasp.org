<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Please%20Suggest%3B%0A%20Is%20disabling%20the%20Rotate%20feature%20correct%3F%20How%20to%20pass%20wild%20cards%20in%0A%20unprotected%20page%20list%3F&In-Reply-To=%3CCAOaxbhJh_hZCx8jGgQiuNip6szu5asYpXMVte9fgXCNTRvtFHg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000133.html">
   <LINK REL="Next"  HREF="000128.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?</H1>
    <B>eric sheridan</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Please%20Suggest%3B%0A%20Is%20disabling%20the%20Rotate%20feature%20correct%3F%20How%20to%20pass%20wild%20cards%20in%0A%20unprotected%20page%20list%3F&In-Reply-To=%3CCAOaxbhJh_hZCx8jGgQiuNip6szu5asYpXMVte9fgXCNTRvtFHg%40mail.gmail.com%3E"
       TITLE="[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?">eric.sheridan at owasp.org
       </A><BR>
    <I>Fri Feb 10 15:15:35 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="000133.html">[Owasp-csrfguard] Bug/new feature request
</A></li>
        <LI>Next message: <A HREF="000128.html">[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#124">[ date ]</a>
              <a href="thread.html#124">[ thread ]</a>
              <a href="subject.html#124">[ subject ]</a>
              <a href="author.html#124">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm actually not crazy about the token rotation feature. I wrote the
first iteration but it, coupled with the 'per page token' feature,
seems to add more bandwidth to requests.

Does anybody make use of either of these features and find them
valuable? Do you notice a spike in traffic?

-Eric

On Tue, Jan 31, 2012 at 4:44 PM, Manish Sharma &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">manish2aug at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I implemented OWASP CSRF Gurad with my application, I have some queries, can
</I>&gt;<i> you please answer the following.
</I>&gt;<i>
</I>&gt;<i> 1) I am disabling the Rotate feature so that the tokens wont be refreshed in
</I>&gt;<i> session. Is it correct and will it not add any vulnerability ?
</I>&gt;<i> 2) As per the application we need to use the wild cards in our unprotected
</I>&gt;<i> pages list, so I made some changes to isUriMatched() method.
</I>&gt;<i> &#160;&#160;&#160; I added the following piece of code in this method. Please verify and if
</I>&gt;<i> it is correct then can this piece of code can be added to the CSRF Api in
</I>&gt;<i> the
</I>&gt;<i> &#160;&#160;&#160; coming version.
</I>&gt;<i>
</I>&gt;<i> &#160;e.g.
</I>&gt;<i> /mobile-server/xhtml/user/*/slogin.xhtml
</I>&gt;<i>
</I>&gt;<i> The page slogin.xhtml can be called in either way, but behind the scene same
</I>&gt;<i> jsp is called.
</I>&gt;<i> Following two different calls will invoke the same jsp.
</I>&gt;<i>
</I>&gt;<i> /s1mobile-server/xhtml/user/EP/slogin.xhtml
</I>&gt;<i> /s1mobile-server/xhtml/user/CID/slogin.xhtml
</I>&gt;<i>
</I>&gt;<i> Where EP and CID are branding group code which will be decided by the
</I>&gt;<i> client.
</I>&gt;<i> To handle this I added the following code.
</I>&gt;<i> /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; Case 0: Generic match using wild cards
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; */
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; if(testPath.contains(&quot;/*/&quot;))
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; // Use of wild card to define a directory of any name
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; int index = testPath.indexOf(&quot;/*/&quot;);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String exactInitialTestPath = testPath.substring(0,index+1);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String newTestPath = testPath.substring(index+2);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(index+1&gt;requestPath.length())
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return false;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String exactInitialRequestPath = requestPath.substring(0,index+1);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Condition: In case if directory name is valid.
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Check of initial part matching.
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(!exactInitialTestPath.equals(exactInitialRequestPath))
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return false;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String remainingRequestPath = requestPath.substring(index+1);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Allowing the case /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(remainingRequestPath.length()==1 &amp;&amp;
</I>&gt;<i> remainingRequestPath.equals(&quot;*&quot;))
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return true;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; int dirIindex = remainingRequestPath.indexOf(&quot;/&quot;);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * If no valid directory
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(dirIindex==-1)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return false;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String dirName = remainingRequestPath.substring(0,dirIindex);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(dirIindex&gt;remainingRequestPath.length())
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return false;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; String newRequestPath = remainingRequestPath.substring(dirIindex);
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Condition: Check for valid characters for a directory name
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if(dirName.contains(&quot;/&quot;)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ||dirName.contains(&quot;:&quot;)||dirName.contains(&quot;*&quot;)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ||dirName.contains(&quot;?&quot;)||dirName.contains(&quot;\&quot;&quot;)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ||dirName.contains(&quot;&lt;&quot;)||dirName.contains(&quot;&gt;&quot;)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ||dirName.contains(&quot;|&quot;)||dirName.contains(&quot;&amp;&quot;)
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ||dirName.contains(&quot;\\&quot;))
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return false;
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /*
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; * Call this method again for checking the remaining part of the
</I>&gt;<i> request path.
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; */
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return isUriMatch(newTestPath, newRequestPath);
</I>&gt;<i> &#160;&#160;&#160;&#160;&#160; }
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -------------------------
</I>&gt;<i> Thanks &amp; Regards
</I>&gt;<i> Manish Kumar
</I>&gt;<i> | Mob: +27-742650187 |
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">manish2aug at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-csrfguard mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;<i>
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000133.html">[Owasp-csrfguard] Bug/new feature request
</A></li>
	<LI>Next message: <A HREF="000128.html">[Owasp-csrfguard] Please Suggest; Is disabling the Rotate feature correct? How to pass wild cards in unprotected page list?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#124">[ date ]</a>
              <a href="thread.html#124">[ thread ]</a>
              <a href="subject.html#124">[ subject ]</a>
              <a href="author.html#124">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
