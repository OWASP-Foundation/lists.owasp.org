From MCheung at tmrs.com  Fri Jul  5 15:16:56 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Fri, 5 Jul 2013 15:16:56 +0000
Subject: [Owasp-csrfguard] CSRFGuard failed on IE
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED0871FD49@Post.intra.tmrs.org>

CsrfGuard works fine on Firefox and Chrome, but failed on IE (Internet Explorer).  Does anyone know to fix or work around this issue on version of Owasp-CsrfGuard-3.0.0.503?

I have the same issue as described with this link.

http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token


Thanks,
Ming


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130705/cae11631/attachment.html>

From eric.sheridan at owasp.org  Mon Jul  8 15:06:04 2013
From: eric.sheridan at owasp.org (Eric Sheridan)
Date: Mon, 08 Jul 2013 11:06:04 -0400
Subject: [Owasp-csrfguard] project looking for a co-leader
Message-ID: <51DAD55C.8010808@owasp.org>

I simply don't have the time to write code for this project these days
and am in need of assistance. Is there anyone interested in being a
co-leader for this project? The role would entail

1) addressing a handful of outstanding issues (ex: browser support,
fixing bugs in javascript code, etc)

2) design/implement/maintain new functionality to facilitate adoption

This is a high visibility project and would give you a lot of exposure.
Any takers?

-- 
Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) http://ericsheridan.blogspot.com

From tom.a.barber at gmail.com  Mon Jul  8 18:20:37 2013
From: tom.a.barber at gmail.com (Tom Barber)
Date: Mon, 8 Jul 2013 19:20:37 +0100
Subject: [Owasp-csrfguard] CSRFGuard IE8 compatibility
In-Reply-To: <007501ce7c07$65a72070$30f56150$@gmail.com>
References: <007501ce7c07$65a72070$30f56150$@gmail.com>
Message-ID: <008201ce7c07$d8d535f0$8a7fa1d0$@gmail.com>

Hi,

 

Upon finding a similar issue to that you detailed below previously I
stumbled across this email you sent last year. Were you able to make
progress on this? Our application has to support IE8 :(

 

My issue specifically is that in IE8 the tokens are not being attached to
XMLHttpRequest headers, within the override of the
XMLHttpRequest.prototype.onsend  within the js.

 

Thanks


Tom

 

----------------------------------------------------

 

Hi,

 

At the outset, I want to congratulate OWASP for its efforts in getting a

framework available for CSRF anti-tokens. This is really a plug-and-play

kind of implementation.

 

But then, I am facing an issue with the same while implementing the same

for IE8 browser. I get an error related to

XMLHttpRequest.prototype.open

is not an object.

 

Later I found that, IE8 doesnt have proper Event handling API. Please let

me know what is the way forward on this issue.

 

 

 

Yours sincerely,

 

Sridhar Vedhanabatla

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130708/e1f99404/attachment.html>

From rajesh_punjabi at hotmail.com  Mon Jul  8 18:25:15 2013
From: rajesh_punjabi at hotmail.com (Rajesh Punjabi)
Date: Mon, 8 Jul 2013 11:25:15 -0700
Subject: [Owasp-csrfguard] CSRFGuard IE8 compatibility
In-Reply-To: <008201ce7c07$d8d535f0$8a7fa1d0$@gmail.com>
References: <007501ce7c07$65a72070$30f56150$@gmail.com>,
	<008201ce7c07$d8d535f0$8a7fa1d0$@gmail.com>
Message-ID: <BAY170-W130EFC9299E95B3B477A416FC780@phx.gbl>

Hi All,
I am also struggling to make this work on IE 8.  If anyone has made progress please share with the community.
Appreciate your help,Rajesh

From: tom.a.barber at gmail.com
To: sridharvedhana at gmail.com
Date: Mon, 8 Jul 2013 19:20:37 +0100
CC: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] CSRFGuard IE8 compatibility

Hi, Upon finding a similar issue to that you detailed below previously I stumbled across this email you sent last year. Were you able to make progress on this? Our application has to support IE8 L My issue specifically is that in IE8 the tokens are not being attached to XMLHttpRequest headers, within the override of the XMLHttpRequest.prototype.onsend  within the js. Thanks
Tom ---------------------------------------------------- Hi, At the outset, I want to congratulate OWASP for its efforts in getting aframework available for CSRF anti-tokens. This is really a plug-and-playkind of implementation. But then, I am facing an issue with the same while implementing the samefor IE8 browser. I get an error related toXMLHttpRequest.prototype.openis not an object. Later I found that, IE8 doesnt have proper Event handling API. Please letme know what is the way forward on this issue.   Yours sincerely, Sridhar Vedhanabatla 
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130708/791a03e8/attachment.html>

From paul.volpe at gsa.gov  Mon Jul  8 19:45:48 2013
From: paul.volpe at gsa.gov (Paul Volpe - QV0CD-C)
Date: Mon, 8 Jul 2013 15:45:48 -0400
Subject: [Owasp-csrfguard] CSRFGuard IE8 compatibility
In-Reply-To: <008201ce7c07$d8d535f0$8a7fa1d0$@gmail.com>
References: <007501ce7c07$65a72070$30f56150$@gmail.com>
	<008201ce7c07$d8d535f0$8a7fa1d0$@gmail.com>
Message-ID: <CAEymBnF2_G0bGJU94+_SgrY-kJWcY_9Q5=+XVLaq06SuQPhsgQ@mail.gmail.com>

Hi,

We tripped across something within IE8 just recently that causes me great
alarm.  It seems as though IE8 has changed their support of the
document.getElementsByName() function.  Documentation was found to this
affect by one of the developers on my team, but I have not yet corroborated
this. If Microsoft *is* radically changing support for DOM objects, this is
going to make the browser version problem worse instead of better -- and
more to the point, could be contributing to this particular problem you're
facing.

In terms of support, we had implemented a mixed-source implementation -- we
used the OWASP filter as-is, but instead of using the OWASP JS support, we
built our own JS functionality to facilitate getting the token onto ever
request.  Generally, I wouldn't recommend this as a solution, but if you
need to respond to this problem as a Production issue faster than the
community can come up with a fix for the cross-browser support, something
along those lines may be a viable band-aid approach.




On Mon, Jul 8, 2013 at 2:20 PM, Tom Barber <tom.a.barber at gmail.com> wrote:

> Hi,****
>
> ** **
>
> Upon finding a similar issue to that you detailed below previously I
> stumbled across this email you sent last year. Were you able to make
> progress on this? Our application has to support IE8 L****
>
> ** **
>
> My issue specifically is that in IE8 the tokens are not being attached to
> XMLHttpRequest headers, within the override of the XMLHttpRequest.
> prototype.onsend  within the js.****
>
> ** **
>
> Thanks****
>
>
> Tom****
>
> ** **
>
> ----------------------------------------------------****
>
> ** **
>
> Hi,****
>
> ** **
>
> At the outset, I want to congratulate OWASP for its efforts in getting a**
> **
>
> framework available for CSRF anti-tokens. This is really a plug-and-play**
> **
>
> kind of implementation.****
>
> ** **
>
> But then, I am facing an issue with the same while implementing the same**
> **
>
> for IE8 browser. I get an error related to****
>
> XMLHttpRequest.prototype.open****
>
> is not an object.****
>
> ** **
>
> Later I found that, IE8 doesnt have proper Event handling API. Please let*
> ***
>
> me know what is the way forward on this issue.****
>
> ** **
>
> ** **
>
> ** **
>
> Yours sincerely,****
>
> ** **
>
> Sridhar Vedhanabatla****
>
> ** **
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>


-- 
- Paul F. Volpe
*OCMS Team Lead*
paul.volpe at gsa.gov
703-605-2617 (w)
585-214-9862 (c)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130708/2c25f251/attachment-0001.html>

From rajesh_punjabi at hotmail.com  Tue Jul  9 00:15:48 2013
From: rajesh_punjabi at hotmail.com (Rajesh Punjabi)
Date: Mon, 8 Jul 2013 17:15:48 -0700
Subject: [Owasp-csrfguard] CSRFGuard IE8 compatibility
In-Reply-To: <CAEymBnF2_G0bGJU94+_SgrY-kJWcY_9Q5=+XVLaq06SuQPhsgQ@mail.gmail.com>
References: <007501ce7c07$65a72070$30f56150$@gmail.com>,
	<008201ce7c07$d8d535f0$8a7fa1d0$@gmail.com>,
	<CAEymBnF2_G0bGJU94+_SgrY-kJWcY_9Q5=+XVLaq06SuQPhsgQ@mail.gmail.com>
Message-ID: <BAY170-W653596AFAD8EF1FC470CD7FC790@phx.gbl>

Hi,
I made some progress which seems to be work.  (I still need to do some more regression testing)
It seems when the JavaScriptServlet injects tokens to all the elements in the DOM, it also attaches the token to <script src=''> and <link href=''>.In IE8 the browser loads all the css files and JS files twice.  This seems to screw up things.You could try to make the INJECT_ATTRIBUTES parameter as false.
Alternatively, if you think this may break some functionality you desire then in the injectTokenAttribute() method I added the following line. (more of a hack)if(location != null && isValidUrl(location) && !location.toLowerCase().endsWith(".css") && !location.toLowerCase().endsWith(".js") && !location.toLowerCase().endsWith("javascriptservlet")) {    var uri = parseUri(location);    .....................}
So basically for js, css files we shouldn't need to attach the CSRFTOKEN attribute.
HTH
Feedback welcome.
Thanks,
Rajesh



Date: Mon, 8 Jul 2013 15:45:48 -0400
From: paul.volpe at gsa.gov
To: tom.a.barber at gmail.com
CC: owasp-csrfguard at lists.owasp.org; sridharvedhana at gmail.com
Subject: Re: [Owasp-csrfguard] CSRFGuard IE8 compatibility

Hi,
We tripped across something within IE8 just recently that causes me great alarm.  It seems as though IE8 has changed their support of the document.getElementsByName() function.  Documentation was found to this affect by one of the developers on my team, but I have not yet corroborated this. If Microsoft is radically changing support for DOM objects, this is going to make the browser version problem worse instead of better -- and more to the point, could be contributing to this particular problem you're facing.

In terms of support, we had implemented a mixed-source implementation -- we used the OWASP filter as-is, but instead of using the OWASP JS support, we built our own JS functionality to facilitate getting the token onto ever request.  Generally, I wouldn't recommend this as a solution, but if you need to respond to this problem as a Production issue faster than the community can come up with a fix for the cross-browser support, something along those lines may be a viable band-aid approach.

 

On Mon, Jul 8, 2013 at 2:20 PM, Tom Barber <tom.a.barber at gmail.com> wrote:

Hi, 
Upon finding a similar issue to that you detailed below previously I stumbled across this email you sent last year. Were you able to make progress on this? Our application has to support IE8 L
 My issue specifically is that in IE8 the tokens are not being attached to XMLHttpRequest headers, within the override of the XMLHttpRequest.prototype.onsend  within the js.
 Thanks
Tom ----------------------------------------------------
 Hi, 
At the outset, I want to congratulate OWASP for its efforts in getting aframework available for CSRF anti-tokens. This is really a plug-and-play
kind of implementation. 
But then, I am facing an issue with the same while implementing the samefor IE8 browser. I get an error related to
XMLHttpRequest.prototype.openis not an object.
 Later I found that, IE8 doesnt have proper Event handling API. Please let
me know what is the way forward on this issue. 
  
Yours sincerely, 
Sridhar Vedhanabatla 
_______________________________________________


Owasp-csrfguard mailing list

Owasp-csrfguard at lists.owasp.org

https://lists.owasp.org/mailman/listinfo/owasp-csrfguard




-- 
- Paul F. VolpeOCMS Team Leadpaul.volpe at gsa.gov703-605-2617 (w)
585-214-9862 (c)


_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130708/e0e3f5aa/attachment.html>

From MCheung at tmrs.com  Tue Jul  9 16:06:25 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Tue, 9 Jul 2013 16:06:25 +0000
Subject: [Owasp-csrfguard] The results of your email commands
In-Reply-To: <mailman.1831.1373141114.2547.owasp-csrfguard@lists.owasp.org>
References: <mailman.1831.1373141114.2547.owasp-csrfguard@lists.owasp.org>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721013@Post.intra.tmrs.org>

Since I've heard nothing back from the community, I have updated my finding with the following link.


http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token


Thanks,
Ming

-----Original Message-----
From: owasp-csrfguard-owner at lists.owasp.org [mailto:owasp-csrfguard-owner at lists.owasp.org] 
Sent: Saturday, July 06, 2013 3:05 PM
To: Cheung, Ming
Subject: The results of your email commands

The results of your email command are provided below. Attached is your original message.

- Results:
    Ignoring non-text/plain MIME parts

- Unprocessed:
    I have the same issue as described with this link.
    http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token
    Thanks,
    Ming
    ###################################################################
    CONFIDENTIALITY NOTICE: This communication, including attachments,
    is intended only for the use of the individual or entity to which
    it is addressed and may contain information that is privileged,
    confidential, and exempt from disclosure under applicable law.
    If you are not the intended recipient, you are notified that any
    use, dissemination, forwarding, distribution, or copying of the
    communication is strictly prohibited. Please notify the sender
    immediately by e-mail if you have received this communication by
    mistake and delete all copies of the original message and
    attachments from your system.
    ################################################################### 

- Done.


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 

From thomas.x.barber at jpmorgan.com  Wed Jul 10 08:11:16 2013
From: thomas.x.barber at jpmorgan.com (Barber, Thomas X)
Date: Wed, 10 Jul 2013 08:11:16 +0000
Subject: [Owasp-csrfguard] The results of your email commands
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721013@Post.intra.tmrs.org>
References: <mailman.1831.1373141114.2547.owasp-csrfguard@lists.owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721013@Post.intra.tmrs.org>
Message-ID: <A0FDB8D63716494EA24A037FDE02C136252928EF@SBACMX003.exchad.jpmchase.net>

Hi Ming,

I've been stumped on this for a while now, what does your suggestion fix exactly? It's only XMLHttpRequests that IE is failing on for me and not sure if your suggestions affect those.

Feel free to update directly on stack overflow, I'm monitoring that post (I raised it originally) 

Thanks

Tom

Tom Barber | Application Developer GFS - Technology | Corporate & Investment Bank (CIB) | J.P. Morgan, Chaseside - Hampshire Building, Floor 2, Bournemouth BH7 7DA, United Kingdom | T:+44 (0)1202 320097 |? thomas.X.barber at jpmorgan.com

-----Original Message-----
From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of Cheung, Ming
Sent: 09 July 2013 17:06
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Since I've heard nothing back from the community, I have updated my finding with the following link.


http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token


Thanks,
Ming

-----Original Message-----
From: owasp-csrfguard-owner at lists.owasp.org [mailto:owasp-csrfguard-owner at lists.owasp.org]
Sent: Saturday, July 06, 2013 3:05 PM
To: Cheung, Ming
Subject: The results of your email commands

The results of your email command are provided below. Attached is your original message.

- Results:
    Ignoring non-text/plain MIME parts

- Unprocessed:
    I have the same issue as described with this link.
    http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token
    Thanks,
    Ming
    ###################################################################
    CONFIDENTIALITY NOTICE: This communication, including attachments,
    is intended only for the use of the individual or entity to which
    it is addressed and may contain information that is privileged,
    confidential, and exempt from disclosure under applicable law.
    If you are not the intended recipient, you are notified that any
    use, dissemination, forwarding, distribution, or copying of the
    communication is strictly prohibited. Please notify the sender
    immediately by e-mail if you have received this communication by
    mistake and delete all copies of the original message and
    attachments from your system.
    ################################################################### 

- Done.


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  

From MCheung at tmrs.com  Wed Jul 10 15:27:59 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Wed, 10 Jul 2013 15:27:59 +0000
Subject: [Owasp-csrfguard] The results of your email commands
In-Reply-To: <A0FDB8D63716494EA24A037FDE02C136252928EF@SBACMX003.exchad.jpmchase.net>
References: <mailman.1831.1373141114.2547.owasp-csrfguard@lists.owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721013@Post.intra.tmrs.org>
	<A0FDB8D63716494EA24A037FDE02C136252928EF@SBACMX003.exchad.jpmchase.net>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED087210ED@Post.intra.tmrs.org>

Tom,

I am using an older version of CSRFGuard, build 3.0.0.503, because of the latest/newest version has more bugs than I expected and my application failed to run without heavy modification of the CSRFGuard's Java source codes. 

Anyway, in my case, CSRFGuard 3.0.0.503 failed to add the OWASP_CSRFTOKEN to the URL (example, /root/myServlet) on the Form's Action element. In Owasp.CsrfGuard.js, the line, form.getAttribute("action"), returns XMLHttpInput (I cannot remember the exact name) object instead of a String value (/root/myServlet ) of Action element on IE. In order to get the String value (/root/myServlet), form.attributes["action"].value is the option for my environment (IE browser + a remote IBM WebSphere application server). Interestingly, the original code, form.getAttribute("action"), is working fine when both IE and IBM Websphere Application server are running on the same local machine though. 

In short, I learned the new code, Form.attributes["action"].value, works fine for Firefox, Chrome, and IE.


Thanks,
Ming


-----Original Message-----
From: Barber, Thomas X [mailto:thomas.x.barber at jpmorgan.com] 
Sent: Wednesday, July 10, 2013 3:11 AM
To: Cheung, Ming; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Hi Ming,

I've been stumped on this for a while now, what does your suggestion fix exactly? It's only XMLHttpRequests that IE is failing on for me and not sure if your suggestions affect those.

Feel free to update directly on stack overflow, I'm monitoring that post (I raised it originally) 

Thanks

Tom

Tom Barber | Application Developer GFS - Technology | Corporate & Investment Bank (CIB) | J.P. Morgan, Chaseside - Hampshire Building, Floor 2, Bournemouth BH7 7DA, United Kingdom | T:+44 (0)1202 320097 |? thomas.X.barber at jpmorgan.com

-----Original Message-----
From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of Cheung, Ming
Sent: 09 July 2013 17:06
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Since I've heard nothing back from the community, I have updated my finding with the following link.


http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token


Thanks,
Ming

-----Original Message-----
From: owasp-csrfguard-owner at lists.owasp.org [mailto:owasp-csrfguard-owner at lists.owasp.org]
Sent: Saturday, July 06, 2013 3:05 PM
To: Cheung, Ming
Subject: The results of your email commands

The results of your email command are provided below. Attached is your original message.

- Results:
    Ignoring non-text/plain MIME parts

- Unprocessed:
    I have the same issue as described with this link.
    http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token
    Thanks,
    Ming
    ###################################################################
    CONFIDENTIALITY NOTICE: This communication, including attachments,
    is intended only for the use of the individual or entity to which
    it is addressed and may contain information that is privileged,
    confidential, and exempt from disclosure under applicable law.
    If you are not the intended recipient, you are notified that any
    use, dissemination, forwarding, distribution, or copying of the
    communication is strictly prohibited. Please notify the sender
    immediately by e-mail if you have received this communication by
    mistake and delete all copies of the original message and
    attachments from your system.
    ################################################################### 

- Done.


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 

From thomas.x.barber at jpmorgan.com  Wed Jul 10 15:31:10 2013
From: thomas.x.barber at jpmorgan.com (Barber, Thomas X)
Date: Wed, 10 Jul 2013 15:31:10 +0000
Subject: [Owasp-csrfguard] The results of your email commands
In-Reply-To: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED087210ED@Post.intra.tmrs.org>
References: <mailman.1831.1373141114.2547.owasp-csrfguard@lists.owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721013@Post.intra.tmrs.org>
	<A0FDB8D63716494EA24A037FDE02C136252928EF@SBACMX003.exchad.jpmchase.net>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED087210ED@Post.intra.tmrs.org>
Message-ID: <A0FDB8D63716494EA24A037FDE02C1362529548B@SBACMX003.exchad.jpmchase.net>

Hi Ming,

Thanks for the update. I've almost given up on CSRFGuard now, as our application must be able to run on IE8 but it seems that it's not compatible. Ajax request headers are not being populated with the CSRF token in IE8, but works fine in firefox and IE9+

Tom

-----Original Message-----
From: Cheung, Ming [mailto:MCheung at tmrs.com] 
Sent: 10 July 2013 16:28
To: Barber, Thomas X; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] The results of your email commands

Tom,

I am using an older version of CSRFGuard, build 3.0.0.503, because of the latest/newest version has more bugs than I expected and my application failed to run without heavy modification of the CSRFGuard's Java source codes. 

Anyway, in my case, CSRFGuard 3.0.0.503 failed to add the OWASP_CSRFTOKEN to the URL (example, /root/myServlet) on the Form's Action element. In Owasp.CsrfGuard.js, the line, form.getAttribute("action"), returns XMLHttpInput (I cannot remember the exact name) object instead of a String value (/root/myServlet ) of Action element on IE. In order to get the String value (/root/myServlet), form.attributes["action"].value is the option for my environment (IE browser + a remote IBM WebSphere application server). Interestingly, the original code, form.getAttribute("action"), is working fine when both IE and IBM Websphere Application server are running on the same local machine though. 

In short, I learned the new code, Form.attributes["action"].value, works fine for Firefox, Chrome, and IE.


Thanks,
Ming


-----Original Message-----
From: Barber, Thomas X [mailto:thomas.x.barber at jpmorgan.com]
Sent: Wednesday, July 10, 2013 3:11 AM
To: Cheung, Ming; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Hi Ming,

I've been stumped on this for a while now, what does your suggestion fix exactly? It's only XMLHttpRequests that IE is failing on for me and not sure if your suggestions affect those.

Feel free to update directly on stack overflow, I'm monitoring that post (I raised it originally) 

Thanks

Tom

Tom Barber | Application Developer GFS - Technology | Corporate & Investment Bank (CIB) | J.P. Morgan, Chaseside - Hampshire Building, Floor 2, Bournemouth BH7 7DA, United Kingdom | T:+44 (0)1202 320097 |? thomas.X.barber at jpmorgan.com

-----Original Message-----
From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of Cheung, Ming
Sent: 09 July 2013 17:06
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Since I've heard nothing back from the community, I have updated my finding with the following link.


http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token


Thanks,
Ming

-----Original Message-----
From: owasp-csrfguard-owner at lists.owasp.org [mailto:owasp-csrfguard-owner at lists.owasp.org]
Sent: Saturday, July 06, 2013 3:05 PM
To: Cheung, Ming
Subject: The results of your email commands

The results of your email command are provided below. Attached is your original message.

- Results:
    Ignoring non-text/plain MIME parts

- Unprocessed:
    I have the same issue as described with this link.
    http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token
    Thanks,
    Ming
    ###################################################################
    CONFIDENTIALITY NOTICE: This communication, including attachments,
    is intended only for the use of the individual or entity to which
    it is addressed and may contain information that is privileged,
    confidential, and exempt from disclosure under applicable law.
    If you are not the intended recipient, you are notified that any
    use, dissemination, forwarding, distribution, or copying of the
    communication is strictly prohibited. Please notify the sender
    immediately by e-mail if you have received this communication by
    mistake and delete all copies of the original message and
    attachments from your system.
    ################################################################### 

- Done.


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
################################################################### 

This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  

From MCheung at tmrs.com  Wed Jul 10 15:59:53 2013
From: MCheung at tmrs.com (Cheung, Ming)
Date: Wed, 10 Jul 2013 15:59:53 +0000
Subject: [Owasp-csrfguard] The results of your email commands
In-Reply-To: <A0FDB8D63716494EA24A037FDE02C1362529548B@SBACMX003.exchad.jpmchase.net>
References: <mailman.1831.1373141114.2547.owasp-csrfguard@lists.owasp.org>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721013@Post.intra.tmrs.org>
	<A0FDB8D63716494EA24A037FDE02C136252928EF@SBACMX003.exchad.jpmchase.net>
	<28B3FE87AB2E1847A5FE9B8C0A4CC6ED087210ED@Post.intra.tmrs.org>
	<A0FDB8D63716494EA24A037FDE02C1362529548B@SBACMX003.exchad.jpmchase.net>
Message-ID: <28B3FE87AB2E1847A5FE9B8C0A4CC6ED08721109@Post.intra.tmrs.org>

It is pretty challenge to use third party codes. Good Luck! Buddy.

Thanks,
Ming


-----Original Message-----
From: Barber, Thomas X [mailto:thomas.x.barber at jpmorgan.com] 
Sent: Wednesday, July 10, 2013 10:31 AM
To: Cheung, Ming; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] The results of your email commands

Hi Ming,

Thanks for the update. I've almost given up on CSRFGuard now, as our application must be able to run on IE8 but it seems that it's not compatible. Ajax request headers are not being populated with the CSRF token in IE8, but works fine in firefox and IE9+

Tom

-----Original Message-----
From: Cheung, Ming [mailto:MCheung at tmrs.com] 
Sent: 10 July 2013 16:28
To: Barber, Thomas X; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] The results of your email commands

Tom,

I am using an older version of CSRFGuard, build 3.0.0.503, because of the latest/newest version has more bugs than I expected and my application failed to run without heavy modification of the CSRFGuard's Java source codes. 

Anyway, in my case, CSRFGuard 3.0.0.503 failed to add the OWASP_CSRFTOKEN to the URL (example, /root/myServlet) on the Form's Action element. In Owasp.CsrfGuard.js, the line, form.getAttribute("action"), returns XMLHttpInput (I cannot remember the exact name) object instead of a String value (/root/myServlet ) of Action element on IE. In order to get the String value (/root/myServlet), form.attributes["action"].value is the option for my environment (IE browser + a remote IBM WebSphere application server). Interestingly, the original code, form.getAttribute("action"), is working fine when both IE and IBM Websphere Application server are running on the same local machine though. 

In short, I learned the new code, Form.attributes["action"].value, works fine for Firefox, Chrome, and IE.


Thanks,
Ming


-----Original Message-----
From: Barber, Thomas X [mailto:thomas.x.barber at jpmorgan.com]
Sent: Wednesday, July 10, 2013 3:11 AM
To: Cheung, Ming; owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Hi Ming,

I've been stumped on this for a while now, what does your suggestion fix exactly? It's only XMLHttpRequests that IE is failing on for me and not sure if your suggestions affect those.

Feel free to update directly on stack overflow, I'm monitoring that post (I raised it originally) 

Thanks

Tom

Tom Barber | Application Developer GFS - Technology | Corporate & Investment Bank (CIB) | J.P. Morgan, Chaseside - Hampshire Building, Floor 2, Bournemouth BH7 7DA, United Kingdom | T:+44 (0)1202 320097 |? thomas.X.barber at jpmorgan.com

-----Original Message-----
From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of Cheung, Ming
Sent: 09 July 2013 17:06
To: owasp-csrfguard at lists.owasp.org
Subject: Re: [Owasp-csrfguard] The results of your email commands

Since I've heard nothing back from the community, I have updated my finding with the following link.


http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token


Thanks,
Ming

-----Original Message-----
From: owasp-csrfguard-owner at lists.owasp.org [mailto:owasp-csrfguard-owner at lists.owasp.org]
Sent: Saturday, July 06, 2013 3:05 PM
To: Cheung, Ming
Subject: The results of your email commands

The results of your email command are provided below. Attached is your original message.

- Results:
    Ignoring non-text/plain MIME parts

- Unprocessed:
    I have the same issue as described with this link.
    http://stackoverflow.com/questions/17347806/csrfguard-request-token-does-not-match-session-token
    Thanks,
    Ming
    ###################################################################
    CONFIDENTIALITY NOTICE: This communication, including attachments,
    is intended only for the use of the individual or entity to which
    it is addressed and may contain information that is privileged,
    confidential, and exempt from disclosure under applicable law.
    If you are not the intended recipient, you are notified that any
    use, dissemination, forwarding, distribution, or copying of the
    communication is strictly prohibited. Please notify the sender
    immediately by e-mail if you have received this communication by
    mistake and delete all copies of the original message and
    attachments from your system.
    ################################################################### 

- Done.


###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
Owasp-csrfguard at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-csrfguard

This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
################################################################### 

This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments,
is intended only for the use of the individual or entity to which
it is addressed and may contain information that is privileged,
confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any
use, dissemination, forwarding, distribution, or copying of the
communication is strictly prohibited. Please notify the sender
immediately by e-mail if you have received this communication by
mistake and delete all copies of the original message and
attachments from your system.
################################################################### 

From ray at allthisisthat.com  Tue Jul 16 20:44:18 2013
From: ray at allthisisthat.com (ray at allthisisthat.com)
Date: Tue, 16 Jul 2013 13:44:18 -0700
Subject: [Owasp-csrfguard] can't get it to work
Message-ID: <4a776ad9bb342527b780ad94b8a1cee0.squirrel@mail.allthisisthat.com>




I am unable to get the CsrfGuard filter to work.? Regardless of the properties I set, the app tries to go to the login page, and I get this log message:
[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:<anonymous>,
ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)
Obviously I am doing something wrong.? Here is my configuration file
org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
org.owasp.csrfguard.UseNewTokenLandingPage=true

org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html

org.owasp.csrfguard.TokenPerPage=true

org.owasp.csrfguard.TokenPerPagePrecreate=false

org.owasp.csrfguard.Ajax=false

org.owasp.csrfguard.unprotected.Index=/login*

org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log

org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%, error:%exception_message%)

org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN

org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN

org.owasp.csrfguard.TokenLength=32

org.owasp.csrfguard.PRNG=SHA1PRNG
When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.
I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page
but not using a New Token Landing Page.? Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.? Is that correct?? Also, all the examples use jsp, not facelets.? Are there
any issues with this difference?? I built the project from source using the latest code.
Any help you could offer would be greatly appreciated.
?
Thank you,
Ray Clough
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130716/d9af7344/attachment.html>

From tom.a.barber at gmail.com  Tue Jul 16 21:30:45 2013
From: tom.a.barber at gmail.com (Tom Barber)
Date: Tue, 16 Jul 2013 22:30:45 +0100
Subject: [Owasp-csrfguard] can't get it to work
In-Reply-To: <4a776ad9bb342527b780ad94b8a1cee0.squirrel@mail.allthisisthat.com>
References: <4a776ad9bb342527b780ad94b8a1cee0.squirrel@mail.allthisisthat.com>
Message-ID: <002e01ce826b$bb843b80$328cb280$@gmail.com>

Hi Ray,

 

I?m not certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner ?/login*? . Perhaps you could specify the exact uri ?drbms/login.seam?

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of ray at allthisisthat.com
Sent: 16 July 2013 21:44
To: owasp-csrfguard at lists.owasp.org
Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the properties I set, the app tries to go to the login page, and I get this log message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:<anonymous>, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
org.owasp.csrfguard.UseNewTokenLandingPage=true
org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
org.owasp.csrfguard.TokenPerPage=true
org.owasp.csrfguard.TokenPerPagePrecreate=false
org.owasp.csrfguard.Ajax=false
org.owasp.csrfguard.unprotected.Index=/login*
org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%, error:%exception_message%)
org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
org.owasp.csrfguard.TokenLength=32
org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page but not using a New Token Landing Page.  Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.  Is that correct?  Also, all the examples use jsp, not facelets.  Are there any issues with this difference?  I built the project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130716/2d29d98c/attachment.html>

From ray at allthisisthat.com  Tue Jul 16 22:30:19 2013
From: ray at allthisisthat.com (ray at allthisisthat.com)
Date: Tue, 16 Jul 2013 15:30:19 -0700
Subject: [Owasp-csrfguard] can't get it to work
In-Reply-To: <002e01ce826b$bb843b80$328cb280$@gmail.com>
References: <4a776ad9bb342527b780ad94b8a1cee0.squirrel@mail.allthisisthat.com>
	<002e01ce826b$bb843b80$328cb280$@gmail.com>
Message-ID: <6344affe96453116d8cfad9eb71cc50f.squirrel@mail.allthisisthat.com>




You Rule!? It does indeed work, but now all my requests for images, css, etc all fail with missing token messages.? I tried adding the config property org.owasp.csrfguard.Ajax=true, but this makes no difference.? I still get a ton of messages like: Potential Cross-Site
Request Forgery (CSRF) attack thwarted (user:<anonymous>, ip:127.0.0.1, uri:/drbms/img/sort_down.gif, error:required token is missing from the request).? What am I missing now?? Any ideas?
Also, I am now leaving the login page unprotected, which can't be a very good
idea.? Is there a better method using the NewTokenLandingPage?? I still have that config setting, but it never goes there.? Should the NewTokenLandingPage redirect to the login page, or what does it do?? There isn't much discussion of this in the documentation,
AFAIK.
Thanks very much for the help so far - there was some danger of me going berserk, which is now receding into the distance.
- Ray Clough
?

---------------------------- Original Message ----------------------------

Subject: RE: [Owasp-csrfguard] can't get it to work

From: "Tom Barber" 

Date: Tue, July 16, 2013 2:30 pm

To: ray at allthisisthat.com

owasp-csrfguard at lists.owasp.org

--------------------------------------------------------------------------



{C}<style type="text/css">
-></style>


	
		Hi Ray,?I&rsquo;m not
certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:?# Case 1: exact match between request uri and
unprotected page# Case 2: longest path prefix match, beginning / and ending /*# Case 3: extension match, beginning *.# Default: requested resource must be validated by
CSRFGuard?In your case you seem to have used wildcard in an unsupported manner &ldquo;/login*&rdquo; . Perhaps you could specify the exact uri
&ldquo;drbms/login.seam&rdquo;?Let me know if you have any luck.?Thanks?Tom?From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of ray at allthisisthat.com
		Sent: 16 July 2013 21:44

		To: owasp-csrfguard at lists.owasp.org

		Subject: [Owasp-csrfguard] can't get it to work?
I am unable to get the CsrfGuard filter to work.? Regardless of the properties I set, the app tries to go to the login page, and I get this log message:
[Tue Jul 16 13:08:38 PDT
2013] [Error] Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:<anonymous>, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)
Obviously I am doing something wrong.? Here is my configuration
file
org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
		org.owasp.csrfguard.UseNewTokenLandingPage=true

		org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html

		org.owasp.csrfguard.TokenPerPage=true

		org.owasp.csrfguard.TokenPerPagePrecreate=false

		org.owasp.csrfguard.Ajax=false

		org.owasp.csrfguard.unprotected.Index=/login*

		org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log

		org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%, error:%exception_message%)

		org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN

		org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN

		org.owasp.csrfguard.TokenLength=32

		org.owasp.csrfguard.PRNG=SHA1PRNG
When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.
I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login
page but not using a New Token Landing Page.? Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.? Is that correct?? Also, all the examples use jsp, not facelets.? Are
there any issues with this difference?? I built the project from source using the latest code.
Any help you could offer would be greatly appreciated.
?
Thank you,
Ray Clough
?

?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130716/b38a4b30/attachment-0001.html>

From tom.a.barber at gmail.com  Tue Jul 16 23:26:30 2013
From: tom.a.barber at gmail.com (Tom Barber)
Date: Wed, 17 Jul 2013 00:26:30 +0100
Subject: [Owasp-csrfguard] can't get it to work
In-Reply-To: <6344affe96453116d8cfad9eb71cc50f.squirrel@mail.allthisisthat.com>
References: <4a776ad9bb342527b780ad94b8a1cee0.squirrel@mail.allthisisthat.com>
	<002e01ce826b$bb843b80$328cb280$@gmail.com>
	<6344affe96453116d8cfad9eb71cc50f.squirrel@mail.allthisisthat.com>
Message-ID: <004f01ce827b$e779f1c0$b66dd540$@gmail.com>

Hi Ray, Glad that helped!

 

I'm no expert in CSRFGuard (only started trying it out myself recently as a
POC), but when I faced a similar issue I decided that I didn't really care
about protecting images, so what I did was use the:

 

# Case 2: longest path prefix match, beginning / and ending /*

So in the example you provided, that would be:

 

"/img/*"

 

This unprotects all files within the img directory. Another option would be
for:

# Case 3: extension match, beginning *.

"*.gif" for each img extension type, perhaps useful if you have images in
many different locations - though your example suggests otherwise.

 

As for leaving the login page unprotected, I don't think that is a problem
(again, im no expert though..) a CSRF attack against a login page would only
be able to potentially log a user into the application if valid parameters
are supplied in the malicious request and valid users need to be able to
access the site via the login screen and they wont have a token when they
first visit -  though I'm not familiar with the newtokenlandingpage, which
could be the alternative solution for all I know :)

 

Good luck!

 

Tom

 

From: ray at allthisisthat.com [mailto:ray at allthisisthat.com] 
Sent: 16 July 2013 23:30
To: Tom Barber
Cc: Clough_Ray_allthisisthat; owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] can't get it to work

 

You Rule!  It does indeed work, but now all my requests for images, css, etc
all fail with missing token messages.  I tried adding the config property
org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a
ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack
thwarted (user:<anonymous>, ip:127.0.0.1, uri:/drbms/img/sort_down.gif,
error:required token is missing from the request).  What am I missing now?
Any ideas?

Also, I am now leaving the login page unprotected, which can't be a very
good idea.  Is there a better method using the NewTokenLandingPage?  I still
have that config setting, but it never goes there.  Should the
NewTokenLandingPage redirect to the login page, or what does it do?  There
isn't much discussion of this in the documentation, AFAIK.

Thanks very much for the help so far - there was some danger of me going
berserk, which is now receding into the distance.

- Ray Clough

 


---------------------------- Original Message ----------------------------
Subject: RE: [Owasp-csrfguard] can't get it to work
From: "Tom Barber" 
Date: Tue, July 16, 2013 2:30 pm
To: ray at allthisisthat.com <mailto:ray at allthisisthat.com> 
owasp-csrfguard at lists.owasp.org <mailto:owasp-csrfguard at lists.owasp.org> 
--------------------------------------------------------------------------

{C} 

Hi Ray,

 

I'm not certain this is the case, but I believe I know the problem. If you
look at the comments above the unprotected section of the property files the
options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner
"/login*" . Perhaps you could specify the exact uri "drbms/login.seam"

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From:  <mailto:owasp-csrfguard-bounces at lists.owasp.org>
owasp-csrfguard-bounces at lists.owasp.org [
<mailto:owasp-csrfguard-bounces at lists.owasp.org>
mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of
<mailto:ray at allthisisthat.com> ray at allthisisthat.com
Sent: 16 July 2013 21:44
To:  <mailto:owasp-csrfguard at lists.owasp.org>
owasp-csrfguard at lists.owasp.org
Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the
properties I set, the app tries to go to the login page, and I get this log
message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery
(CSRF) attack thwarted (user:<anonymous>, ip:127.0.0.1,
uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
org.owasp.csrfguard.UseNewTokenLandingPage=true
org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
org.owasp.csrfguard.TokenPerPage=true
org.owasp.csrfguard.TokenPerPagePrecreate=false
org.owasp.csrfguard.Ajax=false
org.owasp.csrfguard.unprotected.Index=/login*
org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery
(CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,
error:%exception_message%)
org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
org.owasp.csrfguard.TokenLength=32
org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console,
so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the
login page protected, and un-protecting the login page but not using a New
Token Landing Page.  Also, I have seen no info on what the New Token Landing
Page needs to do - If I can ever get it to appear, my guess is that it needs
to redirect to the login page.  Is that correct?  Also, all the examples use
jsp, not facelets.  Are there any issues with this difference?  I built the
project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment.html>

From tom.a.barber at gmail.com  Tue Jul 16 23:58:23 2013
From: tom.a.barber at gmail.com (Tom Barber)
Date: Wed, 17 Jul 2013 00:58:23 +0100
Subject: [Owasp-csrfguard] can't get it to work
In-Reply-To: <004f01ce827b$e779f1c0$b66dd540$@gmail.com>
References: <4a776ad9bb342527b780ad94b8a1cee0.squirrel@mail.allthisisthat.com>
	<002e01ce826b$bb843b80$328cb280$@gmail.com>
	<6344affe96453116d8cfad9eb71cc50f.squirrel@mail.allthisisthat.com>
	<004f01ce827b$e779f1c0$b66dd540$@gmail.com>
Message-ID: <000401ce8280$5bbed1a0$133c74e0$@gmail.com>

P.S. I meant "/drbms/img/*" - I found that you usually need to include the
context root 

 

From: Tom Barber [mailto:tom.a.barber at gmail.com] 
Sent: 17 July 2013 00:27
To: ray at allthisisthat.com
Cc: owasp-csrfguard at lists.owasp.org
Subject: RE: [Owasp-csrfguard] can't get it to work

 

Hi Ray, Glad that helped!

 

I'm no expert in CSRFGuard (only started trying it out myself recently as a
POC), but when I faced a similar issue I decided that I didn't really care
about protecting images, so what I did was use the:

 

# Case 2: longest path prefix match, beginning / and ending /*

So in the example you provided, that would be:

 

"/img/*"

 

This unprotects all files within the img directory. Another option would be
for:

# Case 3: extension match, beginning *.

"*.gif" for each img extension type, perhaps useful if you have images in
many different locations - though your example suggests otherwise.

 

As for leaving the login page unprotected, I don't think that is a problem
(again, im no expert though..) a CSRF attack against a login page would only
be able to potentially log a user into the application if valid parameters
are supplied in the malicious request and valid users need to be able to
access the site via the login screen and they wont have a token when they
first visit -  though I'm not familiar with the newtokenlandingpage, which
could be the alternative solution for all I know :)

 

Good luck!

 

Tom

 

From: ray at allthisisthat.com <mailto:ray at allthisisthat.com>
[mailto:ray at allthisisthat.com] 
Sent: 16 July 2013 23:30
To: Tom Barber
Cc: Clough_Ray_allthisisthat; owasp-csrfguard at lists.owasp.org
<mailto:owasp-csrfguard at lists.owasp.org> 
Subject: RE: [Owasp-csrfguard] can't get it to work

 

You Rule!  It does indeed work, but now all my requests for images, css, etc
all fail with missing token messages.  I tried adding the config property
org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a
ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack
thwarted (user:<anonymous>, ip:127.0.0.1, uri:/drbms/img/sort_down.gif,
error:required token is missing from the request).  What am I missing now?
Any ideas?

Also, I am now leaving the login page unprotected, which can't be a very
good idea.  Is there a better method using the NewTokenLandingPage?  I still
have that config setting, but it never goes there.  Should the
NewTokenLandingPage redirect to the login page, or what does it do?  There
isn't much discussion of this in the documentation, AFAIK.

Thanks very much for the help so far - there was some danger of me going
berserk, which is now receding into the distance.

- Ray Clough

 


---------------------------- Original Message ----------------------------
Subject: RE: [Owasp-csrfguard] can't get it to work
From: "Tom Barber" 
Date: Tue, July 16, 2013 2:30 pm
To: ray at allthisisthat.com <mailto:ray at allthisisthat.com> 
owasp-csrfguard at lists.owasp.org <mailto:owasp-csrfguard at lists.owasp.org> 
--------------------------------------------------------------------------

{C} 

Hi Ray,

 

I'm not certain this is the case, but I believe I know the problem. If you
look at the comments above the unprotected section of the property files the
options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner
"/login*" . Perhaps you could specify the exact uri "drbms/login.seam"

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From:  <mailto:owasp-csrfguard-bounces at lists.owasp.org>
owasp-csrfguard-bounces at lists.owasp.org [
<mailto:owasp-csrfguard-bounces at lists.owasp.org>
mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of
<mailto:ray at allthisisthat.com> ray at allthisisthat.com
Sent: 16 July 2013 21:44
To:  <mailto:owasp-csrfguard at lists.owasp.org>
owasp-csrfguard at lists.owasp.org
Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the
properties I set, the app tries to go to the login page, and I get this log
message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery
(CSRF) attack thwarted (user:<anonymous>, ip:127.0.0.1,
uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
org.owasp.csrfguard.UseNewTokenLandingPage=true
org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
org.owasp.csrfguard.TokenPerPage=true
org.owasp.csrfguard.TokenPerPagePrecreate=false
org.owasp.csrfguard.Ajax=false
org.owasp.csrfguard.unprotected.Index=/login*
org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery
(CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,
error:%exception_message%)
org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
org.owasp.csrfguard.TokenLength=32
org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console,
so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the
login page protected, and un-protecting the login page but not using a New
Token Landing Page.  Also, I have seen no info on what the New Token Landing
Page needs to do - If I can ever get it to appear, my guess is that it needs
to redirect to the login page.  Is that correct?  Also, all the examples use
jsp, not facelets.  Are there any issues with this difference?  I built the
project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/9e83c245/attachment-0001.html>

From tom.a.barber at gmail.com  Wed Jul 17 23:01:03 2013
From: tom.a.barber at gmail.com (Tom Barber)
Date: Thu, 18 Jul 2013 00:01:03 +0100
Subject: [Owasp-csrfguard] can't get it to work
In-Reply-To: <9d884997549f9d1cbef597241e58ae11.squirrel@mail.allthisisthat.com>
References: <003901ce82b4$ef021ba0$cd0652e0$@gmail.com>
	<9d884997549f9d1cbef597241e58ae11.squirrel@mail.allthisisthat.com>
Message-ID: <003901ce8341$84212280$8c636780$@gmail.com>

Yeah, I?ve thought the same. The only reason I found out about the precise required nature of the expressions was through trying to do the same as you.

 

Glad you got it up and running ok.

 

Tom

 

From: ray at allthisisthat.com [mailto:ray at allthisisthat.com] 
Sent: 17 July 2013 22:38
To: Manish Java
Cc: Clough_Ray_allthisisthat; owasp-csrfguard at lists.owasp.org; tom.a.barber at gmail.com
Subject: RE: [Owasp-csrfguard] can't get it to work

 

Thanks very much.  I got it going now.  Too bad Expression Language tags not allowed, and also would be nice to allow something like /myapp/something/*.xyz or 'myapp/*/*.xyz.  Then we could do /myapp/*/*.css, for example, to allow css coming from libraries to be allowed, but still not specifying *.css, which allows css from anywhere.  Same is true, of course for images and js, etc.  But we can't have everything, or at least so I've been told (and I always believe what people tell me).  Maybe there are good reasons for the strictness of the three allowed patterns which I don't yet understand.

- Ray Clough


---------------------------- Original Message ----------------------------
Subject: RE: [Owasp-csrfguard] can't get it to work
From: "Manish Java" 
Date: Tue, July 16, 2013 11:14 pm
To: ray at allthisisthat.com <mailto:ray at allthisisthat.com> 
Cc: owasp-csrfguard at lists.owasp.org <mailto:owasp-csrfguard at lists.owasp.org> 
tom.a.barber at gmail.com <mailto:tom.a.barber at gmail.com> 
--------------------------------------------------------------------------

{C}

Hi Ray

I have found the following steps to be useful when working with CSRFGuard:

 

1.      Find out the context root for the application (say, / or /myapp or /drbms in your case);

2.      Decide on which resources you would like to protect;

3.      Decide on which resources you do not need to protect (possibly images, CSS files, JavaScript files, plain HTML files, etc.);

4.      First configure the unprotected resources in the CSRFGuard configuration file, using org.owasp.csrfguard.unprotected configuration directives.  Make sure that you prefix the URLs with the context root.  An example configuration is given below:

org.owasp.csrfguard.unprotected.CSS=/myapp/css/*
org.owasp.csrfguard.unprotected.HTML=/myapp/html/*
org.owasp.csrfguard.unprotected.Image=/myapp/image/*
org.owasp.csrfguard.unprotected.JavaScript=/myapp/script/*
org.owasp.csrfguard.unprotected.PDF=/myapp/pdf/*

5.      Add configuration settings for the protected resources, as per application requirements.

 

In our application we typically do the following:

 

1.      Configure the application root (/) as the new token landing page.  All this does is to ensure that any malicious attacker looking to target a specific page in any possible way is automatically redirected to the application?s home page (/).  In our applications the home page either does not present any sensitive data or automatically redirects to the login page, depending on the application.

2.      We typically leave the login page unprotected as many users of our applications are likely to bookmark the login page.  In any case, the login page does not have any sensitive information so it is fine to leave it unprotected.

3.      Our CSRFGuard properties file is generated on a per-environment through our Maven build.  This allows us to use different context roots for different environments and frees us up from having to maintain separate properties files.

 

If you have any further questions, please feel free to reply to this thread.  I will be happy to take a look at any issue you might be facing with CSRFGuard.

 

Cheers

~ Manish

 

Date: Wed, 17 Jul 2013 00:26:30 +0100

From: "Tom Barber" < <mailto:tom.a.barber at gmail.com> tom.a.barber at gmail.com>

To: < <mailto:ray at allthisisthat.com> ray at allthisisthat.com>

Cc:  <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org

Subject: Re: [Owasp-csrfguard] can't get it to work

Message-ID: < <mailto:004f01ce827b$e779f1c0$b66dd540$@gmail.com> 004f01ce827b$e779f1c0$b66dd540$@gmail.com>

Content-Type: text/plain; charset="us-ascii"

Hi Ray, Glad that helped!

 

I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:

 

# Case 2: longest path prefix match, beginning / and ending /*

So in the example you provided, that would be:

 

"/img/*"

 

This unprotects all files within the img directory. Another option would be

for:

# Case 3: extension match, beginning *.

"*.gif" for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.

 

As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)

 

Good luck!

 

Tom

 

From:  <mailto:ray at allthisisthat.com> ray at allthisisthat.com [ <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com]

Sent: 16 July 2013 23:30

To: Tom Barber

Cc: Clough_Ray_allthisisthat;  <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org

Subject: RE: [Owasp-csrfguard] can't get it to work

 

You Rule!  It does indeed work, but now all my requests for images, css, etc all fail with missing token messages.  I tried adding the config property org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif, error:required token is missing from the request).  What am I missing now?

Any ideas?

Also, I am now leaving the login page unprotected, which can't be a very good idea.  Is there a better method using the NewTokenLandingPage?  I still have that config setting, but it never goes there.  Should the NewTokenLandingPage redirect to the login page, or what does it do?  There isn't much discussion of this in the documentation, AFAIK.

Thanks very much for the help so far - there was some danger of me going berserk, which is now receding into the distance.

- Ray Clough

 

 

---------------------------- Original Message ----------------------------

Subject: RE: [Owasp-csrfguard] can't get it to work

From: "Tom Barber" 

Date: Tue, July 16, 2013 2:30 pm

To:  <mailto:ray at allthisisthat.com> ray at allthisisthat.com < <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com>  <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org < <mailto:owasp-csrfguard at lists.owasp.org> mailto:owasp-csrfguard at lists.owasp.org>

--------------------------------------------------------------------------

{C} 

Hi Ray,

 

I'm not certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner "/login*" . Perhaps you could specify the exact uri "drbms/login.seam"

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From:  < <mailto:owasp-csrfguard-bounces at lists.owasp.org> mailto:owasp-csrfguard-bounces at lists.owasp.org>

 <mailto:owasp-csrfguard-bounces at lists.owasp.org> owasp-csrfguard-bounces at lists.owasp.org [ < <mailto:owasp-csrfguard-bounces at lists.owasp.org> mailto:owasp-csrfguard-bounces at lists.owasp.org>

 <mailto:owasp-csrfguard-bounces at lists.owasp.org> mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of < <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com>  <mailto:ray at allthisisthat.com> ray at allthisisthat.com

Sent: 16 July 2013 21:44

To:  < <mailto:owasp-csrfguard at lists.owasp.org> mailto:owasp-csrfguard at lists.owasp.org>

 <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org

Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the properties I set, the app tries to go to the login page, and I get this log

message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger

org.owasp.csrfguard.UseNewTokenLandingPage=true

org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html

org.owasp.csrfguard.TokenPerPage=true

org.owasp.csrfguard.TokenPerPagePrecreate=false

org.owasp.csrfguard.Ajax=false

org.owasp.csrfguard.unprotected.Index=/login*

org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log

org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,

error:%exception_message%)

org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN

org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN

org.owasp.csrfguard.TokenLength=32

org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page but not using a New Token Landing Page.  Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.  Is that correct?  Also, all the examples use jsp, not facelets.  Are there any issues with this difference?  I built the project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

 

-------------- next part --------------

An HTML attachment was scrubbed...

URL: < <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html>

------------------------------

Message: 2

Date: Wed, 17 Jul 2013 00:58:23 +0100

From: "Tom Barber" < <mailto:tom.a.barber at gmail.com> tom.a.barber at gmail.com>

To: < <mailto:ray at allthisisthat.com> ray at allthisisthat.com>

Cc:  <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org

Subject: Re: [Owasp-csrfguard] can't get it to work

Message-ID: < <mailto:000401ce8280$5bbed1a0$133c74e0$@gmail.com> 000401ce8280$5bbed1a0$133c74e0$@gmail.com>

Content-Type: text/plain; charset="us-ascii"

P.S. I meant "/drbms/img/*" - I found that you usually need to include the context root 

 

From: Tom Barber [ <mailto:tom.a.barber at gmail.com> mailto:tom.a.barber at gmail.com]

Sent: 17 July 2013 00:27

To:  <mailto:ray at allthisisthat.com> ray at allthisisthat.com

Cc:  <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org

Subject: RE: [Owasp-csrfguard] can't get it to work

 

Hi Ray, Glad that helped!

 

I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:

 

# Case 2: longest path prefix match, beginning / and ending /*

So in the example you provided, that would be:

 

"/img/*"

 

This unprotects all files within the img directory. Another option would be

for:

# Case 3: extension match, beginning *.

"*.gif" for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.

 

As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)

 

Good luck!

 

Tom

 

From:  <mailto:ray at allthisisthat.com> ray at allthisisthat.com < <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com> [ <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com]

Sent: 16 July 2013 23:30

To: Tom Barber

Cc: Clough_Ray_allthisisthat;  <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org < <mailto:owasp-csrfguard at lists.owasp.org> mailto:owasp-csrfguard at lists.owasp.org>

Subject: RE: [Owasp-csrfguard] can't get it to work

 

You Rule!  It does indeed work, but now all my requests for images, css, etc

all fail with missing token messages.  I tried adding the config property

org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a

ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack

thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif,

error:required token is missing from the request).  What am I missing now?

Any ideas?

Also, I am now leaving the login page unprotected, which can't be a very

good idea.  Is there a better method using the NewTokenLandingPage?  I still

have that config setting, but it never goes there.  Should the

NewTokenLandingPage redirect to the login page, or what does it do?  There

isn't much discussion of this in the documentation, AFAIK.

Thanks very much for the help so far - there was some danger of me going

berserk, which is now receding into the distance.

- Ray Clough

 

 

---------------------------- Original Message ----------------------------

Subject: RE: [Owasp-csrfguard] can't get it to work

From: "Tom Barber" 

Date: Tue, July 16, 2013 2:30 pm

To:  <mailto:ray at allthisisthat.com> ray at allthisisthat.com < <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com> 

 <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org < <mailto:owasp-csrfguard at lists.owasp.org> mailto:owasp-csrfguard at lists.owasp.org> 

--------------------------------------------------------------------------

{C} 

Hi Ray,

 

I'm not certain this is the case, but I believe I know the problem. If you

look at the comments above the unprotected section of the property files the

options it gives you are:

 

# Case 1: exact match between request uri and unprotected page

# Case 2: longest path prefix match, beginning / and ending /*

# Case 3: extension match, beginning *.

# Default: requested resource must be validated by CSRFGuard

 

In your case you seem to have used wildcard in an unsupported manner

"/login*" . Perhaps you could specify the exact uri "drbms/login.seam"

 

Let me know if you have any luck.

 

Thanks

 

Tom

 

From:  < <mailto:owasp-csrfguard-bounces at lists.owasp.org> mailto:owasp-csrfguard-bounces at lists.owasp.org>

 <mailto:owasp-csrfguard-bounces at lists.owasp.org> owasp-csrfguard-bounces at lists.owasp.org [

< <mailto:owasp-csrfguard-bounces at lists.owasp.org> mailto:owasp-csrfguard-bounces at lists.owasp.org>

 <mailto:owasp-csrfguard-bounces at lists.owasp.org> mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of

< <mailto:ray at allthisisthat.com> mailto:ray at allthisisthat.com>  <mailto:ray at allthisisthat.com> ray at allthisisthat.com

Sent: 16 July 2013 21:44

To:  < <mailto:owasp-csrfguard at lists.owasp.org> mailto:owasp-csrfguard at lists.owasp.org>

 <mailto:owasp-csrfguard at lists.owasp.org> owasp-csrfguard at lists.owasp.org

Subject: [Owasp-csrfguard] can't get it to work

 

I am unable to get the CsrfGuard filter to work.  Regardless of the

properties I set, the app tries to go to the login page, and I get this log

message:

[Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:, ip:127.0.0.1,

uri:/drbms/login.seam, error:required token is missing from the request)

Obviously I am doing something wrong.  Here is my configuration file

org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger

org.owasp.csrfguard.UseNewTokenLandingPage=true

org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html

org.owasp.csrfguard.TokenPerPage=true

org.owasp.csrfguard.TokenPerPagePrecreate=false

org.owasp.csrfguard.Ajax=false

org.owasp.csrfguard.unprotected.Index=/login*

org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log

org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery

(CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,

error:%exception_message%)

org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN

org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN

org.owasp.csrfguard.TokenLength=32

org.owasp.csrfguard.PRNG=SHA1PRNG

When the server starts, I see the config properties output to the console,

so I know the config file is being read correctly.

I have tried various combinations of using a NewTokenLandingPage with the

login page protected, and un-protecting the login page but not using a New

Token Landing Page.  Also, I have seen no info on what the New Token Landing

Page needs to do - If I can ever get it to appear, my guess is that it needs

to redirect to the login page.  Is that correct?  Also, all the examples use

jsp, not facelets.  Are there any issues with this difference?  I built the

project from source using the latest code.

Any help you could offer would be greatly appreciated.

 

Thank you,

Ray Clough

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130718/a07dbd38/attachment-0001.html>

From ray at allthisisthat.com  Mon Jul 22 14:56:58 2013
From: ray at allthisisthat.com (Ray)
Date: Mon, 22 Jul 2013 07:56:58 -0700
Subject: [Owasp-csrfguard] can't get it to work
In-Reply-To: <005d01ce868e$93a22c40$bae684c0$@gmail.com>
References: <003901ce82b4$ef021ba0$cd0652e0$@gmail.com>
	<9d884997549f9d1cbef597241e58ae11.squirrel@mail.allthisisthat.com>
	<005d01ce868e$93a22c40$bae684c0$@gmail.com>
Message-ID: <6EBBE0CE-B1CA-4A78-9521-A8091ECC717C@allthisisthat.com>

Thank you, Manish.  As I noted earlier, there are certainly issues with this problem which I don't understand.  One thing we will do is to customize some of our properties during build.  Of course, som expression language capability would be great, if possible without sacrificing security.  This is also true for some relaxation of the strictness of the URL rules,

Thanks again,
Ray Clough


On Jul 21, 2013, at 8:50 PM, "Manish Java" <manish.in.java at gmail.com> wrote:

> Hi Ray
>  
> I recently ported CSRFGuard from ANT to Maven build system and had the chance to go through the source code during the migration process.  Looking through the code I got the feeling that Eric Sheridan (the project lead for CSRFGuard) wanted CSRFGuard to be a completely standalone library that did not have any dependencies on any other libraries.  I felt this because I came across some classes and code snippets that are readily available in other common libraries, such as, Apache Commons.
>  
> I think that the design decision to keep CSRFGuard as a standalone library is not a bad one.  Creating dependencies on third-party code that has not been scanned for security vulnerabilities could be risky for a security related project like CSRFGuard.
>  
> Having said that, I also take your point about the expression handlers.  I will look through the source code this week to see whether this can be changed.  If I can find an easy way to get the changes in, I will liaise with Eric to see if a version upgrade can be released.
>  
>  
> Best regards
> ~ Manish
>  
> From: ray at allthisisthat.com [mailto:ray at allthisisthat.com] 
> Sent: 18 July 2013 03:08
> To: Manish Java
> Cc: Clough_Ray_allthisisthat; owasp-csrfguard at lists.owasp.org; tom.a.barber at gmail.com
> Subject: RE: [Owasp-csrfguard] can't get it to work
>  
> Thanks very much.  I got it going now.  Too bad Expression Language tags not allowed, and also would be nice to allow something like /myapp/something/*.xyz or 'myapp/*/*.xyz.  Then we could do /myapp/*/*.css, for example, to allow css coming from libraries to be allowed, but still not specifying *.css, which allows css from anywhere.  Same is true, of course for images and js, etc.  But we can't have everything, or at least so I've been told (and I always believe what people tell me).  Maybe there are good reasons for the strictness of the three allowed patterns which I don't yet understand.
> 
> - Ray Clough
> 
> 
> ---------------------------- Original Message ----------------------------
> Subject: RE: [Owasp-csrfguard] can't get it to work
> From: "Manish Java" 
> Date: Tue, July 16, 2013 11:14 pm
> To: ray at allthisisthat.com
> Cc: owasp-csrfguard at lists.owasp.org
> tom.a.barber at gmail.com
> --------------------------------------------------------------------------
> 
> {C}
> 
> Hi Ray
> 
> I have found the following steps to be useful when working with CSRFGuard:
> 
>  
> 1.      Find out the context root for the application (say, / or /myapp or /drbms in your case);
> 
> 2.      Decide on which resources you would like to protect;
> 
> 3.      Decide on which resources you do not need to protect (possibly images, CSS files, JavaScript files, plain HTML files, etc.);
> 
> 4.      First configure the unprotected resources in the CSRFGuard configuration file, using org.owasp.csrfguard.unprotected configuration directives.  Make sure that you prefix the URLs with the context root.  An example configuration is given below:
> 
> org.owasp.csrfguard.unprotected.CSS=/myapp/css/*
> org.owasp.csrfguard.unprotected.HTML=/myapp/html/*
> org.owasp.csrfguard.unprotected.Image=/myapp/image/*
> org.owasp.csrfguard.unprotected.JavaScript=/myapp/script/*
> org.owasp.csrfguard.unprotected.PDF=/myapp/pdf/*
> 
> 5.      Add configuration settings for the protected resources, as per application requirements.
> 
>  
> 
> In our application we typically do the following:
> 
>  
> 1.      Configure the application root (/) as the new token landing page.  All this does is to ensure that any malicious attacker looking to target a specific page in any possible way is automatically redirected to the application?s home page (/).  In our applications the home page either does not present any sensitive data or automatically redirects to the login page, depending on the application.
> 
> 2.      We typically leave the login page unprotected as many users of our applications are likely to bookmark the login page.  In any case, the login page does not have any sensitive information so it is fine to leave it unprotected.
> 
> 3.      Our CSRFGuard properties file is generated on a per-environment through our Maven build.  This allows us to use different context roots for different environments and frees us up from having to maintain separate properties files.
> 
>  
> 
> If you have any further questions, please feel free to reply to this thread.  I will be happy to take a look at any issue you might be facing with CSRFGuard.
> 
>  
> Cheers
> 
> ~ Manish
> 
>  
> 
> Date: Wed, 17 Jul 2013 00:26:30 +0100
> 
> From: "Tom Barber" <tom.a.barber at gmail.com>
> 
> To: <ray at allthisisthat.com>
> 
> Cc: owasp-csrfguard at lists.owasp.org
> 
> Subject: Re: [Owasp-csrfguard] can't get it to work
> 
> Message-ID: <004f01ce827b$e779f1c0$b66dd540$@gmail.com>
> 
> Content-Type: text/plain; charset="us-ascii"
> 
> Hi Ray, Glad that helped!
> 
>  
> 
> I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:
> 
>  
> 
> # Case 2: longest path prefix match, beginning / and ending /*
> 
> So in the example you provided, that would be:
> 
>  
> 
> "/img/*"
> 
>  
> 
> This unprotects all files within the img directory. Another option would be
> 
> for:
> 
> # Case 3: extension match, beginning *.
> 
> "*.gif" for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.
> 
>  
> 
> As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)
> 
>  
> 
> Good luck!
> 
>  
> 
> Tom
> 
>  
> 
> From: ray at allthisisthat.com [mailto:ray at allthisisthat.com]
> 
> Sent: 16 July 2013 23:30
> 
> To: Tom Barber
> 
> Cc: Clough_Ray_allthisisthat; owasp-csrfguard at lists.owasp.org
> 
> Subject: RE: [Owasp-csrfguard] can't get it to work
> 
>  
> 
> You Rule!  It does indeed work, but now all my requests for images, css, etc all fail with missing token messages.  I tried adding the config property org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif, error:required token is missing from the request).  What am I missing now?
> 
> Any ideas?
> 
> Also, I am now leaving the login page unprotected, which can't be a very good idea.  Is there a better method using the NewTokenLandingPage?  I still have that config setting, but it never goes there.  Should the NewTokenLandingPage redirect to the login page, or what does it do?  There isn't much discussion of this in the documentation, AFAIK.
> 
> Thanks very much for the help so far - there was some danger of me going berserk, which is now receding into the distance.
> 
> - Ray Clough
> 
>  
> 
>  
> ---------------------------- Original Message ----------------------------
> 
> Subject: RE: [Owasp-csrfguard] can't get it to work
> 
> From: "Tom Barber"
> 
> Date: Tue, July 16, 2013 2:30 pm
> 
> To: ray at allthisisthat.com <mailto:ray at allthisisthat.com> owasp-csrfguard at lists.owasp.org <mailto:owasp-csrfguard at lists.owasp.org>
> 
> --------------------------------------------------------------------------
> 
> {C}
> 
> Hi Ray,
> 
>  
> 
> I'm not certain this is the case, but I believe I know the problem. If you look at the comments above the unprotected section of the property files the options it gives you are:
> 
>  
> 
> # Case 1: exact match between request uri and unprotected page
> 
> # Case 2: longest path prefix match, beginning / and ending /*
> 
> # Case 3: extension match, beginning *.
> 
> # Default: requested resource must be validated by CSRFGuard
> 
>  
> 
> In your case you seem to have used wildcard in an unsupported manner "/login*" . Perhaps you could specify the exact uri "drbms/login.seam"
> 
>  
> 
> Let me know if you have any luck.
> 
>  
> 
> Thanks
> 
>  
> 
> Tom
> 
>  
> 
> From:  <mailto:owasp-csrfguard-bounces at lists.owasp.org>
> 
> owasp-csrfguard-bounces at lists.owasp.org [ <mailto:owasp-csrfguard-bounces at lists.owasp.org>
> 
> mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of <mailto:ray at allthisisthat.com> ray at allthisisthat.com
> 
> Sent: 16 July 2013 21:44
> 
> To:  <mailto:owasp-csrfguard at lists.owasp.org>
> 
> owasp-csrfguard at lists.owasp.org
> 
> Subject: [Owasp-csrfguard] can't get it to work
> 
>  
> 
> I am unable to get the CsrfGuard filter to work.  Regardless of the properties I set, the app tries to go to the login page, and I get this log
> 
> message:
> 
> [Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery
> 
> (CSRF) attack thwarted (user:, ip:127.0.0.1, uri:/drbms/login.seam, error:required token is missing from the request)
> 
> Obviously I am doing something wrong.  Here is my configuration file
> 
> org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
> 
> org.owasp.csrfguard.UseNewTokenLandingPage=true
> 
> org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
> 
> org.owasp.csrfguard.TokenPerPage=true
> 
> org.owasp.csrfguard.TokenPerPagePrecreate=false
> 
> org.owasp.csrfguard.Ajax=false
> 
> org.owasp.csrfguard.unprotected.Index=/login*
> 
> org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
> 
> org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery
> 
> (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,
> 
> error:%exception_message%)
> 
> org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
> 
> org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
> 
> org.owasp.csrfguard.TokenLength=32
> 
> org.owasp.csrfguard.PRNG=SHA1PRNG
> 
> When the server starts, I see the config properties output to the console, so I know the config file is being read correctly.
> 
> I have tried various combinations of using a NewTokenLandingPage with the login page protected, and un-protecting the login page but not using a New Token Landing Page.  Also, I have seen no info on what the New Token Landing Page needs to do - If I can ever get it to appear, my guess is that it needs to redirect to the login page.  Is that correct?  Also, all the examples use jsp, not facelets.  Are there any issues with this difference?  I built the project from source using the latest code.
> 
> Any help you could offer would be greatly appreciated.
> 
>  
> 
> Thank you,
> 
> Ray Clough
> 
>  
> 
>  
> 
> -------------- next part --------------
> 
> An HTML attachment was scrubbed...
> 
> URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130717/ba23fb5f/attachment-0001.html>
> 
> ------------------------------
> 
> Message: 2
> 
> Date: Wed, 17 Jul 2013 00:58:23 +0100
> 
> From: "Tom Barber" <tom.a.barber at gmail.com>
> 
> To: <ray at allthisisthat.com>
> 
> Cc: owasp-csrfguard at lists.owasp.org
> 
> Subject: Re: [Owasp-csrfguard] can't get it to work
> 
> Message-ID: <000401ce8280$5bbed1a0$133c74e0$@gmail.com>
> 
> Content-Type: text/plain; charset="us-ascii"
> 
> P.S. I meant "/drbms/img/*" - I found that you usually need to include the context root
> 
>  
> 
> From: Tom Barber [mailto:tom.a.barber at gmail.com]
> 
> Sent: 17 July 2013 00:27
> 
> To: ray at allthisisthat.com
> 
> Cc: owasp-csrfguard at lists.owasp.org
> 
> Subject: RE: [Owasp-csrfguard] can't get it to work
> 
>  
> 
> Hi Ray, Glad that helped!
> 
>  
> 
> I'm no expert in CSRFGuard (only started trying it out myself recently as a POC), but when I faced a similar issue I decided that I didn't really care about protecting images, so what I did was use the:
> 
>  
> 
> # Case 2: longest path prefix match, beginning / and ending /*
> 
> So in the example you provided, that would be:
> 
>  
> 
> "/img/*"
> 
>  
> 
> This unprotects all files within the img directory. Another option would be
> 
> for:
> 
> # Case 3: extension match, beginning *.
> 
> "*.gif" for each img extension type, perhaps useful if you have images in many different locations - though your example suggests otherwise.
> 
>  
> 
> As for leaving the login page unprotected, I don't think that is a problem (again, im no expert though..) a CSRF attack against a login page would only be able to potentially log a user into the application if valid parameters are supplied in the malicious request and valid users need to be able to access the site via the login screen and they wont have a token when they first visit -  though I'm not familiar with the newtokenlandingpage, which could be the alternative solution for all I know :)
> 
>  
> 
> Good luck!
> 
>  
> 
> Tom
> 
>  
> 
> From: ray at allthisisthat.com <mailto:ray at allthisisthat.com> [mailto:ray at allthisisthat.com]
> 
> Sent: 16 July 2013 23:30
> 
> To: Tom Barber
> 
> Cc: Clough_Ray_allthisisthat; owasp-csrfguard at lists.owasp.org <mailto:owasp-csrfguard at lists.owasp.org>
> 
> Subject: RE: [Owasp-csrfguard] can't get it to work
> 
>  
> 
> You Rule!  It does indeed work, but now all my requests for images, css, etc
> 
> all fail with missing token messages.  I tried adding the config property
> 
> org.owasp.csrfguard.Ajax=true, but this makes no difference.  I still get a
> 
> ton of messages like: Potential Cross-Site Request Forgery (CSRF) attack
> 
> thwarted (user:, ip:127.0.0.1, uri:/drbms/img/sort_down.gif,
> 
> error:required token is missing from the request).  What am I missing now?
> 
> Any ideas?
> 
> Also, I am now leaving the login page unprotected, which can't be a very
> 
> good idea.  Is there a better method using the NewTokenLandingPage?  I still
> 
> have that config setting, but it never goes there.  Should the
> 
> NewTokenLandingPage redirect to the login page, or what does it do?  There
> 
> isn't much discussion of this in the documentation, AFAIK.
> 
> Thanks very much for the help so far - there was some danger of me going
> 
> berserk, which is now receding into the distance.
> 
> - Ray Clough
> 
>  
> 
>  
> ---------------------------- Original Message ----------------------------
> 
> Subject: RE: [Owasp-csrfguard] can't get it to work
> 
> From: "Tom Barber"
> 
> Date: Tue, July 16, 2013 2:30 pm
> 
> To: ray at allthisisthat.com <mailto:ray at allthisisthat.com>
> 
> owasp-csrfguard at lists.owasp.org <mailto:owasp-csrfguard at lists.owasp.org>
> 
> --------------------------------------------------------------------------
> 
> {C}
> 
> Hi Ray,
> 
>  
> 
> I'm not certain this is the case, but I believe I know the problem. If you
> 
> look at the comments above the unprotected section of the property files the
> 
> options it gives you are:
> 
>  
> 
> # Case 1: exact match between request uri and unprotected page
> 
> # Case 2: longest path prefix match, beginning / and ending /*
> 
> # Case 3: extension match, beginning *.
> 
> # Default: requested resource must be validated by CSRFGuard
> 
>  
> 
> In your case you seem to have used wildcard in an unsupported manner
> 
> "/login*" . Perhaps you could specify the exact uri "drbms/login.seam"
> 
>  
> 
> Let me know if you have any luck.
> 
>  
> 
> Thanks
> 
>  
> 
> Tom
> 
>  
> 
> From:  <mailto:owasp-csrfguard-bounces at lists.owasp.org>
> 
> owasp-csrfguard-bounces at lists.owasp.org [
> 
> <mailto:owasp-csrfguard-bounces at lists.owasp.org>
> 
> mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of
> 
> <mailto:ray at allthisisthat.com> ray at allthisisthat.com
> 
> Sent: 16 July 2013 21:44
> 
> To:  <mailto:owasp-csrfguard at lists.owasp.org>
> 
> owasp-csrfguard at lists.owasp.org
> 
> Subject: [Owasp-csrfguard] can't get it to work
> 
>  
> 
> I am unable to get the CsrfGuard filter to work.  Regardless of the
> 
> properties I set, the app tries to go to the login page, and I get this log
> 
> message:
> 
> [Tue Jul 16 13:08:38 PDT 2013] [Error] Potential Cross-Site Request Forgery
> 
> (CSRF) attack thwarted (user:, ip:127.0.0.1,
> 
> uri:/drbms/login.seam, error:required token is missing from the request)
> 
> Obviously I am doing something wrong.  Here is my configuration file
> 
> org.owasp.csrfguard.Logger=org.owasp.csrfguard.log.ConsoleLogger
> 
> org.owasp.csrfguard.UseNewTokenLandingPage=true
> 
> org.owasp.csrfguard.NewTokenLandingPage=/NewTokenLandingPage.html
> 
> org.owasp.csrfguard.TokenPerPage=true
> 
> org.owasp.csrfguard.TokenPerPagePrecreate=false
> 
> org.owasp.csrfguard.Ajax=false
> 
> org.owasp.csrfguard.unprotected.Index=/login*
> 
> org.owasp.csrfguard.action.Log=org.owasp.csrfguard.action.Log
> 
> org.owasp.csrfguard.action.Log.Message=Potential Cross-Site Request Forgery
> 
> (CSRF) attack thwarted (user:%user%, ip:%remote_ip%, uri:%request_uri%,
> 
> error:%exception_message%)
> 
> org.owasp.csrfguard.TokenName=OWASP_CSRFTOKEN
> 
> org.owasp.csrfguard.SessionKey=OWASP_CSRFTOKEN
> 
> org.owasp.csrfguard.TokenLength=32
> 
> org.owasp.csrfguard.PRNG=SHA1PRNG
> 
> When the server starts, I see the config properties output to the console,
> 
> so I know the config file is being read correctly.
> 
> I have tried various combinations of using a NewTokenLandingPage with the
> 
> login page protected, and un-protecting the login page but not using a New
> 
> Token Landing Page.  Also, I have seen no info on what the New Token Landing
> 
> Page needs to do - If I can ever get it to appear, my guess is that it needs
> 
> to redirect to the login page.  Is that correct?  Also, all the examples use
> 
> jsp, not facelets.  Are there any issues with this difference?  I built the
> 
> project from source using the latest code.
> 
> Any help you could offer would be greatly appreciated.
> 
>  
> 
> Thank you,
> 
> Ray Clough
> 
>  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130722/558d8a40/attachment-0001.html>

From ray at allthisisthat.com  Mon Jul 22 23:51:49 2013
From: ray at allthisisthat.com (ray at allthisisthat.com)
Date: Mon, 22 Jul 2013 16:51:49 -0700
Subject: [Owasp-csrfguard] CSRFGuard problem
Message-ID: <3ab73c93f85dd7df6730fe8134d2e9dd.squirrel@mail.allthisisthat.com>




I have added CSRFGuard to an existing project which is based on JSF using Seam 2.2.? My initial testing was very positive, until I started testing use cases which generated exceptions.? What I am finding is that Seam (or JSF) error handling is being interfered with by CSRFGuard.?
As a result, I can get into a situation where the app is frozen, and you can't even call up the app from a new tab with the login url.? I have to restart the server in order to get any pages to work.? The only thing I have found which allows me to proceed is to invalidate the session when
any potential CSRF attack is detected, by using the configuration option: "org.owasp.csrfguard.action.Invalidate=org.owasp.csrfguard.action.Invalidate".? Of course, this is extremely unfriendly, as the user is suddenly returned to the login page with no warning or message about
why.
I tried to configure an error page to redirect to by using:
org.owasp.csrfguard.action.Redirect=org.owasp.csrfguard.action.Redirect
org.owasp.csrfguard.action.Redirect.Page=/CSRFError.html
but even this doesn't work as the conflict between Seam and CSRFGuard prevents the redirect from being processed.? Basically, Seam is stuck in error mode, and there is nothing I have been able to do about it.
Does anyone have
any suggestions?? Has anyone else had a similar problem?? I'm sure that there could equally well be conflicts with other frameworks besides JSF with Seam. ? I am about to remove CSRFGuard and use Seam's s:token tag to protect the POST requests - which, of course, leaves GET
unprotected.? I'd really rather not get into that, if there is some clever configuration I could use which would enable me to continue to use CSRFGuard.
Thanks in advance,
Ray Clough
?
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130722/e33b5811/attachment.html>

From thomas.x.barber at jpmorgan.com  Tue Jul 23 08:29:25 2013
From: thomas.x.barber at jpmorgan.com (Barber, Thomas X)
Date: Tue, 23 Jul 2013 08:29:25 +0000
Subject: [Owasp-csrfguard] CSRFGuard problem
In-Reply-To: <3ab73c93f85dd7df6730fe8134d2e9dd.squirrel@mail.allthisisthat.com>
References: <3ab73c93f85dd7df6730fe8134d2e9dd.squirrel@mail.allthisisthat.com>
Message-ID: <A0FDB8D63716494EA24A037FDE02C136252C9E07@SBACMX003.exchad.jpmchase.net>

I?m not very familiar with the issue you are facing, but is it possible that on an exception the seam error handling tries to redirect to a page that isn?t defined as being ?unprotected? which would cause CSRFGuard verification to fail constantly in a loop? If you are redirecting to a page in seam can you try defining it as being unprotected?

Thanks

Tom

Tom Barber | Application Developer GFS - Technology | Corporate & Investment Bank (CIB) | J.P. Morgan, Chaseside - Hampshire Building, Floor 2, Bournemouth BH7 7DA, United Kingdom | T:+44 (0)1202 320097 |  thomas.X.barber at jpmorgan.com<mailto:thomas.x.barber at jpmorgan.com>

From: owasp-csrfguard-bounces at lists.owasp.org [mailto:owasp-csrfguard-bounces at lists.owasp.org] On Behalf Of ray at allthisisthat.com
Sent: 23 July 2013 00:52
To: owasp-csrfguard at lists.owasp.org
Subject: [Owasp-csrfguard] CSRFGuard problem


I have added CSRFGuard to an existing project which is based on JSF using Seam 2.2.  My initial testing was very positive, until I started testing use cases which generated exceptions.  What I am finding is that Seam (or JSF) error handling is being interfered with by CSRFGuard.  As a result, I can get into a situation where the app is frozen, and you can't even call up the app from a new tab with the login url.  I have to restart the server in order to get any pages to work.  The only thing I have found which allows me to proceed is to invalidate the session when any potential CSRF attack is detected, by using the configuration option: "org.owasp.csrfguard.action.Invalidate=org.owasp.csrfguard.action.Invalidate".  Of course, this is extremely unfriendly, as the user is suddenly returned to the login page with no warning or message about why.

I tried to configure an error page to redirect to by using:

org.owasp.csrfguard.action.Redirect=org.owasp.csrfguard.action.Redirect
org.owasp.csrfguard.action.Redirect.Page=/CSRFError.html

but even this doesn't work as the conflict between Seam and CSRFGuard prevents the redirect from being processed.  Basically, Seam is stuck in error mode, and there is nothing I have been able to do about it.

Does anyone have any suggestions?  Has anyone else had a similar problem?  I'm sure that there could equally well be conflicts with other frameworks besides JSF with Seam.   I am about to remove CSRFGuard and use Seam's s:token tag to protect the POST requests - which, of course, leaves GET unprotected.  I'd really rather not get into that, if there is some clever configuration I could use which would enable me to continue to use CSRFGuard.

Thanks in advance,

Ray Clough




This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130723/96eb25c6/attachment.html>

From ray at allthisisthat.com  Tue Jul 23 23:43:58 2013
From: ray at allthisisthat.com (ray at allthisisthat.com)
Date: Tue, 23 Jul 2013 16:43:58 -0700
Subject: [Owasp-csrfguard] CSRFGuard problem
In-Reply-To: <A0FDB8D63716494EA24A037FDE02C136252C9E07@SBACMX003.exchad.jpmchase.net>
References: <3ab73c93f85dd7df6730fe8134d2e9dd.squirrel@mail.allthisisthat.com>
	<A0FDB8D63716494EA24A037FDE02C136252C9E07@SBACMX003.exchad.jpmchase.net>
Message-ID: <b63f2a3abd51952673bb3104de65303e.squirrel@mail.allthisisthat.com>




Thanks, Tom.? The only solution I could get to work was to make the page a static html page instead of a jsf facelet.? There was just a lot of conflict between the CSRFGuard redirect mechanism and the JSF (Seam) redirect mechanism.? I also had to specify the error page as not
CSRFGuard protected (as you suggested), and had to specify it as "/myapp/CSRFError.html", which puts the context root into the configuration file, which is undesireable, of course.? Eventually, this will be replaced with a token for replacement during the build process.
Thanks
for your help,
Ray Clough
?

---------------------------- Original Message ----------------------------

Subject: RE: [Owasp-csrfguard] CSRFGuard problem

From: "Barber, Thomas X" 

Date: Tue, July 23, 2013 1:29 am

To: "ray at allthisisthat.com" 

"owasp-csrfguard at lists.owasp.org" 

--------------------------------------------------------------------------



<style type="text/css">
-></style>




?

	

	
		

		I&rsquo;m not very familiar with the issue you are facing, but is it possible that on an exception the seam error handling tries to redirect to a page that isn&rsquo;t

		defined as being &ldquo;unprotected&rdquo; which would cause CSRFGuard verification to fail constantly in a loop? If you are redirecting to a page in seam can you try defining it as being unprotected??Thanks?Tom?Tom Barber
		| Application Developer

		GFS - Technology | Corporate & Investment Bank (CIB) |

		J.P. Morgan,

		Chaseside - Hampshire Building, Floor 2, Bournemouth BH7 7DA, United Kingdom | T:+44 (0)1202 320097 |?

		thomas.X.barber at jpmorgan.com?		
			

			From: owasp-csrfguard-bounces at lists.owasp.org
[mailto:owasp-csrfguard-bounces at lists.owasp.org]
			On Behalf Of ray at allthisisthat.com

			Sent: 23 July 2013 00:52

			To: owasp-csrfguard at lists.owasp.org

			Subject: [Owasp-csrfguard] CSRFGuard problem
		

		?
I have added CSRFGuard to an existing project which is based on JSF using Seam 2.2.? My initial testing was very positive, until I started testing use cases which generated exceptions.? What I am finding is that Seam (or JSF) error handling is being
interfered
		with by CSRFGuard.? As a result, I can get into a situation where the app is frozen, and you can't even call up the app from a new tab with the login url.? I have to restart the server in order to get any pages to work.? The only thing I have found which allows

		me to proceed is to invalidate the session when any potential CSRF attack is detected, by using the configuration option: "org.owasp.csrfguard.action.Invalidate=org.owasp.csrfguard.action.Invalidate".? Of course, this is extremely unfriendly, as the user is

		suddenly returned to the login page with no warning or message about why.
I tried to configure an error page to redirect to by using:
org.owasp.csrfguard.action.Redirect=org.owasp.csrfguard.action.Redirect

		org.owasp.csrfguard.action.Redirect.Page=/CSRFError.html
but even this doesn't work as the conflict between Seam and CSRFGuard prevents the redirect from being processed.? Basically, Seam is stuck in error mode, and there is nothing I have been able to do about it.
Does anyone
have any suggestions?? Has anyone else had a similar problem?? I'm sure that there could equally well be conflicts with other frameworks besides JSF with Seam. ? I am about to remove CSRFGuard and use Seam's s:token tag to protect the POST requests
		- which, of course, leaves GET unprotected.? I'd really rather not get into that, if there is some clever configuration I could use which would enable me to continue to use CSRFGuard.
Thanks in advance,
Ray Clough

		?
?
	

	


	This email is confidential and subject to important disclaimers and conditions including on offers for the purchase or sale of securities, accuracy and completeness of information, viruses, confidentiality, legal privilege, and legal entity
disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email. 






?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130723/0ff355c6/attachment.html>

From manish.in.java at gmail.com  Wed Jul 24 12:44:43 2013
From: manish.in.java at gmail.com (Manish Java)
Date: Wed, 24 Jul 2013 18:14:43 +0530
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 35, Issue 11
In-Reply-To: <mailman.13.1374667205.21320.owasp-csrfguard@lists.owasp.org>
References: <mailman.13.1374667205.21320.owasp-csrfguard@lists.owasp.org>
Message-ID: <CAFQ4Oy3+HKSdDJ2y09jb4y_3jR4FgbR+0TDbSPOdPJ8JmOT2uQ@mail.gmail.com>

This seems symptomatic of the error page being a protected resource as
well, which will cause CSRFGuard to go into an infinite loop.

I have created a Seam version of the CSRFGuard test application.  You can
try it out from https://github.com/manish-in-java/OWASP-CSRFGuard.  If you
have Java 6.0+ and Maven 3.0.4+ on your machine, you can simply download
the Seam sample project and run it as mvn clean package tomcat7:run.

I did not find any loops in the sample application.  You may want to
compare the configuration file in the sample application with yours to see
if you can spot any quick differences.


On Wed, Jul 24, 2013 at 5:30 PM, <owasp-csrfguard-request at lists.owasp.org>wrote:

> Send Owasp-csrfguard mailing list submissions to
>         owasp-csrfguard at lists.owasp.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> or, via email, send a message with subject or body 'help' to
>         owasp-csrfguard-request at lists.owasp.org
>
> You can reach the person managing the list at
>         owasp-csrfguard-owner at lists.owasp.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-csrfguard digest..."
>
>
> Today's Topics:
>
>    1. Re: CSRFGuard problem (ray at allthisisthat.com)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Tue, 23 Jul 2013 16:43:58 -0700
> From: ray at allthisisthat.com
> To: "Barber, Thomas X" <thomas.x.barber at jpmorgan.com>
> Cc: "owasp-csrfguard at lists.owasp.org"
>         <owasp-csrfguard at lists.owasp.org>
> Subject: Re: [Owasp-csrfguard] CSRFGuard problem
> Message-ID:
>         <b63f2a3abd51952673bb3104de65303e.squirrel at mail.allthisisthat.com>
> Content-Type: text/plain; charset="utf-8"
>
>
>
>
> Thanks, Tom.? The only solution I could get to work was to make the page a
> static html page instead of a jsf facelet.? There was just a lot of
> conflict between the CSRFGuard redirect mechanism and the JSF (Seam)
> redirect mechanism.? I also had to specify the error page as not
> CSRFGuard protected (as you suggested), and had to specify it as
> "/myapp/CSRFError.html", which puts the context root into the configuration
> file, which is undesireable, of course.? Eventually, this will be replaced
> with a token for replacement during the build process.
> Thanks
> for your help,
> Ray Clough
> ?
>
> ---------------------------- Original Message ----------------------------
>
> Subject: RE: [Owasp-csrfguard] CSRFGuard problem
>
> From: "Barber, Thomas X"
>
> Date: Tue, July 23, 2013 1:29 am
>
> To: "ray at allthisisthat.com"
>
> "owasp-csrfguard at lists.owasp.org"
>
> --------------------------------------------------------------------------
>
>
>
> <style type="text/css">
> -></style>
>
>
>
>
> ?
>
>
>
>
>
>
>                 I&rsquo;m not very familiar with the issue you are facing,
> but is it possible that on an exception the seam error handling tries to
> redirect to a page that isn&rsquo;t
>
>                 defined as being &ldquo;unprotected&rdquo; which would
> cause CSRFGuard verification to fail constantly in a loop? If you are
> redirecting to a page in seam can you try defining it as being
> unprotected??Thanks?Tom?Tom Barber
>                 | Application Developer
>
>                 GFS - Technology | Corporate & Investment Bank (CIB) |
>
>                 J.P. Morgan,
>
>                 Chaseside - Hampshire Building, Floor 2, Bournemouth BH7
> 7DA, United Kingdom | T:+44 (0)1202 320097 |?
>
>                 thomas.X.barber at jpmorgan.com?
>
>
>                         From: owasp-csrfguard-bounces at lists.owasp.org
> [mailto:owasp-csrfguard-bounces at lists.owasp.org]
>                         On Behalf Of ray at allthisisthat.com
>
>                         Sent: 23 July 2013 00:52
>
>                         To: owasp-csrfguard at lists.owasp.org
>
>                         Subject: [Owasp-csrfguard] CSRFGuard problem
>
>
>                 ?
> I have added CSRFGuard to an existing project which is based on JSF using
> Seam 2.2.? My initial testing was very positive, until I started testing
> use cases which generated exceptions.? What I am finding is that Seam (or
> JSF) error handling is being
> interfered
>                 with by CSRFGuard.? As a result, I can get into a
> situation where the app is frozen, and you can't even call up the app from
> a new tab with the login url.? I have to restart the server in order to get
> any pages to work.? The only thing I have found which allows
>
>                 me to proceed is to invalidate the session when any
> potential CSRF attack is detected, by using the configuration option:
> "org.owasp.csrfguard.action.Invalidate=org.owasp.csrfguard.action.Invalidate".?
> Of course, this is extremely unfriendly, as the user is
>
>                 suddenly returned to the login page with no warning or
> message about why.
> I tried to configure an error page to redirect to by using:
> org.owasp.csrfguard.action.Redirect=org.owasp.csrfguard.action.Redirect
>
>                 org.owasp.csrfguard.action.Redirect.Page=/CSRFError.html
> but even this doesn't work as the conflict between Seam and CSRFGuard
> prevents the redirect from being processed.? Basically, Seam is stuck in
> error mode, and there is nothing I have been able to do about it.
> Does anyone
> have any suggestions?? Has anyone else had a similar problem?? I'm sure
> that there could equally well be conflicts with other frameworks besides
> JSF with Seam. ? I am about to remove CSRFGuard and use Seam's s:token tag
> to protect the POST requests
>                 - which, of course, leaves GET unprotected.? I'd really
> rather not get into that, if there is some clever configuration I could use
> which would enable me to continue to use CSRFGuard.
> Thanks in advance,
> Ray Clough
>
>                 ?
> ?
>
>
>
>
>
>         This email is confidential and subject to important disclaimers
> and conditions including on offers for the purchase or sale of securities,
> accuracy and completeness of information, viruses, confidentiality, legal
> privilege, and legal entity
> disclaimers, available at http://www.jpmorgan.com/pages/disclosures/email.
>
>
>
>
>
>
> ?
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130723/0ff355c6/attachment-0001.html
> >
>
> ------------------------------
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>
> End of Owasp-csrfguard Digest, Vol 35, Issue 11
> ***********************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20130724/af30f66b/attachment.html>

