<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] first access behind a proxy
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20first%20access%20behind%20a%20proxy&In-Reply-To=%3CCAHuzxHLvhu%3DS5XACVTe8a5X-sa7cB2umOxFaVcSGweFz0AyAwA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000312.html">
   <LINK REL="Next"  HREF="000314.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] first access behind a proxy</H1>
    <B>Johannes Schmidt</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20first%20access%20behind%20a%20proxy&In-Reply-To=%3CCAHuzxHLvhu%3DS5XACVTe8a5X-sa7cB2umOxFaVcSGweFz0AyAwA%40mail.gmail.com%3E"
       TITLE="[Owasp-csrfguard] first access behind a proxy">johannes.schmidt at saludhds.com.mx
       </A><BR>
    <I>Tue Jul 29 18:08:22 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000312.html">[Owasp-csrfguard] Fwd: Known Issues
</A></li>
        <LI>Next message: <A HREF="000314.html">[Owasp-csrfguard] generate token
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#313">[ date ]</a>
              <a href="thread.html#313">[ thread ]</a>
              <a href="subject.html#313">[ subject ]</a>
              <a href="author.html#313">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

as I understand CSRF Guard you have to define the pages you use as
entry-points, like the login page. So Guard is excluding its validation
regarding this pages.

The aplication of my company has a diferent arquitecture which makes it
dificult to use CSRF-Guard. Hopefully somebody can help:

We are using a php app as a main frame which includes JSF as iFrames. The
requests to the JSF are handled by rewrite-rules in the Apache which points
to a proxy. The proxy finally generates the requests pointing to a JBoss.
The ProxyPassReverse-Module in the apache handles the responses from the
JBoss.

The problem here is: for PHP we use a diferent mecanism to secure the
requests. The Login-Sequence as well is handled by PHP. At the point the
users opens the modules which are written in JSF pointing to the JBoss the
authentication already has happened.

CSRF Guard in our case is sensing attacks of each access the JSF-modules,
because for CSRF Guard it is the first access.

Of course I dont want to exclude all the modules from the Guard!

So my question is: is there any easy way to 'tell' CSRF Gaurd that
proxy-request are allowed? Because in this case we already have an
authenticated user...

At the moment we are working on WebService-based solution: we implement a
WS in JBoss which returns an CSRF-ID. This service we call from the proxy
module in PHP and we add teh CSRF-ID to the request-header. CSRF Guard
hopefully will let us pass.

The 'but' is that I dont want to deploy a WS which is returing tokens, this
is an open door for hackers, too.

Hope you can help

PD: this is related?
<A HREF="http://stackoverflow.com/questions/22483397/csrfguard-behind-a-reverse-proxy">http://stackoverflow.com/questions/22483397/csrfguard-behind-a-reverse-proxy</A>

Best,
Johannes
--

-- 
Health Digital Systems S.A.P.I. de C.V., con domicilio en Insurgentes Sur 
No. 617 Int 3, Col. Napoles, Delegaci&#243;n Benito Juarez, C.P. 03810, Mexico, 
D.F., Tel. (55) 3690 0430, es responsable de recabar los datos personales 
con la finalidad de informar, contratar, prospectar y promocionar los 
productos y/o servicios, con base al cumplimiento de la LFPDPPP. Para mayor 
informacion puede consultar el Aviso de Privacidad completo en 
<A HREF="http://avisodeprivacidad.saludhds.com.mx">http://avisodeprivacidad.saludhds.com.mx</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140729/014dcc32/attachment.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140729/014dcc32/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000312.html">[Owasp-csrfguard] Fwd: Known Issues
</A></li>
	<LI>Next message: <A HREF="000314.html">[Owasp-csrfguard] generate token
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#313">[ date ]</a>
              <a href="thread.html#313">[ thread ]</a>
              <a href="subject.html#313">[ subject ]</a>
              <a href="author.html#313">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
