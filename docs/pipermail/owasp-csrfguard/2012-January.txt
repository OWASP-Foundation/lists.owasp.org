From gautamashishkumar at gmail.com  Tue Jan  3 09:06:40 2012
From: gautamashishkumar at gmail.com (ashish kumar Gautam)
Date: Tue, 3 Jan 2012 14:36:40 +0530
Subject: [Owasp-csrfguard] How to exclude css anf jpeg file from csrf token?
Message-ID: <CACtUEVn3Ua4Zc7PP53Sn1PkjS33uQNsOb0=oG8E8PMPzqu9CDw@mail.gmail.com>

Dear All,


I am able to config CSRF Guard in our project and project is working well.

But Problem is that  CSRF Guard enforce to send a csrf token during call to
the CSS file and JPEG file.
How it is possible to exclude the ccs and jpeg file?


*Console:-*
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/index.jsp
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/style.css
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/images/quote_top.jpg
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/images/body_bg.jpg
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/images/header_selected.jpg
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/images/logo.jpg
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/images/quote_bottom.jpg
[Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request forgery
(CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
uri:/csrfguardfixed/images/body_bg.jpg, error:required token is missing
from the request)
[Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request forgery
(CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
uri:/csrfguardfixed/images/quote_top.jpg, error:required token is missing
from the request)
[Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request forgery
(CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
uri:/csrfguardfixed/images/quote_bottom.jpg, error:required token is
missing from the request)
[Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request forgery
(CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
uri:/csrfguardfixed/images/header_selected.jpg, error:required token is
missing from the request)
[Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request forgery
(CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
uri:/csrfguardfixed/images/logo.jpg, error:required token is missing from
the request)
[Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
/csrfguardfixed/error.jsp



-- 
Best regards,
Ashish K. Gautam
NIC, Delhi INDIA
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120103/bf9f5f04/attachment.html>

From afomin at jaspersoft.com  Tue Jan  3 15:38:43 2012
From: afomin at jaspersoft.com (Anton Fomin)
Date: Tue, 3 Jan 2012 17:38:43 +0200
Subject: [Owasp-csrfguard] How to exclude css anf jpeg file from csrf
	token?
In-Reply-To: <CACtUEVn3Ua4Zc7PP53Sn1PkjS33uQNsOb0=oG8E8PMPzqu9CDw@mail.gmail.com>
References: <CACtUEVn3Ua4Zc7PP53Sn1PkjS33uQNsOb0=oG8E8PMPzqu9CDw@mail.gmail.com>
Message-ID: <CAGzcv2ap2qHSh0TR1vBf_Q0uVNF_Xn=y_mS0vYBXr-8Wm53QgQ@mail.gmail.com>

Hi,

Looks like you need to set your resource uri to unprotected uri's list in
Csrf Guard configuration. Hope your resources and pages have different
uri's. In the other hand, you can play with Csrf filter uri pattern.

Thanks,
Anton.


2012/1/3 ashish kumar Gautam <gautamashishkumar at gmail.com>

>
> Dear All,
>
>
> I am able to config CSRF Guard in our project and project is working well.
>
> But Problem is that  CSRF Guard enforce to send a csrf token during call
> to the CSS file and JPEG file.
> How it is possible to exclude the ccs and jpeg file?
>
>
> *Console:-*
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/index.jsp
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/style.css
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/images/quote_top.jpg
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/images/body_bg.jpg
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/images/header_selected.jpg
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/images/logo.jpg
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/images/quote_bottom.jpg
> [Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request
> forgery (CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
> uri:/csrfguardfixed/images/body_bg.jpg, error:required token is missing
> from the request)
> [Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request
> forgery (CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
> uri:/csrfguardfixed/images/quote_top.jpg, error:required token is missing
> from the request)
> [Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request
> forgery (CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
> uri:/csrfguardfixed/images/quote_bottom.jpg, error:required token is
> missing from the request)
> [Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request
> forgery (CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
> uri:/csrfguardfixed/images/header_selected.jpg, error:required token is
> missing from the request)
> [Tue Jan 03 14:24:13 IST 2012] [Error] potential cross-site request
> forgery (CSRF) attack thwarted (user:<anonymous>, ip:10.1.10.129,
> uri:/csrfguardfixed/images/logo.jpg, error:required token is missing from
> the request)
> [Tue Jan 03 14:24:13 IST 2012] [Info] CsrfGuard analyzing request
> /csrfguardfixed/error.jsp
>
>
>
> --
> Best regards,
> Ashish K. Gautam
> NIC, Delhi INDIA
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120103/474a4c1c/attachment.html>

From forellacecile at hotmail.fr  Thu Jan 12 10:32:27 2012
From: forellacecile at hotmail.fr (cecile forella)
Date: Thu, 12 Jan 2012 10:32:27 +0000
Subject: [Owasp-csrfguard] [Error] potential cross-site request forgery
	(CSRF) attack thwarted
Message-ID: <SNT120-W46CABA1C6624544D5BA417C09F0@phx.gbl>


Hello,
 
I've followed the whole installation instruction of csrfguard. I've used the javascript solution and included the script in my pages but I always have the error :
 
[Error] potential cross-site request forgery (CSRF) attack thwarted 
 
when I try to go to one of the pages.

What can I do?

Thanks in advance for your help
 
Cecile 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120112/149598e8/attachment.html>

From gautamashishkumar at gmail.com  Thu Jan 12 12:24:28 2012
From: gautamashishkumar at gmail.com (ashish kumar Gautam)
Date: Thu, 12 Jan 2012 17:54:28 +0530
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 19, Issue 3
In-Reply-To: <mailman.9.1326369602.9129.owasp-csrfguard@lists.owasp.org>
References: <mailman.9.1326369602.9129.owasp-csrfguard@lists.owasp.org>
Message-ID: <CACtUEVndMiRWsx_7PiWxUxyZDr0xFDF5y-Xg5X5MG-ujoe0mcg@mail.gmail.com>

Hi  Cecile ,

I think you needs to send a token from client side.
Follow the following Rules

1- You needs to send a token from client side if you are using JavaScript
to inject a Token.
But if not work you needs to check your JavaScript file .


2- You can inject the token using JSP tag.






On Thu, Jan 12, 2012 at 5:30 PM, <owasp-csrfguard-request at lists.owasp.org>wrote:

> Send Owasp-csrfguard mailing list submissions to
>        owasp-csrfguard at lists.owasp.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> or, via email, send a message with subject or body 'help' to
>        owasp-csrfguard-request at lists.owasp.org
>
> You can reach the person managing the list at
>        owasp-csrfguard-owner at lists.owasp.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-csrfguard digest..."
>
>
> Today's Topics:
>
>   1. [Error] potential cross-site request forgery      (CSRF) attack
>      thwarted (cecile forella)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Thu, 12 Jan 2012 10:32:27 +0000
> From: cecile forella <forellacecile at hotmail.fr>
> To: <owasp-csrfguard at lists.owasp.org>
> Subject: [Owasp-csrfguard] [Error] potential cross-site request
>        forgery (CSRF) attack thwarted
> Message-ID: <SNT120-W46CABA1C6624544D5BA417C09F0 at phx.gbl>
> Content-Type: text/plain; charset="iso-8859-1"
>
>
> Hello,
>
> I've followed the whole installation instruction of csrfguard. I've used
> the javascript solution and included the script in my pages but I always
> have the error :
>
> [Error] potential cross-site request forgery (CSRF) attack thwarted
>
> when I try to go to one of the pages.
>
> What can I do?
>
> Thanks in advance for your help
>
> Cecile
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120112/149598e8/attachment-0001.html
> >
>
> ------------------------------
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>
> End of Owasp-csrfguard Digest, Vol 19, Issue 3
> **********************************************
>



-- 
Best regards,
Ashish K. Gautam
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120112/4e3912d0/attachment.html>

From d_fiore at hotmail.com  Tue Jan 17 17:05:49 2012
From: d_fiore at hotmail.com (Daniel Fiore)
Date: Tue, 17 Jan 2012 17:05:49 +0000
Subject: [Owasp-csrfguard] JavascriptServlet & owasp.csrfguard.js file.
	Browser specific issues
Message-ID: <SNT145-W33016348B92404E2CAB7D883800@phx.gbl>



Hello, I was having problems with the the dynamic DOM manipulation solution within certain browsers and I modified the javascript file to fix certain issues.

I propose that these changes are investigated if they are indeed useless:

In Firefox:

Issue: DOM flickering problem where all the text in the page is displayed for a very brief moment without any formatting.

Solution: I hide the body of the document before the token is injected into each tag and then redisplay it once all the tags are modified with the setTImeOut javascript function:

Code: 
function injectTokens(tokenName, tokenValue) {
        
        document.body.style.display ='none';
...

addEvent(window,'load', function() {
            injectTokens("%TOKEN_NAME%", "%TOKEN_VALUE%");
                });
addEvent(window,'load', function() {
            setTimeout("document.body.style.display ='block'", 200);
        }); 
...

In IE:

Issue: When accessing a page that contained the JavascriptServlet <script> tag, the form within the page was being resubmitted to the server after the page was already displayed. I am not certain but I believe that if you dynamically modify the action attribute of a <form> tag (or the src attribute of an <img> tag) the page is resubmitted only in IE. This was causing the token to be updated to a new value (if org.owasp.csrfguard.Rotate=true) different from the token contained in the links of the page that is already displayed. If you selected a link to a protected page from the displayed page that contained the  JavascriptServlet <script> tag, this would lead to an CSRF attack detection.

Solution: I ignored certain tags in the token injection function and also removed injecting a token attribute in the action attribute of a <form> tag. This will only work if images, scripts and css links are unprotected:

Code:
function injectTokens(tokenName, tokenValue) {
...

if(      element.tagName.toLowerCase() != "script" 
   && element.tagName.toLowerCase() != "img"
   && element.tagName.toLowerCase() != "image"
   && element.tagName.toLowerCase() != "link")
{
      /** inject into form **/
      if(element.tagName.toLowerCase() == "form") {
       if(%INJECT_FORMS% == true) {
                        injectTokenForm(element, tokenName, tokenValue, pageTokens); // this should be enough for a form
                        // injectTokenAttribute(element, "action", tokenName, tokenValue, pageTokens);
 ...
}

I hope this can help certain users that have come across the same issues.

Daniel Fiore.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120117/2d56f00a/attachment.html>

From argenstijn at hotmail.com  Mon Jan 30 11:26:59 2012
From: argenstijn at hotmail.com (Amon Amon)
Date: Mon, 30 Jan 2012 11:26:59 +0000
Subject: [Owasp-csrfguard] Bug/new feature request
Message-ID: <SNT135-W260DD0540EAF7493E3BE75DA8D0@phx.gbl>





Hi all, Just a little feature request for the next version of CsrfGuard. Currently all the actions which are executed when a CRSF exception occurs cannot be prioritized. I will like to have some influence on the execution plan of the actions which i define for the CSRF. The problem which i had is that the forward action was executed before the requestAttribute action (bug!). There is no 'good' solution to fix this problem in the current version.Currently i am just building a new action which sets the request attribute and forwards the request. Cheers,Mark   		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120130/ff816702/attachment.html>

From manish2aug at gmail.com  Mon Jan 30 21:19:36 2012
From: manish2aug at gmail.com (Manish Sharma)
Date: Mon, 30 Jan 2012 23:19:36 +0200
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 19, Issue 6
In-Reply-To: <mailman.3.1327924802.4009.owasp-csrfguard@lists.owasp.org>
References: <mailman.3.1327924802.4009.owasp-csrfguard@lists.owasp.org>
Message-ID: <CA+MvjsL=0MwbqOVLHfwB-N=QbGi61CM7KbL0ar8xipPu4_uspQ@mail.gmail.com>

Hi,

I am new to CSRF Guard, and I am getting some jasper exception when I am
using csrf tag. Actually I am passing a value of uri at runtime by using
expression tag and I am getting the following exception

"According to TLD or attribute directive in tag file, attribute uri does
not accept any expressions"

I am trying this.

<a href="<%=link%><csrf:token uri="<%=pageUri %>"/>"/><fmt:message
key="<%=resourceCode%>"/></a>

Please help me out how can I get it working.

Thanks
Manish Kumar

On Mon, Jan 30, 2012 at 2:00 PM, <owasp-csrfguard-request at lists.owasp.org>wrote:

> Send Owasp-csrfguard mailing list submissions to
>        owasp-csrfguard at lists.owasp.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>        https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
> or, via email, send a message with subject or body 'help' to
>        owasp-csrfguard-request at lists.owasp.org
>
> You can reach the person managing the list at
>        owasp-csrfguard-owner at lists.owasp.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-csrfguard digest..."
>
>
> Today's Topics:
>
>   1. Bug/new feature request (Amon Amon)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 30 Jan 2012 11:26:59 +0000
> From: Amon Amon <argenstijn at hotmail.com>
> To: <owasp-csrfguard at lists.owasp.org>
> Subject: [Owasp-csrfguard] Bug/new feature request
> Message-ID: <SNT135-W260DD0540EAF7493E3BE75DA8D0 at phx.gbl>
> Content-Type: text/plain; charset="iso-8859-1"
>
>
>
>
>
> Hi all, Just a little feature request for the next version of CsrfGuard.
> Currently all the actions which are executed when a CRSF exception occurs
> cannot be prioritized. I will like to have some influence on the execution
> plan of the actions which i define for the CSRF. The problem which i had is
> that the forward action was executed before the requestAttribute action
> (bug!). There is no 'good' solution to fix this problem in the current
> version.Currently i am just building a new action which sets the request
> attribute and forwards the request. Cheers,Mark
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120130/ff816702/attachment-0001.html
> >
>
> ------------------------------
>
> _______________________________________________
> Owasp-csrfguard mailing list
> Owasp-csrfguard at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>
>
> End of Owasp-csrfguard Digest, Vol 19, Issue 6
> **********************************************
>



-- 
-------------------------
Thanks & Regards
Manish Kumar
| Mob: +91-9911635906 |
manish2aug at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120130/f63bd04d/attachment.html>

From pradtke at stanford.edu  Mon Jan 30 21:29:16 2012
From: pradtke at stanford.edu (Patrick Radtke)
Date: Mon, 30 Jan 2012 13:29:16 -0800
Subject: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 19, Issue 6
In-Reply-To: <CA+MvjsL=0MwbqOVLHfwB-N=QbGi61CM7KbL0ar8xipPu4_uspQ@mail.gmail.com>
References: <mailman.3.1327924802.4009.owasp-csrfguard@lists.owasp.org>
	<CA+MvjsL=0MwbqOVLHfwB-N=QbGi61CM7KbL0ar8xipPu4_uspQ@mail.gmail.com>
Message-ID: <4F270BAC.5050007@stanford.edu>

On 1/30/12 1:19 PM, Manish Sharma wrote:
> Hi,
>
> I am new to CSRF Guard, and I am getting some jasper exception when I am
> using csrf tag. Actually I am passing a value of uri at runtime by using
> expression tag and I am getting the following exception
>
> "According to TLD or attribute directive in tag file, attribute uri does
> not accept any expressions"
>
> I am trying this.
>
> <a href="<%=link%><csrf:token uri="<%=pageUri %>"/>"/><fmt:message
> key="<%=resourceCode%>"/></a>
>
> Please help me out how can I get it working.
>
> Thanks
> Manish Kumar

You'll need to download the src from github. Allowing EL expressions in 
the URI was fixed (commit 3dd56d110aedf6463cfd68a82d0d34b4ad4100bb) a 
while back but isn't available in a precompiled .jar

-Patrick

From manish2aug at gmail.com  Tue Jan 31 21:44:19 2012
From: manish2aug at gmail.com (Manish Sharma)
Date: Tue, 31 Jan 2012 23:44:19 +0200
Subject: [Owasp-csrfguard] Please Suggest;
 Is disabling the Rotate feature correct? How to pass wild cards in
 unprotected page list?
Message-ID: <CA+MvjsLEKkv_OD_8YX_APy0tcWvQXZhwe+efXeRK_vqAtpn6ww@mail.gmail.com>

Hi,

I implemented OWASP CSRF Gurad with my application, I have some queries,
can you please answer the following.

1) I am disabling the Rotate feature so that the tokens wont be refreshed
in session. Is it correct and will it not add any vulnerability ?
2) As per the application we need to use the wild cards in our unprotected
pages list, so I made some changes to isUriMatched() method.
    I added the following piece of code in this method. Please verify and
if it is correct then can this piece of code can be added to the CSRF Api
in the
    coming version.

 e.g.
/mobile-server/xhtml/user/*/slogin.xhtml

The page slogin.xhtml can be called in either way, but behind the scene
same jsp is called.
Following two different calls will invoke the same jsp.

/s1mobile-server/xhtml/user/EP/slogin.xhtml
/s1mobile-server/xhtml/user/CID/slogin.xhtml

Where EP and CID are branding group code which will be decided by the
client.
To handle this I added the following code.
/*
      Case 0: Generic match using wild cards
      */
      if(testPath.contains("/*/"))
      {
         // Use of wild card to define a directory of any name
         int index = testPath.indexOf("/*/");
         String exactInitialTestPath = testPath.substring(0,index+1);
         String newTestPath = testPath.substring(index+2);
         if(index+1>requestPath.length())
         {
            return false;
         }
         String exactInitialRequestPath = requestPath.substring(0,index+1);
         /*
          * Condition: In case if directory name is valid.
          * Check of initial part matching.
          */
         if(!exactInitialTestPath.equals(exactInitialRequestPath))
         {
            return false;
         }

         String remainingRequestPath = requestPath.substring(index+1);

         /*
          * Allowing the case /*
          */
         if(remainingRequestPath.length()==1 &&
remainingRequestPath.equals("*"))
         {
            return true;
         }

         int dirIindex = remainingRequestPath.indexOf("/");
         /*
          * If no valid directory
          */
         if(dirIindex==-1)
         {
            return false;
         }
         String dirName = remainingRequestPath.substring(0,dirIindex);
         if(dirIindex>remainingRequestPath.length())
         {
            return false;
         }
         String newRequestPath = remainingRequestPath.substring(dirIindex);

         /*
          * Condition: Check for valid characters for a directory name
          */
         if(dirName.contains("/")
               ||dirName.contains(":")||dirName.contains("*")
               ||dirName.contains("?")||dirName.contains("\"")
               ||dirName.contains("<")||dirName.contains(">")
               ||dirName.contains("|")||dirName.contains("&")
               ||dirName.contains("\\"))
         {
            return false;
         }



         /*
          * Call this method again for checking the remaining part of the
request path.
          */
         return isUriMatch(newTestPath, newRequestPath);
      }



-------------------------
Thanks & Regards
Manish Kumar
| Mob: +27-742650187 |
manish2aug at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20120131/0382cf2a/attachment.html>

