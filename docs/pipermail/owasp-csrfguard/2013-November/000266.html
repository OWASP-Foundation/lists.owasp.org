<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Owasp-csrfguard%20Digest%2C%20Vol%2039%2C%20Issue%201&In-Reply-To=%3CCAPEPW-HBuOhBx96YosuGLgkQoCBZwMO4d1vspdPqCdPsWE_8hA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000265.html">
   <LINK REL="Next"  HREF="000267.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1</H1>
    <B>younes quoulali</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Owasp-csrfguard%20Digest%2C%20Vol%2039%2C%20Issue%201&In-Reply-To=%3CCAPEPW-HBuOhBx96YosuGLgkQoCBZwMO4d1vspdPqCdPsWE_8hA%40mail.gmail.com%3E"
       TITLE="[Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1">yquoulali at gmail.com
       </A><BR>
    <I>Thu Nov  7 09:37:13 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000265.html">[Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
</A></li>
        <LI>Next message: <A HREF="000267.html">[Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#266">[ date ]</a>
              <a href="thread.html#266">[ thread ]</a>
              <a href="subject.html#266">[ subject ]</a>
              <a href="author.html#266">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Thanks for your reply. Sorry to not reply in the time, because it was a
holiday here.

For information i go this error on an Hybris platform on tomcat6 server.

Thes are my settings (extracted from the console logs):

Cluster:     disabled
Tenant:      master
OS:          Windows 7 6.1, amd64
Database:    Pool: hybris - oracle, table prefix:
DUMP - jdbc:oracle:thin:@10.42.0.28:1521:testdatabase
Platform:    4.8.0
Java:       Oracle Corporation
              Java(TM) SE Runtime Environment, 1.7.0_21-b11
C:\Program Files\Java\jdk1.7.0_21\jre
VM Locale:   language=fr,country=FR,region=null
Server type: tomcat

The log does not contain a detailled trace, the &quot;java.io.IOException: This
output stream has already been closed&quot; i got it by debuging the
JavascriptServlet int the writeJavaScript()  method when it try to close
the outputStream (Streams.close(output);):

This is the exceotion got in logs:

INFO   | jvm 1    | main    | 2013/11/04 16:20:21.545 | nov. 04, 2013
4:20:21 PM org.apache.catalina.core.StandardWrapperValve invoke
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.546 | SEVERE:
&quot;Servlet.service()&quot; pour la servlet JavaScriptServlet a g&#233;n&#233;r&#233; une exception
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.548 |
java.lang.IllegalStateException
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.549 | at
org.apache.catalina.connector.ResponseFacade.sendRedirect(ResponseFacade.java:435)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.551 | at
com.citadium.ecom.web.filters.ExceptionManager.error(ExceptionManager.java:47)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.553 | at
com.citadium.ecom.web.filters.UnexpectedExceptionManagerFilter.doFilterInternal(UnexpectedExceptionManagerFilter.java:35)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.570 | at
org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.573 | at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.578 | at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.591 | at
org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:88)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.595 | at
org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:76)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.597 | at
org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.599 | at
org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.687 | at
org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.689 | at
org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.690 | at
org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.692 | at
org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.693 | at
org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.707 | at
org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:615)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.712 | at
org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:293)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.731 | at
org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:859)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.734 | at
org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:602)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.736 | at
org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:396)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.789 | at
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.791 | at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
INFO   | jvm 1    | main    | 2013/11/04 16:20:21.793 | at
java.lang.Thread.run(Thread.java:722)

Thanks
Best regards.


2013/11/5 OWASP &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">azzeddine.ramrami at owasp.org</A>&gt;

&gt;<i> Hi Younes,
</I>&gt;<i> I am Azzeddine RAMRAMI the CSRFGuard project leader.
</I>&gt;<i> I mentioned by Manish please provide all informations and I will
</I>&gt;<i> investigate to solve your issue:
</I>&gt;<i>
</I>&gt;<i> :
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1. Java version
</I>&gt;<i> 2.Tomcat version you are using.
</I>&gt;<i> 3.Complete stack trace for the error or a copy of the log files.
</I>&gt;<i> Thanks.
</I>&gt;<i> Azzeddine
</I>&gt;<i> ------------------------------
</I>&gt;<i> From: Manish Java
</I>&gt;<i> Sent: 05/11/2013 13:07
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">yquoulali at gmail.com</A>
</I>&gt;<i> Subject: Re: [Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi Younes
</I>&gt;<i>
</I>&gt;<i> I have been using CSRFGuard for a while now and haven't faced this
</I>&gt;<i> problem.  From your first post I believe you are using Apache Tomcat, which
</I>&gt;<i> is what we use for our application as well so our usage seems to be the
</I>&gt;<i> same as yours.
</I>&gt;<i>
</I>&gt;<i> I have looked through the code for the JavaScript servlet and do not see
</I>&gt;<i> any obvious reason why you should be getting the reported error.  Could you
</I>&gt;<i> help out by providing the following details:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>    1. Java version you are using.
</I>&gt;<i>    2. Tomcat version you are using.
</I>&gt;<i>    3. Complete stack trace for the error, including all logged causes.
</I>&gt;<i>    4. Whether you get the error all the time or only in some instances.
</I>&gt;<i>     If only occasionally, any steps to reproduce the error would be good.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i> ~ Manish
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, Nov 2, 2013 at 5:30 PM, &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-request at lists.owasp.org</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Send Owasp-csrfguard mailing list submissions to
</I>&gt;&gt;<i>         <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;&gt;<i>         <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;&gt;<i>         <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-request at lists.owasp.org</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can reach the person managing the list at
</I>&gt;&gt;<i>         <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-owner at lists.owasp.org</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;&gt;<i> than &quot;Re: Contents of Owasp-csrfguard digest...&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Today's Topics:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    1. OWASP-CSRF Guard - Probleme with the      JavaScriptServlet
</I>&gt;&gt;<i>       (younes quoulali)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ----------------------------------------------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Message: 1
</I>&gt;&gt;<i> Date: Fri, 1 Nov 2013 17:58:30 +0000
</I>&gt;&gt;<i> From: younes quoulali &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">yquoulali at gmail.com</A>&gt;
</I>&gt;&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;&gt;<i> Subject: [Owasp-csrfguard] OWASP-CSRF Guard - Probleme with the
</I>&gt;&gt;<i>         JavaScriptServlet
</I>&gt;&gt;<i> Message-ID:
</I>&gt;&gt;<i>         &lt;CAPEPW-GC=
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">p3dvADi-c9uspdoqArwaNn6u_Kux8k1GBu-2EYykQ at mail.gmail.com</A>&gt;
</I>&gt;&gt;<i> Content-Type: text/plain; charset=&quot;iso-8859-1&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have implemented the OWASP CSRF guard solution, all work properly like i
</I>&gt;&gt;<i> expect, but on other side, i got an exception in the logs:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.760 | nov. 01, 2013
</I>&gt;&gt;<i> 4:44:02 PM org.apache.catalina.core.StandardWrapperValve invoke
</I>&gt;&gt;<i> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.803 | SEVERE:
</I>&gt;&gt;<i> &quot;Servlet.service()&quot; pour la servlet JavaScriptServlet a g?n?r? une
</I>&gt;&gt;<i> exception
</I>&gt;&gt;<i> INFO   | jvm 1    | main    | 2013/11/01 16:44:02.857 |
</I>&gt;&gt;<i> java.lang.IllegalStateException
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> After debugging, i found that the root exception happen in the method
</I>&gt;&gt;<i> writeJavaScript() when it try to close the outputStream
</I>&gt;&gt;<i> (Streams.close(output);): java.io.IOException: This output stream has
</I>&gt;&gt;<i> already been closed
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> i would override this servlet to catch this exception, but it is a final
</I>&gt;&gt;<i> class.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Anyone had an idea how to fix this ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Best regards.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Quoulali Younes
</I>&gt;&gt;<i> -------------- next part --------------
</I>&gt;&gt;<i> An HTML attachment was scrubbed...
</I>&gt;&gt;<i> URL: &lt;
</I>&gt;&gt;<i> <A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131101/2f8eea94/attachment-0001.html</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Owasp-csrfguard mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> End of Owasp-csrfguard Digest, Vol 39, Issue 1
</I>&gt;&gt;<i> **********************************************
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131107/8528fb2e/attachment.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20131107/8528fb2e/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000265.html">[Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
</A></li>
	<LI>Next message: <A HREF="000267.html">[Owasp-csrfguard] Owasp-csrfguard Digest, Vol 39, Issue 1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#266">[ date ]</a>
              <a href="thread.html#266">[ thread ]</a>
              <a href="subject.html#266">[ subject ]</a>
              <a href="author.html#266">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
