<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Where%20is%20the%20SVN%20repository%20for%20Alpha%20version%0A%20OWASP%20CSRFGuard%203.0.0.503%20%28ALPHA%29&In-Reply-To=%3C28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37EA%40Post.intra.tmrs.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000191.html">
   <LINK REL="Next"  HREF="000193.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)</H1>
    <B>Cheung, Ming</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Where%20is%20the%20SVN%20repository%20for%20Alpha%20version%0A%20OWASP%20CSRFGuard%203.0.0.503%20%28ALPHA%29&In-Reply-To=%3C28B3FE87AB2E1847A5FE9B8C0A4CC6ED086F37EA%40Post.intra.tmrs.org%3E"
       TITLE="[Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)">MCheung at tmrs.com
       </A><BR>
    <I>Wed Mar 20 21:02:30 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="000191.html">[Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)
</A></li>
        <LI>Next message: <A HREF="000193.html">[Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#192">[ date ]</a>
              <a href="thread.html#192">[ thread ]</a>
              <a href="subject.html#192">[ subject ]</a>
              <a href="author.html#192">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry, I copied and pasted a wrong version in previous email. This is the right one I am using.



      public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() &amp;&amp; !found) {
				String theElement = (String)en.nextElement();
				System.out.println(&quot;theElmeent = &quot; + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
	

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format(&quot;unable to generate the random token - %s&quot;, e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		
	}

Thanks,
Ming


-----Original Message-----
From: Cheung, Ming 
Sent: Wednesday, March 20, 2013 1:09 PM
To: Cheung, Ming; Eric Sheridan; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
Subject: RE: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

I learned the NULLPointer Exception was due to the initial request to the server. As we know, since it was the very first request, there was no session established yet. Therefore, session was null. As a result, the NullPointerException was thrown.

To work around with this NPE issue, I modified the org.owasp.csrfguard.CsrfGuard.UpdateToken method as the following, It seems work fine. Should UpdateToken consider the Null pointer issue if the session is not present? Or I might miss something that I am not aware of?


	public void updateToken(HttpSession session) {
		/// mcheung
		/// check to make sure the session is present; session could be NULL or non existent at the very first request.
		///
		Enumeration en = session.getAttributeNames();
		String tokenValue = null;

		if (en.hasMoreElements()) {
			boolean found = false;
			String sKey = getSessionKey();
			while (en.hasMoreElements() &amp;&amp; !found) {
				String theElement = (String)en.nextElement();
				System.out.println(&quot;theElmeent = &quot; + theElement);
				if (sKey.matches(theElement)) {
					found = true;
				}	
			}
			tokenValue = (String) session.getAttribute(getSessionKey());
		} else {

			/** Generate a new token and store it in the session. **/
			if (tokenValue == null) {
				try {
					tokenValue = RandomGenerator.generateRandomId(getPrng(), getTokenLength());
				} catch (Exception e) {
					throw new RuntimeException(String.format(&quot;unable to generate the random token - %s&quot;, e.getLocalizedMessage()), e);
				}

				session.setAttribute(getSessionKey(), tokenValue);
			}
		}
	}

Thanks,
Ming

-----Original Message-----
From: Cheung, Ming [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">MCheung at tmrs.com</A>]
Sent: Tuesday, March 05, 2013 1:59 PM
To: Eric Sheridan; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

Regardless which listener I tried, I always got java.lang.NullPointerException with the following CsrfGuard code, Could someone please advice?


Here is the call stacks:

[3/5/13 13:53:56:747 CST] 00000015 servlet       E com.ibm.ws.webcontainer.servlet.ServletWrapper service SRVE0068E: Uncaught exception created in one of the service methods of the servlet Logon in application CityPortal. Exception created : java.lang.NullPointerException
	at com.ibm.ws.session.SessionData.getSessionValue(SessionData.java:300)
	at com.ibm.ws.session.SessionData.getAttribute(SessionData.java:162)
	at org.owasp.csrfguard.CsrfGuard.updateToken(CsrfGuard.java:395)
	at org.owasp.csrfguard.CsrfGuardHttpSessionListener.sessionCreated(CsrfGuardHttpSessionListener.java:13)
	at com.ibm.ws.session.http.HttpSessionObserver.sessionCreated(HttpSessionObserver.java:111)
	at com.ibm.ws.session.SessionEventDispatcher.sessionCreated(SessionEventDispatcher.java:98)
	at com.ibm.ws.session.SessionManager.createISession(SessionManager.java:268)
	at com.ibm.ws.session.SessionManager.createSession(SessionManager.java:635)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:473)
	at com.ibm.ws.session.SessionContext.getIHttpSession(SessionContext.java:408)
	at com.ibm.ws.webcontainer.srt.SRTRequestContext.getSession(SRTRequestContext.java:89)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1909)
	at com.ibm.ws.webcontainer.srt.SRTServletRequest.getSession(SRTServletRequest.java:1894)
	at org.tmrs.common.controller.BaseServlet.getUserSession(BaseServlet.java:675)
	at org.tmrs.common.controller.BaseServlet.getNewPageBean(BaseServlet.java:253)
	at org.tmrs.common.controller.BaseServlet.getNewCachedPageBean(BaseServlet.java:268)
	at org.tmrs.cityportal.user.controller.Logon.getNewCachedPageBean(Logon.java:46)
	at org.tmrs.common.controller.BaseServlet.doDefault(BaseServlet.java:288)
	at org.tmrs.common.controller.BaseServlet.doPost(BaseServlet.java:163)
	at org.tmrs.common.controller.BaseServlet.doGet(BaseServlet.java:143)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)
	...


Thanks,
Ming


-----Original Message-----
From: Eric Sheridan [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">eric.sheridan at owasp.org</A>]
Sent: Tuesday, March 05, 2013 12:17 PM
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)

This is a fairly common problem. Does anyone want to take a crack at directly editing the Wiki article summarizing what they've done to get up and running?

Sincerely,
Eric Sheridan
(twitter) @eric_sheridan
(blog) <A HREF="http://ericsheridan.blogspot.com">http://ericsheridan.blogspot.com</A>

On 3/5/13 12:49 PM, Cheung, Ming wrote:
&gt;<i> First of all, Thanks Patrick for providing the download link.
</I>&gt;<i> 
</I>&gt;<i> I just learned the download link is NOT for the Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA), It is for the trunk.
</I>&gt;<i> 
</I>&gt;<i> Does anyone have the instructions on how to use the latest CSRFguard from the trunk? Because CSRFGuard 3.0.0.503 (ALPHA) instructions, <A HREF="https://www.owasp.org/index.php/CSRFGuard_3_Installation,">https://www.owasp.org/index.php/CSRFGuard_3_Installation,</A> is already out of date.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 1. Which Listener should be use? CsrfGuardHttpSessionListener or CsrfGuardServletContextListener? 
</I>&gt;<i> 
</I>&gt;<i> 2. What is the difference?
</I>&gt;<i> 
</I>&gt;<i> 3. Which Guard class should be added to the Web.xml? CsrfGuardFilter? Or CsrfGuard?
</I>&gt;<i> 
</I>&gt;<i> 4. Comparing to the latest code from trunk, CSRFGuard 3.0.0.503 (ALPHA) works better. CSRFGuard 3.0.0.503 (ALPHA) only failed on one single page with &quot;Required token is missing from the request&quot;, therefore, does anyone has the link for the CSRFGuard 3.0.0.503 (ALPHA)?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Ming
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Patrick Radtke [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">pradtke at stanford.edu</A>]
</I>&gt;<i> Sent: Thursday, February 28, 2013 4:08 PM
</I>&gt;<i> To: Cheung, Ming
</I>&gt;<i> Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> Subject: Re: [Owasp-csrfguard] Where is the SVN repository for Alpha 
</I>&gt;<i> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://github.com/esheri3/OWASP-CSRFGuard">https://github.com/esheri3/OWASP-CSRFGuard</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On 2/28/13 1:25 PM, Cheung, Ming wrote:
</I>&gt;&gt;<i> RA layer request failed
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> svn: Server sent unexpected return value (405 Method Not Allowed) in 
</I>&gt;&gt;<i> response to OPTIONS request for '<A HREF="http://owaspcsrfguard.googlecode.com">http://owaspcsrfguard.googlecode.com</A>'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ming
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *From:*Cheung, Ming [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">MCheung at tmrs.com</A>]
</I>&gt;&gt;<i> *Sent:* Thursday, February 28, 2013 3:08 PM
</I>&gt;&gt;<i> *To:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;&gt;<i> *Subject:* [Owasp-csrfguard] Where is the SVN repository for Alpha 
</I>&gt;&gt;<i> version OWASP CSRFGuard 3.0.0.503 (ALPHA)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi There,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The CSRFGuard failed on certain pages of my application, Could 
</I>&gt;&gt;<i> someone please point me to the SVN repository for downloading the java source?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ming
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ###################################################################
</I>&gt;&gt;<i> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
</I>&gt;&gt;<i> intended only for the use of the individual or entity to which it is 
</I>&gt;&gt;<i> addressed and may contain information that is privileged, 
</I>&gt;&gt;<i> confidential, and exempt from disclosure under applicable law.
</I>&gt;&gt;<i> If you are not the intended recipient, you are notified that any use, 
</I>&gt;&gt;<i> dissemination, forwarding, distribution, or copying of the 
</I>&gt;&gt;<i> communication is strictly prohibited. Please notify the sender 
</I>&gt;&gt;<i> immediately by e-mail if you have received this communication by 
</I>&gt;&gt;<i> mistake and delete all copies of the original message and attachments 
</I>&gt;&gt;<i> from your system.
</I>&gt;&gt;<i> ###################################################################
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Owasp-csrfguard mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;&gt;<i>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ###################################################################
</I>&gt;<i> CONFIDENTIALITY NOTICE: This communication, including attachments, is 
</I>&gt;<i> intended only for the use of the individual or entity to which it is 
</I>&gt;<i> addressed and may contain information that is privileged, 
</I>&gt;<i> confidential, and exempt from disclosure under applicable law.
</I>&gt;<i> If you are not the intended recipient, you are notified that any use, 
</I>&gt;<i> dissemination, forwarding, distribution, or copying of the 
</I>&gt;<i> communication is strictly prohibited. Please notify the sender 
</I>&gt;<i> immediately by e-mail if you have received this communication by 
</I>&gt;<i> mistake and delete all copies of the original message and attachments 
</I>&gt;<i> from your system.
</I>&gt;<i> ###################################################################
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-csrfguard mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</I>&gt;<i> 
</I>_______________________________________________
Owasp-csrfguard mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>

###################################################################
CONFIDENTIALITY NOTICE: This communication, including attachments, is intended only for the use of the individual or entity to which it is addressed and may contain information that is privileged, confidential, and exempt from disclosure under applicable law.
If you are not the intended recipient, you are notified that any use, dissemination, forwarding, distribution, or copying of the communication is strictly prohibited. Please notify the sender immediately by e-mail if you have received this communication by mistake and delete all copies of the original message and attachments from your system.
###################################################################
_______________________________________________
Owasp-csrfguard mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">Owasp-csrfguard at lists.owasp.org</A>
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">https://lists.owasp.org/mailman/listinfo/owasp-csrfguard</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000191.html">[Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)
</A></li>
	<LI>Next message: <A HREF="000193.html">[Owasp-csrfguard] Where is the SVN repository for Alpha version OWASP CSRFGuard 3.0.0.503 (ALPHA)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#192">[ date ]</a>
              <a href="thread.html#192">[ thread ]</a>
              <a href="subject.html#192">[ subject ]</a>
              <a href="author.html#192">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
