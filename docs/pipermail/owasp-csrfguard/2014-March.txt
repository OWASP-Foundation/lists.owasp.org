From jcottr at gmail.com  Mon Mar  3 22:56:17 2014
From: jcottr at gmail.com (Jared D. Cottrell)
Date: Mon, 3 Mar 2014 14:56:17 -0800
Subject: [Owasp-csrfguard] csrfguard.js not in Maven distribution
In-Reply-To: <CAL4seLEC+C-NdYgMy0Rf_763Da__DjRLaybK6vr1BTaFRKWjaQ@mail.gmail.com>
References: <CACQR=w2PSEh8QW7NhA+YT52Gu4s2ixaYXLJq=4DLXx5cTHvcQg@mail.gmail.com>
	<CAL4seLEC+C-NdYgMy0Rf_763Da__DjRLaybK6vr1BTaFRKWjaQ@mail.gmail.com>
Message-ID: <CACQR=w0_ox0u-y76_WUm=S6VRPEzr9dTBUtGa_kivMPndqKd0Q@mail.gmail.com>

Thanks Azzeddine!

I got it running on a fork and just submitted a pull request if you'd care
to use it or just take bits of it.

https://github.com/aramrami/OWASP-CSRFGuard/pull/4

Cheers!


Jared


On Thu, Feb 27, 2014 at 7:54 PM, Azzeddine Ramrami <
azzeddine.ramrami at owasp.org> wrote:

> Thanks for this remarks.
> I will correct this soon.
> Regards,
> Azzeddine
>
>
> On Thu, Feb 27, 2014 at 11:43 PM, Jared D. Cottrell <jcottr at gmail.com>wrote:
>
>> I notice that csrfguard.js<https://github.com/esheri3/OWASP-CSRFGuard/blob/master/csrfguard/src/main/resources/csrfguard.js>isn't in the JAR distributed through Maven (see contents listed below). Any
>> objections to a pull request that adds the file to the list of resources
>> included in the JAR<https://github.com/esheri3/OWASP-CSRFGuard/blob/master/csrfguard/src/main/resources/csrfguard.js>and modifies the JavaScriptServlet to look for it there by default?
>>
>> Cheers!
>>
>>
>> Jared
>>
>> ---
>>
>> % tar tf csrfguard-3.0.0.jar
>> META-INF/
>> META-INF/MANIFEST.MF
>> org/
>> org/owasp/
>> org/owasp/csrfguard/
>> org/owasp/csrfguard/action/
>> org/owasp/csrfguard/http/
>> org/owasp/csrfguard/log/
>> org/owasp/csrfguard/servlet/
>> org/owasp/csrfguard/tag/
>> org/owasp/csrfguard/util/
>> META-INF/csrfguard.tld
>> META-INF/license.txt
>> org/owasp/csrfguard/action/AbstractAction.class
>> org/owasp/csrfguard/action/Empty.class
>> org/owasp/csrfguard/action/Forward.class
>> org/owasp/csrfguard/action/IAction.class
>> org/owasp/csrfguard/action/Invalidate.class
>> org/owasp/csrfguard/action/Log.class
>> org/owasp/csrfguard/action/Redirect.class
>> org/owasp/csrfguard/action/RequestAttribute.class
>> org/owasp/csrfguard/action/Rotate.class
>> org/owasp/csrfguard/action/SessionAttribute.class
>> org/owasp/csrfguard/CsrfGuard$SingletonHolder.class
>> org/owasp/csrfguard/CsrfGuard.class
>> org/owasp/csrfguard/CsrfGuardException.class
>> org/owasp/csrfguard/CsrfGuardFilter.class
>> org/owasp/csrfguard/CsrfGuardHttpSessionListener.class
>> org/owasp/csrfguard/CsrfGuardServletContextListener.class
>> org/owasp/csrfguard/http/InterceptRedirectResponse.class
>> org/owasp/csrfguard/log/ConsoleLogger.class
>> org/owasp/csrfguard/log/ILogger.class
>> org/owasp/csrfguard/log/JavaLogger$1.class
>> org/owasp/csrfguard/log/JavaLogger.class
>> org/owasp/csrfguard/log/LogLevel.class
>> org/owasp/csrfguard/servlet/JavaScriptServlet.class
>> org/owasp/csrfguard/tag/AbstractTag.class
>> org/owasp/csrfguard/tag/AbstractUriTag.class
>> org/owasp/csrfguard/tag/ATag.class
>> org/owasp/csrfguard/tag/FormTag.class
>> org/owasp/csrfguard/tag/TokenNameTag.class
>> org/owasp/csrfguard/tag/TokenTag.class
>> org/owasp/csrfguard/tag/TokenValueTag.class
>> org/owasp/csrfguard/util/BrowserEncoder.class
>> org/owasp/csrfguard/util/RandomGenerator.class
>> org/owasp/csrfguard/util/Streams.class
>> org/owasp/csrfguard/util/Strings.class
>> org/owasp/csrfguard/util/Writers.class
>> META-INF/maven/
>> META-INF/maven/org.owasp/
>> META-INF/maven/org.owasp/csrfguard/
>> META-INF/maven/org.owasp/csrfguard/pom.xml
>> META-INF/maven/org.owasp/csrfguard/pom.properties
>>
>>
>> _______________________________________________
>> Owasp-csrfguard mailing list
>> Owasp-csrfguard at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-csrfguard
>>
>>
>
>
> --
> Azzeddine RAMRAMI
> +33 6 65 48 90 04.
> Enterprise Security Architect
> OWASP Leader (Morocco Chapter)
> Mozilla Security Projects Mentor
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140303/a458ec57/attachment.html>

From lovenaveen at gmail.com  Thu Mar  6 19:00:50 2014
From: lovenaveen at gmail.com (Naveen Reddy)
Date: Thu, 6 Mar 2014 14:00:50 -0500
Subject: [Owasp-csrfguard] Struts 2 integration with csrfguard.js
Message-ID: <CAMSZ1gn9LUY=RZegYHcY89E=CbwE1k9g6hhtJsL27z6Y+g=21A@mail.gmail.com>

Hi,
 Iam using Struts2 and I tried implementing the csrfguard via the dynamic
javascript, I see no errors but it doesnot seem to work. It is only working
if the token is missing. Also I see the token on the url. I see that tah
tokens are being properly generated and embedded to teh links and buttons
on the page, but when I copy the URL and paste in a different tab or window
and clcik enter I see the results. Am I not supposed to see that its a CSRF
attack? Also how different is the CSRF framework inbuilt in Struts2 to
the csrfguard?  Your feed back will be appreciated.

Thanks,
Naveen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140306/33f672f3/attachment.html>

From john.m.allen at thomsonreuters.com  Tue Mar 11 18:40:08 2014
From: john.m.allen at thomsonreuters.com (john.m.allen at thomsonreuters.com)
Date: Tue, 11 Mar 2014 18:40:08 +0000
Subject: [Owasp-csrfguard] JavaScriptServlet tag name and value undefined
References: <CF0A1BDF42ABA34BA4E89CDA62F3ED7B0287D447@C111KXTEMBX51.ERF.thomson.com>
	<CANk0ecm9qiE4mB4AO+Tc1uuU7N10=Wn8NnQHrVQrBKAJ5Dn86w@mail.gmail.com>
	<CF0A1BDF42ABA34BA4E89CDA62F3ED7B0287D4A4@C111KXTEMBX51.ERF.thomson.com>
	<CAL4seLFC2-+TAcO70TRRCcx+N9eOp6JFSyVGwVbW588TMC2=bw@mail.gmail.com> 
Message-ID: <CF0A1BDF42ABA34BA4E89CDA62F3ED7B0288E633@C111KXTEMBX51.ERF.thomson.com>

I finally figured out why I was getting "undefined" values for token-name and token-value.  I like the library a lot but I see a major issue and a very minor one.

Major Issue

JavaScript DOM Manipulation does not work unless Ajax support is enabled in the property file.
org.owasp.csrfguard.Ajax=true

The documentation has
Note: Use of JavaScript DOM Manipulation is required for Ajax support.
But I did not see anything that said:
Ajax support is required for JavaScript DOM Manipulation.

And I found no other place the POST for the token exists except in the Ajax "if" statement (line 392) in
csrfguard.js, requestPageTokens().  Is the closing brace misplaced?
              if(%INJECT_XHR% == true) {
I am not sure of the intentions, but it worked putting the closing brace just before
              var xhr = window.XMLHttpRequest . . .


Minor Issue

The latest version (git clone https://github.com/aramrami/OWASP-CSRFGuard)
...\csrfguard\src\main\resources\csrfguard.tld
has names that do not match the code.  I changed

              <name>tokenname</name>
              <tag-class>org.owasp.csrfguard.tag.TokenNameTag</tag-class>
              <body-content>empty</body-content>
       </tag>
       <tag>
              <name>tokenvalue</name>

to

              <name>token-name</name>
              . . .
              <name>token-value</name>

John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140311/01ecd4fd/attachment.html>

