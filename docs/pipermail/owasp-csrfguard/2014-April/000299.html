<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] Community Question regarding OWASP-CSRF
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Community%20Question%20regarding%20OWASP-CSRF&In-Reply-To=%3CCF0A1BDF42ABA34BA4E89CDA62F3ED7B028BB60D%40C111KXTEMBX51.ERF.thomson.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000297.html">
   <LINK REL="Next"  HREF="000300.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] Community Question regarding OWASP-CSRF</H1>
    <B>john.m.allen at thomsonreuters.com</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Community%20Question%20regarding%20OWASP-CSRF&In-Reply-To=%3CCF0A1BDF42ABA34BA4E89CDA62F3ED7B028BB60D%40C111KXTEMBX51.ERF.thomson.com%3E"
       TITLE="[Owasp-csrfguard] Community Question regarding OWASP-CSRF">john.m.allen at thomsonreuters.com
       </A><BR>
    <I>Tue Apr  8 19:46:47 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000297.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
        <LI>Next message: <A HREF="000300.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#299">[ date ]</a>
              <a href="thread.html#299">[ thread ]</a>
              <a href="subject.html#299">[ subject ]</a>
              <a href="author.html#299">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm not sure if this answers your question, Chris, but if you've downloaded the source, take a look at
...\csrfguard\src\main\resources\csrfguard.js
about line 392.  That was the only place I found that it fetches and injects the token.

(Caution:  I think the &quot;if(%INJECT_XHR% == true)&quot; closing brace is misplaced, too far down.  It makes it work only if Ajax is enabled.)

John


From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of Chris Hyzer
Sent: Tuesday, April 08, 2014 2:21 PM
To: Sarah Baso; Azzeddine Ramrami; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ranjith.sundarajchandras at its.ny.gov</A>
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
Subject: Re: [Owasp-csrfguard] Community Question regarding OWASP-CSRF

Just curious... CSRF guard will parse a page and add/edit some DOM elements so that the token is passed back and forth.  But after an Ajax request, when new page elements (links, forms) are potentially added, will CSRF guard decorate these so that the token is passed?  Or does a Javascript function need to be called after ajax changed the page so that new elements are decorated?  When you get the error, can you see the network tab in a browser developer tools plugin to see if a token is even being passed at all?  Does it work if you don't have token per page?

Thanks,
Chris

From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] On Behalf Of Sarah Baso
Sent: Tuesday, April 08, 2014 3:16 PM
To: Azzeddine Ramrami; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ranjith.sundarajchandras at its.ny.gov</A>
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
Subject: Re: [Owasp-csrfguard] Community Question regarding OWASP-CSRF

Thanks!

Ranjith - can you provide a bit more information as Azzeddine has requested?

Sarah

On Tue, Apr 8, 2014 at 12:14 PM, Azzeddine Ramrami &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">azzeddine.ramrami at owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">azzeddine.ramrami at owasp.org</A>&gt;&gt; wrote:
Thanks Sarah.

I will take this request for further analysis. Help form other leaders or users of CSRF-Guard is welcome.
Just to be clear I will work on this issue as volunteer, this mean I will do my best to solve this issue if I can reproduce it.
Some questions:
- Witch version of CSRF-Guard is used.
- Witch Application Server is used.
- Browser name and version.
Regards,
Azzeddine



On Tue, Apr 8, 2014 at 5:23 PM, Sarah Baso &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&gt;&gt; wrote:
Azzeddine and others -

We received this question through our community &quot;contact us&quot; form - can you help with responding?  The submitter is cc'ed.

We have secured our public website using OWASP - CSRF guard and configured TokenPerPage=true. We use JSF 2.0 (myfaces) for our front-end development.
Every thing works good as expected except when we use JSF &lt;f:ajax&gt;. When we submit an ajax request from a page, the ajax request is successful but the subsequent Http Request fails with a message (&quot;potential cross-site request forgery (CSRF) attack thwarted (user:&lt;anonymous&gt;%, ip:x.x.x.x, uri:/ppr/secured/xxxx.faces, error:request token does not match page token)&quot;).
Below is our speculation :
- In JSF the URL displayed in the browser address bar is always the previous page's url ( as JSF 'POST' forwards the request). And ajax request uses the current page's url. May be the ajax request overrides the token.
We are not sure if this could cause any issues with token tracking - but we just want to hint you our speculation and get your suggestion/guidance to fix this issue.


Thanks in advance,
Sarah Baso
--
Executive Director
OWASP Foundation

<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&gt;
+1.312.869.2779&lt;tel:%2B1.312.869.2779&gt;




--
Azzeddine RAMRAMI
+33 6 65 48 90 04&lt;tel:%2B33%206%2065%2048%2090%2004&gt;.
Enterprise Security Architect
OWASP Leader (Morocco Chapter)
Mozilla Security Projects Mentor



--
Executive Director
OWASP Foundation

<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&gt;
+1.312.869.2779


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140408/2edc4684/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140408/2edc4684/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000297.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
	<LI>Next message: <A HREF="000300.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#299">[ date ]</a>
              <a href="thread.html#299">[ thread ]</a>
              <a href="subject.html#299">[ subject ]</a>
              <a href="author.html#299">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
