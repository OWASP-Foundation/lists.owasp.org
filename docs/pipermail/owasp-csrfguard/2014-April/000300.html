<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfguard] Community Question regarding OWASP-CSRF
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Community%20Question%20regarding%20OWASP-CSRF&In-Reply-To=%3CCAL4seLEPG5sdFTqrU8Ob5v74Tv-XsQOPTrO5HcnCmM0xPni6_g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000299.html">
   <LINK REL="Next"  HREF="000298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfguard] Community Question regarding OWASP-CSRF</H1>
    <B>Azzeddine Ramrami</B> 
    <A HREF="mailto:owasp-csrfguard%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfguard%5D%20Community%20Question%20regarding%20OWASP-CSRF&In-Reply-To=%3CCAL4seLEPG5sdFTqrU8Ob5v74Tv-XsQOPTrO5HcnCmM0xPni6_g%40mail.gmail.com%3E"
       TITLE="[Owasp-csrfguard] Community Question regarding OWASP-CSRF">azzeddine.ramrami at owasp.org
       </A><BR>
    <I>Tue Apr  8 19:57:50 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000299.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
        <LI>Next message: <A HREF="000298.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#300">[ date ]</a>
              <a href="thread.html#300">[ thread ]</a>
              <a href="subject.html#300">[ subject ]</a>
              <a href="author.html#300">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is what I test in IBM WAS 8.0:


In particular, in the csrfguard.properties file, I had to change the
org.owasp.csrfguard.PRNG property

From: org.owasp.csrfguard.PRNG =SHA1PRNG
To: org.owasp.csrfguard.PRNG=IBMSecureRandom

And in the CsrfGuard.java file, defaults are hard-coded for the following
two values, which have to be changed for WebSphere servers

From: org.owasp.csrfguard.PRNG=SHA1PRNG
To: org.owasp.csrfguard.PRNG=IBMSecureRandom
---
From: org.owasp.csrfguard.PRNG.Provider=SUN
To: org.owasp.csrfguard.PRNG.Provider=IBMJCE
---

Because of the change to the .java file, the code had to be recompiled. The
OWASP CSRFGuard Install Guide shows how to list the CSRFGuardListener class
in its example web.xml file. And the CSRFGuard.jar file on my company's
application security web site contains this class file. But I was not able
to find this java code anywhere. So instead, I used the
CsrfGuardServletContextListener and CsrfGuardHttpSessionListener classes,
and put them in my web.xml as follows:

    &lt;listener&gt;

&lt;listener-class&gt;org.owasp.csrfguard.CsrfGuardServletContextListener&lt;/listener-class&gt;
    &lt;/listener&gt;
    &lt;listener&gt;

&lt;listener-class&gt;org.owasp.csrfguard.CsrfGuardHttpSessionListener&lt;/listener-class&gt;
    &lt;/listener&gt;

It would be possible to put both properties in csrfguard.properties and
forgo the recompile of the Java code, like this:
org.owasp.csrfguard.PRNG=IBMSecureRandom
org.owasp.csrfguard.PRNG.Provider=IBMJCE




On Tue, Apr 8, 2014 at 7:46 PM, &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">john.m.allen at thomsonreuters.com</A>&gt; wrote:

&gt;<i>  I'm not sure if this answers your question, Chris, but if you've
</I>&gt;<i> downloaded the source, take a look at
</I>&gt;<i>
</I>&gt;<i> ...\csrfguard\src\main\resources\csrfguard.js
</I>&gt;<i>
</I>&gt;<i> about line 392.  That was the only place I found that it fetches and
</I>&gt;<i> injects the token.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> (Caution:  I think the &quot;if(%INJECT_XHR% == true)&quot; closing brace is
</I>&gt;<i> misplaced, too far down.  It makes it work only if Ajax is enabled.)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> John
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [mailto:
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] *On Behalf Of *Chris Hyzer
</I>&gt;<i> *Sent:* Tuesday, April 08, 2014 2:21 PM
</I>&gt;<i> *To:* Sarah Baso; Azzeddine Ramrami; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ranjith.sundarajchandras at its.ny.gov</A>
</I>&gt;<i>
</I>&gt;<i> *Cc:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> *Subject:* Re: [Owasp-csrfguard] Community Question regarding OWASP-CSRF
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just curious... CSRF guard will parse a page and add/edit some DOM elements
</I>&gt;<i> so that the token is passed back and forth.  But after an Ajax request,
</I>&gt;<i> when new page elements (links, forms) are potentially added, will CSRF
</I>&gt;<i> guard decorate these so that the token is passed?  Or does a Javascript
</I>&gt;<i> function need to be called after ajax changed the page so that new elements
</I>&gt;<i> are decorated?  When you get the error, can you see the network tab in a
</I>&gt;<i> browser developer tools plugin to see if a token is even being passed at
</I>&gt;<i> all?  Does it work if you don't have token per page?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Chris
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A> [mailto:
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard-bounces at lists.owasp.org</A>] *On Behalf Of *Sarah Baso
</I>&gt;<i> *Sent:* Tuesday, April 08, 2014 3:16 PM
</I>&gt;<i> *To:* Azzeddine Ramrami; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">ranjith.sundarajchandras at its.ny.gov</A>
</I>&gt;<i> *Cc:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">owasp-csrfguard at lists.owasp.org</A>
</I>&gt;<i> *Subject:* Re: [Owasp-csrfguard] Community Question regarding OWASP-CSRF
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ranjith - can you provide a bit more information as Azzeddine has
</I>&gt;<i> requested?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sarah
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Apr 8, 2014 at 12:14 PM, Azzeddine Ramrami &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">azzeddine.ramrami at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Thanks Sarah.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I will take this request for further analysis. Help form other leaders or
</I>&gt;<i> users of CSRF-Guard is welcome.
</I>&gt;<i> Just to be clear I will work on this issue as volunteer, this mean I will
</I>&gt;<i> do my best to solve this issue if I can reproduce it.
</I>&gt;<i> Some questions:
</I>&gt;<i> - Witch version of CSRF-Guard is used.
</I>&gt;<i> - Witch Application Server is used.
</I>&gt;<i> - Browser name and version.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Azzeddine
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Apr 8, 2014 at 5:23 PM, Sarah Baso &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Azzeddine and others -
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We received this question through our community &quot;contact us&quot; form - can
</I>&gt;<i> you help with responding?  The submitter is cc'ed.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *We have secured our public website using OWASP - CSRF guard and
</I>&gt;<i> configured TokenPerPage=true. We use JSF 2.0 (myfaces) for our front-end
</I>&gt;<i> development.  Every thing works good as expected except when we use JSF
</I>&gt;<i> &lt;f:ajax&gt;. When we submit an ajax request from a page, the ajax request is
</I>&gt;<i> successful but the subsequent Http Request fails with a message (&quot;potential
</I>&gt;<i> cross-site request forgery (CSRF) attack thwarted (user:&lt;anonymous&gt;%,
</I>&gt;<i> ip:x.x.x.x, uri:/ppr/secured/xxxx.faces, error:request token does not match
</I>&gt;<i> page token)&quot;). *
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *Below is our speculation : - In JSF the URL displayed in the browser
</I>&gt;<i> address bar is always the previous page's url ( as JSF 'POST' forwards the
</I>&gt;<i> request). And ajax request uses the current page's url. May be the ajax
</I>&gt;<i> request overrides the token.  We are not sure if this could cause any
</I>&gt;<i> issues with token tracking - but we just want to hint you our speculation
</I>&gt;<i> and get your suggestion/guidance to fix this issue.*
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks in advance,
</I>&gt;<i>
</I>&gt;<i> Sarah Baso
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Executive Director
</I>&gt;<i>
</I>&gt;<i> OWASP Foundation
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>
</I>&gt;<i> +1.312.869.2779
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>   --
</I>&gt;<i>
</I>&gt;<i> Azzeddine RAMRAMI
</I>&gt;<i> +33 6 65 48 90 04.
</I>&gt;<i> Enterprise Security Architect
</I>&gt;<i> OWASP Leader (Morocco Chapter)
</I>&gt;<i>
</I>&gt;<i> Mozilla Security Projects Mentor
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Executive Director
</I>&gt;<i>
</I>&gt;<i> OWASP Foundation
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">sarah.baso at owasp.org</A>
</I>&gt;<i> +1.312.869.2779
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Azzeddine RAMRAMI
+33 6 65 48 90 04.
Enterprise Security Architect
OWASP Leader (Morocco Chapter)
Mozilla Security Projects Mentor
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140408/e70ea979/attachment.html">http://lists.owasp.org/pipermail/owasp-csrfguard/attachments/20140408/e70ea979/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000299.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
	<LI>Next message: <A HREF="000298.html">[Owasp-csrfguard] Community Question regarding OWASP-CSRF
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#300">[ date ]</a>
              <a href="thread.html#300">[ thread ]</a>
              <a href="subject.html#300">[ subject ]</a>
              <a href="author.html#300">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfguard">More information about the Owasp-csrfguard
mailing list</a><br>
</body></html>
