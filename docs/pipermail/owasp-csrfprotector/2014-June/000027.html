<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-csrfprotector] Needs Decision
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-csrfprotector%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfprotector%5D%20Needs%20Decision&In-Reply-To=%3CCAOPE6Pi8fs6zBEdUDY2Y7qHJZSjdvQc9oH%3DA%3DhWmcKGo7aH8JQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000026.html">
   <LINK REL="Next"  HREF="000028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-csrfprotector] Needs Decision</H1>
    <B>Kevin W. Wall</B> 
    <A HREF="mailto:owasp-csrfprotector%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-csrfprotector%5D%20Needs%20Decision&In-Reply-To=%3CCAOPE6Pi8fs6zBEdUDY2Y7qHJZSjdvQc9oH%3DA%3DhWmcKGo7aH8JQ%40mail.gmail.com%3E"
       TITLE="[Owasp-csrfprotector] Needs Decision">kevin.w.wall at gmail.com
       </A><BR>
    <I>Wed Jun  4 02:13:34 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="000026.html">[Owasp-csrfprotector] Needs Decision
</A></li>
        <LI>Next message: <A HREF="000028.html">[Owasp-csrfprotector] Needs Decision
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jun 2, 2014 at 2:55 PM, Minhaz A V &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-csrfprotector">minhazav at gmail.com</A>&gt; wrote:
&gt;<i> Hi,
</I>&gt;<i> Here is the list of ideas, we need to decide, what to do:
</I>
Normally these are the things that we would (and IMO, should) discuss at
a G+ Hangout or whatever. I suggest that you propose another Dooble with
some very diverse times that might work for you (at least say 4
different days) and
see if we can manage to get together to discuss this.  On the plus side, I
think you are making a lot of great progress, so at this point, I'm not too
concerned.

&gt;<i> In GET requests we are using an array of patterns to find weather we need to
</I>&gt;<i> validate for current request (for ex: *://*/* would mean validate for each
</I>&gt;<i> request). The function checking this, is called by static method. So it can
</I>&gt;<i> be overridden by the developer, in case he want to apply his own logic for
</I>&gt;<i> this (Suggested by Abbas +1), So I guess this would be a nice feature to
</I>&gt;<i> have. [implementation]
</I>
While this likely may make the implementation a little bit more complex, I think
it will result in making your CSRF_Protector easier to use...and that is, in
addition to providing a method that can be overridden to define what GET
URLs should get a CSRF token added, I would also suggest that you allow
some sort of simple pattern match to IGNORE all GET requests on certain
types of files. For instance, most GETs originate from requesting images,
JavaScript, and cascading style-sheets and you generally don't need CSRF
tokens for those (I suppose you could if you are implementing a GET request
via an HTML form in JavaScript, but that's rare and hopefully there's a better
way to handle such edge cases). But I was thinking about something like a
property that would take a list of file suffixes to disregard with
respect to CSRF
tokens when made via GETs. E.g.,

    csrf_protector.get.ignore_suffix=.png,.gif,.jpg,.js,.css

to ignore all PNG, GIF, JPEG, JavaScript, and cascading style sheets
requested via GETs. Those really are the bulk of the GET requests
anyway.

&gt;<i> For the above part to work, we need to have similar logic in our js file. to
</I>&gt;<i> check which all urls it need to be rewritten/modified: so we can pass this
</I>&gt;<i> patterns to the js file as parameters. [my idea]: we can keep our javascript
</I>&gt;<i> part as php file, and pass the patterns as JSON string in POST query to this
</I>&gt;<i> file. the php file would give js output, and it will be parsed well by
</I>&gt;<i> browser.
</I>&gt;<i> Jim suggested to use similar method, for POST requests. it has its own pros
</I>&gt;<i> and cons.
</I>&gt;<i>
</I>&gt;<i> PROS
</I>&gt;<i>
</I>&gt;<i> not all POST need CSRF protection
</I>&gt;<i> no overhead of validating every request on server side, and attaching the
</I>&gt;<i> cookie on client side for each request.
</I>&gt;<i> makes the library configurable to a great extend.
</I>&gt;<i>
</I>&gt;<i> CONS
</I>&gt;<i>
</I>&gt;<i> It complicates the logic a little and adds to developer's efforts.
</I>&gt;<i> checking if a particular url should be considered or not has a worst case
</I>&gt;<i> complexity of O(n), where n is the no of patterns in config file. so if
</I>&gt;<i> there are lots of urls to check, say k, complexity would be O(nk) for js.
</I>&gt;<i> while it would be like O(1) if we check for every POST request.
</I>
These are topics for in-person discussion, if only because I don't
want to wear out my fingers typing a detailed response.

&gt;<i> logging function is avalilable at:
</I>&gt;<i> <A HREF="https://github.com/mebjas/CSRF-Protector-PHP/blob/master/libs/csrf/csrfprotector.php#L298">https://github.com/mebjas/CSRF-Protector-PHP/blob/master/libs/csrf/csrfprotector.php#L298</A>
</I>&gt;<i> needs to know if anything else we shall log?
</I>
Regarding logging, you would want to log the client IP address (and/or
proxied address,
X-Forwarded-For) if you can get them. Also, if you know the authenticated user
name and have a uniform way to obtain it, that also is very useful.  I know you
were talking about saving a hash of the session ID; I don't see it
there, but perhaps
that is what this is supposed to be:

     $log['cookie'] = $_COOKIE;

I just don't know enough about PHP to know what that means....but in general,
I don't think you really want to log cookies, even if this is *only*
the session ID.
If may be low risk in most situations, but if you consider insider
attacks, in some
scenarios, logging session IDs would be forbidden where I work today.


&gt;<i> Do we need to provide some method to inform the admin in case of detection,
</I>&gt;<i> like using mail?
</I>
I'd say 'no'. That's definite feature creep. You definitely should document what
each error case looks like, and maybe even provide a unique error code for
all the different errors. From there, it is just using some sort of
log monitoring,
whether it's something simple like logwatch, or something complex like
sending the logs off to your SIEM. (For the latter, you may want to consider
supporting logging to syslog, but I'd go no further than that and even that I
think is scope creep.)

-kevin
--
Blog: <A HREF="http://off-the-wall-security.blogspot.com/">http://off-the-wall-security.blogspot.com/</A>
NSA: All your crypto bit are belong to us.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000026.html">[Owasp-csrfprotector] Needs Decision
</A></li>
	<LI>Next message: <A HREF="000028.html">[Owasp-csrfprotector] Needs Decision
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#27">[ date ]</a>
              <a href="thread.html#27">[ thread ]</a>
              <a href="subject.html#27">[ subject ]</a>
              <a href="author.html#27">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-csrfprotector">More information about the Owasp-csrfprotector
mailing list</a><br>
</body></html>
