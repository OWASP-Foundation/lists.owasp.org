<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-italy] Blind SQL Injection e falsi positivi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-italy%40lists.owasp.org?Subject=%5BOwasp-italy%5D%20Blind%20SQL%20Injection%20e%20falsi%20positivi&In-Reply-To=002401c6962e%2401775e60%242101a8c0%40alberto">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000196.html">
   <LINK REL="Next"  HREF="000197.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-italy] Blind SQL Injection e falsi positivi</H1>
    <B>Stefano Di Paola</B> 
    <A HREF="mailto:owasp-italy%40lists.owasp.org?Subject=%5BOwasp-italy%5D%20Blind%20SQL%20Injection%20e%20falsi%20positivi&In-Reply-To=002401c6962e%2401775e60%242101a8c0%40alberto"
       TITLE="[Owasp-italy] Blind SQL Injection e falsi positivi">stefano.dipaola at wisec.it
       </A><BR>
    <I>Fri Jun 23 07:12:04 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000196.html">[Owasp-italy] Blind SQL Injection e falsi positivi
</A></li>
        <LI>Next message: <A HREF="000197.html">[Owasp-italy] Blind SQL Injection e falsi positivi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#198">[ date ]</a>
              <a href="thread.html#198">[ thread ]</a>
              <a href="subject.html#198">[ subject ]</a>
              <a href="author.html#198">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ciao Luca,


&quot;Luca Terenziani&quot; wrote:
&gt;<i>  Ora la domanda che vi pongo e` la seguente:
</I>&gt;<i> 
</I>&gt;<i>  supponiamo che voglia testare la Blind SQL Inj. sulla seguente
</I>&gt;<i>  URL:
</I>&gt;<i>  <A HREF="http://acme?idcat=1">http://acme?idcat=1</A>
</I>&gt;<i> 
</I>&gt;<i>  Un primo approccio potrebbe essere:
</I>&gt;<i> 
</I>&gt;<i>  *) memorizzo il contenuto della pagina di partenza
</I>&gt;<i>  *) memorizzare il contenuto di una pagina contenente
</I>&gt;<i>     &quot; AND 1=1&quot;
</I>&gt;<i>  *) memorizzare il contenuto di una pagina contenente
</I>&gt;<i>     &quot; AND 1=9&quot;
</I>&gt;<i> 
</I>&gt;<i>  e dire che la Blind Injection e` andata a buon fine
</I>&gt;<i>  se e soltanto se:
</I>&gt;<i>  1) l'HTML di <A HREF="http://acme?idcat=1">http://acme?idcat=1</A> != <A HREF="http://acme?idcat=1">http://acme?idcat=1</A> AND 9=9
</I>&gt;<i>  2) l'HTML di <A HREF="http://acme?idcat=1">http://acme?idcat=1</A> == <A HREF="http://acme?idcat=1">http://acme?idcat=1</A> AND 1=1
</I>
Dai un occhiata a Sqlbftools
<A HREF="http://www.reversing.org/node/view/11">http://www.reversing.org/node/view/11</A>
( ci sono anche un paio di video  <A HREF="http://www.milw0rm.com/video/">http://www.milw0rm.com/video/</A> )

Ti riuscira' meglio confrontare i metodi di verifica e di inferenza.
In particolare considera due metodi:
1. uno semi-automatico. sei tu via linea di comando che dici al sw che pezzo di testo (plain o html)
   cercare quando la blind e' andata o no a buon fine.
2. uno automatico.Attraverso le funzioni di delay e benchmarking, ovviamente se presenti.

Come hai gia' ben considerato, l'approccio del confronto sulla pagina html puo' dare, per vari motivi
dei falsi positivi.



&gt;<i>  Ora la domanda che ci si puo` porre e` la seguente:
</I>&gt;<i>  &quot;Come viene effettuato il confronto tra gli HTML&quot; ?
</I>&gt;<i> 
</I>&gt;<i>  Un primo approccio potrebbe essere:confronto carattere per carattere.
</I>&gt;<i>  Questo approccio potrebbe essere &quot;attenuato&quot; da un modulo ISAPI/mod_*
</I>&gt;<i>  che inserisce all'interno del body delle HTTP RESPONSE:
</I>&gt;<i>  *) caratteri random
</I>&gt;<i>  *) TAG html che rendono il risultato della renderizzazione da parte
</I>&gt;<i>     del browser intatto
</I>&gt;<i> 
</I>&gt;<i>  oppure potrei utilizzare una delle tante techiche di steganografia su
</I>&gt;<i>  HTML.. roba tipo:
</I>&gt;<i>  &lt;IMG SRC=&quot;picture.jpg&quot; ALT=&quot;A picture&quot;&gt; viene riscritta in:
</I>&gt;<i>  &lt;IMG ALT=&quot;A picture&quot; SRC=&quot;picture.jpg&quot;&gt;
</I>&gt;<i>  utilizzando un certo set di &quot;regole di riscrittura HTML&quot; che rendono
</I>&gt;<i>  intatta la renderizzazione dai browser .. potrei generare una miriade
</I>&gt;<i>  di pagine HTML differenti.
</I>&gt;<i> 
</I>
Mitigare la sql inj usando queste tecniche mi sembra come chiudere
gli occhi per non vedere il braccio rotto, o se preferisci c'e' 
l'analogia dello struzzo con la testa nella sabbia,
oppure quella della Guida Galattica che dice che bisogna mettersi un asciugamano
sulla testa per evitare lo sguardo della Vorace Bestia Bugblatta di Traal 
(un animale abominevolmente stupido, che pensa che se voi non lo vedete nemmeno 
lui possa vedere voi: &#232; matto da legare, ma molto, molto vorace) :)

Mitigare queste cose e' molto difficile se non evitando di creare i bachi alla 
fonte...usando best practice di programmazione e progettazione.
1.Controllo/cast di tipo dei parametri _sempre_
2.Stored Procedures o prepared statements  se possibile.
3.Tante altre cose che trovi in giro sul web
4.Sapere cosa si programma =) ovvero avere la visione globale di tutti i layer che il flusso degli input 
  attraversa. Aka conoscere le specifiche di interfaccia.

Ovviamente se l'applicazione e' gia stata scritta, ci sono i web application firewall
che possono, se ben configurati, mitigare molte vulnerabilita' usando  regole di white/blacklisting
su parametri specifici o su input in generale.
come ha gia' detto Antonio (potrei sbagliare perche' non ho sottomano la mail) c'e' _Il_ waf open source
 www.modsecurity.org/ 
Le regole generiche le trovi via google.
Ho scritto un po di idee sulla generazione semi automatica di regole whitelist che puoi trovare
su 
<A HREF="http://www.wisec.it/sectou.php">http://www.wisec.it/sectou.php</A>

Molto in alpha il mio modestissimo (da non usare in produzione :) mod_anti_tamper 
<A HREF="http://www.wisec.it/projects.php?id=3">http://www.wisec.it/projects.php?id=3</A> 
Che ho sviluppato piu' che altro come esercizio di stile e verifica dell'applicabilita' dell'idea.
Su siti semplici funziona mentre su sistemi un po' piu' complessi e' da migliorare e/o cestinare..

&gt;<i>  Certo e` che se il mio tool di SQL Injection una volta memorizzate
</I>&gt;<i>  le pagine, strippa via tutti i tag HTML riesco ad evadere il meccanismo.
</I>&gt;<i> 
</I>&gt;<i>  Ma a questo punto, se voglio attenuare ulteriormente Blind SQL
</I>&gt;<i>  Injection, potrei steganografizzare il testo dell'HTML... al fine di
</I>&gt;<i>  generare pagina diverse anche nel testo, che portano verso lo stesso
</I>&gt;<i>  risultato.
</I>&gt;<i>  Ma anche questo tipo di hardening potrebbe essere facilmente
</I>&gt;<i>  &quot;spezzato&quot; facendo si che l'algoritmo di confronto per la Blind SQL
</I>&gt;<i>  Inj. strippi via pure ' ' e '\n'
</I>
Verifica eventualmente se un approccio di similarita' del testo e' applicabile.
Tipo soglia  percentuale(mi sa che Absinthe ne fa uso) .
Qui puoi trovare un po' di buone idee algoritmi:
<A HREF="http://www.google.it/search?hl=it&amp;q=text+similarity">http://www.google.it/search?hl=it&amp;q=text+similarity</A>

&gt;<i>  Ora, al di la` del lungo poema (aka; pippa mentale) la domanda che
</I>&gt;<i>  volevo porvi e` la seguente:
</I>&gt;<i>  *) Acunetix, Wikto, WebInspect,etc. etc. come effettuano il confronto
</I>&gt;<i>     sui fault injection?
</I>&gt;<i>  *) Quali tecniche mi consentono di &quot;attenuare&quot; le SQL Injection lato
</I>&gt;<i>     server (e non WEBAPP!!!!)
</I>
Leggi su. =)

my 0.02 
Stefano


&lt;saluti&gt;
 Ne approfitto per salutare tutti essendo il primo post.
&lt;/saluti&gt;

...oOOo...oOOo....
Stefano Di Paola
Ingegnere Informatico

Web: <A HREF="http://www.wisec.it">http://www.wisec.it</A>
..................



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000196.html">[Owasp-italy] Blind SQL Injection e falsi positivi
</A></li>
	<LI>Next message: <A HREF="000197.html">[Owasp-italy] Blind SQL Injection e falsi positivi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#198">[ date ]</a>
              <a href="thread.html#198">[ thread ]</a>
              <a href="subject.html#198">[ subject ]</a>
              <a href="author.html#198">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.owasp.org/mailman/listinfo/owasp-italy">More information about the Owasp-italy
mailing list</a><br>
</body></html>
