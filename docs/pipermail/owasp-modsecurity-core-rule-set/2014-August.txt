From RBarnett at trustwave.com  Tue Aug  5 16:08:36 2014
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 5 Aug 2014 16:08:36 +0000
Subject: [Owasp-modsecurity-core-rule-set] Live ModSecurity Demos at
	Blackhat Arsenal
Message-ID: <D00679C1.10DC6B%rbarnett@trustwave.com>

FYI ? if any of you are going to be out at Blackhat USA this week in Las Vegas, please stop by Arsenal tools on Thursday morning as I will be there demoing many cool ModSecurity features :)

http://blog.spiderlabs.com/2014/08/blackhat-arsenal-2014-live-modsecurity-demonstrations.html

Hope to see some of you in Las Vegas!

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140805/4bf8cc07/attachment.html>

From dan at madjic.net  Wed Aug 13 17:43:06 2014
From: dan at madjic.net (Dan Goldberg)
Date: Wed, 13 Aug 2014 13:43:06 -0400
Subject: [Owasp-modsecurity-core-rule-set] Stumped on a false positive rule
	950901
Message-ID: <CACnpJx8QD2r8tX2ArMvZVRBz6jqVHVXAKQfQFA56j0Q0h0bf2Q@mail.gmail.com>

Hi,
I would like a little help if possible writing an exception for what
is being tagged as a SQL Injection attempt.

here is the audit log data:
[Wed Aug 13 16:58:59 2014] [error] [client aaa.bbb.ccc.ddd]
ModSecurity: Access denied with code 403 (phase 2). Pattern match
"\\\\b(\\\\d+)
 ?(?:=|<>|<=>|<|>|!=)
?\\\\1\\\\b|[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98](\\\\d+)[\\\\'\\"\\\\`\\\\\\xc2\\x
b4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98] ?(?:=|<>|<=>|<|>|!=)
?[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98]\\\\
2\\\\b|[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x98 ..." at
ARGS:position[e_statement]. [file "/usr/share/modsecurity-crs/activate
d_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "435"]
[id "950901"] [rev "2.2.0"] [msg "SQL Injection Attack"] [data " a
nd 60"] [severity "CRITICAL"] [hostname "test.example.com"] [uri
"/api/search/posit/509"] [unique_id "U at uZUwoAZa
IAAEDBdrsAAAAG"]

The text in a PUT validated by the web app contains a statement about
some regulations all URL encoded:

The string it is objecting to is in the PUT body here:
CFR+%26sect%3B%26sect%3B+60-1.4(a)%2C+60-300.5(a)+and+60-741.5(a).

My current rule is:
SecRule REQUEST_LINE "PUT /api/search/posit/\d{3}"
"chain,phase:2,t:none,t:compressWhiteSpace,nolog,pass"
        SecRule ARGS|REQUEST_BODY "@streq and60"
"nolog,ctl:ruleRemoveById=905901"
Any ideas? please?
Thanks Dan

-- 
--
Dan at madjic.net

From jroback at gmail.com  Wed Aug 13 20:26:12 2014
From: jroback at gmail.com (Joshua Roback)
Date: Wed, 13 Aug 2014 16:26:12 -0400
Subject: [Owasp-modsecurity-core-rule-set] Stumped on a false positive
 rule 950901
In-Reply-To: <CACnpJx8QD2r8tX2ArMvZVRBz6jqVHVXAKQfQFA56j0Q0h0bf2Q@mail.gmail.com>
References: <CACnpJx8QD2r8tX2ArMvZVRBz6jqVHVXAKQfQFA56j0Q0h0bf2Q@mail.gmail.com>
Message-ID: <CAExQ=_eTt=BMKufihvFDtdXoFzNqCGgY7dDwVd2Md8bxcL9fjw@mail.gmail.com>

What if you change your regex representing the URI to escape the /

SecRule REQUEST_LINE "PUT \/api\/search\/posit\/\d{3}"
"chain,phase:2,t:none,t:compressWhiteSpace,nolog,pass"
        SecRule ARGS|REQUEST_BODY "@streq and60"
"nolog,ctl:ruleRemoveById=905901"


On Wed, Aug 13, 2014 at 1:43 PM, Dan Goldberg <dan at madjic.net> wrote:

> Hi,
> I would like a little help if possible writing an exception for what
> is being tagged as a SQL Injection attempt.
>
> here is the audit log data:
> [Wed Aug 13 16:58:59 2014] [error] [client aaa.bbb.ccc.ddd]
> ModSecurity: Access denied with code 403 (phase 2). Pattern match
> "\\\\b(\\\\d+)
>  ?(?:=|<>|<=>|<|>|!=)
>
> ?\\\\1\\\\b|[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98](\\\\d+)[\\\\'\\"\\\\`\\\\\\xc2\\x
> b4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98] ?(?:=|<>|<=>|<|>|!=)
> ?[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98]\\\\
> 2\\\\b|[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x98 ..." at
> ARGS:position[e_statement]. [file "/usr/share/modsecurity-crs/activate
> d_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "435"]
> [id "950901"] [rev "2.2.0"] [msg "SQL Injection Attack"] [data " a
> nd 60"] [severity "CRITICAL"] [hostname "test.example.com"] [uri
> "/api/search/posit/509"] [unique_id "U at uZUwoAZa
> IAAEDBdrsAAAAG"]
>
> The text in a PUT validated by the web app contains a statement about
> some regulations all URL encoded:
>
> The string it is objecting to is in the PUT body here:
> CFR+%26sect%3B%26sect%3B+60-1.4(a)%2C+60-300.5(a)+and+60-741.5(a).
>
> My current rule is:
> SecRule REQUEST_LINE "PUT /api/search/posit/\d{3}"
> "chain,phase:2,t:none,t:compressWhiteSpace,nolog,pass"
>         SecRule ARGS|REQUEST_BODY "@streq and60"
> "nolog,ctl:ruleRemoveById=905901"
> Any ideas? please?
> Thanks Dan
>
> --
> --
> Dan at madjic.net
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Joshua Roback
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140813/9ac8b76f/attachment.html>

From dan at madjic.net  Wed Aug 13 20:31:35 2014
From: dan at madjic.net (Dan Goldberg)
Date: Wed, 13 Aug 2014 16:31:35 -0400
Subject: [Owasp-modsecurity-core-rule-set] Stumped on a false positive
 rule 950901
In-Reply-To: <CAExQ=_eTt=BMKufihvFDtdXoFzNqCGgY7dDwVd2Md8bxcL9fjw@mail.gmail.com>
References: <CACnpJx8QD2r8tX2ArMvZVRBz6jqVHVXAKQfQFA56j0Q0h0bf2Q@mail.gmail.com>
	<CAExQ=_eTt=BMKufihvFDtdXoFzNqCGgY7dDwVd2Md8bxcL9fjw@mail.gmail.com>
Message-ID: <CACnpJx9=kpYXh_SnUBjQD-HLnabTUpj65DUO9SrCcdMgcooMug@mail.gmail.com>

HI Joshua,
Thank you for the feedback. In this case I have lots of rules
functioning perfectly with out escaping the / chars. I will give it a
try.
By the way I did post an error , the ruleID is 950901, not 905901.
That didn't help either though.

Thanks Dan

On Wed, Aug 13, 2014 at 4:26 PM, Joshua Roback <jroback at gmail.com> wrote:
> What if you change your regex representing the URI to escape the /
>
> SecRule REQUEST_LINE "PUT \/api\/search\/posit\/\d{3}"
>
> "chain,phase:2,t:none,t:compressWhiteSpace,nolog,pass"
>         SecRule ARGS|REQUEST_BODY "@streq and60"
> "nolog,ctl:ruleRemoveById=905901"
>
>
> On Wed, Aug 13, 2014 at 1:43 PM, Dan Goldberg <dan at madjic.net> wrote:
>>
>> Hi,
>> I would like a little help if possible writing an exception for what
>> is being tagged as a SQL Injection attempt.
>>
>> here is the audit log data:
>> [Wed Aug 13 16:58:59 2014] [error] [client aaa.bbb.ccc.ddd]
>> ModSecurity: Access denied with code 403 (phase 2). Pattern match
>> "\\\\b(\\\\d+)
>>  ?(?:=|<>|<=>|<|>|!=)
>>
>> ?\\\\1\\\\b|[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98](\\\\d+)[\\\\'\\"\\\\`\\\\\\xc2\\x
>> b4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98] ?(?:=|<>|<=>|<|>|!=)
>> ?[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98]\\\\
>> 2\\\\b|[\\\\'\\"\\\\`\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x98 ..." at
>> ARGS:position[e_statement]. [file "/usr/share/modsecurity-crs/activate
>> d_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "435"]
>> [id "950901"] [rev "2.2.0"] [msg "SQL Injection Attack"] [data " a
>> nd 60"] [severity "CRITICAL"] [hostname "test.example.com"] [uri
>> "/api/search/posit/509"] [unique_id "U at uZUwoAZa
>> IAAEDBdrsAAAAG"]
>>
>> The text in a PUT validated by the web app contains a statement about
>> some regulations all URL encoded:
>>
>> The string it is objecting to is in the PUT body here:
>> CFR+%26sect%3B%26sect%3B+60-1.4(a)%2C+60-300.5(a)+and+60-741.5(a).
>>
>> My current rule is:
>> SecRule REQUEST_LINE "PUT /api/search/posit/\d{3}"
>> "chain,phase:2,t:none,t:compressWhiteSpace,nolog,pass"
>>         SecRule ARGS|REQUEST_BODY "@streq and60"
>> "nolog,ctl:ruleRemoveById=905901"
>> Any ideas? please?
>> Thanks Dan
>>
>> --
>> --
>> Dan at madjic.net
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
>
>
> --
> Joshua Roback



-- 
--
Dan at madjic.net

From earl.fogel at usask.ca  Mon Aug 18 20:49:20 2014
From: earl.fogel at usask.ca (Earl Fogel)
Date: Mon, 18 Aug 2014 14:49:20 -0600 (CST)
Subject: [Owasp-modsecurity-core-rule-set] inconsistent
	tx.sql_injection_score calculation?
Message-ID: <alpine.LRH.2.11.1408181355530.27590@ash.usask.ca>

Hi,

In the SQL injection rules, tx.sql_injection_score is set two different 
ways. Some rules use "+1" while others increment it in sync with 
tx.anomaly_score, e.g.:

Rule 981231: 
setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.sql_injection_score=+1

Rule 981260:
setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score}

If the latter approach was used everywhere, then you could easily skip the 
SQL injection rules for certain URLs -- just create a local rule that 
matches the URLs you are interested in and subtract the
sql_injection_score from the anomaly_score for those URLs.

I've done this in my own copy of the core rules, and would love to have 
these changes included in the official core rules.

Earl Fogel
Information and Communications Technology
University of Saskatchewan
--


From wrender at otherdata.com  Wed Aug 20 03:56:22 2014
From: wrender at otherdata.com (Wesley Render)
Date: Tue, 19 Aug 2014 21:56:22 -0600
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
	Only send critical events
Message-ID: <assp.73093249f2.006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>

Would anyone know if it would be possible to adjust the core rule set
configuration file so that only events that have a total inbound score of 5
or higher are sent to the audit log.  (Running in Collaborative Detection
and Anomaly Scoring & Blocking)  Version: SecComponentSignature
"OWASP_CRS/2.2.9"

 

For example:  I am sending logs using mlogc  to a server that has the
auditconsole installed.  The problem is the server is at a different
location and we have limited bandwidth.  So would only like to log events
that have an  inbound_anomaly_score_level of 5 or greater.

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201

 <http://www.otherdata.com/> www.otherdata.com

 <http://www.facebook.com/otherdata> 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140819/c80ce0c7/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140819/c80ce0c7/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140819/c80ce0c7/attachment-0001.jpg>

From jamuse at owasp.org  Wed Aug 20 13:15:46 2014
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Wed, 20 Aug 2014 16:15:46 +0300
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
 Only send critical events
In-Reply-To: <assp.73093249f2.006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>
References: <assp.73093249f2.006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>
Message-ID: <CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>

On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render <wrender at otherdata.com>
wrote:

> Would anyone know if it would be possible to adjust the core rule set
> configuration file so that only events that have a total inbound score of 5
> or higher are sent to the audit log.  (Running in Collaborative Detection
> and Anomaly Scoring & Blocking)  Version: SecComponentSignature
> "OWASP_CRS/2.2.9"
>

Hi Wesley,

When the CRS is used in anomaly mode it should not create audit logs unless
the event passes the threshold set in the 10 file. Can you send me
privately an event from AuditConsole that does not have an anomaly score
level above 5? I'm specifically interested in sections H and K.

- Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140820/b9f07596/attachment.html>

From earl.fogel at usask.ca  Wed Aug 20 15:59:14 2014
From: earl.fogel at usask.ca (Earl Fogel)
Date: Wed, 20 Aug 2014 09:59:14 -0600 (CST)
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
 Only send critical events
In-Reply-To: <CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>
References: <assp.73093249f2.006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>
	<CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>
Message-ID: <alpine.LRH.2.11.1408200951060.12374@ash.usask.ca>

I have this problem as well.  I also have:

SecDefaultAction "phase:1,pass,nolog,auditlog"
SecDefaultAction "phase:2,pass,nolog,auditlog"
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"

Could that be relevent?  How should these be set in collaborative detection 
mode?

Earl
-


On Wed, 20 Aug 2014, Josh Amishav-Zlatin <jamuse at owasp.org> wrote:

>On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render <wrender at otherdata.com> wrote:
>
>      Would anyone know if it would be possible to adjust the core rule set
>      configuration file so that only events that have a total inbound score of
>      5 or higher are sent to the audit log.? (Running in Collaborative
>      Detection and Anomaly Scoring & Blocking)? Version: SecComponentSignature
>      "OWASP_CRS/2.2.9"
>
>
>Hi Wesley,
>
>When the CRS is used in anomaly mode it should not create audit logs unless the event
>passes the threshold set in the 10 file. Can you send me privately an event from
>AuditConsole that does not have an anomaly score level above 5? I'm specifically
>interested in sections H and K.
>
>- Josh
>
>

-------------- next part --------------
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From wrender at otherdata.com  Wed Aug 20 17:29:42 2014
From: wrender at otherdata.com (Wesley Render)
Date: Wed, 20 Aug 2014 11:29:42 -0600
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
	Only send critical events
In-Reply-To: <alpine.LRH.2.11.1408200951060.12374@ash.usask.ca>
References: <006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>	<CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>
	<alpine.LRH.2.11.1408200951060.12374@ash.usask.ca>
Message-ID: <assp.23098c1788.008001cfbc9c$5d126380$17372a80$@otherdata.com>

When I set it to the following, I get a lot less logs coming in.  I am
confused on how it should be set as well when sending logs to AuditConsole
using mlogc.  Here is a summary of relevant settings I have right now
(below).   I guess it seems as though the logging settings are not able to
combine one correlated event into the audit log.  They can only combine one
correlated event into the apache error_log?


############  modsecurity_crs_10_setup.conf  Settings
##########################

# Collaborative Detection Mode 
SecDefaultAction "phase:1,pass,nolog"
SecDefaultAction "phase:2,pass,nolog"


# Collaborative Detection Blocking #
SecAction \
  "id:'900004', \
  phase:1, \
  t:none, \
  setvar:tx.anomaly_score_blocking=on, \
  nolog, \
  pass"


############ modsec2.user.conf  Settings
######################################
SecDataDir /usr/local/apache/conf/sec-data
SecTmpDir /usr/local/apache/conf/sec-tmp

SecRuleEngine On
SecPcreMatchLimit 50000
SecPcreMatchLimitRecursion 50000

# With SecRequestBodyAccess turned on care needs to be taken with false
positives
SecRequestBodyAccess On
SecRequestBodyLimit 134217728
SecRequestBodyLimitAction ProcessPartial
SecRequestBodyNoFilesLimit 131072
SecRequestBodyInMemoryLimit 131072

SecResponseBodyAccess On
SecResponseBodyMimeType (null) text/html text/plain text/xml
SecResponseBodyLimit 524228
SecResponseBodyLimitAction ProcessPartial
SecServerSignature Apache
SecCookieFormat 0

# Additional ModSecurity Logging Options for mlogc
# Use ReleventOnly auditing
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"

# Must use concurrent logging
SecAuditLogType Concurrent

# Send all audit log parts
SecAuditLogParts ABDEFHIJKZ

# Use the same /CollectorRoot/LogStorageDir as in mlogc.conf
SecAuditLogStorageDir /var/log/mlogc/data

# Pipe audit log to mlogc with your configuration
SecAuditLog "|/usr/local/modsecurity/bin/mlogc /etc/mlogc.conf"

# OWASP Rules
Include conf/owasp-modsecurity-crs/modsecurity_crs_10_setup.conf
Include conf/owasp-modsecurity-crs/activated_rules/*.conf

# Trustwave Commercial Rules
Include conf/slr_vuln_rules/owasp_crs_integration/attack_type/*.conf


Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201
www.otherdata.com


-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
Of Earl Fogel
Sent: August-20-14 9:59 AM
To: OWASP Mod Security
Subject: Re: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
Only send critical events

I have this problem as well.  I also have:

SecDefaultAction "phase:1,pass,nolog,auditlog"
SecDefaultAction "phase:2,pass,nolog,auditlog"
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"

Could that be relevent?  How should these be set in collaborative detection
mode?

Earl
-


On Wed, 20 Aug 2014, Josh Amishav-Zlatin <jamuse at owasp.org> wrote:

>On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render <wrender at otherdata.com>
wrote:
>
>      Would anyone know if it would be possible to adjust the core rule set
>      configuration file so that only events that have a total inbound
score of
>      5 or higher are sent to the audit log.? (Running in Collaborative
>      Detection and Anomaly Scoring & Blocking)? Version:
SecComponentSignature
>      "OWASP_CRS/2.2.9"
>
>
>Hi Wesley,
>
>When the CRS is used in anomaly mode it should not create audit logs 
>unless the event passes the threshold set in the 10 file. Can you send 
>me privately an event from AuditConsole that does not have an anomaly 
>score level above 5? I'm specifically interested in sections H and K.
>
>- Josh
>
>



From think.sabin at gmail.com  Thu Aug 21 10:16:41 2014
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Thu, 21 Aug 2014 16:01:41 +0545
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
	working
Message-ID: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>

hi,
im using latest modsecurity rule set and i tried out crs_11_bruteforce from
experimental rule. But its not working for me. I created a shortlink of it
in the activated rules directory, restarted the apache and when i brute
force my web application login page the modsecurity audit log dont give me
any brute force warnings. what could be the problem? Im using burp suite
pro version's intruder for brute forcing.
can anyone point to helpful resource that i can follow?

thanks.

regards
sabin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/aa50588b/attachment.html>

From dmmobil at 3w-media.de  Thu Aug 21 12:56:54 2014
From: dmmobil at 3w-media.de (=?ISO-8859-1?Q?Daniel_M=FCller?=)
Date: Thu, 21 Aug 2014 14:56:54 +0200
Subject: [Owasp-modsecurity-core-rule-set] False positive for SQL injection
	rule 981245
Message-ID: <53F5EC96.8080500@3w-media.de>

Hello,

the third-to-last branch in rule 981245 in
modsecurity_crs_41_sql_injection_attacks.conf matches things like
"?somename.jpg". Is that intended? It doesn't look much like an SQL
injection to me and names like these unfortunately occur quite
frequently on our servers. I can of course modify the rule, but maybe
it is just too overeager.

Greetings, Daniel.

PS: Which version do we use? modsec_audit.log says:
Producer: ModSecurity for Apache/2.6.8 (http://www.modsecurity.org/);
OWASP_CRS/2.2.5.

From wrender at otherdata.com  Thu Aug 21 15:51:34 2014
From: wrender at otherdata.com (Wesley Render)
Date: Thu, 21 Aug 2014 09:51:34 -0600
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force
	not	working
In-Reply-To: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>
Message-ID: <assp.031060e878.002001cfbd57$d2082fb0$76188f10$@otherdata.com>

In your modsecurity_crs_10_setup.conf file you need to make sure to uncomment, and define the paths for your login page.  You will notice the first line of the rule is commented out with a regular pound symbol.  Then restart apache.  Here is how mine looks. I set it up for WordPress and Drupal.  It has been working well for WordPress brute force attempts:

 

#

# -- [[ Brute Force Protection ]] ---------------------------------------------------------

#

# If you are using the Brute Force Protection rule set, then uncomment the following

# lines and set the following variables:

# - Protected URLs: resources to protect (e.g. login pages) - set to your login page

# - Burst Time Slice Interval: time interval window to monitor for bursts

# - Request Threshold: request # threshold to trigger a burst

# - Block Period: temporary block timeout

#

SecAction \

  "id:'900014', \

  phase:1, \

  t:none, \

  setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \

  setvar:'tx.brute_force_burst_time_slice=60', \

  setvar:'tx.brute_force_counter_threshold=10', \

  setvar:'tx.brute_force_block_timeout=300', \

  nolog, \

  pass"

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201

 <http://www.otherdata.com/> www.otherdata.com

 

 <http://www.facebook.com/otherdata> 

 

 

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Sabin Ranjit
Sent: August-21-14 4:17 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not working

 

hi,

im using latest modsecurity rule set and i tried out crs_11_bruteforce from experimental rule. But its not working for me. I created a shortlink of it in the activated rules directory, restarted the apache and when i brute force my web application login page the modsecurity audit log dont give me any brute force warnings. what could be the problem? Im using burp suite pro version's intruder for brute forcing.

can anyone point to helpful resource that i can follow?

thanks.

regards

sabin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/e5b5a953/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/e5b5a953/attachment.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/e5b5a953/attachment-0001.jpg>

From think.sabin at gmail.com  Thu Aug 21 16:38:44 2014
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Thu, 21 Aug 2014 22:23:44 +0545
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
	working
In-Reply-To: <assp.031060e878.002001cfbd57$d2082fb0$76188f10$@otherdata.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>
	<assp.031060e878.002001cfbd57$d2082fb0$76188f10$@otherdata.com>
Message-ID: <CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>

hi Wesley,
I'm not using wordpress, I'm try to protect my application made in Yii
framework and its login url looks like this:
https://domainname.net/user/user/login/
how can I set brute_force_protected_urls value for this of url ? I tried
few ways but it gave me syntax error.

thanks,

regards


On Thu, Aug 21, 2014 at 9:36 PM, Wesley Render <wrender at otherdata.com>
wrote:

> In your modsecurity_crs_10_setup.conf file you need to make sure to
> uncomment, and define the paths for your login page.  You will notice the
> first line of the rule is commented out with a regular pound symbol.  Then
> restart apache.  Here is how mine looks. I set it up for WordPress and
> Drupal.  It has been working well for WordPress brute force attempts:
>
>
>
> #
>
> # -- [[ Brute Force Protection ]]
> ---------------------------------------------------------
>
> #
>
> # If you are using the Brute Force Protection rule set, then uncomment the
> following
>
> # lines and set the following variables:
>
> # - Protected URLs: resources to protect (e.g. login pages) - set to your
> login page
>
> # - Burst Time Slice Interval: time interval window to monitor for bursts
>
> # - Request Threshold: request # threshold to trigger a burst
>
> # - Block Period: temporary block timeout
>
> #
>
> SecAction \
>
>   "id:'900014', \
>
>   phase:1, \
>
>   t:none, \
>
>   setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \
>
>   setvar:'tx.brute_force_burst_time_slice=60', \
>
>   setvar:'tx.brute_force_counter_threshold=10', \
>
>   setvar:'tx.brute_force_block_timeout=300', \
>
>   nolog, \
>
>   pass"
>
>
>
>
>
> [image: Otherdata_Logo_2011]
>
> *Wesley Render, IT Consultant, RHCSA*
>
> Phone: 1.403.228.1221 ext 201
>
> www.otherdata.com
>
>
>
> [image: findonfacebook] <http://www.facebook.com/otherdata>
>
>
>
>
>
> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:
> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] *On Behalf Of *Sabin
> Ranjit
> *Sent:* August-21-14 4:17 AM
> *To:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* [Owasp-modsecurity-core-rule-set] crs against brute force not
> working
>
>
>
> hi,
>
> im using latest modsecurity rule set and i tried out crs_11_bruteforce
> from experimental rule. But its not working for me. I created a shortlink
> of it in the activated rules directory, restarted the apache and when i
> brute force my web application login page the modsecurity audit log dont
> give me any brute force warnings. what could be the problem? Im using burp
> suite pro version's intruder for brute forcing.
>
> can anyone point to helpful resource that i can follow?
>
> thanks.
>
> regards
>
> sabin
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/a45e8e06/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/a45e8e06/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/a45e8e06/attachment-0003.jpg>

From wrender at otherdata.com  Thu Aug 21 17:58:28 2014
From: wrender at otherdata.com (Wesley Render)
Date: Thu, 21 Aug 2014 11:58:28 -0600
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
	working
In-Reply-To: <CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>	<002001cfbd57$d2082fb0$76188f10$@otherdata.com>
	<CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>
Message-ID: <assp.2310b538d6.005701cfbd69$83b3fb20$8b1bf160$@otherdata.com>

I believe you would just set yours like this  (Just include the URL after the domain name)?.

 

#

# -- [[ Brute Force Protection ]] ---------------------------------------------------------

#

# If you are using the Brute Force Protection rule set, then uncomment the following

# lines and set the following variables:

# - Protected URLs: resources to protect (e.g. login pages) - set to your login page

# - Burst Time Slice Interval: time interval window to monitor for bursts

# - Request Threshold: request # threshold to trigger a burst

# - Block Period: temporary block timeout

#

SecAction \

  "id:'900014', \

  phase:1, \

  t:none, \

  setvar:'tx.brute_force_protected_urls=#/user/user/login/#', \

  setvar:'tx.brute_force_burst_time_slice=60', \

  setvar:'tx.brute_force_counter_threshold=10', \

  setvar:'tx.brute_force_block_timeout=300', \

  nolog, \

  pass"

 

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201

 <http://www.otherdata.com/> www.otherdata.com

 

 <http://www.facebook.com/otherdata> 

 

From: Sabin Ranjit [mailto:think.sabin at gmail.com] 
Sent: August-21-14 10:39 AM
To: Wesley Render
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] crs against brute force not working

 

hi Wesley,

I'm not using wordpress, I'm try to protect my application made in Yii framework and its login url looks like this:
https://domainname.net/user/user/login/

how can I set brute_force_protected_urls value for this of url ? I tried few ways but it gave me syntax error.

thanks,

regards

 

On Thu, Aug 21, 2014 at 9:36 PM, Wesley Render <wrender at otherdata.com <mailto:wrender at otherdata.com> > wrote:

In your modsecurity_crs_10_setup.conf file you need to make sure to uncomment, and define the paths for your login page.  You will notice the first line of the rule is commented out with a regular pound symbol.  Then restart apache.  Here is how mine looks. I set it up for WordPress and Drupal.  It has been working well for WordPress brute force attempts:

 

#

# -- [[ Brute Force Protection ]] ---------------------------------------------------------

#

# If you are using the Brute Force Protection rule set, then uncomment the following

# lines and set the following variables:

# - Protected URLs: resources to protect (e.g. login pages) - set to your login page

# - Burst Time Slice Interval: time interval window to monitor for bursts

# - Request Threshold: request # threshold to trigger a burst

# - Block Period: temporary block timeout

#

SecAction \

  "id:'900014', \

  phase:1, \

  t:none, \

  setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \

  setvar:'tx.brute_force_burst_time_slice=60', \

  setvar:'tx.brute_force_counter_threshold=10', \

  setvar:'tx.brute_force_block_timeout=300', \

  nolog, \

  pass"

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201 <tel:1.403.228.1221%20ext%20201> 

 <http://www.otherdata.com/> www.otherdata.com

 

 <http://www.facebook.com/otherdata> 

 

 

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>  [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org> ] On Behalf Of Sabin Ranjit
Sent: August-21-14 4:17 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org <mailto:owasp-modsecurity-core-rule-set at lists.owasp.org> 
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not working

 

hi,

im using latest modsecurity rule set and i tried out crs_11_bruteforce from experimental rule. But its not working for me. I created a shortlink of it in the activated rules directory, restarted the apache and when i brute force my web application login page the modsecurity audit log dont give me any brute force warnings. what could be the problem? Im using burp suite pro version's intruder for brute forcing.

can anyone point to helpful resource that i can follow?

thanks.

regards

sabin

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/4c63f579/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/4c63f579/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140821/4c63f579/attachment-0003.jpg>

From think.sabin at gmail.com  Fri Aug 22 05:21:18 2014
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Fri, 22 Aug 2014 11:06:18 +0545
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
	working
In-Reply-To: <assp.2310b538d6.005701cfbd69$83b3fb20$8b1bf160$@otherdata.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>
	<002001cfbd57$d2082fb0$76188f10$@otherdata.com>
	<CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>
	<assp.2310b538d6.005701cfbd69$83b3fb20$8b1bf160$@otherdata.com>
Message-ID: <CAE9Kp-ZDn5=VUdsJ4=+0SNZ0YKX8cv6caVKnMH6XNnTKmsO5fw@mail.gmail.com>

naah!! I tried it, its not working for me. I used the value like that but
when i do brute force attempt in the web application with random username
and password it gives me nothing in the mod audit log. I'm using burp suit
pro intruder for testing.
Have you tried it besides wordpress? Wonder what I'm doing wrong.
thanks anyway.

cheers


On Thu, Aug 21, 2014 at 11:43 PM, Wesley Render <wrender at otherdata.com>
wrote:

> I believe you would just set yours like this  (Just include the URL after
> the domain name)?.
>
>
>
> #
>
> # -- [[ Brute Force Protection ]]
> ---------------------------------------------------------
>
> #
>
> # If you are using the Brute Force Protection rule set, then uncomment the
> following
>
> # lines and set the following variables:
>
> # - Protected URLs: resources to protect (e.g. login pages) - set to your
> login page
>
> # - Burst Time Slice Interval: time interval window to monitor for bursts
>
> # - Request Threshold: request # threshold to trigger a burst
>
> # - Block Period: temporary block timeout
>
> #
>
> SecAction \
>
>   "id:'900014', \
>
>   phase:1, \
>
>   t:none, \
>
>   setvar:'tx.brute_force_protected_urls=#/user/user/login/#', \
>
>   setvar:'tx.brute_force_burst_time_slice=60', \
>
>   setvar:'tx.brute_force_counter_threshold=10', \
>
>   setvar:'tx.brute_force_block_timeout=300', \
>
>   nolog, \
>
>   pass"
>
>
>
>
>
>
>
> [image: Otherdata_Logo_2011]
>
> *Wesley Render, IT Consultant, RHCSA*
>
> Phone: 1.403.228.1221 ext 201
>
> www.otherdata.com
>
>
>
> [image: findonfacebook] <http://www.facebook.com/otherdata>
>
>
>
> *From:* Sabin Ranjit [mailto:think.sabin at gmail.com]
> *Sent:* August-21-14 10:39 AM
> *To:* Wesley Render
> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* Re: [Owasp-modsecurity-core-rule-set] crs against brute force
> not working
>
>
>
> hi Wesley,
>
> I'm not using wordpress, I'm try to protect my application made in Yii
> framework and its login url looks like this:
> https://domainname.net/user/user/login/
>
> how can I set brute_force_protected_urls value for this of url ? I tried
> few ways but it gave me syntax error.
>
> thanks,
>
> regards
>
>
>
> On Thu, Aug 21, 2014 at 9:36 PM, Wesley Render <wrender at otherdata.com>
> wrote:
>
> In your modsecurity_crs_10_setup.conf file you need to make sure to
> uncomment, and define the paths for your login page.  You will notice the
> first line of the rule is commented out with a regular pound symbol.  Then
> restart apache.  Here is how mine looks. I set it up for WordPress and
> Drupal.  It has been working well for WordPress brute force attempts:
>
>
>
> #
>
> # -- [[ Brute Force Protection ]]
> ---------------------------------------------------------
>
> #
>
> # If you are using the Brute Force Protection rule set, then uncomment the
> following
>
> # lines and set the following variables:
>
> # - Protected URLs: resources to protect (e.g. login pages) - set to your
> login page
>
> # - Burst Time Slice Interval: time interval window to monitor for bursts
>
> # - Request Threshold: request # threshold to trigger a burst
>
> # - Block Period: temporary block timeout
>
> #
>
> SecAction \
>
>   "id:'900014', \
>
>   phase:1, \
>
>   t:none, \
>
>   setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \
>
>   setvar:'tx.brute_force_burst_time_slice=60', \
>
>   setvar:'tx.brute_force_counter_threshold=10', \
>
>   setvar:'tx.brute_force_block_timeout=300', \
>
>   nolog, \
>
>   pass"
>
>
>
>
>
> [image: Otherdata_Logo_2011]
>
> *Wesley Render, IT Consultant, RHCSA*
>
> Phone: 1.403.228.1221 ext 201
>
> www.otherdata.com
>
>
>
> [image: findonfacebook] <http://www.facebook.com/otherdata>
>
>
>
>
>
> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:
> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] *On Behalf Of *Sabin
> Ranjit
> *Sent:* August-21-14 4:17 AM
> *To:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* [Owasp-modsecurity-core-rule-set] crs against brute force not
> working
>
>
>
> hi,
>
> im using latest modsecurity rule set and i tried out crs_11_bruteforce
> from experimental rule. But its not working for me. I created a shortlink
> of it in the activated rules directory, restarted the apache and when i
> brute force my web application login page the modsecurity audit log dont
> give me any brute force warnings. what could be the problem? Im using burp
> suite pro version's intruder for brute forcing.
>
> can anyone point to helpful resource that i can follow?
>
> thanks.
>
> regards
>
> sabin
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140822/6b7b6c24/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140822/6b7b6c24/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140822/6b7b6c24/attachment-0003.jpg>

From corovin at starnet.md  Fri Aug 22 08:22:53 2014
From: corovin at starnet.md (Andrei)
Date: Fri, 22 Aug 2014 11:22:53 +0300
Subject: [Owasp-modsecurity-core-rule-set] How can I use directive
	SecRuleRemoveById on web.config
Message-ID: <681bea052dbd46c2f3ef73f6d50562e1@starnet.md>

Hello,

Could anyone tell me, how can I use directive SecRuleRemoveById on 
web.config?
P.S. I want to remove rule only for one web-site, not all.

From Ronald.Ploeger at bertelsmann.de  Fri Aug 22 08:57:57 2014
From: Ronald.Ploeger at bertelsmann.de (Ronald.Ploeger at bertelsmann.de)
Date: Fri, 22 Aug 2014 08:57:57 +0000
Subject: [Owasp-modsecurity-core-rule-set] How can I use
	directive	SecRuleRemoveById on web.config
In-Reply-To: <681bea052dbd46c2f3ef73f6d50562e1@starnet.md>
References: <681bea052dbd46c2f3ef73f6d50562e1@starnet.md>
Message-ID: <C2603171F3A6024299778D9A2D6BE3364C11E76A@GTLBMLXEN0007.bagmail.net>

Hi, 

I guess the documentation can tell you: https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRemoveById

If you only want to remove the rule for one site I suppose you will have to add "SecRuleRemoveById" inside your "VirtualHost" directive: http://httpd.apache.org/docs/current/mod/core.html#virtualhost

Best, 
Ronald


-----Urspr?ngliche Nachricht-----
Von: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] Im Auftrag von Andrei
Gesendet: Freitag, 22. August 2014 10:23
An: owasp-modsecurity-core-rule-set at lists.owasp.org
Betreff: [Owasp-modsecurity-core-rule-set] How can I use directive SecRuleRemoveById on web.config

Hello,

Could anyone tell me, how can I use directive SecRuleRemoveById on 
web.config?
P.S. I want to remove rule only for one web-site, not all.
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From corovin at starnet.md  Fri Aug 22 09:12:41 2014
From: corovin at starnet.md (Andrei)
Date: Fri, 22 Aug 2014 12:12:41 +0300
Subject: [Owasp-modsecurity-core-rule-set] How can I use directive
 SecRuleRemoveById on web.config
In-Reply-To: <C2603171F3A6024299778D9A2D6BE3364C11E76A@GTLBMLXEN0007.bagmail.net>
References: <681bea052dbd46c2f3ef73f6d50562e1@starnet.md>
	<C2603171F3A6024299778D9A2D6BE3364C11E76A@GTLBMLXEN0007.bagmail.net>
Message-ID: <79e62cc3c3bec4107cae6f113a518f78@starnet.md>

> I guess the documentation can tell you:
> 
> https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRemoveById
example for modsecurity configuration files, but I need for 
configuration file - web.config

> If you only want to remove the rule for one site I suppose you will
> have to add "SecRuleRemoveById" inside your "VirtualHost" directive:
> http://httpd.apache.org/docs/current/mod/core.html#virtualhost
But this article for apache, I need for Microsoft IIS web-server

On 2014-08-22 11:57, Ronald.Ploeger at bertelsmann.de wrote:
> Hi,
>
> I guess the documentation can tell you:
> 
> https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRemoveById
>
> If you only want to remove the rule for one site I suppose you will
> have to add "SecRuleRemoveById" inside your "VirtualHost" directive:
> http://httpd.apache.org/docs/current/mod/core.html#virtualhost
>
> Best,
> Ronald
>
>
> -----Urspr?ngliche Nachricht-----
> Von: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] Im
> Auftrag von Andrei
> Gesendet: Freitag, 22. August 2014 10:23
> An: owasp-modsecurity-core-rule-set at lists.owasp.org
> Betreff: [Owasp-modsecurity-core-rule-set] How can I use directive
> SecRuleRemoveById on web.config
>
> Hello,
>
> Could anyone tell me, how can I use directive SecRuleRemoveById on
> web.config?
> P.S. I want to remove rule only for one web-site, not all.
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> 
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From wrender at otherdata.com  Fri Aug 22 15:55:20 2014
From: wrender at otherdata.com (Wesley Render)
Date: Fri, 22 Aug 2014 09:55:20 -0600
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
	working
In-Reply-To: <CAE9Kp-ZDn5=VUdsJ4=+0SNZ0YKX8cv6caVKnMH6XNnTKmsO5fw@mail.gmail.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>	<002001cfbd57$d2082fb0$76188f10$@otherdata.com>	<CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>	<005701cfbd69$83b3fb20$8b1bf160$@otherdata.com>
	<CAE9Kp-ZDn5=VUdsJ4=+0SNZ0YKX8cv6caVKnMH6XNnTKmsO5fw@mail.gmail.com>
Message-ID: <assp.83112eee83.007201cfbe21$836bc4f0$8a434ed0$@otherdata.com>

No. I have not actually tested it with other web software.  Maybe try the following?

 

*         Make sure the modsecurity_crs_11_brute_force.conf is loading properly .  Maybe you have made a mistake with symbolic link or putting the file in wrong folder.

*         Make sure you have uncommented the brute force rule in modsecurity_crs_10_setup.conf (By default it is commented out)

*         Maybe try changing your URL to include your actual web login file?  I know they show it without pound symbols on each end.  Like this:  setvar:'tx.brute_force_protected_urls=/wp-login.php', \

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201

 <http://www.otherdata.com/> www.otherdata.com

 

 <http://www.facebook.com/otherdata> 

 

From: Sabin Ranjit [mailto:think.sabin at gmail.com] 
Sent: August-21-14 11:21 PM
To: Wesley Render
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] crs against brute force not working

 

naah!! I tried it, its not working for me. I used the value like that but when i do brute force attempt in the web application with random username and password it gives me nothing in the mod audit log. I'm using burp suit pro intruder for testing.

Have you tried it besides wordpress? Wonder what I'm doing wrong.

thanks anyway.

cheers

 

On Thu, Aug 21, 2014 at 11:43 PM, Wesley Render <wrender at otherdata.com <mailto:wrender at otherdata.com> > wrote:

I believe you would just set yours like this  (Just include the URL after the domain name)?.

 

#

# -- [[ Brute Force Protection ]] ---------------------------------------------------------

#

# If you are using the Brute Force Protection rule set, then uncomment the following

# lines and set the following variables:

# - Protected URLs: resources to protect (e.g. login pages) - set to your login page

# - Burst Time Slice Interval: time interval window to monitor for bursts

# - Request Threshold: request # threshold to trigger a burst

# - Block Period: temporary block timeout

#

SecAction \

  "id:'900014', \

  phase:1, \

  t:none, \

  setvar:'tx.brute_force_protected_urls=#/user/user/login/#', \

  setvar:'tx.brute_force_burst_time_slice=60', \

  setvar:'tx.brute_force_counter_threshold=10', \

  setvar:'tx.brute_force_block_timeout=300', \

  nolog, \

  pass"

 

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201 <tel:1.403.228.1221%20ext%20201> 

 <http://www.otherdata.com/> www.otherdata.com

 

 <http://www.facebook.com/otherdata> 

 

From: Sabin Ranjit [mailto:think.sabin at gmail.com <mailto:think.sabin at gmail.com> ] 
Sent: August-21-14 10:39 AM
To: Wesley Render
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org <mailto:owasp-modsecurity-core-rule-set at lists.owasp.org> 
Subject: Re: [Owasp-modsecurity-core-rule-set] crs against brute force not working

 

hi Wesley,

I'm not using wordpress, I'm try to protect my application made in Yii framework and its login url looks like this:
https://domainname.net/user/user/login/

how can I set brute_force_protected_urls value for this of url ? I tried few ways but it gave me syntax error.

thanks,

regards

 

On Thu, Aug 21, 2014 at 9:36 PM, Wesley Render <wrender at otherdata.com <mailto:wrender at otherdata.com> > wrote:

In your modsecurity_crs_10_setup.conf file you need to make sure to uncomment, and define the paths for your login page.  You will notice the first line of the rule is commented out with a regular pound symbol.  Then restart apache.  Here is how mine looks. I set it up for WordPress and Drupal.  It has been working well for WordPress brute force attempts:

 

#

# -- [[ Brute Force Protection ]] ---------------------------------------------------------

#

# If you are using the Brute Force Protection rule set, then uncomment the following

# lines and set the following variables:

# - Protected URLs: resources to protect (e.g. login pages) - set to your login page

# - Burst Time Slice Interval: time interval window to monitor for bursts

# - Request Threshold: request # threshold to trigger a burst

# - Block Period: temporary block timeout

#

SecAction \

  "id:'900014', \

  phase:1, \

  t:none, \

  setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \

  setvar:'tx.brute_force_burst_time_slice=60', \

  setvar:'tx.brute_force_counter_threshold=10', \

  setvar:'tx.brute_force_block_timeout=300', \

  nolog, \

  pass"

 

 



Wesley Render, IT Consultant, RHCSA

Phone: 1.403.228.1221 ext 201 <tel:1.403.228.1221%20ext%20201> 

 <http://www.otherdata.com/> www.otherdata.com

 

 <http://www.facebook.com/otherdata> 

 

 

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>  [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Sabin Ranjit
Sent: August-21-14 4:17 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org <mailto:owasp-modsecurity-core-rule-set at lists.owasp.org> 
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not working

 

hi,

im using latest modsecurity rule set and i tried out crs_11_bruteforce from experimental rule. But its not working for me. I created a shortlink of it in the activated rules directory, restarted the apache and when i brute force my web application login page the modsecurity audit log dont give me any brute force warnings. what could be the problem? Im using burp suite pro version's intruder for brute forcing.

can anyone point to helpful resource that i can follow?

thanks.

regards

sabin

 

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140822/f97b3c3b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140822/f97b3c3b/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140822/f97b3c3b/attachment-0003.jpg>

From FCosta at trustwave.com  Mon Aug 25 17:37:30 2014
From: FCosta at trustwave.com (Felipe Costa)
Date: Mon, 25 Aug 2014 17:37:30 +0000
Subject: [Owasp-modsecurity-core-rule-set] How can I use directive
 SecRuleRemoveById on web.config
In-Reply-To: <79e62cc3c3bec4107cae6f113a518f78@starnet.md>
Message-ID: <D020FA82.43EA%fcosta@trustwave.com>

Hi Andrei,

The directive pointed by Ronald, SecRuleRemoveById should work on IIS the
same way it does on Apache.

Check in your ModSecurity installation directory, there is this
"modsecurity_iis.conf". The "modsecurity_iis.conf" includes others
configurations files, including "modsecurity.conf" and
"modsecurity_crs_10_setup.conf".

The directive can be placed in any of those files. Make sure that the rule
is loaded before you add the SecRuleRemoveById, otherwise it won't work.

Br.,
Felipe "Zimmerle" Costa
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com <http://www.trustwave.com/>




On 8/22/14 6:12 AM, "Andrei" <corovin at starnet.md> wrote:

>> I guess the documentation can tell you:
>>
>>
>>https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRe
>>moveById
>example for modsecurity configuration files, but I need for
>configuration file - web.config
>
>> If you only want to remove the rule for one site I suppose you will
>> have to add "SecRuleRemoveById" inside your "VirtualHost" directive:
>> http://httpd.apache.org/docs/current/mod/core.html#virtualhost
>But this article for apache, I need for Microsoft IIS web-server
>
>On 2014-08-22 11:57, Ronald.Ploeger at bertelsmann.de wrote:
>> Hi,
>>
>> I guess the documentation can tell you:
>>
>>
>>https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRe
>>moveById
>>
>> If you only want to remove the rule for one site I suppose you will
>> have to add "SecRuleRemoveById" inside your "VirtualHost" directive:
>> http://httpd.apache.org/docs/current/mod/core.html#virtualhost
>>
>> Best,
>> Ronald
>>
>>
>> -----Urspr?ngliche Nachricht-----
>> Von: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] Im
>> Auftrag von Andrei
>> Gesendet: Freitag, 22. August 2014 10:23
>> An: owasp-modsecurity-core-rule-set at lists.owasp.org
>> Betreff: [Owasp-modsecurity-core-rule-set] How can I use directive
>> SecRuleRemoveById on web.config
>>
>> Hello,
>>
>> Could anyone tell me, how can I use directive SecRuleRemoveById on
>> web.config?
>> P.S. I want to remove rule only for one web-site, not all.
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From wrender at otherdata.com  Mon Aug 25 22:20:04 2014
From: wrender at otherdata.com (Wesley Render)
Date: Mon, 25 Aug 2014 16:20:04 -0600
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level
	-	Only send critical events
In-Reply-To: <008001cfbc9c$5d126380$17372a80$@otherdata.com>
References: <006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>	<CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>	<alpine.LRH.2.11.1408200951060.12374@ash.usask.ca>
	<008001cfbc9c$5d126380$17372a80$@otherdata.com>
Message-ID: <assp.1314ae7b79.012801cfc0b2$b8cc6b70$2a654250$@otherdata.com>

I was just wanting to follow up.  Is anyone able to confirm the proper
logging settings when using ModSecurity, and sending the logs out via mlogc
to AuditConsole?  Should we have our modsecurity_crs_10_setup.conf
SecDefaultAction lines set to the following?

SecDefaultAction "phase:1,pass,nolog"
SecDefaultAction "phase:2,pass,nolog"

Thanks!


Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201
www.otherdata.com


-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
Of Wesley Render
Sent: August-20-14 11:30 AM
To: 'OWASP Mod Security'
Subject: Re: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
Only send critical events

When I set it to the following, I get a lot less logs coming in.  I am
confused on how it should be set as well when sending logs to AuditConsole
using mlogc.  Here is a summary of relevant settings I have right now
(below).   I guess it seems as though the logging settings are not able to
combine one correlated event into the audit log.  They can only combine one
correlated event into the apache error_log?


############  modsecurity_crs_10_setup.conf  Settings
##########################

# Collaborative Detection Mode
SecDefaultAction "phase:1,pass,nolog"
SecDefaultAction "phase:2,pass,nolog"


# Collaborative Detection Blocking #
SecAction \
  "id:'900004', \
  phase:1, \
  t:none, \
  setvar:tx.anomaly_score_blocking=on, \
  nolog, \
  pass"


############ modsec2.user.conf  Settings
######################################
SecDataDir /usr/local/apache/conf/sec-data
SecTmpDir /usr/local/apache/conf/sec-tmp

SecRuleEngine On
SecPcreMatchLimit 50000
SecPcreMatchLimitRecursion 50000

# With SecRequestBodyAccess turned on care needs to be taken with false
positives
SecRequestBodyAccess On
SecRequestBodyLimit 134217728
SecRequestBodyLimitAction ProcessPartial
SecRequestBodyNoFilesLimit 131072
SecRequestBodyInMemoryLimit 131072

SecResponseBodyAccess On
SecResponseBodyMimeType (null) text/html text/plain text/xml
SecResponseBodyLimit 524228
SecResponseBodyLimitAction ProcessPartial
SecServerSignature Apache
SecCookieFormat 0

# Additional ModSecurity Logging Options for mlogc
# Use ReleventOnly auditing
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"

# Must use concurrent logging
SecAuditLogType Concurrent

# Send all audit log parts
SecAuditLogParts ABDEFHIJKZ

# Use the same /CollectorRoot/LogStorageDir as in mlogc.conf
SecAuditLogStorageDir /var/log/mlogc/data

# Pipe audit log to mlogc with your configuration
SecAuditLog "|/usr/local/modsecurity/bin/mlogc /etc/mlogc.conf"

# OWASP Rules
Include conf/owasp-modsecurity-crs/modsecurity_crs_10_setup.conf
Include conf/owasp-modsecurity-crs/activated_rules/*.conf

# Trustwave Commercial Rules
Include conf/slr_vuln_rules/owasp_crs_integration/attack_type/*.conf


Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201
www.otherdata.com


-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
Of Earl Fogel
Sent: August-20-14 9:59 AM
To: OWASP Mod Security
Subject: Re: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
Only send critical events

I have this problem as well.  I also have:

SecDefaultAction "phase:1,pass,nolog,auditlog"
SecDefaultAction "phase:2,pass,nolog,auditlog"
SecAuditEngine RelevantOnly
SecAuditLogRelevantStatus "^(?:5|4(?!04))"

Could that be relevent?  How should these be set in collaborative detection
mode?

Earl
-


On Wed, 20 Aug 2014, Josh Amishav-Zlatin <jamuse at owasp.org> wrote:

>On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render <wrender at otherdata.com>
wrote:
>
>      Would anyone know if it would be possible to adjust the core rule set
>      configuration file so that only events that have a total inbound
score of
>      5 or higher are sent to the audit log.? (Running in Collaborative
>      Detection and Anomaly Scoring & Blocking)? Version:
SecComponentSignature
>      "OWASP_CRS/2.2.9"
>
>
>Hi Wesley,
>
>When the CRS is used in anomaly mode it should not create audit logs 
>unless the event passes the threshold set in the 10 file. Can you send 
>me privately an event from AuditConsole that does not have an anomaly 
>score level above 5? I'm specifically interested in sections H and K.
>
>- Josh
>
>


_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From think.sabin at gmail.com  Tue Aug 26 06:00:57 2014
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Tue, 26 Aug 2014 11:45:57 +0545
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
	working
In-Reply-To: <assp.83112eee83.007201cfbe21$836bc4f0$8a434ed0$@otherdata.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>
	<002001cfbd57$d2082fb0$76188f10$@otherdata.com>
	<CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>
	<005701cfbd69$83b3fb20$8b1bf160$@otherdata.com>
	<CAE9Kp-ZDn5=VUdsJ4=+0SNZ0YKX8cv6caVKnMH6XNnTKmsO5fw@mail.gmail.com>
	<assp.83112eee83.007201cfbe21$836bc4f0$8a434ed0$@otherdata.com>
Message-ID: <CAE9Kp-YHjZEDtso9ZoXVSGWsqG5nM35s4v1m_YAn4prAQJSh1w@mail.gmail.com>

sorry, I checked out everything you have mentioned, it didnt work out for
me. :(

thanks for your replies,

regards,


On Fri, Aug 22, 2014 at 9:40 PM, Wesley Render <wrender at otherdata.com>
wrote:

> No. I have not actually tested it with other web software.  Maybe try the
> following?
>
>
>
> ?         Make sure the modsecurity_crs_11_brute_force.conf is loading
> properly .  Maybe you have made a mistake with symbolic link or putting the
> file in wrong folder.
>
> ?         Make sure you have uncommented the brute force rule in
> modsecurity_crs_10_setup.conf (By default it is commented out)
>
> ?         Maybe try changing your URL to include your actual web login
> file?  I know they show it without pound symbols on each end.  Like this:
> setvar:'tx.brute_force_protected_urls=/wp-login.php', \
>
>
>
>
>
> [image: Otherdata_Logo_2011]
>
> *Wesley Render, IT Consultant, RHCSA*
>
> Phone: 1.403.228.1221 ext 201
>
> www.otherdata.com
>
>
>
> [image: findonfacebook] <http://www.facebook.com/otherdata>
>
>
>
> *From:* Sabin Ranjit [mailto:think.sabin at gmail.com]
> *Sent:* August-21-14 11:21 PM
>
> *To:* Wesley Render
> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* Re: [Owasp-modsecurity-core-rule-set] crs against brute force
> not working
>
>
>
> naah!! I tried it, its not working for me. I used the value like that but
> when i do brute force attempt in the web application with random username
> and password it gives me nothing in the mod audit log. I'm using burp suit
> pro intruder for testing.
>
> Have you tried it besides wordpress? Wonder what I'm doing wrong.
>
> thanks anyway.
>
> cheers
>
>
>
> On Thu, Aug 21, 2014 at 11:43 PM, Wesley Render <wrender at otherdata.com>
> wrote:
>
> I believe you would just set yours like this  (Just include the URL after
> the domain name)?.
>
>
>
> #
>
> # -- [[ Brute Force Protection ]]
> ---------------------------------------------------------
>
> #
>
> # If you are using the Brute Force Protection rule set, then uncomment the
> following
>
> # lines and set the following variables:
>
> # - Protected URLs: resources to protect (e.g. login pages) - set to your
> login page
>
> # - Burst Time Slice Interval: time interval window to monitor for bursts
>
> # - Request Threshold: request # threshold to trigger a burst
>
> # - Block Period: temporary block timeout
>
> #
>
> SecAction \
>
>   "id:'900014', \
>
>   phase:1, \
>
>   t:none, \
>
>   setvar:'tx.brute_force_protected_urls=#/user/user/login/#', \
>
>   setvar:'tx.brute_force_burst_time_slice=60', \
>
>   setvar:'tx.brute_force_counter_threshold=10', \
>
>   setvar:'tx.brute_force_block_timeout=300', \
>
>   nolog, \
>
>   pass"
>
>
>
>
>
>
>
> [image: Otherdata_Logo_2011]
>
> *Wesley Render, IT Consultant, RHCSA*
>
> Phone: 1.403.228.1221 ext 201
>
> www.otherdata.com
>
>
>
> [image: findonfacebook] <http://www.facebook.com/otherdata>
>
>
>
> *From:* Sabin Ranjit [mailto:think.sabin at gmail.com]
> *Sent:* August-21-14 10:39 AM
> *To:* Wesley Render
> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* Re: [Owasp-modsecurity-core-rule-set] crs against brute force
> not working
>
>
>
> hi Wesley,
>
> I'm not using wordpress, I'm try to protect my application made in Yii
> framework and its login url looks like this:
> https://domainname.net/user/user/login/
>
> how can I set brute_force_protected_urls value for this of url ? I tried
> few ways but it gave me syntax error.
>
> thanks,
>
> regards
>
>
>
> On Thu, Aug 21, 2014 at 9:36 PM, Wesley Render <wrender at otherdata.com>
> wrote:
>
> In your modsecurity_crs_10_setup.conf file you need to make sure to
> uncomment, and define the paths for your login page.  You will notice the
> first line of the rule is commented out with a regular pound symbol.  Then
> restart apache.  Here is how mine looks. I set it up for WordPress and
> Drupal.  It has been working well for WordPress brute force attempts:
>
>
>
> #
>
> # -- [[ Brute Force Protection ]]
> ---------------------------------------------------------
>
> #
>
> # If you are using the Brute Force Protection rule set, then uncomment the
> following
>
> # lines and set the following variables:
>
> # - Protected URLs: resources to protect (e.g. login pages) - set to your
> login page
>
> # - Burst Time Slice Interval: time interval window to monitor for bursts
>
> # - Request Threshold: request # threshold to trigger a burst
>
> # - Block Period: temporary block timeout
>
> #
>
> SecAction \
>
>   "id:'900014', \
>
>   phase:1, \
>
>   t:none, \
>
>   setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \
>
>   setvar:'tx.brute_force_burst_time_slice=60', \
>
>   setvar:'tx.brute_force_counter_threshold=10', \
>
>   setvar:'tx.brute_force_block_timeout=300', \
>
>   nolog, \
>
>   pass"
>
>
>
>
>
> [image: Otherdata_Logo_2011]
>
> *Wesley Render, IT Consultant, RHCSA*
>
> Phone: 1.403.228.1221 ext 201
>
> www.otherdata.com
>
>
>
> [image: findonfacebook] <http://www.facebook.com/otherdata>
>
>
>
>
>
> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:
> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] *On Behalf Of *Sabin
> Ranjit
> *Sent:* August-21-14 4:17 AM
> *To:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* [Owasp-modsecurity-core-rule-set] crs against brute force not
> working
>
>
>
> hi,
>
> im using latest modsecurity rule set and i tried out crs_11_bruteforce
> from experimental rule. But its not working for me. I created a shortlink
> of it in the activated rules directory, restarted the apache and when i
> brute force my web application login page the modsecurity audit log dont
> give me any brute force warnings. what could be the problem? Im using burp
> suite pro version's intruder for brute forcing.
>
> can anyone point to helpful resource that i can follow?
>
> thanks.
>
> regards
>
> sabin
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140826/722fe897/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140826/722fe897/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140826/722fe897/attachment-0003.jpg>

From RBarnett at trustwave.com  Wed Aug 27 19:53:09 2014
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 27 Aug 2014 19:53:09 +0000
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not
 working
In-Reply-To: <CAE9Kp-YHjZEDtso9ZoXVSGWsqG5nM35s4v1m_YAn4prAQJSh1w@mail.gmail.com>
References: <CAE9Kp-Z96vYDVKwJsSCGHyeU29c-Tq-ZsOJva5PBKgqkrvmzrw@mail.gmail.com>
	<002001cfbd57$d2082fb0$76188f10$@otherdata.com>
	<CAE9Kp-YO1EbKYLbgresVkP7FfhMYEMoMR5+OLfo8vM0O7Ld7sw@mail.gmail.com>
	<005701cfbd69$83b3fb20$8b1bf160$@otherdata.com>
	<CAE9Kp-ZDn5=VUdsJ4=+0SNZ0YKX8cv6caVKnMH6XNnTKmsO5fw@mail.gmail.com>
	<assp.83112eee83.007201cfbe21$836bc4f0$8a434ed0$@otherdata.com>
	<CAE9Kp-YHjZEDtso9ZoXVSGWsqG5nM35s4v1m_YAn4prAQJSh1w@mail.gmail.com>
Message-ID: <D023AF4C.10F692%rbarnett@trustwave.com>

Have you enabled the debug log for your test connections and reviewed the logs?

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

From: Sabin Ranjit <think.sabin at gmail.com<mailto:think.sabin at gmail.com>>
Date: Tuesday, August 26, 2014 2:00 AM
To: Wesley Render <wrender at otherdata.com<mailto:wrender at otherdata.com>>
Cc: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] crs against brute force not working

sorry, I checked out everything you have mentioned, it didnt work out for me. :(

thanks for your replies,

regards,


On Fri, Aug 22, 2014 at 9:40 PM, Wesley Render <wrender at otherdata.com<mailto:wrender at otherdata.com>> wrote:
No. I have not actually tested it with other web software.  Maybe try the following?


?         Make sure the modsecurity_crs_11_brute_force.conf is loading properly .  Maybe you have made a mistake with symbolic link or putting the file in wrong folder.

?         Make sure you have uncommented the brute force rule in modsecurity_crs_10_setup.conf (By default it is commented out)

?         Maybe try changing your URL to include your actual web login file?  I know they show it without pound symbols on each end.  Like this:  setvar:'tx.brute_force_protected_urls=/wp-login.php', \


[Otherdata_Logo_2011]
Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201<tel:1.403.228.1221%20ext%20201>
www.otherdata.com<http://www.otherdata.com/>

[findonfacebook]<http://www.facebook.com/otherdata>

From: Sabin Ranjit [mailto:think.sabin at gmail.com<mailto:think.sabin at gmail.com>]
Sent: August-21-14 11:21 PM

To: Wesley Render
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] crs against brute force not working

naah!! I tried it, its not working for me. I used the value like that but when i do brute force attempt in the web application with random username and password it gives me nothing in the mod audit log. I'm using burp suit pro intruder for testing.
Have you tried it besides wordpress? Wonder what I'm doing wrong.
thanks anyway.

cheers

On Thu, Aug 21, 2014 at 11:43 PM, Wesley Render <wrender at otherdata.com<mailto:wrender at otherdata.com>> wrote:
I believe you would just set yours like this  (Just include the URL after the domain name)?.

#
# -- [[ Brute Force Protection ]] ---------------------------------------------------------
#
# If you are using the Brute Force Protection rule set, then uncomment the following
# lines and set the following variables:
# - Protected URLs: resources to protect (e.g. login pages) - set to your login page
# - Burst Time Slice Interval: time interval window to monitor for bursts
# - Request Threshold: request # threshold to trigger a burst
# - Block Period: temporary block timeout
#
SecAction \
  "id:'900014', \
  phase:1, \
  t:none, \
  setvar:'tx.brute_force_protected_urls=#/user/user/login/#', \
  setvar:'tx.brute_force_burst_time_slice=60', \
  setvar:'tx.brute_force_counter_threshold=10', \
  setvar:'tx.brute_force_block_timeout=300', \
  nolog, \
  pass"



[Otherdata_Logo_2011]
Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201<tel:1.403.228.1221%20ext%20201>
www.otherdata.com<http://www.otherdata.com/>

[findonfacebook]<http://www.facebook.com/otherdata>

From: Sabin Ranjit [mailto:think.sabin at gmail.com<mailto:think.sabin at gmail.com>]
Sent: August-21-14 10:39 AM
To: Wesley Render
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] crs against brute force not working

hi Wesley,
I'm not using wordpress, I'm try to protect my application made in Yii framework and its login url looks like this:
https://domainname.net/user/user/login/
how can I set brute_force_protected_urls value for thisof url ?I tried few ways but it gave me syntax error.
thanks,
regards

On Thu, Aug 21, 2014 at 9:36 PM, Wesley Render <wrender at otherdata.com<mailto:wrender at otherdata.com>> wrote:
In your modsecurity_crs_10_setup.conf file you need to make sure to uncomment, and define the paths for your login page.  You will notice the first line of the rule is commented out with a regular pound symbol.  Then restart apache.  Here is how mine looks. I set it up for WordPress and Drupal.  It has been working well for WordPress brute force attempts:

#
# -- [[ Brute Force Protection ]] ---------------------------------------------------------
#
# If you are using the Brute Force Protection rule set, then uncomment the following
# lines and set the following variables:
# - Protected URLs: resources to protect (e.g. login pages) - set to your login page
# - Burst Time Slice Interval: time interval window to monitor for bursts
# - Request Threshold: request # threshold to trigger a burst
# - Block Period: temporary block timeout
#
SecAction \
  "id:'900014', \
  phase:1, \
  t:none, \
  setvar:'tx.brute_force_protected_urls=#/wp-login.php# #/user#', \
  setvar:'tx.brute_force_burst_time_slice=60', \
  setvar:'tx.brute_force_counter_threshold=10', \
  setvar:'tx.brute_force_block_timeout=300', \
  nolog, \
  pass"


[Otherdata_Logo_2011]
Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201<tel:1.403.228.1221%20ext%20201>
www.otherdata.com<http://www.otherdata.com/>

[findonfacebook]<http://www.facebook.com/otherdata>


From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>] On Behalf Of Sabin Ranjit
Sent: August-21-14 4:17 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: [Owasp-modsecurity-core-rule-set] crs against brute force not working

hi,
im using latest modsecurity rule set and i tried out crs_11_bruteforce from experimental rule. But its not working for me. I created a shortlink of it in the activated rules directory, restarted the apache and when i brute force my web application login page the modsecurity audit log dont give me any brute force warnings. what could be the problem? Im using burp suite pro version's intruder for brute forcing.
can anyone point to helpful resource that i can follow?
thanks.

regards
sabin




________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140827/b630e3ec/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.jpg
Type: image/jpeg
Size: 1769 bytes
Desc: image002.jpg
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140827/b630e3ec/attachment-0002.jpg>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 4437 bytes
Desc: image001.jpg
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140827/b630e3ec/attachment-0003.jpg>

From RBarnett at trustwave.com  Wed Aug 27 19:54:35 2014
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 27 Aug 2014 19:54:35 +0000
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
 Only send critical events
In-Reply-To: <assp.1314ae7b79.012801cfc0b2$b8cc6b70$2a654250$@otherdata.com>
References: <006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>
	<CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>
	<alpine.LRH.2.11.1408200951060.12374@ash.usask.ca>
	<008001cfbc9c$5d126380$17372a80$@otherdata.com>
	<assp.1314ae7b79.012801cfc0b2$b8cc6b70$2a654250$@otherdata.com>
Message-ID: <D023AFA8.10F698%rbarnett@trustwave.com>

Wesley,
What exactly are you trying to achieve here?

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com <http://www.trustwave.com/>




On 8/25/14 6:20 PM, "Wesley Render" <wrender at otherdata.com> wrote:

>I was just wanting to follow up.  Is anyone able to confirm the proper
>logging settings when using ModSecurity, and sending the logs out via
>mlogc
>to AuditConsole?  Should we have our modsecurity_crs_10_setup.conf
>SecDefaultAction lines set to the following?
>
>SecDefaultAction "phase:1,pass,nolog"
>SecDefaultAction "phase:2,pass,nolog"
>
>Thanks!
>
>
>Wesley Render, IT Consultant, RHCSA
>Phone: 1.403.228.1221 ext 201
>www.otherdata.com
>
>
>-----Original Message-----
>From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
>Of Wesley Render
>Sent: August-20-14 11:30 AM
>To: 'OWASP Mod Security'
>Subject: Re: [Owasp-modsecurity-core-rule-set]
>inbound_anomaly_score_level -
>Only send critical events
>
>When I set it to the following, I get a lot less logs coming in.  I am
>confused on how it should be set as well when sending logs to AuditConsole
>using mlogc.  Here is a summary of relevant settings I have right now
>(below).   I guess it seems as though the logging settings are not able to
>combine one correlated event into the audit log.  They can only combine
>one
>correlated event into the apache error_log?
>
>
>############  modsecurity_crs_10_setup.conf  Settings
>##########################
>
># Collaborative Detection Mode
>SecDefaultAction "phase:1,pass,nolog"
>SecDefaultAction "phase:2,pass,nolog"
>
>
># Collaborative Detection Blocking #
>SecAction \
>  "id:'900004', \
>  phase:1, \
>  t:none, \
>  setvar:tx.anomaly_score_blocking=on, \
>  nolog, \
>  pass"
>
>
>############ modsec2.user.conf  Settings
>######################################
>SecDataDir /usr/local/apache/conf/sec-data
>SecTmpDir /usr/local/apache/conf/sec-tmp
>
>SecRuleEngine On
>SecPcreMatchLimit 50000
>SecPcreMatchLimitRecursion 50000
>
># With SecRequestBodyAccess turned on care needs to be taken with false
>positives
>SecRequestBodyAccess On
>SecRequestBodyLimit 134217728
>SecRequestBodyLimitAction ProcessPartial
>SecRequestBodyNoFilesLimit 131072
>SecRequestBodyInMemoryLimit 131072
>
>SecResponseBodyAccess On
>SecResponseBodyMimeType (null) text/html text/plain text/xml
>SecResponseBodyLimit 524228
>SecResponseBodyLimitAction ProcessPartial
>SecServerSignature Apache
>SecCookieFormat 0
>
># Additional ModSecurity Logging Options for mlogc
># Use ReleventOnly auditing
>SecAuditEngine RelevantOnly
>SecAuditLogRelevantStatus "^(?:5|4(?!04))"
>
># Must use concurrent logging
>SecAuditLogType Concurrent
>
># Send all audit log parts
>SecAuditLogParts ABDEFHIJKZ
>
># Use the same /CollectorRoot/LogStorageDir as in mlogc.conf
>SecAuditLogStorageDir /var/log/mlogc/data
>
># Pipe audit log to mlogc with your configuration
>SecAuditLog "|/usr/local/modsecurity/bin/mlogc /etc/mlogc.conf"
>
># OWASP Rules
>Include conf/owasp-modsecurity-crs/modsecurity_crs_10_setup.conf
>Include conf/owasp-modsecurity-crs/activated_rules/*.conf
>
># Trustwave Commercial Rules
>Include conf/slr_vuln_rules/owasp_crs_integration/attack_type/*.conf
>
>
>Wesley Render, IT Consultant, RHCSA
>Phone: 1.403.228.1221 ext 201
>www.otherdata.com
>
>
>-----Original Message-----
>From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
>Of Earl Fogel
>Sent: August-20-14 9:59 AM
>To: OWASP Mod Security
>Subject: Re: [Owasp-modsecurity-core-rule-set]
>inbound_anomaly_score_level -
>Only send critical events
>
>I have this problem as well.  I also have:
>
>SecDefaultAction "phase:1,pass,nolog,auditlog"
>SecDefaultAction "phase:2,pass,nolog,auditlog"
>SecAuditEngine RelevantOnly
>SecAuditLogRelevantStatus "^(?:5|4(?!04))"
>
>Could that be relevent?  How should these be set in collaborative
>detection
>mode?
>
>Earl
>-
>
>
>On Wed, 20 Aug 2014, Josh Amishav-Zlatin <jamuse at owasp.org> wrote:
>
>>On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render <wrender at otherdata.com>
>wrote:
>>
>>      Would anyone know if it would be possible to adjust the core rule
>>set
>>      configuration file so that only events that have a total inbound
>score of
>>      5 or higher are sent to the audit log.  (Running in Collaborative
>>      Detection and Anomaly Scoring & Blocking)  Version:
>SecComponentSignature
>>      "OWASP_CRS/2.2.9"
>>
>>
>>Hi Wesley,
>>
>>When the CRS is used in anomaly mode it should not create audit logs
>>unless the event passes the threshold set in the 10 file. Can you send
>>me privately an event from AuditConsole that does not have an anomaly
>>score level above 5? I'm specifically interested in sections H and K.
>>
>>- Josh
>>
>>
>
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From wrender at otherdata.com  Wed Aug 27 21:04:27 2014
From: wrender at otherdata.com (Wesley Render)
Date: Wed, 27 Aug 2014 15:04:27 -0600
Subject: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
	Only send critical events
In-Reply-To: <D023AFA8.10F698%rbarnett@trustwave.com>
References: <006c01cfbc2a$bdfd5be0$39f813a0$@otherdata.com>
	<CAC+O4mF_suEXVQeU=5iZ+tgQzLvik+eEDb648zN-2OBnb7EE5w@mail.gmail.com>
	<alpine.LRH.2.11.1408200951060.12374@ash.usask.ca>
	<008001cfbc9c$5d126380$17372a80$@otherdata.com>
	<012801cfc0b2$b8cc6b70$2a654250$@otherdata.com>
	<D023AFA8.10F698%rbarnett@trustwave.com>
Message-ID: <assp.5316029bf4.009d01cfc23a$8209dd50$861d97f0$@otherdata.com>

I am trying to send only correlated events that are Total Inbound 5+ to
mlogc.  When I set the SecDefaultAction for phase1 and phase2 to "pass,log"
or to "nolog,auditlog" it seems to send all events, even ones that are under
TX  5 to the mlogc.

When I set it to "pass,nolog" it seems to only send events that are Total
Inbound 5+ to the mlogc.  This is what I want, but "pass,nolog" is not one
of the options listed in the section "Alert Logging Control" so I am just
not sure if having it set to nolog is the correct method when sending
correlated/anomaly events to mlogc.

Regards,

Wesley Render, IT Consultant, RHCSA
Phone: 1.403.228.1221 ext 201
www.otherdata.com


-----Original Message-----
From: Ryan Barnett [mailto:RBarnett at trustwave.com] 
Sent: August-27-14 1:55 PM
To: Wesley Render; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -
Only send critical events

Wesley,
What exactly are you trying to achieve here?

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com <http://www.trustwave.com/>




On 8/25/14 6:20 PM, "Wesley Render" <wrender at otherdata.com> wrote:

>I was just wanting to follow up.  Is anyone able to confirm the proper 
>logging settings when using ModSecurity, and sending the logs out via 
>mlogc to AuditConsole?  Should we have our 
>modsecurity_crs_10_setup.conf SecDefaultAction lines set to the 
>following?
>
>SecDefaultAction "phase:1,pass,nolog"
>SecDefaultAction "phase:2,pass,nolog"
>
>Thanks!
>
>
>Wesley Render, IT Consultant, RHCSA
>Phone: 1.403.228.1221 ext 201
>www.otherdata.com
>
>
>-----Original Message-----
>From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
>Behalf Of Wesley Render
>Sent: August-20-14 11:30 AM
>To: 'OWASP Mod Security'
>Subject: Re: [Owasp-modsecurity-core-rule-set] 
>inbound_anomaly_score_level - Only send critical events
>
>When I set it to the following, I get a lot less logs coming in.  I am 
>confused on how it should be set as well when sending logs to 
>AuditConsole using mlogc.  Here is a summary of relevant settings I have
right now
>(below).   I guess it seems as though the logging settings are not able to
>combine one correlated event into the audit log.  They can only combine 
>one correlated event into the apache error_log?
>
>
>############  modsecurity_crs_10_setup.conf  Settings 
>##########################
>
># Collaborative Detection Mode
>SecDefaultAction "phase:1,pass,nolog"
>SecDefaultAction "phase:2,pass,nolog"
>
>
># Collaborative Detection Blocking #
>SecAction \
>  "id:'900004', \
>  phase:1, \
>  t:none, \
>  setvar:tx.anomaly_score_blocking=on, \
>  nolog, \
>  pass"
>
>
>############ modsec2.user.conf  Settings 
>######################################
>SecDataDir /usr/local/apache/conf/sec-data SecTmpDir 
>/usr/local/apache/conf/sec-tmp
>
>SecRuleEngine On
>SecPcreMatchLimit 50000
>SecPcreMatchLimitRecursion 50000
>
># With SecRequestBodyAccess turned on care needs to be taken with false 
>positives SecRequestBodyAccess On SecRequestBodyLimit 134217728 
>SecRequestBodyLimitAction ProcessPartial SecRequestBodyNoFilesLimit 
>131072 SecRequestBodyInMemoryLimit 131072
>
>SecResponseBodyAccess On
>SecResponseBodyMimeType (null) text/html text/plain text/xml 
>SecResponseBodyLimit 524228 SecResponseBodyLimitAction ProcessPartial 
>SecServerSignature Apache SecCookieFormat 0
>
># Additional ModSecurity Logging Options for mlogc # Use ReleventOnly 
>auditing SecAuditEngine RelevantOnly SecAuditLogRelevantStatus 
>"^(?:5|4(?!04))"
>
># Must use concurrent logging
>SecAuditLogType Concurrent
>
># Send all audit log parts
>SecAuditLogParts ABDEFHIJKZ
>
># Use the same /CollectorRoot/LogStorageDir as in mlogc.conf 
>SecAuditLogStorageDir /var/log/mlogc/data
>
># Pipe audit log to mlogc with your configuration SecAuditLog 
>"|/usr/local/modsecurity/bin/mlogc /etc/mlogc.conf"
>
># OWASP Rules
>Include conf/owasp-modsecurity-crs/modsecurity_crs_10_setup.conf
>Include conf/owasp-modsecurity-crs/activated_rules/*.conf
>
># Trustwave Commercial Rules
>Include conf/slr_vuln_rules/owasp_crs_integration/attack_type/*.conf
>
>
>Wesley Render, IT Consultant, RHCSA
>Phone: 1.403.228.1221 ext 201
>www.otherdata.com
>
>
>-----Original Message-----
>From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
>Behalf Of Earl Fogel
>Sent: August-20-14 9:59 AM
>To: OWASP Mod Security
>Subject: Re: [Owasp-modsecurity-core-rule-set] 
>inbound_anomaly_score_level - Only send critical events
>
>I have this problem as well.  I also have:
>
>SecDefaultAction "phase:1,pass,nolog,auditlog"
>SecDefaultAction "phase:2,pass,nolog,auditlog"
>SecAuditEngine RelevantOnly
>SecAuditLogRelevantStatus "^(?:5|4(?!04))"
>
>Could that be relevent?  How should these be set in collaborative 
>detection mode?
>
>Earl
>-
>
>
>On Wed, 20 Aug 2014, Josh Amishav-Zlatin <jamuse at owasp.org> wrote:
>
>>On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render <wrender at otherdata.com>
>wrote:
>>
>>      Would anyone know if it would be possible to adjust the core 
>>rule set
>>      configuration file so that only events that have a total inbound
>score of
>>      5 or higher are sent to the audit log.  (Running in Collaborative
>>      Detection and Anomaly Scoring & Blocking)  Version:
>SecComponentSignature
>>      "OWASP_CRS/2.2.9"
>>
>>
>>Hi Wesley,
>>
>>When the CRS is used in anomaly mode it should not create audit logs 
>>unless the event passes the threshold set in the 10 file. Can you send 
>>me privately an event from AuditConsole that does not have an anomaly 
>>score level above 5? I'm specifically interested in sections H and K.
>>
>>- Josh
>>
>>
>
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list 
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-se
>t
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list 
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-se
>t


________________________________

This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is strictly prohibited. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.


