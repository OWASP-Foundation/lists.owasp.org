<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set properly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20SQL%20Rules%20-%20SQLi%20Score%20isn%27t%0A%20set%20properly&In-Reply-To=6EC0E8A7FE27A34689D6CC3B5C421CC3D22F093A59%40BXOFFICE.batix.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000533.html">
   <LINK REL="Next"  HREF="000535.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set properly</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20SQL%20Rules%20-%20SQLi%20Score%20isn%27t%0A%20set%20properly&In-Reply-To=6EC0E8A7FE27A34689D6CC3B5C421CC3D22F093A59%40BXOFFICE.batix.local"
       TITLE="[Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set properly">RBarnett at trustwave.com
       </A><BR>
    <I>Mon Nov  1 13:21:27 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000533.html">[Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set	properly
</A></li>
        <LI>Next message: <A HREF="000535.html">[Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#534">[ date ]</a>
              <a href="thread.html#534">[ thread ]</a>
              <a href="subject.html#534">[ subject ]</a>
              <a href="author.html#534">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11/1/10 1:09 PM, &quot;Paul Rosenbusch&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">pr at batix.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> when I simulate SQL-Injection Attacks while using the
</I>&gt;<i> owasp-modsecurity-core-rule-set, the SQLi Score shows up empty in my audit
</I>&gt;<i> logfile. The inbound anomaly score is exceeded and the attack is classified as
</I>&gt;<i> &quot;SQL Injection Attack&quot;, but there seems to be a bug with the SQLi Score.
</I>&gt;<i> 
</I>&gt;<i> I use modsecurity-crs_2.0.8 and checked the
</I>&gt;<i> modsecurity_crs_41_sql_injection_attacks.conf -
</I>&gt;<i> setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score} seems to be called
</I>&gt;<i> properly on every entry.
</I>&gt;<i> 
</I>&gt;<i> Does anybody have a clue why this happens?
</I>&gt;<i> 
</I>&gt;<i> Thanks for your Help
</I>&gt;<i> 
</I>
Hey Paul.  I am assuming that you are referring to the TX SQLI macro
expansions in the modsecurity_crs_49_inbound_blocking.conf file (
SQLi=%{TX.SQLI_SCORE})?  If so, then yes, I see the problem.  The rules were
actually updated to use this TX collection name instead -
setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score}.

So, you can update the TX data in the 49 file to properly reference it -

# Alert and Block based on Anomaly Scores
#
SecRule TX:ANOMALY_SCORE &quot;@gt 0&quot; \
    &quot;chain,phase:2,t:none,nolog,auditlog,block,msg:'Inbound Anomaly Score
Exceeded (Total Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQL_INJECTION_SCORE},
XSS=%{TX.XSS_SCORE}):
%{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbound_anomaly_scor
e=%{tx.anomaly_score}&quot;
        SecRule TX:ANOMALY_SCORE &quot;@ge %{tx.inbound_anomaly_score_level}&quot;


# Alert and Block on a specific attack category such as SQL Injection
#
#SecRule TX:SQL_INJECTION_SCORE &quot;@gt 0&quot; \
#    &quot;phase:2,t:none,log,block,msg:'SQL Injection Detected (score
%{TX.SQL_INJECTION_SCORE}): %{tx.msg}'&quot;



I will update the CRS as well and it will be fixed in V2.0.9

-Ryan



&gt;<i> PR
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i> 
</I>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000533.html">[Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set	properly
</A></li>
	<LI>Next message: <A HREF="000535.html">[Owasp-modsecurity-core-rule-set] SQL Rules - SQLi Score isn't set properly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#534">[ date ]</a>
              <a href="thread.html#534">[ thread ]</a>
              <a href="subject.html#534">[ subject ]</a>
              <a href="author.html#534">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
