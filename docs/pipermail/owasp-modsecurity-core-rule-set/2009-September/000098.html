<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Question About Rule	Configuration!
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Question%20About%20Rule%0A%09Configuration%21&In-Reply-To=869a38360909141243r21260764o986dd5d1cd75ebb9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000097.html">
   <LINK REL="Next"  HREF="000099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Question About Rule	Configuration!</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Question%20About%20Rule%0A%09Configuration%21&In-Reply-To=869a38360909141243r21260764o986dd5d1cd75ebb9%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Question About Rule	Configuration!">rcbarnett at gmail.com
       </A><BR>
    <I>Mon Sep 14 15:58:32 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000097.html">[Owasp-modsecurity-core-rule-set] Question About Rule	Configuration!
</A></li>
        <LI>Next message: <A HREF="000099.html">[Owasp-modsecurity-core-rule-set] How does mod_security defend on	buffer overflows?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98">[ date ]</a>
              <a href="thread.html#98">[ thread ]</a>
              <a href="subject.html#98">[ subject ]</a>
              <a href="author.html#98">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Sep 14, 2009 at 3:43 PM, OSSEC junkie &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ossec.junkie at gmail.com</A>&gt;wrote:

&gt;<i> Okay I figured out what the deal was.  My account was not authorized
</I>&gt;<i> to make changes to mod_security.conf per our FIM application.
</I>&gt;<i> Everytime I made the changes to load the /base_rules folder and
</I>&gt;<i> restarted Apache, the FIM reverted my mod_security.conf to it's
</I>&gt;<i> original state.  Sorry for the confusion, didn't know my account
</I>&gt;<i> wasn't authorized to make the changes.
</I>&gt;<i>
</I>&gt;<i> I get the detection now with the anomaly scoring, see below:
</I>&gt;<i> ModSecurity: Warning. Operator GE matched 5 at TX:anomaly_score. [file
</I>&gt;<i>
</I>&gt;<i> &quot;/webtier/apache/conf.d/modsecurity/base_rules/modsecurity_crs_60_correlation.conf&quot;]
</I>&gt;<i> [line &quot;41&quot;] [msg &quot;Transactional Anomaly Score (score 101): XSS Attack
</I>&gt;<i> Detected&quot;] [hostname &quot;server21.inside.mycompany.com&quot;] [uri
</I>&gt;<i> &quot;/buy/PizzaPurchase&quot;] [unique_id &quot;Sq6bnwoBBGsAADafGX0AAAAH&quot;]
</I>&gt;<i>
</I>&gt;<i> Any advice on the proper setting for me to start dropping people who
</I>&gt;<i> send a single XSS attack, or any attack in that matter?
</I>&gt;<i>
</I>
Check out the examples in the modsecurity_crs_49_enforcement.conf file :)
You can do one of two things -

1)  For XSS attacks, our new rules are including the category tag data in
the TX name, so you can uncomment the following rule which will deny/log if
the XSS score is more than 0 -

# Alert on XSS anomalies
#
#SecRule TX:XSS_SCORE &quot;!@eq 0&quot; \
#    &quot;phase:2,t:none,log,deny,msg:'XSS Detected (score %{TX.XSS_SCORE}):
%{tx.msg}'&quot;

2) If you want to block when *any* major attack is detected then set the
following -

# Alert and Deny on High Anomaly Scores
#
SecRule TX:ANOMALY_SCORE &quot;@ge 20&quot; \
    &quot;phase:2,t:none,nolog,auditlog,deny,msg:'Anomaly Score Exceeded (score
%{TX.ANOMALY_SCORE}): %{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg}&quot;

This works since all of the XSS, SQL Injection, Remote File Inclusion (RFI)
attacks, etc.... are set at Severity 2 and are given an anomaly score of
20.  So, this rule doesn't care what the category if the issue is, but only
that the score is 20 or more points.  This effectively will deny if either 1
Severity 2 rule matches or if there are multiple lower severity issues.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
<A HREF="http://tacticalwebappsec.blogspot.com/">http://tacticalwebappsec.blogspot.com/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090914/96d8ae3a/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090914/96d8ae3a/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000097.html">[Owasp-modsecurity-core-rule-set] Question About Rule	Configuration!
</A></li>
	<LI>Next message: <A HREF="000099.html">[Owasp-modsecurity-core-rule-set] How does mod_security defend on	buffer overflows?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#98">[ date ]</a>
              <a href="thread.html#98">[ thread ]</a>
              <a href="subject.html#98">[ subject ]</a>
              <a href="author.html#98">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
