From sneh_misra at yahoo.com  Wed Jul  1 11:17:32 2015
From: sneh_misra at yahoo.com (bhusan sneh)
Date: Wed, 1 Jul 2015 11:17:32 +0000 (UTC)
Subject: [Owasp-modsecurity-core-rule-set] ISSUE with IIS8 in adding
	SecRuleRemoveById
Message-ID: <812595312.326123.1435749452030.JavaMail.yahoo@mail.yahoo.com>

HI,

I have intstalled mod_sec v2.9.2 on IIS8 on win2012 . And all RULES are running smooth for every domain/websites running on IIS.?

My query is how to disable a particular Rule for a particluar website on IIS. i.e Where should I add (which file ) "SecRuleRemoveById" .?

Can you please help me.?

regards,?
Snehanshu
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150701/842c01e7/attachment.html>

From kazik at agape.org.pl  Fri Jul  3 08:25:01 2015
From: kazik at agape.org.pl (kazik)
Date: Fri, 3 Jul 2015 10:25:01 +0200
Subject: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with
	SecRequestBodyAccess
Message-ID: <748258FC-1966-4CB9-AFB3-181AADC72A29@agape.org.pl>

helo,

Server - Ubuntu 14 LTS | Apache/2.4.7 | modsecurity 2.7.7-2

I was enabled modsecurity in DetectionPnly mode - default configuration from Ubuntu.

On our server we have a few site, CMS (Joomla, wordpress) and own CMS.
All of them work with WYSWIG editors.

When I set SecRequestBodyAccess On and try update or create article,
there is a lot of errors, especially SQL-injecttion and XSS.

But I only update article, its no a crime :)

Look like modsecurity treats all html tags like SQL or XSS attack,
is there any special module for that or parser?

HELP ME, PLEASE :)

tom kazm

example of logs from apache2 errors



[Fri Jul 03 10:14:05.628018 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\(.*?\\\\))" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "506"] [id "973335"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0) found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz si\\xc4\\x99 za granic\\xc4\\x99?..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname ?XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.628575 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'].*?\\\\)[ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\()" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "508"] [id "973334"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb( found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigr..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.628689 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Rule 7f036a3bc248 [id "973334"][file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"][line "508"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "milujciesie.org.pl"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.629212 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span st..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.629414 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)" at ARGS:art_text. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_text: <p><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><img align=\\x22left\\x22 alt=\\x22\\x22 src=\\x22https://milujciesie.org.pl/upload/articles/r_u_c_k_i/PL/logo_IDE.png\\x22 /></a>Na stronie <a href=\\x22http://www.emigracja.chrystusowcy.pl/\\x22 target=\\x22_blank\\x22>Instytutu Duszpasterstwa Emig..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.631654 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[ /+\\\\t\\"\\\\'`]style[ /+\\\\t]*?=.*([:=]|(&#x?0*((58)|(3A)|(61)|(3D));?)).*?([(\\\\\\\\]|(&#x?0*((40)|(28)|(92)|(5C));?)))" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "520"] [id "973316"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data:  style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz si\\xc4\\x99 za granic\\xc4\\x99?</span></a></span><br /> <a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22>Szukasz Mszy \\xc5\\x9awi\\xc4\\x99tej w j\\xc4\\x99zyku polskim? <span style=\\x22color: rgb( found..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150703/84d3caf8/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150703/84d3caf8/attachment.pgp>

From adrianbn at gmail.com  Fri Jul  3 09:06:09 2015
From: adrianbn at gmail.com (=?UTF-8?Q?Adri=C3=A1n?=)
Date: Fri, 03 Jul 2015 09:06:09 +0000
Subject: [Owasp-modsecurity-core-rule-set] Update Rule Action List to make
	it 'chained'
Message-ID: <CAFDTedogjLxcNiQ9djrdkh7h3SC1U47gEEbLAx09QbbWm_rM+A@mail.gmail.com>

Hi all,

I have been trying to update a CRS rule's action using
SecRuleUpdateActionById with the intention of adding "chain" to the action
list in an attempt to make the rule a chained one and append rules to that
chain. This seems to me like a neat way of appending behaviours to a given
rule in order to refine what it does with AND clauses. However, I am
guessing this is not supported at all. Am I wrong? Can this be done and if
so, how?

Thank you!
Adrian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150703/e898c848/attachment.html>

From adrianbn at gmail.com  Fri Jul  3 09:12:09 2015
From: adrianbn at gmail.com (=?UTF-8?Q?Adri=C3=A1n?=)
Date: Fri, 03 Jul 2015 09:12:09 +0000
Subject: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with
	SecRequestBodyAccess
In-Reply-To: <748258FC-1966-4CB9-AFB3-181AADC72A29@agape.org.pl>
References: <748258FC-1966-4CB9-AFB3-181AADC72A29@agape.org.pl>
Message-ID: <CAFDTedrz_o4dq6+8de_dY-+RRdewBsQ3_733hM=0ZeL41zFAcA@mail.gmail.com>

Hi Tom,

it seems to me that ModSecurity is 'rightly' detecting XSS attempts due to
the HTML tags that you submit when creating blog posts. As far as I know,
what you would need to do is create exceptions for the URLs and parameters
you know contain HTML tags, and if possible make them specific to the tags
that your site allows. This is a tedious (for a lack of a better word) work
that comes with the installation of ModSecurity in front of a new
application. Think that the default CRS is generic and doesn't understand
the idiosyncrasy of your application, so the rules need adjusting.

Good luck!
Adrian

El vie., 3 jul. 2015 a las 9:35, kazik (<kazik at agape.org.pl>) escribi?:

> helo,
>
> Server - *Ubuntu 14 LTS* | *Apache/2.4.7* | modsecurity *2.7.7-2*
>
> I was enabled modsecurity in DetectionPnly mode - default configuration
> from Ubuntu.
>
> On our server we have a few site, CMS (Joomla, wordpress) and own CMS.
> All of them work with WYSWIG editors.
>
> When I set *SecRequestBodyAccess On* and try update or create article,
> there is a lot of errors, especially SQL-injecttion and XSS.
>
> But I only update article, its no a crime :)
>
> Look like modsecurity treats all html tags like SQL or XSS attack,
> is there any special module for that or parser?
>
> HELP ME, PLEASE :)
>
> tom kazm
>
> example of logs from apache2 errors
>
>
>
> [Fri Jul 03 10:14:05.628018 2015] [:error] [pid 28133:tid 139652430276352]
> [client 192.168.20.129] ModSecurity: Warning. Pattern match
> "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\(.*?\\\\))" at
> ARGS:art_lid. [file
> "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "506"] [id "973335"] [rev "2"] [msg "IE XSS Filters - Attack
> Detected."] [data "Matched Data: \\x22> <tbody> <tr> <td
> valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span
> style=\\x22color: rgb(128,0,0) found within ARGS:art_lid: <p> </p> <table
> class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5
> style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)
> \\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22
> target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz
> si\\xc4\\x99 za granic\\xc4\\x99?..."] [ver "OWASP_CRS/2.2.9"] [maturity
> "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"]
> [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"]
> [tag "PCI/6.5.1"] [hostname ?XXXXXXXXXXXXX"] [uri "/admin/index.php"]
> [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.628575 2015] [:error] [pid 28133:tid 139652430276352]
> [client 192.168.20.129] ModSecurity: Warning. Pattern match
> "(?i:[\\"\\\\'].*?\\\\)[ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\()" at
> ARGS:art_lid. [file
> "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "508"] [id "973334"] [rev "2"] [msg "IE XSS Filters - Attack
> Detected."] [data "Matched Data: \\x22contentpaneopen\\x22> <tbody> <tr>
> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span
> style=\\x22color: rgb(128,0,0)\\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22
> target=\\x22_blank\\x22><span style=\\x22color: rgb( found within
> ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr>
> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span
> style=\\x22color: rgb(128,0,0)\\x22><a href=\\x22http://www.emigr..."]
> [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag
> "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"]
> [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"]
> [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id
> "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.628689 2015] [:error] [pid 28133:tid 139652430276352]
> [client 192.168.20.129] ModSecurity: Rule 7f036a3bc248 [id "973334"][file
> "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"][line
> "508"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "
> milujciesie.org.pl"] [uri "/admin/index.php"] [unique_id
> "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.629212 2015] [:error] [pid 28133:tid 139652430276352]
> [client 192.168.20.129] ModSecurity: Warning. Pattern match
> "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)" at ARGS:art_lid.
> [file
> "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack
> Detected."] [data "Matched Data: \\x22> <tbody> <tr> <td
> valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span
> style=\\x22color: rgb(128,0,0)\\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within
> ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr>
> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span
> style=\\x22color: rgb(128,0,0)\\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22
> target=\\x22_blank\\x22><span st..."] [ver "OWASP_CRS/2.2.9"] [maturity
> "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"]
> [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"]
> [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"]
> [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.629414 2015] [:error] [pid 28133:tid 139652430276352]
> [client 192.168.20.129] ModSecurity: Warning. Pattern match
> "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)" at
> ARGS:art_text. [file
> "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack
> Detected."] [data "Matched Data: \\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within
> ARGS:art_text: <p><span style=\\x22color: rgb(128,0,0)\\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22
> target=\\x22_blank\\x22><img align=\\x22left\\x22 alt=\\x22\\x22 src=\\
> x22https://milujciesie.org.pl/upload/articles/r_u_c_k_i/PL/logo_IDE.png\\x22
> /></a>Na stronie <a href=\\x22http://www.emigracja.chrystusowcy.pl/\\x22
> target=\\x22_blank\\x22>Instytutu Duszpasterstwa Emig..."] [ver
> "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag
> "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"]
> [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"]
> [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id
> "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.631654 2015] [:error] [pid 28133:tid 139652430276352]
> [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[
> /+\\\\t\\"\\\\'`]style[
> /+\\\\t]*?=.*([:=]|(&#x?0*((58)|(3A)|(61)|(3D));?)).*?([(\\\\\\\\]|(&#x?0*((40)|(28)|(92)|(5C));?)))"
> at ARGS:art_lid. [file
> "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "520"] [id "973316"] [rev "2"] [msg "IE XSS Filters - Attack
> Detected."] [data "Matched Data:  style=\\x22text-align: center\\x22><span
> style=\\x22color: rgb(128,0,0)\\x22><a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22
> target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz
> si\\xc4\\x99 za granic\\xc4\\x99?</span></a></span><br /> <a href=\\
> x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22
> target=\\x22_blank\\x22>Szukasz Mszy \\xc5\\x9awi\\xc4\\x99tej w
> j\\xc4\\x99zyku polskim? <span style=\\x22color: rgb( found..."] [ver
> "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag
> "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"]
> [tag "OWASP_TOP_10/A2"] [tag [hostname "XXXXXXXXXXXXX"] [uri
> "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150703/8efbc1d5/attachment-0001.html>

From CSanders at trustwave.com  Sat Jul  4 15:37:26 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Sat, 4 Jul 2015 15:37:26 +0000
Subject: [Owasp-modsecurity-core-rule-set] modsecurity - trouble
	with	SecRequestBodyAccess
In-Reply-To: <CAFDTedrz_o4dq6+8de_dY-+RRdewBsQ3_733hM=0ZeL41zFAcA@mail.gmail.com>
References: <748258FC-1966-4CB9-AFB3-181AADC72A29@agape.org.pl>
	<CAFDTedrz_o4dq6+8de_dY-+RRdewBsQ3_733hM=0ZeL41zFAcA@mail.gmail.com>
Message-ID: <BY1PR0701MB11126EFFAE0EA74CD8165879DB950@BY1PR0701MB1112.namprd07.prod.outlook.com>

ModSecurity will indeed will block HTML tags because they are exactly how HTML injection/XSS is introduced. Sending HTML is often indicative of these vulnerabilities being exploited, in general it is considered poor form/dev to send such content across the wire. However, you can always, easily create exceptions for rules in particular places. Just look at the particular rule that is triggering and the particular parameter that is triggering them and you can add an exception by doing something similar to the following ?SecRuleUpdateTargetById 950907 !ARGS:test?. For more information see https://www.trustwave.com/Resources/SpiderLabs-Blog/ModSecurity-Advanced-Topic-of-the-Week--(Updated)-Exception-Handling/. In addition, if you are using CRS 3.0 this feature is already built in see your config file: https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0.0-dev/modsecurity_crs_10_setup.conf.example#L420.

For more detail see the issue that someone opened yesterday about this and my reply, I think it goes into a tad more detail. https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/235

Chaim Sanders
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Adri?n
Sent: Friday, July 3, 2015 5:12 AM
To: kazik; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with SecRequestBodyAccess

Hi Tom,
it seems to me that ModSecurity is 'rightly' detecting XSS attempts due to the HTML tags that you submit when creating blog posts. As far as I know, what you would need to do is create exceptions for the URLs and parameters you know contain HTML tags, and if possible make them specific to the tags that your site allows. This is a tedious (for a lack of a better word) work that comes with the installation of ModSecurity in front of a new application. Think that the default CRS is generic and doesn't understand the idiosyncrasy of your application, so the rules need adjusting.
Good luck!
Adrian

El vie., 3 jul. 2015 a las 9:35, kazik (<kazik at agape.org.pl<mailto:kazik at agape.org.pl>>) escribi?:
helo,

Server - Ubuntu 14 LTS | Apache/2.4.7 | modsecurity 2.7.7-2

I was enabled modsecurity in DetectionPnly mode - default configuration from Ubuntu.

On our server we have a few site, CMS (Joomla, wordpress) and own CMS.
All of them work with WYSWIG editors.

When I set SecRequestBodyAccess On and try update or create article,
there is a lot of errors, especially SQL-injecttion and XSS.

But I only update article, its no a crime :)

Look like modsecurity treats all html tags like SQL or XSS attack,
is there any special module for that or parser?

HELP ME, PLEASE :)

tom kazm

example of logs from apache2 errors



[Fri Jul 03 10:14:05.628018 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\(.*?\\\\))<file:///\\\'][%20]*(([%5ea-z0-9~_:\'%20%5d)|(in)).+%3f\(.*%3f\))>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "506"] [id "973335"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22<file:///\\x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0) found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz<file:///\\x22%3eWybierasz> si\\xc4\\x99 za granic\\xc4\\x99?..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname ?XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.628575 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'].*?\\\\)[ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\()<file:///\\\'].*%3f\)%5b%20%5d*((%5b%5ea-z0-9~_:\'%20%5d)|(in)).+%3f\()>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "508"] [id "973334"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22contentpaneopen\\x22<file:///\\x22contentpaneopen\x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb( found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigr..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.628689 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Rule 7f036a3bc248 [id "973334"][file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"][line "508"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "milujciesie.org.pl<http://scanmail.trustwave.com/?c=4062&d=ttiW1fhCz_rKo3NNzBoPQNtxYhh3oIniz93CCaGRUg&s=5&u=http%3a%2f%2fmilujciesie%2eorg%2epl>"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.629212 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)<file:///\\\'][%20]*(([%5ea-z0-9~_:\'%20%5d)|(in)).+%3f%5b.%5d.+%3f=)>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22<file:///\\x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span st..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.629414 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)<file:///\\\'][%20]*(([%5ea-z0-9~_:\'%20%5d)|(in)).+%3f%5b.%5d.+%3f=)>" at ARGS:art_text. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_text: <p><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><img align=\\x22left\\x22 alt=\\x22\\x22 src=\\x22https://milujciesie.org.pl/upload/articles/r_u_c_k_i/PL/logo_IDE.png\\x22 /></a>Na stronie <a href=\\x22http://www.emigracja.chrystusowcy.pl/\\x22 target=\\x22_blank\\x22>Instytutu Duszpasterstwa Emig..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.631654 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[ /+\\\\t\\"\\\\'`]style[ /+\\\\t]*?=.*([:=]|(&#x?0*((58)|(3A)|(61)|(3D));?)).*?([(\\\\\\\\]|(&#x?0*((40)|(28)|(92)|(5C));?)))<file:///\\\'%60]style[%20\+\t%5d*%3f=.*(%5b:=%5d|(&%23x%3f0*((58)|(3A)|(61)|(3D));%3f)).*%3f(%5b(\%5d|(&%23x%3f0*((40)|(28)|(92)|(5C));%3f)))>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "520"] [id "973316"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data:  style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file:///\\x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz<file:///\\x22%3eWybierasz> si\\xc4\\x99 za granic\\xc4\\x99?</span></a></span><br /> <a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22>Szukasz Mszy \\xc5\\x9awi\\xc4\\x99tej<file:///\\xc5\x9awi\xc4\x99tej> w j\\xc4\\x99zyku polskim? <span style=\\x22color: rgb( found..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<http://scanmail.trustwave.com/?c=4062&d=ttiW1fhCz_rKo3NNzBoPQNtxYhh3oIniz9rFVqXGWg&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150704/072b3aca/attachment-0001.html>

From LJ0064176 at techmahindra.com  Tue Jul  7 07:21:25 2015
From: LJ0064176 at techmahindra.com (Lokesh Jadwani)
Date: Tue, 7 Jul 2015 07:21:25 +0000
Subject: [Owasp-modsecurity-core-rule-set] Good Tutorial with examples
In-Reply-To: <ac3de966711449b89d7b036c39cefa58@NODEXCHMBX001.TechMahindra.com>
References: <ac3de966711449b89d7b036c39cefa58@NODEXCHMBX001.TechMahindra.com>
Message-ID: <f5214613f2bf4c769fd949aa28fe7a82@NODEXCHMBX003.TechMahindra.com>

Hi Team,

I am a ModSecurity newbie. It?s very interesting Firewall. It?s like Maldives ocean for me. The more I am digging it, I am getting new world of opportunities and features and control over my application traffic. Simply I am in love with ModSecurity.
I am using it with RHEL 6.5. I have gone through with https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual . It has given me the basic concepts. But it has very high level details. Is there any tutorial available online which have some good examples.

At present I am desperately looking for some help about the External Entity. I have multiple modules in my application which have difference URI and each resource could have its own XSDs to control payloads. Is there any way from which I can control my all modules from ModeSucrity @ValidateSchema not to allow external entities?

Looking forward for help ?

Thanks,
Lokesh



============================================================================================================================
Disclaimer:  This message and the information contained herein is proprietary and confidential and subject to the Tech Mahindra policy statement, you may review the policy at http://www.techmahindra.com/Disclaimer.html externally http://tim.techmahindra.com/tim/disclaimer.html internally within TechMahindra.
============================================================================================================================

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150707/d9fd475b/attachment.html>

From kazik at agape.org.pl  Tue Jul  7 08:05:56 2015
From: kazik at agape.org.pl (kazik)
Date: Tue, 7 Jul 2015 10:05:56 +0200
Subject: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with
	SecRequestBodyAccess
In-Reply-To: <BY1PR0701MB11126EFFAE0EA74CD8165879DB950@BY1PR0701MB1112.namprd07.prod.outlook.com>
References: <748258FC-1966-4CB9-AFB3-181AADC72A29@agape.org.pl>
	<CAFDTedrz_o4dq6+8de_dY-+RRdewBsQ3_733hM=0ZeL41zFAcA@mail.gmail.com>
	<BY1PR0701MB11126EFFAE0EA74CD8165879DB950@BY1PR0701MB1112.namprd07.prod.outlook.com>
Message-ID: <531D6007-6702-4478-81F1-84E15C45C34E@agape.org.pl>

Hello,

Thanks Chaim - your right, modsecurity works ok - I do not?

In your example I can update the rule, but where shoud I place this update,
in apache container (example <Directory>) or add local.conf file to activated_rules?

CRS v3 looks interesting (even beta) - maybe stupid question, but how to update CRS rules to v 3?
(now: modsecurity 2.7.7-2, crs 2.9)

Giga thanks, again ;)

Tom Kazm


> Wiadomo?? napisana przez Chaim Sanders <CSanders at trustwave.com> w dniu 4 lip 2015, o godz. 17:37:
> 
> ModSecurity will indeed will block HTML tags because they are exactly how HTML injection/XSS is introduced. Sending HTML is often indicative of these vulnerabilities being exploited, in general it is considered poor form/dev to send such content across the wire. However, you can always, easily create exceptions for rules in particular places. Just look at the particular rule that is triggering and the particular parameter that is triggering them and you can add an exception by doing something similar to the following ?SecRuleUpdateTargetById 950907 !ARGS:test?. For more information see https://www.trustwave.com/Resources/SpiderLabs-Blog/ModSecurity-Advanced-Topic-of-the-Week--(Updated)-Exception-Handling/ <https://www.trustwave.com/Resources/SpiderLabs-Blog/ModSecurity-Advanced-Topic-of-the-Week--(Updated)-Exception-Handling/>. In addition, if you are using CRS 3.0 this feature is already built in see your config file: https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0.0-dev/modsecurity_crs_10_setup.conf.example#L420 <https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0.0-dev/modsecurity_crs_10_setup.conf.example#L420>.
> 
> For more detail see the issue that someone opened yesterday about this and my reply, I think it goes into a tad more detail.https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/235 <https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/235>
> 
> Chaim Sanders
> Security Researcher, SpiderLabs
> 
> Trustwave | SMART SECURITY ON DEMAND
> www.trustwave.com <http://www.trustwave.com/>
> 
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Adri?n
> Sent: Friday, July 3, 2015 5:12 AM
> To: kazik; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with SecRequestBodyAccess
> 
> Hi Tom,
> 
> it seems to me that ModSecurity is 'rightly' detecting XSS attempts due to the HTML tags that you submit when creating blog posts. As far as I know, what you would need to do is create exceptions for the URLs and parameters you know contain HTML tags, and if possible make them specific to the tags that your site allows. This is a tedious (for a lack of a better word) work that comes with the installation of ModSecurity in front of a new application. Think that the default CRS is generic and doesn't understand the idiosyncrasy of your application, so the rules need adjusting.
> 
> Good luck!
> Adrian
> 
> El vie., 3 jul. 2015 a las 9:35, kazik (<kazik at agape.org.pl <mailto:kazik at agape.org.pl>>) escribi?:
> helo,
> 
> Server - Ubuntu 14 LTS | Apache/2.4.7 | modsecurity 2.7.7-2
> 
> I was enabled modsecurity in DetectionPnly mode - default configuration from Ubuntu.
> 
> On our server we have a few site, CMS (Joomla, wordpress) and own CMS.
> All of them work with WYSWIG editors.
> 
> When I set SecRequestBodyAccess On and try update or create article,
> there is a lot of errors, especially SQL-injecttion and XSS.
> 
> But I only update article, its no a crime :)
> 
> Look like modsecurity treats all html tags like SQL or XSS attack,
> is there any special module for that or parser?
> 
> HELP ME, PLEASE :)
> 
> tom kazm
> 
> example of logs from apache2 errors
> 
> 
> 
> [Fri Jul 03 10:14:05.628018 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\(.*?\\\\)) <file://////'][%20]*(([%5ea-z0-9~_:/'%20%5d)|(in)).+%3f/(.*%3f/))>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "506"] [id "973335"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22 <file://///x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0) found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca>href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz <file://///x22%3eWybierasz> si\\xc4\\x99 za granic\\xc4\\x99?..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname ?XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.628575 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'].*?\\\\)[ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\() <file://////'].*%3f/)%5b%20%5d*((%5b%5ea-z0-9~_:/'%20%5d)|(in)).+%3f/()>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "508"] [id "973334"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22contentpaneopen\\x22 <file://///x22contentpaneopen/x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb( found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigr..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.628689 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Rule 7f036a3bc248 [id "973334"][file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"][line "508"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "milujciesie.org.pl <http://scanmail.trustwave.com/?c=4062&d=ttiW1fhCz_rKo3NNzBoPQNtxYhh3oIniz93CCaGRUg&s=5&u=http%3a%2f%2fmilujciesie%2eorg%2epl>"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.629212 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=) <file://////'][%20]*(([%5ea-z0-9~_:/'%20%5d)|(in)).+%3f%5b.%5d.+%3f=)>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22 <file://///x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span st..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.629414 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=) <file://////'][%20]*(([%5ea-z0-9~_:/'%20%5d)|(in)).+%3f%5b.%5d.+%3f=)>" at ARGS:art_text. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_text: <p><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><img align=\\x22left\\x22 alt=\\x22\\x22 src=\\x22https://milujciesie.org.pl/upload/articles/r_u_c_k_i/PL/logo_IDE.png\\x22 /></a>Na stronie <a href=\\x22http://www.emigracja.chrystusowcy.pl/\\x22 target=\\x22_blank\\x22>Instytutu Duszpasterstwa Emig..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> [Fri Jul 03 10:14:05.631654 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[ /+\\\\t\\"\\\\'`]style[ /+\\\\t]*?=.*([:=]|(&#x?0*((58)|(3A)|(61)|(3D));?)).*?([(\\\\\\\\]|(&#x?0*((40)|(28)|(92)|(5C));?))) <file://////'%60]style[%20/+/t%5d*%3f=.*(%5b:=%5d|(&%23x%3f0*((58)|(3A)|(61)|(3D));%3f)).*%3f(%5b(/%5d|(&%23x%3f0*((40)|(28)|(92)|(5C));%3f)))>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "520"] [id "973316"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data:  style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a <file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz <file://///x22%3eWybierasz> si\\xc4\\x99 za granic\\xc4\\x99?</span></a></span><br /> <a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22>Szukasz Mszy \\xc5\\x9awi\\xc4\\x99tej <file://///xc5/x9awi/xc4/x99tej> w j\\xc4\\x99zyku polskim? <span style=\\x22color: rgb( found..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org <mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set <http://scanmail.trustwave.com/?c=4062&d=ttiW1fhCz_rKo3NNzBoPQNtxYhh3oIniz9rFVqXGWg&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set>
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150707/99715ebe/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 495 bytes
Desc: Message signed with OpenPGP using GPGMail
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150707/99715ebe/attachment-0001.pgp>

From jroback at gmail.com  Tue Jul  7 14:13:09 2015
From: jroback at gmail.com (Joshua Roback)
Date: Tue, 07 Jul 2015 14:13:09 +0000
Subject: [Owasp-modsecurity-core-rule-set] Update Rule Action List to
 make it 'chained'
In-Reply-To: <CAFDTedogjLxcNiQ9djrdkh7h3SC1U47gEEbLAx09QbbWm_rM+A@mail.gmail.com>
References: <CAFDTedogjLxcNiQ9djrdkh7h3SC1U47gEEbLAx09QbbWm_rM+A@mail.gmail.com>
Message-ID: <CAExQ=_feujC=DNNxbG1KBeQZdzzk3648t3_JGbf9duZe8RkyGw@mail.gmail.com>

This is a great question and I'm awaiting an answer as well.

On Fri, Jul 3, 2015 at 5:14 AM Adri?n <adrianbn at gmail.com> wrote:

> Hi all,
>
> I have been trying to update a CRS rule's action using
> SecRuleUpdateActionById with the intention of adding "chain" to the action
> list in an attempt to make the rule a chained one and append rules to that
> chain. This seems to me like a neat way of appending behaviours to a given
> rule in order to refine what it does with AND clauses. However, I am
> guessing this is not supported at all. Am I wrong? Can this be done and if
> so, how?
>
> Thank you!
> Adrian
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150707/0ddddad1/attachment.html>

From CSanders at trustwave.com  Tue Jul  7 14:13:07 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Tue, 7 Jul 2015 14:13:07 +0000
Subject: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with
 SecRequestBodyAccess
In-Reply-To: <531D6007-6702-4478-81F1-84E15C45C34E@agape.org.pl>
References: <748258FC-1966-4CB9-AFB3-181AADC72A29@agape.org.pl>
	<CAFDTedrz_o4dq6+8de_dY-+RRdewBsQ3_733hM=0ZeL41zFAcA@mail.gmail.com>
	<BY1PR0701MB11126EFFAE0EA74CD8165879DB950@BY1PR0701MB1112.namprd07.prod.outlook.com>
	<531D6007-6702-4478-81F1-84E15C45C34E@agape.org.pl>
Message-ID: <D1C152BD.C177%csanders@trustwave.com>

So there are two questions here and I?ll try and address them independently (unfortunately they are slightly intertwined).
There is a common mistake people make when dealing with removing/modify rules  so I?ll get that out of the way first. There are two ways to do this. One can either do it with a ctl: action (https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ctl) such as

SecRule REQUEST_URI "@beginsWith /index.php" "phase:1,t:none,pass, \
  nolog,ctl:ruleRemoveTargetById=981260;ARGS:user

 Or via the way I showed you previously

SecRuleUpdateTargetById 950907 !ARGS:test

The placement of these depends on which one you use. The rule version, featuring the ctl action must come BEFORE the rule in question. Anywhere really will work. In the CRS 3.0 world there is a file called REQUEST-00-LOCAL-WHITELIST.conf.example. Renaming this file to REQUEST-00-LOCAL-WHITELIST.conf and adding it there is what it was designed for. There is no reason that you can?t do this with an earlier version of OWASP too. The key being that it just needs to be loaded before the rest of the rules.
A similar file exists for SecRuleUpdateTargetById type directives. These must be places AFTER all the rules (it has to do with when these are run ? at startup versus at time of rule check). CRS 3.0 also has a file just for this named RESPONSE-99-EXCEPTIONS.conf.example. This can also be renamed RESPONSE-99-EXCEPTIONS.conf and the SecRuleUpdateTargetById directive could be included there.

Now onto your second question how to upgrade to CRS 3.0. Fortunately this is the easier part. CRS is just a number of configuration files. So you can find those typically in your apache config area? depending on the OS this might be /etc/httpd/. Grep/find will be your friend in this instance. Once you?ve found all the files it is simply a matter of deleting (or moving) them. You can now download CRS 3.0 from the following URL: https://github.com/SpiderLabs/owasp-modsecurity-crs/tree/v3.0.0-dev. Extract these and move these rules to the same area.
You will then have to find the file from where CRS was included (either httpd.conf, modsecurity.conf, sometimes if installed via yum this can be named 10-modsecurity.conf (or something like that).  In the end you are looking for something like this (which you can grep). Note, these might have a folder path in front of them:
Include modsecurity_crs_10_setup.conf
Include activated_rules/*.conf


Simply change these to reflect the new folder layout of 3.0. I.E

Include modsecurity_crs_10_setup.conf
Include rules/*.conf

 That should do it, make sure the rules load correctly and you are using 3.0. Hopefully this helps!


From: kazik <kazik at agape.org.pl<mailto:kazik at agape.org.pl>>
Date: Tuesday, July 7, 2015 at 4:05 AM
To: Chaim Sanders <csanders at trustwave.com<mailto:csanders at trustwave.com>>
Cc: Adri?n <adrianbn at gmail.com<mailto:adrianbn at gmail.com>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with SecRequestBodyAccess

Hello,

Thanks Chaim - your right, modsecurity works ok - I do not?

In your example I can update the rule, but where shoud I place this update,
in apache container (example <Directory>) or add local.conf file to activated_rules?

CRS v3 looks interesting (even beta) - maybe stupid question, but how to update CRS rules to v 3?
(now: modsecurity 2.7.7-2, crs 2.9)

Giga thanks, again ;)

Tom Kazm


Wiadomo?? napisana przez Chaim Sanders <CSanders at trustwave.com<mailto:CSanders at trustwave.com>> w dniu 4 lip 2015, o godz. 17:37:

ModSecurity will indeed will block HTML tags because they are exactly how HTML injection/XSS is introduced. Sending HTML is often indicative of these vulnerabilities being exploited, in general it is considered poor form/dev to send such content across the wire. However, you can always, easily create exceptions for rules in particular places. Just look at the particular rule that is triggering and the particular parameter that is triggering them and you can add an exception by doing something similar to the following ?SecRuleUpdateTargetById 950907 !ARGS:test?. For more information see https://www.trustwave.com/Resources/SpiderLabs-Blog/ModSecurity-Advanced-Topic-of-the-Week--(Updated)-Exception-Handling/. In addition, if you are using CRS 3.0 this feature is already built in see your config file: https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0.0-dev/modsecurity_crs_10_setup.conf.example#L420<http://scanmail.trustwave.com/?c=4062&d=joib1XwoaC3QMPIMFmFAYVrQyTAV7DV0YUkDP0xdSg&s=5&u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fowasp-modsecurity-crs%2fblob%2fv3%2e0%2e0-dev%2fmodsecurity%5fcrs%5f10%5fsetup%2econf%2eexample%23L420>.

For more detail see the issue that someone opened yesterday about this and my reply, I think it goes into a tad more detail.https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/235<http://scanmail.trustwave.com/?c=4062&d=joib1XwoaC3QMPIMFmFAYVrQyTAV7DV0YU5SYEUKSg&s=5&u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fowasp-modsecurity-crs%2fissues%2f235>

Chaim Sanders
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Adri?n
Sent: Friday, July 3, 2015 5:12 AM
To: kazik; owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] modsecurity - trouble with SecRequestBodyAccess

Hi Tom,
it seems to me that ModSecurity is 'rightly' detecting XSS attempts due to the HTML tags that you submit when creating blog posts. As far as I know, what you would need to do is create exceptions for the URLs and parameters you know contain HTML tags, and if possible make them specific to the tags that your site allows. This is a tedious (for a lack of a better word) work that comes with the installation of ModSecurity in front of a new application. Think that the default CRS is generic and doesn't understand the idiosyncrasy of your application, so the rules need adjusting.
Good luck!
Adrian

El vie., 3 jul. 2015 a las 9:35, kazik (<kazik at agape.org.pl<mailto:kazik at agape.org.pl>>) escribi?:
helo,

Server - Ubuntu 14 LTS | Apache/2.4.7 | modsecurity 2.7.7-2

I was enabled modsecurity in DetectionPnly mode - default configuration from Ubuntu.

On our server we have a few site, CMS (Joomla, wordpress) and own CMS.
All of them work with WYSWIG editors.

When I set SecRequestBodyAccess On and try update or create article,
there is a lot of errors, especially SQL-injecttion and XSS.

But I only update article, its no a crime :)

Look like modsecurity treats all html tags like SQL or XSS attack,
is there any special module for that or parser?

HELP ME, PLEASE :)

tom kazm

example of logs from apache2 errors



[Fri Jul 03 10:14:05.628018 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\(.*?\\\\))<file://////'][%20]*(([%5ea-z0-9~_:/'%20%5d)|(in)).+%3f/(.*%3f/))>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "506"] [id "973335"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22<file://///x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0) found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca>href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz<file://///x22%3eWybierasz> si\\xc4\\x99 za granic\\xc4\\x99?..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname ?XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.628575 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'].*?\\\\)[ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?\\\\()<file://////'].*%3f/)%5b%20%5d*((%5b%5ea-z0-9~_:/'%20%5d)|(in)).+%3f/()>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "508"] [id "973334"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22contentpaneopen\\x22<file://///x22contentpaneopen/x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb( found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigr..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.628689 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Rule 7f036a3bc248 [id "973334"][file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"][line "508"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "milujciesie.org.pl<http://scanmail.trustwave.com/?c=4062&d=joib1XwoaC3QMPIMFmFAYVrQyTAV7DV0YU5VYEkOSw&s=5&u=http%3a%2f%2fmilujciesie%2eorg%2epl>"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.629212 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)<file://////'][%20]*(([%5ea-z0-9~_:/'%20%5d)|(in)).+%3f%5b.%5d.+%3f=)>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22<file://///x22>> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_lid: <p> </p> <table class=\\x22contentpaneopen\\x22> <tbody> <tr> <td valign=\\x22top\\x22> <h5 style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span st..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.629414 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[\\"\\\\'][ ]*(([^a-z0-9~_:\\\\' ])|(in)).+?[.].+?=)<file://////'][%20]*(([%5ea-z0-9~_:/'%20%5d)|(in)).+%3f%5b.%5d.+%3f=)>" at ARGS:art_text. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "510"] [id "973333"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data: \\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option= found within ARGS:art_text: <p><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><img align=\\x22left\\x22 alt=\\x22\\x22 src=\\x22https://milujciesie.org.pl/upload/articles/r_u_c_k_i/PL/logo_IDE.png\\x22 /></a>Na stronie <a href=\\x22http://www.emigracja.chrystusowcy.pl/\\x22 target=\\x22_blank\\x22>Instytutu Duszpasterstwa Emig..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag "PCI/6.5.1"] [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
[Fri Jul 03 10:14:05.631654 2015] [:error] [pid 28133:tid 139652430276352] [client 192.168.20.129] ModSecurity: Warning. Pattern match "(?i:[ /+\\\\t\\"\\\\'`]style[ /+\\\\t]*?=.*([:=]|(&#x?0*((58)|(3A)|(61)|(3D));?)).*?([(\\\\\\\\]|(&#x?0*((40)|(28)|(92)|(5C));?)))<file://////'%60]style[%20/+/t%5d*%3f=.*(%5b:=%5d|(&%23x%3f0*((58)|(3A)|(61)|(3D));%3f)).*%3f(%5b(/%5d|(&%23x%3f0*((40)|(28)|(92)|(5C));%3f)))>" at ARGS:art_lid. [file "/etc/modsecurity/owasp-modsecurity-crs/activated_rules/modsecurity_crs_41_xss_attacks.conf"] [line "520"] [id "973316"] [rev "2"] [msg "IE XSS Filters - Attack Detected."] [data "Matched Data:  style=\\x22text-align: center\\x22><span style=\\x22color: rgb(128,0,0)\\x22><a<file://///x22%3e%3ca> href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22><span style=\\x22color: rgb(128,0,0)\\x22>Wybierasz<file://///x22%3eWybierasz> si\\xc4\\x99 za granic\\xc4\\x99?</span></a></span><br /> <a href=\\x22http://www.emigracja.chrystusowcy.pl/index.php?option=com_sobi2&Itemid=74\\x22 target=\\x22_blank\\x22>Szukasz Mszy \\xc5\\x9awi\\xc4\\x99tej<file://///xc5/x9awi/xc4/x99tej> w j\\xc4\\x99zyku polskim? <span style=\\x22color: rgb( found..."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy "8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag [hostname "XXXXXXXXXXXXX"] [uri "/admin/index.php"] [unique_id "VZZETQoKASsAAG3lzAAAAADL"]
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<http://scanmail.trustwave.com/?c=4062&d=joib1XwoaC3QMPIMFmFAYVrQyTAV7DV0YUlSP01ZQw&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150707/2e31ab84/attachment-0001.html>

From wbmilleriii at comcast.net  Wed Jul  8 14:49:51 2015
From: wbmilleriii at comcast.net (Bill Miller)
Date: Wed, 08 Jul 2015 09:49:51 -0500
Subject: [Owasp-modsecurity-core-rule-set] Lua Script execution failed
	message
Message-ID: <559D388F.10608@comcast.net>

Hello,
I've been setting up modsecurity-crs and I've managed to eliminate all 
the error messages save one, namely

Message: Lua: Script execution failed: 
/usr/share/modsecurity-crs/lua/gather_ip_data.lua:8: attempt to 
concatenate local 'remote_addr' (a nil value)

This message shows up in modsec_audit.log every time the 
modsecurity_crs_60_correlation.conf rule is triggered.

Any information on how to go about fixing this would be most 
appreciated.  Google searching has been fruitless.

Thanks in advance,
Bill

From CSanders at trustwave.com  Wed Jul  8 21:26:00 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Wed, 8 Jul 2015 21:26:00 +0000
Subject: [Owasp-modsecurity-core-rule-set] Lua Script execution failed
 message
In-Reply-To: <559D388F.10608@comcast.net>
References: <559D388F.10608@comcast.net>
Message-ID: <D1C30CED.C97B%csanders@trustwave.com>

It seems as if you have enabled the experimental rules namely
modsecurity_crs_61_ip_forensics.conf. Without looking directly at the
code, it looks as if the particular rule is trying to do WHOIS lookup. My
advice would be that you might consider disabling the particular rules you
don?t need. If you need these rules (or want them) I can certainly look
more closely at the LUA script and see where the problem might arise.

On 7/8/15, 10:49 AM, "Bill Miller" <wbmilleriii at comcast.net> wrote:

>Hello,
>I've been setting up modsecurity-crs and I've managed to eliminate all
>the error messages save one, namely
>
>Message: Lua: Script execution failed:
>/usr/share/modsecurity-crs/lua/gather_ip_data.lua:8: attempt to
>concatenate local 'remote_addr' (a nil value)
>
>This message shows up in modsec_audit.log every time the
>modsecurity_crs_60_correlation.conf rule is triggered.
>
>Any information on how to go about fixing this would be most
>appreciated.  Google searching has been fruitless.
>
>Thanks in advance,
>Bill
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>http://scanmail.trustwave.com/?c=4062&d=3L6d1Xgeb8uYenYYXLrpkJXDRrC-WD4vtd
>2MDWBwqQ&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fow
>asp-modsecurity-core-rule-set


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From jroback at gmail.com  Mon Jul 13 18:43:01 2015
From: jroback at gmail.com (Joshua Roback)
Date: Mon, 13 Jul 2015 18:43:01 +0000
Subject: [Owasp-modsecurity-core-rule-set] Duplicate SecAuditLogParts?
Message-ID: <CAExQ=_cjp_nCsKTbOV0ormsJXED_QRPuDiQfs4=nF=8-5ott2w@mail.gmail.com>

Good afternoon group,

I've come across an issue in which at times some of the SecAuditLogParts
are duplicate in my audit.log.  For example:






*--05761b09-C-- Here is some request body data -- --05761b09-C-- *




*alendar-set.js"></scrip<html> <head> <META HTTP-EQUIV="Content-Type"
CONTENT="text/html; CHARSET=UTF-?WL< ZL<LMTHa
Co?WL<@ZL<PMOCcripXL<`ZL<EWOLpt1.2"> <!-- String.prototype.endsWith =
function(str) --*

Typically the 2nd C field contains improperly encoded characters as well.
Is this expected behavior?  Under what circumstances would this behavior
present itself?

Running ModSecurity for Apache V2.9
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150713/f06c2ed6/attachment.html>

From aadimanavtest at gmail.com  Tue Jul 14 11:41:25 2015
From: aadimanavtest at gmail.com (Rishi nand)
Date: Tue, 14 Jul 2015 17:11:25 +0530
Subject: [Owasp-modsecurity-core-rule-set] Need Help for Mod security
Message-ID: <CA+W-ZBNK5PFxkrKaLm+r69JNjHN6v=Y7T0Of1b46-ino82=n4g@mail.gmail.com>

Hi There

I am new to modsecurity and want to try in our organization, but came
across few doubts. I will be glad if any body can clear them

1. OWASP modsecurity CRS : are these rules update daily (like snort rules,
If so how to update). or how often they will update, In that case how to
update them.
2. if i want to write my own custom rules how can i proceed :- where to
create file and in which directory, Can i write all the rules in one file
or a separate rule for each file
3. any recommended UI for modsecurity

Thanks in advance


-- 
Cheer's

Nand
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150714/1266fadb/attachment.html>

From jroback at gmail.com  Tue Jul 14 13:26:00 2015
From: jroback at gmail.com (Joshua Roback)
Date: Tue, 14 Jul 2015 13:26:00 +0000
Subject: [Owasp-modsecurity-core-rule-set] Need Help for Mod security
In-Reply-To: <CA+W-ZBNK5PFxkrKaLm+r69JNjHN6v=Y7T0Of1b46-ino82=n4g@mail.gmail.com>
References: <CA+W-ZBNK5PFxkrKaLm+r69JNjHN6v=Y7T0Of1b46-ino82=n4g@mail.gmail.com>
Message-ID: <CAExQ=_d7EAO8T7=fUuSh7qYUKhD6auPu1Cg6otGcBrCu6fk7bA@mail.gmail.com>

1) Typically open source rules are updated along with new ModSecurity
releases.  There isn't really a need to update as frequently as an IDS
since the scope of detection requirements for a WAF is much smaller.

2) Spent time looking at the rules to get a feel for the format and the
purpose and then buy
The Web Application Defender's Cookbook -
http://www.amazon.com/Web-Application-Defenders-Cookbook-Protecting/dp/1118362187/ref=sr_1_2?ie=UTF8&qid=1436880245&sr=8-2&keywords=web+application+cookbook
https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual
http://www.atomicorp.com/wiki/index.php/Mod_security

3) Don't know about this.  I use a proprietary application.

On Tue, Jul 14, 2015 at 7:49 AM Rishi nand <aadimanavtest at gmail.com> wrote:

> Hi There
>
> I am new to modsecurity and want to try in our organization, but came
> across few doubts. I will be glad if any body can clear them
>
> 1. OWASP modsecurity CRS : are these rules update daily (like snort rules,
> If so how to update). or how often they will update, In that case how to
> update them.
> 2. if i want to write my own custom rules how can i proceed :- where to
> create file and in which directory, Can i write all the rules in one file
> or a separate rule for each file
> 3. any recommended UI for modsecurity
>
> Thanks in advance
>
>
> --
> Cheer's
>
> Nand
>  _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150714/cbd2f667/attachment.html>

From CSanders at trustwave.com  Tue Jul 14 16:03:05 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Tue, 14 Jul 2015 16:03:05 +0000
Subject: [Owasp-modsecurity-core-rule-set] Need Help for Mod security
In-Reply-To: <CAExQ=_d7EAO8T7=fUuSh7qYUKhD6auPu1Cg6otGcBrCu6fk7bA@mail.gmail.com>
References: <CA+W-ZBNK5PFxkrKaLm+r69JNjHN6v=Y7T0Of1b46-ino82=n4g@mail.gmail.com>
	<CAExQ=_d7EAO8T7=fUuSh7qYUKhD6auPu1Cg6otGcBrCu6fk7bA@mail.gmail.com>
Message-ID: <D1CAA944.ED09%csanders@trustwave.com>

Josh has pretty much nailed it.


  1.  The CRS rules are generic and don't update often I usually update them about once a month with minor bug fixes (almost exclusively in the 3.0 branch). If you are looking for signature like protection (i.e what snort does) Trustwave offers commercial rules that do just that. We do however recommend that you also use CRS  where reasonable.
  2.   Writing rules isn't so bad. A good intro is available here: https://www.nccgroup.trust/globalassets/resources/us/presentations/crowell_stjohn_modsecurity_introduction.pdf.  Ultimately if you want to get into it in any depth I recommend buying Ivan's ModSecurity Handbook (https://www.feistyduck.com/books/modsecurity-handbook/). Its a treasure trove of information and is a great start.
  3.   The UI I use most often is AuditConsole from Jwall but your milage may vary. Many people use splunk. I have a blog post coming out soon that details how to save logs directly to any database such that you can use/make pretty much any log analyzer.

From: Joshua Roback <jroback at gmail.com<mailto:jroback at gmail.com>>
Date: Tuesday, July 14, 2015 at 9:26 AM
To: Rishi nand <aadimanavtest at gmail.com<mailto:aadimanavtest at gmail.com>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] Need Help for Mod security

1) Typically open source rules are updated along with new ModSecurity releases.  There isn't really a need to update as frequently as an IDS since the scope of detection requirements for a WAF is much smaller.

2) Spent time looking at the rules to get a feel for the format and the purpose and then buy
The Web Application Defender's Cookbook - http://www.amazon.com/Web-Application-Defenders-Cookbook-Protecting/dp/1118362187/ref=sr_1_2?ie=UTF8&qid=1436880245&sr=8-2&keywords=web+application+cookbook<http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT7oOwuBozg&s=5&u=http%3a%2f%2fwww%2eamazon%2ecom%2fWeb-Application-Defenders-Cookbook-Protecting%2fdp%2f1118362187%2fref%3dsr%5f1%5f2%3fie%3dUTF8%26qid%3d1436880245%26sr%3d8-2%26keywords%3dweb%2bapplication%2bcookbook>
https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual<http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT-ZemLcwnA&s=5&u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fModSecurity%2fwiki%2fReference-Manual>
http://www.atomicorp.com/wiki/index.php/Mod_security<http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT-1dm-Zmzg&s=5&u=http%3a%2f%2fwww%2eatomicorp%2ecom%2fwiki%2findex%2ephp%2fMod%5fsecurity>

3) Don't know about this.  I use a proprietary application.

On Tue, Jul 14, 2015 at 7:49 AM Rishi nand <aadimanavtest at gmail.com<mailto:aadimanavtest at gmail.com>> wrote:
Hi There

I am new to modsecurity and want to try in our organization, but came across few doubts. I will be glad if any body can clear them

1. OWASP modsecurity CRS : are these rules update daily (like snort rules, If so how to update). or how often they will update, In that case how to update them.
2. if i want to write my own custom rules how can i proceed :- where to create file and in which directory, Can i write all the rules in one file or a separate rule for each file
3. any recommended UI for modsecurity

Thanks in advance


--
Cheer's

Nand
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT-sPw-czwA&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150714/12def86a/attachment.html>

From wbmilleriii at comcast.net  Tue Jul 14 23:14:45 2015
From: wbmilleriii at comcast.net (Bill Miller)
Date: Tue, 14 Jul 2015 18:14:45 -0500
Subject: [Owasp-modsecurity-core-rule-set] SecRuleEngine mode
Message-ID: <55A597E5.20701@comcast.net>

Hello,
My modsecurity.conf starts like this

# Enable ModSecurity, attaching it to every transaction. Use detection
# only to start with, because that minimises the chances of 
post-installation
# disruption.
#
SecRuleEngine On


But all messages in modsec_audit.log contain this string:

Engine-Mode: "DETECTION_ONLY"

I have grep'd for other instances of SecRuleEngine being set, but have 
not found any.

What am I doing wrong?

Thanks for your help.
Bill



From aadimanavtest at gmail.com  Wed Jul 15 10:21:21 2015
From: aadimanavtest at gmail.com (Rishi nand)
Date: Wed, 15 Jul 2015 15:51:21 +0530
Subject: [Owasp-modsecurity-core-rule-set] Need Help for Mod security
In-Reply-To: <D1CAA944.ED09%csanders@trustwave.com>
References: <CA+W-ZBNK5PFxkrKaLm+r69JNjHN6v=Y7T0Of1b46-ino82=n4g@mail.gmail.com>
	<CAExQ=_d7EAO8T7=fUuSh7qYUKhD6auPu1Cg6otGcBrCu6fk7bA@mail.gmail.com>
	<D1CAA944.ED09%csanders@trustwave.com>
Message-ID: <CA+W-ZBNzGXnfCCN1WoBcK5hT=gLEC1b-LTH_rgcpbxKDVGvzQQ@mail.gmail.com>

Hey Joshua,

Thank you very much. Now got the clear picture.

Cheers
Nand

On Tue, Jul 14, 2015 at 9:33 PM, Chaim Sanders <CSanders at trustwave.com>
wrote:

>  Josh has pretty much nailed it.
>
>
>    1. The CRS rules are generic and don?t update often I usually update
>    them about once a month with minor bug fixes (almost exclusively in the 3.0
>    branch). If you are looking for signature like protection (i.e what snort
>    does) Trustwave offers commercial rules that do just that. We do however
>    recommend that you also use CRS  where reasonable.
>    2.  Writing rules isn?t so bad. A good intro is available here:
>    https://www.nccgroup.trust/globalassets/resources/us/presentations/crowell_stjohn_modsecurity_introduction.pdf.
>     Ultimately if you want to get into it in any depth I recommend buying
>    Ivan?s ModSecurity Handbook (
>    https://www.feistyduck.com/books/modsecurity-handbook/). Its a
>    treasure trove of information and is a great start.
>    3.  The UI I use most often is AuditConsole from Jwall but your milage
>    may vary. Many people use splunk. I have a blog post coming out soon that
>    details how to save logs directly to any database such that you can
>    use/make pretty much any log analyzer.
>
>
>   From: Joshua Roback <jroback at gmail.com>
> Date: Tuesday, July 14, 2015 at 9:26 AM
> To: Rishi nand <aadimanavtest at gmail.com>, "
> owasp-modsecurity-core-rule-set at lists.owasp.org" <
> owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Need Help for Mod security
>
>   1) Typically open source rules are updated along with new ModSecurity
> releases.  There isn't really a need to update as frequently as an IDS
> since the scope of detection requirements for a WAF is much smaller.
>
>  2) Spent time looking at the rules to get a feel for the format and the
> purpose and then buy
> The Web Application Defender's Cookbook -
> http://www.amazon.com/Web-Application-Defenders-Cookbook-Protecting/dp/1118362187/ref=sr_1_2?ie=UTF8&qid=1436880245&sr=8-2&keywords=web+application+cookbook
> <http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT7oOwuBozg&s=5&u=http%3a%2f%2fwww%2eamazon%2ecom%2fWeb-Application-Defenders-Cookbook-Protecting%2fdp%2f1118362187%2fref%3dsr%5f1%5f2%3fie%3dUTF8%26qid%3d1436880245%26sr%3d8-2%26keywords%3dweb%2bapplication%2bcookbook>
> https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual
> <http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT-ZemLcwnA&s=5&u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fModSecurity%2fwiki%2fReference-Manual>
> http://www.atomicorp.com/wiki/index.php/Mod_security
> <http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT-1dm-Zmzg&s=5&u=http%3a%2f%2fwww%2eatomicorp%2ecom%2fwiki%2findex%2ephp%2fMod%5fsecurity>
>
>  3) Don't know about this.  I use a proprietary application.
>
>  On Tue, Jul 14, 2015 at 7:49 AM Rishi nand <aadimanavtest at gmail.com>
> wrote:
>
>> Hi There
>>
>>  I am new to modsecurity and want to try in our organization, but came
>> across few doubts. I will be glad if any body can clear them
>>
>>  1. OWASP modsecurity CRS : are these rules update daily (like snort
>> rules, If so how to update). or how often they will update, In that case
>> how to update them.
>> 2. if i want to write my own custom rules how can i proceed :- where to
>> create file and in which directory, Can i write all the rules in one file
>> or a separate rule for each file
>> 3. any recommended UI for modsecurity
>>
>>  Thanks in advance
>>
>>
>>  --
>>  Cheer's
>>
>>  Nand
>>   _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>> <http://scanmail.trustwave.com/?c=4062&d=kZOl1fQMIZX7mJz_iVyCNeOaH9906S4ZT-sPw-czwA&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set>
>>
>
> ------------------------------
>
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is strictly prohibited. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>



-- 
Cheer's

Nand
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150715/17530dad/attachment-0001.html>

From micheleroviello at gmail.com  Wed Jul 15 11:46:54 2015
From: micheleroviello at gmail.com (Michele Roviello)
Date: Wed, 15 Jul 2015 13:46:54 +0200
Subject: [Owasp-modsecurity-core-rule-set] Check for User-agent field
	missing in CRS
Message-ID: <CABOW_=b=fhUo1eNzGKLJ5vZvgOR=6Z=iB-LH-qSfbwPLSocEyA@mail.gmail.com>

Hello,
I have done some tests on XSS attacks with ModSecurity and the base rules
for XSS attack from the CRS.
I have found that this set of rules doesn't check for an XSS attack vector
in the User-agent field of the HTTP message.
Is this true or am I missing something?
Thank you for your consideration,
Michele Roviello
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150715/061ffcc6/attachment.html>

From CSanders at trustwave.com  Wed Jul 15 13:50:40 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Wed, 15 Jul 2015 13:50:40 +0000
Subject: [Owasp-modsecurity-core-rule-set] Check for User-agent field
 missing in CRS
In-Reply-To: <CABOW_=b=fhUo1eNzGKLJ5vZvgOR=6Z=iB-LH-qSfbwPLSocEyA@mail.gmail.com>
References: <CABOW_=b=fhUo1eNzGKLJ5vZvgOR=6Z=iB-LH-qSfbwPLSocEyA@mail.gmail.com>
Message-ID: <D1CBDCBA.ED40%csanders@trustwave.com>

This seems to be true. If you believe this to be a major oversight, we invite you to submit such a protection if you deem it to be necessary. Please note that if submitting it should be submitted to the 3.0 branch. Additionally, note the use of @detectXSS would not work here as libinjection is not designed to detectXSS in headers.

From: Michele Roviello <micheleroviello at gmail.com<mailto:micheleroviello at gmail.com>>
Date: Wednesday, July 15, 2015 at 7:46 AM
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] Check for User-agent field missing in CRS

Hello,
I have done some tests on XSS attacks with ModSecurity and the base rules for XSS attack from the CRS.
I have found that this set of rules doesn't check for an XSS attack vector in the User-agent field of the HTTP message.
Is this true or am I missing something?
Thank you for your consideration,
Michele Roviello

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150715/6f4e1d04/attachment.html>

From jroback at gmail.com  Fri Jul 17 14:26:16 2015
From: jroback at gmail.com (Joshua Roback)
Date: Fri, 17 Jul 2015 14:26:16 +0000
Subject: [Owasp-modsecurity-core-rule-set] SecRuleEngine mode
In-Reply-To: <55A597E5.20701@comcast.net>
References: <55A597E5.20701@comcast.net>
Message-ID: <CAExQ=_f3fXOQ9FoQx1N1hZP0PpHEXStcZ5c=fwqAUubKhB3OrQ@mail.gmail.com>

So you're claiming that while your conf file clearly states that
SecRuleEngine is "On", your audit.log indicates your in "DETECTION_ONLY"
mode?

On Tue, Jul 14, 2015 at 7:22 PM Bill Miller <wbmilleriii at comcast.net> wrote:

> Hello,
> My modsecurity.conf starts like this
>
> # Enable ModSecurity, attaching it to every transaction. Use detection
> # only to start with, because that minimises the chances of
> post-installation
> # disruption.
> #
> SecRuleEngine On
>
>
> But all messages in modsec_audit.log contain this string:
>
> Engine-Mode: "DETECTION_ONLY"
>
> I have grep'd for other instances of SecRuleEngine being set, but have
> not found any.
>
> What am I doing wrong?
>
> Thanks for your help.
> Bill
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150717/ec8421c5/attachment.html>

From micheleroviello at gmail.com  Sun Jul 19 09:34:39 2015
From: micheleroviello at gmail.com (Michele Roviello)
Date: Sun, 19 Jul 2015 11:34:39 +0200
Subject: [Owasp-modsecurity-core-rule-set] Submit a change in the CRS
Message-ID: <CABOW_=YhZgO9otitD4xe7HLnJJhLfJKJERisZvkmWW8GhJMB5A@mail.gmail.com>

Hello,
I have found a vulnerability in the CRS, I discussed it in a previous mail
and they suggested me to submit the protection to this issue.
Can someone tell me what I should I do to submit a change in the CRS?

Thank you for your help
Michele Roviello
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150719/73dc926a/attachment.html>

From CSanders at trustwave.com  Sun Jul 19 14:34:39 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Sun, 19 Jul 2015 14:34:39 +0000
Subject: [Owasp-modsecurity-core-rule-set] Submit a change in the CRS
In-Reply-To: <CABOW_=YhZgO9otitD4xe7HLnJJhLfJKJERisZvkmWW8GhJMB5A@mail.gmail.com>
References: <CABOW_=YhZgO9otitD4xe7HLnJJhLfJKJERisZvkmWW8GhJMB5A@mail.gmail.com>
Message-ID: <D1D12B85.F533%csanders@trustwave.com>

Try not to be an alarmist by calling it a vulnerability. It is a protection that is simply not offered because most people don't end up reflecting user agents onto their page, for pretty obvious reasons. That being said you are fully encouraged to develop protections for this if you feel it to be an oversight. If you don't know how to do this I am more then willing to work offline to help you accomplish this goal. In general you would modify a rule present in the XSS section to include Request_Headers:User-Agent. (https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0.0-dev/rules/REQUEST-41-APPLICATION-ATTACK-XSS.conf). Within this config file we have accumulated a number of different XSS filters over time. Feel free to identify which ones make the most sense for where your protection should be placed and add it. You can then issue a push request adding this feature as we use github for version control.

From: Michele Roviello <micheleroviello at gmail.com<mailto:micheleroviello at gmail.com>>
Date: Sunday, July 19, 2015 at 5:34 AM
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] Submit a change in the CRS

Hello,
I have found a vulnerability in the CRS, I discussed it in a previous mail and they suggested me to submit the protection to this issue.
Can someone tell me what I should I do to submit a change in the CRS?

Thank you for your help
Michele Roviello

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150719/b87a4f38/attachment.html>

From jamie.riden at gmail.com  Sun Jul 19 14:52:38 2015
From: jamie.riden at gmail.com (Jamie Riden)
Date: Sun, 19 Jul 2015 15:52:38 +0100
Subject: [Owasp-modsecurity-core-rule-set] Submit a change in the CRS
In-Reply-To: <D1D12B85.F533%csanders@trustwave.com>
References: <CABOW_=YhZgO9otitD4xe7HLnJJhLfJKJERisZvkmWW8GhJMB5A@mail.gmail.com>
	<D1D12B85.F533%csanders@trustwave.com>
Message-ID: <CAHno4i-QeJfdabD2jYqinKfa=x_1HVcKYm-oppPDBTLkRKSwgA@mail.gmail.com>

I certainly wouldn't say it was a vulnerability in CRS, but I have
seen apps which logged User-Agent to a file and then in the admin
section of the site wrote it straight to the page. Equally I've seen
people do the same thing, but inserting User-Agent into a table in a
manner vulnerable to SQL injection.

However, the kind of people who do these things are not the same kind
of people who install mod_security and CRS, so it's debatable if it
would really help anyone by being changed in CRS.

cheers,
 Jamie

On 19 July 2015 at 15:34, Chaim Sanders <CSanders at trustwave.com> wrote:
> Try not to be an alarmist by calling it a vulnerability. It is a protection
> that is simply not offered because most people don?t end up reflecting user
> agents onto their page, for pretty obvious reasons. That being said you are
> fully encouraged to develop protections for this if you feel it to be an
> oversight. If you don?t know how to do this I am more then willing to work
> offline to help you accomplish this goal. In general you would modify a rule
> present in the XSS section to include Request_Headers:User-Agent.
> (https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0.0-dev/rules/REQUEST-41-APPLICATION-ATTACK-XSS.conf).
> Within this config file we have accumulated a number of different XSS
> filters over time. Feel free to identify which ones make the most sense for
> where your protection should be placed and add it. You can then issue a push
> request adding this feature as we use github for version control.
>
> From: Michele Roviello <micheleroviello at gmail.com>
> Date: Sunday, July 19, 2015 at 5:34 AM
> To: "owasp-modsecurity-core-rule-set at lists.owasp.org"
> <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: [Owasp-modsecurity-core-rule-set] Submit a change in the CRS
>
> Hello,
> I have found a vulnerability in the CRS, I discussed it in a previous mail
> and they suggested me to submit the protection to this issue.
> Can someone tell me what I should I do to submit a change in the CRS?
>
> Thank you for your help
> Michele Roviello
>
> ________________________________
>
> This transmission may contain information that is privileged, confidential,
> and/or exempt from disclosure under applicable law. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution, or use of the information contained herein (including any
> reliance thereon) is strictly prohibited. If you received this transmission
> in error, please immediately contact the sender and destroy the material in
> its entirety, whether in electronic or hard copy format.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Jamie Riden / jamie at honeynet.org / jamie.riden at gmail.com
http://uk.linkedin.com/in/jamieriden

From gbhull1 at gmail.com  Mon Jul 27 11:48:13 2015
From: gbhull1 at gmail.com (Gary Hull)
Date: Mon, 27 Jul 2015 06:48:13 -0500
Subject: [Owasp-modsecurity-core-rule-set] Application folder being deleted
Message-ID: <55B61A7D.2020307@gmail.com>

I am on the Bluehost VPS.

I am a rookie dealing with ModSecurity.

On one of our websites we have an application folder that ModSecurity is 
deleting every 24 hrs.

The folder should be Ok as we know the people who wrote the content.

What information does someone need in order to help me white list that 
folder so the this site will stay up.

What log file will the information be in.  I have looked through the log 
files that I can find and do not find any paths for the deleted folder.

Thanks for any help anyone can be.

-- 
Gary Hull
337-515-2114

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150727/0f171aa4/attachment.html>

From matt.v at mymediabox.com  Fri Jul 31 22:38:48 2015
From: matt.v at mymediabox.com (Matt VanCleve)
Date: Fri, 31 Jul 2015 18:38:48 -0400
Subject: [Owasp-modsecurity-core-rule-set] Running ModSecurity Rules on KEMP
	LoadMaster
Message-ID: <CAMiuPXHKXCE5V6xUBjfQvjE2zv9JZ+3kRCqpMnR+eXS3_Xb9fg@mail.gmail.com>

Hi there everyone,

We have been using the KEMP LoadMaster for SSL security and webserver load
balancing. They recently added a Web Application Firewall feature with a
few default rules but also had the option to run ModSecurity rules.
Checking the web for information on implementing ModSecurity on KEMP, I
have not found any information on tuning the standard ModSecurity rules on
a KEMP LoadMaster.

Loading the default ModSecurity rules under Block mode and turning off the
KEMP options of Process Request Data and Process Responses, I was able to
get 12 rules enabled and only had issues with 3 (30_http_policy,
40_generic_attacks, 41_sl_injection). I've started reading the audit logs
from our initial tests but still trying to interpret the logs against the
rule.

I know that getting ModSecurity requires a fair amount of tuning to get
working but wanted to know where a good place to start would be. Also, if
anyone has been able to get ModSecurity working on KEMP please let me know.

I'm going to read through the manual this weekend and see if any of that
sinks in - https://github.com/spiderLabs/modsecurity/wiki/reference-manual

Thanks, Matt
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150731/ea6b44dc/attachment.html>

