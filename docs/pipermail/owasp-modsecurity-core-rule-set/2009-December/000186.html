<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20log%20matched%20rules%20in%0A%09core%20ruleset%202.x&In-Reply-To=200912070847.26354.ryan.barnett%40breach.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000184.html">
   <LINK REL="Next"  HREF="000190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x</H1>
    <B>Nham Xuan Nam</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20log%20matched%20rules%20in%0A%09core%20ruleset%202.x&In-Reply-To=200912070847.26354.ryan.barnett%40breach.com"
       TITLE="[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x">nhamxuannam at yahoo.com
       </A><BR>
    <I>Mon Dec  7 11:55:53 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000184.html">[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x
</A></li>
        <LI>Next message: <A HREF="000190.html">[Owasp-modsecurity-core-rule-set] Question about RBL Match for SPAM	Source Rule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#186">[ date ]</a>
              <a href="thread.html#186">[ thread ]</a>
              <a href="subject.html#186">[ subject ]</a>
              <a href="author.html#186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ryan,

I also think of using the audit log file but it does not satisfy our situation. I think that the audit log file contains a lot of information and it is only suitable for debugging. Currenly, we are using CRS 1.x which output matched rules in apache error log. Then we use some tools to parse apache error log to do some statistics and monitor activity of the rules (based on the rule id). Unfortunately, CRSv2 is using a different approach and we can't do this anymore.

Anyway, thank a lot for your consideration. I am looking forward to the later version of CRS.

-Nam.




________________________________
From: Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ryan.barnett at breach.com</A>&gt;
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Cc: Nham Xuan Nam &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">nhamxuannam at yahoo.com</A>&gt;
Sent: Monday, December 7, 2009 20:47:26
Subject: Re: [Owasp-modsecurity-core-rule-set] How to log matched rules in core ruleset 2.x

On Monday 07 December 2009 02:47:35 am Nham Xuan Nam wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> We are currently using modsecuriy with core ruleset 1.6.1 and we want to
</I>&gt;<i>  upgrade our core ruleset to 2.x version. As I know, in this new version,
</I>&gt;<i>  core ruleset uses anomaly_score to detect attacks. When the anomaly_score
</I>&gt;<i>  is higher than a certain value, the request will be deny and the
</I>&gt;<i>  information is logged.
</I>&gt;<i> 
</I>&gt;<i> But in this way, the logged information did not show us information about
</I>&gt;<i>  the rules which are matched and contributed to the anomaly score
</I>&gt;<i>  (especially the rule id). This is a very useful information. Currently, we
</I>&gt;<i>  use this logs to do some statistics and other things. Do you know any way
</I>&gt;<i>  to log rule-id of the matched rules to the apache error_log?
</I>&gt;<i> 
</I>&gt;<i> Please help me. Thanks in advance.
</I>&gt;<i> 
</I>
If you want to see which rules matched and contributed to the anomaly score 
value, then you need to look at the audit log file.  All of the rules that 
matched will be present under Section H.  One of the goals of CRS v2 was to 
make the alerts less noisy.  Most people just wanted a correlated type of 
event which would tell them what happened.

You bring up a good point though and that is to include more meta-data within 
the correlated event.  Ivan Ristic brought up a similar issue last week in his 
CRS review email and this was that the correlated event msg data is only 
showing the *last* rule msg that triggered.  This is due to the current config 
where a rule match will overwrite the existing msg variable with the current 
one.  A better approach would be too *append* the msg data.  To your point - 
we could also do the same thing with the rule ids.  Basically, we could give 
more meta-data in the correlated event, such as the number of rules that 
matched and their associated rule ids and/or messages.

I will look into this.

-Ryan


      Get your preferred Email name!
Now you can @ymail.com and @rocketmail.com. 
<A HREF="http://mail.promotions.yahoo.com/newdomains/aa/">http://mail.promotions.yahoo.com/newdomains/aa/</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091207/e4fa83a6/attachment-0001.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091207/e4fa83a6/attachment-0001.html</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000184.html">[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x
</A></li>
	<LI>Next message: <A HREF="000190.html">[Owasp-modsecurity-core-rule-set] Question about RBL Match for SPAM	Source Rule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#186">[ date ]</a>
              <a href="thread.html#186">[ thread ]</a>
              <a href="subject.html#186">[ subject ]</a>
              <a href="author.html#186">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
