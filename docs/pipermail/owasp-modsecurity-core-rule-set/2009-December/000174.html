<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Review%20of%20CRS%202.0.3&In-Reply-To=1f9222b70912020209w4c9bb588r9120db85b6319d49%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000173.html">
   <LINK REL="Next"  HREF="000188.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Review%20of%20CRS%202.0.3&In-Reply-To=1f9222b70912020209w4c9bb588r9120db85b6319d49%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3">ryan.barnett at breach.com
       </A><BR>
    <I>Wed Dec  2 11:58:15 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000173.html">[Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3
</A></li>
        <LI>Next message: <A HREF="000188.html">[Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#174">[ date ]</a>
              <a href="thread.html#174">[ thread ]</a>
              <a href="subject.html#174">[ subject ]</a>
              <a href="author.html#174">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday 02 December 2009 05:09:31 am Ivan Ristic wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I was on a plane a couple of weeks ago, with nothing better to do, so
</I>&gt;<i> I took the opportunity to review the Core Rule Set, as bundled with
</I>&gt;<i> ModSecurity 2.5.11. It is by no means a comprehensive review, but
</I>&gt;<i> perhaps I will make another pass at some point in the future.
</I>&gt;<i> 
</I>&gt;<i> Here are my observations:
</I>&gt;<i> 
</I>&gt;<i> - Why are there two scripts to interface to ClamAV (in the ModSecurity
</I>&gt;<i> distribution)? Any why are they under the rules/ folder, instead in
</I>&gt;<i> tools/ -- they can be useful with custom rules too.
</I>&gt;<i> 
</I>&gt;<i> - In README
</I>&gt;<i>   - Thanks for the mention of Apache Security. I have a book about
</I>&gt;<i> ModSecurity itself coming up ;)
</I>&gt;<i>   - Reading the installation instructions: I don&#8217;t think that rule
</I>&gt;<i> sets should have anything to do with ModSecurity configuration. They
</I>&gt;<i> just make automated updates impossible. ModSecurity itself should have
</I>&gt;<i> a default configuration file and leave it to the users to customise
</I>&gt;<i> it.
</I>&gt;<i>   - Google Analytics: The requirement to disable the rules in order to
</I>&gt;<i> support Google Analytics activation makes the rules a no-go in virtual
</I>&gt;<i> hosting environments.
</I>&gt;<i>   - About Regular Expressions: The optimisation of regular expressions
</I>&gt;<i> should be moved into ModSecurity and made transparent for users.
</I>&gt;<i>   - There&#8217;s no mention of the optional rules folder; what are those for?
</I>&gt;<i> 
</I>&gt;<i> - In modsecurity_crs_20_protocol_violations.conf
</I>&gt;<i>   - Typo in the header: &quot;ModSecuirty&quot;.
</I>&gt;<i>   - There's a TODO entry right below the header, but there are no
</I>&gt;<i> instructions to do anything.
</I>&gt;<i>   - The rules that check for request body processor errors should not
</I>&gt;<i> be here. They should be part of ModSecurity configuration instead.
</I>&gt;<i>   - 960012: There is no real reason for ModSecurity 2.x to request
</I>&gt;<i> POST request to have C-L.
</I>&gt;<i>   - 960013: &#8220;ModSecurity does not support chunked transfer encodings
</I>&gt;<i> at this time.&#8221; &#8211; this is incorrect.
</I>&gt;<i>   - Many of these rules may or may not be doing the right thing, but I
</I>&gt;<i> have no way to validate what they are doing. I know I am asking for a
</I>&gt;<i> lot, but each rule should provide some reasoning that would help the
</I>&gt;<i> users understand why it is important. For example, rule 960021 does
</I>&gt;<i> not allow the Expect header to be used with HTTP/1.0 because it is an
</I>&gt;<i> HTTP/1.1 feature. But why should you care? Is there a way to abuse the
</I>&gt;<i> header in combination with HTTP/1.0?
</I>&gt;<i>   - The &#8220;# Check UTF enconding&#8221; (sic) does not have an ID. Further, it
</I>&gt;<i> makes a global change, which affects all sites and all applications on
</I>&gt;<i> the server.
</I>&gt;<i>   - Rule 950801:
</I>&gt;<i>     - What is utf-8 is used on one script (page) on a site, but not in
</I>&gt;<i> another? How will this rule handle it?
</I>&gt;<i>     - Request headers never use utf-8 anyway (although you may get
</I>&gt;<i> utf-8 in User-Agent or Referer, as you know).
</I>&gt;<i>     - Request URIs allow for utf-8 in a general case, even when
</I>&gt;<i> applications use something else.
</I>&gt;<i>     - I think you only need to check ARGS here.
</I>&gt;<i>     - Rule 950116: Can the %u encoding really be used in request
</I>&gt;<i> headers? And in XML payloads?
</I>&gt;<i> 
</I>&gt;<i> - In crs_21:
</I>&gt;<i>   - If I must patch mod_unique_id to make a rule work, shouldn&#8217;t that
</I>&gt;<i> rule be disabled by default?
</I>&gt;<i> 
</I>&gt;<i> - In crs_23:
</I>&gt;<i>   - Apache limits shouldn&#8217;t be here. That too is part of someone's
</I>&gt;<i> configuration.
</I>&gt;<i> 
</I>&gt;<i> - In crs_30:
</I>&gt;<i>   - ModSecurity does support compressed content. It's true that there
</I>&gt;<i> were some problems with getting mod_deflate to run after ModSecurity,
</I>&gt;<i> but that should have been fixed.
</I>&gt;<i> 
</I>&gt;<i> - In crs_35:
</I>&gt;<i>   - Why not use parallel matching to discover bad user agents? It
</I>&gt;<i> would be easier to understand and maintain.
</I>&gt;<i> 
</I>&gt;<i> - In crs_40:
</I>&gt;<i>   - The HTTP Parameter Pollution rule does not have an ID. It&#8217;s very
</I>&gt;<i> creative in how it uses the rule language, but it warns on any
</I>&gt;<i> parameter that occurs more than once (and that is entirely
</I>&gt;<i> legitimate).
</I>&gt;<i>   - Why does rule 950907 use t:htmlEntityDecode? I would imagine that
</I>&gt;<i> transformation is only for attacks against a HTML surface. (The
</I>&gt;<i> question applies to many other rules. I also think t:urlDecodeUni is
</I>&gt;<i> used too liberally.
</I>&gt;<i>   - I see that the rules use &#8220;block&#8221;, which is good, but they also use
</I>&gt;<i> &#8220;status:400&#8221;. Why?
</I>&gt;<i>   - It would be nice if you could explain how the transaction
</I>&gt;<i> variables are used for anomaly scoring and keeping the information on
</I>&gt;<i> matched variables around. It takes some deciphering to understand
</I>&gt;<i> what&#8217;s going on.
</I>&gt;<i>   - All the rules use tx.msg&#8212;won&#8217;t the messages overwrite one another?
</I>&gt;<i> That would make the messages emitted from crs_49 inconsistent.
</I>&gt;<i> 
</I>&gt;<i> You can tell from the review that I gave up looking into individual
</I>&gt;<i> rules at some point. With no documentation in the rules themselves,
</I>&gt;<i> the review would have taken days. After my review I have a sense that
</I>&gt;<i> the CRS has tremendous value (and an enormous improvement over the
</I>&gt;<i> previous version), but that it does not explain what it does. As such,
</I>&gt;<i> I can only treat the rules as a black box and hope for the best. The
</I>&gt;<i> final verdict to the usefulness can come only from someone using the
</I>&gt;<i> rules in production.
</I>&gt;<i> 
</I>
Outstanding feedback Ivan!  I agree with your final conclusion and I believe 
that the right course of action is to utilize the OWASP CRS project site for 
the full documentation.  I am planning to update the site with this info... 
when I have time....  Once I start documenting these items, I will ping the 
mail-list so everyone can review, comment and hopefully, join in and replicate 
the process and document stuff themselves.

-Ryan
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000173.html">[Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3
</A></li>
	<LI>Next message: <A HREF="000188.html">[Owasp-modsecurity-core-rule-set] Review of CRS 2.0.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#174">[ date ]</a>
              <a href="thread.html#174">[ thread ]</a>
              <a href="subject.html#174">[ subject ]</a>
              <a href="author.html#174">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
