<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20log%20matched%20rules%20in%0A%09core%20ruleset%202.x&In-Reply-To=832535.59763.qm%40web50103.mail.re2.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000183.html">
   <LINK REL="Next"  HREF="000186.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20log%20matched%20rules%20in%0A%09core%20ruleset%202.x&In-Reply-To=832535.59763.qm%40web50103.mail.re2.yahoo.com"
       TITLE="[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x">ryan.barnett at breach.com
       </A><BR>
    <I>Mon Dec  7 08:47:26 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000183.html">[Owasp-modsecurity-core-rule-set] How to log matched rules in core	ruleset 2.x
</A></li>
        <LI>Next message: <A HREF="000186.html">[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#184">[ date ]</a>
              <a href="thread.html#184">[ thread ]</a>
              <a href="subject.html#184">[ subject ]</a>
              <a href="author.html#184">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Monday 07 December 2009 02:47:35 am Nham Xuan Nam wrote:
&gt;<i> Hi all,
</I>&gt;<i> 
</I>&gt;<i> We are currently using modsecuriy with core ruleset 1.6.1 and we want to
</I>&gt;<i>  upgrade our core ruleset to 2.x version. As I know, in this new version,
</I>&gt;<i>  core ruleset uses anomaly_score to detect attacks. When the anomaly_score
</I>&gt;<i>  is higher than a certain value, the request will be deny and the
</I>&gt;<i>  information is logged.
</I>&gt;<i> 
</I>&gt;<i> But in this way, the logged information did not show us information about
</I>&gt;<i>  the rules which are matched and contributed to the anomaly score
</I>&gt;<i>  (especially the rule id). This is a very useful information. Currently, we
</I>&gt;<i>  use this logs to do some statistics and other things. Do you know any way
</I>&gt;<i>  to log rule-id of the matched rules to the apache error_log?
</I>&gt;<i> 
</I>&gt;<i> Please help me. Thanks in advance.
</I>&gt;<i> 
</I>
If you want to see which rules matched and contributed to the anomaly score 
value, then you need to look at the audit log file.  All of the rules that 
matched will be present under Section H.  One of the goals of CRS v2 was to 
make the alerts less noisy.  Most people just wanted a correlated type of 
event which would tell them what happened.

You bring up a good point though and that is to include more meta-data within 
the correlated event.  Ivan Ristic brought up a similar issue last week in his 
CRS review email and this was that the correlated event msg data is only 
showing the *last* rule msg that triggered.  This is due to the current config 
where a rule match will overwrite the existing msg variable with the current 
one.  A better approach would be too *append* the msg data.  To your point - 
we could also do the same thing with the rule ids.  Basically, we could give 
more meta-data in the correlated event, such as the number of rules that 
matched and their associated rule ids and/or messages.

I will look into this.

-Ryan

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000183.html">[Owasp-modsecurity-core-rule-set] How to log matched rules in core	ruleset 2.x
</A></li>
	<LI>Next message: <A HREF="000186.html">[Owasp-modsecurity-core-rule-set] How to log matched rules in	core ruleset 2.x
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#184">[ date ]</a>
              <a href="thread.html#184">[ thread ]</a>
              <a href="subject.html#184">[ subject ]</a>
              <a href="author.html#184">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
