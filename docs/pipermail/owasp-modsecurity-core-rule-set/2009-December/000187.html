<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Theoretical%0A%20Bot-Infected%09Users%20and%20Legitimate%20Traffic&In-Reply-To=200912070908.51068.ryan.barnett%40breach.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000185.html">
   <LINK REL="Next"  HREF="000189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic</H1>
    <B>Brian Rectanus</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Theoretical%0A%20Bot-Infected%09Users%20and%20Legitimate%20Traffic&In-Reply-To=200912070908.51068.ryan.barnett%40breach.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic">Brian.Rectanus at breach.com
       </A><BR>
    <I>Mon Dec  7 12:27:21 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000185.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
</A></li>
        <LI>Next message: <A HREF="000189.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#187">[ date ]</a>
              <a href="thread.html#187">[ thread ]</a>
              <a href="subject.html#187">[ subject ]</a>
              <a href="author.html#187">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

Ryan Barnett wrote:
&gt;<i> On Sunday 06 December 2009 01:29:38 pm Charles Uchu Strader wrote:
</I>&gt;&gt;<i> Pretty new to mod_security...I've got a theoretical scenario question:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any thoughts or experience in discovering if a scenario like this can
</I>&gt;&gt;<i> cause valid site requests to be blocked?  My concern is related to high
</I>&gt;&gt;<i> traffic sites and the potential loss of valid traffic and business to
</I>&gt;&gt;<i> the site.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> My example would be an end-user of a web site, their browser/computer
</I>&gt;&gt;<i> has been infected by some malicious bot.  This bot inserts malicious
</I>&gt;&gt;<i> code into the legitimate web traffic of that user, in attempts to hack
</I>&gt;&gt;<i> the web sites the user is using, and thus proliferate the malicious code
</I>&gt;&gt;<i> more.
</I>&gt;&gt;<i>
</I>&gt;<i> Most bot/malware/mand-in-the-browser code that I have heard of works by 
</I>&gt;<i> sending their *own* requests mixed in with the user's legitimate ones.  This 
</I>&gt;<i> is very similar to CSRF from the web application's perspective 
</I>&gt;<i> (<A HREF="http://www.webappsec.org/lists/websecurity/archive/2007-09/msg00011.html">http://www.webappsec.org/lists/websecurity/archive/2007-09/msg00011.html</A>).  
</I>&gt;<i> This works since the browser will automatically submit the proper SessionID 
</I>&gt;<i> cookie data with the malware request.
</I>&gt;<i> 
</I>&gt;<i> This is different, however, then what I believe you proposing that that is that 
</I>&gt;<i> the bot is actually manipulating a legit request and adding in additional 
</I>&gt;<i> data, which I don't believe really happens in practice. 
</I>&gt;<i> 
</I>&gt;&gt;<i> The end-user, going about their normal routine of not keeping fully up
</I>&gt;&gt;<i> to date with anti-virus protection continues to go about their routine
</I>&gt;&gt;<i> without knowledge of their own infection.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a) They visit a site with mod_security in place and some of their
</I>&gt;&gt;<i> requests are blocked because of the inline bot.    The business
</I>&gt;&gt;<i> operating the site loses the traffic and legitimate business.  Customer
</I>&gt;&gt;<i> is left confused/frustrated.
</I>&gt;&gt;<i>
</I>&gt;<i> As I outlined above, I don't believe that most malware code works like this.  
</I>&gt;<i> I believe that the requests sent by the malware are separate requests and in 
</I>&gt;<i> this case ModSecurity would block those requests.
</I>&gt;<i> 
</I>&gt;&gt;<i> b) In a scenario without mod_security in place, but where the
</I>&gt;&gt;<i> application itself is hardened against the malicious attempts, the
</I>&gt;&gt;<i> request would be fulfilled as the malicious junk would be stripped from
</I>&gt;&gt;<i> the request.  The business operating the site gets related legitimate
</I>&gt;&gt;<i> traffic and customer is left happy...though still infected.
</I>&gt;&gt;<i>
</I>&gt;<i> The interesting point that I take away from this scenario is that of 
</I>&gt;<i> *sanitizing* of request data.  It has been asked many times before if 
</I>&gt;<i> ModSecurity can sanitize either inbound or outbound data and the answer is no.  
</I>&gt;<i> ModSecurity simply takes a copy of the transactional data and runs its checks 
</I>&gt;<i> against it and then a specific action can be applied.  There are some technical 
</I>&gt;<i> workarounds for possibly dabbling in this concept however the academic issue 
</I>&gt;<i> is that sanitizing of input is dangerous and tough to do correctly.  This type 
</I>&gt;<i> of activity should be done inside the app code.
</I>&gt;<i> 
</I>&gt;<i> An interesting topic that this does raise is letting a back-end web 
</I>&gt;<i> application know that we (the WAF) have identified some anomalous activity and 
</I>&gt;<i> that we think that this transaction might be malicious.  One concept that we 
</I>&gt;<i> look into further is for the WAF to add additional request headers to the 
</I>&gt;<i> inbound transaction (say WAF_Anomaly_Score=45) and this would allow the app 
</I>&gt;<i> server to possibly inspect this header data and then factor it into some 
</I>&gt;<i> decisions about processing/sanitizing the data.  This idea of data sharing has 
</I>&gt;<i> some merit.
</I>
I think that the basic scenario that you propose here is already
happening, but it has nothing to do with ModSecurity.  This is also a
reason that I think many larger sites just choose not to block (or at
least only block under extreme situations).

Consider this, though:

A user/customer is infected with spyware.  This spyware generally slows
things down and often makes the browser unstable (especially with more
than one type of spyware involved).  This spyware can insert ads/links
in pages, record data/login credentials, etc.  It can also attempt
(potentially harmful) requests on the users behalf.  But it can also
render the browser so unstable that a site can no longer be used
reliably.  Because of this, the site loses traffic and thus revenue.  In
addition to this, the site loses face with the customer as, from the
user's perspective, is the fault of the site, not theRyan Barnett
&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ryan.barnett at breach.com</A>&gt; browser/spyware.

You can see that you can have the same problems you described, but
without ModSecurity (or any other WAF).  But, there is more to your
scenerio.  With a WAF in place, the site administrator can see into some
of this foul play and hopefully do something about it.  There is nothing
that says that you have to block.  I also think Ryan is correct that by
adding a header or similar, this could add even more value, similar to
how email anti-spam/virus works today.

-B

-- 
Brian Rectanus
Breach Security
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000185.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
</A></li>
	<LI>Next message: <A HREF="000189.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#187">[ date ]</a>
              <a href="thread.html#187">[ thread ]</a>
              <a href="subject.html#187">[ subject ]</a>
              <a href="author.html#187">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
