<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Theoretical%20Bot-Infected%0A%09Users%20and%20Legitimate%20Traffic&In-Reply-To=4B1BF812.3000906%40gaiahost.coop">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000182.html">
   <LINK REL="Next"  HREF="000187.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Theoretical%20Bot-Infected%0A%09Users%20and%20Legitimate%20Traffic&In-Reply-To=4B1BF812.3000906%40gaiahost.coop"
       TITLE="[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic">ryan.barnett at breach.com
       </A><BR>
    <I>Mon Dec  7 09:08:51 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000182.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected Users	and Legitimate Traffic
</A></li>
        <LI>Next message: <A HREF="000187.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#185">[ date ]</a>
              <a href="thread.html#185">[ thread ]</a>
              <a href="subject.html#185">[ subject ]</a>
              <a href="author.html#185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sunday 06 December 2009 01:29:38 pm Charles Uchu Strader wrote:
&gt;<i> Pretty new to mod_security...I've got a theoretical scenario question:
</I>&gt;<i> 
</I>&gt;<i> Any thoughts or experience in discovering if a scenario like this can
</I>&gt;<i> cause valid site requests to be blocked?  My concern is related to high
</I>&gt;<i> traffic sites and the potential loss of valid traffic and business to
</I>&gt;<i> the site.
</I>&gt;<i> 
</I>&gt;<i> My example would be an end-user of a web site, their browser/computer
</I>&gt;<i> has been infected by some malicious bot.  This bot inserts malicious
</I>&gt;<i> code into the legitimate web traffic of that user, in attempts to hack
</I>&gt;<i> the web sites the user is using, and thus proliferate the malicious code
</I>&gt;<i> more.
</I>&gt;<i> 
</I>Most bot/malware/mand-in-the-browser code that I have heard of works by 
sending their *own* requests mixed in with the user's legitimate ones.  This 
is very similar to CSRF from the web application's perspective 
(<A HREF="http://www.webappsec.org/lists/websecurity/archive/2007-09/msg00011.html">http://www.webappsec.org/lists/websecurity/archive/2007-09/msg00011.html</A>).  
This works since the browser will automatically submit the proper SessionID 
cookie data with the malware request.

This is different, however, then what I believe you proposing that that is that 
the bot is actually manipulating a legit request and adding in additional 
data, which I don't believe really happens in practice. 

&gt;<i> The end-user, going about their normal routine of not keeping fully up
</I>&gt;<i> to date with anti-virus protection continues to go about their routine
</I>&gt;<i> without knowledge of their own infection.
</I>&gt;<i> 
</I>&gt;<i> a) They visit a site with mod_security in place and some of their
</I>&gt;<i> requests are blocked because of the inline bot.    The business
</I>&gt;<i> operating the site loses the traffic and legitimate business.  Customer
</I>&gt;<i> is left confused/frustrated.
</I>&gt;<i> 
</I>As I outlined above, I don't believe that most malware code works like this.  
I believe that the requests sent by the malware are separate requests and in 
this case ModSecurity would block those requests.

&gt;<i> b) In a scenario without mod_security in place, but where the
</I>&gt;<i> application itself is hardened against the malicious attempts, the
</I>&gt;<i> request would be fulfilled as the malicious junk would be stripped from
</I>&gt;<i> the request.  The business operating the site gets related legitimate
</I>&gt;<i> traffic and customer is left happy...though still infected.
</I>&gt;<i> 
</I>The interesting point that I take away from this scenario is that of 
*sanitizing* of request data.  It has been asked many times before if 
ModSecurity can sanitize either inbound or outbound data and the answer is no.  
ModSecurity simply takes a copy of the transactional data and runs its checks 
against it and then a specific action can be applied.  There are some technical 
workarounds for possibly dabbling in this concept however the academic issue 
is that sanitizing of input is dangerous and tough to do correctly.  This type 
of activity should be done inside the app code.

An interesting topic that this does raise is letting a back-end web 
application know that we (the WAF) have identified some anomalous activity and 
that we think that this transaction might be malicious.  One concept that we 
look into further is for the WAF to add additional request headers to the 
inbound transaction (say WAF_Anomaly_Score=45) and this would allow the app 
server to possibly inspect this header data and then factor it into some 
decisions about processing/sanitizing the data.  This idea of data sharing has 
some merit.

-Ryan

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000182.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected Users	and Legitimate Traffic
</A></li>
	<LI>Next message: <A HREF="000187.html">[Owasp-modsecurity-core-rule-set] Theoretical Bot-Infected	Users and Legitimate Traffic
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#185">[ date ]</a>
              <a href="thread.html#185">[ thread ]</a>
              <a href="subject.html#185">[ subject ]</a>
              <a href="author.html#185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
