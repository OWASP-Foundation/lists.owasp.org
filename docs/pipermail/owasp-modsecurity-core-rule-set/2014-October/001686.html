<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Require%20Mod_Security%20rule%20for%0A%20preventing%20random%20query%20sting%20DOS%20attacks&In-Reply-To=%3C53CDA9CCB03E0846B68EEA5D8E40FB7FDAA7C917%40DOHQDQMX03.qr.qrgrp.local%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001685.html">
   <LINK REL="Next"  HREF="001688.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks</H1>
    <B>Chaitanya Kumar Tummalapalli</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Require%20Mod_Security%20rule%20for%0A%20preventing%20random%20query%20sting%20DOS%20attacks&In-Reply-To=%3C53CDA9CCB03E0846B68EEA5D8E40FB7FDAA7C917%40DOHQDQMX03.qr.qrgrp.local%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks">ctummalapalli at qatarairways.com.qa
       </A><BR>
    <I>Wed Oct 29 09:19:19 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001685.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
        <LI>Next message: <A HREF="001688.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1686">[ date ]</a>
              <a href="thread.html#1686">[ thread ]</a>
              <a href="subject.html#1686">[ subject ]</a>
              <a href="author.html#1686">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Ryan,

Thanks a lot for your reply.

I tried using the rule .. I have place these three lines in modsecurity_crs_10_config.conf without execute action.

But no luck, Rule is not dropping requests like index.html?~5678788.

I'm novice to mod_security hence not conversant to tweak the rule.

Chaitanya Kumar Tummalapalli
TS Controller
I n f o r m a t i o n  T e c h n o l o g y
M :  ( + 9 7 4 )  3 3 6 9 - 0915  | P :  ( + 9 7 4 )  4022 - 7486 | (<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&gt;)

W o r l d ' s  5 - s t a r  a i r l i n e  | www.  q a t a r a i r w a y s . c o m

From: Ryan Barnett [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>]
Sent: 28 October 2014 9:04 PM
To: Chaitanya Kumar Tummalapalli; Joerg Stephan
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: Re: [Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks

You could write up some ModSecurity rules that would check for these types of request anomalies and block.  Try these (untested) -

SecRule &amp;ARGS_GET_NAMES &quot;@eq 1&quot; &quot;chain,phase:1,t:none,drop,msg:'Botnet DDoS Attack Detected'&quot;
SecRule ARGS_GET &quot;@rx ^$&quot; &quot;chain&quot;
SecRule ARGS_GET_NAMES &quot;@rx ^\-?\d{8,10}$&quot; &quot;exec:/path/to/blacklist.sh&quot;

Not the last line has an execute action where you can do things much like Fail2Ban where you can have a shell script that will talk to a local/remote Firewall device and dynamically update the ACLs to blacklist the client IP address.

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;

From: Chaitanya Kumar Tummalapalli &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&gt;&gt;
Date: Tuesday, October 28, 2014 10:00 AM
To: Joerg Stephan &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">joerg.stephan at owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">joerg.stephan at owasp.org</A>&gt;&gt;
Cc: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks

Hello Joerg,

Thanks for your reply.

In our analysis of access logs the attacker has used 436 IP's (botnets) to generate this 1.2 million requests with random number queries. Within 20 minutes time.

So on an average we have got 2750 requests from one single IP.

Our web site which was under attack  has maximum of 45 valid known query strings and beyond them can be treated as spurious like below

122.226.28.22, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?953341233 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.47 Safari/536.11&quot;
120.28.113.179, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?2110115717 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5&quot;
93.183.239.56, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-404454353 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 5.1; rv:5.0.1) Gecko/20100101 Firefox/5.0.1&quot;
221.178.236.122, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-304549227 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; rv:12.0) Gecko/20100101 Firefox/12.0&quot;
117.25.192.227, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-1186515202 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:13.0) Gecko/20100101 Firefox/13.0.1&quot;
60.174.55.148, 23.212.108.70, 2.18.243.13 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-16740259 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)&quot;
218.63.78.48, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-441220308 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5&quot;
183.63.45.186, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-1330852491 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:12.0) Gecko/20100101 Firefox/12.0&quot;
213.148.184.156, 23.212.108.63, 2.18.243.13 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-1092903431 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.47 Safari/536.11&quot;
61.133.234.21, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?-1925985494 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; rv:5.0) Gecko/20100101 Firefox/5.02&quot;
125.74.189.77, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET /index.html?1261388031 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1) ; .NET CLR 3.5.30729)&quot;

Vaild query string will look like this

82.79.99.142, 81.196.26.231, 80.239.171.212 - - [28/Oct/2014:16:56:01 +0300] &quot;GET /index.html?q=ro/en HTTP/1.1&quot; 200


So can we think of a rule which drops the requests like /index.html?953341233 this. Or if it can be achieved by mod_evasive . Sorry I'm new to mod_evasive. Could you please elaborate on how to use it.



Chaitanya Kumar Tummalapalli
TS Controller
I n f o r m a t i o n  T e c h n o l o g y
M :  ( + 9 7 4 )  3 3 6 9 - 0915  | P :  ( + 9 7 4 )  4022 - 7486 | (<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&gt;)

W o r l d ' s  5 - s t a r  a i r l i n e  | www.  q a t a r a i r w a y s . c o m

From: Joerg Stephan [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">joerg.stephan at owasp.org</A>]
Sent: 28 October 2014 4:34 PM
To: Chaitanya Kumar Tummalapalli
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks

Good $localtime,

how many queries have been done by a single ip address?

In my opinion, when it comes to HTTP flooding we will have a problem adjusting the rules, cause it will be hard to determine if it is a valid request or not. In such cases i would prefer using mod_evasive or fail2ban.

Just my 2 cents

Kind regards

Joerg

On Tue, Oct 28, 2014 at 11:59 AM, Chaitanya Kumar Tummalapalli &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&gt;&gt; wrote:
Hello,

We faced a DDOS Attack on our web site very recently. The nature of attack is a HTTP Flood Attack which raised our bandwidth utilization form 2MBPS to 20 MBPS

We have CDN edge caching servers for content delivery to the end user.

There are around 1.2 Million requests made to the apache web server in 20 minutes with one specific pattern.

For ex: <A HREF="http://www.abc.com/index.html?~77462375&lt;http://scanmail.trustwave.com/?c=4062&amp;d=xafP1ApK3TjrTN55NhvDV4qVJLnpvYD91J3j6tHRzQ&amp;s=5&amp;u=http%3a%2f%2fwww%2eabc%2ecom%2findex%2ehtml%3f%7e77462375">http://www.abc.com/index.html?~77462375&lt;http://scanmail.trustwave.com/?c=4062&amp;d=xafP1ApK3TjrTN55NhvDV4qVJLnpvYD91J3j6tHRzQ&amp;s=5&amp;u=http%3a%2f%2fwww%2eabc%2ecom%2findex%2ehtml%3f%7e77462375</A>&gt;

Request appended with query string with random sequence number.  The Website usually responds with default page for every such request.

But within no time the web servers resources got exhausted and was unable to respond. Leading to total downtime.

I have attached a white paper which describes about similar attacks which we have undergone.

We need a rule from mod_security crs which can defend the attack and drop such kind of requests.

Regards,
Chaitanya

Qatar Airways - Proud member of the oneworld alliance.

[Image removed by sender. OW LOGO]

Disclaimer:- This message (including attachments) is intended solely for the addressee named above. It may be confidential, privileged, subject to copyright, trade secret, or other legal rules and may not be forwarded without the author's permission. If you are not the addressee you must not read, copy or disseminate this message. If you have received it in error please notify the sender immediately and delete the message from all storage devices. Any opinions expressed in this message do not necessarily represent the official positions of Qatar Airways. Any agreements (including any warranties, representations, or offers) concluded with Qatar Airways by using electronic correspondence shall only come into existence if an authorized representative of Qatar Airways has explicitly approved such contract formation. To the fullest extent permissible by law, Qatar Airways disclaim all liability for loss or damage to person or property arising from this message being infected by computer virus or other contamination.

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;http://scanmail.trustwave.com/?c=4062&amp;d=xafP1ApK3TjrTN55NhvDV4qVJLnpvYD91Jjk69KExw&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;http://scanmail.trustwave.com/?c=4062&amp;d=xafP1ApK3TjrTN55NhvDV4qVJLnpvYD91Jjk69KExw&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set</A>&gt;


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141029/64eeac62/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141029/64eeac62/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image001.jpg
Type: image/jpeg
Size: 823 bytes
Desc: image001.jpg
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141029/64eeac62/attachment-0001.jpg">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141029/64eeac62/attachment-0001.jpg</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001685.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
	<LI>Next message: <A HREF="001688.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1686">[ date ]</a>
              <a href="thread.html#1686">[ thread ]</a>
              <a href="subject.html#1686">[ subject ]</a>
              <a href="author.html#1686">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
