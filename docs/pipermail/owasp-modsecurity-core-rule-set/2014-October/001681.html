<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Require%20Mod_Security%20rule%20for%0A%20preventing%20random%20query%20sting%20DOS%20attacks&In-Reply-To=%3CCAANsTqh242uWV70xPL2ou4thqTKrzt%2B-kUDgYDWWpCmppy9HHA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001682.html">
   <LINK REL="Next"  HREF="001685.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks</H1>
    <B>Joerg Stephan</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Require%20Mod_Security%20rule%20for%0A%20preventing%20random%20query%20sting%20DOS%20attacks&In-Reply-To=%3CCAANsTqh242uWV70xPL2ou4thqTKrzt%2B-kUDgYDWWpCmppy9HHA%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks">joerg.stephan at owasp.org
       </A><BR>
    <I>Tue Oct 28 14:14:19 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001682.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
        <LI>Next message: <A HREF="001685.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi again,

okay, so definitely mod_evasive or fail2ban would have solved the problem,
as there should be more than 2400 requests by each single IP addresses.
Evasive can handle this.

On the other hand, it should not be a lot of magic to right a rule to drop
all traffic which does not fit your naming style, but is this would sole
your problem only, i guess we should not code it into the core rules, as
style is different from user to user.

Maybe you can also think about a string-match rule inside of iptables. The
20MBit traffic would hit your apache system anyway, even it it is only the
modules.

I would say, place a Nginx proxy in front of it, enable fail2ban on the
proxy server an you will be much safer than now. Also strange in my mind,
1.2 Mio requests in 20 minuits are only 1000 a second. Maybe you should
rethink your design also. As a important website you should have load
balanced you webservers, and so at least 3 of the webservers should handle
much more than 500 requests each.
I have build nginx webforwarders (php based redirecting logic) which
currently handle 1000 requests per second each. in peak time.

Cheers

On Tue, Oct 28, 2014 at 3:00 PM, Chaitanya Kumar Tummalapalli &lt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&gt; wrote:

&gt;<i>  Hello Joerg,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your reply.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In our analysis of access logs the attacker has used 436 IP&#8217;s (botnets) to
</I>&gt;<i> generate this 1.2 million requests with random number queries. Within 20
</I>&gt;<i> minutes time.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So on an average we have got 2750 requests from one single IP.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Our web site which was under attack  has maximum of 45 valid known query
</I>&gt;<i> strings and beyond them can be treated as spurious like below
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 122.226.28.22, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?953341233 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1;
</I>&gt;<i> WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.47
</I>&gt;<i> Safari/536.11&quot;
</I>&gt;<i>
</I>&gt;<i> 120.28.113.179, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?2110115717 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh;
</I>&gt;<i> Intel Mac OS X 10_6_8) AppleWebKit/536.5 (KHTML, like Gecko)
</I>&gt;<i> Chrome/19.0.1084.56 Safari/536.5&quot;
</I>&gt;<i>
</I>&gt;<i> 93.183.239.56, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?-404454353 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 5.1;
</I>&gt;<i> rv:5.0.1) Gecko/20100101 Firefox/5.0.1&quot;
</I>&gt;<i>
</I>&gt;<i> 221.178.236.122, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?-304549227 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1;
</I>&gt;<i> rv:12.0) Gecko/20100101 Firefox/12.0&quot;
</I>&gt;<i>
</I>&gt;<i> 117.25.192.227, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?-1186515202 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh;
</I>&gt;<i> Intel Mac OS X 10.6; rv:13.0) Gecko/20100101 Firefox/13.0.1&quot;
</I>&gt;<i>
</I>&gt;<i> 60.174.55.148, 23.212.108.70, 2.18.243.13 - - [21/Oct/2014:10:00:26 +0300]
</I>&gt;<i> &quot;GET /index.html?-16740259 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/4.0 (compatible;
</I>&gt;<i> MSIE 6.0; Windows NT 5.1; SV1)&quot;
</I>&gt;<i>
</I>&gt;<i> 218.63.78.48, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?-441220308 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1)
</I>&gt;<i> AppleWebKit/536.5 (KHTML, like Gecko) Chrome/19.0.1084.56 Safari/536.5&quot;
</I>&gt;<i>
</I>&gt;<i> 183.63.45.186, 23.212.108.73 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?-1330852491 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT
</I>&gt;<i> 6.1; WOW64; rv:12.0) Gecko/20100101 Firefox/12.0&quot;
</I>&gt;<i>
</I>&gt;<i> 213.148.184.156, 23.212.108.63, 2.18.243.13 - - [21/Oct/2014:10:00:26
</I>&gt;<i> +0300] &quot;GET /index.html?-1092903431 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0
</I>&gt;<i> (Windows NT 6.1) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.47
</I>&gt;<i> Safari/536.11&quot;
</I>&gt;<i>
</I>&gt;<i> 61.133.234.21, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?-1925985494 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT
</I>&gt;<i> 6.1; rv:5.0) Gecko/20100101 Firefox/5.02&quot;
</I>&gt;<i>
</I>&gt;<i> 125.74.189.77, 23.212.108.67 - - [21/Oct/2014:10:00:26 +0300] &quot;GET
</I>&gt;<i> /index.html?1261388031 HTTP/1.1&quot; 200 2797 &quot;-&quot; &quot;Mozilla/4.0 (compatible;
</I>&gt;<i> MSIE 8.0; Windows NT 6.0; Trident/4.0; Mozilla/4.0 (compatible; MSIE 6.0;
</I>&gt;<i> Windows NT 5.1; SV1) ; .NET CLR 3.5.30729)&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Vaild query string will look like this
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 82.79.99.142, 81.196.26.231, 80.239.171.212 - - [28/Oct/2014:16:56:01
</I>&gt;<i> +0300] &quot;GET /index.*html?q=ro/en* HTTP/1.1&quot; 200
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So can we think of a rule which drops the requests like
</I>&gt;<i> /index.html?953341233 this. Or if it can be achieved by mod_evasive . Sorry
</I>&gt;<i> I&#8217;m new to mod_evasive. Could you please elaborate on how to use it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *Chaitanya Kumar Tummalapalli*
</I>&gt;<i>
</I>&gt;<i> TS Controller
</I>&gt;<i>
</I>&gt;<i> I n f o r m a t i o n  T e c h n o l o g y
</I>&gt;<i>
</I>&gt;<i> M :  ( + 9 7 4 )  3 3 6 9 - 0915  | P :  ( + 9 7 4 )  4022 - 7486 | (
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> W o r l d ' s  5 - s t a r  a i r l i n e  | *www*.  *q a t a r a i r w a
</I>&gt;<i> y s . c o m*
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Joerg Stephan [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">joerg.stephan at owasp.org</A>]
</I>&gt;<i> *Sent:* 28 October 2014 4:34 PM
</I>&gt;<i> *To:* Chaitanya Kumar Tummalapalli
</I>&gt;<i> *Cc:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Require Mod_Security
</I>&gt;<i> rule for preventing random query sting DOS attacks
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Good $localtime,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> how many queries have been done by a single ip address?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In my opinion, when it comes to HTTP flooding we will have a problem
</I>&gt;<i> adjusting the rules, cause it will be hard to determine if it is a valid
</I>&gt;<i> request or not. In such cases i would prefer using mod_evasive or fail2ban.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just my 2 cents
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Kind regards
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Joerg
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Oct 28, 2014 at 11:59 AM, Chaitanya Kumar Tummalapalli &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ctummalapalli at qatarairways.com.qa</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We faced a DDOS Attack on our web site very recently. The nature of attack
</I>&gt;<i> is a HTTP Flood Attack which raised our bandwidth utilization form 2MBPS to
</I>&gt;<i> 20 MBPS
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We have CDN edge caching servers for content delivery to the end user.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> There are around 1.2 Million requests made to the apache web server in 20
</I>&gt;<i> minutes with one specific pattern.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> For ex: <A HREF="http://www.abc.com/index.html?~77462375">http://www.abc.com/index.html?~77462375</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Request appended with query string with random sequence number.  The
</I>&gt;<i> Website usually responds with default page for every such request.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> But within no time the web servers resources got exhausted and was unable
</I>&gt;<i> to respond. Leading to total downtime.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I have attached a white paper which describes about similar attacks which
</I>&gt;<i> we have undergone.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We need a rule from mod_security crs which can defend the attack and drop
</I>&gt;<i> such kind of requests.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *Regards,*
</I>&gt;<i>
</I>&gt;<i> *Chaitanya*
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Qatar Airways - Proud member of the *one*world alliance.
</I>&gt;<i>
</I>&gt;<i> *[image: Image removed by sender. OW LOGO]*
</I>&gt;<i>
</I>&gt;<i> Disclaimer:- This message (including attachments) is intended solely for
</I>&gt;<i> the addressee named above. It may be confidential, privileged, subject to
</I>&gt;<i> copyright, trade secret, or other legal rules and may not be forwarded
</I>&gt;<i> without the author's permission. If you are not the addressee you must not
</I>&gt;<i> read, copy or disseminate this message. If you have received it in error
</I>&gt;<i> please notify the sender immediately and delete the message from all
</I>&gt;<i> storage devices. Any opinions expressed in this message do not necessarily
</I>&gt;<i> represent the official positions of Qatar Airways. Any agreements
</I>&gt;<i> (including any warranties, representations, or offers) concluded with Qatar
</I>&gt;<i> Airways by using electronic correspondence shall only come into existence
</I>&gt;<i> if an authorized representative of Qatar Airways has explicitly approved
</I>&gt;<i> such contract formation. To the fullest extent permissible by law, Qatar
</I>&gt;<i> Airways disclaim all liability for loss or damage to person or property
</I>&gt;<i> arising from this message being infected by computer virus or other
</I>&gt;<i> contamination.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141028/ad6d43d0/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141028/ad6d43d0/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ~WRD000.jpg
Type: image/jpeg
Size: 823 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141028/ad6d43d0/attachment-0001.jpg">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141028/ad6d43d0/attachment-0001.jpg</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001682.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
	<LI>Next message: <A HREF="001685.html">[Owasp-modsecurity-core-rule-set] Require Mod_Security rule for preventing random query sting DOS attacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1681">[ date ]</a>
              <a href="thread.html#1681">[ thread ]</a>
              <a href="subject.html#1681">[ subject ]</a>
              <a href="author.html#1681">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
