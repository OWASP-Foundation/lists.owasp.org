<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20CRS3-RC1%20not%20working%20on%0A%09Apache%202.2&In-Reply-To=%3Calpine.LSU.2.20.1608211233180.7430%40schiller.dip.t-dialin.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002204.html">
   <LINK REL="Next"  HREF="002209.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2</H1>
    <B>Jens Schleusener</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20CRS3-RC1%20not%20working%20on%0A%09Apache%202.2&In-Reply-To=%3Calpine.LSU.2.20.1608211233180.7430%40schiller.dip.t-dialin.net%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2">Jens.Schleusener at t-online.de
       </A><BR>
    <I>Sun Aug 21 10:48:32 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002204.html">[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on Apache 2.2
</A></li>
        <LI>Next message: <A HREF="002209.html">[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2207">[ date ]</a>
              <a href="thread.html#2207">[ thread ]</a>
              <a href="subject.html#2207">[ subject ]</a>
              <a href="author.html#2207">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Christian,

&gt;<i> We had the first major bug report for CRS3-RC1 today.
</I>&gt;<i> <A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/542">https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/542</A>
</I>&gt;<i>
</I>&gt;<i> The maximum line length of Apache 2.2 is too short for two of the
</I>&gt;<i> new Remote Command Execution rules which come in at over 10K bytes.
</I>&gt;<i>
</I>&gt;<i> Expect a fix on github in the next few days; certainly for RC2.
</I>&gt;<i>
</I>&gt;<i> Meanwhile Apache 2.4 is doing great and github user @emphazer who
</I>&gt;<i> discovered this bug reports of over 100 production machines running
</I>&gt;<i> CRS3-RC1.
</I>&gt;<i>
</I>&gt;<i> But the list here has remained silent over the release. I see several
</I>&gt;<i> possible reasons:
</I>&gt;<i> - Nobody gives a shit
</I>&gt;<i> - It fails so miserably on your server you removed it immediately and
</I>&gt;<i>  you do not want to talk about CRS anymore
</I>&gt;<i> - It worked like a charm without any false positives, so you forgot
</I>&gt;<i>  about its existence instantly.
</I>&gt;<i>
</I>&gt;<i> Either way, some feedback would be nice. This is an opensource project.
</I>&gt;<i> Chaim and Walter worked day and night for this, and if not even the
</I>&gt;<i> project mailinglist has some positive or negative feedback, then I
</I>&gt;<i> wonder why anybody is doing this at all.
</I>
One reason for the &quot;silence&quot; may be also the very laborious log file 
analysis.

But to get just a first impression I found your script aliases collection at

  <A HREF="https://github.com/Apache-Labor/labor/blob/master/bin/.apache-modsec.alias">https://github.com/Apache-Labor/labor/blob/master/bin/.apache-modsec.alias</A>

very useful.

On the server that I manage (httpd 2.4.23, modsecurity 2.9.1) CRS3-RC1 is 
now for nearly a month in use and it works very well (big thanks to the 
CRS3 team!). Although the server may be not &quot;typical&quot; since it uses itself 
neither PHP nor SQL but offers amongst others soure code browsing of FOSS 
software that contains for e.g. PHP, SQL and HTML files here an example 
output for 5 days (with roughly 200.000 page requests in total) using the 
script alias &quot;melidmsg&quot; (entries fom some special self-written rules are 
removed):

cat modsec_audit.log.16081[5-9] | melidmsg | sort | uniq -c | sort -nr

     347 921140 HTTP Header Injection Attack via headers
     308 910000 Request from Known Malicious Client
                (Based on previous traffic violations).
     186 920350 Host header is a numeric IP address
     105 932130 Remote Command Execution: Unix Shell Expression Found
      73 920210 Multiple/Conflicting Connection Header Data Found.
      59 920430 HTTP protocol version is not allowed by policy
      50 920220 URL Encoding Abuse Attack Attempt
      48 930110 Path Traversal Attack (/../)
      43 911100 Method is not allowed by policy
      37 942100 SQL Injection Attack Detected via libinjection
      30 941130 XSS Filter - Category 3: Attribute Vector
      22 920170 GET or HEAD Request with Body Content.
      12 920330 Empty User Agent Header
       9 920280 Request Missing a Host Header
       8 933160 PHP Injection Attack: High-Risk PHP Function Call Found
       8 913100 Found User-Agent associated with security scanner
       5 933100 PHP Injection Attack: Opening/Closing Tag Found
       1 942140 SQL Injection Attack: Common DB Names Detected
       1 941120 XSS Filter - Category 2: Event Handler Vector
       1 941100 XSS Attack Detected via libinjection
       1 933130 PHP Injection Attack: Variables Found
       1 932100 Remote Command Execution: Unix Command Injection
       1 930100 Path Traversal Attack (/../)
       1 920180 POST request missing Content-Length Header.
       1 913110 Found request header associated with security scanner

The rules 920300, 920310, 920320, 920440 and 933150 are deactivated and 
the variable tx.inbound_anomaly_score_threshold was increased to 6 
(default 5) to avoid some FPs (sometimes probably caused just by a &quot;long&quot; 
Google Referer string?). The so CRS3-unmatched bad requests are hopefully 
already matched by other specific Apache configuration rules (using the 
mod_rewrite module) that are implemented on that server.

The rule 920210 (&quot;Multiple/Conflicting Connection Header Data Found&quot;) in 
some cases seems to cause FPs (especially for the User-Agent 
&quot;Go-http-client/1.1&quot; that sends erroneously a &quot;Connection: close, close&quot; 
HTTP header).

Regards

Jens
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002204.html">[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on Apache 2.2
</A></li>
	<LI>Next message: <A HREF="002209.html">[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2207">[ date ]</a>
              <a href="thread.html#2207">[ thread ]</a>
              <a href="subject.html#2207">[ subject ]</a>
              <a href="author.html#2207">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
