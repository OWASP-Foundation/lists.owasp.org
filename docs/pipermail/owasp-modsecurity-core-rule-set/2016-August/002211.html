<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20CRS3-RC1%20not%20working%20on%0A%09Apache%202.2&In-Reply-To=%3C20160822104616.GA14936%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002210.html">
   <LINK REL="Next"  HREF="002201.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20CRS3-RC1%20not%20working%20on%0A%09Apache%202.2&In-Reply-To=%3C20160822104616.GA14936%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2">christian.folini at netnea.com
       </A><BR>
    <I>Mon Aug 22 10:46:16 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002210.html">[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2
</A></li>
        <LI>Next message: <A HREF="002201.html">[Owasp-modsecurity-core-rule-set] Initial report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2211">[ date ]</a>
              <a href="thread.html#2211">[ thread ]</a>
              <a href="subject.html#2211">[ subject ]</a>
              <a href="author.html#2211">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

On Mon, Aug 22, 2016 at 11:39:59AM +0200, Jens Schleusener wrote:
&gt;<i> As said that is very laborious if there hundred of entries. Often
</I>&gt;<i> one had to analyze additionally the big Apache access log to find
</I>&gt;<i> out the further behaviour of an suspicious IP and classify the
</I>&gt;<i> according requests as &quot;good&quot; or &quot;bad&quot;.
</I>
Yep. That's the problem exactly.

&gt;<i> Helpful would be a general program or script that can grep blocks of
</I>&gt;<i> lines given a main target pattern and two further patterns
</I>&gt;<i> specifying the begin and the end of the block. I just write a very
</I>&gt;<i> primitive one that allows for e.g. via
</I>&gt;<i> 
</I>&gt;<i>  grep_blocks_by_sed -p 'id &quot;921140&quot;' \
</I>&gt;<i>    -b '^--[0-9a-f]*-A--' -e '^--[0-9a-f]*-Z--' modsec_audit.log
</I>
You may want to look into csplit.

Personally, I hardly work with the auditlog. I concentrate on the
errorlog where I fetch ruleid, IPs and unique-ids. I grep for the IP
and the unique id in the access-log and display sessions with the
al-group of aliases in my alias-collection. Usually
altimestatusmethodpath.

Example:

$&gt; grep 941160 error.log | melip | while read IP; do \
   echo &quot;*** $IP ****&quot;; \
   grep $IP folinic.access-not-null | altimestatusmethodpath ; done 

...
*** 000.000.33.201 ****
[2016-08-15 09:20:26.666687] 302 POST /de/node/35876/edit
[2016-08-15 09:21:13.160125] 200 POST /de/system/ajax
[2016-08-15 09:21:19.746708] 302 POST /de/node/35876/edit/de
[2016-08-15 09:23:00.658298] 200 POST /de/system/ajax
[2016-08-15 09:23:07.598479] 302 POST /de/node/35876/edit/fr
[2016-08-15 09:23:52.093165] 200 POST /de/system/ajax
[2016-08-15 09:23:58.916953] 302 POST /de/node/35876/edit/it
[2016-08-15 09:24:54.378965] 200 POST /de/system/ajax
[2016-08-15 09:25:00.475736] 302 POST /de/node/35876/edit/en-gb
[2016-08-15 12:26:26.784170] 200 POST /de/plupload-handle-uploads?...
[2016-08-15 12:26:28.898396] 200 GET /de/admin/content/file/...
[2016-08-15 12:27:28.803916] 200 POST /de/media/ajax/field_header_...
[2016-08-15 12:27:35.067760] 302 POST /de/node/36269/edit
[2016-08-15 12:27:51.742488] 200 POST /de/media/ajax/field_header_...
...

That's a fairly coarse approach. But this example would give me a
overview what the sessions involving violations of 941160 are up to.
If I browse over the various IPs, I get a feeling for the application
and what seems to be standard behaviour and what not.

However, the reasonable approach is of course to look for false
positives in traffic where you _know_ there is not attack traffic
interwoven and every alert guaranteed to be a false positive. 
That approach does not quite work out in the real world a lot of the 
time, though.

If you find stuff where you are sure it is a false positive, then please
open github issues. Especially in the default install with paranoia
level 1. In the higher paranoia levels you should anticipate more and
more false positives.

Ahoj,

Christian


-- 
A great swindle of our time is the assumption that science has made
religion obsolete. All science has damaged is the story of Adam and Eve
and the story of Jonah and the Whale.
-- Kurt Vonnegut
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002210.html">[Owasp-modsecurity-core-rule-set] CRS3-RC1 not working on	Apache 2.2
</A></li>
	<LI>Next message: <A HREF="002201.html">[Owasp-modsecurity-core-rule-set] Initial report
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2211">[ date ]</a>
              <a href="thread.html#2211">[ thread ]</a>
              <a href="subject.html#2211">[ subject ]</a>
              <a href="author.html#2211">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
