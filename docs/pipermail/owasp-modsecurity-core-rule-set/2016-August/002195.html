<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] OWASP_CRS/WEB_ATTACK/SQL_INJECTION id 981247 regex not matching properly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%0A%20OWASP_CRS/WEB_ATTACK/SQL_INJECTION%20id%20981247%20regex%20not%20matching%20properly&In-Reply-To=%3C20160812202310.GA22297%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002194.html">
   <LINK REL="Next"  HREF="002196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] OWASP_CRS/WEB_ATTACK/SQL_INJECTION id 981247 regex not matching properly</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%0A%20OWASP_CRS/WEB_ATTACK/SQL_INJECTION%20id%20981247%20regex%20not%20matching%20properly&In-Reply-To=%3C20160812202310.GA22297%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] OWASP_CRS/WEB_ATTACK/SQL_INJECTION id 981247 regex not matching properly">christian.folini at netnea.com
       </A><BR>
    <I>Fri Aug 12 20:23:10 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002194.html">[Owasp-modsecurity-core-rule-set]	OWASP_CRS/WEB_ATTACK/SQL_INJECTION id 981247 regex not	matching properly
</A></li>
        <LI>Next message: <A HREF="002196.html">[Owasp-modsecurity-core-rule-set] false positives by wrong URL	Decoding ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2195">[ date ]</a>
              <a href="thread.html#2195">[ thread ]</a>
              <a href="subject.html#2195">[ subject ]</a>
              <a href="author.html#2195">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Jay,

Thank you for your report. This is an interesting case.

Your rule 981247 is mapped to 942360 in the upcoming CRS 3.0 release.
And despite being updated slightly, the rule triggers on your request.

It's quite a crazy request, I dare say. The issue is of course the
parameter

term=Happy%20Valley%20[DVD%20videorecording]%20/%20a%20Red%20Productions%20Production%20for%20BBC%20;%20written%20&amp;%20created%20by%20Sally%20Wainwright%20;%20producer,%20Karen%20Lewis%20;%20directed%20by%20Sally%20Wainwright,%20Euros%20Lyn,%20Tim%20Fywell.

That is

term=Happy Valley [DVD videorecording] / a Red Productions Production for BBC
; written &amp; created by Sally Wainwright ; producer, Karen Lewis ;
directed by Sally Wainwright, Euros Lyn, Tim Fywell.

As you can see, there is a &amp; in that parameter. Apache splits up the
argument. Outside of term, there is thus an argument named:
 created by Sally Wainwright...

Note the initial space.

This is obviously dynamic content and your client would be well-advised
to encode the ampersand as well.

The regex attempts to discover
create
and
created

I think this is correct and I do not think the regex should be altered.
I understand you do not want to disable the rule altogether. So here is
a proposal:

Why don't you disable the rule for all ARGS_NAMES starting with
a space character? Regex selection of ARGS names allows for this.
That way you are safe the next time somebody enters a term like this.
(As long as they accompany the ampersand with a space character.)

Hope this helps,

Christian


-- 
Productivity is less about time management than it is about 
mind management.
-- David Kadavy
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002194.html">[Owasp-modsecurity-core-rule-set]	OWASP_CRS/WEB_ATTACK/SQL_INJECTION id 981247 regex not	matching properly
</A></li>
	<LI>Next message: <A HREF="002196.html">[Owasp-modsecurity-core-rule-set] false positives by wrong URL	Decoding ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2195">[ date ]</a>
              <a href="thread.html#2195">[ thread ]</a>
              <a href="subject.html#2195">[ subject ]</a>
              <a href="author.html#2195">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
