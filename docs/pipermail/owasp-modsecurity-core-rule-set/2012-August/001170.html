<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Fail to create negative rule
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Fail%20to%20create%20negative%20rule&In-Reply-To=%3CCAG%2B8EEbGAXtcVEuC4h_iZYKeunJDBV0_v7iRH3nCQzxCDwnx6A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001168.html">
   <LINK REL="Next"  HREF="001171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Fail to create negative rule</H1>
    <B>Leonardo Bacha Abrantes</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Fail%20to%20create%20negative%20rule&In-Reply-To=%3CCAG%2B8EEbGAXtcVEuC4h_iZYKeunJDBV0_v7iRH3nCQzxCDwnx6A%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Fail to create negative rule">leonardo at lbasolutions.com
       </A><BR>
    <I>Fri Aug 24 17:12:41 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001168.html">[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
</A></li>
        <LI>Next message: <A HREF="001171.html">[Owasp-modsecurity-core-rule-set] Fail to create negative rule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1170">[ date ]</a>
              <a href="thread.html#1170">[ thread ]</a>
              <a href="subject.html#1170">[ subject ]</a>
              <a href="author.html#1170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey people, good afternoon!

I'm trying to Add a new negative policy rule (
<A HREF="http://www.modsecurity.org/blog/archives/2007/02/handling_false.html">http://www.modsecurity.org/blog/archives/2007/02/handling_false.html</A>),
because am facing false positve with the rule 970901.

*## log

*[Fri Aug 24 13:44:57 2012] [error] [client 192.168.21.10] ModSecurity:
Rule 2d8f030 [id &quot;950901&quot;][file
&quot;/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;][line
&quot;77&quot;] - Execution error - PCRE limits exceeded (-8): (null). [hostname
&quot;10.1.125.204&quot;] [uri &quot;/sites/all/themes/fsa/img/icone-seta.jpg&quot;] [unique_id
&quot;UDeviX8AAAEAAHXIAy0AAAAA&quot;]
[Fri Aug 24 13:44:57 2012] [error] [client 192.168.21.10] ModSecurity: Rule
2d8f030 [id &quot;950901&quot;][file
&quot;/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;][line
&quot;77&quot;] - Execution error - PCRE limits exceeded (-8): (null). [hostname
&quot;10.1.125.204&quot;] [uri &quot;/sites/all/themes/fsa/img/icone-seta.jpg&quot;] [unique_id
&quot;UDeviX8AAAEAAHXIAy0AAAAA&quot;]
[Fri Aug 24 13:44:57 2012] [error] [client 192.168.21.10] ModSecurity: Rule
2d8f030 [id &quot;950901&quot;][file
&quot;/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;][line
&quot;77&quot;] - Execution error - PCRE limits exceeded (-8): (null). [hostname
&quot;10.1.125.204&quot;] [uri &quot;/sites/all/themes/fsa/img/onda-fsa.png&quot;] [unique_id
&quot;UDeviX8AAAEAAHXPDFoAAAAF&quot;]


*## log in verbose mode:*

[24/Aug/2012:13:24:52 --0300] [192.168.21.10/sid#1526d30][rid#27f7510][/][5]
Rule 116d418: SecRule
&quot;REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*&quot;
&quot;@rx
(?:(?:[\\;\\|\\`]\\W*?\\bcc|\\b(wget|curl))\\b|\\/cc(?:[\\'\&quot;\\|\\;\\`\\-\\s]|$))&quot;
&quot;phase:2,log,rev:2.2.5,capture,t:none,t:normalisePath,t:lowercase,ctl:auditLogParts=+E,msg:'System
Command
Injection',id:950907,tag:WEB_ATTACK/COMMAND_INJECTION,tag:WASCTC/WASC-31,tag:OWASP_TOP_10/A1,tag:PCI/6.5.2,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.command_injection_score=+%{tx.critical_anomaly_score},setvar:tx.%{
rule.id
}-WEB_ATTACK/COMMAND_INJECTION-%{matched_var_name}=%{tx.0},skipAfter:END_COMMAND_INJECTION1&quot;
[24/Aug/2012:13:24:52 --0300] [192.168.21.10/sid#1526d30][rid#27f7510][/][4]
Expanded
&quot;REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*&quot;
to
&quot;REQUEST_COOKIES:SESSc2ec4f8fae0f9b49b1219031f3052c40|REQUEST_COOKIES:SESS988f6dde2396798ae2237ef1db71fdb8|REQUEST_COOKIES:SESS8677ac936d1934b4e08580e4b78c02d0|REQUEST_COOKIES:SESS4922cbb0a9f1bcd7dd450637560249a3|REQUEST_COOKIES:__utma|REQUEST_COOKIES:__utmz|REQUEST_COOKIES:SESSe8a50359f7869c256a51e29f93548645|REQUEST_COOKIES:pma_lang|REQUEST_COOKIES:SESS448430042d094f8dddea85b752fc6947|REQUEST_COOKIES:phpMyAdmin|REQUEST_COOKIES:__utmc|REQUEST_COOKIES:has_js|REQUEST_COOKIES_NAMES:SESSc2ec4f8fae0f9b49b1219031f3052c40|REQUEST_COOKIES_NAMES:SESS988f6dde2396798ae2237ef1db71fdb8|REQUEST_COOKIES_NAMES:SESS8677ac936d1934b4e08580e4b78c02d0|REQUEST_COOKIES_NAMES:SESS4922cbb0a9f1bcd7dd450637560249a3|REQUEST_COOKIES_NAMES:__utma|REQUEST_COOKIES_NAMES:__utmz|REQUEST_COOKIES_NAMES:SESSe8a50359f7869c256a51e29f93548645|REQUEST_COOKIES_NAMES:pma_lang|REQUEST_COOKIES_NAMES:SESS448430042d094f8dddea85b752fc6947|REQUEST_COOKIES_NAMES:php


***************************************


So, I created a file called modsecurity_crs_61_custom_rules.conf and I
inserted the rule (see bellow) on it:


SecRule
REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML|
!REQUEST_HEADERS:Cookie|REQUEST_COOKIES|REQUEST_COOKIES_NAMES|!REQUEST_COOKIES_NAMES:/^SESS$/:/*
&quot;(?i:([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?([\d\w]+)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?(?:=|&lt;=&gt;|r?like|sounds\s+like|regexp)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?([\d\w]+)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?(?:!=|&lt;=|&gt;=|&lt;&gt;|&lt;|&gt;|\^|is\s+not|not\s+likgexp)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?(?!\6)([\d\w]+))&quot;
\

&quot;phase:2,rev:'2.2.5',capture,multiMatch,t:none,t:urlDecodeUni,t:replaceComments,ctl:auditLogParts=+E,block,msg:'SQL
Injection
Attack',id:'1',logdata:'%{TX.0}',severity:'2',tag:'WEB_ATTACK/SQL_INJECTION',tag:'WASCTC/WASC-19',tag:'OWASP_TOP_10/A1',tag:'OWASP_AppSensor/CIE1',tag:'PCI/6.5.2',setvar:'tx.msg=%{rule.msg}',setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{
rule.id}-WEB_ATTACK/SQL_INJECTION-%{matched_var_name}=%{tx.0}&quot;



####

*[<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">root at myserver</A> httpd]# /etc/init.d/httpd start*
Starting httpd: Syntax error on line 10 of
/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_61_custom_rules.conf:
SecRule takes two or three arguments, rule target, operator and optional
action list
                                                           [FAILED]

What I'm doing wrong in this rule ?

many thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120824/f85250c3/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120824/f85250c3/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001168.html">[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
</A></li>
	<LI>Next message: <A HREF="001171.html">[Owasp-modsecurity-core-rule-set] Fail to create negative rule
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1170">[ date ]</a>
              <a href="thread.html#1170">[ thread ]</a>
              <a href="subject.html#1170">[ subject ]</a>
              <a href="author.html#1170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
