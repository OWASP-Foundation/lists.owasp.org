<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%40pmFromFile%20fails%20when%20using%0A%20IIS%20along%20with%20modsecurity%202.7.0-RC2&In-Reply-To=%3CCOL002-W1903670804BE1DB619C98BFCB30%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001152.html">
   <LINK REL="Next"  HREF="001155.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2</H1>
    <B>Bill Roemhild</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%40pmFromFile%20fails%20when%20using%0A%20IIS%20along%20with%20modsecurity%202.7.0-RC2&In-Reply-To=%3CCOL002-W1903670804BE1DB619C98BFCB30%40phx.gbl%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2">consume_ at hotmail.com
       </A><BR>
    <I>Fri Aug 10 15:47:39 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001152.html">[Owasp-modsecurity-core-rule-set] Using the latest	ModSecurity	Versions
</A></li>
        <LI>Next message: <A HREF="001155.html">[Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1154">[ date ]</a>
              <a href="thread.html#1154">[ thread ]</a>
              <a href="subject.html#1154">[ subject ]</a>
              <a href="author.html#1154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>There is not an entry listed in the event log for a missing file.   
I gave &quot;IIS AppPool\DefaultAppPool&quot; full control over the data files as I'm using IIS 7.5.  Same result. 
I also tried adding &quot;Network Service&quot;, even through I'm pretty sure that is wrong.  Still no love.
 
Bill

 From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Greg.Wroblewski at microsoft.com</A>
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">consume_ at hotmail.com</A>
CC: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: RE: [Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2
Date: Thu, 9 Aug 2012 23:21:55 +0000









This is really an APR bug (we should report it or create a workaround), but the problem is in the file permissions. Read access to everyone is not enough, proper
 ACLs must be set as well.
 
When the file does not exist this error gets logged in the event log:
 
Syntax error in config file c:\inetpub\wwwroot\test.conf, line 47: Error creating rule: Could not open phrase file &quot;c:\inetpub\wwwroot\modsecurity_35_scanners.data&quot;:
 The system cannot find the file specified.
 
So you can see when it&#8217;s a permission issue or a path issue.
 
Greg
 


From: Ryan Barnett [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>]


Sent: Thursday, August 9, 2012 2:45 PM

To: Bill Roemhild

Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>; Greg Wroblewski (SPARROW)

Subject: Re: [Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2


 

You might want to try and specify a full path to the .data file. 

--


Ryan Barnett


Researcher Lead


Trustwave - SpiderLabs


 





On Aug 9, 2012, at 5:39 PM, Bill Roemhild &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">consume_ at hotmail.com</A>&gt; wrote:




I've been playing around with modsecurity 2.7.0-RC2 for IIS along with the OWASP rules.  When running any rule set that calls for a data file through @pmFromFile the application pool crashes.  I've given read access to 'Everyone' on the
 data files being read without success. Anyone else run into this problem? 

 

 

Rule:

SecRule REQUEST_HEADERS:User-Agent &quot;@pmFromFile modsecurity_35_scanners.data&quot; \

        &quot;phase:2,rev:'2.2.5',t:none,t:lowercase,block,msg:'Request Indicates a Security Scanner Scanned the Site',id:'990002',tag:'AUTOMATION/SECURITY_SCANNER',tag:'WASCTC/WASC-21',tag:'OWASP_TOP_10/A7',tag:'PCI/6.5.10',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.automation_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}-AUTOMATION/SECURITY_SCANNER-%{matched_var_name}=%{matched_var}&quot;

 

Crash:

w3wp.exe 

   7.5.7601.17514 

   4ce7afa2 

   libapr-1.dll 

   1.4.5.0 

   500eaf34 

   c0000005 

   00000000000099f8 

   1e08 

   01cd7675752af369 

   c:\windows\system32\inetsrv\w3wp.exe 

   C:\Windows\system32\inetsrv\libapr-1.dll 

   b4147ab9-e268-11e1-82b3-4437e66c2115 

 

 

 





_______________________________________________

Owasp-modsecurity-core-rule-set mailing list

<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>

<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>


 



This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient,
 you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy
 the material in its entirety, whether in electronic or hard copy format.
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120810/d0b3aa0c/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120810/d0b3aa0c/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001152.html">[Owasp-modsecurity-core-rule-set] Using the latest	ModSecurity	Versions
</A></li>
	<LI>Next message: <A HREF="001155.html">[Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1154">[ date ]</a>
              <a href="thread.html#1154">[ thread ]</a>
              <a href="subject.html#1154">[ subject ]</a>
              <a href="author.html#1154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
