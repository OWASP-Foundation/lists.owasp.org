<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Fail to create negative rule
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Fail%20to%20create%20negative%20rule&In-Reply-To=%3CCANnPkimnqGwC8m%3DG-NRuMgvTcU5PqUC1Bt79vRS4Zm_Rx6i6nA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001170.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Fail to create negative rule</H1>
    <B>Josh Amishav-Zlatin</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Fail%20to%20create%20negative%20rule&In-Reply-To=%3CCANnPkimnqGwC8m%3DG-NRuMgvTcU5PqUC1Bt79vRS4Zm_Rx6i6nA%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Fail to create negative rule">jamuse at gmail.com
       </A><BR>
    <I>Sat Aug 25 20:45:21 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001170.html">[Owasp-modsecurity-core-rule-set] Fail to create negative rule
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1171">[ date ]</a>
              <a href="thread.html#1171">[ thread ]</a>
              <a href="subject.html#1171">[ subject ]</a>
              <a href="author.html#1171">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Aug 24, 2012 at 8:12 PM, Leonardo Bacha Abrantes &lt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">leonardo at lbasolutions.com</A>&gt; wrote:

&gt;<i> Hey people, good afternoon!
</I>&gt;<i>
</I>&gt;<i> I'm trying to Add a new negative policy rule (
</I>&gt;<i> <A HREF="http://www.modsecurity.org/blog/archives/2007/02/handling_false.html">http://www.modsecurity.org/blog/archives/2007/02/handling_false.html</A>),
</I>&gt;<i> because am facing false positve with the rule 970901.
</I>&gt;<i>
</I>&gt;<i>
</I>Hi Leonardo,

Handling false positives has gotten much easier since that blog post was
written in 2007. If your running a modern version of ModSecurity,
the SecRuleUpdateTargetById directive should do the trick. You may want to
read Ryan's updated post on the subject here:

<A HREF="http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-exception-handling.html">http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-exception-handling.html</A>

--
 - Josh

*## log
&gt;<i>
</I>&gt;<i> *[Fri Aug 24 13:44:57 2012] [error] [client 192.168.21.10] ModSecurity:
</I>&gt;<i> Rule 2d8f030 [id &quot;950901&quot;][file
</I>&gt;<i> &quot;/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;][line
</I>&gt;<i> &quot;77&quot;] - Execution error - PCRE limits exceeded (-8): (null). [hostname
</I>&gt;<i> &quot;10.1.125.204&quot;] [uri &quot;/sites/all/themes/fsa/img/icone-seta.jpg&quot;] [unique_id
</I>&gt;<i> &quot;UDeviX8AAAEAAHXIAy0AAAAA&quot;]
</I>&gt;<i> [Fri Aug 24 13:44:57 2012] [error] [client 192.168.21.10] ModSecurity:
</I>&gt;<i> Rule 2d8f030 [id &quot;950901&quot;][file
</I>&gt;<i> &quot;/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;][line
</I>&gt;<i> &quot;77&quot;] - Execution error - PCRE limits exceeded (-8): (null). [hostname
</I>&gt;<i> &quot;10.1.125.204&quot;] [uri &quot;/sites/all/themes/fsa/img/icone-seta.jpg&quot;] [unique_id
</I>&gt;<i> &quot;UDeviX8AAAEAAHXIAy0AAAAA&quot;]
</I>&gt;<i> [Fri Aug 24 13:44:57 2012] [error] [client 192.168.21.10] ModSecurity:
</I>&gt;<i> Rule 2d8f030 [id &quot;950901&quot;][file
</I>&gt;<i> &quot;/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;][line
</I>&gt;<i> &quot;77&quot;] - Execution error - PCRE limits exceeded (-8): (null). [hostname
</I>&gt;<i> &quot;10.1.125.204&quot;] [uri &quot;/sites/all/themes/fsa/img/onda-fsa.png&quot;] [unique_id
</I>&gt;<i> &quot;UDeviX8AAAEAAHXPDFoAAAAF&quot;]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *## log in verbose mode:*
</I>&gt;<i>
</I>&gt;<i> [24/Aug/2012:13:24:52 --0300] [
</I>&gt;<i> 192.168.21.10/sid#1526d30][rid#27f7510][/][5&lt;<A HREF="http://192.168.21.10/sid#1526d30">http://192.168.21.10/sid#1526d30</A>][rid%2327f7510][/][5&gt;]
</I>&gt;<i> Rule 116d418: SecRule
</I>&gt;<i> &quot;REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*&quot;
</I>&gt;<i> &quot;@rx
</I>&gt;<i> (?:(?:[\\;\\|\\`]\\W*?\\bcc|\\b(wget|curl))\\b|\\/cc(?:[\\'\&quot;\\|\\;\\`\\-\\s]|$))&quot;
</I>&gt;<i> &quot;phase:2,log,rev:2.2.5,capture,t:none,t:normalisePath,t:lowercase,ctl:auditLogParts=+E,msg:'System
</I>&gt;<i> Command
</I>&gt;<i> Injection',id:950907,tag:WEB_ATTACK/COMMAND_INJECTION,tag:WASCTC/WASC-31,tag:OWASP_TOP_10/A1,tag:PCI/6.5.2,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.command_injection_score=+%{tx.critical_anomaly_score},setvar:tx.%{
</I>&gt;<i> rule.id
</I>&gt;<i> }-WEB_ATTACK/COMMAND_INJECTION-%{matched_var_name}=%{tx.0},skipAfter:END_COMMAND_INJECTION1&quot;
</I>&gt;<i> [24/Aug/2012:13:24:52 --0300] [
</I>&gt;<i> 192.168.21.10/sid#1526d30][rid#27f7510][/][4&lt;<A HREF="http://192.168.21.10/sid#1526d30">http://192.168.21.10/sid#1526d30</A>][rid%2327f7510][/][4&gt;]
</I>&gt;<i> Expanded
</I>&gt;<i> &quot;REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*&quot;
</I>&gt;<i> to
</I>&gt;<i> &quot;REQUEST_COOKIES:SESSc2ec4f8fae0f9b49b1219031f3052c40|REQUEST_COOKIES:SESS988f6dde2396798ae2237ef1db71fdb8|REQUEST_COOKIES:SESS8677ac936d1934b4e08580e4b78c02d0|REQUEST_COOKIES:SESS4922cbb0a9f1bcd7dd450637560249a3|REQUEST_COOKIES:__utma|REQUEST_COOKIES:__utmz|REQUEST_COOKIES:SESSe8a50359f7869c256a51e29f93548645|REQUEST_COOKIES:pma_lang|REQUEST_COOKIES:SESS448430042d094f8dddea85b752fc6947|REQUEST_COOKIES:phpMyAdmin|REQUEST_COOKIES:__utmc|REQUEST_COOKIES:has_js|REQUEST_COOKIES_NAMES:SESSc2ec4f8fae0f9b49b1219031f3052c40|REQUEST_COOKIES_NAMES:SESS988f6dde2396798ae2237ef1db71fdb8|REQUEST_COOKIES_NAMES:SESS8677ac936d1934b4e08580e4b78c02d0|REQUEST_COOKIES_NAMES:SESS4922cbb0a9f1bcd7dd450637560249a3|REQUEST_COOKIES_NAMES:__utma|REQUEST_COOKIES_NAMES:__utmz|REQUEST_COOKIES_NAMES:SESSe8a50359f7869c256a51e29f93548645|REQUEST_COOKIES_NAMES:pma_lang|REQUEST_COOKIES_NAMES:SESS448430042d094f8dddea85b752fc6947|REQUEST_COOKIES_NAMES:php
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ***************************************
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> So, I created a file called modsecurity_crs_61_custom_rules.conf and I
</I>&gt;<i> inserted the rule (see bellow) on it:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> SecRule
</I>&gt;<i> REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML|
</I>&gt;<i>
</I>&gt;<i> !REQUEST_HEADERS:Cookie|REQUEST_COOKIES|REQUEST_COOKIES_NAMES|!REQUEST_COOKIES_NAMES:/^SESS$/:/*
</I>&gt;<i> &quot;(?i:([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?([\d\w]+)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?(?:=|&lt;=&gt;|r?like|sounds\s+like|regexp)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?([\d\w]+)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?(?:!=|&lt;=|&gt;=|&lt;&gt;|&lt;|&gt;|\^|is\s+not|not\s+likgexp)([\s'\&quot;`&#194;&#180;&#195;&#162;(\)]*)?(?!\6)([\d\w]+))&quot;
</I>&gt;<i> \
</I>&gt;<i>
</I>&gt;<i> &quot;phase:2,rev:'2.2.5',capture,multiMatch,t:none,t:urlDecodeUni,t:replaceComments,ctl:auditLogParts=+E,block,msg:'SQL
</I>&gt;<i> Injection
</I>&gt;<i> Attack',id:'1',logdata:'%{TX.0}',severity:'2',tag:'WEB_ATTACK/SQL_INJECTION',tag:'WASCTC/WASC-19',tag:'OWASP_TOP_10/A1',tag:'OWASP_AppSensor/CIE1',tag:'PCI/6.5.2',setvar:'tx.msg=%{rule.msg}',setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{
</I>&gt;<i> rule.id}-WEB_ATTACK/SQL_INJECTION-%{matched_var_name}=%{tx.0}&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ####
</I>&gt;<i>
</I>&gt;<i> *[<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">root at myserver</A> httpd]# /etc/init.d/httpd start*
</I>&gt;<i> Starting httpd: Syntax error on line 10 of
</I>&gt;<i> /etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_61_custom_rules.conf:
</I>&gt;<i> SecRule takes two or three arguments, rule target, operator and optional
</I>&gt;<i> action list
</I>&gt;<i>                                                            [FAILED]
</I>&gt;<i>
</I>&gt;<i> What I'm doing wrong in this rule ?
</I>&gt;<i>
</I>&gt;<i> many thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120825/81d078cf/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120825/81d078cf/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001170.html">[Owasp-modsecurity-core-rule-set] Fail to create negative rule
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1171">[ date ]</a>
              <a href="thread.html#1171">[ thread ]</a>
              <a href="subject.html#1171">[ subject ]</a>
              <a href="author.html#1171">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
