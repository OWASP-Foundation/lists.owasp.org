<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Why%20is%20rule%20981318%20triggering%3F&In-Reply-To=%3C50367091.7050207%40apodiscounter.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001165.html">
   <LINK REL="Next"  HREF="001169.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?</H1>
    <B>Christian Klossek</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Why%20is%20rule%20981318%20triggering%3F&In-Reply-To=%3C50367091.7050207%40apodiscounter.de%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?">c.klossek at apodiscounter.de
       </A><BR>
    <I>Thu Aug 23 18:04:01 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001165.html">[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
</A></li>
        <LI>Next message: <A HREF="001169.html">[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1166">[ date ]</a>
              <a href="thread.html#1166">[ thread ]</a>
              <a href="subject.html#1166">[ subject ]</a>
              <a href="author.html#1166">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ryan,

the Server and the page uses utf-8 encoding.
When the form is being submitted the apache log looks like this:

&quot;GET /test.php?keywords=%C4%99 HTTP/1.0&quot; 403 375 &quot;-&quot; &quot;Mozilla/5.0 (X11;
Ubuntu; Linux x86_64; rv:14.0) Gecko/20100101 Firefox/14.0.1&quot;

You can see the &quot;&#281;&quot; is correctly encoded using utf-8 as &quot;%C4%99&quot;. Why is
modsecurity not decoding this in a proper way before doing it's tests?
Or is it an apache configuration problem?

Christian

On 08/23/2012 06:39 PM, Ryan Barnett wrote:
&gt;<i> Christian,
</I>&gt;<i> Is this an application that you control?  It looks as though this is some
</I>&gt;<i> type of search field where the user can type in text.  If this is the
</I>&gt;<i> case, then I suggest that the application use proper Unicode encoding of
</I>&gt;<i> the input data so that the param field would be - keywords=%u0119 rather
</I>&gt;<i> than keywords=&#281;.
</I>&gt;<i>
</I>&gt;<i> In addition, I would suggest that you add the following to your
</I>&gt;<i> ModSecurity main config file -
</I>&gt;<i>
</I>&gt;<i> SecUnicodeCodePoint 20127
</I>&gt;<i> SecUnicodeMapFile /path/to/unicode.mapping
</I>&gt;<i>
</I>&gt;<i> You will need to adjust the first directive to suit your local code point.
</I>&gt;<i>  20127 maps to US-ASCII.  The unicode.mapping file comes bundled with the
</I>&gt;<i> ModSecurity source code.  By using these directives, any t:urlDecodeUni
</I>&gt;<i> transformation functions will map the Unicode data to the mappings you
</I>&gt;<i> specify.
</I>&gt;<i>
</I>&gt;<i> -Ryan
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8/23/12 9:34 AM, &quot;Christian Klossek&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">c.klossek at apodiscounter.de</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm using modsecurity 2.6.7 with CRS 2.2.5 on a debian squeeze system.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Why is the rule 981318 triggering on a GET-param with a value of &quot;&#281;&quot;
</I>&gt;&gt;<i> (Unicode U+0119)?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I get this in my debug log (debug level 9):
</I>&gt;&gt;<i> -------------------------------------
</I>&gt;&gt;<i> SecRule
</I>&gt;&gt;<i> &quot;REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XM
</I>&gt;&gt;<i> L:/*&quot;
</I>&gt;&gt;<i> &quot;@rx
</I>&gt;&gt;<i> (^[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\x
</I>&gt;&gt;<i> 80\x98;]+$)&quot;
</I>&gt;&gt;<i> &quot;phase:2,nolog,auditlog,rev:2.2.5,capture,t:none,t:urlDecodeUni,block,msg:
</I>&gt;&gt;<i> 'SQL
</I>&gt;&gt;<i> Injection Attack: Common Injection Testing
</I>&gt;&gt;<i> Detected',id:981318,logdata:%{TX.0},severity:2,tag:WEB_ATTACK/SQL_INJECTIO
</I>&gt;&gt;<i> N,tag:WASCTC/WASC-19,tag:OWASP_TOP_10/A1,tag:OWASP_AppSensor/CIE1,tag:PCI/
</I>&gt;&gt;<i> 6.5.2,setvar:tx.msg=%{rule.msg},setvar:tx.sql_injection_score=+%{tx.critic
</I>&gt;&gt;<i> al_anomaly_score},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},se
</I>&gt;&gt;<i> tvar:tx.%{rule.id}-WEB_ATTACK/SQL_INJECTION-%{matched_var_name}=%{tx.0}&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Expanded
</I>&gt;&gt;<i> &quot;REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XM
</I>&gt;&gt;<i> L:/*&quot;
</I>&gt;&gt;<i> to &quot;REQUEST_FILENAME|ARGS_NAMES:keywords|ARGS:keywords&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> T (0) urlDecodeUni: &quot;/test.php&quot;
</I>&gt;&gt;<i> Transformation completed in 13 usec.
</I>&gt;&gt;<i> Executing operator &quot;rx&quot; with param
</I>&gt;&gt;<i> &quot;(^[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\
</I>&gt;&gt;<i> x80\x98;]+$)&quot;
</I>&gt;&gt;<i> against REQUEST_FILENAME.
</I>&gt;&gt;<i> Target value: &quot;/test.php&quot;
</I>&gt;&gt;<i> Operator completed in 9 usec.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> T (0) urlDecodeUni: &quot;keywords&quot;
</I>&gt;&gt;<i> Transformation completed in 13 usec.
</I>&gt;&gt;<i> Executing operator &quot;rx&quot; with param
</I>&gt;&gt;<i> &quot;(^[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\
</I>&gt;&gt;<i> x80\x98;]+$)&quot;
</I>&gt;&gt;<i> against ARGS_NAMES:keywords.
</I>&gt;&gt;<i> Target value: &quot;keywords&quot;
</I>&gt;&gt;<i> Operator completed in 4 usec.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> T (0) urlDecodeUni: &quot;\xc4\x99&quot;
</I>&gt;&gt;<i> Transformation completed in 14 usec.
</I>&gt;&gt;<i> Executing operator &quot;rx&quot; with param
</I>&gt;&gt;<i> &quot;(^[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\&quot;'`\xc2\xb4\xe2\x80\x99\xe2\
</I>&gt;&gt;<i> x80\x98;]+$)&quot;
</I>&gt;&gt;<i> against ARGS:keywords.
</I>&gt;&gt;<i> Target value: &quot;\xc4\x99&quot;
</I>&gt;&gt;<i> Added regex subexpression to TX.0: \x99
</I>&gt;&gt;<i> Added regex subexpression to TX.1: \x99
</I>&gt;&gt;<i> Operator completed in 38 usec.
</I>&gt;&gt;<i> Setting variable: tx.msg=%{rule.msg}
</I>&gt;&gt;<i> Resolved macro %{rule.msg} to: SQL Injection Attack: Common Injection
</I>&gt;&gt;<i> Testing Detected
</I>&gt;&gt;<i> ..
</I>&gt;&gt;<i> ..
</I>&gt;&gt;<i> -------------------------------------------
</I>&gt;&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001165.html">[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
</A></li>
	<LI>Next message: <A HREF="001169.html">[Owasp-modsecurity-core-rule-set] Why is rule 981318 triggering?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1166">[ date ]</a>
              <a href="thread.html#1166">[ thread ]</a>
              <a href="subject.html#1166">[ subject ]</a>
              <a href="author.html#1166">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
