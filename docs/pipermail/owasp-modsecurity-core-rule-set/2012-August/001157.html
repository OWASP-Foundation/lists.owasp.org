<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Rule Review - 960911 (Invalid	HTTP Request Line)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20Review%20-%20960911%20%28Invalid%0A%09HTTP%20Request%20Line%29&In-Reply-To=%3CCC4ACCB9.57F23%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001156.html">
   <LINK REL="Next"  HREF="001158.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Rule Review - 960911 (Invalid	HTTP Request Line)</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20Review%20-%20960911%20%28Invalid%0A%09HTTP%20Request%20Line%29&In-Reply-To=%3CCC4ACCB9.57F23%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Rule Review - 960911 (Invalid	HTTP Request Line)">RBarnett at trustwave.com
       </A><BR>
    <I>Fri Aug 10 18:35:37 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001156.html">[Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2
</A></li>
        <LI>Next message: <A HREF="001158.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] Using the latest ModSecurity Versions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1157">[ date ]</a>
              <a href="thread.html#1157">[ thread ]</a>
              <a href="subject.html#1157">[ subject ]</a>
              <a href="author.html#1157">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We are starting the process of reviewing/updating the CRS base_rules.  As part of this process, I am sending out emails for community review of each rule.  We need feedback on any possible updates to the following:

 *   Is the VARIABLE/TARGET list accurate?  Should we add/remove any variables?
 *   Is the OPERATOR accurate?  Should we use a different operator?  Can the operator value be improved for accuracy and performance?
 *   Are there any recommended changes to the action listing?

I have gone ahead and updated this rule with the following improvements:

 *   Removed the &quot;t:lowercase&quot; tfns and added the pcre ignore case quantifier (?I:
 *   Reordered the action listing to make it more readable
 *   Added new ModSecurity v2.7 ver, maturity and accuracy actions.  If you feel that any of these should be updated let me know.  Your feedback is critical for the accuracy label.  If you run into false positives, you must let us know so we can look to improve the rule or label its accuracy value accordingly.
 *   Updated both tag and setvar data.

#
# Validate request line against the format specified in the HTTP RFC
#
# -=[ Rule Logic ]=-
#
# Uses rule negation against the regex for positive security.  The regex specifies the proper
# construction of URI request lines such as:
#
#       &quot;http:&quot; &quot;//&quot; host [ &quot;:&quot; port ] [ abs_path [ &quot;?&quot; query ]]
#
# It also outlines proper construction for CONNECT, OPTIONS and GET requests.
#
# -=[ References ]=-
# <A HREF="http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2.1">http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2.1</A>
# <A HREF="http://capec.mitre.org/data/definitions/272.html">http://capec.mitre.org/data/definitions/272.html</A>
#
SecRule REQUEST_LINE &quot;!^(?i:(?:[a-z]{3,10}\s+(?:\w{3,7}?://[\w\-\./]*(?::\d+)?)?/[^?#]*(?:\?[^#\s]*)?(?:#[\S]*)?|connect (?:\d{1,3}\.){3}\d{1,3}\.?(?::\d+)?|options \*)\s+[
\w\./]+|get /[^?#]*(?:\?[^#\s]*)?(?:#[\S]*)?)$&quot; \
  &quot;msg:'Invalid HTTP Request Line', \
  severity:'4', \
  id:'960911', \
  ver:'OWASP_CRS/2.2.6', \
  rev:'2', \
  maturity:'9', \
  accuracy:'9', \
  logdata:'%{request_line}', \
  phase:1, \
  block, \
  t:none, \
  tag:'OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ', \
  tag:'CAPEC-272' \
  setvar:'tx.msg=%{rule.msg}', \
  setvar:tx.anomaly_score=+%{tx.notice_anomaly_score}, \
  setvar:'tx.%{rule.id}-OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ-%{matched_var_name}=%{matched_var}'&quot;


--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120810/28d72b01/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120810/28d72b01/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001156.html">[Owasp-modsecurity-core-rule-set] @pmFromFile fails when using IIS along with modsecurity 2.7.0-RC2
</A></li>
	<LI>Next message: <A HREF="001158.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] Using the latest ModSecurity Versions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1157">[ date ]</a>
              <a href="thread.html#1157">[ thread ]</a>
              <a href="subject.html#1157">[ subject ]</a>
              <a href="author.html#1157">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
