<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] slow dos attacks detection	problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20slow%20dos%20attacks%20detection%0A%09problem&In-Reply-To=%3C7E153CAD-2BB5-43A2-956D-4A85DCD87D84%40owasp.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001316.html">
   <LINK REL="Next"  HREF="001318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] slow dos attacks detection	problem</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20slow%20dos%20attacks%20detection%0A%09problem&In-Reply-To=%3C7E153CAD-2BB5-43A2-956D-4A85DCD87D84%40owasp.org%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] slow dos attacks detection	problem">ryan.barnett at owasp.org
       </A><BR>
    <I>Mon Feb 18 13:32:23 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001316.html">[Owasp-modsecurity-core-rule-set] slow dos attacks detection	problem
</A></li>
        <LI>Next message: <A HREF="001318.html">[Owasp-modsecurity-core-rule-set] block bad bot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1317">[ date ]</a>
              <a href="thread.html#1317">[ thread ]</a>
              <a href="subject.html#1317">[ subject ]</a>
              <a href="author.html#1317">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>In order for ModSecurity to &quot;see&quot; the request and assign a unique ID to it, make sure it is running in apache post-read-request hook for phase:1 by using --enable-request-early configure flag. 

Try that and see if it helps. 

--
Ryan Barnett
Lead Security Researcher
Trustwave - SpiderLabs

On Feb 18, 2013, at 3:08 AM, &quot;Demin Olivier&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Olivier.Demin at generali.be</A>&gt; wrote:

&gt;<i> Hi Ryan,
</I>&gt;<i>  
</I>&gt;<i> I had read these posts already, but I don&#8217;t think that this is the problem in my case.  Here is what I get from the server:
</I>&gt;<i>  
</I>&gt;<i> &lt;image002.png&gt;
</I>&gt;<i>  
</I>&gt;<i> You can see that a status 408 is returned, not a 200.  In addition, I also have the following line in my apache access log:
</I>&gt;<i> 80.201.47.144 - - [17/Feb/2013:11:01:26 -0500] &quot;GET / HTTP/1.1&quot; 408 498 &quot;-&quot; &quot;-&quot;
</I>&gt;<i>  
</I>&gt;<i> But nothing is written to the modsec debug log at all&#8230;
</I>&gt;<i>  
</I>&gt;<i> So I think it&#8217;s a different problem than the one referred to in the posts you provided.  Any other thought or hint that could put me on the right track ?
</I>&gt;<i>  
</I>&gt;<i> Thanks
</I>&gt;<i> Olivier Demin
</I>&gt;<i> Head of Front Department/IT Change
</I>&gt;<i> Solution Architect
</I>&gt;<i> Tel:                                        +32 (0)2 403 8083
</I>&gt;<i> Mobile:                                +32 (0)473 83 10 29
</I>&gt;<i> Avenue Louise 149          Mail: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">olivier.demin at generali.be</A>
</I>&gt;<i> B-1050 Bruxelles               Site: www.generali.be
</I>&gt;<i> P Please consider your environmental responsibility before printing this e-mail, thanks for the planet.
</I>&gt;<i>  
</I>&gt;<i> From: Ryan Barnett [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>] 
</I>&gt;<i> Sent: samedi 16 f&#233;vrier 2013 15:19
</I>&gt;<i> To: Demin Olivier
</I>&gt;<i> Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> Subject: Re: [Owasp-modsecurity-core-rule-set] slow dos attacks detection problem
</I>&gt;<i>  
</I>&gt;<i> See this blog post -
</I>&gt;<i> <A HREF="http://blog.spiderlabs.com/2011/07/advanced-topic-of-the-week-mitigating-slow-http-dos-attacks.html">http://blog.spiderlabs.com/2011/07/advanced-topic-of-the-week-mitigating-slow-http-dos-attacks.html</A>
</I>&gt;<i> 
</I>&gt;<i> Caution: there are several reports that mod reqtimeoutdoes not issue a 408 status code under various conditions.  This means that this implementation described below may not work reliably.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://apache-http-server.18135.n6.nabble.com/users-httpd-mod-reqtimeout-not-returning-408-td4770478.html">http://apache-http-server.18135.n6.nabble.com/users-httpd-mod-reqtimeout-not-returning-408-td4770478.html</A>
</I>&gt;<i>  
</I>&gt;<i> --
</I>&gt;<i> Ryan Barnett
</I>&gt;<i> Lead Security Researcher
</I>&gt;<i> Trustwave - SpiderLabs
</I>&gt;<i> 
</I>&gt;<i> On Feb 16, 2013, at 6:50 AM, &quot;Demin Olivier&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Olivier.Demin at generali.be</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i>  
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I'm using the CRS 2.2.7 with mod security 2.7.2 and apache 2.2.14 on Linux Ubuntu.  I seem to have troubles with the modsecurity crs 11 slow dos protection.conf from the experimental ruleset.  In fact, the reqtimeout module is working fine and fires 408 errors after the specified number of seconds when I don't provide the HTTP header fast enough (I tested that by simply performing manual telnet sessions on the port 80 of my server).  But these 408 errors seem not to be intercepted by mod security at all.  Indeed, when I enable the maximum debug logs (level 9), nothing is appended in the debug log upon 408 firing:  no trace of any rule being checked in that particular case.
</I>&gt;<i> 
</I>&gt;<i> So it seems that the reqtimeout module returns in a way that prevents mod security from being activated.
</I>&gt;<i> 
</I>&gt;<i> Did any of you encounter similar problems?
</I>&gt;<i> 
</I>&gt;<i> Thanks for your help
</I>&gt;<i> 
</I>&gt;<i> Olivier Demin
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ###########################################
</I>&gt;<i> GENERALI BELGIUM NV-SA - Verzekeringen-Assurances
</I>&gt;<i> Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles
</I>&gt;<i> Ondernemingsnummer 0403.262.553 Num&#233;ro d'entreprise
</I>&gt;<i> RPR Brussel - RPM Bruxelles
</I>&gt;<i> ###########################################
</I>&gt;<i> This e-mail and any files transmitted with it are confidential and
</I>&gt;<i> intended solely for the use of the individual or entity to whom they 
</I>&gt;<i> are addressed. If you have received this e-mail in error please notify 
</I>&gt;<i> the system manager.
</I>&gt;<i> 
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</I>&gt;<i> 
</I>&gt;<i> ###########################################
</I>&gt;<i> GENERALI BELGIUM NV-SA - Verzekeringen-Assurances
</I>&gt;<i> Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles
</I>&gt;<i> Ondernemingsnummer 0403.262.553 Num&#233;ro d'entreprise
</I>&gt;<i> RPR Brussel - RPM Bruxelles
</I>&gt;<i> ###########################################
</I>&gt;<i> This e-mail and any files transmitted with it are confidential and
</I>&gt;<i> intended solely for the use of the individual or entity to whom they 
</I>&gt;<i> are addressed. If you have received this e-mail in error please notify 
</I>&gt;<i> the system manager.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130218/a6f03648/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130218/a6f03648/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001316.html">[Owasp-modsecurity-core-rule-set] slow dos attacks detection	problem
</A></li>
	<LI>Next message: <A HREF="001318.html">[Owasp-modsecurity-core-rule-set] block bad bot
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1317">[ date ]</a>
              <a href="thread.html#1317">[ thread ]</a>
              <a href="subject.html#1317">[ subject ]</a>
              <a href="author.html#1317">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
