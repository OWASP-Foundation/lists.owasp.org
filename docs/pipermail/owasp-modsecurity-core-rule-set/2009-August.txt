From dreamice.jiang at gmail.com  Sun Aug  2 07:28:37 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Sun, 2 Aug 2009 19:28:37 +0800
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-8) Filter Bypass Vulnerability
In-Reply-To: <200907311747.44310.ryan.barnett@breach.com>
References: <200907311747.44310.ryan.barnett@breach.com>
Message-ID: <d5dfca260908020428h3d2f1347k24d1f2b5396b7997@mail.gmail.com>

Dear Ryan,

I have another question about this HPP rule. The definition of HPP attack is
that the  'arg_names' includes data segment like "user=a & user=d & user=m &
user=i & user=n". The multi-parameter is "user". But if we login a user with
the same username and password, this is also recognized as HPP attack. For
example "username=admin&password=admin".  The differences between these two
cases are: the multi-parameters are before or after "=".  I want to know
whether need we differentiate these two cases in the HPP detection rules.

Thanks a lot.

2009/8/1 Ryan Barnett <ryan.barnett at breach.com>

> ---------- Forwarded Message ----------
>
>
> Subject: [JIRA] Resolved: (CORERULES-8) Filter Bypass Vulnerability
> Date: Friday 31 July 2009
> From: "Ryan Barnett (JIRA)" <modsecurity at tracker.modsecurity.org>
> To: Ryan Barnett <Ryan.Barnett at breach.com>
>
>
>
> [
> https://www.modsecurity.org/tracker/browse/CORERULES-8?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel]
>
>
> Ryan Barnett resolved CORERULES-8.
> ----------------------------------
>
>
> Resolution: Fixed
> Fix Version/s: (was: 1.7.0)
> 2.0.0
>
>
> We added this HTTP Parameter Pollution (HPP) rule to the CRS v.2.0.0.
>
>
> > Filter Bypass Vulnerability
> > ---------------------------
> >
> > Key: CORERULES-8
> > URL: https://www.modsecurity.org/tracker/browse/CORERULES-8
> > Project: Core Rules
> > Issue Type: Bug
> > Security Level: Normal
> > Affects Versions: 1.6.1
> > Reporter: Samiux AU
> > Assignee: Ryan Barnett
> > Fix For: 2.0.0
> >
> >
> > Details please refer to this link.
> > http://www.milw0rm.com/exploits/8930
>
>
> --
> This message is automatically generated by JIRA.
> -
> If you think it was sent incorrectly contact one of the administrators:
> https://www.modsecurity.org/tracker/secure/Administrators.jspa
> -
> For more information on JIRA, see: http://www.atlassian.com/software/jira
>
>
>
>
> -------------------------------------------------------
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090802/4bc647ca/attachment.html 

From jodelvalle at gmail.com  Mon Aug  3 00:03:06 2009
From: jodelvalle at gmail.com (Josue Del Valle)
Date: Mon, 3 Aug 2009 00:03:06 -0400
Subject: [Owasp-modsecurity-core-rule-set] Help with Cole Rule Set
Message-ID: <3143c0650908022103g1d403500u967380d182c62b41@mail.gmail.com>

Hi,

I am new to mod_security and new to Apache.  I've been asked by my employer
to configure and secure an Apache server that will run on Windows.  I've
been reading about the Core Rules and understand that initially they should
be set to DetectOnly mode and that I should check my logs for false
positives before turning them on.  What I am not sure is what I will be
looking for in the logs.  The type of attacks or false positives blocks,
  How can I identify false positives?  For how long should I run it on
DetectOnly mode?  Bottom line, I will really appreciate if someone can point
me in the right direction.  Thanks in advance for your help.


Regards,

GeekInput
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090803/72cc85a1/attachment.html 

From ryan.barnett at breach.com  Mon Aug  3 10:10:14 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 3 Aug 2009 10:10:14 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-8) Filter Bypass Vulnerability
In-Reply-To: <d5dfca260908020428h3d2f1347k24d1f2b5396b7997@mail.gmail.com>
References: <200907311747.44310.ryan.barnett@breach.com>
	<d5dfca260908020428h3d2f1347k24d1f2b5396b7997@mail.gmail.com>
Message-ID: <200908031010.15069.ryan.barnett@breach.com>

On Sunday 02 August 2009 07:28:37 am Junyong Jiang wrote:
> Dear Ryan,
>
> I have another question about this HPP rule. The definition of HPP attack
> is that the  'arg_names' includes data segment like "user=a & user=d &
> user=m & user=i & user=n". The multi-parameter is "user". But if we login a
> user with the same username and password, this is also recognized as HPP
> attack. For example "username=admin&password=admin".  The differences
> between these two cases are: the multi-parameters are before or after "=". 
> I want to know whether need we differentiate these two cases in the HPP
> detection rules.
>

My understanding of HPP 
(http://www.owasp.org/images/b/ba/AppsecEU09_CarettoniDiPaola_v0.8.pdf) is 
that it includes adding in/injecting new parameters.  This can include adding 
in the data before the "=" into the parameter name section or after the "=" 
into the parameter payload section.  Either way, the attacker is adding in new 
parameters.

The issue, then, from the WAF/WebApp perspective is how are multiple 
parameters with the same name treated?  See my blog post here - 
http://tacticalwebappsec.blogspot.com/2009/05/http-parameter-pollution.html.  
The two main issues are either business-logic abuse and/or signature evasions.

In the example you gave, I am not quite sure how this relates to HPP.  Yes, 
technically, you are inserting new parameter data, however if there are no 
parameter name duplication, then you are not dealing with two issues listed 
above.

Can you explain your question a bit more clearly?

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090803/f1c4e474/attachment.html 

From ryan.barnett at breach.com  Mon Aug  3 10:24:23 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 3 Aug 2009 10:24:23 -0400
Subject: [Owasp-modsecurity-core-rule-set] Help with Cole Rule Set
In-Reply-To: <3143c0650908022103g1d403500u967380d182c62b41@mail.gmail.com>
References: <3143c0650908022103g1d403500u967380d182c62b41@mail.gmail.com>
Message-ID: <200908031024.24114.ryan.barnett@breach.com>

On Monday 03 August 2009 12:03:06 am Josue Del Valle wrote:
> Hi,
>
> I am new to mod_security and new to Apache.  I've been asked by my employer
> to configure and secure an Apache server that will run on Windows.  I've
> been reading about the Core Rules and understand that initially they should
> be set to DetectOnly mode and that I should check my logs for false
> positives before turning them on.  What I am not sure is what I will be
> looking for in the logs.  The type of attacks or false positives blocks,  
> How can I identify false positives?  For how long should I run it on
> DetectOnly mode?  Bottom line, I will really appreciate if someone can
> point me in the right direction.  Thanks in advance for your help.
>
>

Welcome to ModSecurity!  As far as the SecRuleEngine goes 
(http://www.modsecurity.org/documentation/modsecurity-
apache/2.5.9/modsecurity2-apache-reference.html#N10A4F) in the older version 
of the Core Rule Set (CRS) we certainly did recommend that this be set to 
DetectionOnly.  The rationale for this was so that you would not mistakenly 
block any legitimate transactions before you had a chance to tune the rules a 
bit for your environment.  In the current CRS v2.0.0, we have changed how the 
rules work.  The SecRuleEngine is set to On (to allow blocking) however the 
rules all use the "block" action which reference the SecDefaultAction setting 
(which is set to pass).  

Specifically, the rules are now running in a "collaborative" mode and use an 
anomaly scoring system.  Each rule, if it triggers, will increase a 
transactional anomaly score.  At the end of phase:2 (the last chance to block 
the inbound request), you can set an appropriate anomaly score for your site.  
This lessens the likelihood of false positives.  Basically, I would suggest 
that you review/update the modsecurity_crs_49_enforcement.conf file and make 
sure that the anomaly scoring level is set to around 20 and that there is no 
blocking action.  This will allow your rules to generate alerts but not block.

As for the false positives,  I would suggest that you review the Data Format 
documentation (http://www.modsecurity.org/documentation/modsecurity-
apache/2.5.9/modsecurity2-data-formats.html) so that you understand what data 
is presented.  The alert data will tell you what rule matched, where in the 
transaction the match occurred and what data matched.  You can then review the 
full audit log data of the transaction to confirm if the match was correct or 
not.

By the way - the OWASP CRS project site needs to have better information to 
address your questions.  We will update it soon.

Hope this info helps.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090803/df150560/attachment.html 

From jodelvalle at gmail.com  Mon Aug  3 12:14:03 2009
From: jodelvalle at gmail.com (Josue Del Valle)
Date: Mon, 3 Aug 2009 12:14:03 -0400
Subject: [Owasp-modsecurity-core-rule-set] Help with Cole Rule Set
In-Reply-To: <200908031024.24114.ryan.barnett@breach.com>
References: <3143c0650908022103g1d403500u967380d182c62b41@mail.gmail.com>
	<200908031024.24114.ryan.barnett@breach.com>
Message-ID: <3143c0650908030914hd9c77bfofc1886bb3124515@mail.gmail.com>

Ryan,

Thanks a whole lot for your detailed explanation.  I will do as
recommended.

Regards,

Josue

On Mon, Aug 3, 2009 at 10:24 AM, Ryan Barnett <ryan.barnett at breach.com>wrote:

>   On Monday 03 August 2009 12:03:06 am Josue Del Valle wrote:
> > Hi,
> >
> > I am new to mod_security and new to Apache. I've been asked by my
> employer
> > to configure and secure an Apache server that will run on Windows. I've
> > been reading about the Core Rules and understand that initially they
> should
> > be set to DetectOnly mode and that I should check my logs for false
> > positives before turning them on. What I am not sure is what I will be
> > looking for in the logs. The type of attacks or false positives blocks,
> > How can I identify false positives? For how long should I run it on
> > DetectOnly mode? Bottom line, I will really appreciate if someone can
> > point me in the right direction. Thanks in advance for your help.
> >
> >
>
>
> Welcome to ModSecurity! As far as the SecRuleEngine goes (
> http://www.modsecurity.org/documentation/modsecurity-apache/2.5.9/modsecurity2-apache-reference.html#N10A4F)
> in the older version of the Core Rule Set (CRS) we certainly did recommend
> that this be set to DetectionOnly. The rationale for this was so that you
> would not mistakenly block any legitimate transactions before you had a
> chance to tune the rules a bit for your environment. In the current CRS
> v2.0.0, we have changed how the rules work. The SecRuleEngine is set to On
> (to allow blocking) however the rules all use the "block" action which
> reference the SecDefaultAction setting (which is set to pass).
>
>
> Specifically, the rules are now running in a "collaborative" mode and use
> an anomaly scoring system. Each rule, if it triggers, will increase a
> transactional anomaly score. At the end of phase:2 (the last chance to block
> the inbound request), you can set an appropriate anomaly score for your
> site. This lessens the likelihood of false positives. Basically, I would
> suggest that you review/update the modsecurity_crs_49_enforcement.conf file
> and make sure that the anomaly scoring level is set to around 20 and that
> there is no blocking action. This will allow your rules to generate alerts
> but not block.
>
>
> As for the false positives, I would suggest that you review the Data Format
> documentation (
> http://www.modsecurity.org/documentation/modsecurity-apache/2.5.9/modsecurity2-data-formats.html)
> so that you understand what data is presented. The alert data will tell you
> what rule matched, where in the transaction the match occurred and what data
> matched. You can then review the full audit log data of the transaction to
> confirm if the match was correct or not.
>
>
> By the way - the OWASP CRS project site needs to have better information to
> address your questions. We will update it soon.
>
>
> Hope this info helps.
>
>
> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090803/e4915023/attachment.html 

From Ryan.Barnett at breach.com  Mon Aug  3 14:49:15 2009
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Mon, 3 Aug 2009 11:49:15 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-7)
 Mod Security Core Rules 2.5-1.6.1 blocks OpenID
Message-ID: <22174697.1249325355694.JavaMail.tomcat@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-7?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-7.
----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0.0

CRS 2.0.X has new RFI rules that should fix this issue.

> Mod Security Core Rules 2.5-1.6.1 blocks OpenID
> -----------------------------------------------
>
>                 Key: CORERULES-7
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-7
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>    Affects Versions: 1.6.1
>         Environment: Linux
>            Reporter: bodhi.zazen
>            Assignee: Ryan Barnett
>             Fix For: 2.0.0
>
>
> Your latest core rule set : modsecurity-core-rules_2.5-1.6.1.tar.gz blocks OpenID
> The offending rule is in modsecurity_crs_42_tight_security.conf
> The exact rule is
> SecRule ARGS "^(?:ht|f)tp:/" \
>         "phase:2,t:none,t:htmlEntityDecode,t:lowercase,capture,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'Remote File Inclusion Attack',id:'950117',severity:'2'"
> I commented out that rule, restarted Apache, and now my users can log in with openid - yea \0/
> Log :
> --ccbd4859-H--
> Message: Access denied with code 501 (phase 2). Pattern match "^(?:ht|f)tp:/" at ARGS:openid.ns. [file "/etc/apache2/conf.d/modsecurity/optional_rules/modsecurity_crs_42_tight_security.conf"] [line "32"] [id "950117"] [msg "Remote File Inclusion Attack"] [severity "CRITICAL"]
> Action: Intercepted (phase 2)
> Stopwatch: 1241131110731486 10573 (571 10040 -)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core ruleset/1.6.1; core ruleset/1.6.1.
> Server: Apache/2.2.9 (Debian) PHP/5.2.6-1+lenny2 with Suhosin-Patch
> --ccbd4859-K--
> SecRule "REQUEST_METHOD" "@rx ^(?:GET|HEAD)$" "phase:2,chain,t:none,deny,log,auditlog,status:400,msg:'GET or HEAD requests with bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION"
> SecRule "&REQUEST_HEADERS:Content-Type" "@eq 0" "phase:2,pass,chain,t:none,log,auditlog,msg:'Request Containing Content, but Missing Content-Type header',id:960904,severity:4"
> SecAction "phase:2,auditlog,nolog,skipAfter:959009"
> SecAction "phase:2,auditlog,nolog,skipAfter:959007"
> SecAction "phase:2,auditlog,nolog,skipAfter:959904"
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm insert xp_enumdsn infile openrowset nvarchar autonomous_transaction print data_type or outfile inner shutdown tbcreator @@version xp_filelist sp_prepare sql_longvarchar xp_regenumkeys xp_loginconfig xp_dirtree ifnu$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm insert xp_enumdsn infile openrowset nvarchar autonomous_transaction print data_type or outfile inner shutdown tbcreator @@version xp_filelist sp_prepare sql_longvarchar xp_regenumkeys xp_loginconfig xp_dirtree ifnu$
> SecAction "phase:2,auditlog,nolog,skipAfter:959906"
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecAction "phase:2,auditlog,nolog,skipAfter:959005"
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python trac$
> SecRule "REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python trac$
> SecAction "phase:2,auditlog,nolog,skipAfter:959013"
> SecRule "REQUEST_METHOD" "@rx ^(?:GET|HEAD)$" "phase:2,chain,t:none,deny,log,auditlog,status:400,msg:'GET or HEAD requests with bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION"
> SecRule "&REQUEST_HEADERS:Content-Type" "@eq 0" "phase:2,chain,t:none,deny,log,auditlog,status:400,msg:'Request Containing Content, but Missing Content-Type header',id:960904,severity:4"
> SecAction "phase:2,auditlog,nolog,skipAfter:959009"
> SecAction "phase:2,auditlog,nolog,skipAfter:959007"
> SecAction "phase:2,auditlog,nolog,skipAfter:959904"
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm insert xp_enumdsn infile openrowset nvarchar autonomous_transaction print data_type or outfile inner shutdown tbcreator @@version xp_filelist sp_prepare sql_longvarchar xp_regenumkeys xp_loginconfig xp_dirtree ifnu$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm insert xp_enumdsn infile openrowset nvarchar autonomous_transaction print data_type or outfile inner shutdown tbcreator @@version xp_filelist sp_prepare sql_longvarchar xp_regenumkeys xp_loginconfig xp_dirtree ifnu$
> SecAction "phase:2,auditlog,nolog,skipAfter:959906"
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer" "@pm jscript onsubmit copyparentfolder javascript meta onmove onkeydown onchange onkeyup activexobject expression onmouseup ecmascript onmouseover vbscript: <![cdata[ http: settimeout onabort shell: .innerhtml onmousedo$
> SecAction "phase:2,auditlog,nolog,skipAfter:959005"
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "ARGS" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls nc.exe id /ch$
> SecRule "REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python trac$
> SecRule "REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES" "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls tclsh8 lsof /ping echo cmd.exe /kill python trac$
> SecAction "phase:2,auditlog,nolog,skipAfter:959013"
> SecRule "ARGS|ARGS_NAMES" "@rx \\bhttp:" "phase:2,auditlog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,pass,nolog,id:999010,severity:5"
> SecRule "ARGS|ARGS_NAMES" "@rx \\bhttp:" "phase:2,auditlog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,pass,nolog,id:999010,severity:5"
> SecRule "ARGS|ARGS_NAMES" "@rx \\bhttp:" "phase:2,auditlog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,pass,nolog,id:999010,severity:5"
> SecRule "ARGS" "@rx ^(?:ht|f)tp:/" "phase:2,t:none,t:htmlEntityDecode,t:lowercase,capture,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'Remote File Inclusion Attack',id:950117,severity:2"

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From ryan.barnett at breach.com  Mon Aug  3 15:09:39 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 3 Aug 2009 15:09:39 -0400
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-9)
	Syntax error on line 28 of
	optional_rules/modsecurity_crs_42_comment_spam.conf
Message-ID: <200908031509.39440.ryan.barnett@breach.com>

[     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-9?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-9.
----------------------------------

    Resolution: Fixed

Fixed unescaped double-quote issue.  Download latest current release (2.0.1).

> Syntax error on line 28 of 
optional_rules/modsecurity_crs_42_comment_spam.conf
> 
------------------------------------------------------------------------------
>
>                 Key: CORERULES-9
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-9
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>    Affects Versions: 2.0.0
>         Environment: SuSE SLES 10 (x86)
> Apache 2.2.12
> ModSecurity 2.5.9
> ModSecurity Core Rules 2.0 (current)
>            Reporter: Massimiliano Florio
>            Assignee: Ryan Barnett
>
> After upgrading from Core Rules ver. 1.6.1 to ver. 2.0 (with optional_rules) 
I got this error message when starting Apache 2.2.12:
>    Syntax error on line 28 of 
optional_rules/modsecurity_crs_42_comment_spam.conf:
>    SecRule takes two or three arguments, tule target, operator and optional 
action list
> I think there is a missing \ (backslash) near the end of line 27 before the 
second-last " (double quote):
>   ... |httpproxy|<sc|")" \
> should be:
>   ... |httpproxy|<sc|\")" \

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090803/e79d944f/attachment-0001.html 

From dreamice.jiang at gmail.com  Mon Aug  3 22:59:06 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Tue, 4 Aug 2009 10:59:06 +0800
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-8) Filter Bypass Vulnerability
In-Reply-To: <200908031010.15069.ryan.barnett@breach.com>
References: <200907311747.44310.ryan.barnett@breach.com>
	<d5dfca260908020428h3d2f1347k24d1f2b5396b7997@mail.gmail.com>
	<200908031010.15069.ryan.barnett@breach.com>
Message-ID: <d5dfca260908031959h2f66a051pf7621fe9fda656fc@mail.gmail.com>

Dear Ryan,

I mean that when I access http://www.example.com/login.jsp
The websit notice me to login the USER and PASSWORD.
As my username is "admin", the password is also "admin".
When I post this request to server, the posting part is like
this:"...username=admin&password=admin".
This post request is also recoginized as HPP attack.

2009/8/3 Ryan Barnett <ryan.barnett at breach.com>

>  On Sunday 02 August 2009 07:28:37 am Junyong Jiang wrote:
> > Dear Ryan,
> >
> > I have another question about this HPP rule. The definition of HPP attack
> > is that the 'arg_names' includes data segment like "user=a & user=d &
> > user=m & user=i & user=n". The multi-parameter is "user". But if we login
> a
> > user with the same username and password, this is also recognized as HPP
> > attack. For example "username=admin&password=admin". The differences
> > between these two cases are: the multi-parameters are before or after
> "=".
> > I want to know whether need we differentiate these two cases in the HPP
> > detection rules.
> >
>
>
> My understanding of HPP (
> http://www.owasp.org/images/b/ba/AppsecEU09_CarettoniDiPaola_v0.8.pdf) is
> that it includes adding in/injecting new parameters. This can include adding
> in the data before the "=" into the parameter name section or after the "="
> into the parameter payload section. Either way, the attacker is adding in
> new parameters.
>
>
> The issue, then, from the WAF/WebApp perspective is how are multiple
> parameters with the same name treated? See my blog post here -
> http://tacticalwebappsec.blogspot.com/2009/05/http-parameter-pollution.html.
> The two main issues are either business-logic abuse and/or signature
> evasions.
>
>
> In the example you gave, I am not quite sure how this relates to HPP. Yes,
> technically, you are inserting new parameter data, however if there are no
> parameter name duplication, then you are not dealing with two issues listed
> above.
>
>
> Can you explain your question a bit more clearly?
>
>
> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090804/0f5810ca/attachment.html 

From ryan.barnett at breach.com  Tue Aug  4 08:04:50 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Tue, 4 Aug 2009 08:04:50 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-8) Filter Bypass Vulnerability
In-Reply-To: <d5dfca260908031959h2f66a051pf7621fe9fda656fc@mail.gmail.com>
References: <200907311747.44310.ryan.barnett@breach.com>
	<200908031010.15069.ryan.barnett@breach.com>
	<d5dfca260908031959h2f66a051pf7621fe9fda656fc@mail.gmail.com>
Message-ID: <200908040804.50658.ryan.barnett@breach.com>

On Monday 03 August 2009 10:59:06 pm Junyong Jiang wrote:
> Dear Ryan,
>
> I mean that when I access http://www.example.com/login.jsp
> The websit notice me to login the USER and PASSWORD.
> As my username is "admin", the password is also "admin".
> When I post this request to server, the posting part is like
> this:"...username=admin&password=admin". This post request is also
> recoginized as HPP attack.
>

Junyong,
I do not believe that having two payloads that are the same are considered 
HPP.  Please reference any documentation that states otherwise.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com<http://tacticalwebappsec.blogspot.com

> 2009/8/3 Ryan Barnett
> <ryan.barnett at breach.com<mailto:ryan.barnett at breach.com>>
>
> On Sunday 02 August 2009 07:28:37 am Junyong Jiang wrote:
> > Dear Ryan,
> >
> > I have another question about this HPP rule. The definition of HPP attack
> > is that the 'arg_names' includes data segment like "user=a & user=d &
> > user=m & user=i & user=n". The multi-parameter is "user". But if we login
> > a user with the same username and password, this is also recognized as
> > HPP attack. For example "username=admin&password=admin". The differences
> > between these two cases are: the multi-parameters are before or after
> > "=". I want to know whether need we differentiate these two cases in the
> > HPP detection rules.
>
> My understanding of HPP
> (http://www.owasp.org/images/b/ba/AppsecEU09_CarettoniDiPaola_v0.8.pdf) is
> that it includes adding in/injecting new parameters. This can include
> adding in the data before the "=" into the parameter name section or after
> the "=" into the parameter payload section. Either way, the attacker is
> adding in new parameters.
>
>
> The issue, then, from the WAF/WebApp perspective is how are multiple
> parameters with the same name treated? See my blog post here -
> http://tacticalwebappsec.blogspot.com/2009/05/http-parameter-pollution.html
>. The two main issues are either business-logic abuse and/or signature
> evasions.
>
>
> In the example you gave, I am not quite sure how this relates to HPP. Yes,
> technically, you are inserting new parameter data, however if there are no
> parameter name duplication, then you are not dealing with two issues listed
> above.
>
>
> Can you explain your question a bit more clearly?
>
>
> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com<http://tacticalwebappsec.blogspot.com
>/>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090804/cf7f4232/attachment.html 

From chris.datfung at gmail.com  Wed Aug  5 04:40:28 2009
From: chris.datfung at gmail.com (Chris Datfung)
Date: Wed, 5 Aug 2009 11:40:28 +0300
Subject: [Owasp-modsecurity-core-rule-set] error log
Message-ID: <4c9cc6790908050140q4e8d2f1er9f3b8066e2477c2c@mail.gmail.com>

What is causing this error:

ModSecurity: Output filter: Error while forwarding response data (103):
Software caused connection abort

and can I disable or limit this alert using modsecurity 2.5.9?

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090805/4f68acf4/attachment.html 

From ryan.barnett at breach.com  Wed Aug  5 09:08:31 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Wed, 5 Aug 2009 09:08:31 -0400
Subject: [Owasp-modsecurity-core-rule-set] error log
In-Reply-To: <4c9cc6790908050140q4e8d2f1er9f3b8066e2477c2c@mail.gmail.com>
References: <4c9cc6790908050140q4e8d2f1er9f3b8066e2477c2c@mail.gmail.com>
Message-ID: <200908050908.31820.ryan.barnett@breach.com>

On Wednesday 05 August 2009 04:40:28 am Chris Datfung wrote:
> What is causing this error:
>
> ModSecurity: Output filter: Error while forwarding response data (103):
> Software caused connection abort
>
> and can I disable or limit this alert using modsecurity 2.5.9?
>
> Thanks,
> Chris

Chris,
Since this issue is not related to the CRS, I am cross-posting this to the 
ModSecurity User Mail-list.  Brian Rectanus will address these types of issues 
within the Mod code itself.

By the way, there is a similar open Jira ticket here - 
https://www.modsecurity.org/tracker/browse/MODSEC-70

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090805/fa55df3e/attachment.html 

From sofuxro at yahoo.com  Thu Aug  6 07:05:43 2009
From: sofuxro at yahoo.com (clau .)
Date: Thu, 6 Aug 2009 04:05:43 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] (no subject)
Message-ID: <385548.60216.qm@web33307.mail.mud.yahoo.com>

Hi,

I just put in the new core rules and tried to restart apache and got this:

apache2.conf: Syntax error on line 132 of /etc/apa
che2/conf.d/modsecurity/rules/modsecurity_40_generic_attacks.data: /etc/apache2/conf.d/modsecurity/r
ules/modsecurity_40_generic_attacks.data:170: <input> was not closed.\n/etc/apache2/conf.d/modsecuri
ty/rules/modsecurity_40_generic_attacks.data:132: <![cdata[> was not closed.?????????????????????? ?
?? ...fail!???????????????? ?


Can anyone help?

Thanks


      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090806/31561a0f/attachment.html 

From ryan.barnett at breach.com  Thu Aug  6 08:42:10 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Thu, 6 Aug 2009 08:42:10 -0400
Subject: [Owasp-modsecurity-core-rule-set] (no subject)
In-Reply-To: <385548.60216.qm@web33307.mail.mud.yahoo.com>
References: <385548.60216.qm@web33307.mail.mud.yahoo.com>
Message-ID: <200908060842.11135.ryan.barnett@breach.com>

On Thursday 06 August 2009 07:05:43 am clau . wrote:
> Hi,
>
> I just put in the new core rules and tried to restart apache and got this:
>
> apache2.conf: Syntax error on line 132 of /etc/apa
> che2/conf.d/modsecurity/rules/modsecurity_40_generic_attacks.data:
> /etc/apache2/conf.d/modsecurity/r
> ules/modsecurity_40_generic_attacks.data:170: <input> was not
> closed.\n/etc/apache2/conf.d/modsecuri
> ty/rules/modsecurity_40_generic_attacks.data:132: <![cdata[> was not
> closed. ...fail!
>
>
> Can anyone help?
>
> Thanks
What OS and Apache version are you using?  It looks as though your system 
doesn't like the @pmFromFile data, specifically the text that looks like html 
code.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090806/ca4fcfeb/attachment.html 

From Ryan.Barnett at breach.com  Thu Aug  6 08:49:15 2009
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 6 Aug 2009 05:49:15 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-2)
 CD< does not pass mod security filters
Message-ID: <24640.1249562955009.JavaMail.tomcat@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-2?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-2.
----------------------------------

       Resolution: Fixed
    Fix Version/s:     (was: 1.6.2)
                   2.0.0

In the new CRS v2.0.0 rules, the rules use anomaly scoring/collaborative rules.  So, while this particular payload does match, you are able to over-ride it later on and re-adjust the anomaly score.  Here is an example where I sent the following request with the same payload that you sent -

--ba166a09-A--
[05/Aug/2009:18:23:13 --0400] SnoGUX8AAQEAABKJPy8AAACA 192.168.0.100 47476 192.168.0.100 80
--ba166a09-B--
GET /cgi-bin/test-cgi?foo=%3Cli%3ECD%20drive%20if%20installing%20from%20CD%3C/li%3E HTTP/1.1
Host: 192.168.0.100
User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.2) Gecko/20090729 Firefox/3.5.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive

Here is the individual rule match from the modsec_audit.log file -

Message: Pattern match "\bcd\b\W*?[\/]" at TX:pm_data_ARGS:foo. [file "/usr/local/apache/conf/modsecurity-core-rules/base_rules/modsecurity_crs_40_generic_attacks.conf"] [line "244"] [id "958821"] [msg "System Command Injection"] [data "cd</"] [severity "CRITICAL"] [tag "WEB_ATTACK/COMMAND_INJECTION"]

In order to implement an exclusion for this in the new CRS 2.0.0 format, you should add the following entry to the modsecurity_48_local_exceptions.conf file -

SecRule TX:PM_DATA_ARGS:foo "@streq <li>cd drive if installing from cd</li>" "phase:2,t:none,nolog,pass,setvar:tx.anomaly_score=-20"

This rule will inspect the TX variable data that matched from the audit log file to see if the exact false positive payload data is in the argument called foo.  If so, then we will decrement the anomaly score by 20.


> CD< does not pass mod security filters
> --------------------------------------
>
>                 Key: CORERULES-2
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-2
>             Project: Core Rules
>          Issue Type: Improvement
>      Security Level: Normal
>         Environment: CentOS 5.2, Apache module
>            Reporter: ?ilvinas
>            Assignee: Ryan Barnett
>             Fix For: 2.0.0
>
>
> When a string like this is passed through mod security: 
> {noformat}
> "<li>CD drive if installing from CD</li>"
> {noformat}
> It does not pass it's filters.
> Original rule:
> {noformat}
> (?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b
> \W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:assw
> d|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(
> ?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))
> {noformat}
> Our modified rule:
> {noformat}
> (?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b
> \W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\s+[\.\~\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:a
> sswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)
> |p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))
> {noformat}
> Please advise what the correct rule would be.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

       

From ryan.barnett at breach.com  Thu Aug  6 13:05:21 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Thu, 6 Aug 2009 13:05:21 -0400
Subject: [Owasp-modsecurity-core-rule-set] (no subject)
In-Reply-To: <385548.60216.qm@web33307.mail.mud.yahoo.com>
References: <385548.60216.qm@web33307.mail.mud.yahoo.com>
Message-ID: <200908061305.21304.ryan.barnett@breach.com>

On Thursday 06 August 2009 07:05:43 am clau . wrote:
> Hi,
>
> I just put in the new core rules and tried to restart apache and got this:
>
> apache2.conf: Syntax error on line 132 of /etc/apa
> che2/conf.d/modsecurity/rules/modsecurity_40_generic_attacks.data:
> /etc/apache2/conf.d/modsecurity/r
> ules/modsecurity_40_generic_attacks.data:170: <input> was not
> closed.\n/etc/apache2/conf.d/modsecuri
> ty/rules/modsecurity_40_generic_attacks.data:132: <![cdata[> was not
> closed. ...fail!
>
>
> Can anyone help?
>
> Thanks

If wildcarding is pulling in the .data @pmFromFile files, then you should 
explicitly Include each conf rules file.

-Ryan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090806/987bd32a/attachment.html 

From ryan.barnett at breach.com  Mon Aug 10 08:28:50 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 10 Aug 2009 08:28:50 -0400
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-10)
	Updated the transformation functions used in the XSS/SQLi
	rules to increase performance
Message-ID: <200908100828.51015.ryan.barnett@breach.com>

    [ 
https://www.modsecurity.org/tracker/browse/CORERULES-10?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-10.
-----------------------------------

    Resolution: Fixed

> Updated the transformation functions used in the XSS/SQLi rules to increase 
performance
> 
---------------------------------------------------------------------------------------
>
>                 Key: CORERULES-10
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-10
>             Project: Core Rules
>          Issue Type: Improvement
>      Security Level: New
>          Components: Configuration
>    Affects Versions: 2.0.0
>            Reporter: Ryan Barnett
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> The XSS and SQLi rules only need to use the full transformation functions on 
the @pmFromFile pre-qualifier checks.  Then, if/when they set any TX variable 
data on matched content, the remaining SQLi rules inspect that TX data.  In 
this case, the data has already been transformed so t:none is appropriate.

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090810/868f2e24/attachment.html 

From ryan.barnett at breach.com  Mon Aug 10 08:29:53 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 10 Aug 2009 08:29:53 -0400
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-11)
	Updated the variable/target list in the XSS rules
Message-ID: <200908100829.53494.ryan.barnett@breach.com>

     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-11?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-11.
-----------------------------------

    Resolution: Fixed

> Updated the variable/target list in the XSS rules
> -------------------------------------------------
>
>                 Key: CORERULES-11
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-11
>             Project: Core Rules
>          Issue Type: Improvement
>      Security Level: New
>          Components: Configuration
>    Affects Versions: 2.0.0
>            Reporter: Ryan Barnett
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> We are updating the target variable list used in the XSS rules to lessen 
false negatives.  We are now using REQUEST_URI_RAW|REQUEST_BODY

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090810/952b792f/attachment.html 

From ryan.barnett at breach.com  Mon Aug 10 08:30:17 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 10 Aug 2009 08:30:17 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-12) Added XSS Filters from IE8
Message-ID: <200908100830.17969.ryan.barnett@breach.com>

     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-12?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-12.
-----------------------------------

    Resolution: Fixed

> Added XSS Filters from IE8
> --------------------------
>
>                 Key: CORERULES-12
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-12
>             Project: Core Rules
>          Issue Type: Improvement
>      Security Level: New
>          Components: Configuration
>    Affects Versions: 2.0.0
>            Reporter: Ryan Barnett
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> Implemented XSS Filters from Internet Explorer 8.
> http://blogs.technet.com/srd/archive/2008/08/18/ie-8-xss-filter-architecture-
implementation.aspx

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090810/2a02ce2e/attachment.html 

From ndrsslzr80 at gmail.com  Mon Aug 10 12:13:40 2009
From: ndrsslzr80 at gmail.com (Andres Salazar)
Date: Mon, 10 Aug 2009 11:13:40 -0500
Subject: [Owasp-modsecurity-core-rule-set] Rules that give false positives,
	how to recognize the rule to be able 	to remove it?
Message-ID: <d7491310908100913x5ea4dc8blfe9c6b8903c124f2@mail.gmail.com>

Hello,

I have some rules that in my particular case are giving false
positives (these  are part of the generic mysql inyections). I have
tried searching in google for the answer to this and the documentation
in the site and the best help I was able to see was that it was needed
to setup the Debug Level at least to 4 or 5 . I have set it to 5 but
now I have an infinite amount of logs. Exactly what would I be looking
for to know what rule matched according to the error in the audit_log?

Thank you!!

Andres

From ryan.barnett at breach.com  Mon Aug 10 15:53:20 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 10 Aug 2009 15:53:20 -0400
Subject: [Owasp-modsecurity-core-rule-set]
 =?iso-8859-1?q?Rules_that_give_?=
 =?iso-8859-1?q?false_positives=2C_how_to_recognize_the_rule_to_be_able_?=
 =?iso-8859-1?q?=09to_remove_it=3F?=
In-Reply-To: <d7491310908100913x5ea4dc8blfe9c6b8903c124f2@mail.gmail.com>
References: <d7491310908100913x5ea4dc8blfe9c6b8903c124f2@mail.gmail.com>
Message-ID: <200908101553.20250.ryan.barnett@breach.com>

On Monday 10 August 2009 12:13:40 pm Andres Salazar wrote:
> Hello,
>
> I have some rules that in my particular case are giving false
> positives (these  are part of the generic mysql inyections). I have
> tried searching in google for the answer to this and the documentation
> in the site and the best help I was able to see was that it was needed
> to setup the Debug Level at least to 4 or 5 . I have set it to 5 but
> now I have an infinite amount of logs. Exactly what would I be looking
> for to know what rule matched according to the error in the audit_log?
>
> Thank you!!
>
> Andres

Hello Andres,
First of all, are you using the new ModSecurity Core Rule Set (CRS) v 2.0.1?  
If not, I would suggest that you upgrade.  If you are still having the issue 
(or if you are currently using v2.0.1) then send me an example audit log entry 
of a false positive match and I will send back an exception example.

Thanks.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090810/2261d6bf/attachment.html 

From ndrsslzr80 at gmail.com  Mon Aug 10 16:13:32 2009
From: ndrsslzr80 at gmail.com (Andres Salazar)
Date: Mon, 10 Aug 2009 15:13:32 -0500
Subject: [Owasp-modsecurity-core-rule-set] Rules that give false
	positives, how to recognize the rule to be 	able to remove it?
In-Reply-To: <d7491310908101312x4dbf341k9ed67cfe36037600@mail.gmail.com>
References: <d7491310908100913x5ea4dc8blfe9c6b8903c124f2@mail.gmail.com>
	<200908101553.20250.ryan.barnett@breach.com>
	<d7491310908101312x4dbf341k9ed67cfe36037600@mail.gmail.com>
Message-ID: <d7491310908101313x26293cfbsd11c54e23733c8bc@mail.gmail.com>

Actually I was using the rules (yes i know they are no longer
supported) for apache 1.3

Is this new 2.0.1 version also compatible with apache 1.3?

Otherwise I just need to know how to match the rules so that i can
disable that particular rule if possible.

Thank you very much Ryan.

Regards,
Andres

On Mon, Aug 10, 2009 at 2:53 PM, Ryan Barnett<ryan.barnett at breach.com> wrote:
> On Monday 10 August 2009 12:13:40 pm Andres Salazar wrote:
>> Hello,
>>
>> I have some rules that in my particular case are giving false
>> positives (these are part of the generic mysql inyections). I have
>> tried searching in google for the answer to this and the documentation
>> in the site and the best help I was able to see was that it was needed
>> to setup the Debug Level at least to 4 or 5 . I have set it to 5 but
>> now I have an infinite amount of logs. Exactly what would I be looking
>> for to know what rule matched according to the error in the audit_log?
>>
>> Thank you!!
>>
>> Andres
>
> Hello Andres,
> First of all, are you using the new ModSecurity Core Rule Set (CRS) v 2.0.1?
> If not, I would suggest that you upgrade. If you are still having the issue
> (or if you are currently using v2.0.1) then send me an example audit log
> entry of a false positive match and I will send back an exception example.
>
> Thanks.
>
> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com

From gvidals at vmracks.com  Tue Aug 11 06:40:43 2009
From: gvidals at vmracks.com (Gil Vidals)
Date: Tue, 11 Aug 2009 03:40:43 -0700
Subject: [Owasp-modsecurity-core-rule-set] anomaly score range
Message-ID: <bdc0238f0908110340v33d0a835xb2e7d2c8cac4bd2a@mail.gmail.com>

I just installed the latest core rules and I see this anomaly score:

    SecRule TX:ANOMALY_SCORE "@ge 20" \

What is the range of the anomaly scores? Does it go from 0 to 100?

I need help in understanding the score and what to set it to. Currently I
have it set to 10.

The only documenation I could find so far is:
# Uncomment the anomaly sections you wish to use.
# You should set the score to the proper threshold you would prefer. If kept
at "@gt 0"
# it will work similarly to previous Mod CRS rules and will create an event
in the error_log
# file if there are any rules that match.  If you would like to lessen the
number of events
# generated in the error_log file, you should increase the anomaly score
threshold to
# something like "@gt 20".  This would only generate an event in the
error_log file if
# there are multiple lower severity rule matches or if any 1 higher severity
item matches.
#
# You should also set the desired disruptive action (deny, redirect,
etc...).


--Gil




Gil Vidals / President
gvidals at vmracks.com
vmracks.com <http://www.vmracks.com> - ESX Hosting
t. 760.480.4942 f. 760.480.8271
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090811/6f968ed3/attachment.html 

From ryan.barnett at breach.com  Tue Aug 11 13:50:12 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Tue, 11 Aug 2009 13:50:12 -0400
Subject: [Owasp-modsecurity-core-rule-set] anomaly score range
In-Reply-To: <bdc0238f0908110340v33d0a835xb2e7d2c8cac4bd2a@mail.gmail.com>
References: <bdc0238f0908110340v33d0a835xb2e7d2c8cac4bd2a@mail.gmail.com>
Message-ID: <200908111350.12627.ryan.barnett@breach.com>



Ryan Barnett
Director of Application Security Research
Phone: (703) 794-2248
Cell: (703) 269-8998
Breach Security, Inc.
2141 Palomar Airport Road, Suite 200
Carlsbad, CA 92011
www.breach.com

On Tuesday 11 August 2009 06:40:43 am Gil Vidals wrote:
> I just installed the latest core rules and I see this anomaly score:
>
>     SecRule TX:ANOMALY_SCORE "@ge 20" \
>
> What is the range of the anomaly scores? Does it go from 0 to 100?
>
> I need help in understanding the score and what to set it to. Currently I
> have it set to 10.
>
> The only documenation I could find so far is:
> # Uncomment the anomaly sections you wish to use.
> # You should set the score to the proper threshold you would prefer. If
> kept at "@gt 0" # it will work similarly to previous Mod CRS rules and will
> create an event in the error_log # file if there are any rules that match. 
> If you would like to lessen the number of events # generated in the
> error_log file, you should increase the anomaly score threshold to #
> something like "@gt 20".  This would only generate an event in the
> error_log file if # there are multiple lower severity rule matches or if
> any 1 higher severity item matches. #
> # You should also set the desired disruptive action (deny, redirect,
> etc...).
>
>
> --Gil
>

Hey Gil,
Yeah, the OWASP CRS project - Documentation section will need to be filled out 
with this type of information about how the anomaly scoring works.  Side note 
- one benefit of moving the CRS to OWASP is that the project is wiki-based now 
so anyone can help to update the documentation.  So, if anyone wants to help 
out, please jump in!

In previous versions of the CRS, each rule was self-contained.  This means 
that the rule would inspect the specified variable/targets with the operator 
data chosen (usually a regular expression) and then the action list would 
specify both the logging and blocking settings.

The idea with new CRS is that we want the rules to be more collaborative 
meaning that we have decoupled the logging/blocking actions from the rules 
that do the initial inspection.  Most of the inspection rules will issue a 
setvar to increase the TX anomaly score data for the current transaction and 
this score will be evaluated at the last possible request blocking point at 
the end of phase:2.  The scoring numbers are tied to the severity levels of 
the issue.  Take a look at the updated Severity data from the CHANGELOG file -

- Updated Severity Ratings
    The severity ratings in the rules have been updated to the following:
    - 0: Emergency - is generated from correlation where there is an inbound attack and
         an outbound leakage.
    - 1: Alert - is generated from correlation where there is an inbound attack and an
         outbound application level error.
    - 2: Critical - is the highest severity level possible without correlation.  It is
         normally generated by the web attack rules (40 level files).
    - 3: Error - is generated mostly from outbound leakage rules (50 level files).
    - 4: Warning - is generated by malicious client rules (35 level files).
    - 5: Notice - is generated by the Protocol policy and anomaly files.
    - 6: Info - is generated by the search engine clients (55 marketing file). 
The normal web attack categories (such as XSS and SQL Injection, etc...) have 
a severity of 2/Critical and will increase the score by 20 points.  3/Error = 
15 points, 4/Warning = 10 points and 5/Notice is 5 points.

So, what all of this means, in relation to the modsecurity_49_enforcement.conf 
file, is that you can set an anomaly scoring threshold that you deem 
appropriate for your site.  These thresholds can control logging and/or 
blocking.  For instance, let's say that you don't really care about clients 
that are missing 1 or 2 request headers (which is something that is flagged in 
the 21 protocol anomalies file), then you should set your anomaly score at 15.  
This means that if a client violates any 2 of the severity 5 rules, this would 
only amount to an anomaly score of 10.  If, however, they violate any 3 
severity 5 issues, then they would trigger.  In the previous CRS, the XSS/SQLi 
types of rules issued blocking actions so that is why the comment section 
above mentions setting the score to 20.  This would result in an anomaly 
scoring match if *any* severity 2 rule matches.
 
Another item to consider with anomaly scoring and that is that you can 
actually combine 2 issues together - 

1) Confidence level in blocking
Due to the fact that we have broken out the highly optimized regex, this means 
that we have many more individual rules that could possibly contribute to an 
anomaly score.  This means that the *higher* the anomaly score, the more 
confident you can be that something malicious is being detected.

2) Handling exceptions
If you are running into a false positive match, for say an XSS attack, against 
one particular parameter payload in your app, chances are that the anomaly 
score for it is rather low and is just barely going over it.  An exception may 
be as easy as bumping up the anomaly score by 20 points.  There are other 
exceptions mechanisms (that we will document later on the OWASP site) that are 
easy as well but this is the easiest.

Hopefully this info helps.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com



-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090811/2dc56a01/attachment.html 

From bad_brain at suck-o.com  Tue Aug 11 15:38:03 2009
From: bad_brain at suck-o.com (bad_brain // suck-o.com)
Date: Tue, 11 Aug 2009 21:38:03 +0200
Subject: [Owasp-modsecurity-core-rule-set] phpnuke/phpbb login problem with
	2.0.1 crs
Message-ID: <4A81C89B.6040202@suck-o.com>

hey there...;)

when using the 2.0.1 crs users can't login anymore to phpbb/phpnuke, and 
I am a little confused by the triggered rule because I can't find the ID 
to set an exception like I did it in 1.6.1.
here is the log entry:

Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file 
"/etc/modsecurity2/base_rules/modsecurity_crs_60_correlation.conf"] 
[line "41"] [msg "Transactional Anomaly Score (score 20): Blind SQL 
Injection Attack"]
Action: Intercepted (phase 2)
Stopwatch: 1250012515250667 12627 (2426* 10440 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); 
core ruleset/2.0.1.



I have commented the rule out to test it, but the request is still 
blocked, this time even without naming any explicit rule being triggered:

Action: Intercepted (phase 2)
Stopwatch: 1250012698532648 23056 (6157* 15148 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); 
core ruleset/2.0.1.

-- 
kind regards,
bad_brain
~owner/administrator of the suck-o network~


================================================================
This email was digitally signed:

SHA1 Fingerprint
CF:75:0E:F3:DE:F5:36:D7:84:43:00:91:23:4E:E0:5E:55:34:13:5A

MD5 Fingerprint
F2:00:4E:A7:17:DB:A2:54:9B:9A:BA:AB:73:02:36:97

Add my key and send me yours, encryption means privacy!
================================================================

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 4685 bytes
Desc: S/MIME Cryptographic Signature
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090811/b0152a0b/attachment-0001.bin 

From ryan.barnett at breach.com  Tue Aug 11 16:27:08 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Tue, 11 Aug 2009 16:27:08 -0400
Subject: [Owasp-modsecurity-core-rule-set] phpnuke/phpbb login problem
	with 2.0.1 crs
In-Reply-To: <4A81C89B.6040202@suck-o.com>
References: <4A81C89B.6040202@suck-o.com>
Message-ID: <200908111627.09163.ryan.barnett@breach.com>

On Tuesday 11 August 2009 03:38:03 pm bad_brain // suck-o.com wrote:
> hey there...;)
>

Hey, welcome :)

> when using the 2.0.1 crs users can't login anymore to phpbb/phpnuke, and
> I am a little confused by the triggered rule because I can't find the ID
> to set an exception like I did it in 1.6.1.

The event logging has changed in v2.0.x so that *only* correlated events will 
show up within the Apache error_log file.  This was designed to help error_log 
event monitoring.  All of the rules are configured to log an event to the audit 
log but not to the error_log (using nolog,auditlog setting).  By a correlated 
event, I mean that the evaluation of the anomaly score at the end of phase:2.  
As the individual rules are setting TX variables when the rules match, it is 
also setting tx.msg data that is displayed in correlated event.

> here is the log entry:
>
> Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
> "/etc/modsecurity2/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score (score 20): Blind SQL
> Injection Attack"]
> Action: Intercepted (phase 2)
> Stopwatch: 1250012515250667 12627 (2426* 10440 -)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
> core ruleset/2.0.1.
>

This correlated event tells you that the anomaly score is 20 and that the rule 
that matched was in the Blind SQ Injection category.  In order to identify the 
actual, individual rule that matched, you will need to review the audit log 
entry for this transaction and the normal Message event details will be there 
for you (as it was in older CRS) that will include the rule ID data.

>
>
> I have commented the rule out to test it, but the request is still
> blocked, this time even without naming any explicit rule being triggered:
>
> Action: Intercepted (phase 2)
> Stopwatch: 1250012698532648 23056 (6157* 15148 -)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
> core ruleset/2.0.1.
>

If you identify a false positive issue, you can implement a custom exception 
by adding a rule to the modsecurity_crs_48_local_exceptions.conf file.  The file 
provides some exception examples and you can also review an example in this 
recent JIRA ticket - https://www.modsecurity.org/tracker/browse/CORERULES-2

The idea is that you need to know what the TX variable data looks like for the 
false positive and then you create an exception that looks for that *exact* 
data and then it corrects that anomaly score be decrementing it by 20 points.
  
One other item that I would recommend is to change the "deny" action in the 
modsecurity_crs_49_enforcement.conf file to "pass" if you want to run in a 
simulation/detection-only mode while testing the new CRS.

# Alert and Deny on High Anomaly Scores
#
SecRule TX:ANOMALY_SCORE "@ge 20" \
    "phase:2,t:none,nolog,auditlog,pass,msg:'Anomaly Score Exceeded (score 
%{TX.ANOMALY_SCORE}): %{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg}"

Let me know if you need any more help.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090811/f0bd590f/attachment.html 

From ryan.barnett at breach.com  Wed Aug 12 09:31:16 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Wed, 12 Aug 2009 09:31:16 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-5) False positive with Joomla and javascript
Message-ID: <200908120931.16726.ryan.barnett@breach.com>

     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-5?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-5.
----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Please download and use the CRS v2.0.1 package as the XSS rule sets have been 
significantly updated.

> False positive with Joomla and javascript
> -----------------------------------------
>
>                 Key: CORERULES-5
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-5
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>         Environment: CentoOS, Apache
>            Reporter: Hari Karam Singh
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> Not sure if this is the place for false positives but the script says to 
report them!
> This rule:
> SecRule REQUEST_URI|REQUEST_BODY "<[[:space:]]*(script|about|applet|activex|
chrome)*>.*(script|about|applet|activex|chrome)[[:space:]]*>"
> Blocks Joomla (or any CMS for that matter) from submitting web content that 
contains javascript which is often desirable to allow (like for admins).

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090812/9a9aad71/attachment.html 

From ossec.junkie at gmail.com  Wed Aug 12 20:54:56 2009
From: ossec.junkie at gmail.com (OSSEC junkie)
Date: Wed, 12 Aug 2009 17:54:56 -0700
Subject: [Owasp-modsecurity-core-rule-set] help with blocking
Message-ID: <869a38360908121754o3d73bb3bj10d569c65d2c4a8d@mail.gmail.com>

it appears this type of string is getting past ModSecurity, can you help me
out here?

%22;}eval%28%27al%27%2b%27ert%28docu%27%2b%27ment.c%27%2b%27ookie%29%27%29;function%20a%28%29{var%20a=%22


With this string put against one of our parameters, ModSecurity doesnt see
it.  Any advice?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090812/0229f1fe/attachment.html 

From dreamice.jiang at gmail.com  Thu Aug 13 05:02:47 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Thu, 13 Aug 2009 17:02:47 +0800
Subject: [Owasp-modsecurity-core-rule-set] About file upload with trojan
	horse detect
Message-ID: <d5dfca260908130202g13ff6d71odafa6bab7874abb4@mail.gmail.com>

Dear all,

Right now, I have a problem with the file upload with trojan horse.
Unfortunately, there are no modsecurity rules for checking the upload-file
contents, either the file type.

Could some one offer your own testing rules of detecting the "file upload
with trojan horse" behavior for me to study?

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090813/73dfedd7/attachment.html 

From ryan.barnett at breach.com  Thu Aug 13 11:42:23 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Thu, 13 Aug 2009 11:42:23 -0400
Subject: [Owasp-modsecurity-core-rule-set] help with blocking
In-Reply-To: <869a38360908121754o3d73bb3bj10d569c65d2c4a8d@mail.gmail.com>
References: <869a38360908121754o3d73bb3bj10d569c65d2c4a8d@mail.gmail.com>
Message-ID: <200908131142.23257.ryan.barnett@breach.com>

On Wednesday 12 August 2009 08:54:56 pm OSSEC junkie wrote:
> it appears this type of string is getting past ModSecurity, can you help me
> out here?
> %22;}eval%28%27al%27%2b%27ert%28docu%27%2b%27ment.c%27%2b%27ookie%29%27%29;
>function%20a%28%29{var%20a=%22
>
> With this string put against one of our parameters, ModSecurity doesnt see
> it.  Any advice?

I just tested with this request - 

http://www.example.com/cgi-
bin/printenv?foo=%22;}eval%28%27al%27%2b%27ert%28docu%27%2b%27ment.c%27%2b%27ookie%29%27%29;function%20a%28%29{var%20a=%22

and this payload is identified by a few different signatures in the 
modsecurity_crs_41_xss_attacks.conf file.  Here are some of the matches from 
the modsec_audit.log data -

Message: Pattern match "(?i:["\'][ ]*(([^a-z0-9~_:\'" ])|(in)).+?(([.].+?)|
([\[].*?[\]].*?))=)" at ARGS:foo. [file "/usr/local/apache/conf/mod
security-core-rules/base_rules/modsecurity_crs_41_xss_attacks.conf"] [line 
"45"] [msg "IE XSS Filters - Attack Detected"]
Message: Pattern match "(?i:["\'][ ]*(([^a-z0-9~_:\'" ])|(in)).+?\(.*?\))" at 
ARGS:foo. [file "/usr/local/apache/conf/modsecurity-core-rules/b
ase_rules/modsecurity_crs_41_xss_attacks.conf"] [line "49"] [msg "IE XSS 
Filters - Attack Detected"]
Message: Pattern match "(fromcharcode|alert|eval)\s*\(" at ARGS:foo. [file 
"/usr/local/apache/conf/modsecurity-core-rules/base_rules/modsecuri
ty_crs_41_xss_attacks.conf"] [line "414"] [msg "XSS Attack Detected"]

A few questions -

1) Are you using the latest CRS v2.0.1?  We added these Internet Explorer (IE) 
XSS filters to the 2.0.1 version.

2) What is the exact request data?  Is this payload sent in a query_string or 
a post payload?  An audit log example would help for testing.

3) Where did this payload come from?  Are you using a particular tool?  

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090813/3e0681ce/attachment.html 

From ryan.barnett at breach.com  Thu Aug 13 11:47:27 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Thu, 13 Aug 2009 11:47:27 -0400
Subject: [Owasp-modsecurity-core-rule-set] About file upload with trojan
	horse detect
In-Reply-To: <d5dfca260908130202g13ff6d71odafa6bab7874abb4@mail.gmail.com>
References: <d5dfca260908130202g13ff6d71odafa6bab7874abb4@mail.gmail.com>
Message-ID: <200908131147.27275.ryan.barnett@breach.com>

On Thursday 13 August 2009 05:02:47 am Junyong Jiang wrote:
> Dear all,
>
> Right now, I have a problem with the file upload with trojan horse.
> Unfortunately, there are no modsecurity rules for checking the upload-file
> contents, either the file type.
>
> Could some one offer your own testing rules of detecting the "file upload
> with trojan horse" behavior for me to study?
>
> Thanks in advance.

Could you please provide more details about what the issue is?  I am guessing 
that you want to try and identify is a client uses a file upload interface 
(that your application offers) to upload a webpage that allows for executing OS 
commands, etc...  Is this accurate?  

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090813/995feeea/attachment.html 

From dreamice.jiang at gmail.com  Thu Aug 13 21:42:38 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Fri, 14 Aug 2009 09:42:38 +0800
Subject: [Owasp-modsecurity-core-rule-set] About file upload with trojan
	horse detect
In-Reply-To: <200908131147.27275.ryan.barnett@breach.com>
References: <d5dfca260908130202g13ff6d71odafa6bab7874abb4@mail.gmail.com>
	<200908131147.27275.ryan.barnett@breach.com>
Message-ID: <d5dfca260908131842k69027010rde7fe00d6d95a8fb@mail.gmail.com>

Ryan,

Thanks for your reply.

Yes, the client client uses a file upload interface to upload a file, for
example a.asp. Then he access a.asp and excute the code in a.asp.
I do not know how to prevent the attack. Can we check the upload-file's type
when client upload this file? sometimes, the attacker may modify the suffix
of the file for cheating de file-suffix checking.

Could you give me some advice?

Thanks.




2009/8/13 Ryan Barnett <ryan.barnett at breach.com>

>   On Thursday 13 August 2009 05:02:47 am Junyong Jiang wrote:
> > Dear all,
> >
> > Right now, I have a problem with the file upload with trojan horse.
> > Unfortunately, there are no modsecurity rules for checking the
> upload-file
> > contents, either the file type.
> >
> > Could some one offer your own testing rules of detecting the "file upload
> > with trojan horse" behavior for me to study?
> >
> > Thanks in advance.
>
>
> Could you please provide more details about what the issue is? I am
> guessing that you want to try and identify is a client uses a file upload
> interface (that your application offers) to upload a webpage that allows for
> executing OS commands, etc... Is this accurate?
>
>
> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090814/9c7dfcd9/attachment.html 

From ryan.barnett at breach.com  Fri Aug 14 13:30:17 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 14 Aug 2009 13:30:17 -0400
Subject: [Owasp-modsecurity-core-rule-set] About file upload with trojan
	horse detect
In-Reply-To: <d5dfca260908131842k69027010rde7fe00d6d95a8fb@mail.gmail.com>
References: <d5dfca260908130202g13ff6d71odafa6bab7874abb4@mail.gmail.com>
	<200908131147.27275.ryan.barnett@breach.com>
	<d5dfca260908131842k69027010rde7fe00d6d95a8fb@mail.gmail.com>
Message-ID: <200908141330.17268.ryan.barnett@breach.com>

On Thursday 13 August 2009 09:42:38 pm Junyong Jiang wrote:
> Ryan,
>
> Thanks for your reply.
>
> Yes, the client client uses a file upload interface to upload a file, for
> example a.asp. Then he access a.asp and excute the code in a.asp. I do not
> know how to prevent the attack. Can we check the upload-file's type when
> client upload this file? sometimes, the attacker may modify the suffix of
> the file for cheating de file-suffix checking.
>
> Could you give me some advice?
>

The CRS already has backdoor access rules in the 
modsecurity_crs_45_trojans.conf file.  These rules will identify if/when a 
client tries to access a backdoor webpage.  These rules are important as users 
can possibly upload these files through non-web protocols (FTP, etc...).  In 
your case, however, you want to prevent the files from being uploaded through 
the web interface to begin with.  What you could possibly do is to take the 
trojan access rules from the 45 file and apply the same signatures to the 
REQUEST_BODY variable instead of RESPONSE_BODY.  This may work somewhat but it 
is not foolproof.  If you have some examples of the backdoor html code, you 
could create some rules based on it.

-Ryan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090814/79531561/attachment.html 

From ivan.ristic at gmail.com  Fri Aug 14 16:18:21 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Fri, 14 Aug 2009 21:18:21 +0100
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
Message-ID: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>

Hi,

I've noticed that the new Core Rules have configuration bits in them
-- just like the previous version -- but I don't think that's the
right thing to do. I think most users will want to update their rules
regularly, but if the configuration bits are there they will be forced
to do the whole thing manually every time.

On the topic of updates, are there any plans to use the auto-update
script in the future?

-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/

From ryan.barnett at breach.com  Fri Aug 14 17:22:38 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 14 Aug 2009 17:22:38 -0400
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
Message-ID: <200908141722.38552.ryan.barnett@breach.com>

On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
> Hi,
>
> I've noticed that the new Core Rules have configuration bits in them
> -- just like the previous version -- but I don't think that's the
> right thing to do. I think most users will want to update their rules
> regularly, but if the configuration bits are there they will be forced
> to do the whole thing manually every time.
>

What exactly do you mean by "configuration bits?"

> On the topic of updates, are there any plans to use the auto-update
> script in the future?
>

Yes, actually.  Brian and I just tested some things recently and we are 
getting close.  We need to work out a few more issues but it should be working 
soon.

-Ryan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090814/6e862b21/attachment.html 

From dreamice.jiang at gmail.com  Fri Aug 14 19:47:07 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Sat, 15 Aug 2009 07:47:07 +0800
Subject: [Owasp-modsecurity-core-rule-set] About file upload with trojan
	horse detect
In-Reply-To: <200908141330.17268.ryan.barnett@breach.com>
References: <d5dfca260908130202g13ff6d71odafa6bab7874abb4@mail.gmail.com>
	<200908131147.27275.ryan.barnett@breach.com>
	<d5dfca260908131842k69027010rde7fe00d6d95a8fb@mail.gmail.com>
	<200908141330.17268.ryan.barnett@breach.com>
Message-ID: <d5dfca260908141647q1eafe4dck1ec84dcf72481e1c@mail.gmail.com>

Thank you Ryan for your suggestions, I will have a try.

2009/8/15 Ryan Barnett <ryan.barnett at breach.com>

>  On Thursday 13 August 2009 09:42:38 pm Junyong Jiang wrote:
> > Ryan,
> >
> > Thanks for your reply.
> >
> > Yes, the client client uses a file upload interface to upload a file, for
> > example a.asp. Then he access a.asp and excute the code in a.asp. I do
> not
> > know how to prevent the attack. Can we check the upload-file's type when
> > client upload this file? sometimes, the attacker may modify the suffix of
> > the file for cheating de file-suffix checking.
> >
> > Could you give me some advice?
> >
>
>
> The CRS already has backdoor access rules in the
> modsecurity_crs_45_trojans.conf file. These rules will identify if/when a
> client tries to access a backdoor webpage. These rules are important as
> users can possibly upload these files through non-web protocols (FTP,
> etc...). In your case, however, you want to prevent the files from being
> uploaded through the web interface to begin with. What you could possibly do
> is to take the trojan access rules from the 45 file and apply the same
> signatures to the REQUEST_BODY variable instead of RESPONSE_BODY. This may
> work somewhat but it is not foolproof. If you have some examples of the
> backdoor html code, you could create some rules based on it.
>
>
> -Ryan
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090815/73fef1bb/attachment.html 

From ivan.ristic at gmail.com  Sun Aug 16 05:45:03 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Sun, 16 Aug 2009 10:45:03 +0100
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <200908141722.38552.ryan.barnett@breach.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<200908141722.38552.ryan.barnett@breach.com>
Message-ID: <1f9222b70908160245u257c1d45k6f62a6944c344885@mail.gmail.com>

On Fri, Aug 14, 2009 at 10:22 PM, Ryan Barnett<ryan.barnett at breach.com> wrote:
> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>> Hi,
>>
>> I've noticed that the new Core Rules have configuration bits in them
>> -- just like the previous version -- but I don't think that's the
>> right thing to do. I think most users will want to update their rules
>> regularly, but if the configuration bits are there they will be forced
>> to do the whole thing manually every time.
>>
>
> What exactly do you mean by "configuration bits?"

I mean the contents of the modsecurity_crs_10_config.conf and
modsecurity_crs_10_global_config.conf. Those two belong to the main
ModSecurity distribution, rather than the rules.

-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/

From eliyahu.cohen1 at yahoo.com  Mon Aug 17 10:53:19 2009
From: eliyahu.cohen1 at yahoo.com (eliyahu cohen)
Date: Mon, 17 Aug 2009 07:53:19 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] bypass rule 950006
Message-ID: <438414.37156.qm@web111010.mail.gq1.yahoo.com>

I'm getting false positive alerts for rule 950006 for several scripts via the ViewState parameter. How do I disable this rule just when it fires on the ViewState parameter for any script?

As an aside, when I went to download the lastest ruleset, it says that its alpha quality. Does that mean that the ruleset is not ready for production use?

Thanks,
Eli


      

From ryan.barnett at breach.com  Mon Aug 17 11:06:05 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 17 Aug 2009 11:06:05 -0400
Subject: [Owasp-modsecurity-core-rule-set] bypass rule 950006
In-Reply-To: <438414.37156.qm@web111010.mail.gq1.yahoo.com>
References: <438414.37156.qm@web111010.mail.gq1.yahoo.com>
Message-ID: <200908171106.05138.ryan.barnett@breach.com>

On Monday 17 August 2009 10:53:19 am eliyahu cohen wrote:
> I'm getting false positive alerts for rule 950006 for several scripts via
> the ViewState parameter. How do I disable this rule just when it fires on
> the ViewState parameter for any script?
>
> As an aside, when I went to download the lastest ruleset, it says that its
> alpha quality. Does that mean that the ruleset is not ready for production
> use?
>
> Thanks,
> Eli
>
Hey Eli,
Take a look at my recent response to this CRS Jira ticket for a false positive 
- https://www.modsecurity.org/tracker/browse/CORERULES-2

For your particular issue, you can probably use a rule similar to this in the 
modsecurity_crs_48_local_exceptions.conf file -

SecRule &TX:/ARGS:ViewState/ "@gt 0" 
"phase:2,t:none,nolog,pass,setvar:tx.anomaly_score=-20" 

This will check the TX variables for any that matched on the ViewState 
parameter data and then decrement the overall anomaly score by 20.

If you provide some more details as to the exact category/individual rule 
matches then we could improve the exception handling.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com


-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090817/fee58c66/attachment.html 

From Brian.Rectanus at breach.com  Mon Aug 17 11:46:44 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Mon, 17 Aug 2009 08:46:44 -0700
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
 with configuration
In-Reply-To: <1f9222b70908160245u257c1d45k6f62a6944c344885@mail.gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>	<200908141722.38552.ryan.barnett@breach.com>
	<1f9222b70908160245u257c1d45k6f62a6944c344885@mail.gmail.com>
Message-ID: <4A897B64.3030800@breach.com>

Ivan Ristic wrote:
> On Fri, Aug 14, 2009 at 10:22 PM, Ryan Barnett<ryan.barnett at breach.com>  wrote:
>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>>> Hi,
>>>
>>> I've noticed that the new Core Rules have configuration bits in them
>>> -- just like the previous version -- but I don't think that's the
>>> right thing to do. I think most users will want to update their rules
>>> regularly, but if the configuration bits are there they will be forced
>>> to do the whole thing manually every time.
>>>
>> What exactly do you mean by "configuration bits?"
>
> I mean the contents of the modsecurity_crs_10_config.conf and
> modsecurity_crs_10_global_config.conf. Those two belong to the main
> ModSecurity distribution, rather than the rules.

We should probably deliver these as:

modsecurity_crs_10_config.conf.example
modsecurity_crs_10_global_config.conf.example

And have instructions to copy them to the correct name and change the 
renamed versions.

-B

-- 
Brian Rectanus
Breach Security

From ivan.ristic at gmail.com  Mon Aug 17 14:13:40 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Mon, 17 Aug 2009 19:13:40 +0100
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <4A897B64.3030800@breach.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<200908141722.38552.ryan.barnett@breach.com>
	<1f9222b70908160245u257c1d45k6f62a6944c344885@mail.gmail.com>
	<4A897B64.3030800@breach.com>
Message-ID: <1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>

On Mon, Aug 17, 2009 at 4:46 PM, Brian
Rectanus<Brian.Rectanus at breach.com> wrote:
> Ivan Ristic wrote:
>>
>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan Barnett<ryan.barnett at breach.com>
>> ?wrote:
>>>
>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>>>>
>>>> Hi,
>>>>
>>>> I've noticed that the new Core Rules have configuration bits in them
>>>> -- just like the previous version -- but I don't think that's the
>>>> right thing to do. I think most users will want to update their rules
>>>> regularly, but if the configuration bits are there they will be forced
>>>> to do the whole thing manually every time.
>>>>
>>> What exactly do you mean by "configuration bits?"
>>
>> I mean the contents of the modsecurity_crs_10_config.conf and
>> modsecurity_crs_10_global_config.conf. Those two belong to the main
>> ModSecurity distribution, rather than the rules.
>
> We should probably deliver these as:
>
> modsecurity_crs_10_config.conf.example
> modsecurity_crs_10_global_config.conf.example
>
> And have instructions to copy them to the correct name and change the
> renamed versions.

I know the line (between ModSecurity itself and Core Rule Set) can be
blurry, but why not keep the configuration in ModSecurity, so that the
Core Rule Set could include only the rules.

Actually, I've been working on an improved default configuration for
ModSecurity, which I would like to submit for inclusion in the
distribution.


> -B
>
> --
> Brian Rectanus
> Breach Security


-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/

From Brian.Rectanus at breach.com  Mon Aug 17 14:38:17 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Mon, 17 Aug 2009 11:38:17 -0700
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
 with configuration
In-Reply-To: <1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>	
	<200908141722.38552.ryan.barnett@breach.com>	
	<1f9222b70908160245u257c1d45k6f62a6944c344885@mail.gmail.com>	
	<4A897B64.3030800@breach.com>
	<1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>
Message-ID: <4A89A399.80405@breach.com>

Ivan Ristic wrote:
> On Mon, Aug 17, 2009 at 4:46 PM, Brian
> Rectanus<Brian.Rectanus at breach.com>  wrote:
>> Ivan Ristic wrote:
>>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan Barnett<ryan.barnett at breach.com>
>>>   wrote:
>>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>>>>> Hi,
>>>>>
>>>>> I've noticed that the new Core Rules have configuration bits in them
>>>>> -- just like the previous version -- but I don't think that's the
>>>>> right thing to do. I think most users will want to update their rules
>>>>> regularly, but if the configuration bits are there they will be forced
>>>>> to do the whole thing manually every time.
>>>>>
>>>> What exactly do you mean by "configuration bits?"
>>> I mean the contents of the modsecurity_crs_10_config.conf and
>>> modsecurity_crs_10_global_config.conf. Those two belong to the main
>>> ModSecurity distribution, rather than the rules.
>> We should probably deliver these as:
>>
>> modsecurity_crs_10_config.conf.example
>> modsecurity_crs_10_global_config.conf.example
>>
>> And have instructions to copy them to the correct name and change the
>> renamed versions.
>
> I know the line (between ModSecurity itself and Core Rule Set) can be
> blurry, but why not keep the configuration in ModSecurity, so that the
> Core Rule Set could include only the rules.
>
> Actually, I've been working on an improved default configuration for
> ModSecurity, which I would like to submit for inclusion in the
> distribution.

True.  Personally, I never use the 10 files :)  But I think it is 
important to at least have a good example for how to install the CRS. 
There needs to be some bootstrap config for those that are installing 
from scratch. as well (and I think the 10 files do that nicely).  Also, 
CRS still has some dependencies on the default action due to using 
"block", so those need to be well documented.

I am interested in your defaults, Ivan.

Also, it would be great to hear from some hard-core users as well as new 
users on what they want to see (or don't want to see).

-B

-- 
Brian Rectanus
Breach Security

From ryan.barnett at breach.com  Mon Aug 17 15:09:04 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 17 Aug 2009 15:09:04 -0400
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <4A89A399.80405@breach.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>
	<4A89A399.80405@breach.com>
Message-ID: <200908171509.05012.ryan.barnett@breach.com>



Ryan Barnett
Director of Application Security Research
Phone: (703) 794-2248
Cell: (703) 269-8998
Breach Security, Inc.
2141 Palomar Airport Road, Suite 200
Carlsbad, CA 92011
www.breach.com

On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
> Ivan Ristic wrote:
> > On Mon, Aug 17, 2009 at 4:46 PM, Brian
> >
> > Rectanus<Brian.Rectanus at breach.com>  wrote:
> >> Ivan Ristic wrote:
> >>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan Barnett<ryan.barnett at breach.com>
> >>>
> >>>   wrote:
> >>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
> >>>>> Hi,
> >>>>>
> >>>>> I've noticed that the new Core Rules have configuration bits in them
> >>>>> -- just like the previous version -- but I don't think that's the
> >>>>> right thing to do. I think most users will want to update their rules
> >>>>> regularly, but if the configuration bits are there they will be
> >>>>> forced to do the whole thing manually every time.
> >>>>
> >>>> What exactly do you mean by "configuration bits?"
> >>>
> >>> I mean the contents of the modsecurity_crs_10_config.conf and
> >>> modsecurity_crs_10_global_config.conf. Those two belong to the main
> >>> ModSecurity distribution, rather than the rules.
> >>
> >> We should probably deliver these as:
> >>
> >> modsecurity_crs_10_config.conf.example
> >> modsecurity_crs_10_global_config.conf.example
> >>
> >> And have instructions to copy them to the correct name and change the
> >> renamed versions.
> >
> > I know the line (between ModSecurity itself and Core Rule Set) can be
> > blurry, but why not keep the configuration in ModSecurity, so that the
> > Core Rule Set could include only the rules.
> >
> > Actually, I've been working on an improved default configuration for
> > ModSecurity, which I would like to submit for inclusion in the
> > distribution.
>
> True.  Personally, I never use the 10 files :)  But I think it is
> important to at least have a good example for how to install the CRS.
> There needs to be some bootstrap config for those that are installing
> from scratch. as well (and I think the 10 files do that nicely).  Also,
> CRS still has some dependencies on the default action due to using
> "block", so those need to be well documented.
>

I think we all agree that, for the average new Mod user, the 10 config files 
really help to get them up and running quickly in a semi-sane manner.  The 
question is where does this config belong - in the Mod source archive or the 
CRS.  I guess that Iagree with Ivan that it probably fits better with the Mod 
archive however there are some direct impacts to the CRS if some of these 
settings are change (most notable the SecRuleEngine and SecDefaultAction 
directives).

One demarcation could be that only SecRule, SecAction and SecMarker directives 
should be contained within the CRS and all other directives should be stored 
within the main config files?

> I am interested in your defaults, Ivan.
>
> Also, it would be great to hear from some hard-core users as well as new
> users on what they want to see (or don't want to see).
>

Agreed.  Ivan please send along your suggested config updates as I am sure 
things can be improved upon.

-Ryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090817/45a66172/attachment.html 

From geofrizz at mbox.dinamica.it  Wed Aug 19 08:47:43 2009
From: geofrizz at mbox.dinamica.it (Dr. Paolo Frizzera)
Date: Wed, 19 Aug 2009 14:47:43 +0200
Subject: [Owasp-modsecurity-core-rule-set] Change/delete a variable !
Message-ID: <4A8BF46F.1080907@mbox.dinamica.it>

Hi,
I have a question: "It's possible to change/delete a variable that come 
in a query string or in a form?"
Or "It's possible to "masquerade" this variable for the rest of the rules?"
I want to follow all the controls of the rules but not for that variable.

If is possible, how it's possible ?
I tried some rules, but without success !

TIA,
Paolo

From rcbarnett at gmail.com  Wed Aug 19 09:07:24 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Wed, 19 Aug 2009 09:07:24 -0400
Subject: [Owasp-modsecurity-core-rule-set] Change/delete a variable !
In-Reply-To: <4A8BF46F.1080907@mbox.dinamica.it>
References: <4A8BF46F.1080907@mbox.dinamica.it>
Message-ID: <200908190907.24420.rcbarnett@gmail.com>

On Wednesday 19 August 2009 08:47:43 am Dr. Paolo Frizzera wrote:
> Hi,
> I have a question: "It's possible to change/delete a variable that come
> in a query string or in a form?"
> Or "It's possible to "masquerade" this variable for the rest of the rules?"
> I want to follow all the controls of the rules but not for that variable.
>
> If is possible, how it's possible ?
> I tried some rules, but without success !
>
> TIA,
> Paolo
Hey Paolo,
Just so I understand your question, do you want to totally exclude a specific 
parameter from matching the rules?  If so, and assuming the parameter name you 
wanted to ignore was "foo", you could implement a rules like this in the 
modsecurity_crs_48_local_exceptions.conf file -

SecRule TX:/ARGS:foo/ ".*" 
"chain,phase:2,t:none,nolog,pass,setvar:tx.anomaly_score=-20"
SecRule MATCHED_VAR_NAME "TX\:(.*)" "capture,t:none,setvar:!tx.%{tx.1}"

This rule will check to see if any previous rules have triggered for the foo 
parameter payload.  If so, it will decrement the anomaly score by 20 and 
expire the TX variables.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090819/b41722e6/attachment.html 

From ivan.ristic at gmail.com  Wed Aug 19 12:17:50 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Wed, 19 Aug 2009 17:17:50 +0100
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <200908171509.05012.ryan.barnett@breach.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>
	<4A89A399.80405@breach.com>
	<200908171509.05012.ryan.barnett@breach.com>
Message-ID: <1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>

Hi,

I am attaching my proposal for the new default configuration:

- Start with the README file (the only file that is incomplete)
- main.conf contains a solid default configuration in which every
configuration directive is used
- rules-init.conf sets the default policy, rules to handle parser
failures, and whitelisting examples.

Cheers,
Ivan

On Mon, Aug 17, 2009 at 8:09 PM, Ryan Barnett<ryan.barnett at breach.com> wrote:
>
>
> Ryan Barnett
> Director of Application Security Research
> Phone: (703) 794-2248
> Cell: (703) 269-8998
> Breach Security, Inc.
> 2141 Palomar Airport Road, Suite 200
> Carlsbad, CA 92011
> www.breach.com
>
> On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
>> Ivan Ristic wrote:
>> > On Mon, Aug 17, 2009 at 4:46 PM, Brian
>> >
>> > Rectanus<Brian.Rectanus at breach.com> wrote:
>> >> Ivan Ristic wrote:
>> >>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan
>> >>> Barnett<ryan.barnett at breach.com>
>> >>>
>> >>> wrote:
>> >>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>> >>>>> Hi,
>> >>>>>
>> >>>>> I've noticed that the new Core Rules have configuration bits in them
>> >>>>> -- just like the previous version -- but I don't think that's the
>> >>>>> right thing to do. I think most users will want to update their
>> >>>>> rules
>> >>>>> regularly, but if the configuration bits are there they will be
>> >>>>> forced to do the whole thing manually every time.
>> >>>>
>> >>>> What exactly do you mean by "configuration bits?"
>> >>>
>> >>> I mean the contents of the modsecurity_crs_10_config.conf and
>> >>> modsecurity_crs_10_global_config.conf. Those two belong to the main
>> >>> ModSecurity distribution, rather than the rules.
>> >>
>> >> We should probably deliver these as:
>> >>
>> >> modsecurity_crs_10_config.conf.example
>> >> modsecurity_crs_10_global_config.conf.example
>> >>
>> >> And have instructions to copy them to the correct name and change the
>> >> renamed versions.
>> >
>> > I know the line (between ModSecurity itself and Core Rule Set) can be
>> > blurry, but why not keep the configuration in ModSecurity, so that the
>> > Core Rule Set could include only the rules.
>> >
>> > Actually, I've been working on an improved default configuration for
>> > ModSecurity, which I would like to submit for inclusion in the
>> > distribution.
>>
>> True. Personally, I never use the 10 files :) But I think it is
>> important to at least have a good example for how to install the CRS.
>> There needs to be some bootstrap config for those that are installing
>> from scratch. as well (and I think the 10 files do that nicely). Also,
>> CRS still has some dependencies on the default action due to using
>> "block", so those need to be well documented.
>>
>
> I think we all agree that, for the average new Mod user, the 10 config files
> really help to get them up and running quickly in a semi-sane manner. The
> question is where does this config belong - in the Mod source archive or the
> CRS. I guess that Iagree with Ivan that it probably fits better with the Mod
> archive however there are some direct impacts to the CRS if some of these
> settings are change (most notable the SecRuleEngine and SecDefaultAction
> directives).
>
> One demarcation could be that only SecRule, SecAction and SecMarker
> directives should be contained within the CRS and all other directives
> should be stored within the main config files?
>
>> I am interested in your defaults, Ivan.
>>
>> Also, it would be great to hear from some hard-core users as well as new
>> users on what they want to see (or don't want to see).
>>
>
> Agreed. Ivan please send along your suggested config updates as I am sure
> things can be improved upon.
>
> -Ryan



-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/
-------------- next part --------------
A non-text attachment was scrubbed...
Name: README
Type: application/octet-stream
Size: 145 bytes
Desc: not available
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090819/0c53bf8c/attachment.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: main.conf
Type: application/octet-stream
Size: 4892 bytes
Desc: not available
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090819/0c53bf8c/attachment-0001.obj 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: rules-init.conf
Type: application/octet-stream
Size: 2618 bytes
Desc: not available
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090819/0c53bf8c/attachment-0002.obj 

From Brian.Rectanus at breach.com  Wed Aug 19 13:04:56 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Wed, 19 Aug 2009 10:04:56 -0700
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
 with configuration
In-Reply-To: <1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>	
	<1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>	
	<4A89A399.80405@breach.com>	
	<200908171509.05012.ryan.barnett@breach.com>
	<1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>
Message-ID: <4A8C30B8.2030204@breach.com>

I like it in general, but would also like to see the other options 
available (sort of a quick reference) as this would help give users a 
quick explanation.

EX:

# Some explanation here...
#
# On: Use all rules as they are written.
# Off: Do not use any rules.
# DetectionOnly: Use all rules, but change their action to "pass"
#
SecRuleEngine DetectionOnly

It would be nice if the docs and example config matched (explanation and 
the default value), but that is too much work now.

-B

Ivan Ristic wrote:
> Hi,
>
> I am attaching my proposal for the new default configuration:
>
> - Start with the README file (the only file that is incomplete)
> - main.conf contains a solid default configuration in which every
> configuration directive is used
> - rules-init.conf sets the default policy, rules to handle parser
> failures, and whitelisting examples.
>
> Cheers,
> Ivan
>
> On Mon, Aug 17, 2009 at 8:09 PM, Ryan Barnett<ryan.barnett at breach.com>  wrote:
>>
>> Ryan Barnett
>> Director of Application Security Research
>> Phone: (703) 794-2248
>> Cell: (703) 269-8998
>> Breach Security, Inc.
>> 2141 Palomar Airport Road, Suite 200
>> Carlsbad, CA 92011
>> www.breach.com
>>
>> On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
>>> Ivan Ristic wrote:
>>>> On Mon, Aug 17, 2009 at 4:46 PM, Brian
>>>>
>>>> Rectanus<Brian.Rectanus at breach.com>  wrote:
>>>>> Ivan Ristic wrote:
>>>>>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan
>>>>>> Barnett<ryan.barnett at breach.com>
>>>>>>
>>>>>> wrote:
>>>>>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> I've noticed that the new Core Rules have configuration bits in them
>>>>>>>> -- just like the previous version -- but I don't think that's the
>>>>>>>> right thing to do. I think most users will want to update their
>>>>>>>> rules
>>>>>>>> regularly, but if the configuration bits are there they will be
>>>>>>>> forced to do the whole thing manually every time.
>>>>>>> What exactly do you mean by "configuration bits?"
>>>>>> I mean the contents of the modsecurity_crs_10_config.conf and
>>>>>> modsecurity_crs_10_global_config.conf. Those two belong to the main
>>>>>> ModSecurity distribution, rather than the rules.
>>>>> We should probably deliver these as:
>>>>>
>>>>> modsecurity_crs_10_config.conf.example
>>>>> modsecurity_crs_10_global_config.conf.example
>>>>>
>>>>> And have instructions to copy them to the correct name and change the
>>>>> renamed versions.
>>>> I know the line (between ModSecurity itself and Core Rule Set) can be
>>>> blurry, but why not keep the configuration in ModSecurity, so that the
>>>> Core Rule Set could include only the rules.
>>>>
>>>> Actually, I've been working on an improved default configuration for
>>>> ModSecurity, which I would like to submit for inclusion in the
>>>> distribution.
>>> True. Personally, I never use the 10 files :) But I think it is
>>> important to at least have a good example for how to install the CRS.
>>> There needs to be some bootstrap config for those that are installing
>>> from scratch. as well (and I think the 10 files do that nicely). Also,
>>> CRS still has some dependencies on the default action due to using
>>> "block", so those need to be well documented.
>>>
>> I think we all agree that, for the average new Mod user, the 10 config files
>> really help to get them up and running quickly in a semi-sane manner. The
>> question is where does this config belong - in the Mod source archive or the
>> CRS. I guess that Iagree with Ivan that it probably fits better with the Mod
>> archive however there are some direct impacts to the CRS if some of these
>> settings are change (most notable the SecRuleEngine and SecDefaultAction
>> directives).
>>
>> One demarcation could be that only SecRule, SecAction and SecMarker
>> directives should be contained within the CRS and all other directives
>> should be stored within the main config files?
>>
>>> I am interested in your defaults, Ivan.
>>>
>>> Also, it would be great to hear from some hard-core users as well as new
>>> users on what they want to see (or don't want to see).
>>>
>> Agreed. Ivan please send along your suggested config updates as I am sure
>> things can be improved upon.
>>
>> -Ryan
>
>
>
> --
> Ivan Ristic
> Security assessment of your SSL servers
> https://www.ssllabs.com/ssldb/

-- 
Brian Rectanus
Breach Security

From ivan.ristic at gmail.com  Wed Aug 19 16:33:35 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Wed, 19 Aug 2009 21:33:35 +0100
Subject: [Owasp-modsecurity-core-rule-set] Don't the new rules deserve an
	bigger version number increase?
Message-ID: <1f9222b70908191333u71fd10b9rcdc94f6dc847d289@mail.gmail.com>

It seems to me that the new rules are a big deal, yet they are
released as part of 2.5.10, which is primarily a bug-fix release. If
the new rules are production ready, why not release them with
ModSecurity 2.6?

If they are not ready, perhaps 2.5.10 could be released with two rule
sets, with 2.6 released once the rules are ready?

-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/

From rcbarnett at gmail.com  Wed Aug 19 21:53:36 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Wed, 19 Aug 2009 21:53:36 -0400
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<200908171509.05012.ryan.barnett@breach.com>
	<1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>
Message-ID: <200908192153.36509.rcbarnett@gmail.com>

The intention that we had with splitting the 10 files into two separate ones 
was due to the fact that there are some Mod directives that can only be set 
once within the main Apache scope config (SecServerSignature, 
SecArgumentSeparator, etc...) while others may be included multiple times 
within different Vhost containers (SecRuleEngine, SecAuditEngine, etc...).  

By splitting these up, users can specify the 
modsecurity_crs_10_global_config.conf once within the main Apache config file and 
then include different/appropriate versions of the 
modsecurity_crs_10_config.conf file inside various Vhosts.

We should try and merge this concept with your recommendations.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

On Wednesday 19 August 2009 12:17:50 pm Ivan Ristic wrote:
> Hi,
>
> I am attaching my proposal for the new default configuration:
>
> - Start with the README file (the only file that is incomplete)
> - main.conf contains a solid default configuration in which every
> configuration directive is used
> - rules-init.conf sets the default policy, rules to handle parser
> failures, and whitelisting examples.
>
> Cheers,
> Ivan
>
> On Mon, Aug 17, 2009 at 8:09 PM, Ryan Barnett<ryan.barnett at breach.com> 
wrote:
> > Ryan Barnett
> > Director of Application Security Research
> > Phone: (703) 794-2248
> > Cell: (703) 269-8998
> > Breach Security, Inc.
> > 2141 Palomar Airport Road, Suite 200
> > Carlsbad, CA 92011
> > www.breach.com
> >
> > On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
> >> Ivan Ristic wrote:
> >> > On Mon, Aug 17, 2009 at 4:46 PM, Brian
> >> >
> >> > Rectanus<Brian.Rectanus at breach.com> wrote:
> >> >> Ivan Ristic wrote:
> >> >>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan
> >> >>> Barnett<ryan.barnett at breach.com>
> >> >>>
> >> >>> wrote:
> >> >>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
> >> >>>>> Hi,
> >> >>>>>
> >> >>>>> I've noticed that the new Core Rules have configuration bits in
> >> >>>>> them -- just like the previous version -- but I don't think that's
> >> >>>>> the right thing to do. I think most users will want to update
> >> >>>>> their rules
> >> >>>>> regularly, but if the configuration bits are there they will be
> >> >>>>> forced to do the whole thing manually every time.
> >> >>>>
> >> >>>> What exactly do you mean by "configuration bits?"
> >> >>>
> >> >>> I mean the contents of the modsecurity_crs_10_config.conf and
> >> >>> modsecurity_crs_10_global_config.conf. Those two belong to the main
> >> >>> ModSecurity distribution, rather than the rules.
> >> >>
> >> >> We should probably deliver these as:
> >> >>
> >> >> modsecurity_crs_10_config.conf.example
> >> >> modsecurity_crs_10_global_config.conf.example
> >> >>
> >> >> And have instructions to copy them to the correct name and change the
> >> >> renamed versions.
> >> >
> >> > I know the line (between ModSecurity itself and Core Rule Set) can be
> >> > blurry, but why not keep the configuration in ModSecurity, so that the
> >> > Core Rule Set could include only the rules.
> >> >
> >> > Actually, I've been working on an improved default configuration for
> >> > ModSecurity, which I would like to submit for inclusion in the
> >> > distribution.
> >>
> >> True. Personally, I never use the 10 files :) But I think it is
> >> important to at least have a good example for how to install the CRS.
> >> There needs to be some bootstrap config for those that are installing
> >> from scratch. as well (and I think the 10 files do that nicely). Also,
> >> CRS still has some dependencies on the default action due to using
> >> "block", so those need to be well documented.
> >
> > I think we all agree that, for the average new Mod user, the 10 config
> > files really help to get them up and running quickly in a semi-sane
> > manner. The question is where does this config belong - in the Mod source
> > archive or the CRS. I guess that Iagree with Ivan that it probably fits
> > better with the Mod archive however there are some direct impacts to the
> > CRS if some of these settings are change (most notable the SecRuleEngine
> > and SecDefaultAction directives).
> >
> > One demarcation could be that only SecRule, SecAction and SecMarker
> > directives should be contained within the CRS and all other directives
> > should be stored within the main config files?
> >
> >> I am interested in your defaults, Ivan.
> >>
> >> Also, it would be great to hear from some hard-core users as well as new
> >> users on what they want to see (or don't want to see).
> >
> > Agreed. Ivan please send along your suggested config updates as I am sure
> > things can be improved upon.
> >
> > -Ryan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090819/47329c68/attachment-0001.html 

From rcbarnett at gmail.com  Wed Aug 19 22:07:54 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Wed, 19 Aug 2009 22:07:54 -0400
Subject: [Owasp-modsecurity-core-rule-set] Don't the new rules deserve
	an bigger version number increase?
In-Reply-To: <1f9222b70908191333u71fd10b9rcdc94f6dc847d289@mail.gmail.com>
References: <1f9222b70908191333u71fd10b9rcdc94f6dc847d289@mail.gmail.com>
Message-ID: <200908192207.55072.rcbarnett@gmail.com>

The new CRS are a big deal which is why we designated it a the 2.0 level.  
While traditionally we had bundled the CRS with the Mod source code, we may 
want to rethink that for a few reasons -

1) CRS is now an OWASP project and it will more than likely be developed on 
its own path separate from ModSecurity.  Yes, we need to have some 
interactions so that new rules can utilize new features, but they should be 
developed on their own outside of the Mod source code.

2) The release cycles of the CRS are going to be much more frequent and tying 
it back into adding to the Mod source archive seems like a lot of extra work.

3) We will soon be utilizing the rules-updater.pl script to allow users to 
automatically download the latest rules from our site.  I would guess that 
this will become the most often used method for obtaining rules.

I think that we should take a cue from Snort and keep the source code and the 
rules separate.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

On Wednesday 19 August 2009 04:33:35 pm Ivan Ristic wrote:
> It seems to me that the new rules are a big deal, yet they are
> released as part of 2.5.10, which is primarily a bug-fix release. If
> the new rules are production ready, why not release them with
> ModSecurity 2.6?
>
> If they are not ready, perhaps 2.5.10 could be released with two rule
> sets, with 2.6 released once the rules are ready?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090819/142284ca/attachment.html 

From Brian.Rectanus at breach.com  Thu Aug 20 02:12:28 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Wed, 19 Aug 2009 23:12:28 -0700
Subject: [Owasp-modsecurity-core-rule-set] Don't the new rules deserve
 an bigger version number increase?
In-Reply-To: <200908192207.55072.rcbarnett@gmail.com>
References: <1f9222b70908191333u71fd10b9rcdc94f6dc847d289@mail.gmail.com>
	<200908192207.55072.rcbarnett@gmail.com>
Message-ID: <4A8CE94C.4020603@breach.com>

I had intended to still package up the latest CRS with modsec whenever I 
make a release.  The CRS is now in its own tree under SVN, so I just 
pull the latest CRS and include it in the modsec release.

-B

Ryan Barnett wrote:
> The new CRS are a big deal which is why we designated it a the 2.0
> level. While traditionally we had bundled the CRS with the Mod source
> code, we may want to rethink that for a few reasons -
>
>
> 1) CRS is now an OWASP project and it will more than likely be developed
> on its own path separate from ModSecurity. Yes, we need to have some
> interactions so that new rules can utilize new features, but they should
> be developed on their own outside of the Mod source code.
>
>
> 2) The release cycles of the CRS are going to be much more frequent and
> tying it back into adding to the Mod source archive seems like a lot of
> extra work.
>
>
> 3) We will soon be utilizing the rules-updater.pl script to allow users
> to automatically download the latest rules from our site. I would guess
> that this will become the most often used method for obtaining rules.
>
>
> I think that we should take a cue from Snort and keep the source code
> and the rules separate.
>
>
> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com
>
> On Wednesday 19 August 2009 04:33:35 pm Ivan Ristic wrote:
>  > It seems to me that the new rules are a big deal, yet they are
>  > released as part of 2.5.10, which is primarily a bug-fix release. If
>  > the new rules are production ready, why not release them with
>  > ModSecurity 2.6?
>  >
>  > If they are not ready, perhaps 2.5.10 could be released with two rule
>  > sets, with 2.6 released once the rules are ready?
>
>

-- 
Brian Rectanus
Breach Security

From ivan.ristic at gmail.com  Thu Aug 20 04:00:24 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Thu, 20 Aug 2009 09:00:24 +0100
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <200908192153.36509.rcbarnett@gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<200908171509.05012.ryan.barnett@breach.com>
	<1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>
	<200908192153.36509.rcbarnett@gmail.com>
Message-ID: <1f9222b70908200100u71185417re1f5e89a12dc831a@mail.gmail.com>

On Thu, Aug 20, 2009 at 2:53 AM, Ryan Barnett<rcbarnett at gmail.com> wrote:
> The intention that we had with splitting the 10 files into two separate ones
> was due to the fact that there are some Mod directives that can only be set
> once within the main Apache scope config (SecServerSignature,
> SecArgumentSeparator, etc...) while others may be included multiple times
> within different Vhost containers (SecRuleEngine, SecAuditEngine, etc...).

Interesting, I didn't realise SecArgumentSeparator can only be defined
within the main scope. That seems to be a bug, because it forces one
server to only use one type of separator for all virtual hosts, etc.
That's unlikely to be useful.

Similarly, I notice that SecComponentSignature too is main scope-only.
That seems bad too. What if I want to use a rule set only in one
virtual host?


> By splitting these up, users can specify the
> modsecurity_crs_10_global_config.conf once within the main Apache config
> file and then include different/appropriate versions of the
> modsecurity_crs_10_config.conf file inside various Vhosts.
>
> We should try and merge this concept with your recommendations.

Well, I've omitted the global directives (SecServerSignature,
SecChroot) from the current version anyway. I can create another file
for them and everybody will be happy?


> --
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com
>
> On Wednesday 19 August 2009 12:17:50 pm Ivan Ristic wrote:
>> Hi,
>>
>> I am attaching my proposal for the new default configuration:
>>
>> - Start with the README file (the only file that is incomplete)
>> - main.conf contains a solid default configuration in which every
>> configuration directive is used
>> - rules-init.conf sets the default policy, rules to handle parser
>> failures, and whitelisting examples.
>>
>> Cheers,
>> Ivan
>>
>> On Mon, Aug 17, 2009 at 8:09 PM, Ryan Barnett<ryan.barnett at breach.com>
>> wrote:
>> > Ryan Barnett
>> > Director of Application Security Research
>> > Phone: (703) 794-2248
>> > Cell: (703) 269-8998
>> > Breach Security, Inc.
>> > 2141 Palomar Airport Road, Suite 200
>> > Carlsbad, CA 92011
>> > www.breach.com
>> >
>> > On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
>> >> Ivan Ristic wrote:
>> >> > On Mon, Aug 17, 2009 at 4:46 PM, Brian
>> >> >
>> >> > Rectanus<Brian.Rectanus at breach.com> wrote:
>> >> >> Ivan Ristic wrote:
>> >> >>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan
>> >> >>> Barnett<ryan.barnett at breach.com>
>> >> >>>
>> >> >>> wrote:
>> >> >>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>> >> >>>>> Hi,
>> >> >>>>>
>> >> >>>>> I've noticed that the new Core Rules have configuration bits in
>> >> >>>>> them -- just like the previous version -- but I don't think
>> >> >>>>> that's
>> >> >>>>> the right thing to do. I think most users will want to update
>> >> >>>>> their rules
>> >> >>>>> regularly, but if the configuration bits are there they will be
>> >> >>>>> forced to do the whole thing manually every time.
>> >> >>>>
>> >> >>>> What exactly do you mean by "configuration bits?"
>> >> >>>
>> >> >>> I mean the contents of the modsecurity_crs_10_config.conf and
>> >> >>> modsecurity_crs_10_global_config.conf. Those two belong to the main
>> >> >>> ModSecurity distribution, rather than the rules.
>> >> >>
>> >> >> We should probably deliver these as:
>> >> >>
>> >> >> modsecurity_crs_10_config.conf.example
>> >> >> modsecurity_crs_10_global_config.conf.example
>> >> >>
>> >> >> And have instructions to copy them to the correct name and change
>> >> >> the
>> >> >> renamed versions.
>> >> >
>> >> > I know the line (between ModSecurity itself and Core Rule Set) can be
>> >> > blurry, but why not keep the configuration in ModSecurity, so that
>> >> > the
>> >> > Core Rule Set could include only the rules.
>> >> >
>> >> > Actually, I've been working on an improved default configuration for
>> >> > ModSecurity, which I would like to submit for inclusion in the
>> >> > distribution.
>> >>
>> >> True. Personally, I never use the 10 files :) But I think it is
>> >> important to at least have a good example for how to install the CRS.
>> >> There needs to be some bootstrap config for those that are installing
>> >> from scratch. as well (and I think the 10 files do that nicely). Also,
>> >> CRS still has some dependencies on the default action due to using
>> >> "block", so those need to be well documented.
>> >
>> > I think we all agree that, for the average new Mod user, the 10 config
>> > files really help to get them up and running quickly in a semi-sane
>> > manner. The question is where does this config belong - in the Mod
>> > source
>> > archive or the CRS. I guess that Iagree with Ivan that it probably fits
>> > better with the Mod archive however there are some direct impacts to the
>> > CRS if some of these settings are change (most notable the SecRuleEngine
>> > and SecDefaultAction directives).
>> >
>> > One demarcation could be that only SecRule, SecAction and SecMarker
>> > directives should be contained within the CRS and all other directives
>> > should be stored within the main config files?
>> >
>> >> I am interested in your defaults, Ivan.
>> >>
>> >> Also, it would be great to hear from some hard-core users as well as
>> >> new
>> >> users on what they want to see (or don't want to see).
>> >
>> > Agreed. Ivan please send along your suggested config updates as I am
>> > sure
>> > things can be improved upon.
>> >
>> > -Ryan
>
>



-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/

From ivan.ristic at gmail.com  Thu Aug 20 04:05:50 2009
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Thu, 20 Aug 2009 09:05:50 +0100
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
	with configuration
In-Reply-To: <4A8C30B8.2030204@breach.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>
	<1f9222b70908171113u46753933j59b3ab1f00d5e085@mail.gmail.com>
	<4A89A399.80405@breach.com>
	<200908171509.05012.ryan.barnett@breach.com>
	<1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>
	<4A8C30B8.2030204@breach.com>
Message-ID: <1f9222b70908200105w7962dd5ak1ecdd0e7239d8751@mail.gmail.com>

On Wed, Aug 19, 2009 at 6:04 PM, Brian
Rectanus<Brian.Rectanus at breach.com> wrote:
> I like it in general, but would also like to see the other options available
> (sort of a quick reference) as this would help give users a quick
> explanation.
>
> EX:
>
> # Some explanation here...
> #
> # On: Use all rules as they are written.
> # Off: Do not use any rules.
> # DetectionOnly: Use all rules, but change their action to "pass"
> #
> SecRuleEngine DetectionOnly

I'll try, but I don't want to make the default configuration to become
too verbose. That was the case with Apache's default configuration and
they had to slim it down.

> It would be nice if the docs and example config matched (explanation and the
> default value), but that is too much work now.

I've been going through the documentation recently and there's many
places where it can be improved. Perhaps we could try to get a student
in one of the summer programmes (e.g., Google, OWASP) to improve it.


> -B
>
> Ivan Ristic wrote:
>>
>> Hi,
>>
>> I am attaching my proposal for the new default configuration:
>>
>> - Start with the README file (the only file that is incomplete)
>> - main.conf contains a solid default configuration in which every
>> configuration directive is used
>> - rules-init.conf sets the default policy, rules to handle parser
>> failures, and whitelisting examples.
>>
>> Cheers,
>> Ivan
>>
>> On Mon, Aug 17, 2009 at 8:09 PM, Ryan Barnett<ryan.barnett at breach.com>
>> ?wrote:
>>>
>>> Ryan Barnett
>>> Director of Application Security Research
>>> Phone: (703) 794-2248
>>> Cell: (703) 269-8998
>>> Breach Security, Inc.
>>> 2141 Palomar Airport Road, Suite 200
>>> Carlsbad, CA 92011
>>> www.breach.com
>>>
>>> On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
>>>>
>>>> Ivan Ristic wrote:
>>>>>
>>>>> On Mon, Aug 17, 2009 at 4:46 PM, Brian
>>>>>
>>>>> Rectanus<Brian.Rectanus at breach.com> ?wrote:
>>>>>>
>>>>>> Ivan Ristic wrote:
>>>>>>>
>>>>>>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan
>>>>>>> Barnett<ryan.barnett at breach.com>
>>>>>>>
>>>>>>> wrote:
>>>>>>>>
>>>>>>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
>>>>>>>>>
>>>>>>>>> Hi,
>>>>>>>>>
>>>>>>>>> I've noticed that the new Core Rules have configuration bits in
>>>>>>>>> them
>>>>>>>>> -- just like the previous version -- but I don't think that's the
>>>>>>>>> right thing to do. I think most users will want to update their
>>>>>>>>> rules
>>>>>>>>> regularly, but if the configuration bits are there they will be
>>>>>>>>> forced to do the whole thing manually every time.
>>>>>>>>
>>>>>>>> What exactly do you mean by "configuration bits?"
>>>>>>>
>>>>>>> I mean the contents of the modsecurity_crs_10_config.conf and
>>>>>>> modsecurity_crs_10_global_config.conf. Those two belong to the main
>>>>>>> ModSecurity distribution, rather than the rules.
>>>>>>
>>>>>> We should probably deliver these as:
>>>>>>
>>>>>> modsecurity_crs_10_config.conf.example
>>>>>> modsecurity_crs_10_global_config.conf.example
>>>>>>
>>>>>> And have instructions to copy them to the correct name and change the
>>>>>> renamed versions.
>>>>>
>>>>> I know the line (between ModSecurity itself and Core Rule Set) can be
>>>>> blurry, but why not keep the configuration in ModSecurity, so that the
>>>>> Core Rule Set could include only the rules.
>>>>>
>>>>> Actually, I've been working on an improved default configuration for
>>>>> ModSecurity, which I would like to submit for inclusion in the
>>>>> distribution.
>>>>
>>>> True. Personally, I never use the 10 files :) But I think it is
>>>> important to at least have a good example for how to install the CRS.
>>>> There needs to be some bootstrap config for those that are installing
>>>> from scratch. as well (and I think the 10 files do that nicely). Also,
>>>> CRS still has some dependencies on the default action due to using
>>>> "block", so those need to be well documented.
>>>>
>>> I think we all agree that, for the average new Mod user, the 10 config
>>> files
>>> really help to get them up and running quickly in a semi-sane manner. The
>>> question is where does this config belong - in the Mod source archive or
>>> the
>>> CRS. I guess that Iagree with Ivan that it probably fits better with the
>>> Mod
>>> archive however there are some direct impacts to the CRS if some of these
>>> settings are change (most notable the SecRuleEngine and SecDefaultAction
>>> directives).
>>>
>>> One demarcation could be that only SecRule, SecAction and SecMarker
>>> directives should be contained within the CRS and all other directives
>>> should be stored within the main config files?
>>>
>>>> I am interested in your defaults, Ivan.
>>>>
>>>> Also, it would be great to hear from some hard-core users as well as new
>>>> users on what they want to see (or don't want to see).
>>>>
>>> Agreed. Ivan please send along your suggested config updates as I am sure
>>> things can be improved upon.
>>>
>>> -Ryan
>>
>>
>>
>> --
>> Ivan Ristic
>> Security assessment of your SSL servers
>> https://www.ssllabs.com/ssldb/
>
> --
> Brian Rectanus
> Breach Security
>



-- 
Ivan Ristic
Security assessment of your SSL servers
https://www.ssllabs.com/ssldb/

From rcbarnett at gmail.com  Thu Aug 20 11:25:23 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Thu, 20 Aug 2009 11:25:23 -0400
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users]
	Suggestion about mixing rules with configuration
In-Reply-To: <89312D9AC379914DBC05181254E5C8C102B840D14C@dalcmbxp00.FOSSIL.COM>
References: <89312D9AC379914DBC05181254E5C8C102B840D14C@dalcmbxp00.FOSSIL.COM>
Message-ID: <200908201125.23359.rcbarnett@gmail.com>

On Wednesday 19 August 2009 02:23:25 pm Daniel Draper wrote:
> Let me first say that I?m pleased to see the continued collaboration
> between Ivan and the Breach team.
>

Me too, however this type of collaboration is not reserved only for the 
project creator!  ModSecurity (and the Core Rule Set) are community projects 
and will live and die based on community involvement.  This is why we have 
made moves to help facilitate collaboration such as the use of Jira and now 
wiki facilitated documentation capabilities with the OWASP ModSecurity Core 
Rule Set project.  Jump in - we need everyone's help.

> Do you feel that the new rule set is production-ready yet, or is some
> finalization needed before users put this in their production environments?

I think that it depends on the current setup.  If someone has been using Mod 
for awhile and they have a bunch of customizations/virtual patches and are 
using it in a blocking mode, then they need to do some good testing with the 
new rules to see how they work.  On the other hand, if someone is just 
deploying ModSecurity for the first time, I don't think that there is anything 
major that would be an issue for deploying these in production.  You would 
still want to run them in a non-disruptive mode initially - which can be 
achieved by using pass in the anomaly scoring rules in the 49 enforcement file.

All of this being said, I do believe that there is still some finalization that 
needs to be done.  This new collaborative detection/anomaly scoring rules 
configuration could still be improved a bit.  Brian and I have internally 
discussed a few things and will be posting to the list soon for discussions.

>  Also, with the 2.0.1 core rule set being markedly different from 1.6.1, is
> there a blog post or article to ?re-educate? users regarding how
> customization should be done.  

Not yet, but there will be on the OWASP project site.  I am going to take it 
upon myself to do the initial population of this type of information however I 
don't want the community to think that it solely up to Breach Security 
personnel (Brian and Myself) to update this information.  Far from it.  
Providing the community with an interface (wiki) to update the documentation 
for yourselves was one of the main goals of OWASP-ing the CRS.  I have watch 
controls on the project page so I can review updates but I don't want to be 
the only one adding documentation about the CRS.

*wink, wink* - I am looking for some of the ModSecurity "power users" to step 
up and add some documentation.  Guys like Christian Bockermann, Christian 
Folini, Marc Stern, Stephen Craig Evans, etc...  will hopefully all pitch in 
and add some useful how-tos and the like.

> I?m assuming that the same holds true for
> 2.0.1 that held for 1.6.1 ? avoid modifying the core rule set files
> directly ? include customizations in custom rule files.  I?d like to see
> updated recommendations for implementing white-list rules, modifying
> existing blocking rules and adding new rules.  

This is true and this was another one of the goals of CRS v2.0 - to make 
customization/exceptions easier.  For whitelisting rules where you want to 
bypass rules based on source IP or other variables, you can still use the 
modsecurity_crs_15_customrules.conf approach (as was used in CRS v1.6) so that 
these rules run before the rest of the rules.  This allows you to toggle the 
SecRuleEngine/SecAuditEngine, etc...

For the remainder of the rules, since we have decoupled the rules inspection 
from the blocking options, this allows users to do exceptions after the rules 
inspect, yet just prior to the rules blocking.  This is what the new 
modsecurity_crs_48_local_exceptions.conf file is meant for.  There are example 
exceptions in this file that you can review.

> To clarify each of these
> three items, I offer the following example issues:
>
>
>  1.  Given a web server configuration that serves static content (i.e.
> /static/? including html, images and flash swf?s) and dynamic content via
> other context roots, what is the best way to reduce CPU overhead while
> still providing some protection.  I?ve seen a slide where Ivan Ristic
> allows requests through if the request is for an image file, using HEAD or
> GET, and has no arguments.  Ryan Barnett recently replied to similar query
> (using 1.6.1 rules at the time) to use SecRule REQUEST_FILENAME
> "@beginsWith /static/"
> "phase:4,t:none,nolog,pass,ctl:responseBodyAccess=Off" to not scan the
> response body for static content requests. 

These are two different approaches to handling "static" content.  The former is 
for dynamically identify request for static resources based on the 
characteristics of the request while the latter is useful when your site's 
content is setup in a way so that you know ahead of time where your static 
content resides.  Either one of these types of rules should go in the 
modsecurity_crs_15_customrules.conf file. 

> 2.  We have an application
> cookie that trips the RESPONSE_SPLITTING rule in crs_40, id 950910 due
> ?%a0? being in the cookie.  What?s the best way to update that rule so that
> we allow this cookie through but continue to block any other occurrences?

Let's say that the Cookie that is tripping the HTTP response splitting rule is 
foo.  When the new CRS rule 950910 triggers, it will set a TX variable that 
looks something like this (taken from the debug log)-

[9] Setting variable: tx.%{rule.id}-
WEB_ATTACK/RESPONSE_SPLITTING-%{matched_var_name}=%{matched_var}
[9] Resolved macro %{rule.id} to "950910"
[9] Resolved macro %{matched_var_name} to "REQUEST_HEADERS:Cookie"
[9] Resolved macro %{matched_var} to 
"foo=bah7biikzmxhc2hjqzonqwn0aw9uq29udhjvbgxlcjo6rmxhc2g6okzsyxn%0asgfzahsabjokqhvzzwr7aa%3d%3d--1eb7a63eabc98dec0e0f418633d652fb97f5a8d"
[9] Set variable "tx.950910-WEB_ATTACK/RESPONSE_SPLITTING-
REQUEST_HEADERS:Cookie" to 
"foo=bah7biikzmxhc2hjqzonqwn0aw9uq29udhjvbgxlcjo6rmxhc2g6okzsyxn%0asgfzahsabjokqhvzzwr7aa%3d%3d--1eb7a63eabc98dec0e0f418633d652fb97f5a8d".

With this information, you can now go to the 
modsecurity_crs_48_local_exceptions.conf file and add an entry like this to 
handle an exception -

SecRule TX:'/^950910-WEB_ATTACK\\\/RESPONSE_SPLITTING-
REQUEST_HEADERS:Cookie$/' "^foo=" 
"chain,phase:2,t:none,nolog,pass,setvar:tx.anomaly_score=-20"

Basically, all this rule does, from an anomaly scoring perspective is to re-
adjust the overall anomaly score by subtracting 20 points (which was 
originally added due to the false positive match).

> 3.  Given an argument that should only include numeric values, how would we
> implement a new blocking rule to block requests containing invalid data for
> the argument?
>

The type of rule that you add for input validation/positive security rules 
doesn't necessarily change with regards to including it along side the new 
CRS.  I would just put them in the modsecurity_crs_48_local_exceptions.conf 
file.  Take a look at Remo, WebProfileEditor or ModProfiler for positive security 
rule examples.

The rationale for including these rules in the 48 file is so that they can run 
after the CRS rules.  This is valuable as the positive security rules will 
tell you that the input doesn't match the profile (essentially triggering a 
generic parameter tampering type of message) but it won't tell you what 
specific attack was being attempted.  It is useful to allow the negative 
security rules to run so that they will help you to further categorize the 
attack (SQLi, XSS, etc...).  If you run the positive security rules first and 
block, then all you will have is parameter tampering alerts and it will be up 
to you to figure out exactly what the bad guy was trying.

> Thanks as always!
>

Hope this info helps.

-Ryan

> Daniel Draper | IBM WebSphere Application Server / Commerce Support
> Fossil, Inc. | 2323 North Central Expressway | Richardson, Texas 75080
>
>
>
> -----Original Message-----
> From: Brian Rectanus [mailto:Brian.Rectanus at breach.com]
> Sent: Wednesday, August 19, 2009 12:05 PM
> To: Ivan Ristic
> Cc: mod-security-users at lists.sourceforge.net; Ryan Barnett;
> owasp-modsecurity-core-rule-set at lists.owasp.org Subject: Re:
> [mod-security-users] [Owasp-modsecurity-core-rule-set] Suggestion about
> mixing rules with configuration
>
>
>
> I like it in general, but would also like to see the other options
>
> available (sort of a quick reference) as this would help give users a
>
> quick explanation.
>
>
>
> EX:
>
>
>
> # Some explanation here...
>
> #
>
> # On: Use all rules as they are written.
>
> # Off: Do not use any rules.
>
> # DetectionOnly: Use all rules, but change their action to "pass"
>
> #
>
> SecRuleEngine DetectionOnly
>
>
>
> It would be nice if the docs and example config matched (explanation and
>
> the default value), but that is too much work now.
>
>
>
> -B
>
> Ivan Ristic wrote:
> > Hi,
> >
> >
> >
> > I am attaching my proposal for the new default configuration:
> >
> >
> >
> > - Start with the README file (the only file that is incomplete)
> >
> > - main.conf contains a solid default configuration in which every
> >
> > configuration directive is used
> >
> > - rules-init.conf sets the default policy, rules to handle parser
> >
> > failures, and whitelisting examples.
> >
> >
> >
> > Cheers,
> >
> > Ivan
> >
> > On Mon, Aug 17, 2009 at 8:09 PM, Ryan Barnett<ryan.barnett at breach.com>  
wrote:
> >> Ryan Barnett
> >>
> >> Director of Application Security Research
> >>
> >> Phone: (703) 794-2248
> >>
> >> Cell: (703) 269-8998
> >>
> >> Breach Security, Inc.
> >>
> >> 2141 Palomar Airport Road, Suite 200
> >>
> >> Carlsbad, CA 92011
> >>
> >> www.breach.com
> >>
> >> On Monday 17 August 2009 02:38:17 pm Brian Rectanus wrote:
> >>> Ivan Ristic wrote:
> >>>> On Mon, Aug 17, 2009 at 4:46 PM, Brian
> >>>>
> >>>> Rectanus<Brian.Rectanus at breach.com>  wrote:
> >>>>> Ivan Ristic wrote:
> >>>>>> On Fri, Aug 14, 2009 at 10:22 PM, Ryan
> >>>>>>
> >>>>>> Barnett<ryan.barnett at breach.com>
> >>>>>>
> >>>>>> wrote:
> >>>>>>> On Friday 14 August 2009 04:18:21 pm Ivan Ristic wrote:
> >>>>>>>> Hi,
> >>>>>>>>
> >>>>>>>>
> >>>>>>>>
> >>>>>>>> I've noticed that the new Core Rules have configuration bits in
> >>>>>>>> them
> >>>>>>>>
> >>>>>>>> -- just like the previous version -- but I don't think that's the
> >>>>>>>>
> >>>>>>>> right thing to do. I think most users will want to update their
> >>>>>>>>
> >>>>>>>> rules
> >>>>>>>>
> >>>>>>>> regularly, but if the configuration bits are there they will be
> >>>>>>>>
> >>>>>>>> forced to do the whole thing manually every time.
> >>>>>>>
> >>>>>>> What exactly do you mean by "configuration bits?"
> >>>>>>
> >>>>>> I mean the contents of the modsecurity_crs_10_config.conf and
> >>>>>>
> >>>>>> modsecurity_crs_10_global_config.conf. Those two belong to the main
> >>>>>>
> >>>>>> ModSecurity distribution, rather than the rules.
> >>>>>
> >>>>> We should probably deliver these as:
> >>>>>
> >>>>>
> >>>>>
> >>>>> modsecurity_crs_10_config.conf.example
> >>>>>
> >>>>> modsecurity_crs_10_global_config.conf.example
> >>>>>
> >>>>>
> >>>>>
> >>>>> And have instructions to copy them to the correct name and change the
> >>>>>
> >>>>> renamed versions.
> >>>>
> >>>> I know the line (between ModSecurity itself and Core Rule Set) can be
> >>>>
> >>>> blurry, but why not keep the configuration in ModSecurity, so that the
> >>>>
> >>>> Core Rule Set could include only the rules.
> >>>>
> >>>>
> >>>>
> >>>> Actually, I've been working on an improved default configuration for
> >>>>
> >>>> ModSecurity, which I would like to submit for inclusion in the
> >>>>
> >>>> distribution.
> >>>
> >>> True. Personally, I never use the 10 files :) But I think it is
> >>>
> >>> important to at least have a good example for how to install the CRS.
> >>>
> >>> There needs to be some bootstrap config for those that are installing
> >>>
> >>> from scratch. as well (and I think the 10 files do that nicely). Also,
> >>>
> >>> CRS still has some dependencies on the default action due to using
> >>>
> >>> "block", so those need to be well documented.
> >>
> >> I think we all agree that, for the average new Mod user, the 10 config
> >> files
> >>
> >> really help to get them up and running quickly in a semi-sane manner.
> >> The
> >>
> >> question is where does this config belong - in the Mod source archive or
> >> the
> >>
> >> CRS. I guess that Iagree with Ivan that it probably fits better with the
> >> Mod
> >>
> >> archive however there are some direct impacts to the CRS if some of
> >> these
> >>
> >> settings are change (most notable the SecRuleEngine and SecDefaultAction
> >>
> >> directives).
> >>
> >>
> >>
> >> One demarcation could be that only SecRule, SecAction and SecMarker
> >>
> >> directives should be contained within the CRS and all other directives
> >>
> >> should be stored within the main config files?
> >>
> >>> I am interested in your defaults, Ivan.
> >>>
> >>>
> >>>
> >>> Also, it would be great to hear from some hard-core users as well as
> >>> new
> >>>
> >>> users on what they want to see (or don't want to see).
> >>
> >> Agreed. Ivan please send along your suggested config updates as I am
> >> sure
> >>
> >> things can be improved upon.
> >>
> >>
> >>
> >> -Ryan
> >
> > --
> >
> > Ivan Ristic
> >
> > Security assessment of your SSL servers
> >
> > https://www.ssllabs.com/ssldb/
>
> --
>
> Brian Rectanus
>
> Breach Security
>
>
>
> ---------------------------------------------------------------------------
>---
>
> Let Crystal Reports handle the reporting - Free Crystal Reports 2008 30-Day
>
> trial. Simplify your report design, integration and deployment - and focus
> on
>
> what you do best, core application coding. Discover what's new with
>
> Crystal Reports now.  http://p.sf.net/sfu/bobj-july
>
> _______________________________________________
>
> mod-security-users mailing list
>
> mod-security-users at lists.sourceforge.net
>
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
>
> Commercial ModSecurity Appliances, Rule Sets and Support:
>
> http://www.modsecurity.org/breach/index.html

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090820/a4b8e81c/attachment-0001.html 

From Brian.Rectanus at breach.com  Thu Aug 20 13:42:55 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Thu, 20 Aug 2009 10:42:55 -0700
Subject: [Owasp-modsecurity-core-rule-set] Suggestion about mixing rules
 with configuration
In-Reply-To: <1f9222b70908200100u71185417re1f5e89a12dc831a@mail.gmail.com>
References: <1f9222b70908141318o38a7b52ej86c92c12bebac7a2@mail.gmail.com>	
	<200908171509.05012.ryan.barnett@breach.com>	
	<1f9222b70908190917t361c97b0k14c26b67a1327de9@mail.gmail.com>	
	<200908192153.36509.rcbarnett@gmail.com>
	<1f9222b70908200100u71185417re1f5e89a12dc831a@mail.gmail.com>
Message-ID: <4A8D8B1F.9010307@breach.com>



Ivan Ristic wrote:
> On Thu, Aug 20, 2009 at 2:53 AM, Ryan Barnett<rcbarnett at gmail.com>  wrote:
>> The intention that we had with splitting the 10 files into two separate ones
>> was due to the fact that there are some Mod directives that can only be set
>> once within the main Apache scope config (SecServerSignature,
>> SecArgumentSeparator, etc...) while others may be included multiple times
>> within different Vhost containers (SecRuleEngine, SecAuditEngine, etc...).
>
> Interesting, I didn't realise SecArgumentSeparator can only be defined
> within the main scope. That seems to be a bug, because it forces one
> server to only use one type of separator for all virtual hosts, etc.
> That's unlikely to be useful.
>
> Similarly, I notice that SecComponentSignature too is main scope-only.
> That seems bad too. What if I want to use a rule set only in one
> virtual host?

Agreed - please write them up as bugs ;)

>> By splitting these up, users can specify the
>> modsecurity_crs_10_global_config.conf once within the main Apache config
>> file and then include different/appropriate versions of the
>> modsecurity_crs_10_config.conf file inside various Vhosts.
>>
>> We should try and merge this concept with your recommendations.
>
> Well, I've omitted the global directives (SecServerSignature,
> SecChroot) from the current version anyway. I can create another file
> for them and everybody will be happy?

Yeah, I think so.  Need some docs saying what each is for.

-B

-- 
Brian Rectanus
Breach Security

From c.klossek at apodiscounter.de  Sun Aug 23 04:23:29 2009
From: c.klossek at apodiscounter.de (Christian Klossek)
Date: Sun, 23 Aug 2009 10:23:29 +0200
Subject: [Owasp-modsecurity-core-rule-set] disable one rule
Message-ID: <4A90FC81.50000@apodiscounter.de>

Hello,

for one php-file I need to disable the rule "Possible HTTP Parameter
Pollution Attack: Multiple Parameters with the same Name."
(modsecurity_crs_40_generic_attacks.conf).

Example: http://localhost/example.php?test=abcde&test=abcde

That url should be legal. And I don't want to change the core rules
directly. Is there a possibility to create a special rule for that url
and that parameter in my "modsecurity_crs_15_custom_config.conf"?

Thanks
Christian



From rcbarnett at gmail.com  Sun Aug 23 09:30:48 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Sun, 23 Aug 2009 09:30:48 -0400
Subject: [Owasp-modsecurity-core-rule-set] disable one rule
In-Reply-To: <4A90FC81.50000@apodiscounter.de>
References: <4A90FC81.50000@apodiscounter.de>
Message-ID: <200908230930.48268.rcbarnett@gmail.com>

On Sunday 23 August 2009 04:23:29 am Christian Klossek wrote:
> Hello,
>
> for one php-file I need to disable the rule "Possible HTTP Parameter
> Pollution Attack: Multiple Parameters with the same Name."
> (modsecurity_crs_40_generic_attacks.conf).
>
> Example: http://localhost/example.php?test=abcde&test=abcde
>
> That url should be legal. And I don't want to change the core rules
> directly. Is there a possibility to create a special rule for that url
> and that parameter in my "modsecurity_crs_15_custom_config.conf"?
>

This particular rule should have a rule ID but it seems to be missing.  This 
is a bug and will be fixed.  Even without a rule ID, you can still add a rule 
to the modsecurity_crs_48_local_exceptions.conf file to address this issue.  
See the last example if the file as it seems similar to your issue where you 
want to add an exception based on a URL.  Here is an example rule -

SecRule REQUEST_FILENAME "@streq /example.php" 
"chain,phase:2,t:none,nolog,pass"
       SecRule TX:'/-WEB_ATTACK/COMMAND_INJECTION-TX:arg_name_test/' "@streq 
2" "chain,t:none"
               SecRule MATCHED_VAR_NAME "TX\:(.*)" "capture,t:none,setvar:!tx.
%{tx.1},setvar:tx.anomaly_score=-20"

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090823/d71d4500/attachment.html 

From jim.manico at owasp.org  Sun Aug 23 10:27:48 2009
From: jim.manico at owasp.org (Jim Manico)
Date: Sun, 23 Aug 2009 10:27:48 -0400
Subject: [Owasp-modsecurity-core-rule-set] disable one rule
In-Reply-To: <4A90FC81.50000@apodiscounter.de>
References: <4A90FC81.50000@apodiscounter.de>
Message-ID: <B8612F72-555C-4132-AE19-46A1C8F00EC6@owasp.org>

This rule would break any app that needs to support standard  
multiselect lists. Now a great global rule that would not break  
anything would be you can never have 2 form variables with the same  
name and value.

> http://localhost/example.php?test=abcde&test=abcde

Seems like very bad code. I can't see any need to support this, unless  
you have a multiselect list with multiple entries of the same value,  
submitting over get. I can't think of why you would ever want to do  
that?

Jim Manico

On Aug 23, 2009, at 4:23 AM, Christian Klossek <c.klossek at apodiscounter.de 
 > wrote:

> Hello,
>
> for one php-file I need to disable the rule "Possible HTTP Parameter
> Pollution Attack: Multiple Parameters with the same Name."
> (modsecurity_crs_40_generic_attacks.conf).
>
> Example: http://localhost/example.php?test=abcde&test=abcde
>
> That url should be legal. And I don't want to change the core rules
> directly. Is there a possibility to create a special rule for that url
> and that parameter in my "modsecurity_crs_15_custom_config.conf"?
>
> Thanks
> Christian
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From ryan.barnett at breach.com  Sun Aug 23 15:08:26 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Sun, 23 Aug 2009 15:08:26 -0400
Subject: [Owasp-modsecurity-core-rule-set] disable one rule
In-Reply-To: <B8612F72-555C-4132-AE19-46A1C8F00EC6@owasp.org>
References: <4A90FC81.50000@apodiscounter.de>
	<B8612F72-555C-4132-AE19-46A1C8F00EC6@owasp.org>
Message-ID: <200908231508.26355.ryan.barnett@breach.com>

On Sunday 23 August 2009 10:27:48 am Jim Manico wrote:
> This rule would break any app that needs to support standard
> multiselect lists.

True - this rule is meant for webapps that *don't* legitimately use multiple 
parameters with the same name.

> Now a great global rule that would not break
> anything would be you can never have 2 form variables with the same
> name and value.

What would that achieve from an attacker's perspective?  It would not be an 
HPP attack which entails multiple parameters with the same name but different 
payloads.  In those cases either the client could screw around with back-end 
logic or distribute malicious payloads in the hopes that it would bypass 
security filters and then the back-end webapp would magically canonicalize it 
back into its functional, malicious format.

>
> > http://localhost/example.php?test=abcde&test=abcde
>
> Seems like very bad code. I can't see any need to support this, unless
> you have a multiselect list with multiple entries of the same value,
> submitting over get. I can't think of why you would ever want to do
> that?
>
> Jim Manico
>
> On Aug 23, 2009, at 4:23 AM, Christian Klossek <c.klossek at apodiscounter.de
>
>  > wrote:
> >
> > Hello,
> >
> > for one php-file I need to disable the rule "Possible HTTP Parameter
> > Pollution Attack: Multiple Parameters with the same Name."
> > (modsecurity_crs_40_generic_attacks.conf).
> >
> > Example: http://localhost/example.php?test=abcde&test=abcde
> >
> > That url should be legal. And I don't want to change the core rules
> > directly. Is there a possibility to create a special rule for that url
> > and that parameter in my "modsecurity_crs_15_custom_config.conf"?
> >
> > Thanks
> > Christian
> >
> >
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090823/75315c53/attachment.html 

From jim.manico at owasp.org  Sun Aug 23 17:09:54 2009
From: jim.manico at owasp.org (Jim Manico)
Date: Sun, 23 Aug 2009 17:09:54 -0400
Subject: [Owasp-modsecurity-core-rule-set] disable one rule
In-Reply-To: <200908231508.26355.ryan.barnett@breach.com>
References: <4A90FC81.50000@apodiscounter.de>
	<B8612F72-555C-4132-AE19-46A1C8F00EC6@owasp.org>
	<200908231508.26355.ryan.barnett@breach.com>
Message-ID: <B355D8F7-0A45-4BFA-8AC4-1261FD936082@owasp.org>

I agree the rule I suggested is weak, but I've never seen a enterprise  
application without a multiselect list, which per the HTTP standard,  
sends multiple values with the same parameter name. A multiselect list  
is one of 5 basic types of form elements, it's nothing fancy. So I'm  
suprised to see this rule in the core.

I'm curious, is this just me, or do you all avoid multiselect lists?

Jim Manico

On Aug 23, 2009, at 3:08 PM, Ryan Barnett <ryan.barnett at breach.com>  
wrote:

> On Sunday 23 August 2009 10:27:48 am Jim Manico wrote:
> > This rule would break any app that needs to support standard
> > multiselect lists.
>
> True - this rule is meant for webapps that *don't* legitimately use  
> multiple parameters with the same name.
>
> > Now a great global rule that would not break
> > anything would be you can never have 2 form variables with the same
> > name and value.
>
> What would that achieve from an attacker's perspective? It would not  
> be an HPP attack which entails multiple parameters with the same  
> name but different payloads. In those cases either the client could  
> screw around with back-end logic or distribute malicious payloads in  
> the hopes that it would bypass security filters and then the back- 
> end webapp would magically canonicalize it back into its functional,  
> malicious format.
>
> >
> > > http://localhost/example.php?test=abcde&test=abcde
> >
> > Seems like very bad code. I can't see any need to support this,  
> unless
> > you have a multiselect list with multiple entries of the same value,
> > submitting over get. I can't think of why you would ever want to do
> > that?
> >
> > Jim Manico
> >
> > On Aug 23, 2009, at 4:23 AM, Christian Klossek <c.klossek at apodiscounter.de
> >
> > > wrote:
> > >
> > > Hello,
> > >
> > > for one php-file I need to disable the rule "Possible HTTP  
> Parameter
> > > Pollution Attack: Multiple Parameters with the same Name."
> > > (modsecurity_crs_40_generic_attacks.conf).
> > >
> > > Example: http://localhost/example.php?test=abcde&test=abcde
> > >
> > > That url should be legal. And I don't want to change the core  
> rules
> > > directly. Is there a possibility to create a special rule for  
> that url
> > > and that parameter in my "modsecurity_crs_15_custom_config.conf"?
> > >
> > > Thanks
> > > Christian
> > >
> > >
> > > _______________________________________________
> > > Owasp-modsecurity-core-rule-set mailing list
> > > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

From Ryan.Barnett at breach.com  Sun Aug 23 17:32:09 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Sun, 23 Aug 2009 17:32:09 -0400
Subject: [Owasp-modsecurity-core-rule-set] disable one rule
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F64D5986@MONET.utopiasystems.net>

This rule is brand new and not heavily tested yet.  This is one of the benefits of having the huge ModSecurity userbase - you can test out new rules and see if they fly.  There is such a wide variety of web technologies deployed behind Mod that you get a real test.  Definitely more than we could test internally on our own.  Also - this rule is deployed on the WASC honeypots.  Haven't see the rule trigger yet though.  This could be due to the transactions not using multiselect lists.

You bring up a good point Jim and that is that we should probably have some designation for experimental/beta rules.  We have the revision actions which could probably use for this purpose.  At least it would let users know how confident we are in the rule.

Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com <blocked::mailto:Ryan.Barnett at Breach.com>
www.Breach.com <http://www.breach.com/>

----- Original Message -----
From: Jim Manico <jim.manico at owasp.org>
To: Ryan Barnett
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org <owasp-modsecurity-core-rule-set at lists.owasp.org>; Christian Klossek <c.klossek at apodiscounter.de>
Sent: Sun Aug 23 17:09:54 2009
Subject: Re: [Owasp-modsecurity-core-rule-set] disable one rule

I agree the rule I suggested is weak, but I've never seen a enterprise
application without a multiselect list, which per the HTTP standard,
sends multiple values with the same parameter name. A multiselect list
is one of 5 basic types of form elements, it's nothing fancy. So I'm
suprised to see this rule in the core.

I'm curious, is this just me, or do you all avoid multiselect lists?

Jim Manico

On Aug 23, 2009, at 3:08 PM, Ryan Barnett <ryan.barnett at breach.com>
wrote:

> On Sunday 23 August 2009 10:27:48 am Jim Manico wrote:
> > This rule would break any app that needs to support standard
> > multiselect lists.
>
> True - this rule is meant for webapps that *don't* legitimately use
> multiple parameters with the same name.
>
> > Now a great global rule that would not break
> > anything would be you can never have 2 form variables with the same
> > name and value.
>
> What would that achieve from an attacker's perspective? It would not
> be an HPP attack which entails multiple parameters with the same
> name but different payloads. In those cases either the client could
> screw around with back-end logic or distribute malicious payloads in
> the hopes that it would bypass security filters and then the back-
> end webapp would magically canonicalize it back into its functional,
> malicious format.
>
> >
> > > http://localhost/example.php?test=abcde&test=abcde
> >
> > Seems like very bad code. I can't see any need to support this,
> unless
> > you have a multiselect list with multiple entries of the same value,
> > submitting over get. I can't think of why you would ever want to do
> > that?
> >
> > Jim Manico
> >
> > On Aug 23, 2009, at 4:23 AM, Christian Klossek <c.klossek at apodiscounter.de
> >
> > > wrote:
> > >
> > > Hello,
> > >
> > > for one php-file I need to disable the rule "Possible HTTP
> Parameter
> > > Pollution Attack: Multiple Parameters with the same Name."
> > > (modsecurity_crs_40_generic_attacks.conf).
> > >
> > > Example: http://localhost/example.php?test=abcde&test=abcde
> > >
> > > That url should be legal. And I don't want to change the core
> rules
> > > directly. Is there a possibility to create a special rule for
> that url
> > > and that parameter in my "modsecurity_crs_15_custom_config.conf"?
> > >
> > > Thanks
> > > Christian
> > >
> > >
> > > _______________________________________________
> > > Owasp-modsecurity-core-rule-set mailing list
> > > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 5007 bytes
Desc: not available
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090823/4badb0cb/attachment-0001.bin 

From ossec.junkie at gmail.com  Tue Aug 25 15:39:53 2009
From: ossec.junkie at gmail.com (OSSEC junkie)
Date: Tue, 25 Aug 2009 12:39:53 -0700
Subject: [Owasp-modsecurity-core-rule-set] Fix blocking issue
Message-ID: <869a38360908251239p3d15fed0lf0cccee0c4e22a23@mail.gmail.com>

I was wondering if I could get some help here, I cant seem to figure out why
I'm getting blocked..well it's not really blocking but I know this is a
false positive but can't get the rule to work correctly:

>From the audit log:
--bec3cc26-A--
[21/Aug/2009:23:38:56 --0700] So at SgAoBBH0AAEt9FWoAAAAE 72.93.69.185 48517
10.1.4.125 80
--bec3cc26-B--
POST /sell/CheesePizza HTTP/1.1
Accept: image/gif, image/x-xbitmap, image/jpeg, image/pjpeg,
application/x-shockwave-flash, */*
Referer: http://web.farm.org/sell/CheesePizza?topping=8&sauce=ONE&method=23
Accept-Language: en-us
Content-Type: application/x-www-form-urlencoded
UA-CPU: x86
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR
1.1.4322)
Host: web.farm.org
Content-Length: 461
Connection: Keep-Alive
Cache-Control: no-cache
Cookie:
XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX;


--bec3cc26-C--
prevtrxstate=8&user_preference=S_tomcat_wfarm02_1247457979602_378637%7CS%7Ctomcat_wfarm02%
7Cweb.farm.org
%7Cen%7CUS%7Cnull%7CMLB%7C&=&topping=&sauce=&method=&area=23&=&comments=all&discount=6&year=2009&appetizer=&desert=RSAL&error_check=null&pasta=null&sandwich=null&cheesetype=false&wid=8323416&complete=0
--bec3cc26-F--
HTTP/1.1 200 OK
Vary: Accept-Encoding,User-Agent
Content-Encoding: gzip
Connection: close
Transfer-Encoding: chunked
Content-Type: text/html;charset=UTF-8

--bec3cc26-H--
Message: Warning. Unconditional match in SecAction. [file
"/web/root/apache/conf.d/modsecurity/modsecurity_crs_41_xss_attacks.conf"]
[line "15"]
Apache-Handler: jakarta-servlet
Stopwatch: 1250923136064289 175742 (338* 6749 166779)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
ruleset/2.0.1.
Server: Apache/2.2.11 (Unix)

--bec3cc26-K--
SecAction
"phase:1,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule
"REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:Referer"
"@pmFromFile modsecurity_40_generic_attacks.data"
"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecAction "phase:2,log,skipAfter:END_XSS_REGEX"

--bec3cc26-Z--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090825/63b3c856/attachment.html 

From Brian.Rectanus at breach.com  Tue Aug 25 15:49:37 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Tue, 25 Aug 2009 12:49:37 -0700
Subject: [Owasp-modsecurity-core-rule-set] Fix blocking issue
In-Reply-To: <869a38360908251239p3d15fed0lf0cccee0c4e22a23@mail.gmail.com>
References: <869a38360908251239p3d15fed0lf0cccee0c4e22a23@mail.gmail.com>
Message-ID: <4A944051.1050002@breach.com>



OSSEC junkie wrote:
> I was wondering if I could get some help here, I cant seem to figure out
> why I'm getting blocked..well it's not really blocking but I know this
> is a false positive but can't get the rule to work correctly:
>

<snip>

> --bec3cc26-H--
> Message: Warning. Unconditional match in SecAction. [file
> "/web/root/apache/conf.d/modsecurity/modsecurity_crs_41_xss_attacks.conf"]
> [line "15"]
> Apache-Handler: jakarta-servlet
> Stopwatch: 1250923136064289 175742 (338* 6749 166779)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
> core ruleset/2.0.1. <http://2.0.1.>
> Server: Apache/2.2.11 (Unix)
>
> --bec3cc26-K--
> SecAction
> "phase:1,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"

<snip>

> SecAction "phase:2,log,skipAfter:END_XSS_REGEX"
>
> --bec3cc26-Z--

Looks like that last one should be a "nolog", not a "log".

SecAction "phase:2,nolog,skipAfter:END_XSS_REGEX"

If so, we will fix it in the next release.

thanks,
-B

-- 
Brian Rectanus
Breach Security

From ossec.junkie at gmail.com  Tue Aug 25 19:28:11 2009
From: ossec.junkie at gmail.com (OSSEC junkie)
Date: Tue, 25 Aug 2009 16:28:11 -0700
Subject: [Owasp-modsecurity-core-rule-set] Fix blocking issue
In-Reply-To: <4A944051.1050002@breach.com>
References: <869a38360908251239p3d15fed0lf0cccee0c4e22a23@mail.gmail.com>
	<4A944051.1050002@breach.com>
Message-ID: <869a38360908251628lfee944ar4f8eb521eb796b85@mail.gmail.com>

Checking this out now, will update when this is tested fully...thanks!


On Tue, Aug 25, 2009 at 12:49 PM, Brian Rectanus
<Brian.Rectanus at breach.com>wrote:

>
>
> OSSEC junkie wrote:
>
>> I was wondering if I could get some help here, I cant seem to figure out
>> why I'm getting blocked..well it's not really blocking but I know this
>> is a false positive but can't get the rule to work correctly:
>>
>>
> <snip>
>
>  --bec3cc26-H--
>> Message: Warning. Unconditional match in SecAction. [file
>> "/web/root/apache/conf.d/modsecurity/modsecurity_crs_41_xss_attacks.conf"]
>> [line "15"]
>> Apache-Handler: jakarta-servlet
>> Stopwatch: 1250923136064289 175742 (338* 6749 166779)
>> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
>> core ruleset/2.0.1. <http://2.0.1.>
>> Server: Apache/2.2.11 (Unix)
>>
>> --bec3cc26-K--
>> SecAction
>>
>> "phase:1,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
>>
>
> <snip>
>
>  SecAction "phase:2,log,skipAfter:END_XSS_REGEX"
>>
>> --bec3cc26-Z--
>>
>
> Looks like that last one should be a "nolog", not a "log".
>
> SecAction "phase:2,nolog,skipAfter:END_XSS_REGEX"
>
> If so, we will fix it in the next release.
>
> thanks,
> -B
>
> --
> Brian Rectanus
> Breach Security
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090825/368b5831/attachment.html 

From dreamice.jiang at gmail.com  Fri Aug 28 02:57:41 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Fri, 28 Aug 2009 14:57:41 +0800
Subject: [Owasp-modsecurity-core-rule-set] How can we identify this type of
	XSS attack
Message-ID: <d5dfca260908272357j1719f8coe4b60c269edf7d33@mail.gmail.com>

Dear all,
I came accros the following problem than I can't use modsecurity to identify
such type of XSS attack:
http://192.168.3.144/product.asp?tp=67=%2a%2f%2d%2d%3e%27%22%29%3b%3e%3c%2f%49%66%52%61%4d%65%3e%3c%2f%53%43%72%69%50%74%3e%3c%2f%73%54%79%4c%65%3e%3c%2f%54%69%74%4c%65%3e%3c%2f%74%45%58%74%41%72%65%41%3e%3c%73%63%52%69%50%54%3e%61%6c%65%72%74%28%27%58%73%73%54%65%73%74%27%29%3c%2f%53%63%72%49%50%54%3e

The decoded URL is:
http://192.168.3.144/product.asp?tp=67=*/-->'");></IfRaMe></SCriPt></sTyLe></TitLe></tEXtAreA><scRiPT>alert('XssTest')</ScrIPT
>

Hope you have good solutions to share with all of us!
Thanks a lot!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090828/6eeffa57/attachment.html 

From dreamice.jiang at gmail.com  Fri Aug 28 09:35:37 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Fri, 28 Aug 2009 21:35:37 +0800
Subject: [Owasp-modsecurity-core-rule-set] What does the rule ID stand for?
Message-ID: <d5dfca260908280635s49fa9963wdb3580c3df1e87e6@mail.gmail.com>

Dear all,

I find every modsecurity rule has its own rule ID, some rules may share the
same ID.
I dont know why the rule has a specify ID. If the ID only a unique No.,but
why they are marked from 1, 2, 3, ...

Hope for your reply. Thanks in advance!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090828/1210a803/attachment.html 

From Brian.Rectanus at breach.com  Fri Aug 28 12:22:18 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Fri, 28 Aug 2009 09:22:18 -0700
Subject: [Owasp-modsecurity-core-rule-set] How can we identify this type
 of	XSS attack
In-Reply-To: <d5dfca260908272357j1719f8coe4b60c269edf7d33@mail.gmail.com>
References: <d5dfca260908272357j1719f8coe4b60c269edf7d33@mail.gmail.com>
Message-ID: <4A98043A.7070306@breach.com>

Junyong Jiang wrote:
> Dear all,
> I came accros the following problem than I can't use modsecurity to
> identify such type of XSS attack:
> http://192.168.3.144/product.asp?tp=67=%2a%2f%2d%2d%3e%27%22%29%3b%3e%3c%2f%49%66%52%61%4d%65%3e%3c%2f%53%43%72%69%50%74%3e%3c%2f%73%54%79%4c%65%3e%3c%2f%54%69%74%4c%65%3e%3c%2f%74%45%58%74%41%72%65%41%3e%3c%73%63%52%69%50%54%3e%61%6c%65%72%74%28%27%58%73%73%54%65%73%74%27%29%3c%2f%53%63%72%49%50%54%3e
> The decoded URL is:
> http://192.168.3.144/product.asp?tp=67=*/-->'");></IfRaMe></SCriPt></sTyLe></TitLe></tEXtAreA><scRiPT>alert('XssTest')</ScrIPT
> <http://192.168.3.144/product.asp?tp=67=*/-->'");></IfRaMe></SCriPt></sTyLe></TitLe></tEXtAreA><scRiPT>alert('XssTest')</ScrIPT>>
> Hope you have good solutions to share with all of us!
> Thanks a lot!
>

1) You did not specify which version of, well, anything you used.
2) Are you using the Core Rules?  What version?

I cranked up the default CRS 2.0.1 and it detected this just fine:

Message: Pattern match "\balert\b\W*?\(" at TX:pm_xss_data_ARGS:tp. 
[file 
"/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"] 
[line "142"] [id "958052"] [msg "Cross-site Scripting (XSS) Attack"] 
[data "alert("] [severity "CRITICAL"] [tag "WEB_ATTACK/XSS"]
Message: Pattern match "\< ?script\b" at TX:pm_xss_data_ARGS:tp. [file 
"/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"] 
[line "190"] [id "958051"] [msg "Cross-site Scripting (XSS) Attack"] 
[data "<script"] [severity "CRITICAL"] [tag "WEB_ATTACK/XSS"]
Message: Pattern match 
"<(a|abbr|acronym|address|applet|area|audioscope|b|base|basefront|bdo|bgsound|big|blackface|blink|blockquote|body|bq|br|button|caption|center|cite|code|col|colgroup|comment|dd|del|dfn|dir|div|dl|dt|em|embed|fieldset|fn|font|form|frame|frameset|h1|head|h 
..." at ARGS:tp. [file 
"/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"] 
[line "281"] [msg "XSS Attack Detected"]
Message: Pattern match "(fromcharcode|alert|eval)\s*\(" at ARGS:tp. 
[file 
"/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"] 
[line "373"] [msg "XSS Attack Detected"]
Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file 
"/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_60_correlation.conf"] 
[line "41"] [msg "Transactional Anomaly Score (score 61): XSS Attack 
Detected"]
Action: Intercepted (phase 2)

-B

-- 
Brian Rectanus
Breach Security

From Brian.Rectanus at breach.com  Fri Aug 28 12:33:08 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Fri, 28 Aug 2009 09:33:08 -0700
Subject: [Owasp-modsecurity-core-rule-set] What does the rule ID stand
 for?
In-Reply-To: <d5dfca260908280635s49fa9963wdb3580c3df1e87e6@mail.gmail.com>
References: <d5dfca260908280635s49fa9963wdb3580c3df1e87e6@mail.gmail.com>
Message-ID: <4A9806C4.9080103@breach.com>

Junyong Jiang wrote:
> Dear all,
> I find every modsecurity rule has its own rule ID, some rules may share
> the same ID.
> I dont know why the rule has a specify ID. If the ID only a unique
> No.,but why they are marked from 1, 2, 3, ...
> Hope for your reply. Thanks in advance!

Originally it was intended to identify a specific rule.  This allowed 
you to do exceptions to the rules, etc.

However, as rules became more complex, it became required to write a 
singe "rule" (better named "recipe") with multiple SecRule/SecAction 
directives.  So, should all those rules have the same ID, or multiple? 
It was not clear.

Now, with CRS v2.0, we have anamoly scoring and better mechimism for 
exceptions, so the IDs are of less importance and really quite a pain to 
maintain them as unique.

We are trying to come up with a solution for this.  One of these we 
discussed was date-like IDs with prefixes.  For example:

bsr-20090928-211305

bsr = Breach Security Rule (prefix to avoid name clash)
20090928 = 28 Aug 2009
211305 = 21:13:05 GMT

Then modifying the ID range operators to deal with such a rule ID and 
treat this as just "20090928211305" or just do string comparisons 
(alpha-numeric sort) vs numeric ranges.

Any suggestions are welcome.

-B

-- 
Brian Rectanus
Breach Security

From dreamice.jiang at gmail.com  Fri Aug 28 12:45:03 2009
From: dreamice.jiang at gmail.com (Junyong Jiang)
Date: Sat, 29 Aug 2009 00:45:03 +0800
Subject: [Owasp-modsecurity-core-rule-set] How can we identify this type
	of XSS attack
In-Reply-To: <4A98043A.7070306@breach.com>
References: <d5dfca260908272357j1719f8coe4b60c269edf7d33@mail.gmail.com>
	<4A98043A.7070306@breach.com>
Message-ID: <d5dfca260908280945ha3dd938g66c28c85fbb31b92@mail.gmail.com>

Thank you Brian!
I use core rule set version 1.6.

2009/8/29 Brian Rectanus <Brian.Rectanus at breach.com>

>  Junyong Jiang wrote:
>
>> Dear all,
>> I came accros the following problem than I can't use modsecurity to
>> identify such type of XSS attack:
>>
>> http://192.168.3.144/product.asp?tp=67=%2a%2f%2d%2d%3e%27%22%29%3b%3e%3c%2f%49%66%52%61%4d%65%3e%3c%2f%53%43%72%69%50%74%3e%3c%2f%73%54%79%4c%65%3e%3c%2f%54%69%74%4c%65%3e%3c%2f%74%45%58%74%41%72%65%41%3e%3c%73%63%52%69%50%54%3e%61%6c%65%72%74%28%27%58%73%73%54%65%73%74%27%29%3c%2f%53%63%72%49%50%54%3e
>> The decoded URL is:
>> http://192.168.3.144/product.asp?tp=67=*/--
>> >'");></IfRaMe></SCriPt></sTyLe></TitLe></tEXtAreA><scRiPT>alert('XssTest')</ScrIPT
>> <http://192.168.3.144/product.asp?tp=67=*/--
>> >'");></IfRaMe></SCriPt></sTyLe></TitLe></tEXtAreA><scRiPT>alert('XssTest')</ScrIPT>>
>> Hope you have good solutions to share with all of us!
>> Thanks a lot!
>>
>>
> 1) You did not specify which version of, well, anything you used.
> 2) Are you using the Core Rules?  What version?
>
> I cranked up the default CRS 2.0.1 and it detected this just fine:
>
> Message: Pattern match "\balert\b\W*?\(" at TX:pm_xss_data_ARGS:tp. [file
> "/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "142"] [id "958052"] [msg "Cross-site Scripting (XSS) Attack"] [data
> "alert("] [severity "CRITICAL"] [tag "WEB_ATTACK/XSS"]
> Message: Pattern match "\< ?script\b" at TX:pm_xss_data_ARGS:tp. [file
> "/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "190"] [id "958051"] [msg "Cross-site Scripting (XSS) Attack"] [data
> "<script"] [severity "CRITICAL"] [tag "WEB_ATTACK/XSS"]
> Message: Pattern match
> "<(a|abbr|acronym|address|applet|area|audioscope|b|base|basefront|bdo|bgsound|big|blackface|blink|blockquote|body|bq|br|button|caption|center|cite|code|col|colgroup|comment|dd|del|dfn|dir|div|dl|dt|em|embed|fieldset|fn|font|form|frame|frameset|h1|head|h
> ..." at ARGS:tp. [file
> "/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "281"] [msg "XSS Attack Detected"]
> Message: Pattern match "(fromcharcode|alert|eval)\s*\(" at ARGS:tp. [file
> "/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_41_xss_attacks.conf"]
> [line "373"] [msg "XSS Attack Detected"]
> Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
> "/home/brectanus/projects/test/apache/modsecurity-crs_2.0.1/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score (score 61): XSS Attack
> Detected"]
> Action: Intercepted (phase 2)
>
> -B
>
> --
> Brian Rectanus
> Breach Security
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090829/d5a2de92/attachment.html 

From sofuxro at yahoo.com  Sun Aug 30 12:27:52 2009
From: sofuxro at yahoo.com (clau .)
Date: Sun, 30 Aug 2009 09:27:52 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] using anomaly score
Message-ID: <704377.76897.qm@web33303.mail.mud.yahoo.com>

I get a lot of google bot logs like this one:

GET /robots.txt HTTP/1.1
Host: www.mydomain.com
Connection: Keep-alive
Accept: text/plain,text/html
From: googlebot(at)googlebot.com
User-Agent: Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)
Accept-Encoding: gzip,deflate

Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file "modsecurity_crs_60_correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score 5): "]

How can I stop this from logs?

Regards,
Symba



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090830/7aea445d/attachment.html 

From Claude.Durocher at mcccf.gouv.qc.ca  Mon Aug 31 15:13:01 2009
From: Claude.Durocher at mcccf.gouv.qc.ca (Claude.Durocher at mcccf.gouv.qc.ca)
Date: Mon, 31 Aug 2009 15:13:01 -0400
Subject: [Owasp-modsecurity-core-rule-set] False positive with DWA
Message-ID: <OF57406AF8.BEEA4C9D-ON85257623.00697136-85257623.00698FFA@mcccf.gouv.qc.ca>



Hello,

Hi

I'm using v2.01 of core rules and I'm getting false positives with Domino
Web Access (Apache set up as a reverse proxy). How can I correct this.

Here's a sample :

HTTP/1.0 400 Bad Request
Expires: Tue, 01 Jan 1980 06:00:00 GMT
Content-Type: text/html
Content-Language: fr
Cache-control: no-cache
Vary: Accept-Encoding,User-Agent
Content-Encoding: gzip
Connection: close

--c68d233e-H--
Apache-Handler: proxy-server
Stopwatch: 1251739580252930 106828 (1268 82911 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
ruleset/2.0.1.
Server: Apache/2.2.10 (Linux/SUSE)

--c68d233e-K--
SecAction
"phase:1,status:403,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remote_addr}"
SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
XML:/*|!REQUEST_HEADERS:Referer" "@pmFromFile
modsecurity_40_generic_attacks.data"
"phase:2,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=
+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
XML:/*|!REQUEST_HEADERS:Referer" "@pmFromFile
modsecurity_40_generic_attacks.data"
"phase:2,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=
+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
XML:/*|!REQUEST_HEADERS:Referer" "@pmFromFile
modsecurity_40_generic_attacks.data"
"phase:2,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=
+1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
SecRule "&TX:/SQL_INJECTION/" "@eq 0"
"phase:2,status:403,t:none,nolog,skipAfter:END_SQL_INJECTION_WEAK"
SecAction "phase:2,status:403,nolog,skipAfter:END_XSS_REGEX"
SecRule "REQUEST_FILENAME" "!@pmFromFile
modsecurity_46_et_sql_injection.data"
"phase:2,status:403,nolog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:normalisePathWin,skipAfter:END_ET_SQLI_RULES"
SecRule "REQUEST_FILENAME" "!@pmFromFile modsecurity_46_et_web_rules.data"
"phase:2,status:403,nolog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:normalisePathWin,skipAfter:END_SNORT_RULES"
SecRule "RESPONSE_BODY" "!@pmFromFile modsecurity_50_outbound.data"
"phase:4,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,nolog,allow"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090831/e5c85070/attachment.html 

From rcbarnett at gmail.com  Mon Aug 31 15:16:52 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Mon, 31 Aug 2009 15:16:52 -0400
Subject: [Owasp-modsecurity-core-rule-set] False positive with DWA
In-Reply-To: <OF57406AF8.BEEA4C9D-ON85257623.00697136-85257623.00698FFA@mcccf.gouv.qc.ca>
References: <OF57406AF8.BEEA4C9D-ON85257623.00697136-85257623.00698FFA@mcccf.gouv.qc.ca>
Message-ID: <200908311516.53100.rcbarnett@gmail.com>

What is the request?  I looking at Section K of the matched rules, it doesn't 
look like any rule matched that triggered a 400 Bad Request status code.  I 
would look in the error_log file to see why Apache triggered this status code.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

On Monday 31 August 2009 03:13:01 pm Claude.Durocher at mcccf.gouv.qc.ca wrote:
> Hello,
>
> Hi
>
> I'm using v2.01 of core rules and I'm getting false positives with Domino
> Web Access (Apache set up as a reverse proxy). How can I correct this.
>
> Here's a sample :
>
> HTTP/1.0 400 Bad Request
> Expires: Tue, 01 Jan 1980 06:00:00 GMT
> Content-Type: text/html
> Content-Language: fr
> Cache-control: no-cache
> Vary: Accept-Encoding,User-Agent
> Content-Encoding: gzip
> Connection: close
>
> --c68d233e-H--
> Apache-Handler: proxy-server
> Stopwatch: 1251739580252930 106828 (1268 82911 -)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
> ruleset/2.0.1.
> Server: Apache/2.2.10 (Linux/SUSE)
>
> --c68d233e-K--
> SecAction
> "phase:1,status:403,t:none,pass,nolog,initcol:global=global,initcol:ip=%{re
>mote_addr}" SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
> XML:/*|!REQUEST_HEADERS:Referer" "@pmFromFile
> modsecurity_40_generic_attacks.data"
> "phase:2,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhit
>eSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=
> +1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
> XML:/*|!REQUEST_HEADERS:Referer" "@pmFromFile
> modsecurity_40_generic_attacks.data"
> "phase:2,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhit
>eSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=
> +1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
> SecRule "REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
> XML:/*|!REQUEST_HEADERS:Referer" "@pmFromFile
> modsecurity_40_generic_attacks.data"
> "phase:2,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhit
>eSpace,t:lowercase,nolog,pass,setvar:tx.pm_score=
> +1,setvar:tx.pm_data_%{matched_var_name}=%{matched_var}"
> SecRule "&TX:/SQL_INJECTION/" "@eq 0"
> "phase:2,status:403,t:none,nolog,skipAfter:END_SQL_INJECTION_WEAK"
> SecAction "phase:2,status:403,nolog,skipAfter:END_XSS_REGEX"
> SecRule "REQUEST_FILENAME" "!@pmFromFile
> modsecurity_46_et_sql_injection.data"
> "phase:2,status:403,nolog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:normal
>isePathWin,skipAfter:END_ET_SQLI_RULES" SecRule "REQUEST_FILENAME"
> "!@pmFromFile modsecurity_46_et_web_rules.data"
> "phase:2,status:403,nolog,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:normal
>isePathWin,skipAfter:END_SNORT_RULES" SecRule "RESPONSE_BODY" "!@pmFromFile
> modsecurity_50_outbound.data"
> "phase:4,status:403,t:none,t:urlDecodeUni,t:htmlEntityDecode,nolog,allow"

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090831/7b0d1650/attachment.html 

From rcbarnett at gmail.com  Mon Aug 31 15:21:35 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Mon, 31 Aug 2009 15:21:35 -0400
Subject: [Owasp-modsecurity-core-rule-set] using anomaly score
In-Reply-To: <704377.76897.qm@web33303.mail.mud.yahoo.com>
References: <704377.76897.qm@web33303.mail.mud.yahoo.com>
Message-ID: <200908311521.35682.rcbarnett@gmail.com>

What other rule triggered?  The rule you are showing below indicates that some 
other rule triggered and added 5 points to the anomaly score.  This should be 
listed in the audit log file right next to the Message data you showed below.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

On Sunday 30 August 2009 12:27:52 pm clau . wrote:
> I get a lot of google bot logs like this one:
>
> GET /robots.txt HTTP/1.1
> Host: www.mydomain.com
> Connection: Keep-alive
> Accept: text/plain,text/html
> From: googlebot(at)googlebot.com
> User-Agent: Mozilla/5.0 (compatible; Googlebot/2.1;
> +http://www.google.com/bot.html) Accept-Encoding: gzip,deflate
>
> Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
> "modsecurity_crs_60_correlation.conf"] [line "41"] [msg "Transactional
> Anomaly Score (score 5): "]
>
> How can I stop this from logs?
>
> Regards,
> Symba

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090831/9d97f6aa/attachment.html 

