<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] RegEx in CRS 3.0.2 942200 too	broad?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20RegEx%20in%20CRS%203.0.2%20942200%20too%0A%09broad%3F&In-Reply-To=%3C1400F7C2-3406-4577-8BB0-2FBE61ADD76E%40pumastudios.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="002524.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] RegEx in CRS 3.0.2 942200 too	broad?</H1>
    <B>Ken Brucker</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20RegEx%20in%20CRS%203.0.2%20942200%20too%0A%09broad%3F&In-Reply-To=%3C1400F7C2-3406-4577-8BB0-2FBE61ADD76E%40pumastudios.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] RegEx in CRS 3.0.2 942200 too	broad?">ken at pumastudios.com
       </A><BR>
    <I>Wed Jan 10 19:23:48 UTC 2018</I>
    <P><UL>
        
        <LI>Next message: <A HREF="002524.html">[Owasp-modsecurity-core-rule-set] RegEx in CRS 3.0.2 942200 too broad?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2523">[ date ]</a>
              <a href="thread.html#2523">[ thread ]</a>
              <a href="subject.html#2523">[ subject ]</a>
              <a href="author.html#2523">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've been looking at some false positives related to rule 942200.

Side note, I'm running CRS 3.0.2 but the rules still have a version 3.0.0 tag. I was surprised to see that.

Here's an exemplar from the audit file:

Message: Warning. Pattern match &quot;(?i:(?:,.*?[)\\da-f\&quot;'`][\&quot;'`](?:[\&quot;'`].*?[\&quot;'`]|\\Z|[^\&quot;'`]+))|(?:\\Wselect.+\\W*?from)|((?:select|create|rename|truncate|load|alter|delete|update|insert|desc)\\s*?\\(\\s*?space\\s*?\\())&quot; at ARGS:data[]. [file &quot;/etc/httpd/modsecurity.d/crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf&quot;] [line &quot;649&quot;] [id &quot;942200&quot;] [rev &quot;2&quot;] [msg &quot;Detects MySQL comment-/space-obfuscated injections and backtick termination&quot;] [data &quot;Matched Data: ,4947,4937,4935,4929,4463,4430,5905,5766,7878,7570\x22] found within ARGS:data[]: [gallery columns=\x225\x22 size=\x22medium\x22 ids=\x224953,4947,4937,4935,4929,4463,4430,5905,5766,7878,7570\x22]&quot;] [severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] [accuracy &quot;8&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-sqli&quot;] [tag &quot;OWASP_CRS/WEB_ATTACK/SQL_INJECTION&quot;] [tag &quot;WASCTC/WASC-19&quot;] [tag &quot;OWASP_TOP_10/A1&quot;] [tag &quot;OWASP_AppSensor/CIE1&quot;] [tag &quot;PCI/6.5.2&quot;] [tag &quot;paranoia-level/2&quot;]

After looking at this rule a bit, it will trigger on a string like:

	To quote William Shakespeare, &quot;to be, or not to be&quot;.

The first alternative in the regex matches a very broad range of text and seems far too general. Is this intentional? It looks like the intent is to capture variations on quoted numbers but it's going above and beyond.

The rule:

SecRule REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|ARGS_NAME
S|ARGS|XML:/* &quot;(?i:(?:,.*?[)\da-f\&quot;'`][\&quot;'`](?:[\&quot;'`].*?[\&quot;'`]|\Z|[^\&quot;'`]+))|(?:
\Wselect.+\W*?from)|((?:select|create|rename|truncate|load|alter|delete|update|i
nsert|desc)\s*?\(\s*?space\s*?\())&quot; \
        &quot;phase:request,\
        rev:'2',\
        ver:'OWASP_CRS/3.0.0',\
        maturity:'9',\
        accuracy:'8',\
        capture,\
        t:none,t:urlDecodeUni,\
        block,\
        msg:'Detects MySQL comment-/space-obfuscated injections and backtick ter
mination',\
        id:942200,\
        tag:'application-multi',\
        tag:'language-multi',\
        tag:'platform-multi',\
        tag:'attack-sqli',\
        tag:'OWASP_CRS/WEB_ATTACK/SQL_INJECTION',\
        tag:'WASCTC/WASC-19',\
        tag:'OWASP_TOP_10/A1',\
        tag:'OWASP_AppSensor/CIE1',\
        tag:'PCI/6.5.2',\
        tag:'paranoia-level/2',\
        logdata:'Matched Data: %{TX.0} found within %{MATCHED_VAR_NAME}: %{MATCHED_VAR}',\
        severity:'CRITICAL',\
        setvar:'tx.msg=%{rule.msg}',\
        setvar:tx.sql_injection_score=+%{tx.critical_anomaly_score},\
        setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},\
        setvar:'tx.%{rule.id}-OWASP_CRS/WEB_ATTACK/SQLI-%{matched_var_name}=%{tx.0}'&quot;
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180110/f1949f66/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180110/f1949f66/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="002524.html">[Owasp-modsecurity-core-rule-set] RegEx in CRS 3.0.2 942200 too broad?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2523">[ date ]</a>
              <a href="thread.html#2523">[ thread ]</a>
              <a href="subject.html#2523">[ subject ]</a>
              <a href="author.html#2523">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
