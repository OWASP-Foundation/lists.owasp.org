<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20Negatives%20%28was%3A%20OWASP%0A%20ModSecurity%20Core%20Rule%20Set%20Community%20Summit%3A%20July%204%2C%202018%2C%20in%20London%29&In-Reply-To=%3C35d55b354da3439e94284d04a1f25b8a%40BL2PR9302MB0003.024d.mgd.msft.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002550.html">
   <LINK REL="Next"  HREF="002552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)</H1>
    <B>Hiranmayi Palanki</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20Negatives%20%28was%3A%20OWASP%0A%20ModSecurity%20Core%20Rule%20Set%20Community%20Summit%3A%20July%204%2C%202018%2C%20in%20London%29&In-Reply-To=%3C35d55b354da3439e94284d04a1f25b8a%40BL2PR9302MB0003.024d.mgd.msft.net%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)">Hiranmayi.Palanki at aexp.com
       </A><BR>
    <I>Thu Mar 22 17:40:14 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="002550.html">[Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
</A></li>
        <LI>Next message: <A HREF="002552.html">[Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2551">[ date ]</a>
              <a href="thread.html#2551">[ thread ]</a>
              <a href="subject.html#2551">[ subject ]</a>
              <a href="author.html#2551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Manuel and Christian for your responses.

The application will have a thin layer of business rule whitelist regex based input validation &#8211; therefore the issue with XSS noted below may not be that much of a problem. For SQLinjection, it&#8217;s hard to guarantee that developers will always use parameterized queries consistently throughout the SDLC. In my opinion, encoded XSS attacks should be tackled at the lower paranoia levels.

I&#8217;d have to familiarize myself with the process of creating custom rules.

Is there a plan to enforce Content Security Policy Directives and other HTTP security response headers (e.g. X-Frame-Options/Frame-Ancestors). In some of the testing that I did, it is evident that these security headers are not being injected.



From: owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">aexp.com at lists.owasp.org</A> [mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">aexp.com at lists.owasp.org</A>] On Behalf Of Manuel Spartan
Sent: Thursday, March 22, 2018 1:31 PM
To: Christian Folini &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt;
Cc: OWASP CRS &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)

Hi Hiranmayi,

Do you think in implementing input validation at all in your app?

&gt;<i> Encoded XSS attacks (stopped at PL2 as Christian said)
</I>
&gt;<i> <A HREF="http://localhost:8082/xss2?uid=%3Balert%281%29%3B">http://localhost:8082/xss2?uid=%3Balert%281%29%3B</A>
</I>


&gt;<i> SQLi
</I>
&gt;<i> <A HREF="http://localhost:8082/sqli2?uid=3-2">http://localhost:8082/sqli2?uid=3-2</A>
</I>If the response display the same as uid=1 you have a nice injection as the back-end engine is evaluating the operation, however sending long complicated payloads will be difficult in Paranoia Level 2 due to libinjection inspections on ARGS and very hard in PL 4 as all non alphanumeric characters will cause a blocked request but that will be extremely annoying to implement if you use non-alphanumeric characters.

Why don't you simply make positive validation rules additional to CRS in paranoia level 2? That will be easier, faster and more effective if your app is not so complex but requires tailor made configurations and application knowledge while the CRS is generic and do not require much application knowledge.

i.e. This rule will accept only numeric values on the uid parameter on GET requests, with this you will get rid of both issues with the least effort, this is the kick... positive security power in action :)
SecRule ARGS:uid &quot;!@rx [0-9]+&quot; &quot;id:1,phase:1,deny,log,msg:'Bad value received'&quot;

Notice that the phase:1 is only for GET parameters and cannot be placed inside Apache locations or it may be silently ignored but is faster as most CRS rules are in phase:2 it will execute earlier and save you the execution of many rules.

You may find very useful to learn the basics on ModSecurity rule writing, other than the netnea tutorial to deal with False Positives shared by Christian:
Web Application Defender's Cookbook: Battling Hackers and Protecting Users (RBarnett) for quick receipes
ModSecurity Handbook (CFolini, IRistic) for general knowledge
<A HREF="https://coreruleset.org/category/blog/&lt;https://isolate.menlosecurity.com/1/3735928037/https:/coreruleset.org/category/blog/">https://coreruleset.org/category/blog/&lt;https://isolate.menlosecurity.com/1/3735928037/https:/coreruleset.org/category/blog/</A>&gt; (CRS blog)
<A HREF="https://spartantri.com/ModSecurity/&lt;https://isolate.menlosecurity.com/1/3735928037/https:/spartantri.com/ModSecurity/">https://spartantri.com/ModSecurity/&lt;https://isolate.menlosecurity.com/1/3735928037/https:/spartantri.com/ModSecurity/</A>&gt; (My blog, read the whitepaper on white listing)

Have fun!


2018-03-21 20:20 GMT+01:00 Christian Folini &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt;&gt;:
Hey Hiranmayi,

On Wed, Mar 21, 2018 at 02:25:32PM +0000, Hiranmayi Palanki wrote:
&gt;<i> What is the recommended Paranoia Level for an enterprise Internet facing
</I>&gt;<i> application, that does not break the application functionality?
</I>
I'd say you should put it at least on level 2. This will bring some false
positives and you deal with those as described in the documentation.

&gt;<i> Let&#8217;s say if I have the default configuration enabled, and the encoded XSS
</I>&gt;<i> attacks are getting through, what is the best way to block the encoded XSS
</I>&gt;<i> attacks without enabling the higher Paranoia Levels?
</I>
If you do not want to use CRS rules, you need to write your own XSS rules
that do a better job than CRS. There are very good XSS documents around,
many of them several pages long with lots of example payloads. You need to
cover all these without breaking your application.

Most people find it easier to use CRS and deal with the false positives.

Ahoj,

Christian

--
I have always observed that to succeed in the world one should appear
like a fool but be wise.
-- Charles de Montesquieu
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;https://isolate.menlosecurity.com/1/3735928037/https:/lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;https://isolate.menlosecurity.com/1/3735928037/https:/lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>&gt;



American Express made the following annotations
******************************************************************************
&quot;This message and any attachments are solely for the intended recipient and may contain confidential or privileged information. If you are not the intended recipient, any disclosure, copying, use, or distribution of the information included in this message and any attachments is prohibited. If you have received this communication in error, please notify us by reply e-mail and immediately and permanently delete this message and any attachments. Thank you.&quot;

American Express a ajout&#233; le commentaire suivant le Ce courrier et toute pi&#232;ce jointe qu'il contient sont r&#233;serv&#233;s au seul destinataire indiqu&#233; et peuvent renfermer des 
renseignements confidentiels et privil&#233;gi&#233;s. Si vous n'&#234;tes pas le destinataire pr&#233;vu, toute divulgation, duplication, utilisation ou distribution du courrier ou de toute pi&#232;ce jointe est interdite. Si vous avez re&#231;u cette communication par erreur, veuillez nous en aviser par courrier et d&#233;truire imm&#233;diatement le courrier et les pi&#232;ces jointes. Merci.

******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180322/5328895c/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180322/5328895c/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002550.html">[Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
</A></li>
	<LI>Next message: <A HREF="002552.html">[Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2551">[ date ]</a>
              <a href="thread.html#2551">[ thread ]</a>
              <a href="subject.html#2551">[ subject ]</a>
              <a href="author.html#2551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
