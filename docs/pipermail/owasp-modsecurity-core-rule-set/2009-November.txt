From Ryan.Barnett at breach.com  Tue Nov  3 09:41:30 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Tue, 3 Nov 2009 09:41:30 -0500
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] Posting
	HTML contents
In-Reply-To: <200911031429.14513.assistenza@alfait.org>
References: <200911031429.14513.assistenza@alfait.org>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AD5@MONET.utopiasystems.net>

Fabian,
This is a CRS issue so for future issues please use the OWASP CRS mail-list (https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set).  I am cross-posting this to both lists.

You bring up an important and challenging issue related to detecting XSS attacks and that is how to identify malicious payloads while still allowing benign html conent.  Here are a few items to consider -

1) For the CRS v2 - you can add some exception rules to the 48 local exceptions file so that you can adjust the anomaly score based on the authorized page/parameter you have for the FCKeditor app, etc...).  If you send some audit log data related to these html posts, I could show you a more specific exception example.

2) What language is your app written in?  If it is php - then you could look at installing something like htmlpurifier to help weed out bad html from good html - http://htmlpurifier.org/

3) On a similar front - look at something like the OWASP Anti-Sammy app.

Hope this helps,
Ryan

________________________________________
From: Fabian Martintoni [assistenza at alfait.org]
Sent: Tuesday, November 03, 2009 8:29 AM
To: mod-security-users at lists.sourceforge.net
Subject: [mod-security-users] Posting HTML contents

Hi all,
today I've upgraded modsecurity to 2.5.10-r1 and more than half of my web
applications are giving me headache.

The more troublesome issue is (at least for now) that I cannot understand how
I can send HTML contents with a form...

For example... I have a form with an wysiwyg editor (FCKeditor, TinyMce etc)
how can I allow him to send his data? Every try is blocked by modsecurity:

[msg "Detects obfuscated script tags and XML wrapped HTML"]
[msg "Detects basic directory traversal"]
[msg "finds attribute breaking injections including obfuscated attributes"]
[msg "finds html breaking injections including whitespace attacks"]
[msg "Detects possibly malicious html elements including some attributes"]

I really need help on this thing, please.

Fabian

------------------------------------------------------------------------------
Come build with us! The BlackBerry(R) Developer Conference in SF, CA
is the only developer event you need to attend this year. Jumpstart your
developing skills, take BlackBerry mobile applications to market and stay
ahead of the curve. Join us from November 9 - 12, 2009. Register now!
http://p.sf.net/sfu/devconference
_______________________________________________
mod-security-users mailing list
mod-security-users at lists.sourceforge.net
https://lists.sourceforge.net/lists/listinfo/mod-security-users
Commercial ModSecurity Appliances, Rule Sets and Support:
http://www.modsecurity.org/breach/index.html

From d3taveras38d3 at gmail.com  Tue Nov  3 12:14:10 2009
From: d3taveras38d3 at gmail.com (David Taveras)
Date: Tue, 3 Nov 2009 11:14:10 -0600
Subject: [Owasp-modsecurity-core-rule-set] Excessive logging in audit.log
	and debug.log for modsecurity. How to deal?
Message-ID: <ed3aec3e0911030914m2e450ab1j4a3a613d894df1a4@mail.gmail.com>

Hello,

We have a site with about 2000 visits per day, and now the logging is
getting extremely hard to revise, as security is number one the ideal
situation for me would be to be able to classify the output into
groups so that I as a sysadmin can be aware of all, know if there is a
increase of hits for a particular rule, and most important is to know
when Iam getting (or tried to) getting SQL/PHP injected.

Is there a way without using commercial add-ons to classify all this
output and actually make sense of it?

In a perfect scenario I can have this log synced outside the server to
be analysed lively at another one and be able to create alerts. Would
this involve a commercial solution?

Thank you.

David Taveras

From Ryan.Barnett at breach.com  Tue Nov  3 12:50:48 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Tue, 3 Nov 2009 12:50:48 -0500
Subject: [Owasp-modsecurity-core-rule-set] Excessive logging in
 audit.log	and debug.log for modsecurity. How to deal?
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EDB@MONET.utopiasystems.net>

David - are you only looking at the correlated event in the apache error_log or are you also looking at the messages in the Mod audit_log file?  The events in the audit_log have the same attack/vuln category tagging as the previous rules (e.g. - WEB_ATTACK/SQL_INJECTION) so you could identify transactions of interest.


Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com 
www.Breach.com 


----- Original Message -----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>
To: owasp-modsecurity-core-rule-set at lists.owasp.org <owasp-modsecurity-core-rule-set at lists.owasp.org>
Sent: Tue Nov 03 12:14:10 2009
Subject: [Owasp-modsecurity-core-rule-set] Excessive logging in audit.log	and debug.log for modsecurity. How to deal?

Hello,

We have a site with about 2000 visits per day, and now the logging is
getting extremely hard to revise, as security is number one the ideal
situation for me would be to be able to classify the output into
groups so that I as a sysadmin can be aware of all, know if there is a
increase of hits for a particular rule, and most important is to know
when Iam getting (or tried to) getting SQL/PHP injected.

Is there a way without using commercial add-ons to classify all this
output and actually make sense of it?

In a perfect scenario I can have this log synced outside the server to
be analysed lively at another one and be able to create alerts. Would
this involve a commercial solution?

Thank you.

David Taveras
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From d3taveras38d3 at gmail.com  Tue Nov  3 12:52:28 2009
From: d3taveras38d3 at gmail.com (David Taveras)
Date: Tue, 3 Nov 2009 11:52:28 -0600
Subject: [Owasp-modsecurity-core-rule-set] Excessive logging in
	audit.log and debug.log for modsecurity. How to deal?
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EDB@MONET.utopiasystems.net>
References: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EDB@MONET.utopiasystems.net>
Message-ID: <ed3aec3e0911030952v11659ae2ud7424f8397833777@mail.gmail.com>

I have not noticed this. Is there anyway to scale all the possible
categories in order if importance or possible damage?

Thank you.

David

On Tue, Nov 3, 2009 at 11:50 AM, Ryan Barnett <Ryan.Barnett at breach.com> wrote:
> David - are you only looking at the correlated event in the apache error_log or are you also looking at the messages in the Mod audit_log file? ?The events in the audit_log have the same attack/vuln category tagging as the previous rules (e.g. - WEB_ATTACK/SQL_INJECTION) so you could identify transactions of interest.
>
>
> Ryan C. Barnett
> Director of Application Security Research
> Breach Security, Inc.
> Ryan.Barnett at Breach.com
> www.Breach.com
>
>
> ----- Original Message -----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>
> To: owasp-modsecurity-core-rule-set at lists.owasp.org <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Sent: Tue Nov 03 12:14:10 2009
> Subject: [Owasp-modsecurity-core-rule-set] Excessive logging in audit.log ? ? ? and debug.log for modsecurity. How to deal?
>
> Hello,
>
> We have a site with about 2000 visits per day, and now the logging is
> getting extremely hard to revise, as security is number one the ideal
> situation for me would be to be able to classify the output into
> groups so that I as a sysadmin can be aware of all, know if there is a
> increase of hits for a particular rule, and most important is to know
> when Iam getting (or tried to) getting SQL/PHP injected.
>
> Is there a way without using commercial add-ons to classify all this
> output and actually make sense of it?
>
> In a perfect scenario I can have this log synced outside the server to
> be analysed lively at another one and be able to create alerts. Would
> this involve a commercial solution?
>
> Thank you.
>
> David Taveras
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

From Ryan.Barnett at breach.com  Tue Nov  3 13:02:09 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Tue, 3 Nov 2009 13:02:09 -0500
Subject: [Owasp-modsecurity-core-rule-set] Excessive logging
	in	audit.log and debug.log for modsecurity. How to deal?
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EDE@MONET.utopiasystems.net>

Actually - that is what the correlated events in the error_log are supposed to do :)

We got a lot of feedback from users that said that they didn't like the old alerting as it was tough to weed through them all to prioritize them.

What we did was to reassign the severity ratings.  The most severe rating for an inbound attck alone is 2.  Only correlated events (that also factor in the http response codes and response body errors) can generate severities 1 (which indicates an attack + error status code) or 0 (which indicate an attack + infoleak and that the attack may have been successful).

Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com 
www.Breach.com 


----- Original Message -----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>
To: owasp-modsecurity-core-rule-set at lists.owasp.org <owasp-modsecurity-core-rule-set at lists.owasp.org>
Sent: Tue Nov 03 12:52:28 2009
Subject: Re: [Owasp-modsecurity-core-rule-set] Excessive logging in	audit.log and debug.log for modsecurity. How to deal?

I have not noticed this. Is there anyway to scale all the possible
categories in order if importance or possible damage?

Thank you.

David

On Tue, Nov 3, 2009 at 11:50 AM, Ryan Barnett <Ryan.Barnett at breach.com> wrote:
> David - are you only looking at the correlated event in the apache error_log or are you also looking at the messages in the Mod audit_log file? ?The events in the audit_log have the same attack/vuln category tagging as the previous rules (e.g. - WEB_ATTACK/SQL_INJECTION) so you could identify transactions of interest.
>
>
> Ryan C. Barnett
> Director of Application Security Research
> Breach Security, Inc.
> Ryan.Barnett at Breach.com
> www.Breach.com
>
>
> ----- Original Message -----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>
> To: owasp-modsecurity-core-rule-set at lists.owasp.org <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Sent: Tue Nov 03 12:14:10 2009
> Subject: [Owasp-modsecurity-core-rule-set] Excessive logging in audit.log ? ? ? and debug.log for modsecurity. How to deal?
>
> Hello,
>
> We have a site with about 2000 visits per day, and now the logging is
> getting extremely hard to revise, as security is number one the ideal
> situation for me would be to be able to classify the output into
> groups so that I as a sysadmin can be aware of all, know if there is a
> increase of hits for a particular rule, and most important is to know
> when Iam getting (or tried to) getting SQL/PHP injected.
>
> Is there a way without using commercial add-ons to classify all this
> output and actually make sense of it?
>
> In a perfect scenario I can have this log synced outside the server to
> be analysed lively at another one and be able to create alerts. Would
> this involve a commercial solution?
>
> Thank you.
>
> David Taveras
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From assistenza at alfait.org  Thu Nov  5 05:23:07 2009
From: assistenza at alfait.org (Fabian Martintoni)
Date: Thu, 5 Nov 2009 11:23:07 +0100
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] Posting
	HTML contents
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AD5@MONET.utopiasystems.net>
References: <200911031429.14513.assistenza@alfait.org>
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AD5@MONET.utopiasystems.net>
Message-ID: <200911051123.08936.assistenza@alfait.org>

First of all thanks for the answer.

I'm using Gentoo, and upgrading from mod_security vesrion 2.5.9 to 2.5.10-r1 
fired the hell. I didnt notice anything before. Probably this was caused by 
mod_deflate [msg "ModSecurity does not support content encodings"]

Now there are a whole lot of webapps who stopped working. I've just found 
another one: impossible to login in dev-db/phppgadmin-4.2.2. 

I confess, ther first thought was about removing mod_security.

There are many strong restrictions even in the naming of the form fields. I 
know, security is expensive, I can live with that but I need to allow thrusted 
users to send html content through forms.

I write in PHP and JSP so I'm looking for an all-inclusive solution (but I 
gived a short look at HTMLpurifier and it seems to me an interesting product).

AntiSamy Project is very interesting too! And i will surely take a serious 
look in the future, but right now I need a more immediate solution.

To disable a whole vhost is possible to add SecRuleEngine Off in <Directory > 
but I wont go that far. Is there any whitelist? a list of files who would 
skipped by the security engine ?

Many thanks,
Fabian

In data marted? 3 novembre 2009 15:41:30, hai scritto:
> Fabian,
> This is a CRS issue so for future issues please use the OWASP CRS mail-list
>  (https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set)
> .  I am cross-posting this to both lists.
> 
> You bring up an important and challenging issue related to detecting XSS
>  attacks and that is how to identify malicious payloads while still
>  allowing benign html conent.  Here are a few items to consider -
> 
> 1) For the CRS v2 - you can add some exception rules to the 48 local
>  exceptions file so that you can adjust the anomaly score based on the
>  authorized page/parameter you have for the FCKeditor app, etc...).  If you
>  send some audit log data related to these html posts, I could show you a
>  more specific exception example.
> 
> 2) What language is your app written in?  If it is php - then you could
>  look at installing something like htmlpurifier to help weed out bad html
>  from good html - http://htmlpurifier.org/
> 
> 3) On a similar front - look at something like the OWASP Anti-Sammy app.
> 
> Hope this helps,
> Ryan
> 
> ________________________________________
> From: Fabian Martintoni [assistenza at alfait.org]
> Sent: Tuesday, November 03, 2009 8:29 AM
> To: mod-security-users at lists.sourceforge.net
> Subject: [mod-security-users] Posting HTML contents
> 
> Hi all,
> today I've upgraded modsecurity to 2.5.10-r1 and more than half of my web
> applications are giving me headache.
> 
> The more troublesome issue is (at least for now) that I cannot understand
>  how I can send HTML contents with a form...
> 
> For example... I have a form with an wysiwyg editor (FCKeditor, TinyMce
>  etc) how can I allow him to send his data? Every try is blocked by
>  modsecurity:
> 
> [msg "Detects obfuscated script tags and XML wrapped HTML"]
> [msg "Detects basic directory traversal"]
> [msg "finds attribute breaking injections including obfuscated attributes"]
> [msg "finds html breaking injections including whitespace attacks"]
> [msg "Detects possibly malicious html elements including some attributes"]
> 
> I really need help on this thing, please.
> 
> Fabian
> 
> ---------------------------------------------------------------------------
> --- Come build with us! The BlackBerry(R) Developer Conference in SF, CA is
>  the only developer event you need to attend this year. Jumpstart your
>  developing skills, take BlackBerry mobile applications to market and stay
>  ahead of the curve. Join us from November 9 - 12, 2009. Register now!
>  http://p.sf.net/sfu/devconference
> _______________________________________________
> mod-security-users mailing list
> mod-security-users at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
> Commercial ModSecurity Appliances, Rule Sets and Support:
> http://www.modsecurity.org/breach/index.html
> 

From ryan.barnett at breach.com  Thu Nov  5 08:42:46 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Thu, 5 Nov 2009 08:42:46 -0500
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] Posting
	HTML contents
In-Reply-To: <200911051123.08936.assistenza@alfait.org>
References: <200911031429.14513.assistenza@alfait.org>
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AD5@MONET.utopiasystems.net>
	<200911051123.08936.assistenza@alfait.org>
Message-ID: <200911050842.46963.ryan.barnett@breach.com>

On Thursday 05 November 2009 05:23:07 am Fabian Martintoni wrote:
> First of all thanks for the answer.
>
> I'm using Gentoo, and upgrading from mod_security vesrion 2.5.9 to
> 2.5.10-r1 fired the hell. I didnt notice anything before. Probably this was
> caused by mod_deflate [msg "ModSecurity does not support content
> encodings"]
>
No I don't think it was a mod_deflate issue but rather improved security 
coverage for CRS v2.  We improved the XSS identification considerably in the 
newer version.  In the previous versions, XSS detection was pretty poor and 
had some serious false negative/bypass issues.  Check out this blackhat XSS 
bypass preso in which they highlight older CRS issues - 
http://www.blackhat.com/presentations/bh-usa-09/VELANAVA/BHUSA09-VelaNava-
FavoriteXSS-SLIDES.pdf

> Now there are a whole lot of webapps who stopped working. I've just found
> another one: impossible to login in dev-db/phppgadmin-4.2.2.
>
Are you using the default anomaly scoring approach?  What scoring threshold do 
you have set?  You can easily add exception rules to increase the score or 
only inspect certain categories of issues for certain locations as well - say 
for your phppgadmin login.

> I confess, ther first thought was about removing mod_security.
>
Please don't go that route!  We went to great lengths with CRSv2 so that it 
will be easier for user to do exceptions.  You can either raise the overall 
anomaly scoring threshold or you can get granular and handle false positives 
in the exception file.  Take a look at some of the examples in the 48 local 
exceptions file for help.

> There are many strong restrictions even in the naming of the form fields. I
> know, security is expensive, I can live with that but I need to allow
> thrusted users to send html content through forms.
>
How are these *trusted* users identified?  By source IP or username or 
something?  Whatever it is, you can configure the rules to be more lenient for 
them or to let them bypass the rules altogether.

> I write in PHP and JSP so I'm looking for an all-inclusive solution (but I
> gived a short look at HTMLpurifier and it seems to me an interesting
> product).
>
> AntiSamy Project is very interesting too! And i will surely take a serious
> look in the future, but right now I need a more immediate solution.
>
> To disable a whole vhost is possible to add SecRuleEngine Off in <Directory
> > but I wont go that far. Is there any whitelist? a list of files who would
> skipped by the security engine ?
>
You can always add whitelist directives to a new 
modsecurity_crs_15_local_exceptions.conf file.  The rules in this file would 
execute before all of the other rules and would allow you to use either the 
ctl:ruleEngine=Off or allow:request actions.  I prefer the latter as it would 
still allow outbound inspection.

Hope this helps.

> Many thanks,
> Fabian
>
> In data marted? 3 novembre 2009 15:41:30, hai scritto:
> > Fabian,
> > This is a CRS issue so for future issues please use the OWASP CRS
> > mail-list
> > (https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >) .  I am cross-posting this to both lists.
> >
> > You bring up an important and challenging issue related to detecting XSS
> >  attacks and that is how to identify malicious payloads while still
> >  allowing benign html conent.  Here are a few items to consider -
> >
> > 1) For the CRS v2 - you can add some exception rules to the 48 local
> >  exceptions file so that you can adjust the anomaly score based on the
> >  authorized page/parameter you have for the FCKeditor app, etc...).  If
> > you send some audit log data related to these html posts, I could show
> > you a more specific exception example.
> >
> > 2) What language is your app written in?  If it is php - then you could
> >  look at installing something like htmlpurifier to help weed out bad html
> >  from good html - http://htmlpurifier.org/
> >
> > 3) On a similar front - look at something like the OWASP Anti-Sammy app.
> >
> > Hope this helps,
> > Ryan
> >
> > ________________________________________
> > From: Fabian Martintoni [assistenza at alfait.org]
> > Sent: Tuesday, November 03, 2009 8:29 AM
> > To: mod-security-users at lists.sourceforge.net
> > Subject: [mod-security-users] Posting HTML contents
> >
> > Hi all,
> > today I've upgraded modsecurity to 2.5.10-r1 and more than half of my web
> > applications are giving me headache.
> >
> > The more troublesome issue is (at least for now) that I cannot understand
> >  how I can send HTML contents with a form...
> >
> > For example... I have a form with an wysiwyg editor (FCKeditor, TinyMce
> >  etc) how can I allow him to send his data? Every try is blocked by
> >  modsecurity:
> >
> > [msg "Detects obfuscated script tags and XML wrapped HTML"]
> > [msg "Detects basic directory traversal"]
> > [msg "finds attribute breaking injections including obfuscated
> > attributes"] [msg "finds html breaking injections including whitespace
> > attacks"] [msg "Detects possibly malicious html elements including some
> > attributes"]
> >
> > I really need help on this thing, please.
> >
> > Fabian
> >
> > -------------------------------------------------------------------------
> >-- --- Come build with us! The BlackBerry(R) Developer Conference in SF,
> > CA is the only developer event you need to attend this year. Jumpstart
> > your developing skills, take BlackBerry mobile applications to market and
> > stay ahead of the curve. Join us from November 9 - 12, 2009. Register
> > now! http://p.sf.net/sfu/devconference
> > _______________________________________________
> > mod-security-users mailing list
> > mod-security-users at lists.sourceforge.net
> > https://lists.sourceforge.net/lists/listinfo/mod-security-users
> > Commercial ModSecurity Appliances, Rule Sets and Support:
> > http://www.modsecurity.org/breach/index.html
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091105/8689a43f/attachment.html 

From darkranger_red at hotmail.com  Wed Nov 11 12:15:16 2009
From: darkranger_red at hotmail.com (DarkRanger DarkRanger)
Date: Wed, 11 Nov 2009 17:15:16 +0000
Subject: [Owasp-modsecurity-core-rule-set] "document.gif" got denied after
 update ModSecurity to 2.5.10 with Core Rules v2
Message-ID: <COL122-W45D670C92FD136B890B78CF2AA0@phx.gbl>


File form here:
http://koji.fedoraproject.org/koji/buildinfo?buildID=140180

Here's my log:

[Thu Nov 12 00:26:05 2009] [error] [client 61.64.173.115] ModSecurity: Warning. Operator GE matched 5 at TX:anomaly_score. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score 20): Detects very basic XSS probings"] [hostname "darkranger.no-ip.org"] [uri "/image/document.gif"] [unique_id "SvrlnX8AAAEAAC0TRNwAAAAA"]

I guess this GIF file is just denied by name, because if I rename it to "document2.gif" and got passed. So how to fix in modsecurity?
 		 	   		  
_________________________________________________________________
??? Windows 7???????????????
http://windows.microsoft.com/shop
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091111/269004a5/attachment.html 

From Ryan.Barnett at breach.com  Wed Nov 11 12:23:44 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 11 Nov 2009 12:23:44 -0500
Subject: [Owasp-modsecurity-core-rule-set] "document.gif" got denied
 after update ModSecurity to 2.5.10 with Core Rules v2
In-Reply-To: <COL122-W45D670C92FD136B890B78CF2AA0@phx.gbl>
References: <COL122-W45D670C92FD136B890B78CF2AA0@phx.gbl>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AEA@MONET.utopiasystems.net>

Check in the modsec_audit.log file to see what the Message details are in section H.  This will show you exactly which rules were triggering and what portion of data matched.  i am guessing it is the "document." data.  What you will want to do is to create an exception in the modsecurity_crs_48_local_exceptions.conf file.  Take a look at the commented out examples in the file for guidance on what rule to use.  Basically, you will want to create a rule that will inspect the TX variable data from the previous XSS rule that matched.  You do this by specifying the correct rule id, and matched variable location and payload.  If all of this matches (which is a false positive in your case) you then simply expire that TX variable and decrement the anomaly score.

Let me know if you need any more help.

-Ryan

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of DarkRanger DarkRanger [darkranger_red at hotmail.com]
Sent: Wednesday, November 11, 2009 12:15 PM
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] "document.gif" got denied after update ModSecurity to 2.5.10 with Core Rules v2

File form here:
http://koji.fedoraproject.org/koji/buildinfo?buildID=140180

Here's my log:

[Thu Nov 12 00:26:05 2009] [error] [client 61.64.173.115] ModSecurity: Warning. Operator GE matched 5 at TX:anomaly_score. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score 20): Detects very basic XSS probings"] [hostname "darkranger.no-ip.org"] [uri "/image/document.gif"] [unique_id "SvrlnX8AAAEAAC0TRNwAAAAA"]

I guess this GIF file is just denied by name, because if I rename it to "document2.gif" and got passed. So how to fix in modsecurity?

________________________________
??? Windows 7?????????? ?????<http://windows.microsoft.com/shop>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091111/ab397f46/attachment.html 

From Ryan.Barnett at breach.com  Wed Nov 11 12:40:51 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 11 Nov 2009 12:40:51 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing the ModSecurity/Core
	Rule Set Demo Testing Page
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AEB@MONET.utopiasystems.net>

Please excuse the cross-posting, but we have some very exciting news to announce.  We have *finally* released our ModSecurity/Core Rule Set demonstration testing page - http://www.modsecurity.org/demo/

This page allows clients to send attack data to a ModSecurity/CRS installation on the www.modsecurity.org site where it will be first inspected by the CRS for attack payloads, it will then be proxied to the outstanding PHPIDS smoketest demo page here - http://demo.php-ids.org/.  The return traffic will then be inspected to see if any evasion issues exist and the user will be presented with results of all rules matches.

We are very excited about this demo page is it will cerntainly help to facilitate more community involvement with security testing of our rules.  Any errors, evasions, etc... can either be reported back here on the OWASP CRS mail-list and/or to the JIRA bug tracker system - https://www.modsecurity.org/tracker/browse/CORERULES

Have fun :)

-Breach Security Labs (Ryan Barnett and Brian Rectanus)

From chris.datfung at gmail.com  Wed Nov 11 13:49:47 2009
From: chris.datfung at gmail.com (Chris Datfung)
Date: Wed, 11 Nov 2009 20:49:47 +0200
Subject: [Owasp-modsecurity-core-rule-set] "document.gif" got denied
	after update ModSecurity to 2.5.10 with Core Rules v2
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AEA@MONET.utopiasystems.net>
References: <COL122-W45D670C92FD136B890B78CF2AA0@phx.gbl>
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AEA@MONET.utopiasystems.net>
Message-ID: <4c9cc6790911111049x5973aa88x8ef4dcc0f9dec4f9@mail.gmail.com>

2009/11/11 Ryan Barnett <Ryan.Barnett at breach.com>

>  Check in the modsec_audit.log file to see what the Message details are in
> section H.
>

Is there any easy way to see section H data if your using concurrent
logging?

- Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091111/45771447/attachment.html 

From chris.datfung at gmail.com  Wed Nov 11 13:52:22 2009
From: chris.datfung at gmail.com (Chris Datfung)
Date: Wed, 11 Nov 2009 20:52:22 +0200
Subject: [Owasp-modsecurity-core-rule-set] "document.gif" got denied
	after update ModSecurity to 2.5.10 with Core Rules v2
In-Reply-To: <4c9cc6790911111049x5973aa88x8ef4dcc0f9dec4f9@mail.gmail.com>
References: <COL122-W45D670C92FD136B890B78CF2AA0@phx.gbl>
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AEA@MONET.utopiasystems.net>
	<4c9cc6790911111049x5973aa88x8ef4dcc0f9dec4f9@mail.gmail.com>
Message-ID: <4c9cc6790911111052v2476793sedd754dcb1b13ae@mail.gmail.com>

On Wed, Nov 11, 2009 at 8:49 PM, Chris Datfung <chris.datfung at gmail.com>wrote:

> 2009/11/11 Ryan Barnett <Ryan.Barnett at breach.com>
>
>  Check in the modsec_audit.log file to see what the Message details are in
>> section H.
>>
>
> Is there any easy way to see section H data if your using concurrent
> logging?
>

Concurrent logging and mlogc to be precise.

- Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091111/751dda4d/attachment.html 

From Brian.Rectanus at breach.com  Wed Nov 11 14:50:55 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Wed, 11 Nov 2009 11:50:55 -0800
Subject: [Owasp-modsecurity-core-rule-set] "document.gif" got
 denied	after update ModSecurity to 2.5.10 with Core Rules v2
In-Reply-To: <4c9cc6790911111052v2476793sedd754dcb1b13ae@mail.gmail.com>
References: <COL122-W45D670C92FD136B890B78CF2AA0@phx.gbl>	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AEA@MONET.utopiasystems.net>	<4c9cc6790911111049x5973aa88x8ef4dcc0f9dec4f9@mail.gmail.com>
	<4c9cc6790911111052v2476793sedd754dcb1b13ae@mail.gmail.com>
Message-ID: <4AFB159F.3010305@breach.com>

Chris Datfung wrote:
>
>
> On Wed, Nov 11, 2009 at 8:49 PM, Chris Datfung <chris.datfung at gmail.com
> <mailto:chris.datfung at gmail.com>> wrote:
>
>     2009/11/11 Ryan Barnett <Ryan.Barnett at breach.com
>     <mailto:Ryan.Barnett at breach.com>>
>
>         Check in the modsec_audit.log file to see what the Message
>         details are in section H.
>
>
>     Is there any easy way to see section H data if your using concurrent
>     logging?
>
>
> Concurrent logging and mlogc to be precise.

You are using the console and mlogc is deleting the audit logs?  Then 
you should be able to see this data in the console (can also 
export/download the raw audit log from there).

-B

-- 
Brian Rectanus
Breach Security

From ryan.barnett at breach.com  Wed Nov 11 15:33:41 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Wed, 11 Nov 2009 15:33:41 -0500
Subject: [Owasp-modsecurity-core-rule-set]
 =?iso-8859-1?q?Announcing_the_M?=
 =?iso-8859-1?q?odSecurity/Core_=09Rule_Set_Demo_Testing_Page?=
In-Reply-To: <d7491310911111037r3d94789xbbd817847d2249cf@mail.gmail.com>
References: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AEB@MONET.utopiasystems.net>
	<d7491310911111037r3d94789xbbd817847d2249cf@mail.gmail.com>
Message-ID: <200911111533.41724.ryan.barnett@breach.com>

On Wednesday 11 November 2009 01:37:42 pm Andres Salazar wrote:
> Hello,
> 
> Out of curiosity this is the first time I hear Breach has some kind of
> relationship with another security party. How does Modsecurity and its
> CRS complement with PHPIDS? Arent both an application layer firewall
> that acts as an IDS?
> 
ModSecurity and the Core Rule Set are open source projects and we welcome 
community collaboration.  I have been a big fan of the PHPIDS project as they 
were able to generate a very active user base that helped to test their 
security and make it better.  I respect their approach.  We have had many 
different conversations with the PHPIDS foiks to see what/how to collaborate.  
One level of collaboration/integration is that with the CRS v2, we are 
converting over the PHPIDS default_filters.xml signatures into ModSecurity.  
The main benefit you get with this approach is that you can then gain 
protections for non-php apps.  Keep in mind, however, that there is some 
advanced functionality within PHPIDS, such as the Converter and Centrifuge 
code, that we have not ported over yet.  The second level of collaboration is 
with the demo/smoketest pages.

Another conceptual idea is that ModSecurity and PHPIDS are *not* mutually 
exclusive.  There are many different WAF deployment modes (appliance and in the 
case of Mod - embedded in the web server layer).  PHPIDS, while it has 
security capabilities, isn't by definition a WAF, as it resides inside the 
application code.

Hope this helps,
Ryan

> --Andres
> 
> On Wed, Nov 11, 2009 at 11:40 AM, Ryan Barnett <Ryan.Barnett at breach.com> 
wrote:
> > Please excuse the cross-posting, but we have some very exciting news to
> > announce.  We have *finally* released our ModSecurity/Core Rule Set
> > demonstration testing page - http://www.modsecurity.org/demo/
> >
> > This page allows clients to send attack data to a ModSecurity/CRS
> > installation on the www.modsecurity.org site where it will be first
> > inspected by the CRS for attack payloads, it will then be proxied to the
> > outstanding PHPIDS smoketest demo page here - http://demo.php-ids.org/.
> >  The return traffic will then be inspected to see if any evasion issues
> > exist and the user will be presented with results of all rules matches.
> >
> > We are very excited about this demo page is it will cerntainly help to
> > facilitate more community involvement with security testing of our rules.
> >  Any errors, evasions, etc... can either be reported back here on the
> > OWASP CRS mail-list and/or to the JIRA bug tracker system -
> > https://www.modsecurity.org/tracker/browse/CORERULES
> >
> > Have fun :)
> >
> > -Breach Security Labs (Ryan Barnett and Brian Rectanus)
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 

From Ryan.Barnett at breach.com  Thu Nov 12 06:27:10 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Thu, 12 Nov 2009 06:27:10 -0500
Subject: [Owasp-modsecurity-core-rule-set] OWASP AppSec DC Conf
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EF9@MONET.utopiasystems.net>

If anyone is attending the OWASP AppSec DC conf today/tomorrow let me know.  I am giving a presentation today on the CRS and will be at the Breach booth as well.

Hope to see some of you!


Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com 
www.Breach.com 

From andy.p.smith at ba.com  Thu Nov 12 06:37:49 2009
From: andy.p.smith at ba.com (andy.p.smith at ba.com)
Date: Thu, 12 Nov 2009 11:37:49 +0000
Subject: [Owasp-modsecurity-core-rule-set] Documentation
Message-ID: <OF4C44C490.116D692C-ON8025766C.003E9AD8-8025766C.003FE36A@britishairways.com>

Hi All,

        I am a new to mod_security and have just started to test some of 
our external facing applications against the latest realease of 
mod_security and the latest OWASP CRS, (2.0.3). Whilst I am seeing a fair 
number of false positives, mainly againast Request_Body checking, which 
was to be expected, I'm struggling to ascertain what the best path forward 
is for each false positive, based on the rational that I don't know why 
each rule has been written the way it is. Does anybody know if there is 
any documentation, other than just the comments within the ruleset, which 
further describe the rational behind the regex and literal expressions 
tracked within each rule?

        An example of a rule that seems to be hit a large number of times 
is line 93 from "modsecurity_crs_41_phpids_filters.conf" 

SecRule 
REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/* 
"([^*:\s\w,.\/?+-]\s*)?(?<![a-z]\s)(?<![a-z\/_@>\|])(\s*return\s*)?(?:hash|name|href|navigateandfind|source|pathname|close|constructor|port|protocol|assign|replace|back|forward|document|ownerdocument|window|self|parent|frames|_?content|date|cookie|innerhtml|innertext|csstext+?|outerhtml|print|moveby|resizeto|createstylesheet|stylesheets)(?(1)[^\w%\"]|(?:\s*[^@\/\s\w%,.+\-]))" 
"phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects 
JavaScript object properties and 
methods',id:'phpids-17',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}"

        I am finding many url strings that are matching the literals 
within this rule and could really do with some documentation to justify 
any action that I think is appropriate to my Information 
Assurance/Security department.

Best regards Andy 

------------------------------------------------------------------------------------------------------------
Get the best from British Airways at ba.com
http://www.ba.com

--
This message is private and confidential and may also be legally privileged.  If you have received this message in error, please email it back to the sender and immediately permanently delete it from your computer system.  Please do not read, print, re-transmit, store or act in reliance on it or any attachments.

British Airways may monitor email traffic data and also the content of emails, where permitted by law, for the purposes of security and staff training and in order to prevent or detect unauthorised use of the British Airways email system.

Virus checking of emails (including attachments) is the responsibility of the recipient.

British Airways Plc is a public limited company registered in England and Wales.  Registered number: 1777777.  Registered office: Waterside, PO Box 365, Harmondsworth, West Drayton, Middlesex, England, UB7 0GB.

Additional terms and conditions are available on our website: www.ba.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091112/6e02a6f9/attachment.html 

From Ryan.Barnett at breach.com  Thu Nov 12 07:12:44 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Thu, 12 Nov 2009 07:12:44 -0500
Subject: [Owasp-modsecurity-core-rule-set] Documentation
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EFB@MONET.utopiasystems.net>

Andy-
With the current CRS one of our goals was to make it easier for users to handle false positive changes *externally* from the rules themselves. Most users did want to edit rules directly for fear of munging a regex or if they did heavy customizations then they wouldn't want to upgrade ;)

The way we addressed this was to have the rules set TX variables that hold metadata about the match. With this approach, you can create exceptions in the 48 local exceptions file that can inspect TX data for the false positive match and then simply expire the variable and/or adjust the anomaly score.

To your direct question about the intent of this exact rule - this is an imported phpids rule which was developed from community testing with their demo page. If you want details about the regex logic - I suggest you pop it into something like Expresso and it will give info.


Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com
www.Breach.com

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Sent: Thu Nov 12 06:37:49 2009
Subject: [Owasp-modsecurity-core-rule-set] Documentation

Hi All,

        I am a new to mod_security and have just started to test some of our external facing applications against the latest realease of mod_security and the latest OWASP CRS, (2.0.3). Whilst I am seeing a fair number of false positives, mainly againast Request_Body checking, which was to be expected, I'm struggling to ascertain what the best path forward is for each false positive, based on the rational that I don't know why each rule has been written the way it is. Does anybody know if there is any documentation, other than just the comments within the ruleset, which further describe the rational behind the regex and literal expressions tracked within each rule?

        An example of a rule that seems to be hit a large number of times is line 93 from "modsecurity_crs_41_phpids_filters.conf"

SecRule REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/* "([^*:\s\w,.\/?+-]\s*)?(?<![a-z]\s)(?<![a-z\/_@>\|])(\s*return\s*)?(?:hash|name|href|navigateandfind|source|pathname|close|constructor|port|protocol|assign|replace|back|forward|document|ownerdocument|window|self|parent|frames|_?content|date|cookie|innerhtml|innertext|csstext+?|outerhtml|print|moveby|resizeto|createstylesheet|stylesheets)(?(1)[^\w%\"]|(?:\s*[^@\/\s\w%,.+\-]))" "phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects JavaScript object properties and methods',id:'phpids-17',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}"

        I am finding many url strings that are matching the literals within this rule and could really do with some documentation to justify any action that I think is appropriate to my Information Assurance/Security department.

Best regards Andy

------------------------------------------------------------------------------------------------------------
Get the best from British Airways at ba.com
http://www.ba.com

--
This message is private and confidential and may also be legally privileged.  If you have received this message in error, please email it back to the sender and immediately permanently delete it from your computer system.  Please do not read, print, re-transmit, store or act in reliance on it or any attachments.

British Airways may monitor email traffic data and also the content of emails, where permitted by law, for the purposes of security and staff training and in order to prevent or detect unauthorised use of the British Airways email system.

Virus checking of emails (including attachments) is the responsibility of the recipient.

British Airways Plc is a public limited company registered in England and Wales.  Registered number: 1777777.  Registered office: Waterside, PO Box 365, Harmondsworth, West Drayton, Middlesex, England, UB7 0GB.

Additional terms and conditions are available on our website: www.ba.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091112/cbeaafc7/attachment-0001.html 

From andy.p.smith at ba.com  Thu Nov 12 08:11:05 2009
From: andy.p.smith at ba.com (andy.p.smith at ba.com)
Date: Thu, 12 Nov 2009 13:11:05 +0000
Subject: [Owasp-modsecurity-core-rule-set] Documentation
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EFB@MONET.utopiasystems.net>
Message-ID: <OF6D685C22.81ADF7F3-ON8025766C.0043F17B-8025766C.00486D5B@britishairways.com>

Ryan,

        Thanks for your response. What I was trying to get at and maybe 
didn't explain myself very well, is that I'm trying to decide whether or 
not I should simply write an exception, or whether or not the 
false/positive requires an application code review. Without the 
rational/documentation behind the rule that's an extremely difficult call 
to make. (I.E using the rule I below as an example which triggered on the 
word "back" within the Request_Body.) Or am I simply missing the point and 
the standard procedure should simply be to write an exception for each 
false/positive?

Best regards Andy



Ryan Barnett <Ryan.Barnett at breach.com> 
12/11/2009 12:14

To
"andy.p.smith at ba.com" <andy.p.smith at ba.com>
"owasp-modsecurity-core-rule-set at lists.owasp.org" 
<owasp-modsecurity-core-rule-set at lists.owasp.org>
cc

Subject
Re: [Owasp-modsecurity-core-rule-set] Documentation






Andy-
With the current CRS one of our goals was to make it easier for users to 
handle false positive changes *externally* from the rules themselves. Most 
users did want to edit rules directly for fear of munging a regex or if 
they did heavy customizations then they wouldn't want to upgrade ;)

The way we addressed this was to have the rules set TX variables that hold 
metadata about the match. With this approach, you can create exceptions in 
the 48 local exceptions file that can inspect TX data for the false 
positive match and then simply expire the variable and/or adjust the 
anomaly score.

To your direct question about the intent of this exact rule - this is an 
imported phpids rule which was developed from community testing with their 
demo page. If you want details about the regex logic - I suggest you pop 
it into something like Expresso and it will give info.


Ryan C. Barnett 
Director of Application Security Research 
Breach Security, Inc. 
Ryan.Barnett at Breach.com 
www.Breach.com 
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org 
To: owasp-modsecurity-core-rule-set at lists.owasp.org 
Sent: Thu Nov 12 06:37:49 2009
Subject: [Owasp-modsecurity-core-rule-set] Documentation 

Hi All, 

        I am a new to mod_security and have just started to test some of 
our external facing applications against the latest realease of 
mod_security and the latest OWASP CRS, (2.0.3). Whilst I am seeing a fair 
number of false positives, mainly againast Request_Body checking, which 
was to be expected, I'm struggling to ascertain what the best path forward 
is for each false positive, based on the rational that I don't know why 
each rule has been written the way it is. Does anybody know if there is 
any documentation, other than just the comments within the ruleset, which 
further describe the rational behind the regex and literal expressions 
tracked within each rule? 

        An example of a rule that seems to be hit a large number of times 
is line 93 from "modsecurity_crs_41_phpids_filters.conf" 

SecRule 
REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/* 
"([^*:\s\w,.\/?+-]\s*)?(?<![a-z]\s)(?<![a-z\/_@>\|])(\s*return\s*)?(?:hash|name|href|navigateandfind|source|pathname|close|constructor|port|protocol|assign|replace|back|forward|document|ownerdocument|window|self|parent|frames|_?content|date|cookie|innerhtml|innertext|csstext+?|outerhtml|print|moveby|resizeto|createstylesheet|stylesheets)(?(1)[^\w%\"]|(?:\s*[^@\/\s\w%,.+\-]))" 
"phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects 
JavaScript object properties and 
methods',id:'phpids-17',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}" 


        I am finding many url strings that are matching the literals 
within this rule and could really do with some documentation to justify 
any action that I think is appropriate to my Information 
Assurance/Security department. 

Best regards Andy 

------------------------------------------------------------------------------------------------------------
Get the best from British Airways at ba.com
http://www.ba.com
--
This message is private and confidential and may also be legally 
privileged.  If you have received this message in error, please email it 
back to the sender and immediately permanently delete it from your 
computer system.  Please do not read, print, re-transmit, store or act in 
reliance on it or any attachments.

British Airways may monitor email traffic data and also the content of 
emails, where permitted by law, for the purposes of security and staff 
training and in order to prevent or detect unauthorised use of the British 
Airways email system.

Virus checking of emails (including attachments) is the responsibility of 
the recipient.

British Airways Plc is a public limited company registered in England and 
Wales.  Registered number: 1777777.  Registered office: Waterside, PO Box 
365, Harmondsworth, West Drayton, Middlesex, England, UB7 0GB.

Additional terms and conditions are available on our website: www.ba.com



------------------------------------------------------------------------------------------------------------
Get the best from British Airways at ba.com
http://www.ba.com

--
This message is private and confidential and may also be legally privileged.  If you have received this message in error, please email it back to the sender and immediately permanently delete it from your computer system.  Please do not read, print, re-transmit, store or act in reliance on it or any attachments.

British Airways may monitor email traffic data and also the content of emails, where permitted by law, for the purposes of security and staff training and in order to prevent or detect unauthorised use of the British Airways email system.

Virus checking of emails (including attachments) is the responsibility of the recipient.

British Airways Plc is a public limited company registered in England and Wales.  Registered number: 1777777.  Registered office: Waterside, PO Box 365, Harmondsworth, West Drayton, Middlesex, England, UB7 0GB.

Additional terms and conditions are available on our website: www.ba.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091112/7f6be616/attachment.html 

From Ryan.Barnett at breach.com  Thu Nov 12 08:36:09 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Thu, 12 Nov 2009 08:36:09 -0500
Subject: [Owasp-modsecurity-core-rule-set] Documentation
In-Reply-To: <OF6D685C22.81ADF7F3-ON8025766C.0043F17B-8025766C.00486D5B@britishairways.com>
References: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EFB@MONET.utopiasystems.net>,
	<OF6D685C22.81ADF7F3-ON8025766C.0043F17B-8025766C.00486D5B@britishairways.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AED@MONET.utopiasystems.net>

Ahh, gotcha.  Yeah, updating the CRS documentation on the OWASP project site is needed.  What would be great to do is to add in data for each rule similar to what Snort did with their rules DB.  Data such as the rationale for the rules, the logic and any false positive/negative concerns would all be great.  Another good piece of data would be some example log data of a true positive match for each rule.  One of the main reasons why we move the CRS to OWASP is so that we can get the community to help update the project data - so, if anyone wants to tackle this challenge and dive into wiki updates please let me know :)

In reference to phpids rules - check out the XssDB here - http://xssdb.dabbledb.com/publish/attackdb.  This has example attack payloads for each category of rule.  It is a great resource for testing rules.

Cheers,
Ryan
________________________________
From: andy.p.smith at ba.com [andy.p.smith at ba.com]
Sent: Thursday, November 12, 2009 8:11 AM
To: Ryan Barnett
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Documentation


Ryan,

        Thanks for your response. What I was trying to get at and maybe didn't explain myself very well, is that I'm trying to decide whether or not I should simply write an exception, or whether or not the false/positive requires an application code review. Without the rational/documentation behind the rule that's an extremely difficult call to make. (I.E using the rule I below as an example which triggered on the word "back" within the Request_Body.) Or am I simply missing the point and the standard procedure should simply be to write an exception for each false/positive?

Best regards Andy


Ryan Barnett <Ryan.Barnett at breach.com>

12/11/2009 12:14


To
        "andy.p.smith at ba.com" <andy.p.smith at ba.com>
"owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org>
cc

Subject
        Re: [Owasp-modsecurity-core-rule-set] Documentation







Andy-
With the current CRS one of our goals was to make it easier for users to handle false positive changes *externally* from the rules themselves. Most users did want to edit rules directly for fear of munging a regex or if they did heavy customizations then they wouldn't want to upgrade ;)

The way we addressed this was to have the rules set TX variables that hold metadata about the match. With this approach, you can create exceptions in the 48 local exceptions file that can inspect TX data for the false positive match and then simply expire the variable and/or adjust the anomaly score.

To your direct question about the intent of this exact rule - this is an imported phpids rule which was developed from community testing with their demo page. If you want details about the regex logic - I suggest you pop it into something like Expresso and it will give info.


Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com
www.Breach.com

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Sent: Thu Nov 12 06:37:49 2009
Subject: [Owasp-modsecurity-core-rule-set] Documentation

Hi All,

       I am a new to mod_security and have just started to test some of our external facing applications against the latest realease of mod_security and the latest OWASP CRS, (2.0.3). Whilst I am seeing a fair number of false positives, mainly againast Request_Body checking, which was to be expected, I'm struggling to ascertain what the best path forward is for each false positive, based on the rational that I don't know why each rule has been written the way it is. Does anybody know if there is any documentation, other than just the comments within the ruleset, which further describe the rational behind the regex and literal expressions tracked within each rule?

       An example of a rule that seems to be hit a large number of times is line 93 from "modsecurity_crs_41_phpids_filters.conf"

SecRule REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/* "([^*:\s\w,.\/?+-]\s*)?(?<![a-z]\s)(?<![a-z\/_@>\|])(\s*return\s*)?(?:hash|name|href|navigateandfind|source|pathname|close|constructor|port|protocol|assign|replace|back|forward|document|ownerdocument|window|self|parent|frames|_?content|date|cookie|innerhtml|innertext|csstext+?|outerhtml|print|moveby|resizeto|createstylesheet|stylesheets)(?(1)[^\w%\"]|(?:\s*[^@\/\s\w%,.+\-]))" "phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects JavaScript object properties and methods',id:'phpids-17',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}"

       I am finding many url strings that are matching the literals within this rule and could really do with some documentation to justify any action that I think is appropriate to my Information Assurance/Security department.

Best regards Andy

------------------------------------------------------------------------------------------------------------
Get the best from British Airways at ba.com
http://www.ba.com
--
This message is private and confidential and may also be legally privileged.  If you have received this message in error, please email it back to the sender and immediately permanently delete it from your computer system.  Please do not read, print, re-transmit, store or act in reliance on it or any attachments.

British Airways may monitor email traffic data and also the content of emails, where permitted by law, for the purposes of security and staff training and in order to prevent or detect unauthorised use of the British Airways email system.

Virus checking of emails (including attachments) is the responsibility of the recipient.

British Airways Plc is a public limited company registered in England and Wales.  Registered number: 1777777.  Registered office: Waterside, PO Box 365, Harmondsworth, West Drayton, Middlesex, England, UB7 0GB.

Additional terms and conditions are available on our website: www.ba.com



------------------------------------------------------------------------------------------------------------
Get the best from British Airways at ba.com
http://www.ba.com

--
This message is private and confidential and may also be legally privileged.  If you have received this message in error, please email it back to the sender and immediately permanently delete it from your computer system.  Please do not read, print, re-transmit, store or act in reliance on it or any attachments.

British Airways may monitor email traffic data and also the content of emails, where permitted by law, for the purposes of security and staff training and in order to prevent or detect unauthorised use of the British Airways email system.

Virus checking of emails (including attachments) is the responsibility of the recipient.

British Airways Plc is a public limited company registered in England and Wales.  Registered number: 1777777.  Registered office: Waterside, PO Box 365, Harmondsworth, West Drayton, Middlesex, England, UB7 0GB.

Additional terms and conditions are available on our website: www.ba.com

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091112/845bf048/attachment-0001.html 

From ryan.barnett at breach.com  Fri Nov 20 16:16:06 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 20 Nov 2009 16:16:06 -0500
Subject: [Owasp-modsecurity-core-rule-set] Virtual Patch for PHP Vuln
Message-ID: <200911201616.06716.ryan.barnett@breach.com>

For those of you running php and who were not aware, there is a new release 
out - http://www.php.net/releases/5_3_1.php

One of the fixes is a patch for a DoS condition as outlined here -
http://www.acunetix.com/blog/websecuritynews/php-multipartform-data-denial-of-
service/

Just wanted to pass along some virtual patch info in case you can't upgrade 
your systems quickly.  Since the DoS condition has to do with the way that PHP 
handles file uploads, you can create a modsecurity rule that mimics the new PHP 
max_file_uploads INI directive - 

SecRule &FILES "@gt 20" "phase:2,t:none,log,deny,msg:'Max number of file 
uploads exceeded',logdata:'Number of files: %{matched_var}'"

The CRS already has the modsecurity_crs_23_request_limits.conf file with some 
example File Upload limit rules commented out.  If everyone thinks this would 
be a valuable rule to include in the distro let me know, otherwise I suggest 
that PHP users who want to use this rule add to their own custom rules file.

Hope this helps.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com


From topdeposit at gmail.com  Wed Nov 25 03:31:05 2009
From: topdeposit at gmail.com (Superpizza)
Date: Wed, 25 Nov 2009 09:31:05 +0100
Subject: [Owasp-modsecurity-core-rule-set] False positive
In-Reply-To: <5fa90a5a0911240815s2f6c4dd3q34aba7aed243ed9@mail.gmail.com>
References: <5fa90a5a0911240815s2f6c4dd3q34aba7aed243ed9@mail.gmail.com>
Message-ID: <5fa90a5a0911250031r64831002he6366608d4e62b9c@mail.gmail.com>

Hi everyone.

 I'm a bit puzzled on how to handle a false positive
 for a couple of rules belonging to
 "Comment Evasion Attempt" ruleset.
 (in modsecurity_crs_41_phpids_converter.conf)

 I've got a form taking 2 parameters, say "LOGIN" & "PASSWORD".
 If password is set to "---aa---" rules are triggered,
 and this causes a false positive.
 If I well understood best practice should be modifying:
 modsecurity_crs_48_local_exceptions.conf
 I can't understand how to update this file in order
 to avoid matching  parameter "PASSWORD" against
 both of the rules.

 --7a02be68-C--
 LOGIN=12345678&PASSWD=---aa---
 --7a02be68-F--
 HTTP/1.1 403 Forbidden
 Last-Modified: Thu, 13 Nov 2008 09:30:44 GMT

 --7a02be68-H--
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at ARGS:PASSWD. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
 _converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at ARGS:PASSWD. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
 _converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_60
 _correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score
  60): Comment Evasion Attempt"]
 Action: Intercepted (phase 2)


 Thanks for your help.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091125/785492b4/attachment.html 

From chris.datfung at gmail.com  Sun Nov 29 10:41:56 2009
From: chris.datfung at gmail.com (Chris Datfung)
Date: Sun, 29 Nov 2009 17:41:56 +0200
Subject: [Owasp-modsecurity-core-rule-set] rule bypass question
Message-ID: <4c9cc6790911290741m19dc155bk2e23e2e2d6a2cbf6@mail.gmail.com>

I have the following in section H of an event that was a false positive:

Message: Operator GT matched 1 at TX:arg_name_menu. [file
"/opt/modsecurity/etc/crs/base_rules/modsecurity_crs_40_generic_attacks.conf"]
[line "28"] [msg "Possible HTTP Parameter Pollution Attack: Multiple
Parameters with the same Name."]
Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
"/opt/modsecurity/etc/crs/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 20): Possible HTTP
Parameter Pollution Attack: Multiple Parameters with the same Name."]
Action: Intercepted (phase 2)
Apache-Handler: proxy-server
Stopwatch: 1259298234088338 14916 (181 11756 -)
Producer: ModSecurity for Apache/2.5.11 (http://www.modsecurity.org/); core
ruleset/2.0.3.
Server: Apache/2.2.14 (Unix) mod_ssl/2.2.14 OpenSSL/0.9.8l

The rule at line 28 in modsecurity_crs_40_generic_attacks.conf does not have
a rule ID. The false positive appears in multiple parameters in the
/VulnScript.php script, so ideally, I'd like to add a SecRuleRemoveById
rule, which does not look like a possible in this case. I read the examples
in modsecurity_crs_48_local_exceptions.conf, but am still unclear how to
bypass this rule. Can someone point me in the right direction?

Thanks
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091129/d664dd79/attachment.html 

From Ryan.Barnett at breach.com  Mon Nov 30 12:24:15 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Mon, 30 Nov 2009 12:24:15 -0500
Subject: [Owasp-modsecurity-core-rule-set] rule bypass question
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298F2B@MONET.utopiasystems.net>

Sorry for the delay. I am updating a few crs items (one of which will help with exceptions). I will respond with an exception example later today.

Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com
www.Breach.com

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Sent: Sun Nov 29 10:41:56 2009
Subject: [Owasp-modsecurity-core-rule-set] rule bypass question

I have the following in section H of an event that was a false positive:

Message: Operator GT matched 1 at TX:arg_name_menu. [file "/opt/modsecurity/etc/crs/base_rules/modsecurity_crs_40_generic_attacks.conf"] [line "28"] [msg "Possible HTTP Parameter Pollution Attack: Multiple Parameters with the same Name."]
Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file "/opt/modsecurity/etc/crs/base_rules/modsecurity_crs_60_correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score 20): Possible HTTP Parameter Pollution Attack: Multiple Parameters with the same Name."]
Action: Intercepted (phase 2)
Apache-Handler: proxy-server
Stopwatch: 1259298234088338 14916 (181 11756 -)
Producer: ModSecurity for Apache/2.5.11 (http://www.modsecurity.org/); core ruleset/2.0.3.<http://2.0.3.>
Server: Apache/2.2.14 (Unix) mod_ssl/2.2.14 OpenSSL/0.9.8l

The rule at line 28 in modsecurity_crs_40_generic_attacks.conf does not have a rule ID. The false positive appears in multiple parameters in the /VulnScript.php script, so ideally, I'd like to add a SecRuleRemoveById rule, which does not look like a possible in this case. I read the examples in modsecurity_crs_48_local_exceptions.conf, but am still unclear how to bypass this rule. Can someone point me in the right direction?

Thanks
Chris

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091130/81e64104/attachment.html 

From Ryan.Barnett at breach.com  Mon Nov 30 12:26:55 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Mon, 30 Nov 2009 12:26:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] False positive
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298F2C@MONET.utopiasystems.net>

Sorry for the delay (holidays...) But I will respond with an exception example later today.

Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com
www.Breach.com

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Sent: Wed Nov 25 03:31:05 2009
Subject: [Owasp-modsecurity-core-rule-set] False positive

Hi everyone.

 I'm a bit puzzled on how to handle a false positive
 for a couple of rules belonging to
 "Comment Evasion Attempt" ruleset.
 (in modsecurity_crs_41_phpids_converter.conf)

 I've got a form taking 2 parameters, say "LOGIN" & "PASSWORD".
 If password is set to "---aa---" rules are triggered,
 and this causes a false positive.
 If I well understood best practice should be modifying:
 modsecurity_crs_48_local_exceptions.conf
 I can't understand how to update this file in order
 to avoid matching  parameter "PASSWORD" against
 both of the rules.

 --7a02be68-C--
 LOGIN=12345678&PASSWD=---aa---
 --7a02be68-F--
 HTTP/1.1 403 Forbidden
 Last-Modified: Thu, 13 Nov 2008 09:30:44 GMT

 --7a02be68-H--
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at ARGS:PASSWD. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
 _converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
 s_converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Pattern match "(?:--[^-]*-)" at ARGS:PASSWD. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
 _converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
 [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
 Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
 "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_60
 _correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score
  60): Comment Evasion Attempt"]
 Action: Intercepted (phase 2)


 Thanks for your help.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091130/d8ba1421/attachment.html 

From ryan.barnett at breach.com  Mon Nov 30 16:12:45 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 30 Nov 2009 16:12:45 -0500
Subject: [Owasp-modsecurity-core-rule-set] CRS version 2.0.4 Released
Message-ID: <200911301612.45747.ryan.barnett@breach.com>

http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project#tab=Download

--------------------------
Version 2.0.4 - 11/30/2009
--------------------------

Improvements:
- Updated converted PHPIDS signatures (https://svn.php-
ids.org/svn/trunk/lib/IDS/default_filter.xml)
- Updated PHPIDS rules logic to first search for payloads in ARGS and then if 
there is no match found   then search more generically in request_body|
request_uri_raw
- Updated PHPIDS rules logic to only set TX variables and to not log.  This 
allows for more clean exceptions in the 48 file which can then expire/delete 
false positive TX matches and adjust the anomaly scores.  These rules will 
then inspect for any TX variables in phase:5 and create appropriate alerts for 
any variable matches that exist.

Bug Fixes:
- Added Anomaly Score check to the 60 correlation file to recheck the anomaly 
score at the end of phase:4 which would allow for blocking based on 
information leakage issues.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com


From rcbarnett at gmail.com  Mon Nov 30 16:19:17 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Mon, 30 Nov 2009 16:19:17 -0500
Subject: [Owasp-modsecurity-core-rule-set] False positive
In-Reply-To: <5fa90a5a0911250031r64831002he6366608d4e62b9c@mail.gmail.com>
References: <5fa90a5a0911240815s2f6c4dd3q34aba7aed243ed9@mail.gmail.com>
	<5fa90a5a0911250031r64831002he6366608d4e62b9c@mail.gmail.com>
Message-ID: <200911301619.18070.rcbarnett@gmail.com>

Per my other email that I just sent out, download CRS v2.0.4 and then add the 
following exception rule to your 48 local exceptions file.

SecRule TX:/^PHPIDS-CONVERTER-COMMENT-EVASION.*ARGS:PASSWD/ "." 
"chain,phase:2,t:none,nolog,pass,setvar:tx.phpids-comment-evasion-
counter=+1,setvar:tx.phpids-comment-evasion-%{tx.phpids-comment-evasion-
counter}=%{matched_var_name}"
        SecRule TX:'/^PHPIDS-COMMENT-EVASION/' "^TX:(phpids-.*ARGS:PASSWD)$" 
"capture,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-20"


Basically, the new CRS rules are setting TX variables that hold the important 
meta-data about rule matches (rather then simply directly logging them to the 
error/audit log files).  The exception above will look to see if there are any 
matches for the PHPIDS Comment Evasion rules in the parameter called "PASSWD".  
If so, it will capture each TX variable data and then expire them in the 2nd 
part of the rule.  It will then correct the anomaly score.  

Let me know if you need any more help.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com

On Wednesday 25 November 2009 03:31:05 am Superpizza wrote:
> Hi everyone.
> 
>  I'm a bit puzzled on how to handle a false positive
>  for a couple of rules belonging to
>  "Comment Evasion Attempt" ruleset.
>  (in modsecurity_crs_41_phpids_converter.conf)
> 
>  I've got a form taking 2 parameters, say "LOGIN" & "PASSWORD".
>  If password is set to "---aa---" rules are triggered,
>  and this causes a false positive.
>  If I well understood best practice should be modifying:
>  modsecurity_crs_48_local_exceptions.conf
>  I can't understand how to update this file in order
>  to avoid matching  parameter "PASSWORD" against
>  both of the rules.
> 
>  --7a02be68-C--
>  LOGIN=12345678&PASSWD=---aa---
>  --7a02be68-F--
>  HTTP/1.1 403 Forbidden
>  Last-Modified: Thu, 13 Nov 2008 09:30:44 GMT
> 
>  --7a02be68-H--
>  Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
>  s_converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data
>  "---"] [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
>  Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
>  s_converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data
>  "---"] [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
>  Message: Pattern match "(?:--[^-]*-)" at ARGS:PASSWD. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
>  _converter.conf"] [line "28"] [msg "Comment Evasion Attempt"] [data "---"]
>  [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
>  Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
>  s_converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data
>  "---"] [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
>  Message: Pattern match "(?:--[^-]*-)" at REQUEST_BODY. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
>  s_converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data
>  "---"] [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
>  Message: Pattern match "(?:--[^-]*-)" at ARGS:PASSWD. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
>  _converter.conf"] [line "34"] [msg "Comment Evasion Attempt"] [data "---"]
>  [severity "WARNING"] [tag "WEB_ATTACK/EVASION"]
>  Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
>  "/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_60
>  _correlation.conf"] [line "41"] [msg "Transactional Anomaly Score (score
>   60): Comment Evasion Attempt"]
>  Action: Intercepted (phase 2)
> 
> 
>  Thanks for your help.
> 

From ryan.barnett at breach.com  Mon Nov 30 16:32:26 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Mon, 30 Nov 2009 16:32:26 -0500
Subject: [Owasp-modsecurity-core-rule-set] rule bypass question
In-Reply-To: <4c9cc6790911290741m19dc155bk2e23e2e2d6a2cbf6@mail.gmail.com>
References: <4c9cc6790911290741m19dc155bk2e23e2e2d6a2cbf6@mail.gmail.com>
Message-ID: <200911301632.26846.ryan.barnett@breach.com>

On Sunday 29 November 2009 10:41:56 am Chris Datfung wrote:
> I have the following in section H of an event that was a false positive:
> 
> Message: Operator GT matched 1 at TX:arg_name_menu. [file
>  "/opt/modsecurity/etc/crs/base_rules/modsecurity_crs_40_generic_attacks.co
> nf"] [line "28"] [msg "Possible HTTP Parameter Pollution Attack: Multiple
>  Parameters with the same Name."] Message: Warning. Operator GE matched 5
>  at TX:anomaly_score. [file
>  "/opt/modsecurity/etc/crs/base_rules/modsecurity_crs_60_correlation.conf"]
>  [line "41"] [msg "Transactional Anomaly Score (score 20): Possible HTTP
>  Parameter Pollution Attack: Multiple Parameters with the same Name."]
>  Action: Intercepted (phase 2)
> Apache-Handler: proxy-server
> Stopwatch: 1259298234088338 14916 (181 11756 -)
> Producer: ModSecurity for Apache/2.5.11 (http://www.modsecurity.org/); core
>  ruleset/2.0.3.<http://2.0.3.> Server: Apache/2.2.14 (Unix) mod_ssl/2.2.14
>  OpenSSL/0.9.8l
> 
> The rule at line 28 in modsecurity_crs_40_generic_attacks.conf does not
>  have a rule ID. The false positive appears in multiple parameters in the
>  /VulnScript.php script, so ideally, I'd like to add a SecRuleRemoveById
>  rule, which does not look like a possible in this case. I read the
>  examples in modsecurity_crs_48_local_exceptions.conf, but am still unclear
>  how to bypass this rule. Can someone point me in the right direction?
> 
Hey Chris,
Please see my other email that I just sent to the list about the new CRS 
v2.0.4 as the HTTP Parameter Pollution rule now has a rule id.  With this 
info, you can now add the following example exception rule to the 48 local 
exceptions conf file -

SecRule REQUEST_FILENAME "@streq /VulnScript.php" 
"chain,phase:2,t:none,nolog,pass"
SecRule TX:/^HPP-1.*ARGS:(foo|bar)/ "." "chain,setvar:tx.hpp-
counter=+1,setvar:tx.hpp-%{tx.hpp-counter}=%{matched_var_name}"
        SecRule TX:'/^HPP-/' "^TX:(hpp.*ARGS:(foo|bar))$" "capture,setvar:!tx.
%{tx.1},setvar:tx.anomaly_score=-20"

This exception will first check the URL and then it will check to see if there 
are any TX matches for http parameter pollution for either the foo or bar 
parameters (adjust these accordingly for your page where the false positives 
are occurring).  If matches are found, then it will both expire the TX 
variables and adjust the anomaly score.

Let me know if you need any more help.

-Ryan

From s.bhatia at qut.edu.au  Mon Nov 30 19:24:18 2009
From: s.bhatia at qut.edu.au (SAJAL BHATIA)
Date: Tue, 1 Dec 2009 10:24:18 +1000
Subject: [Owasp-modsecurity-core-rule-set] Regarding the updates for Core
	rule set
Message-ID: <EF5541F04426FD40ACD8600636961B470CBF5569D5@QUTEXMBX02.qut.edu.au>

HI, 

I am very new to Mod Security hence have a question regarding the update of its Core Rule Set. I am aware that Mod Security comes with a rules-updates.pl script to automatically update its rule set from Breach Security Website. I am inquisitive to ask if its possible to dynamically update its rule set by our own customized rule set file? If yes than you please elaborate a bit on this ?

Awaiting for your reply.

Thanks and Regards


----
Sajal Bhatia
Research Masters Student
QUT, Brisbane
AUSTRALIA

From s.bhatia at qut.edu.au  Mon Nov 30 19:26:09 2009
From: s.bhatia at qut.edu.au (SAJAL BHATIA)
Date: Tue, 1 Dec 2009 10:26:09 +1000
Subject: [Owasp-modsecurity-core-rule-set] One more query regarding the core
	rule set
Message-ID: <EF5541F04426FD40ACD8600636961B470CBF5569D6@QUTEXMBX02.qut.edu.au>

Hi, 

I have one more query regarding the core rule set of Mod Security. I am keen to know how does Mod Security applies the rule set. Is there any functional diagram available which can aid in understanding this concept. I also want to know as to how does it process each payload ?

Awaiting for your reply. 

Thanks and Regards

----
Sajal Bhatia
Research Masters Student
QUT, Brisbane
AUSTRALIA

