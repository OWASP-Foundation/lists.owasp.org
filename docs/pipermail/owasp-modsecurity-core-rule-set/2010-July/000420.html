<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Bug in CRS 2.0.7	modsecurity_crs_41_phpids_filters.conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Bug%20in%20CRS%202.0.7%0A%09modsecurity_crs_41_phpids_filters.conf&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000412.html">
   <LINK REL="Next"  HREF="000421.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Bug in CRS 2.0.7	modsecurity_crs_41_phpids_filters.conf</H1>
    <B>Josh Gee</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Bug%20in%20CRS%202.0.7%0A%09modsecurity_crs_41_phpids_filters.conf&In-Reply-To="
       TITLE="[Owasp-modsecurity-core-rule-set] Bug in CRS 2.0.7	modsecurity_crs_41_phpids_filters.conf">securityadmin at hcjb.org
       </A><BR>
    <I>Tue Jul 20 06:48:06 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000412.html">[Owasp-modsecurity-core-rule-set] (2.0.7) syntax problem in	..._41_phpids_filters.conf
</A></li>
        <LI>Next message: <A HREF="000421.html">[Owasp-modsecurity-core-rule-set] Bug in CRS 2.0.7	modsecurity_crs_41_phpids_filters.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#420">[ date ]</a>
              <a href="thread.html#420">[ thread ]</a>
              <a href="subject.html#420">[ subject ]</a>
              <a href="author.html#420">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As referenced earlier (June 20 by modsec at enosis.com), there is a
setvar error in version 1516 of this file. 

However, the proposed fix does NOT correct the error.  The proposed fix
makes every PHPIDS rule a critical anomaly rule, which does not appear
to be the intent of the PHPIDS rules.  This will cause a lot of false
positives if you are using the correlation rules.

In addition, version 1516 changes the disruptive action of each of these
rules from pass to block.  This interferes with correlation level
behavior. (at least as far as I understand it, please feel free to
correct me if I've got this wrong)

Version 1525 attempts to resolve these issues, but I believe it misses
the true problem with the 1516 version and appears to add a different
version of the same problem.

Version 1525 changed:
setvar:%{tx.critical_anomaly_score}
to:
setvar:tx.%{tx.critical_anomaly_score}

Which appears to throw very similar errors. Looking at previous versions
of this file, it appears to me that the change should be:
setvar:tx.anomaly_score=+n
where n is equal to a weight applied to each PHPIDS rule.

Version 1503 of this file contained the the relative weight of each
PHPIDS rule. Attached is a modified
modsecurity_crs_41_phpids_filters.conf file.  I took the scoring levels
and pass/block action of version 1503 of this file and the actual rules
from the 1516 version. 

This version of the file appears to resolve the false-positives caused
by the recommended changes in the June 20 post, and &quot;plays nice&quot; with
the correlation rules by not forcing every rule to block or exceed the
anomaly score (unless that's the intention of the rule).

I'm open to suggestions and feedback, but I think I've got this issue
resolved, at least until there's an update to the PHPIDS rules.  There
is probably still some work to do on the scripts that convert the PHPIDS
rules into ModSecurity Rules.

-- 
Joshua Gee




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100720/394d06b9/attachment-0001.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100720/394d06b9/attachment-0001.html</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: modsecurity_crs_41_phpids_filters.conf.modified
Url: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100720/394d06b9/attachment-0001.pl">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100720/394d06b9/attachment-0001.pl</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000412.html">[Owasp-modsecurity-core-rule-set] (2.0.7) syntax problem in	..._41_phpids_filters.conf
</A></li>
	<LI>Next message: <A HREF="000421.html">[Owasp-modsecurity-core-rule-set] Bug in CRS 2.0.7	modsecurity_crs_41_phpids_filters.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#420">[ date ]</a>
              <a href="thread.html#420">[ thread ]</a>
              <a href="subject.html#420">[ subject ]</a>
              <a href="author.html#420">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
