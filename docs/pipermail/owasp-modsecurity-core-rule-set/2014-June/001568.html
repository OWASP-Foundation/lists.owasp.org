<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Why are some newer rules formatted differently in crs_41_sqli?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Why%20are%20some%20newer%20rules%0A%20formatted%20differently%20in%20crs_41_sqli%3F&In-Reply-To=%3CCFB6317F.F9359%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001567.html">
   <LINK REL="Next"  HREF="001569.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Why are some newer rules formatted differently in crs_41_sqli?</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Why%20are%20some%20newer%20rules%0A%20formatted%20differently%20in%20crs_41_sqli%3F&In-Reply-To=%3CCFB6317F.F9359%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Why are some newer rules formatted differently in crs_41_sqli?">RBarnett at trustwave.com
       </A><BR>
    <I>Thu Jun  5 18:39:38 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001567.html">[Owasp-modsecurity-core-rule-set] Why are some newer rules	formatted differently in crs_41_sqli?
</A></li>
        <LI>Next message: <A HREF="001569.html">[Owasp-modsecurity-core-rule-set]	modsecurity_slr_50_malware_detection.conf&quot;] [line &quot;25&quot;] [id	&quot;2200001&quot;]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1568">[ date ]</a>
              <a href="thread.html#1568">[ thread ]</a>
              <a href="subject.html#1568">[ subject ]</a>
              <a href="author.html#1568">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That is a bug and is why this is labeled as a &quot;dev&quot; branch :)  I fixed it and just pushed an update to GitHub is you want to pull it down.

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;

From: Riemann Riemann &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">riemann913 at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">riemann913 at gmail.com</A>&gt;&gt;
Date: Thursday, June 5, 2014 1:01 PM
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: [Owasp-modsecurity-core-rule-set] Why are some newer rules formatted differently in crs_41_sqli?

Hello,

I'm updating CRS versions, and see just over 20 newer rules in CRS_41_sqli that name a tx variable (the one that's set equal to %{tx.0}) using a different format than any of the other rules in the CRS (e.g. rule id:981243). The value of %{tx.msg} is added to the variable name, instead of just %{rule.id&lt;<A HREF="http://rule.id">http://rule.id</A>&gt;}, which seems a bit unnecessary, and not quite as clean. This variable is usually used to check that a rule matched a particular parameter prior to adjusting  the anomaly score, so this creates some inconsistencies when writing score adjustments, since %{tx.msg} contains spaces.


The variable is typically named like this:

setvar:tx.%{rule.id&lt;<A HREF="http://rule.id">http://rule.id</A>&gt;}-OWASP_CRS/WEB_ATTACK/SQLI-%{matched_var_name}=%{tx.0}

And a typical score adjustment would look like this:

SecRule &amp;TX:981243-OWASP_CRS/WEB_ATTACK/SQLI-ARGS:foobar &quot;@ge 1&quot; &quot;setvar:tx.anomaly_score=-%{tx.critical_anomaly_score}&quot;



With this handful of newer rules, the variable is named like this:

setvar:tx.%{tx.msg}-OWASP_CRS/WEB_ATTACK/SQLI-%{matched_var_name}=%{tx.0}

The only way I could figure to write a score adjustment for these was with regex (note: the regex wouldn't work with metacharacters, like \s for a space), like this:

SecRule &amp;TX:'/981243-Detects.classic.SQL.injection.probings.2/2-OWASP_CRS/WEB_ATTACK/SQLI-ARGS:foobar/' &quot;@ge 1&quot; &quot;setvar:tx.anomaly_score=-%{tx.critical_
anomaly_score}&quot;


Is there any reason the format for this has changed, or is different for these rules? Is there a cleaner or more consistent way to write adjustments for these rules?

Thanks in advance,
Dusty

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140605/ffe9fc87/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140605/ffe9fc87/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001567.html">[Owasp-modsecurity-core-rule-set] Why are some newer rules	formatted differently in crs_41_sqli?
</A></li>
	<LI>Next message: <A HREF="001569.html">[Owasp-modsecurity-core-rule-set]	modsecurity_slr_50_malware_detection.conf&quot;] [line &quot;25&quot;] [id	&quot;2200001&quot;]
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1568">[ date ]</a>
              <a href="thread.html#1568">[ thread ]</a>
              <a href="subject.html#1568">[ subject ]</a>
              <a href="author.html#1568">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
