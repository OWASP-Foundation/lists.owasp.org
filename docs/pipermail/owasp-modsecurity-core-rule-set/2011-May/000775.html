<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Multiple URL Encoding Rule ID	950109
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Multiple%20URL%20Encoding%20Rule%20ID%0A%09950109&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000774.html">
   <LINK REL="Next"  HREF="000776.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Multiple URL Encoding Rule ID	950109</H1>
    <B>nicholas.ogura at usbank.com</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Multiple%20URL%20Encoding%20Rule%20ID%0A%09950109&In-Reply-To="
       TITLE="[Owasp-modsecurity-core-rule-set] Multiple URL Encoding Rule ID	950109">nicholas.ogura at usbank.com
       </A><BR>
    <I>Mon May 23 11:38:33 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000774.html">[Owasp-modsecurity-core-rule-set] Unicode Visual Spoofing for Good:	Confusable CAPTCHAs
</A></li>
        <LI>Next message: <A HREF="000776.html">[Owasp-modsecurity-core-rule-set] Announcing Release of OWASP	ModSecurity CRS v2.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#775">[ date ]</a>
              <a href="thread.html#775">[ thread ]</a>
              <a href="subject.html#775">[ subject ]</a>
              <a href="author.html#775">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello there.  I'm having some trouble with this rule in the 2.0.9 ruleset. 
 There does not seem to be any appreciable difference in the latest 
version, so I'm going to have to toss this out to the community.

I realize that this is part of a series of chained rules, but this is the 
one that's tripping me up:

SecRule ARGS &quot;\%((?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})&quot; \
 &quot;phase:2,rev:'2.0.9',t:none,pass,nolog,auditlog,status:400,msg:'Multiple 
URL Encoding 
Detected',id:'950109',tag:'PROTOCOL_VIOLATION/EVASION',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/EVASION-%{matched_var_name}=%{matched_var}&quot;

I've seen some threads where it's said that there is an implicit decode of 
the ARGS collection upon loading, but I can't find any evidence of it 
happening.

In this specific case, a username field gets appended with '@something' 
upon submit, and even though the login form contains virtually no other 
data, we get a positive.

It seems to me like this rule is finding urlencoded data in a POST body 
that was specifically set up to be urlencoded.  There's no t:urlDecode in 
the rule, so it's tripping on normal traffic.  I can't even say it's a 
'false positive' .

What am I missing?

Thanks in advance.


Nik Ogura
Application Systems Administrator
MSA Apache Group
US Bank, NA
U.S. BANCORP made the following annotations
---------------------------------------------------------------------
Electronic Privacy Notice. This e-mail, and any attachments, contains information that is, or may be, covered by electronic communications privacy laws, and is also confidential and proprietary in nature. If you are not the intended recipient, please be advised that you are legally prohibited from retaining, using, copying, distributing, or otherwise disclosing this information in any manner. Instead, please reply to the sender that you have received this communication in error, and then immediately delete it. Thank you in advance for your cooperation.



---------------------------------------------------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110523/23b610e3/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110523/23b610e3/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000774.html">[Owasp-modsecurity-core-rule-set] Unicode Visual Spoofing for Good:	Confusable CAPTCHAs
</A></li>
	<LI>Next message: <A HREF="000776.html">[Owasp-modsecurity-core-rule-set] Announcing Release of OWASP	ModSecurity CRS v2.2.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#775">[ date ]</a>
              <a href="thread.html#775">[ thread ]</a>
              <a href="subject.html#775">[ subject ]</a>
              <a href="author.html#775">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
