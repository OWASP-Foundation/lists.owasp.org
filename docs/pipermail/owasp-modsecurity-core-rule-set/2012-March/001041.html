<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] anomaly score not calculated ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20anomaly%20score%20not%20calculated%20%3F&In-Reply-To=%3CCB8CDBDD.46B18%25ryan.barnett%40owasp.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001040.html">
   <LINK REL="Next"  HREF="001042.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] anomaly score not calculated ?</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20anomaly%20score%20not%20calculated%20%3F&In-Reply-To=%3CCB8CDBDD.46B18%25ryan.barnett%40owasp.org%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] anomaly score not calculated ?">RBarnett at trustwave.com
       </A><BR>
    <I>Mon Mar 19 16:51:12 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001040.html">[Owasp-modsecurity-core-rule-set] anomaly score not calculated ?
</A></li>
        <LI>Next message: <A HREF="001042.html">[Owasp-modsecurity-core-rule-set] Website GSoC2012 Ideas - OWASP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1041">[ date ]</a>
              <a href="thread.html#1041">[ thread ]</a>
              <a href="subject.html#1041">[ subject ]</a>
              <a href="author.html#1041">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Mark,
You are correct about the severity.  It should NOT be listed as 2
&quot;CRITICAL&quot; - I will fix that.  It is at a NOTICE level.

As for Section K, it lists the rule lines that matched, however unlike the
actual Error or Audit log alert, macros are not expanded here.

-Ryan

On 3/19/12 9:33 AM, &quot;Mark Boos (IntCom)&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mark at intcom.nl</A>&gt; wrote:

&gt;<i>Hi Ryan,
</I>&gt;<i>
</I>&gt;<i>But in section H of that audit log is:
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> [id &quot;960017&quot;] [rev &quot;2.0.10&quot;] [msg &quot;Host header is a numeric IP
</I>&gt;&gt;&gt;<i>address&quot;]
</I>&gt;<i>[severity &quot;CRITICAL&quot;]
</I>&gt;<i>
</I>&gt;<i>I look for the word CRITICAL, so I thought that it would have score 5 so
</I>&gt;<i>it
</I>&gt;<i>would be above the max anomaly score.
</I>&gt;<i>
</I>&gt;<i>And in K isnt it strange that there are variables reported instead of
</I>&gt;<i>numbers ?:
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> msg:'Inbound Anomaly Score Exceeded (Total Score: %{TX.ANOMALY_SCORE},
</I>&gt;<i>SQLi=%{TX.SQL_INJECTION_SCORE}, XSS=%{TX.XSS_SCORE}): Last Matched
</I>&gt;<i>Message:
</I>&gt;<i>%{tx.msg}'
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Regards
</I>&gt;<i>Mark
</I>&gt;<i>
</I>&gt;&gt;<i> -----Oorspronkelijk bericht-----
</I>&gt;&gt;<i> Van: Ryan Barnett [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>]
</I>&gt;&gt;<i> Verzonden: maandag 19 maart 2012 14:15
</I>&gt;&gt;<i> Aan: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mark at intcom.nl</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> Onderwerp: Re: [Owasp-modsecurity-core-rule-set] anomaly score not
</I>&gt;&gt;<i> calculated ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mark,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I would suggest that you use the latest CRS version as there are other
</I>&gt;&gt;<i> bugs that we have fixed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Looking at the example audit log entry you provided, that message &quot;Host
</I>&gt;&gt;<i> header is a numeric IP address&quot; only results in a NOTICE level anomaly
</I>&gt;&gt;<i> score increase - setvar:tx.anomaly_score=+%{tx.notice_anomaly_score}
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the complete rule -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SecRule REQUEST_HEADERS:Host &quot;^[\d.:]+$&quot;
</I>&gt;&gt;<i> &quot;phase:2,rev:'2.0.10',t:none,block,msg:'Host header is a numeric IP
</I>&gt;&gt;<i> address',
</I>&gt;&gt;<i> severity:'2',id:'960017',tag:'PROTOCOL_VIOLATION/IP_HOST',tag:'WAS
</I>&gt;&gt;<i> CTC/WASC-
</I>&gt;&gt;<i> 21',tag:'OWASP_TOP_10/A7',tag:'PCI/6.5.10',tag:'<A HREF="http://technet.mic">http://technet.mic</A>
</I>&gt;&gt;<i> rosoft.co
</I>&gt;&gt;<i> m/en-us/magazine/2005.01.hackerbasher.aspx',setvar:'tx.msg=%{rule.
</I>&gt;&gt;<i> msg}',set
</I>&gt;&gt;<i> var:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.policy_
</I>&gt;&gt;<i> score=+%{
</I>&gt;&gt;<i> tx.notice_anomaly_score},setvar:tx.%{rule.id}-POLICY/IP_HOST-%{mat
</I>&gt;&gt;<i> ched_var_
</I>&gt;&gt;<i> name}=%{matched_var}'&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So, when this transaction gets to the 40 Inbound Blocking file this
</I>&gt;&gt;<i> ruleset is processed -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> # Alert and Block based on Anomaly Scores
</I>&gt;&gt;<i> #
</I>&gt;&gt;<i> SecRule TX:ANOMALY_SCORE &quot;@gt 0&quot; \
</I>&gt;&gt;<i>     &quot;chain,phase:2,t:none,deny,log,msg:'Inbound Anomaly Score Exceeded
</I>&gt;&gt;<i> (Total Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQL_INJECTION_SCORE},
</I>&gt;&gt;<i> XSS=%{TX.XSS_SCORE}): Last Matched Message: %{tx.msg}',logdata:'Last
</I>&gt;&gt;<i> Matched Data:
</I>&gt;&gt;<i> %{matched_var}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbou
</I>&gt;&gt;<i> nd_anomal
</I>&gt;&gt;<i> y_score=%{tx.anomaly_score}&quot;
</I>&gt;&gt;<i>   SecRule TX:ANOMALY_SCORE &quot;@ge %{tx.inbound_anomaly_score_level}&quot; chain
</I>&gt;&gt;<i>     SecRule TX:ANOMALY_SCORE_BLOCKING &quot;@streq on&quot; chain
</I>&gt;&gt;<i>       SecRule TX:/^\d/ &quot;(.*)&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Section K of your audit log shows that the first SecRule matches -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SecRule &quot;TX:ANOMALY_SCORE&quot; &quot;@gt 0&quot;
</I>&gt;&gt;<i> &quot;phase:2,chain,t:none,deny,log,msg:'Inbound Anomaly Score Exceeded
</I>&gt;&gt;<i>(Total
</I>&gt;&gt;<i> Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQL_INJECTION_SCORE},
</I>&gt;&gt;<i> XSS=%{TX.XSS_SCORE}): Last Matched Message: %{tx.msg}',logdata:'Last
</I>&gt;&gt;<i> Matched
</I>&gt;&gt;<i> Data:
</I>&gt;&gt;<i> %{matched_var}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbou
</I>&gt;&gt;<i> nd_anomal
</I>&gt;&gt;<i> y
</I>&gt;&gt;<i> _score=%{tx.anomaly_score}&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But, then it gets to the second SecRule that checks that the anomaly
</I>&gt;&gt;<i>score
</I>&gt;&gt;<i> if @ge your tx.inbound_anomaly_score_level, it doesn't match.  This is
</I>&gt;&gt;<i> because the only 1 rule with the NOTICE level matched.  The bottom line
</I>&gt;&gt;<i>is
</I>&gt;&gt;<i> that this transaction's anomaly score was below your blocking threshold.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hope this helps,
</I>&gt;&gt;<i> Ryan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 3/19/12 8:16 AM, &quot;Mark Boos (IntCom)&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mark at intcom.nl</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt;Hi,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;An introduction: I use ModSecurity for 5 weeks now, on a relatively
</I>&gt;&gt;<i>quiet
</I>&gt;&gt;<i> &gt;internet server. I am not a very experienced ModSecurity user, but the
</I>&gt;&gt;<i> &gt;traditional score installation worked just fine. I hope you forgive me
</I>&gt;&gt;<i>my
</I>&gt;&gt;<i> &gt;shortcomings in knowledge.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;I have a problem with the anomaly method: there are warnings and
</I>&gt;&gt;<i>critical
</I>&gt;&gt;<i> &gt;errors in the log files, but it seems no action is being taken after
</I>&gt;&gt;<i>the
</I>&gt;&gt;<i> &gt;maximum score (5) is exceeded.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Installation:
</I>&gt;&gt;<i> &gt;- Debian stable with apache 2.2.16
</I>&gt;&gt;<i> &gt;- libapache-mod-security 2.5.12-1
</I>&gt;&gt;<i> &gt;- crs_2.0.10 rule files (downloaded because the latest and greatest
</I>&gt;&gt;<i> &gt;crs_2.2.3 didnt work either)
</I>&gt;&gt;<i> &gt;*modsecurity_crs_20_protocol_violations.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_21_protocol_anomalies.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_23_request_limits.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_35_bad_robots.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_40_generic_attacks.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_45_trojans.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_49_inbound_blocking.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_59_outbound_blocking.conf
</I>&gt;&gt;<i> &gt;*modsecurity_crs_60_correlation.conf
</I>&gt;&gt;<i> &gt;- latest slr
</I>&gt;&gt;<i> &gt;*modsecurity_slr_10_ip_reputation.conf
</I>&gt;&gt;<i> &gt;*modsecurity_slr_46_joomla_attacks.conf
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;In modsecurity_crs_10_config.conf the anomaly configuration:
</I>&gt;&gt;<i> &gt;----------------------------------------------------------------------
</I>&gt;&gt;<i> &gt;SecDefaultAction &quot;phase:2,pass,log&quot;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;SecAction &quot;phase:1,t:none,nolog,pass, \
</I>&gt;&gt;<i> &gt;setvar:tx.critical_anomaly_score=5, \
</I>&gt;&gt;<i> &gt;setvar:tx.error_anomaly_score=4, \
</I>&gt;&gt;<i> &gt;setvar:tx.warning_anomaly_score=3, \
</I>&gt;&gt;<i> &gt;setvar:tx.notice_anomaly_score=2&quot;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i> &gt;&quot;phase:1,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_level=5&quot;
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i> &gt;&quot;phase:1,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_level=4&quot;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i>&quot;phase:1,t:none,nolog,pass,setvar:tx.anomaly_score_blocking=on&quot;
</I>&gt;&gt;<i> &gt;----------------------------------------------------------------------
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;This results in mod-security audit log for example:
</I>&gt;&gt;<i> &gt;----------------------------------------------------------------------
</I>&gt;&gt;<i> &gt;--f3f66479-A--
</I>&gt;&gt;<i> &gt;[15/Mar/2012:13:08:09 +0100] T2HbqX8AAAEAAEXDCtoAAAAG 93.94.***.**
</I>&gt;&gt;<i>43988
</I>&gt;&gt;<i> &gt;95.142.***.** 80
</I>&gt;&gt;<i> &gt;--f3f66479-B--
</I>&gt;&gt;<i> &gt;GET /translators.html HTTP/1.1
</I>&gt;&gt;<i> &gt;TE: deflate,gzip;q=0.3
</I>&gt;&gt;<i> &gt;Keep-Alive: 300
</I>&gt;&gt;<i> &gt;Connection: Keep-Alive, TE
</I>&gt;&gt;<i> &gt;Host: 95.142.165.25
</I>&gt;&gt;<i> &gt;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; MSIE 5.5; Windows NT
</I>&gt;&gt;<i>5.1)
</I>&gt;&gt;<i> &gt;Opera 7.01 [en]
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;--f3f66479-F--
</I>&gt;&gt;<i> &gt;HTTP/1.1 404 Not Found
</I>&gt;&gt;<i> &gt;Vary: Accept-Encoding
</I>&gt;&gt;<i> &gt;Content-Length: 214
</I>&gt;&gt;<i> &gt;Keep-Alive: timeout=15, max=100
</I>&gt;&gt;<i> &gt;Connection: Keep-Alive
</I>&gt;&gt;<i> &gt;Content-Type: text/html; charset=iso-8859-1
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;--f3f66479-H--
</I>&gt;&gt;<i> &gt;Message: Warning. Pattern match &quot;^[\d.:]+$&quot; at
</I>&gt;&gt;<i> REQUEST_HEADERS:Host. [file
</I>&gt;&gt;<i> &gt;&quot;/etc/apache2/mod-security/activated_rules/modsecurity_crs_21_pro
</I>&gt;<i>tocol_ano
</I>&gt;&gt;<i> &gt;ma
</I>&gt;&gt;<i> &gt;lies.conf&quot;] [line &quot;97&quot;] [id &quot;960017&quot;] [rev &quot;2.0.10&quot;] [msg &quot;Host header
</I>&gt;&gt;<i>is
</I>&gt;&gt;<i> &gt;a
</I>&gt;&gt;<i> &gt;numeric IP address&quot;] [severity &quot;CRITICAL&quot;] [tag
</I>&gt;&gt;<i> &gt;&quot;PROTOCOL_VIOLATION/IP_HOST&quot;] [tag &quot;WASCTC/WASC-21&quot;] [tag
</I>&gt;&gt;<i> &gt;&quot;OWASP_TOP_10/A7&quot;]
</I>&gt;&gt;<i> &gt;[tag &quot;PCI/6.5.10&quot;] [tag
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>&quot;<A HREF="http://technet.microsoft.com/en-us/magazine/2005.01.hackerbasher.aspx">http://technet.microsoft.com/en-us/magazine/2005.01.hackerbasher.aspx</A>&quot;]
</I>&gt;&gt;<i> &gt;Apache-Error: [file &quot;/tmp/buildd/apache2-2.2.16/server/core.c&quot;] [line
</I>&gt;&gt;<i> &gt;3648]
</I>&gt;&gt;<i> &gt;[level 3] File does not exist:
</I>&gt;&gt;<i> &gt;/var/www/vhosts/intcom.nl/httpdocs/translators.html
</I>&gt;&gt;<i> &gt;Stopwatch: 1331813289736227 5847 (554 5505 -)
</I>&gt;&gt;<i> &gt;Producer: ModSecurity for Apache/2.5.12 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;&gt;<i> &gt;core
</I>&gt;&gt;<i> &gt;ruleset/2.0.10.
</I>&gt;&gt;<i> &gt;Server: Apache/2.2.16 (Debian) PHP/5.3.3-7+squeeze8 with Suhosin-Patch
</I>&gt;&gt;<i> &gt;mod_ssl/2.2.16 OpenSSL/0.9.8o
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;--f3f66479-K--
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i> &gt;&quot;phase:1,t:none,nolog,pass,setvar:tx.critical_anomaly_score=5,set
</I>&gt;&gt;<i> var:tx.er
</I>&gt;&gt;<i> &gt;ro
</I>&gt;&gt;<i> &gt;r_anomaly_score=4,setvar:tx.warning_anomaly_score=3,setvar:tx.not
</I>&gt;<i>ice_anoma
</I>&gt;&gt;<i> &gt;ly
</I>&gt;&gt;<i> &gt;_score=2&quot;
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i> &gt;&quot;phase:1,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_level=5&quot;
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i> &gt;&quot;phase:1,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_level=4&quot;
</I>&gt;&gt;<i> &gt;SecAction
</I>&gt;&gt;<i>&quot;phase:1,t:none,nolog,pass,setvar:tx.anomaly_score_blocking=on&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;REQUEST_METHOD&quot; &quot;@rx ^(?:GET|HEAD)$&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:1,log,chain,rev:2.0.10,t:none,block,msg:'GET or HEAD requests
</I>&gt;&gt;<i>with
</I>&gt;&gt;<i> &gt;bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION,tag:W
</I>&gt;&gt;<i> ASCTC/WAS
</I>&gt;&gt;<i> &gt;C-
</I>&gt;&gt;<i> &gt;21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,tag:<A HREF="http://www.w3.org/Proto">http://www.w3.org/Proto</A>
</I>&gt;&gt;<i> cols/rfc2
</I>&gt;&gt;<i> &gt;61
</I>&gt;&gt;<i> &gt;6/rfc2616-sec4.html#sec4.3&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;REMOTE_ADDR&quot; &quot;@rx .*&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:1,chain,t:none,log,block,id:2200000,msg:'SLR: Client IP in
</I>&gt;&gt;<i> &gt;Blacklist.',tag:AUTOMATION/MALICIOUS,setvar:tx.ip_blacklist=/%{ma
</I>&gt;&gt;<i> tched_var
</I>&gt;&gt;<i> &gt;}/
</I>&gt;&gt;<i> &gt;&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;REQUEST_METHOD&quot; &quot;!@rx ^OPTIONS$&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:2,log,chain,rev:2.0.10,t:none,block,msg:'Request Missing an
</I>&gt;&gt;<i>Accept
</I>&gt;&gt;<i> &gt;Header',severity:2,id:960015,tag:PROTOCOL_VIOLATION/MISSING_HEADE
</I>&gt;&gt;<i> R_ACCEPT,
</I>&gt;&gt;<i> &gt;ta
</I>&gt;&gt;<i> &gt;g:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;&amp;REQUEST_HEADERS:Content-Type&quot; &quot;@eq 0&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:2,log,chain,rev:2.0.10,t:none,block,msg:'Request Containing
</I>&gt;&gt;<i> &gt;Content,
</I>&gt;&gt;<i> &gt;but Missing Content-Type header',id:960904,severity:5&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;REQUEST_HEADERS:Host&quot; &quot;@rx ^[\\d.:]+$&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:2,log,rev:2.0.10,t:none,block,msg:'Host header is a numeric IP
</I>&gt;&gt;<i> &gt;address',severity:2,id:960017,tag:PROTOCOL_VIOLATION/IP_HOST,tag:
</I>&gt;&gt;<i> WASCTC/WA
</I>&gt;&gt;<i> &gt;SC
</I>&gt;&gt;<i> &gt;-21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,tag:<A HREF="http://technet.microso">http://technet.microso</A>
</I>&gt;&gt;<i> ft.com/en
</I>&gt;&gt;<i> &gt;-u
</I>&gt;&gt;<i> &gt;s/magazine/2005.01.hackerbasher.aspx,setvar:tx.msg=%{rule.msg},se
</I>&gt;&gt;<i> tvar:tx.a
</I>&gt;&gt;<i> &gt;no
</I>&gt;&gt;<i> &gt;maly_score=+%{tx.notice_anomaly_score},setvar:tx.policy_score=+%{
</I>&gt;&gt;<i> tx.notice
</I>&gt;&gt;<i> &gt;_a
</I>&gt;&gt;<i> &gt;nomaly_score},setvar:tx.%{rule.id}-POLICY/IP_HOST-%{matched_var_n
</I>&gt;&gt;<i> ame}=%{ma
</I>&gt;&gt;<i> &gt;tc
</I>&gt;&gt;<i> &gt;hed_var}'&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;TX:ANOMALY_SCORE&quot; &quot;@gt 0&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:2,chain,t:none,deny,log,msg:'Inbound Anomaly Score Exceeded
</I>&gt;&gt;<i>(Total
</I>&gt;&gt;<i> &gt;Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQL_INJECTION_SCORE},
</I>&gt;&gt;<i> &gt;XSS=%{TX.XSS_SCORE}): Last Matched Message: %{tx.msg}',logdata:'Last
</I>&gt;&gt;<i> &gt;Matched
</I>&gt;&gt;<i> &gt;Data:
</I>&gt;&gt;<i> &gt;%{matched_var}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbo
</I>&gt;&gt;<i> und_anoma
</I>&gt;&gt;<i> &gt;ly
</I>&gt;&gt;<i> &gt;_score=%{tx.anomaly_score}&quot;
</I>&gt;&gt;<i> &gt;SecRule &quot;TX:INBOUND_ANOMALY_SCORE&quot; &quot;@gt 0&quot;
</I>&gt;&gt;<i> &gt;&quot;phase:5,chain,t:none,log,noauditlog,skipAfter:END_CORRELATION,ms
</I>&gt;&gt;<i> g:'Inboun
</I>&gt;&gt;<i> &gt;d
</I>&gt;&gt;<i> &gt;Anomaly Score (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
</I>&gt;&gt;<i> &gt;SQLi=%{TX.SQL_INJECTION_SCORE}, XSS=%{TX.XSS_SCORE}):
</I>&gt;&gt;<i> &gt;%{tx.inbound_tx_msg}'&quot;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;--f3f66479-Z--
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;----------------------------------------------------------------------
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;It looks like the variables aren't being filled ?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Thank you for your time.
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;Regards
</I>&gt;&gt;<i> &gt;Mark
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;_______________________________________________
</I>&gt;&gt;<i> &gt;Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> &gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This transmission may contain information that is privileged,
</I>&gt;&gt;<i> confidential, and/or exempt from disclosure under applicable law.
</I>&gt;&gt;<i> If you are not the intended recipient, you are hereby notified
</I>&gt;&gt;<i> that any disclosure, copying, distribution, or use of the
</I>&gt;&gt;<i> information contained herein (including any reliance thereon) is
</I>&gt;&gt;<i> STRICTLY PROHIBITED. If you received this transmission in error,
</I>&gt;&gt;<i> please immediately contact the sender and destroy the material in
</I>&gt;&gt;<i> its entirety, whether in electronic or hard copy format.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001040.html">[Owasp-modsecurity-core-rule-set] anomaly score not calculated ?
</A></li>
	<LI>Next message: <A HREF="001042.html">[Owasp-modsecurity-core-rule-set] Website GSoC2012 Ideas - OWASP
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1041">[ date ]</a>
              <a href="thread.html#1041">[ thread ]</a>
              <a href="subject.html#1041">[ subject ]</a>
              <a href="author.html#1041">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
