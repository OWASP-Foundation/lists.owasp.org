<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Mod%20security%20is%20not%20detecting%0A%20double%20header%27s&In-Reply-To=%3CCA%2BVXBuuU5b5v8otd%3DDE%3D6xQdSGYcsOTm_DdbY%3DnWkhtUMOpvAw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001022.html">
   <LINK REL="Next"  HREF="001025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's</H1>
    <B>Gagandeep Singh</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Mod%20security%20is%20not%20detecting%0A%20double%20header%27s&In-Reply-To=%3CCA%2BVXBuuU5b5v8otd%3DDE%3D6xQdSGYcsOTm_DdbY%3DnWkhtUMOpvAw%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's">gagandeepsohi at gmail.com
       </A><BR>
    <I>Fri Mar  2 11:53:15 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001022.html">[Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's
</A></li>
        <LI>Next message: <A HREF="001025.html">[Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1024">[ date ]</a>
              <a href="thread.html#1024">[ thread ]</a>
              <a href="subject.html#1024">[ subject ]</a>
              <a href="author.html#1024">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We have validated that Apache Include directives is in the core directives.
When we are trying a* SQL injection* on HTTPS it detects the attack and
throws an exception.This means  mod-security and CRS is working for HTTPS
as well.

In case of double header this is not working for HTTPS. Do we need to make
any changes in rule set?

Regards
Gagandeep

On Thu, Mar 1, 2012 at 6:40 PM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt; wrote:

&gt;<i>  How do you have the CRS conf files activated in Apache for the port 80
</I>&gt;<i> server?  If you are using Apache Includes, then you should include them
</I>&gt;<i> also within your HTTPS/443 vhost container.
</I>&gt;<i>
</I>&gt;<i>  The other option is, if you want to run the CRS for all HTTP and HTTPS
</I>&gt;<i> sites, is to specify the Apache Include directives in the core directives
</I>&gt;<i> location instead of further down within specific vhost containers.  This
</I>&gt;<i> will propagate to all vhosts.
</I>&gt;<i>
</I>&gt;<i>   --
</I>&gt;<i> Ryan Barnett
</I>&gt;<i> Trustwave SpiderLabs
</I>&gt;<i> ModSecurity Project Leader
</I>&gt;<i> OWASP ModSecurity CRS Project Leader
</I>&gt;<i>
</I>&gt;<i>   From: Gagandeep Singh &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gagandeepsohi at gmail.com</A>&gt;
</I>&gt;<i> Date: Thu, 1 Mar 2012 18:03:47 +0000
</I>&gt;<i> To: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;, Ryan Barnett &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ryan.barnett at owasp.org</A>&gt;
</I>&gt;<i> Subject: Re: [Owasp-modsecurity-core-rule-set] Mod security is not
</I>&gt;<i> detecting double header's
</I>&gt;<i>
</I>&gt;<i>  Thanks Ryan for your help,
</I>&gt;<i>
</I>&gt;<i>  FURTHER ISSUE-  its working for HTTP and we got the below response. Our
</I>&gt;<i> issue is with  HTTPS  as well, this rule is not working for https. Our
</I>&gt;<i> client has raised a concern for HTTPS. Could you please advise what we can
</I>&gt;<i> do to enable this for HTTPS as well.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Message: Warning. Pattern match
</I>&gt;<i> &quot;[\n\r](?:content-(type|length)|set-cookie|location):&quot; at REQUEST_FILENAME.
</I>&gt;<i> [file &quot;/etc/httpd/modsecurity.d/modsecurity_localrules.conf&quot;] [line &quot;4&quot;]
</I>&gt;<i> [id &quot;950910&quot;] [rev &quot;2.2.4&quot;] [msg &quot;HTTP Response Splitting Attack&quot;] [data
</I>&gt;<i> &quot;\x0alocation:&quot;] [severity &quot;ALERT&quot;]
</I>&gt;<i> Message: Warning. Pattern match
</I>&gt;<i> &quot;[\n\r](?:content-(type|length)|set-cookie|location):&quot; at REQUEST_FILENAME.
</I>&gt;<i> [file
</I>&gt;<i> &quot;/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_40_generic_attacks.conf&quot;]
</I>&gt;<i> [line &quot;139&quot;] [id &quot;950910&quot;] [rev &quot;2.2.4&quot;] [msg &quot;HTTP Response Splitting
</I>&gt;<i> Attack&quot;] [data &quot;\x0alocation:&quot;] [severity &quot;CRITICAL&quot;]
</I>&gt;<i> Message: Access denied with code 403 (phase 2). [file
</I>&gt;<i> &quot;/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_49_enforcement.conf&quot;]
</I>&gt;<i> [line &quot;25&quot;] [msg &quot;Anomaly Score Exceeded (score 40): HTTP Response
</I>&gt;<i> Splitting Attack&quot;]
</I>&gt;<i> Action: Intercepted (phase 2)
</I>&gt;<i> Apache-Handler: jakarta-servlet
</I>&gt;<i> Stopwatch: 1330624314422822 1653262 (1471 1258692 -)
</I>&gt;<i> Producer: ModSecurity for Apache/2.5.12 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;<i> core ruleset/2.0.5.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Mar 1, 2012 at 5:25 PM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ryan.barnett at owasp.org</A>&gt;wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>  I have pushed CRS v2.2.4 out to SVN and you can access the updated rule
</I>&gt;&gt;<i> file here -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> <A HREF="http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_40_generic_attacks.conf?revision=1900">http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_40_generic_attacks.conf?revision=1900</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Here is the updated rule -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SecRule REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/* &quot;[\n\r](?:content-(type|length)|set-cookie|location):&quot; \
</I>&gt;&gt;<i>         &quot;phase:2,rev:'2.2.4',t:none,t:lowercase,capture,ctl:auditLogParts=+E,block,msg:'HTTP Response Splitting Attack',id:'950910',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.response_splitting_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-WEB_ATTACK/RESPONSE_SPLITTING-%{matched_var_name}=%{tx.0}&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  -Ryan
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   From: Gagandeep Singh &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gagandeepsohi at gmail.com</A>&gt;
</I>&gt;&gt;<i> Date: Thu, 1 Mar 2012 17:15:36 +0000
</I>&gt;&gt;<i> To: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;&gt;<i> Subject: [Owasp-modsecurity-core-rule-set] Mod security is not detecting
</I>&gt;&gt;<i> double header's
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  We have configured modsecurity apache_2.6.3 and its working fine for
</I>&gt;&gt;<i> most of the cases but we have identified a special attack which is causing
</I>&gt;&gt;<i> a double header injection to the site.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Example :-
</I>&gt;&gt;<i>  <A HREF="https://www.XYZ.com/%0d%0aLocation:http://www.google.com&lt;https://www.xyz.com/%0d%0aLocation:http://www.google.com">https://www.XYZ.com/%0d%0aLocation:http://www.google.com&lt;https://www.xyz.com/%0d%0aLocation:http://www.google.com</A>&gt;
</I>&gt;&gt;<i>  Note - XYZ is any site.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  This generates a Duplicate headers error page which is shown below-
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Duplicate headers received from the server
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The response from the server contained duplicate headers. This problem
</I>&gt;&gt;&gt;<i> is generally the result of a misconfigured website or proxy. Only the
</I>&gt;&gt;&gt;<i> website or proxy administrator can fix this issue.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  Error 350 (net::ERR_RESPONSE_HEADERS_MULTIPLE_LOCATION): Multiple
</I>&gt;&gt;&gt;<i> Location headers received. This is disallowed to protect against HTTP
</I>&gt;&gt;&gt;<i> response-splitting attacks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  As per the discussion with Bren we came to know that this will be fixed
</I>&gt;&gt;<i> in CRS 2.2.4 but we need this urgently, Is it possible to get the rule for
</I>&gt;&gt;<i> above issue so we can apply the patch for the time being and will apply
</I>&gt;&gt;<i> 2.2.4 soon as it becomes available.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Could you please also assist on this, what configuration changes are
</I>&gt;&gt;<i> required to handle this?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  Regards
</I>&gt;&gt;<i> Gagandeep Singh  Sohi
</I>&gt;&gt;<i>  _______________________________________________
</I>&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  --
</I>&gt;<i> *Regards,
</I>&gt;<i> **Gagandeep Singh Sohi*
</I>&gt;<i> *9717920072*
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i> This transmission may contain information that is privileged,
</I>&gt;<i> confidential, and/or exempt from disclosure under applicable law. If you
</I>&gt;<i> are not the intended recipient, you are hereby notified that any
</I>&gt;<i> disclosure, copying, distribution, or use of the information contained
</I>&gt;<i> herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
</I>&gt;<i> received this transmission in error, please immediately contact the sender
</I>&gt;<i> and destroy the material in its entirety, whether in electronic or hard
</I>&gt;<i> copy format.
</I>&gt;<i>
</I>


-- 
*Regards,
**Gagandeep Singh Sohi*
*9717920072*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120302/f16e0aed/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120302/f16e0aed/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001022.html">[Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's
</A></li>
	<LI>Next message: <A HREF="001025.html">[Owasp-modsecurity-core-rule-set] Mod security is not detecting double header's
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1024">[ date ]</a>
              <a href="thread.html#1024">[ thread ]</a>
              <a href="subject.html#1024">[ subject ]</a>
              <a href="author.html#1024">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
