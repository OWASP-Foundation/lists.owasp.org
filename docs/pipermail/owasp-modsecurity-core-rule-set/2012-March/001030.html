<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]	Updated Rule Formatting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%5BRule%20Update%20-%20Discussion%20Thread%5D%0A%09Updated%20Rule%20Formatting&In-Reply-To=%3CCB851CEF.45B8F%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001028.html">
   <LINK REL="Next"  HREF="001031.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]	Updated Rule Formatting</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%5BRule%20Update%20-%20Discussion%20Thread%5D%0A%09Updated%20Rule%20Formatting&In-Reply-To=%3CCB851CEF.45B8F%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]	Updated Rule Formatting">RBarnett at trustwave.com
       </A><BR>
    <I>Tue Mar 13 19:49:03 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001028.html">[Owasp-modsecurity-core-rule-set] OWASP AppSecDC 2012 Conference
</A></li>
        <LI>Next message: <A HREF="001031.html">[Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread] Updated Rule Formatting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1030">[ date ]</a>
              <a href="thread.html#1030">[ thread ]</a>
              <a href="subject.html#1030">[ subject ]</a>
              <a href="author.html#1030">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am working on updating the current CRS SecRule formatting.  The idea is
to make the rules easier to read and understand what is happening, for
example to quickly understand the ACTION line data.

The format is updated to:

1) Separate the VARIABLE OPERATOR and ACTION sections from each other by
using the Apache \ line continuation character.
2) The 1st ACTION line starts with the rule ID.  This makes it easier to
find rules of interest.
3) The end of the 1st ACTION line lists any disruptive actions.
4) Transformation functions have their own line
5) Tags have their own line
6) Meta-actions (such as setvars) have their own line
7) Also including example attack payloads that are detected by the
OPERATOR to help understand what the regex is looking form

Please review/comment on the updated format below.  I would like to start
updating the CRS rules to use this format for the 3.0 version.

Thanks.


--
Ryan Barnett
Trustwave SpiderLabsModSecurity Project Leader
OWASP ModSecurity CRS Project Leader



#####################################
#
# Example Payloads Detected:
# -------------------------
# ' or 1=1#
# ') or ('1'='1--
# 1 OR \'1\'!=0
# aaa\' or (1)=(1) #!asd
# aaa\' OR (1) IS NOT NULL #!asd
# ' =+ '
# asd' =- (-'asd') -- -a
# aa&quot; =+ - &quot;0
# asd&quot;or-1=&quot;-1
# asd&quot;or!1=&quot;!1
# asd&quot;or!(1)=&quot;1
# asd&quot; or ascii(1)=&quot;49
# asd' or md5(5)^'1
# \&quot;asd&quot; or 1=&quot;1
# ' or id= 1 having 1 #1 !
# ' or id= 2-1 having 1 #1 !
# aa'or BINARY 1= '1
# aa'like-'aa
# -------------------------
#

SecRule
REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:
/* \
\
&quot;(?i)(?i:\d[\&quot;'`&#180;&#185;&#338;]\s+[\&quot;'`&#180;&#185;&#338;]\s+\d)|(?:^admin\s*?[\&quot;'`&#180;&#185;&#338;]|(\/\*)+[\&quot;'`
&#180;&#185;&#338;]+\s?(?:--|#|\/\*|{)?)|(?:[\&quot;'`&#180;&#185;&#338;]\s*?(x?or|div|like|between|and)[\w\s-
]+\s*?[+&lt;&gt;=(),-]\s*?[\d\&quot;'`&#180;&#185;&#338;])|(?:[\&quot;'`&#180;&#185;&#338;]\s*?[^\w\s]?=\s*?[\&quot;'`&#180;&#185;&#338;])|(?
:<i>[\&quot;'`&#180;&#185;&#338;]\W*?[+=]+\W*?[\&quot;'`&#180;&#185;&#338;])|(?:[\&quot;'`&#180;&#185;&#338;]\s*?[!=|][\d\s!=+-]+.*?[\&quot;'`
</I>&#180;&#185;&#338;(].*?$)|(?:[\&quot;'`&#180;&#185;&#338;]\s*?[!=|][\d\s!=]+.*?\d+$)|(?:[\&quot;'`&#180;&#185;&#338;]\s*?like\W+[\
w\&quot;'`&#180;&#185;&#338;(])|(?:\sis\s*?0\W)|(?:where\s[\s\w\.,-]+\s=)|(?:[\&quot;'`&#180;&#185;&#338;][&lt;&gt;~]+[\&quot;
'`&#180;&#185;&#338;])&quot; \
\
&quot;id:'981244',msg:'Detects basic SQL authentication bypass attempts
1/3',logdata:'%{TX.0}',severity:'2',phase:2,capture,block, \
t:none,t:urlDecodeUni, \
tag:'WEB_ATTACK/SQLI', \
setvar:'tx.msg=%{rule.id}-%{rule.msg}', \
setvar:'tx.%{tx.msg}-WEB_ATTACK/SQLI-%{matched_var_name}=%{tx.0}' \
setvar:tx.sql_injection_score=+1, \
setvar:tx.anomaly_score=+%{tx.critical_anomaly_score}&quot;






This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001028.html">[Owasp-modsecurity-core-rule-set] OWASP AppSecDC 2012 Conference
</A></li>
	<LI>Next message: <A HREF="001031.html">[Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread] Updated Rule Formatting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1030">[ date ]</a>
              <a href="thread.html#1030">[ thread ]</a>
              <a href="subject.html#1030">[ subject ]</a>
              <a href="author.html#1030">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
