<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [Mod-security-developers] CRS	DoS bugs/suggestions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5BMod-security-developers%5D%20CRS%0A%09DoS%20bugs/suggestions&In-Reply-To=CA20BCA5.29064%25rbarnett%40trustwave.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000784.html">
   <LINK REL="Next"  HREF="000786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [Mod-security-developers] CRS	DoS bugs/suggestions</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5BMod-security-developers%5D%20CRS%0A%09DoS%20bugs/suggestions&In-Reply-To=CA20BCA5.29064%25rbarnett%40trustwave.com"
       TITLE="[Owasp-modsecurity-core-rule-set] [Mod-security-developers] CRS	DoS bugs/suggestions">RBarnett at trustwave.com
       </A><BR>
    <I>Fri Jun 17 08:20:12 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000784.html">[Owasp-modsecurity-core-rule-set] ModSecurity Happy Hour at	Blackhat USA 2011
</A></li>
        <LI>Next message: <A HREF="000786.html">[Owasp-modsecurity-core-rule-set] [Mod-security-developers] CRS	DoS bugs/suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#785">[ date ]</a>
              <a href="thread.html#785">[ thread ]</a>
              <a href="subject.html#785">[ subject ]</a>
              <a href="author.html#785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am forwarding this to the OWASP ModSecurity CRS list as this pertains to
the DoS rules.


Oleg - please send future issues related to the OWASP CRS to this
mail-list instead of the ModSec Dev list.

Thanks.

-Ryan

On 6/17/11 8:15 AM, &quot;Ryan Barnett&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt; wrote:

&gt;<i>Oleg,
</I>&gt;<i>First of all, thank you for taking the time to test these rules further.
</I>&gt;<i>The rule quality will only improve if the community takes the time to
</I>&gt;<i>test them and report back the status.
</I>&gt;<i>
</I>&gt;<i>To your comments about the lack of &quot;expirevar&quot; actions, this should not
</I>&gt;<i>be needed for the ip.dos_counter var as the last rule uses the
</I>&gt;<i>&quot;setvar:!ip.dos_counter&quot; action to actually remove that variable if the
</I>&gt;<i>operator matches.  Can you please check your debug log during testing to
</I>&gt;<i>verify if that action is not removing that variable?  Perhaps there is a
</I>&gt;<i>bug in removing the variable with the &quot;!&quot; symbol and using expirevar is
</I>&gt;<i>more reliable.
</I>&gt;<i>
</I>&gt;<i>Also &#173; what version of ModSecurity are you using?
</I>&gt;<i>
</I>&gt;<i>-Ryan
</I>&gt;<i>
</I>&gt;<i>From: Oleg Gryb &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">oleg_gryb at yahoo.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">oleg_gryb at yahoo.com</A>&gt;&gt;
</I>&gt;<i>Reply-To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">oleg at gryb.info</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">oleg at gryb.info</A>&gt;&quot;
</I>&gt;<i>&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">oleg at gryb.info</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">oleg at gryb.info</A>&gt;&gt;,
</I>&gt;<i>&quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-developers at lists.sourceforge.net</A>&lt;mailto:mod-security-develop
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ers at lists.sourceforge.net</A>&gt;&quot;
</I>&gt;<i>&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-developers at lists.sourceforge.net</A>&lt;mailto:mod-security-develop
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ers at lists.sourceforge.net</A>&gt;&gt;
</I>&gt;<i>Date: Thu, 16 Jun 2011 11:32:11 -0500
</I>&gt;<i>To:
</I>&gt;<i>&quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-developers at lists.sourceforge.net</A>&lt;mailto:mod-security-develop
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ers at lists.sourceforge.net</A>&gt;&quot;
</I>&gt;<i>&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-developers at lists.sourceforge.net</A>&lt;mailto:mod-security-develop
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ers at lists.sourceforge.net</A>&gt;&gt;
</I>&gt;<i>Subject: [Mod-security-developers] CRS DoS bugs/suggestions
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>I was testing DoS ruleset lately and found that there probably was a bug
</I>&gt;<i>related to ip.dos_counter variable. The expiration time was not set for
</I>&gt;<i>this var, as a result the counter persists longer than
</I>&gt;<i>tx.dos_burst_time_slice. As a result, the history of hits is counted for
</I>&gt;<i>a longer time period.
</I>&gt;<i>
</I>&gt;<i>I've added expiration time in two places and it started to work correctly
</I>&gt;<i>after that. The changes are below:
</I>&gt;<i>
</I>&gt;<i>SecRule REQUEST_BASENAME &quot;!\.(jpe?g|png|gif|js|css|ico)$&quot;
</I>&gt;<i>&quot;phase:5,t:none,nolog,pass,setvar:ip.dos_counter=+1,expirevar:ip.dos_count
</I>&gt;<i>er=%{tx.dos_burst_time_slice}&quot;
</I>&gt;<i>
</I>&gt;<i>...
</I>&gt;<i>
</I>&gt;<i>SecRule IP:DOS_COUNTER &quot;@ge %{tx.dos_counter_threshold}&quot;
</I>&gt;<i>&quot;phase:5,t:none,nolog,pass,t:none,setvar:ip.dos_burst_counter=+1,expirevar
</I>&gt;:<i>ip.dos_burst_counter=%{tx.dos_burst_time_slice},setvar:!ip.dos_counter,ex
</I>&gt;<i>pirevar:ip.dos_counter=%{tx.dos_burst_time_slice}&quot;
</I>&gt;<i>
</I>&gt;<i>I've also attached the sample of testing program. I think, we should have
</I>&gt;<i>something like that to test all limits. There are only two tests
</I>&gt;<i>implemented for now: for request size and DoS, but it should be easy to
</I>&gt;<i>add more.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>________________________________
</I>&gt;<i>This transmission may contain information that is privileged,
</I>&gt;<i>confidential, and/or exempt from disclosure under applicable law. If you
</I>&gt;<i>are not the intended recipient, you are hereby notified that any
</I>&gt;<i>disclosure, copying, distribution, or use of the information contained
</I>&gt;<i>herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
</I>&gt;<i>received this transmission in error, please immediately contact the
</I>&gt;<i>sender and destroy the material in its entirety, whether in electronic or
</I>&gt;<i>hard copy format.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--------------------------------------------------------------------------
</I>&gt;<i>----
</I>&gt;<i>EditLive Enterprise is the world's most technically advanced content
</I>&gt;<i>authoring tool. Experience the power of Track Changes, Inline Image
</I>&gt;<i>Editing and ensure content is compliant with Accessibility Checking.
</I>&gt;<i><A HREF="http://p.sf.net/sfu/ephox-dev2dev">http://p.sf.net/sfu/ephox-dev2dev</A>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>mod-security-developers mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-developers at lists.sourceforge.net</A>
</I>&gt;<i><A HREF="https://lists.sourceforge.net/lists/listinfo/mod-security-developers">https://lists.sourceforge.net/lists/listinfo/mod-security-developers</A>
</I>&gt;<i>ModSecurity Services from Trustwave's SpiderLabs:
</I>&gt;<i><A HREF="https://www.trustwave.com/spiderLabs.php">https://www.trustwave.com/spiderLabs.php</A>
</I>&gt;<i>
</I>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000784.html">[Owasp-modsecurity-core-rule-set] ModSecurity Happy Hour at	Blackhat USA 2011
</A></li>
	<LI>Next message: <A HREF="000786.html">[Owasp-modsecurity-core-rule-set] [Mod-security-developers] CRS	DoS bugs/suggestions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#785">[ date ]</a>
              <a href="thread.html#785">[ thread ]</a>
              <a href="subject.html#785">[ subject ]</a>
              <a href="author.html#785">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
