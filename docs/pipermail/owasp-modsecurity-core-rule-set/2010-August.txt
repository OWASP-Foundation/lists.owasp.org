From JM9991 at att.com  Thu Aug  5 16:19:06 2010
From: JM9991 at att.com (MARTIN, JASON (ATTSI))
Date: Thu, 5 Aug 2010 13:19:06 -0700
Subject: [Owasp-modsecurity-core-rule-set] 900011 double-counting
Message-ID: <5889717B8EF90049926E1B6B68E220140D78ACDF@BD01MSXMB018.US.Cingular.Net>

Hello, I am trying to figure out why arule 900011 rule seems to be being
'double-counted' against the anomaly score. Rule 900011 is triggering
twice on the same value; /home/ appears once in the argument but it
triggers twice. Any ideas why this is happening?

When I add a counter-rule to reduce the score (as this behavior is ok
for my site), it fires only once and so the score is too high.

This is with CRS 2.0.7 (patched with
https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-J
une/000398.html) , mod_security  2.5.12, apache 2.2.15, Solaris 10
SPARC.

--00002f18-A--
[05/Aug/2010:12:22:10 --0700] TFsPYQoWATMAAGRfQSYAAADP x.x.x.x x.x.x.x
--00002f18-B--
GET /foo?bar=/en_US/home/default.xml&modsecdebug=taps HTTP/1.1
User-Agent: curl/7.19.4 (i386-pc-solaris2.11) libcurl/7.19.4
OpenSSL/0.9.8a zlib/1.2.3 libidn/1.9
Host: example.com
Accept: */*
Cache-Control: max-stale=0
Connection: Keep-Alive

--00002f18-F--
HTTP/1.1 404 Not Found
Content-Length: 201
Keep-Alive: timeout=30, max=187
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1

--00002f18-H--
Message: Matched phrase "curl" at REQUEST_HEADERS:User-Agent. [file
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
dsecurity_crs_35_bad_robots.conf"] [line "26"] [id "990012"] [rev
"2.0.7"] [msg "Rogue web site crawler"] [data "curl"] [severity
"WARNING"] [tag "AUTOMATION/MALICIOUS"] [tag "WASCTC/WASC-21"] [tag
"OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
Message: Pattern match
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
|(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
"Detects specific directory and path traversal"] [data "/home/"]
[severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
"WEB_ATTACK/LFI"]
Message: Pattern match
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
|(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
"Detects specific directory and path traversal"] [data "/home/"]
[severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
"WEB_ATTACK/LFI"]
Message: Operator GE matched 21 at TX:anomaly_score. [file
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
dsecurity_crs_49_inbound_blocking.conf"] [line "18"] [msg "Inbound
Anomaly Score Exceeded (Total Score: 52, SQLi=, XSS=): 900011-Detects
specific directory and path traversal"]
Message: Warning. Operator GE matched 21 at TX:inbound_anomaly_score.
[file
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
dsecurity_crs_60_correlation.conf"] [line "35"] [msg "Inbound Anomaly
Score Exceeded (Total Inbound Score: 52, SQLi=, XSS=): 900011-Detects
specific directory and path traversal"]
Apache-Error: [file "core.c"] [line 3648] [level 3] File does not exist:
/sites/www-site/www/foo
Stopwatch: 1281036129731407 461977 (5100 459965 -)
Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/);
core ruleset/2.0.7.
Server: Apache

--00002f18-K--
SecAction
"phase:1,auditlog,t:none,pass,nolog,initcol:global=global,initcol:ip=%{r
emote_addr}"
SecAction "phase:1,auditlog,t:none,nolog,pass,setvar:tx.paranoid_mode=0"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_leve
l=21"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_lev
el=15"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.critical_anomaly_score=21,
setvar:tx.error_anomaly_score=15,setvar:tx.warning_anomaly_score=10,setv
ar:tx.notice_anomaly_score=5"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_num_args=255"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_file_size=1048576"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.combined_file_sizes=104857
6"
SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:'tx.allowed_methods=GET HEAD
POST',setvar:'tx.allowed_request_content_type=application/x-www-form-url
encoded multipart/form-data text/xml
application/xml',setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0
HTTP/1.1',setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/
.backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/
.csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/
.idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
.pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/
.vsdisco/ .webinfo/ .xsd/
.xsx/',setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
/Content-Range/ /Translate/ /via/ /if/'"
SecRule "ARGS:modsecdebug" "@rx taps"
"phase:2,log,auditlog,pass,ctl:debugLogLevel=9"
SecRule "REQUEST_METHOD" "@rx ^(?:GET|HEAD)$"
"phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'GET or HEAD
requests with
bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION,tag:WASCTC/W
ASC-21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,tag:http://www.w3.org/Protocol
s/rfc2616/rfc2616-sec4.html#sec4.3"
SecRule "&REQUEST_HEADERS:Pragma" "@eq 1"
"phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Pragma Header
requires Cache-Control Header for HTTP/1.1
requests.',severity:5,id:960020,tag:PROTOCOL_VIOLATION/INVALID_HREQ,tag:
http://www.bad-behavior.ioerror.us/documentation/how-it-works/"
SecRule "&REQUEST_HEADERS:Content-Type" "@eq 0"
"phase:2,pass,chain,rev:2.0.7,t:none,nolog,auditlog,msg:'Request
Containing Content, but Missing Content-Type
header',id:960904,severity:5"
SecRule "&TX:MAX_NUM_ARGS" "@eq 1"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'Too many arguments in
request',id:960335,severity:4,rev:2.0.7"
SecRule "&TX:MAX_FILE_SIZE" "@eq 1"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'Uploaded file size too
large',id:960342,severity:4,rev:2.0.7"
SecRule "&TX:COMBINED_FILE_SIZES" "@eq 1"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'Total uploaded files size
too large',id:960343,severity:4,rev:2.0.7"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
"phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
by
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
pture,setvar:tx.header_name='/%{tx.0}/'"
SecRule "REQUEST_HEADERS:User-Agent" "@pmFromFile
modsecurity_35_bad_robots.data"
"phase:2,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Rogue web site
crawler',id:990012,tag:AUTOMATION/MALICIOUS,tag:WASCTC/WASC-21,tag:OWASP
_TOP_10/A7,tag:PCI/6.5.10,severity:4,capture,logdata:%{TX.0},setvar:tx.m
sg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setv
ar:tx.automation_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}
-AUTOMATION/MALICIOUS-%{matched_var_name}=%{matched_var}"
SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
modsecurity_40_generic_attacks.data"
"phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
rcase,nolog,pass,setvar:tx.pm_score=+1"
SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
modsecurity_40_generic_attacks.data"
"phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
rcase,nolog,pass,setvar:tx.pm_score=+1"
SecRule "TX:PARANOID_MODE" "!@eq 1"
"phase:2,t:none,nolog,skipAfter:END_SESSION_FIXATION"
SecRule "TX:PARANOID_MODE" "!@eq 1"
"phase:2,t:none,nolog,skipAfter:END_FILE_INJECTION"
SecRule "TX:PARANOID_MODE" "!@eq 1"
"phase:2,t:none,nolog,skipAfter:END_COMMAND_ACCESS"
SecRule "TX:PARANOID_MODE" "!@eq 1"
"phase:2,t:none,nolog,skipAfter:END_COMMAND_INJECTION"
SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
"phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
"phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
SecRule "TX:PARANOID_MODE" "!@eq 1"
"phase:2,rev:2.0.7,t:none,nolog,skipAfter:END_SQL_INJECTION_WEAK"
SecRule "TX:PARANOID_MODE" "!@eq 1"
"phase:2,t:none,nolog,skipAfter:END_XSS_CHECK"
SecRule "TX:ANOMALY_SCORE" "@gt 0"
"phase:2,chain,t:none,nolog,auditlog,block,msg:'Inbound Anomaly Score
Exceeded (Total Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQLI_SCORE},
XSS=%{TX.XSS_SCORE}):
%{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbound_anomaly_
score=%{tx.anomaly_score}"
SecRule "TX:ANOMALY_SCORE" "@ge %{tx.inbound_anomaly_score_level}"
SecRule "TX:INBOUND_ANOMALY_SCORE" "@gt 0"
"phase:5,chain,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score
(Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
SecRule "TX:INBOUND_ANOMALY_SCORE" "@ge
%{tx.inbound_anomaly_score_level}"
"phase:5,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score Exceeded
(Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"

--00002f18-Z-


Section of the debug log showing the duplicate:

[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Recipe: Invoking rule
f2bea8; [file
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"].
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][5] Rule f2bea8: SecRule
"ARGS|ARGS_NAMES|XML:/*" "@rx
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
"phase:2,capture,m
ultiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDecode,t:replaceComm
ents,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,a
uditlog,msg:'Detects specific directory and path
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
ar:tx.anomaly_score=+%{tx.cr
itical_anomaly_score},setvar:tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched
_var_name}=%{tx.0}"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Expanded
"ARGS|ARGS_NAMES|XML:/*" to
"ARGS:bar|ARGS:modsecdebug|ARGS_NAMES:bar|ARGS_NAMES:modsecdebug".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
in 2 usec.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
with param
"(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
|\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
ARGS:bar.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
"/en_US/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
to TX.0: /home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
to TX.1: home
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 62
usec.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts to
ABIFHKZE.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
tx.msg=%{rule.id}-%{rule.msg}
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.id}
to: 900011
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.msg}
to: Detects specific directory and path traversal
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
"900011-Detects specific directory and path traversal".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
tx.anomaly_score=+%{tx.critical_anomaly_score}
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
variable: tx.anomaly_score = "10"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{tx.critical_anomaly_score} to: 21
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
anomaly_score=10+21
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
"tx.anomaly_score" to "31".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
to: 900011-Detects specific directory and path traversal
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{matched_var_name} to: ARGS:bar
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0} to:
/home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
"tx.900011-Detects specific directory and path
traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
/home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
/home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
|(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
"/sites/www-site/APACHE/httpd-2.2.15-w
orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
[line "101"] [id "900011"] [msg "Detects specific directory and path
traversal"] [data "/home/"] [severity "CRITICAL"] [tag "WEB_ATTACK/DT"]
[tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) cssDecode:
"/en_US/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) jsDecode:
"/en_US/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) htmlEntityDecode:
"/en_US/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) replaceComments:
"/en_US/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) compressWhitespace:
"/en_US/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) lowercase:
"/en_us/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
in 1969 usec.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
with param
"(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
|\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
ARGS:bar.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
"/en_us/home/default.xml"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
to TX.0: /home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
to TX.1: home
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 64
usec.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts to
ABIFHKZEE.
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
tx.msg=%{rule.id}-%{rule.msg}
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.id}
to: 900011
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.msg}
to: Detects specific directory and path traversal
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
"900011-Detects specific directory and path traversal".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
tx.anomaly_score=+%{tx.critical_anomaly_score}
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
variable: tx.anomaly_score = "31"
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{tx.critical_anomaly_score} to: 21
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
anomaly_score=31+21
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
"tx.anomaly_score" to "52".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
to: 900011-Detects specific directory and path traversal
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{matched_var_name} to: ARGS:bar
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0} to:
/home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
"tx.900011-Detects specific directory and path
traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
/home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
/home/
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
|(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
"/sites/www-site/APACHE/httpd-2.2.15-w
orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
[line "101"] [id "900011"] [msg "Detects specific directory and path
traversal"] [data "/home/"] [severity "CRITICAL"] [tag "WEB_ATTACK/DT"]
[tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
[05/Aug/2010:12:22:09 --0700]
[example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
in 2 usec.

Thank you,
-Jason Martin

From rcbarnett at gmail.com  Thu Aug  5 17:37:52 2010
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Thu, 5 Aug 2010 17:37:52 -0400
Subject: [Owasp-modsecurity-core-rule-set] 900011 double-counting
In-Reply-To: <5889717B8EF90049926E1B6B68E220140D78ACDF@BD01MSXMB018.US.Cingular.Net>
References: <5889717B8EF90049926E1B6B68E220140D78ACDF@BD01MSXMB018.US.Cingular.Net>
Message-ID: <AANLkTi=4hqG+vB=GemistUiVsPWP8EEvAhSrDWtSZec0@mail.gmail.com>

I believe this is caused be "paranoid_mode" being set to 1 in the 10
conf file.  This mode checks the sigs against variables that are prone
to higher false positive rates.

I am fixing the logic in the next phpids filters file version so that
it will skip the paparoind check if the initial rule matches.


On 8/5/10, MARTIN, JASON (ATTSI) <JM9991 at att.com> wrote:
> Hello, I am trying to figure out why arule 900011 rule seems to be being
> 'double-counted' against the anomaly score. Rule 900011 is triggering
> twice on the same value; /home/ appears once in the argument but it
> triggers twice. Any ideas why this is happening?
>
> When I add a counter-rule to reduce the score (as this behavior is ok
> for my site), it fires only once and so the score is too high.
>
> This is with CRS 2.0.7 (patched with
> https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-J
> une/000398.html) , mod_security  2.5.12, apache 2.2.15, Solaris 10
> SPARC.
>
> --00002f18-A--
> [05/Aug/2010:12:22:10 --0700] TFsPYQoWATMAAGRfQSYAAADP x.x.x.x x.x.x.x
> --00002f18-B--
> GET /foo?bar=/en_US/home/default.xml&modsecdebug=taps HTTP/1.1
> User-Agent: curl/7.19.4 (i386-pc-solaris2.11) libcurl/7.19.4
> OpenSSL/0.9.8a zlib/1.2.3 libidn/1.9
> Host: example.com
> Accept: */*
> Cache-Control: max-stale=0
> Connection: Keep-Alive
>
> --00002f18-F--
> HTTP/1.1 404 Not Found
> Content-Length: 201
> Keep-Alive: timeout=30, max=187
> Connection: Keep-Alive
> Content-Type: text/html; charset=iso-8859-1
>
> --00002f18-H--
> Message: Matched phrase "curl" at REQUEST_HEADERS:User-Agent. [file
> "/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_35_bad_robots.conf"] [line "26"] [id "990012"] [rev
> "2.0.7"] [msg "Rogue web site crawler"] [data "curl"] [severity
> "WARNING"] [tag "AUTOMATION/MALICIOUS"] [tag "WASCTC/WASC-21"] [tag
> "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Pattern match
> "(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
> p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
> "Detects specific directory and path traversal"] [data "/home/"]
> [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
> "WEB_ATTACK/LFI"]
> Message: Pattern match
> "(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
> p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
> "Detects specific directory and path traversal"] [data "/home/"]
> [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
> "WEB_ATTACK/LFI"]
> Message: Operator GE matched 21 at TX:anomaly_score. [file
> "/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_49_inbound_blocking.conf"] [line "18"] [msg "Inbound
> Anomaly Score Exceeded (Total Score: 52, SQLi=, XSS=): 900011-Detects
> specific directory and path traversal"]
> Message: Warning. Operator GE matched 21 at TX:inbound_anomaly_score.
> [file
> "/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_60_correlation.conf"] [line "35"] [msg "Inbound Anomaly
> Score Exceeded (Total Inbound Score: 52, SQLi=, XSS=): 900011-Detects
> specific directory and path traversal"]
> Apache-Error: [file "core.c"] [line 3648] [level 3] File does not exist:
> /sites/www-site/www/foo
> Stopwatch: 1281036129731407 461977 (5100 459965 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/);
> core ruleset/2.0.7.
> Server: Apache
>
> --00002f18-K--
> SecAction
> "phase:1,auditlog,t:none,pass,nolog,initcol:global=global,initcol:ip=%{r
> emote_addr}"
> SecAction "phase:1,auditlog,t:none,nolog,pass,setvar:tx.paranoid_mode=0"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_leve
> l=21"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_lev
> el=15"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.critical_anomaly_score=21,
> setvar:tx.error_anomaly_score=15,setvar:tx.warning_anomaly_score=10,setv
> ar:tx.notice_anomaly_score=5"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_num_args=255"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_file_size=1048576"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.combined_file_sizes=104857
> 6"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:'tx.allowed_methods=GET HEAD
> POST',setvar:'tx.allowed_request_content_type=application/x-www-form-url
> encoded multipart/form-data text/xml
> application/xml',setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0
> HTTP/1.1',setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/
> .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/
> .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/
> .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
> .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/
> .vsdisco/ .webinfo/ .xsd/
> .xsx/',setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
> /Content-Range/ /Translate/ /via/ /if/'"
> SecRule "ARGS:modsecdebug" "@rx taps"
> "phase:2,log,auditlog,pass,ctl:debugLogLevel=9"
> SecRule "REQUEST_METHOD" "@rx ^(?:GET|HEAD)$"
> "phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'GET or HEAD
> requests with
> bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION,tag:WASCTC/W
> ASC-21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,tag:http://www.w3.org/Protocol
> s/rfc2616/rfc2616-sec4.html#sec4.3"
> SecRule "&REQUEST_HEADERS:Pragma" "@eq 1"
> "phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Pragma Header
> requires Cache-Control Header for HTTP/1.1
> requests.',severity:5,id:960020,tag:PROTOCOL_VIOLATION/INVALID_HREQ,tag:
> http://www.bad-behavior.ioerror.us/documentation/how-it-works/"
> SecRule "&REQUEST_HEADERS:Content-Type" "@eq 0"
> "phase:2,pass,chain,rev:2.0.7,t:none,nolog,auditlog,msg:'Request
> Containing Content, but Missing Content-Type
> header',id:960904,severity:5"
> SecRule "&TX:MAX_NUM_ARGS" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Too many arguments in
> request',id:960335,severity:4,rev:2.0.7"
> SecRule "&TX:MAX_FILE_SIZE" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Uploaded file size too
> large',id:960342,severity:4,rev:2.0.7"
> SecRule "&TX:COMBINED_FILE_SIZES" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Total uploaded files size
> too large',id:960343,severity:4,rev:2.0.7"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted
> by
> policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
> WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
> 15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS:User-Agent" "@pmFromFile
> modsecurity_35_bad_robots.data"
> "phase:2,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Rogue web site
> crawler',id:990012,tag:AUTOMATION/MALICIOUS,tag:WASCTC/WASC-21,tag:OWASP
> _TOP_10/A7,tag:PCI/6.5.10,severity:4,capture,logdata:%{TX.0},setvar:tx.m
> sg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setv
> ar:tx.automation_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}
> -AUTOMATION/MALICIOUS-%{matched_var_name}=%{matched_var}"
> SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
> modsecurity_40_generic_attacks.data"
> "phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
> rcase,nolog,pass,setvar:tx.pm_score=+1"
> SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
> modsecurity_40_generic_attacks.data"
> "phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
> rcase,nolog,pass,setvar:tx.pm_score=+1"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_SESSION_FIXATION"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_FILE_INJECTION"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_COMMAND_ACCESS"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_COMMAND_INJECTION"
> SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
> (?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
> |tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
> "phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
> code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
> s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
> traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
> LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
> ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
> B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
> SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
> (?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
> |tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
> "phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
> code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
> s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
> traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
> LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
> ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
> B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,rev:2.0.7,t:none,nolog,skipAfter:END_SQL_INJECTION_WEAK"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_XSS_CHECK"
> SecRule "TX:ANOMALY_SCORE" "@gt 0"
> "phase:2,chain,t:none,nolog,auditlog,block,msg:'Inbound Anomaly Score
> Exceeded (Total Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQLI_SCORE},
> XSS=%{TX.XSS_SCORE}):
> %{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbound_anomaly_
> score=%{tx.anomaly_score}"
> SecRule "TX:ANOMALY_SCORE" "@ge %{tx.inbound_anomaly_score_level}"
> SecRule "TX:INBOUND_ANOMALY_SCORE" "@gt 0"
> "phase:5,chain,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score
> (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
> SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
> SecRule "TX:INBOUND_ANOMALY_SCORE" "@ge
> %{tx.inbound_anomaly_score_level}"
> "phase:5,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score Exceeded
> (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
> SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
>
> --00002f18-Z-
>
>
> Section of the debug log showing the duplicate:
>
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Recipe: Invoking rule
> f2bea8; [file
> "/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"].
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][5] Rule f2bea8: SecRule
> "ARGS|ARGS_NAMES|XML:/*" "@rx
> (?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
> |tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
> "phase:2,capture,m
> ultiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDecode,t:replaceComm
> ents,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,a
> uditlog,msg:'Detects specific directory and path
> traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
> LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
> ar:tx.anomaly_score=+%{tx.cr
> itical_anomaly_score},setvar:tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched
> _var_name}=%{tx.0}"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Expanded
> "ARGS|ARGS_NAMES|XML:/*" to
> "ARGS:bar|ARGS:modsecdebug|ARGS_NAMES:bar|ARGS_NAMES:modsecdebug".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 2 usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
> with param
> "(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
> v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
> |\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
> ARGS:bar.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
> to TX.0: /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
> to TX.1: home
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 62
> usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts to
> ABIFHKZE.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.msg=%{rule.id}-%{rule.msg}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.id}
> to: 900011
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.msg}
> to: Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
> "900011-Detects specific directory and path traversal".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.anomaly_score=+%{tx.critical_anomaly_score}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
> variable: tx.anomaly_score = "10"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{tx.critical_anomaly_score} to: 21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
> anomaly_score=10+21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.anomaly_score" to "31".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
> to: 900011-Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{matched_var_name} to: ARGS:bar
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0} to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.900011-Detects specific directory and path
> traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
> "(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
> p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-w
> orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
> [line "101"] [id "900011"] [msg "Detects specific directory and path
> traversal"] [data "/home/"] [severity "CRITICAL"] [tag "WEB_ATTACK/DT"]
> [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) cssDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) jsDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) htmlEntityDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) replaceComments:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) compressWhitespace:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) lowercase:
> "/en_us/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 1969 usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
> with param
> "(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
> v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
> |\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
> ARGS:bar.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
> "/en_us/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
> to TX.0: /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex subexpression
> to TX.1: home
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 64
> usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts to
> ABIFHKZEE.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.msg=%{rule.id}-%{rule.msg}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.id}
> to: 900011
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{rule.msg}
> to: Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
> "900011-Detects specific directory and path traversal".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.anomaly_score=+%{tx.critical_anomaly_score}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
> variable: tx.anomaly_score = "31"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{tx.critical_anomaly_score} to: 21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
> anomaly_score=31+21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.anomaly_score" to "52".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
> to: 900011-Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{matched_var_name} to: ARGS:bar
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0} to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.900011-Detects specific directory and path
> traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0} to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
> "(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
> p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-w
> orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
> [line "101"] [id "900011"] [msg "Detects specific directory and path
> traversal"] [data "/home/"] [severity "CRITICAL"] [tag "WEB_ATTACK/DT"]
> [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 2 usec.
>
> Thank you,
> -Jason Martin
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

-- 
Sent from my mobile device

Ryan C. Barnett
SANS Certified Instructor
WASC Web Hacking Incident Database Project Leader
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
http://tacticalwebappsec.blogspot.com/

From JM9991 at att.com  Thu Aug  5 17:41:41 2010
From: JM9991 at att.com (MARTIN, JASON (ATTSI))
Date: Thu, 5 Aug 2010 14:41:41 -0700
Subject: [Owasp-modsecurity-core-rule-set] 900011 double-counting
In-Reply-To: <AANLkTi=4hqG+vB=GemistUiVsPWP8EEvAhSrDWtSZec0@mail.gmail.com>
References: <5889717B8EF90049926E1B6B68E220140D78ACDF@BD01MSXMB018.US.Cingular.Net>
	<AANLkTi=4hqG+vB=GemistUiVsPWP8EEvAhSrDWtSZec0@mail.gmail.com>
Message-ID: <5889717B8EF90049926E1B6B68E220140D78ADAB@BD01MSXMB018.US.Cingular.Net>

In my 10 config I have:

SecAction "phase:1,t:none,nolog,pass,setvar:tx.paranoid_mode=0"

-Jason Martin


-----Original Message-----
From: Ryan Barnett [mailto:rcbarnett at gmail.com] 
Sent: Thursday, August 05, 2010 2:38 PM
To: MARTIN, JASON (ATTSI);
owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] 900011 double-counting

I believe this is caused be "paranoid_mode" being set to 1 in the 10
conf file.  This mode checks the sigs against variables that are prone
to higher false positive rates.

I am fixing the logic in the next phpids filters file version so that
it will skip the paparoind check if the initial rule matches.


On 8/5/10, MARTIN, JASON (ATTSI) <JM9991 at att.com> wrote:
> Hello, I am trying to figure out why arule 900011 rule seems to be
being
> 'double-counted' against the anomaly score. Rule 900011 is triggering
> twice on the same value; /home/ appears once in the argument but it
> triggers twice. Any ideas why this is happening?
>
> When I add a counter-rule to reduce the score (as this behavior is ok
> for my site), it fires only once and so the score is too high.
>
> This is with CRS 2.0.7 (patched with
>
https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-J
> une/000398.html) , mod_security  2.5.12, apache 2.2.15, Solaris 10
> SPARC.
>
> --00002f18-A--
> [05/Aug/2010:12:22:10 --0700] TFsPYQoWATMAAGRfQSYAAADP x.x.x.x x.x.x.x
> --00002f18-B--
> GET /foo?bar=/en_US/home/default.xml&modsecdebug=taps HTTP/1.1
> User-Agent: curl/7.19.4 (i386-pc-solaris2.11) libcurl/7.19.4
> OpenSSL/0.9.8a zlib/1.2.3 libidn/1.9
> Host: example.com
> Accept: */*
> Cache-Control: max-stale=0
> Connection: Keep-Alive
>
> --00002f18-F--
> HTTP/1.1 404 Not Found
> Content-Length: 201
> Keep-Alive: timeout=30, max=187
> Connection: Keep-Alive
> Content-Type: text/html; charset=iso-8859-1
>
> --00002f18-H--
> Message: Matched phrase "curl" at REQUEST_HEADERS:User-Agent. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_35_bad_robots.conf"] [line "26"] [id "990012"] [rev
> "2.0.7"] [msg "Rogue web site crawler"] [data "curl"] [severity
> "WARNING"] [tag "AUTOMATION/MALICIOUS"] [tag "WASCTC/WASC-21"] [tag
> "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
> "Detects specific directory and path traversal"] [data "/home/"]
> [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
> "WEB_ATTACK/LFI"]
> Message: Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
> "Detects specific directory and path traversal"] [data "/home/"]
> [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
> "WEB_ATTACK/LFI"]
> Message: Operator GE matched 21 at TX:anomaly_score. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_49_inbound_blocking.conf"] [line "18"] [msg "Inbound
> Anomaly Score Exceeded (Total Score: 52, SQLi=, XSS=): 900011-Detects
> specific directory and path traversal"]
> Message: Warning. Operator GE matched 21 at TX:inbound_anomaly_score.
> [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_60_correlation.conf"] [line "35"] [msg "Inbound Anomaly
> Score Exceeded (Total Inbound Score: 52, SQLi=, XSS=): 900011-Detects
> specific directory and path traversal"]
> Apache-Error: [file "core.c"] [line 3648] [level 3] File does not
exist:
> /sites/www-site/www/foo
> Stopwatch: 1281036129731407 461977 (5100 459965 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/);
> core ruleset/2.0.7.
> Server: Apache
>
> --00002f18-K--
> SecAction
>
"phase:1,auditlog,t:none,pass,nolog,initcol:global=global,initcol:ip=%{r
> emote_addr}"
> SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.paranoid_mode=0"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_leve
> l=21"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_lev
> el=15"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.critical_anomaly_score=21,
>
setvar:tx.error_anomaly_score=15,setvar:tx.warning_anomaly_score=10,setv
> ar:tx.notice_anomaly_score=5"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_num_args=255"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_file_size=1048576"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.combined_file_sizes=104857
> 6"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:'tx.allowed_methods=GET
HEAD
>
POST',setvar:'tx.allowed_request_content_type=application/x-www-form-url
> encoded multipart/form-data text/xml
> application/xml',setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0
> HTTP/1.1',setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/
> .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/
.cs/
> .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/
> .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
> .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/
.vbproj/
> .vsdisco/ .webinfo/ .xsd/
> .xsx/',setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
> /Content-Range/ /Translate/ /via/ /if/'"
> SecRule "ARGS:modsecdebug" "@rx taps"
> "phase:2,log,auditlog,pass,ctl:debugLogLevel=9"
> SecRule "REQUEST_METHOD" "@rx ^(?:GET|HEAD)$"
> "phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'GET or HEAD
> requests with
>
bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION,tag:WASCTC/W
>
ASC-21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,tag:http://www.w3.org/Protocol
> s/rfc2616/rfc2616-sec4.html#sec4.3"
> SecRule "&REQUEST_HEADERS:Pragma" "@eq 1"
> "phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Pragma Header
> requires Cache-Control Header for HTTP/1.1
>
requests.',severity:5,id:960020,tag:PROTOCOL_VIOLATION/INVALID_HREQ,tag:
> http://www.bad-behavior.ioerror.us/documentation/how-it-works/"
> SecRule "&REQUEST_HEADERS:Content-Type" "@eq 0"
> "phase:2,pass,chain,rev:2.0.7,t:none,nolog,auditlog,msg:'Request
> Containing Content, but Missing Content-Type
> header',id:960904,severity:5"
> SecRule "&TX:MAX_NUM_ARGS" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Too many arguments in
> request',id:960335,severity:4,rev:2.0.7"
> SecRule "&TX:MAX_FILE_SIZE" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Uploaded file size too
> large',id:960342,severity:4,rev:2.0.7"
> SecRule "&TX:COMBINED_FILE_SIZES" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Total uploaded files
size
> too large',id:960343,severity:4,rev:2.0.7"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS:User-Agent" "@pmFromFile
> modsecurity_35_bad_robots.data"
> "phase:2,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Rogue web site
>
crawler',id:990012,tag:AUTOMATION/MALICIOUS,tag:WASCTC/WASC-21,tag:OWASP
>
_TOP_10/A7,tag:PCI/6.5.10,severity:4,capture,logdata:%{TX.0},setvar:tx.m
>
sg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setv
>
ar:tx.automation_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}
> -AUTOMATION/MALICIOUS-%{matched_var_name}=%{matched_var}"
> SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
> modsecurity_40_generic_attacks.data"
>
"phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
> rcase,nolog,pass,setvar:tx.pm_score=+1"
> SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
> modsecurity_40_generic_attacks.data"
>
"phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
> rcase,nolog,pass,setvar:tx.pm_score=+1"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_SESSION_FIXATION"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_FILE_INJECTION"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_COMMAND_ACCESS"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_COMMAND_INJECTION"
> SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
>
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
>
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
>
"phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
>
code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
> s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
>
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
>
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
>
ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
> B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
> SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
>
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
>
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
>
"phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
>
code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
> s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
>
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
>
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
>
ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
> B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,rev:2.0.7,t:none,nolog,skipAfter:END_SQL_INJECTION_WEAK"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_XSS_CHECK"
> SecRule "TX:ANOMALY_SCORE" "@gt 0"
> "phase:2,chain,t:none,nolog,auditlog,block,msg:'Inbound Anomaly Score
> Exceeded (Total Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQLI_SCORE},
> XSS=%{TX.XSS_SCORE}):
>
%{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbound_anomaly_
> score=%{tx.anomaly_score}"
> SecRule "TX:ANOMALY_SCORE" "@ge %{tx.inbound_anomaly_score_level}"
> SecRule "TX:INBOUND_ANOMALY_SCORE" "@gt 0"
> "phase:5,chain,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score
> (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
> SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
> SecRule "TX:INBOUND_ANOMALY_SCORE" "@ge
> %{tx.inbound_anomaly_score_level}"
> "phase:5,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score
Exceeded
> (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
> SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
>
> --00002f18-Z-
>
>
> Section of the debug log showing the duplicate:
>
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Recipe: Invoking rule
> f2bea8; [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"].
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][5] Rule f2bea8: SecRule
> "ARGS|ARGS_NAMES|XML:/*" "@rx
>
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
>
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
> "phase:2,capture,m
>
ultiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDecode,t:replaceComm
>
ents,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,a
> uditlog,msg:'Detects specific directory and path
>
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
>
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
> ar:tx.anomaly_score=+%{tx.cr
>
itical_anomaly_score},setvar:tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched
> _var_name}=%{tx.0}"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Expanded
> "ARGS|ARGS_NAMES|XML:/*" to
> "ARGS:bar|ARGS:modsecdebug|ARGS_NAMES:bar|ARGS_NAMES:modsecdebug".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 2 usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
> with param
>
"(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
>
v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
> |\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
> ARGS:bar.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.0: /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.1: home
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 62
> usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts
to
> ABIFHKZE.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.msg=%{rule.id}-%{rule.msg}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.id}
> to: 900011
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.msg}
> to: Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
> "900011-Detects specific directory and path traversal".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.anomaly_score=+%{tx.critical_anomaly_score}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
> variable: tx.anomaly_score = "10"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{tx.critical_anomaly_score} to: 21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
> anomaly_score=10+21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.anomaly_score" to "31".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
> to: 900011-Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{matched_var_name} to: ARGS:bar
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.900011-Detects specific directory and path
> traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-w
>
orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
> [line "101"] [id "900011"] [msg "Detects specific directory and path
> traversal"] [data "/home/"] [severity "CRITICAL"] [tag
"WEB_ATTACK/DT"]
> [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) cssDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) jsDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) htmlEntityDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) replaceComments:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1)
compressWhitespace:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) lowercase:
> "/en_us/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 1969 usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
> with param
>
"(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
>
v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
> |\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
> ARGS:bar.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
> "/en_us/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.0: /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.1: home
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 64
> usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts
to
> ABIFHKZEE.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.msg=%{rule.id}-%{rule.msg}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.id}
> to: 900011
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.msg}
> to: Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
> "900011-Detects specific directory and path traversal".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.anomaly_score=+%{tx.critical_anomaly_score}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
> variable: tx.anomaly_score = "31"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{tx.critical_anomaly_score} to: 21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
> anomaly_score=31+21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.anomaly_score" to "52".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
> to: 900011-Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{matched_var_name} to: ARGS:bar
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.900011-Detects specific directory and path
> traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-w
>
orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
> [line "101"] [id "900011"] [msg "Detects specific directory and path
> traversal"] [data "/home/"] [severity "CRITICAL"] [tag
"WEB_ATTACK/DT"]
> [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 2 usec.
>
> Thank you,
> -Jason Martin
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

-- 
Sent from my mobile device

Ryan C. Barnett
SANS Certified Instructor
WASC Web Hacking Incident Database Project Leader
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
http://tacticalwebappsec.blogspot.com/

From rbarnett at trustwave.com  Thu Aug  5 18:34:12 2010
From: rbarnett at trustwave.com (Ryan Barnett)
Date: Thu, 5 Aug 2010 18:34:12 -0400
Subject: [Owasp-modsecurity-core-rule-set] 900011 double-counting
In-Reply-To: <5889717B8EF90049926E1B6B68E220140D78ADAB@BD01MSXMB018.US.Cingular.Net>
References: <5889717B8EF90049926E1B6B68E220140D78ACDF@BD01MSXMB018.US.Cingular.Net>
	<AANLkTi=4hqG+vB=GemistUiVsPWP8EEvAhSrDWtSZec0@mail.gmail.com>,
	<5889717B8EF90049926E1B6B68E220140D78ADAB@BD01MSXMB018.US.Cingular.Net>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9FB54457B@MONET.utopiasystems.net>

Hmm right I see that now in your audit log.  This may actually be due to the use of "multiMatch" in the action settings along with the fact that it probably inheriting the "pass" action from block.  This means that even if/when a match is found, it is going to do re-checks after each transformation function is applied.

We were trying to balance false positives with false negatives with the phpids rules.  The issue we found previously was that if we only apply the operator check *after* all tfns are run then there is a false negative issue with say SQLi attacks that use SQL comments.  So, we tried to combat that with applying many tfns and using multiMatch however it appears that there are some issues as you are encountering.  We will take a closer look at the concept of normalization of input data before applying operators.

I have actually started playing a bit with Lua in order to try and apply the same types of normalization that is done in the PHPIDS project.  I hope to have some BETA code out for everyone to test soon.

-Ryan


________________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of MARTIN, JASON (ATTSI) [JM9991 at att.com]
Sent: Thursday, August 05, 2010 5:41 PM
To: Ryan Barnett; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] 900011 double-counting

In my 10 config I have:

SecAction "phase:1,t:none,nolog,pass,setvar:tx.paranoid_mode=0"

-Jason Martin


-----Original Message-----
From: Ryan Barnett [mailto:rcbarnett at gmail.com]
Sent: Thursday, August 05, 2010 2:38 PM
To: MARTIN, JASON (ATTSI);
owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] 900011 double-counting

I believe this is caused be "paranoid_mode" being set to 1 in the 10
conf file.  This mode checks the sigs against variables that are prone
to higher false positive rates.

I am fixing the logic in the next phpids filters file version so that
it will skip the paparoind check if the initial rule matches.


On 8/5/10, MARTIN, JASON (ATTSI) <JM9991 at att.com> wrote:
> Hello, I am trying to figure out why arule 900011 rule seems to be
being
> 'double-counted' against the anomaly score. Rule 900011 is triggering
> twice on the same value; /home/ appears once in the argument but it
> triggers twice. Any ideas why this is happening?
>
> When I add a counter-rule to reduce the score (as this behavior is ok
> for my site), it fires only once and so the score is too high.
>
> This is with CRS 2.0.7 (patched with
>
https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-J
> une/000398.html) , mod_security  2.5.12, apache 2.2.15, Solaris 10
> SPARC.
>
> --00002f18-A--
> [05/Aug/2010:12:22:10 --0700] TFsPYQoWATMAAGRfQSYAAADP x.x.x.x x.x.x.x
> --00002f18-B--
> GET /foo?bar=/en_US/home/default.xml&modsecdebug=taps HTTP/1.1
> User-Agent: curl/7.19.4 (i386-pc-solaris2.11) libcurl/7.19.4
> OpenSSL/0.9.8a zlib/1.2.3 libidn/1.9
> Host: example.com
> Accept: */*
> Cache-Control: max-stale=0
> Connection: Keep-Alive
>
> --00002f18-F--
> HTTP/1.1 404 Not Found
> Content-Length: 201
> Keep-Alive: timeout=30, max=187
> Connection: Keep-Alive
> Content-Type: text/html; charset=iso-8859-1
>
> --00002f18-H--
> Message: Matched phrase "curl" at REQUEST_HEADERS:User-Agent. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_35_bad_robots.conf"] [line "26"] [id "990012"] [rev
> "2.0.7"] [msg "Rogue web site crawler"] [data "curl"] [severity
> "WARNING"] [tag "AUTOMATION/MALICIOUS"] [tag "WASCTC/WASC-21"] [tag
> "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
> "Detects specific directory and path traversal"] [data "/home/"]
> [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
> "WEB_ATTACK/LFI"]
> Message: Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"] [msg
> "Detects specific directory and path traversal"] [data "/home/"]
> [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"] [tag
> "WEB_ATTACK/LFI"]
> Message: Operator GE matched 21 at TX:anomaly_score. [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_49_inbound_blocking.conf"] [line "18"] [msg "Inbound
> Anomaly Score Exceeded (Total Score: 52, SQLi=, XSS=): 900011-Detects
> specific directory and path traversal"]
> Message: Warning. Operator GE matched 21 at TX:inbound_anomaly_score.
> [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_60_correlation.conf"] [line "35"] [msg "Inbound Anomaly
> Score Exceeded (Total Inbound Score: 52, SQLi=, XSS=): 900011-Detects
> specific directory and path traversal"]
> Apache-Error: [file "core.c"] [line 3648] [level 3] File does not
exist:
> /sites/www-site/www/foo
> Stopwatch: 1281036129731407 461977 (5100 459965 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/);
> core ruleset/2.0.7.
> Server: Apache
>
> --00002f18-K--
> SecAction
>
"phase:1,auditlog,t:none,pass,nolog,initcol:global=global,initcol:ip=%{r
> emote_addr}"
> SecAction
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.paranoid_mode=0"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_leve
> l=21"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_lev
> el=15"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.critical_anomaly_score=21,
>
setvar:tx.error_anomaly_score=15,setvar:tx.warning_anomaly_score=10,setv
> ar:tx.notice_anomaly_score=5"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_num_args=255"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_file_size=1048576"
> SecAction
>
"phase:1,auditlog,t:none,nolog,pass,setvar:tx.combined_file_sizes=104857
> 6"
> SecAction
> "phase:1,auditlog,t:none,nolog,pass,setvar:'tx.allowed_methods=GET
HEAD
>
POST',setvar:'tx.allowed_request_content_type=application/x-www-form-url
> encoded multipart/form-data text/xml
> application/xml',setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0
> HTTP/1.1',setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/
> .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/
.cs/
> .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/
> .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
> .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/
.vbproj/
> .vsdisco/ .webinfo/ .xsd/
> .xsx/',setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
> /Content-Range/ /Translate/ /via/ /if/'"
> SecRule "ARGS:modsecdebug" "@rx taps"
> "phase:2,log,auditlog,pass,ctl:debugLogLevel=9"
> SecRule "REQUEST_METHOD" "@rx ^(?:GET|HEAD)$"
> "phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'GET or HEAD
> requests with
>
bodies',severity:2,id:960011,tag:PROTOCOL_VIOLATION/EVASION,tag:WASCTC/W
>
ASC-21,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,tag:http://www.w3.org/Protocol
> s/rfc2616/rfc2616-sec4.html#sec4.3"
> SecRule "&REQUEST_HEADERS:Pragma" "@eq 1"
> "phase:2,chain,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Pragma Header
> requires Cache-Control Header for HTTP/1.1
>
requests.',severity:5,id:960020,tag:PROTOCOL_VIOLATION/INVALID_HREQ,tag:
> http://www.bad-behavior.ioerror.us/documentation/how-it-works/"
> SecRule "&REQUEST_HEADERS:Content-Type" "@eq 0"
> "phase:2,pass,chain,rev:2.0.7,t:none,nolog,auditlog,msg:'Request
> Containing Content, but Missing Content-Type
> header',id:960904,severity:5"
> SecRule "&TX:MAX_NUM_ARGS" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Too many arguments in
> request',id:960335,severity:4,rev:2.0.7"
> SecRule "&TX:MAX_FILE_SIZE" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Uploaded file size too
> large',id:960342,severity:4,rev:2.0.7"
> SecRule "&TX:COMBINED_FILE_SIZES" "@eq 1"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'Total uploaded files
size
> too large',id:960343,severity:4,rev:2.0.7"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS_NAMES" "@rx ^(.*)$"
> "phase:2,chain,t:none,pass,nolog,auditlog,msg:'HTTP header is
restricted
> by
>
policy',id:960038,tag:POLICY/HEADER_RESTRICTED,tag:POLICY/FILES_NOT_ALLO
>
WED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A7,tag:PCI/12.1,tag:WASCTC/WASC-
>
15,tag:OWASP_TOP_10/A7,tag:PCI/12.1,severity:4,logdata:%{matched_var},ca
> pture,setvar:tx.header_name='/%{tx.0}/'"
> SecRule "REQUEST_HEADERS:User-Agent" "@pmFromFile
> modsecurity_35_bad_robots.data"
> "phase:2,rev:2.0.7,t:none,pass,nolog,auditlog,msg:'Rogue web site
>
crawler',id:990012,tag:AUTOMATION/MALICIOUS,tag:WASCTC/WASC-21,tag:OWASP
>
_TOP_10/A7,tag:PCI/6.5.10,severity:4,capture,logdata:%{TX.0},setvar:tx.m
>
sg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setv
>
ar:tx.automation_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}
> -AUTOMATION/MALICIOUS-%{matched_var_name}=%{matched_var}"
> SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
> modsecurity_40_generic_attacks.data"
>
"phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
> rcase,nolog,pass,setvar:tx.pm_score=+1"
> SecRule "REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*" "@pmFromFile
> modsecurity_40_generic_attacks.data"
>
"phase:2,rev:2.0.7,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
> rcase,nolog,pass,setvar:tx.pm_score=+1"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_SESSION_FIXATION"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_FILE_INJECTION"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_COMMAND_ACCESS"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_COMMAND_INJECTION"
> SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
>
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
>
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
>
"phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
>
code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
> s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
>
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
>
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
>
ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
> B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
> SecRule "ARGS|ARGS_NAMES|XML:/*" "@rx
>
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
>
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
>
"phase:2,capture,multiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDe
>
code,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogPart
> s=+E,block,nolog,auditlog,msg:'Detects specific directory and path
>
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
>
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
>
ar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{tx.msg}-WE
> B_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,rev:2.0.7,t:none,nolog,skipAfter:END_SQL_INJECTION_WEAK"
> SecRule "TX:PARANOID_MODE" "!@eq 1"
> "phase:2,t:none,nolog,skipAfter:END_XSS_CHECK"
> SecRule "TX:ANOMALY_SCORE" "@gt 0"
> "phase:2,chain,t:none,nolog,auditlog,block,msg:'Inbound Anomaly Score
> Exceeded (Total Score: %{TX.ANOMALY_SCORE}, SQLi=%{TX.SQLI_SCORE},
> XSS=%{TX.XSS_SCORE}):
>
%{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg},setvar:tx.inbound_anomaly_
> score=%{tx.anomaly_score}"
> SecRule "TX:ANOMALY_SCORE" "@ge %{tx.inbound_anomaly_score_level}"
> SecRule "TX:INBOUND_ANOMALY_SCORE" "@gt 0"
> "phase:5,chain,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score
> (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
> SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
> SecRule "TX:INBOUND_ANOMALY_SCORE" "@ge
> %{tx.inbound_anomaly_score_level}"
> "phase:5,t:none,log,noauditlog,pass,msg:'Inbound Anomaly Score
Exceeded
> (Total Inbound Score: %{TX.INBOUND_ANOMALY_SCORE},
> SQLi=%{TX.SQLI_SCORE}, XSS=%{TX.XSS_SCORE}): %{tx.inbound_tx_msg}'"
>
> --00002f18-Z-
>
>
> Section of the debug log showing the duplicate:
>
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Recipe: Invoking rule
> f2bea8; [file
>
"/sites/www-site/APACHE/httpd-2.2.15-worker-niagara/conf/modsecurity2/mo
> dsecurity_crs_41_phpids_filters.conf"] [line "101"] [id "900011"].
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][5] Rule f2bea8: SecRule
> "ARGS|ARGS_NAMES|XML:/*" "@rx
>
(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev
>
|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/|
> \\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)"
> "phase:2,capture,m
>
ultiMatch,t:none,t:cssDecode,t:jsDecode,t:htmlEntityDecode,t:replaceComm
>
ents,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,a
> uditlog,msg:'Detects specific directory and path
>
traversal',id:900011,tag:WEB_ATTACK/DT,tag:WEB_ATTACK/ID,tag:WEB_ATTACK/
>
LFI,logdata:%{TX.0},severity:2,setvar:tx.msg=%{rule.id}-%{rule.msg},setv
> ar:tx.anomaly_score=+%{tx.cr
>
itical_anomaly_score},setvar:tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched
> _var_name}=%{tx.0}"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Expanded
> "ARGS|ARGS_NAMES|XML:/*" to
> "ARGS:bar|ARGS:modsecdebug|ARGS_NAMES:bar|ARGS_NAMES:modsecdebug".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 2 usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
> with param
>
"(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
>
v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
> |\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
> ARGS:bar.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.0: /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.1: home
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 62
> usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts
to
> ABIFHKZE.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.msg=%{rule.id}-%{rule.msg}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.id}
> to: 900011
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.msg}
> to: Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
> "900011-Detects specific directory and path traversal".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.anomaly_score=+%{tx.critical_anomaly_score}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
> variable: tx.anomaly_score = "10"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{tx.critical_anomaly_score} to: 21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
> anomaly_score=10+21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.anomaly_score" to "31".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
> to: 900011-Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{matched_var_name} to: ARGS:bar
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.900011-Detects specific directory and path
> traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-w
>
orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
> [line "101"] [id "900011"] [msg "Detects specific directory and path
> traversal"] [data "/home/"] [severity "CRITICAL"] [tag
"WEB_ATTACK/DT"]
> [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) cssDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) jsDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) htmlEntityDecode:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) replaceComments:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1)
compressWhitespace:
> "/en_US/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] T (1) lowercase:
> "/en_us/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 1969 usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Executing operator "rx"
> with param
>
"(?:%c0%ae\\/)|(?:(?:\\/|\\\\)(home|conf|usr|etc|proc|opt|s?bin|local|de
>
v|tmp|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\\/
> |\\\\))|(?:(?:\\/|\\\\)inetpub|localstart\\.asp|boot\\.ini)" against
> ARGS:bar.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Target value:
> "/en_us/home/default.xml"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.0: /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Added regex
subexpression
> to TX.1: home
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Operator completed in 64
> usec.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Ctl: Set auditLogParts
to
> ABIFHKZEE.
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.msg=%{rule.id}-%{rule.msg}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.id}
> to: 900011
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
%{rule.msg}
> to: Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable "tx.msg" to
> "900011-Detects specific directory and path traversal".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.anomaly_score=+%{tx.critical_anomaly_score}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Original collection
> variable: tx.anomaly_score = "31"
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{tx.critical_anomaly_score} to: 21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Relative change:
> anomaly_score=31+21
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.anomaly_score" to "52".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Setting variable:
> tx.%{tx.msg}-WEB_ATTACK/INJECTION-%{matched_var_name}=%{tx.0}
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.msg}
> to: 900011-Detects specific directory and path traversal
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro
> %{matched_var_name} to: ARGS:bar
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{tx.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Set variable
> "tx.900011-Detects specific directory and path
> traversal-WEB_ATTACK/INJECTION-ARGS:bar" to "/home/".
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][9] Resolved macro %{TX.0}
to:
> /home/
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Warning. Pattern match
>
"(?:%c0%ae\/)|(?:(?:\/|\\)(home|conf|usr|etc|proc|opt|s?bin|local|dev|tm
>
p|kern|[br]oot|sys|system|windows|winnt|program|%[a-z_-]{3,}%)(?:\/|\\))
> |(?:(?:\/|\\)inetpub|localstart\.asp|boot\.ini)" at ARGS:bar. [file
> "/sites/www-site/APACHE/httpd-2.2.15-w
>
orker-niagara/conf/modsecurity2/modsecurity_crs_41_phpids_filters.conf"]
> [line "101"] [id "900011"] [msg "Detects specific directory and path
> traversal"] [data "/home/"] [severity "CRITICAL"] [tag
"WEB_ATTACK/DT"]
> [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
> [05/Aug/2010:12:22:09 --0700]
> [example.com/sid#9bbf8][rid#1ab32d8][/foo][4] Transformation completed
> in 2 usec.
>
> Thank you,
> -Jason Martin
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

--
Sent from my mobile device

Ryan C. Barnett
SANS Certified Instructor
WASC Web Hacking Incident Database Project Leader
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
http://tacticalwebappsec.blogspot.com/
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From kuba at comgate.cz  Thu Aug 19 00:51:04 2010
From: kuba at comgate.cz (Jakub Ouhrabka)
Date: Thu, 19 Aug 2010 06:51:04 +0200
Subject: [Owasp-modsecurity-core-rule-set] CRS and json
Message-ID: <4C6CB838.2000104@comgate.cz>

Hi,

I'm a modsecurity/crs newbie. I like both projects very much!

I have one question though: How to cope with json in POST requests to 
the server, e.g.

{"requiredMessages":[{"contactID":"86","lastInGot":null,"lastOutGot":null},{"contactID":"85","lastInGot":null,"lastOutGot":null},{"contactID":"90","lastInGot":null,"lastOutGot":null}],"readMessages":[],"userEvents":[{"eventID":"2","eventName":"openTab","eventParam":86},{"eventID":"3","eventName":"openTab","eventParam":85},{"eventID":"4","eventName":"openTab","eventParam":90}]}

I tried the request here:

http://www.modsecurity.org/demo/
http://demo.php-ids.org/

Modsecurity always blocks the request - due to rules imported from 
php-ids. But when trying on php-ids website with checked json checkbox 
the request is considered ok.

Is it possible to detect json requests in modsecurity/crs automatically? 
Or should I mark them somehow, e.g. add request header, use only special 
variable name jsondata?

When the json request is detected is it possible to process it the same 
way as php-ids would do it?

Looking in the source code of php-ids, I think that when it detects json 
data (using variable name) it first decodes it and then it's processed 
by rules. Would it be possible to do the same in modsecurity?

Thanks,

Kuba

From Ryan.Barnett at breach.com  Thu Aug 19 15:55:11 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 19 Aug 2010 12:55:11 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-40)
 tx.restricted_headers partial string comparison
Message-ID: <25274149.738.1282247711692.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-40?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-40.
-----------------------------------

    Fix Version/s: 2.0.7
       Resolution: Fixed

Fixed the issue by specifying /../ separators around payloads.  Fixed in CRS v.2.0.7

> tx.restricted_headers partial string comparison
> -----------------------------------------------
>
>                 Key: CORERULES-40
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-40
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>    Affects Versions: 2.0.6
>         Environment: CRS 2.0.6
> Apache 2.2.15
> ModSecurity 2.5.12
>            Reporter: Colin Watson
>            Assignee: Ryan Barnett
>             Fix For: 2.0.7
>
>
> In modsecurity_crs_10_config.conf, the suggested configuration for tx.restricted_headers is:
> setvar:'tx.restricted_headers=Proxy-Connection Lock-Token Content-Range Translate via if'"
> The header name "Connection" seems to be matched by:
> SecRule REQUEST_HEADERS_NAMES "@within %{tx.restricted_headers}" "phase:2,t:none,pass,nolog,auditlog,msg:'HTTP header is restricted by policy',id:'960038',tag:'POLICY/HEADER_RESTRICTED',tag:'POLICY/FILES_NOT_ALLOWED',tag:'WASCTC/WASC-21',tag:'OWASP_TOP_10/A7',tag:'PCI/12.1',tag:'WASCTC/WASC-15',tag:'OWASP_TOP_10/A7',tag:'PCI/12.1',severity:'4',logdata:'%{matched_var}',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.policy_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}-POLICY/HEADERS_RESTRICTED-%{matched_var_name}=%{matched_var}" 
> in modsecurity_crs_30_http_policy.conf.  Although tx.restricted_headers could be edited, should the shorter actual header name be matching part of the longer restricted header name or could a more exact match be specified?
> --29000000-B--
> GET / HTTP/1.0
> User-Agent: Mozilla/4.0 (**********)
> Host: ****************
> Connection: Keep-Alive
> --29000000-H--
> Message: String match within "Proxy-Connection Lock-Token Content-Range Translate via if" at REQUEST_HEADERS_NAMES:Connection. [file "*********/base_rules/modsecurity_crs_30_http_policy.conf"] [line "99"] [id "960038"] [msg "HTTP header is restricted by policy"] [data "Connection"] [severity "WARNING"] [tag "POLICY/HEADER_RESTRICTED"] [tag "POLICY/FILES_NOT_ALLOWED"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/12.1"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/12.1"]

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Thu Aug 19 15:57:11 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 19 Aug 2010 12:57:11 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-41)
 Typo in regexp in modsecurity_crs_41_sql_injection_attacks.conf
Message-ID: <12857663.746.1282247831598.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-41?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-41.
-----------------------------------

    Fix Version/s: 2.0.7
       Resolution: Fixed

Fixed in CRS v2.0.7

> Typo in regexp in modsecurity_crs_41_sql_injection_attacks.conf
> ---------------------------------------------------------------
>
>                 Key: CORERULES-41
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-41
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>          Components: Configuration
>    Affects Versions: 2.0.6
>            Reporter: Sampo Niskanen
>            Assignee: Ryan Barnett
>             Fix For: 2.0.7
>
>
> Line 66 in modsecurity_crs_41_sql_injection_attacks.conf reads:
>         SecRule REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/* "\bselect\b.{0,40}buser\b" \
> Based on the other rules I assume this should read:
>         SecRule REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/* "\bselect\b.{0,40}\buser\b" \
> (Matching "user" instead of "buser")

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From jiangtianbin-1st at 163.com  Thu Aug 19 22:59:18 2010
From: jiangtianbin-1st at 163.com (=?gbk?B?va3M7bH2?=)
Date: Fri, 20 Aug 2010 10:59:18 +0800 (CST)
Subject: [Owasp-modsecurity-core-rule-set] modsecurity rule make the apache
	can't restart
Message-ID: <155933f.b359.12a8d6fa3f9.Coremail.jiangtianbin-1st@163.com>

hi , I am a newbie of modsecurity , nowadays, I get some intersests in modsecurity, However, I got some problems:
whenever I modified the apache/conf/httpd.conf with the following lines:
<LoadModule mod_security.so>
Include apache/extra/modsecurity/*. conf
</LoadModule>
than,the apache can't restart
the cirumscribe is centos / apache 2.7.0 modsecurity 2.5
I installed the apache in the way of source code. is there something wrong with the  way that I installed?
 Thanks! 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100820/d0b59e7f/attachment.html 

From jamuse at gmail.com  Fri Aug 20 07:06:20 2010
From: jamuse at gmail.com (Jamuse)
Date: Fri, 20 Aug 2010 14:06:20 +0300
Subject: [Owasp-modsecurity-core-rule-set] modsecurity rule make the
 apache can't restart
In-Reply-To: <AANLkTinZvmftVeikvNy78OjR=de7K1ie5EyuYZz_1ZKc@mail.gmail.com>
References: <155933f.b359.12a8d6fa3f9.Coremail.jiangtianbin-1st@163.com>
	<AANLkTinZvmftVeikvNy78OjR=de7K1ie5EyuYZz_1ZKc@mail.gmail.com>
Message-ID: <AANLkTin_3UEt0s3CEDmfxqAKAJcsaV2BJtLwqV-3gdp=@mail.gmail.com>

What error message do you receive when you restart Apache?

--
- Josh

On Aug 20, 2010 5:59 AM, "???" <jiangtianbin-1st at 163.com> wrote:

hi , I am a newbie of modsecurity , nowadays, I get some intersests in
modsecurity, However, I got some problems:
whenever I modified the apache/conf/httpd.conf with the following lines:
<LoadModule mod_security.so>
Include apache/extra/modsecurity/*. conf
</LoadModule>
than,the apache can't restart
the cirumscribe is centos / apache 2.7.0 modsecurity 2.5
I installed the apache in the way of source code. is there something wrong
with the  way that I installed?
 Thanks!


------------------------------
??????????????? <http://mail.163.com/?from=fe1>
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100820/dd4a30cb/attachment.html 

From RBarnett at trustwave.com  Tue Aug 24 15:31:32 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 24 Aug 2010 14:31:32 -0500
Subject: [Owasp-modsecurity-core-rule-set] New Blog Post Series: ModSecurity
	Advanced Feature of the Week
Message-ID: <C8999654.12E73%rbarnett@trustwave.com>

Greetings everyone,
We are starting a new blog post series on the ModSecurity site called "Advanced Feature of the Week" where we will be highlighting many of ModSecurity's really cool capabilities.  These are the features that seldom used or fully understood by the average ModSecurity user however can provide detection of sophisticated attacks if used properly.  It is our goal with these blog posts to help shed light on these unique features and to provide some real-world, in-the-trenches gotchas for successful usage of these features.

This blog post series will have the following major topic sections -
1) ModSecurity Reference Manual Information
Provide reference manual data.

2) Use Within the OWASP Core Rule Set (CRS)
Outline if/when/how the CRS is utilizing this feature.

3) So What?
Will provide some context as to why you as a user should even care about this capability.  What advanced attack/vulnerability is this attempting to catch.

This week's feature is on the use of the @validateByteRange <http://www.modsecurity.org/documentation/modsecurity-apache/2.5.12/modsecurity2-apache-reference.html#N11E29>  operator.

http://blog.modsecurity.org/2010/08/advanced-feature-of-the-week-validating-byte-ranges.html

Enjoy,
Ryan


From Ryan.Barnett at breach.com  Wed Aug 25 09:39:13 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Wed, 25 Aug 2010 06:39:13 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-29)
 File with .cookie in the name are blocked
Message-ID: <31379215.756.1282743553329.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-29?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-29.
-----------------------------------

    Resolution: Fixed

Fixed in CRS v2.0.8 to be released soon.  Updated XSS rule id 958001 to improve the .cookie regex to reduce false postives

> File with .cookie in the name are blocked
> -----------------------------------------
>
>                 Key: CORERULES-29
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-29
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>          Components: False positive
>            Reporter: Miquel Rodriguez Telep
>            Assignee: Ryan Barnett
>         Attachments: modsec_cookie_rule.txt
>
>
> Mod_security blocks requests for files with ".cookie" in the filename, e.g. jquery.cookie.js. See http://drupal.org/node/522646 for comments from others affected by this.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Wed Aug 25 10:00:11 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Wed, 25 Aug 2010 07:00:11 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-44)
 Spurious modsecurity_crs_49_enforcement.conf
Message-ID: <23156683.764.1282744811373.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-44?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-44.
-----------------------------------

    Resolution: Fixed

Removed this file from SVN.

> Spurious modsecurity_crs_49_enforcement.conf
> --------------------------------------------
>
>                 Key: CORERULES-44
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-44
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>    Affects Versions: 2.0.6
>         Environment: All
>            Reporter: Thomas
>            Assignee: Ryan Barnett
>
> The modsecurity_crs_49_enforcement.conf in CRS 2.0.6 is overlapping with modsecurity_crs_49_inbound_blocking.conf

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Wed Aug 25 10:08:12 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Wed, 25 Aug 2010 07:08:12 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-27)
	WordPress website is blocked
Message-ID: <7873371.776.1282745292540.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-27?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-27.
-----------------------------------

    Resolution: Fixed

Suggest that you do not run the phpids filters in PARANOID_MODE.  These false positives are due to inspecting the REQUEST_URI_RAW variable which is more prone to false positives.

> WordPress website is blocked
> ----------------------------
>
>                 Key: CORERULES-27
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-27
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>         Environment: CentOS Apache
>            Reporter: LaoWei
>            Assignee: Ryan Barnett
>            Priority: High
>
> The new core rules block WordPress Website.
> Core rules version: 2.0.3 released with ModSecurity v2.5.11 
> File: modsecurity_crs_41_phpids_filters.conf
> Line: 42
> block url with domain, content, etc.
> e.g.
> http://www.domain.com/wp-content//themes/mythemes/style.css
> http://www.domain.com/category/domain
> Line 51
> block url with windows, etc
> e.g.
> http://www.domain.com/category/windows
> Line: 97
> block url: /wp-admin/comment.php
> I suggest to do more tests for modsecurity_crs_41_phpids_filters.conf file.
> Thanks.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Wed Aug 25 13:45:12 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Wed, 25 Aug 2010 10:45:12 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-18)
 rule 959006 incorrectly matches id; in User-Agent headers
Message-ID: <12109013.790.1282758312331.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-18?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-18.
-----------------------------------

    Resolution: Won't Fix

This is matching due to the "; id" data in the UA string.  You can either disable PARANOID_MODE or edit the rule to exclude checking the REQUEST_HEADERS:User-Agent variable

> rule 959006 incorrectly matches id; in User-Agent headers
> ---------------------------------------------------------
>
>                 Key: CORERULES-18
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-18
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>            Reporter: Lubomir Filipov
>            Assignee: Ryan Barnett
>
>  User agent with following identity "Mozilla/5.0 (Windows; U; Windows NT 5.1; id; rv:1.9.1.3) Gecko/200908 24 YFF35 Firefox/3.5.3" will match to 959006 rule. I change the regexp from "... (?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?: ..." to "... (?:xte)?rm|ls(?:of)?|telnet|uname|echo)\b|id(?!\;\srv\:)\b|g(?: ...", but there is possibility if attacker add "; rv:" after id to bypass this rule.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Thu Aug 26 11:44:15 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 26 Aug 2010 08:44:15 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-24)
 CoreRuleset not working on my server
Message-ID: <21179465.844.1282837455987.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-24?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-24.
-----------------------------------

    Resolution: Invalid Config

The previous recommendations should work - make sure that you are only calling up the .conf files which using wildcarding.

> CoreRuleset not working on my server
> ------------------------------------
>
>                 Key: CORERULES-24
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-24
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>         Environment: Ubuntu 9.04 LAMP server
>            Reporter: will brooks
>            Assignee: Ryan Barnett
>            Priority: High
>
> When I attempt to upgrade core ruleset from 1.6.1 to 2.0.3 I get the following error and apache will not start.
> * We failed to correctly shutdown apache, so we're now killing all running apache processes. This is almost certainly suboptimal, so please make sure your system is working as you'd expect now!
>  ... waiting apache2: Syntax error on line 56 of /etc/apache2/apache2.conf: Syntax error on line 132 of /etc/apache2/conf.d/mod_security/base_rules/modsecurity_40_generic_attacks.data: /etc/apache2/conf.d/mod_security/base_rules/modsecurity_40_generic_attacks.data:170: <input> was not closed.\n/etc/apache2/conf.d/mod_security/base_rules/modsecurity_40_generic_attacks.data:132: <![cdata[> was not closed.
> Here is my config file. I had read online that I may need to explicitly declare each file, so I did. It also failed when I used *conf as instructed to do on owasp website.
> <ifmodule mod_security2.c>
> #	Include conf.d/mod_security/*conf
> #	Include conf/mod_security/base_rules/*conf
> 	Include conf.d/mod_security/modsecurity_crs_10_config.conf
> 	Include conf.d/mod_security/modsecurity_crs_10_global_config.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_15_customrules.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_20_protocol_violations.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_21_protocol_anomalies.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_23_request_limits.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_30_http_policy.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_35_bad_robots.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_40_generic_attacks.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_41_phpids_filters.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_41_sql_injection_attacks.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_41_xss_attacks.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_45_trojans.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_46_et_sql_injection.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_46_et_web_rules.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_47_common_exceptions.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_48_local_exceptions.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_49_enforcement.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_50_outbound.conf
> 	Include conf.d/mod_security/base_rules/modsecurity_crs_60_correlation.conf
> 	
> </ifmodule>

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Thu Aug 26 11:49:12 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 26 Aug 2010 08:49:12 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-42)
	Out-of-range IDs
Message-ID: <20838464.853.1282837752538.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-42?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-42.
-----------------------------------

    Resolution: Not a Bug

Here is a link to the id data in the reference manual which provides descriptions on the reserved id ranges -

http://www.modsecurity.org/documentation/modsecurity-apache/2.5.12/modsecurity2-apache-reference.html#N118D0

> Out-of-range IDs
> ----------------
>
>                 Key: CORERULES-42
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-42
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>          Components: Configuration
>    Affects Versions: 2.0.6
>            Reporter: Sampo Niskanen
>            Assignee: Ryan Barnett
>
> Performing a
>         grep "id:'[0-9][0-9][0-9][0-9][0-9]'" *
> produces 18 rules that have a wrong ID number (<100000).  Creating a script that checks the ID range and duplicates shouldn't be hard to implement.
> Is the ID usage with the 9xxxxx range documented anywhere?  It would be very useful to be able to exclude certain check types by removing a certain range, but I've found no documentation about it anywhere.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Thu Aug 26 12:45:18 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 26 Aug 2010 09:45:18 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-43)
 CRS blocking requests by default though documented otherwise
Message-ID: <5383125.894.1282841118922.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-43?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-43.
-----------------------------------

    Resolution: Fixed

This issue should be fixed within CRS v2.0.7

> CRS blocking requests by default though documented otherwise
> ------------------------------------------------------------
>
>                 Key: CORERULES-43
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-43
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>          Components: Configuration
>    Affects Versions: 2.0.6
>            Reporter: Sampo Niskanen
>            Assignee: Ryan Barnett
>
> The comments in modsecurity_crs_10_config.conf state that the default action is to log errors and let the request pass.  However, the file modsecurity_crs_49_enforcement.conf contains an uncommented rule that compares the anomaly score to a hard-coded 20 points and denies the request if the threshold is exceeded.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From Ryan.Barnett at breach.com  Thu Aug 26 12:47:12 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Thu, 26 Aug 2010 09:47:12 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-25)
 CRS Filter Bypass - confirmed on new demo page
Message-ID: <3434717.903.1282841232674.JavaMail.jira@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-25?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-25.
-----------------------------------

    Resolution: Fixed

Looks like this one is now caught in the CRS demo.  We are in the process of making updates and will populate it out the CRS demo soon.  We are also planning on using the Demo as a testing ground for new BETA detection rules.

Please keep sending in advanced bypass payloads to the Demo.  Thanks.

> CRS Filter Bypass - confirmed on new demo page
> ----------------------------------------------
>
>                 Key: CORERULES-25
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-25
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>    Affects Versions: 2.0.0
>         Environment: Whatever the Demo page is using.  Browser is latest FF3.5
>            Reporter: David Lindsay
>            Assignee: Ryan Barnett
>
> The following text will fire an alert box when submitted with the demo page's text box.  note that it doesn't work when passed in using the test=<injection> GET parameter, which may or may not be desired behavior.   (one other thing, would be nice in JIRA when submitting a bug if I could select the component as False Negative)
> pastebin link in case JIRA munges the injection:  http://pastebin.ca/1668658
> injection:
> __=''
> $$$$=__+'t(0),1'
> $$$=__
> $$=__+'e'
> __=__+'__par'
> _=$$+'val'
> x1=1+$$$+[]
> z=$$+'nt__'
> x1=x1[__+z]
> x1=x1[_]
> y=x1('aler'+$$$$)
> x1(y)
> 'abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_abc-def=abc-def_'

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

From ryan.barnett at owasp.org  Fri Aug 27 15:38:58 2010
From: ryan.barnett at owasp.org (Ryan Barnett)
Date: Fri, 27 Aug 2010 15:38:58 -0400
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of OWASP
	ModSecurity Core Rule Set (CRS) v2.0.8
Message-ID: <C89D8C92.130F9%ryan.barnett@owasp.org>

Greetings everyone,
I wanted to announce the availability of the OWASP ModSecurity CRS v2.0.8.

DOWNLOADING -
Download page - 
http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Proj
ect#tab=Download
You can also use the util/rules-updater.pl script to auto-download the
latest ZIP archive (see the rules-updater-example.conf file for Repo data).

TESTING -
We have integrated the new CRS into the Demo page to help facilitate
community testing -
http://www.modsecurity.org/demo/

CHANGES -
--------------------------
Version 2.0.8 - 08/27/2010
--------------------------

Improvements:
- Updated the PHPIDS filters
- Updated the SQL Injection filters to detect boolean attacks (1<2, foo ==
bar, etc..)
- Updated the SQL Injection filters to account for different quotes
- Added UTF-8 encoding validation support to the
modsecurity_crs_10_config.conf file
- Added Rule ID 950109 to detect multiple URL encodings
- Added two experimental rules to detect anomalous use of special characters

Bug Fixes:
- Fixed Encoding Detection RegEx (950107 and 950108)
- Fixed rules-updater.pl script to better handle whitespace
  https://www.modsecurity.org/tracker/browse/MODSEC-167
- Fixed missing pass action bug in
modsecurity_crs_21_protocol_anomalies.conf
  https://www.modsecurity.org/tracker/browse/CORERULES-55
- Fixed the anomaly scoring in the modsecurity_crs_41_phpids_filters.conf
file
  https://www.modsecurity.org/tracker/browse/CORERULES-54
- Updated XSS rule id 958001 to improve the .cookie regex to reduce false
postives
  https://www.modsecurity.org/tracker/browse/CORERULES-29


--
Ryan Barnett
OWASP ModSecurity Core Rule Set Project Leader

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100827/0a8afeb7/attachment.html 

From ryan.barnett at owasp.org  Mon Aug 30 11:19:09 2010
From: ryan.barnett at owasp.org (Ryan Barnett)
Date: Mon, 30 Aug 2010 11:19:09 -0400
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity CRS Promoted to
	Release Quality Project
Message-ID: <C8A1442D.133F1%ryan.barnett@owasp.org>

FYI - 
http://blog.modsecurity.org/2010/08/owasp-modsecurity-crs-project-promoted-t
o-release-quality.html

-Ryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100830/c9d9b4f1/attachment.html 

From scastle at bouldercounty.org  Tue Aug 31 16:33:26 2010
From: scastle at bouldercounty.org (Castle, Shane)
Date: Tue, 31 Aug 2010 14:33:26 -0600
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
	OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <C89D8C92.130F9%ryan.barnett@owasp.org>
References: <C89D8C92.130F9%ryan.barnett@owasp.org>
Message-ID: <6009E57E59F29A43B7460CE724C42DF1E4961E@EVS1B.boco.co.boulder.co.us>

The file modsecurity-crs_2.0.8.tar.gz.asc yields "bad signature" when
trying to verify modsecurity-crs_2.0.8.tar.gz, and said tar file won't
extract under RHEL5 :(.

--
Shane Castle
Data Security Mgr, Boulder County IT
GSEC GCIH
303-441-3953

From RBarnett at trustwave.com  Tue Aug 31 16:39:34 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 31 Aug 2010 15:39:34 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
 OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <6009E57E59F29A43B7460CE724C42DF1E4961E@EVS1B.boco.co.boulder.co.us>
Message-ID: <C8A2E0C6.13501%rbarnett@trustwave.com>

On 8/31/10 4:33 PM, "Castle, Shane" <scastle at bouldercounty.org> wrote:

> The file modsecurity-crs_2.0.8.tar.gz.asc yields "bad signature" when
> trying to verify modsecurity-crs_2.0.8.tar.gz,
Hmm... I did export/import my private key into a new gpg install on my new
macbook.  I will check on it.

> and said tar file won't
> extract under RHEL5 :(.
>
Anyone else with problems?  I just downloaded it/extracted it fine.

http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT
/modsecurity-crs_2.0.8.tar.gz/download
 
> --
> Shane Castle
> Data Security Mgr, Boulder County IT
> GSEC GCIH
> 303-441-3953
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 



From brectanu at gmail.com  Tue Aug 31 16:48:18 2010
From: brectanu at gmail.com (Brian Rectanus)
Date: Tue, 31 Aug 2010 13:48:18 -0700
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
 OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <C8A2E0C6.13501%rbarnett@trustwave.com>
References: <6009E57E59F29A43B7460CE724C42DF1E4961E@EVS1B.boco.co.boulder.co.us>
	<C8A2E0C6.13501%rbarnett@trustwave.com>
Message-ID: <AANLkTim4tsbZ9-ZGYkR1PvPZBNugdTkfdoO-eTMtKi5C@mail.gmail.com>

On Tue, Aug 31, 2010 at 1:39 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:
> On 8/31/10 4:33 PM, "Castle, Shane" <scastle at bouldercounty.org> wrote:
>
>> The file modsecurity-crs_2.0.8.tar.gz.asc yields "bad signature" when
>> trying to verify modsecurity-crs_2.0.8.tar.gz,
> Hmm... I did export/import my private key into a new gpg install on my new
> macbook. ?I will check on it.
>
>> and said tar file won't
>> extract under RHEL5 :(.
>>
> Anyone else with problems? ?I just downloaded it/extracted it fine.
>
> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT
> /modsecurity-crs_2.0.8.tar.gz/download


Works fine for me:

$ ls -l modsecurity-crs_2.0.8.tar.gz*
-rw-r--r-- 1 brectanus brectanus 159537 2010-08-31 13:40
modsecurity-crs_2.0.8.tar.gz
-rw-r--r-- 1 brectanus brectanus    495 2010-08-27 10:13
modsecurity-crs_2.0.8.tar.gz.asc

$ gpg --verify modsecurity-crs_2.0.8.tar.gz.asc
$ gpg --verify modsecurity-crs_2.0.8.tar.gz.asc
gpg: Signature made Fri 27 Aug 2010 10:09:55 AM PDT using RSA key ID E6405E38
gpg: Good signature from "Ryan Barnett (CRS Project Lead)
<ryan.barnett at breach.com>"

-B

From RBarnett at trustwave.com  Tue Aug 31 16:50:43 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 31 Aug 2010 15:50:43 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
 OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <AANLkTim4tsbZ9-ZGYkR1PvPZBNugdTkfdoO-eTMtKi5C@mail.gmail.com>
Message-ID: <C8A2E363.1350A%rbarnett@trustwave.com>

On 8/31/10 4:48 PM, "Brian Rectanus" <brectanu at gmail.com> wrote:

> On Tue, Aug 31, 2010 at 1:39 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:
>> On 8/31/10 4:33 PM, "Castle, Shane" <scastle at bouldercounty.org> wrote:
>> 
>>> The file modsecurity-crs_2.0.8.tar.gz.asc yields "bad signature" when
>>> trying to verify modsecurity-crs_2.0.8.tar.gz,
>> Hmm... I did export/import my private key into a new gpg install on my new
>> macbook. ?I will check on it.
>> 
>>> and said tar file won't
>>> extract under RHEL5 :(.
>>> 
>> Anyone else with problems? ?I just downloaded it/extracted it fine.
>> 
>> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT
>> /modsecurity-crs_2.0.8.tar.gz/download
> 
> 
> Works fine for me:
> 
> $ ls -l modsecurity-crs_2.0.8.tar.gz*
> -rw-r--r-- 1 brectanus brectanus 159537 2010-08-31 13:40
> modsecurity-crs_2.0.8.tar.gz
> -rw-r--r-- 1 brectanus brectanus    495 2010-08-27 10:13
> modsecurity-crs_2.0.8.tar.gz.asc
> 
> $ gpg --verify modsecurity-crs_2.0.8.tar.gz.asc
> $ gpg --verify modsecurity-crs_2.0.8.tar.gz.asc
> gpg: Signature made Fri 27 Aug 2010 10:09:55 AM PDT using RSA key ID E6405E38
> gpg: Good signature from "Ryan Barnett (CRS Project Lead)
> <ryan.barnett at breach.com>"
> 
> -B
> 
Shane,
I would suggest that you try downloading it again.  Perhaps the download was
corrupt.

-Ryan




From scastle at bouldercounty.org  Tue Aug 31 16:53:00 2010
From: scastle at bouldercounty.org (Castle, Shane)
Date: Tue, 31 Aug 2010 14:53:00 -0600
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
	OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <AANLkTim4tsbZ9-ZGYkR1PvPZBNugdTkfdoO-eTMtKi5C@mail.gmail.com>
References: <6009E57E59F29A43B7460CE724C42DF1E4961E@EVS1B.boco.co.boulder.co.us><C8A2E0C6.13501%rbarnett@trustwave.com>
	<AANLkTim4tsbZ9-ZGYkR1PvPZBNugdTkfdoO-eTMtKi5C@mail.gmail.com>
Message-ID: <6009E57E59F29A43B7460CE724C42DF1E49623@EVS1B.boco.co.boulder.co.us>

Just to be clear - I am doing the downloading and verifying on a Windows box and then scp-ing it up to my RHEL box. It fails extraction both places, and the verification (gpg4win) is taking place on Windows. Tried downloading using IE8 and Firefox 3.6.8; both fail.

--
Shane Castle
Data Security Mgr, Boulder County IT
GSEC GCIH
303-441-3953


-----Original Message-----
From: Brian Rectanus [mailto:brectanu at gmail.com] 
Sent: Tuesday, August 31, 2010 14:48
To: Ryan Barnett
Cc: Castle, Shane; owasp-modsecurity-core-rule-set at lists.owasp.org; mod-security-users at lists.sourceforge.net
Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release of OWASPModSecurity Core Rule Set (CRS) v2.0.8

On Tue, Aug 31, 2010 at 1:39 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:
> On 8/31/10 4:33 PM, "Castle, Shane" <scastle at bouldercounty.org> wrote:
>
>> The file modsecurity-crs_2.0.8.tar.gz.asc yields "bad signature" when
>> trying to verify modsecurity-crs_2.0.8.tar.gz,
> Hmm... I did export/import my private key into a new gpg install on my new
> macbook. ?I will check on it.
>
>> and said tar file won't
>> extract under RHEL5 :(.
>>
> Anyone else with problems? ?I just downloaded it/extracted it fine.
>
> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT
> /modsecurity-crs_2.0.8.tar.gz/download


Works fine for me:

$ ls -l modsecurity-crs_2.0.8.tar.gz*
-rw-r--r-- 1 brectanus brectanus 159537 2010-08-31 13:40
modsecurity-crs_2.0.8.tar.gz
-rw-r--r-- 1 brectanus brectanus    495 2010-08-27 10:13
modsecurity-crs_2.0.8.tar.gz.asc

$ gpg --verify modsecurity-crs_2.0.8.tar.gz.asc
$ gpg --verify modsecurity-crs_2.0.8.tar.gz.asc
gpg: Signature made Fri 27 Aug 2010 10:09:55 AM PDT using RSA key ID E6405E38
gpg: Good signature from "Ryan Barnett (CRS Project Lead)
<ryan.barnett at breach.com>"

-B

From chris at jwall.org  Tue Aug 31 16:53:14 2010
From: chris at jwall.org (Christian Bockermann)
Date: Tue, 31 Aug 2010 22:53:14 +0200
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
	OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <C8A2E0C6.13501%rbarnett@trustwave.com>
References: <C8A2E0C6.13501%rbarnett@trustwave.com>
Message-ID: <CD242E20-C5F3-4AAE-9E41-2E5E6F6BDB6D@jwall.org>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


Am 31.08.2010 um 22:39 schrieb Ryan Barnett:

>> and said tar file won't
>> extract under RHEL5 :(.
>> 
> Anyone else with problems?  I just downloaded it/extracted it fine.
> 
> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT
> /modsecurity-crs_2.0.8.tar.gz/download
> 


Doesn't look too well on my CentOS either:

[chris at jwall ~]$ tar tzvf modsecurity-crs_2.0.8.tar.gz 
tar: Ignoring unknown extended header keyword `SCHILY.dev'
tar: Ignoring unknown extended header keyword `SCHILY.ino'
tar: Ignoring unknown extended header keyword `SCHILY.nlink'
drwxr-xr-x rbarnett/234561557 0 2010-08-27 19:08:25 modsecurity-crs_2.0.8/
tar: Ignoring unknown extended header keyword `SCHILY.dev'
tar: Ignoring unknown extended header keyword `SCHILY.ino'
tar: Ignoring unknown extended header keyword `SCHILY.nlink'
...
- -rw-r--r-- rbarnett/234561557   2542 2010-08-27 18:59:49 modsecurity-crs_2.0.8/base_rules/modsecurity_crs_60_correlation.conf
tar: Error exit delayed from previous errors


Regards,
    Chris
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.8 (Darwin)

iD8DBQFMfWu6pc5/RcXDlTwRAqglAJ9sFBk+lUQnF4uIkAKIGyb/uN9OzQCfXfhR
1WNB9QAToyxrFC4a6yWLQVI=
=vofG
-----END PGP SIGNATURE-----

From RBarnett at trustwave.com  Tue Aug 31 17:15:15 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 31 Aug 2010 16:15:15 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
 OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <CD242E20-C5F3-4AAE-9E41-2E5E6F6BDB6D@jwall.org>
Message-ID: <C8A2E923.1351C%rbarnett@trustwave.com>


On 8/31/10 4:53 PM, "Christian Bockermann" <chris at jwall.org> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> 
> Am 31.08.2010 um 22:39 schrieb Ryan Barnett:
> 
>>> and said tar file won't
>>> extract under RHEL5 :(.
>>> 
>> Anyone else with problems?  I just downloaded it/extracted it fine.
>> 
>> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT
>> /modsecurity-crs_2.0.8.tar.gz/download
>> 
> 
> 
> Doesn't look too well on my CentOS either:
> 
> [chris at jwall ~]$ tar tzvf modsecurity-crs_2.0.8.tar.gz
> tar: Ignoring unknown extended header keyword `SCHILY.dev'
> tar: Ignoring unknown extended header keyword `SCHILY.ino'
> tar: Ignoring unknown extended header keyword `SCHILY.nlink'
> drwxr-xr-x rbarnett/234561557 0 2010-08-27 19:08:25 modsecurity-crs_2.0.8/
> tar: Ignoring unknown extended header keyword `SCHILY.dev'
> tar: Ignoring unknown extended header keyword `SCHILY.ino'
> tar: Ignoring unknown extended header keyword `SCHILY.nlink'
> ...
> - -rw-r--r-- rbarnett/234561557   2542 2010-08-27 18:59:49
> modsecurity-crs_2.0.8/base_rules/modsecurity_crs_60_correlation.conf
> tar: Error exit delayed from previous errors
> 


Hmm... Not sure what the issue could be.  I retested everything locally and
also verified the MD5 hash of the tar/gz file on SF and re-downloaded and
everything is fine.  Same issue with the ZIP archive?



From JM9991 at att.com  Tue Aug 31 17:19:06 2010
From: JM9991 at att.com (MARTIN, JASON (ATTSI))
Date: Tue, 31 Aug 2010 14:19:06 -0700
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
	OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <C8A2E923.1351C%rbarnett@trustwave.com>
References: <CD242E20-C5F3-4AAE-9E41-2E5E6F6BDB6D@jwall.org>
	<C8A2E923.1351C%rbarnett@trustwave.com>
Message-ID: <5889717B8EF90049926E1B6B68E220140DB2AD7A@BD01MSXMB018.US.Cingular.Net>

I believe this is a tar version compatibility issue:
http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
html

-Jason Martin



-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
Behalf Of Ryan Barnett
Sent: Tuesday, August 31, 2010 2:15 PM
To: Christian Bockermann
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release of
OWASPModSecurity Core Rule Set (CRS) v2.0.8


On 8/31/10 4:53 PM, "Christian Bockermann" <chris at jwall.org> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> 
> Am 31.08.2010 um 22:39 schrieb Ryan Barnett:
> 
>>> and said tar file won't
>>> extract under RHEL5 :(.
>>> 
>> Anyone else with problems?  I just downloaded it/extracted it fine.
>> 
>>
http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CUR
RENT
>> /modsecurity-crs_2.0.8.tar.gz/download
>> 
> 
> 
> Doesn't look too well on my CentOS either:
> 
> [chris at jwall ~]$ tar tzvf modsecurity-crs_2.0.8.tar.gz
> tar: Ignoring unknown extended header keyword `SCHILY.dev'
> tar: Ignoring unknown extended header keyword `SCHILY.ino'
> tar: Ignoring unknown extended header keyword `SCHILY.nlink'
> drwxr-xr-x rbarnett/234561557 0 2010-08-27 19:08:25
modsecurity-crs_2.0.8/
> tar: Ignoring unknown extended header keyword `SCHILY.dev'
> tar: Ignoring unknown extended header keyword `SCHILY.ino'
> tar: Ignoring unknown extended header keyword `SCHILY.nlink'
> ...
> - -rw-r--r-- rbarnett/234561557   2542 2010-08-27 18:59:49
> modsecurity-crs_2.0.8/base_rules/modsecurity_crs_60_correlation.conf
> tar: Error exit delayed from previous errors
> 


Hmm... Not sure what the issue could be.  I retested everything locally
and
also verified the MD5 hash of the tar/gz file on SF and re-downloaded
and
everything is fine.  Same issue with the ZIP archive?


_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From RBarnett at trustwave.com  Tue Aug 31 17:29:29 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 31 Aug 2010 16:29:29 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of
 OWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <5889717B8EF90049926E1B6B68E220140DB2AD7A@BD01MSXMB018.US.Cingular.Net>
Message-ID: <C8A2EC79.1352A%rbarnett@trustwave.com>

On 8/31/10 5:19 PM, "MARTIN, JASON (ATTSI)" <JM9991 at att.com> wrote:

> I believe this is a tar version compatibility issue:
> http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
> html
> 
> -Jason Martin
> 

Ah, could be.  This is what I had on my macbook -

$ tar --version
bsdtar 2.6.2 - libarchive 2.6.2

I just installed gnutar through ports.

$ gnutar --version
tar (GNU tar) 1.23
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later
<http://gnu.org/licenses/gpl.html>.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Written by John Gilmore and Jay Fenlason.

I will try and post some new archives asap.



> 
> 
> -----Original Message-----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
> Behalf Of Ryan Barnett
> Sent: Tuesday, August 31, 2010 2:15 PM
> To: Christian Bockermann
> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release of
> OWASPModSecurity Core Rule Set (CRS) v2.0.8
> 
> 
> On 8/31/10 4:53 PM, "Christian Bockermann" <chris at jwall.org> wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>> 
>> 
>> Am 31.08.2010 um 22:39 schrieb Ryan Barnett:
>> 
>>>> and said tar file won't
>>>> extract under RHEL5 :(.
>>>> 
>>> Anyone else with problems?  I just downloaded it/extracted it fine.
>>> 
>>> 
> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CUR
> RENT
>>> /modsecurity-crs_2.0.8.tar.gz/download
>>> 
>> 
>> 
>> Doesn't look too well on my CentOS either:
>> 
>> [chris at jwall ~]$ tar tzvf modsecurity-crs_2.0.8.tar.gz
>> tar: Ignoring unknown extended header keyword `SCHILY.dev'
>> tar: Ignoring unknown extended header keyword `SCHILY.ino'
>> tar: Ignoring unknown extended header keyword `SCHILY.nlink'
>> drwxr-xr-x rbarnett/234561557 0 2010-08-27 19:08:25
> modsecurity-crs_2.0.8/
>> tar: Ignoring unknown extended header keyword `SCHILY.dev'
>> tar: Ignoring unknown extended header keyword `SCHILY.ino'
>> tar: Ignoring unknown extended header keyword `SCHILY.nlink'
>> ...
>> - -rw-r--r-- rbarnett/234561557   2542 2010-08-27 18:59:49
>> modsecurity-crs_2.0.8/base_rules/modsecurity_crs_60_correlation.conf
>> tar: Error exit delayed from previous errors
>> 
> 
> 
> Hmm... Not sure what the issue could be.  I retested everything locally
> and
> also verified the MD5 hash of the tar/gz file on SF and re-downloaded
> and
> everything is fine.  Same issue with the ZIP archive?
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 


--
Ryan Barnett
Senior Security Researcher
Trustwave - SpiderLabs
Email: rbarnett at trustwave.com
Phone: (703) 794-2248
Cell: (571) 382-0476
www.trustwave.com

This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format. Thank you.



From scastle at bouldercounty.org  Tue Aug 31 17:39:47 2010
From: scastle at bouldercounty.org (Castle, Shane)
Date: Tue, 31 Aug 2010 15:39:47 -0600
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release
	ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <5889717B8EF90049926E1B6B68E220140DB2AD7A@BD01MSXMB018.US.Cingular.Net>
References: <CD242E20-C5F3-4AAE-9E41-2E5E6F6BDB6D@jwall.org><C8A2E923.1351C%rbarnett@trustwave.com>
	<5889717B8EF90049926E1B6B68E220140DB2AD7A@BD01MSXMB018.US.Cingular.Net>
Message-ID: <6009E57E59F29A43B7460CE724C42DF1E49625@EVS1B.boco.co.boulder.co.us>

Hmm - but this still doesn't explain the signature verification failure.

BTW the .zip seems to be fine, as far as extraction goes. Its signature
does not verify either.

Checking the MD5 hashes...they seem to match. What's up with the
signatures?

--
Shane Castle
Data Security Mgr, Boulder County IT
GSEC GCIH
303-441-3953


-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
Behalf Of MARTIN, JASON (ATTSI)
Sent: Tuesday, August 31, 2010 15:19
To: Ryan Barnett; Christian Bockermann
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
ofOWASPModSecurity Core Rule Set (CRS) v2.0.8

I believe this is a tar version compatibility issue:
http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
html

-Jason Martin



From RBarnett at trustwave.com  Tue Aug 31 18:02:10 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 31 Aug 2010 17:02:10 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release
 ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <6009E57E59F29A43B7460CE724C42DF1E49625@EVS1B.boco.co.boulder.co.us>
References: <CD242E20-C5F3-4AAE-9E41-2E5E6F6BDB6D@jwall.org>
	<C8A2E923.1351C%rbarnett@trustwave.com>
	<5889717B8EF90049926E1B6B68E220140DB2AD7A@BD01MSXMB018.US.Cingular.Net>
	<6009E57E59F29A43B7460CE724C42DF1E49625@EVS1B.boco.co.boulder.co.us>
Message-ID: <64DE0FF0-B526-43FE-9A91-BF8229DB1547@trustwave.com>

I will try and create a new gpg key as my old one is from my breach account. Once I create the new key I will upload it to the public repo and try to create a new package and verify the sigs.  

Sent from my iPhone

On Aug 31, 2010, at 5:55 PM, "Castle, Shane" <scastle at bouldercounty.org> wrote:

> Hmm - but this still doesn't explain the signature verification failure.
> 
> BTW the .zip seems to be fine, as far as extraction goes. Its signature
> does not verify either.
> 
> Checking the MD5 hashes...they seem to match. What's up with the
> signatures?
> 
> --
> Shane Castle
> Data Security Mgr, Boulder County IT
> GSEC GCIH
> 303-441-3953
> 
> 
> -----Original Message-----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
> Behalf Of MARTIN, JASON (ATTSI)
> Sent: Tuesday, August 31, 2010 15:19
> To: Ryan Barnett; Christian Bockermann
> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
> 
> I believe this is a tar version compatibility issue:
> http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
> html
> 
> -Jason Martin
> 
> 
> 


