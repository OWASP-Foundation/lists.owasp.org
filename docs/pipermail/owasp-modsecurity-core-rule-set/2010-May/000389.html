<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] @within in crs_30 and similar	(restricted extensions)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%40within%20in%20crs_30%20and%20similar%0A%09%28restricted%20extensions%29&In-Reply-To=mailman.37.1274803215.6370.owasp-modsecurity-core-rule-set%40lists.owasp.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000388.html">
   <LINK REL="Next"  HREF="000390.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] @within in crs_30 and similar	(restricted extensions)</H1>
    <B>modsec at enosis.com</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%40within%20in%20crs_30%20and%20similar%0A%09%28restricted%20extensions%29&In-Reply-To=mailman.37.1274803215.6370.owasp-modsecurity-core-rule-set%40lists.owasp.org"
       TITLE="[Owasp-modsecurity-core-rule-set] @within in crs_30 and similar	(restricted extensions)">modsec at enosis.com
       </A><BR>
    <I>Tue May 25 17:41:55 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000388.html">[Owasp-modsecurity-core-rule-set] restricted extensions
</A></li>
        <LI>Next message: <A HREF="000390.html">[Owasp-modsecurity-core-rule-set] @within in crs_30 and similar	(restricted extensions)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#389">[ date ]</a>
              <a href="thread.html#389">[ thread ]</a>
              <a href="subject.html#389">[ subject ]</a>
              <a href="author.html#389">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>James: 

I suspect your problem is related to the earlier-reported 
REQUEST_HEADERS_NAMES problem in 
&lt;<A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-April/000357.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-April/000357.html</A>&gt;

The @within operator is misnamed for modsec's semantics.
Or the documentation could be clearer. Or both.

@within is (essentially) a simple linear string search: 
your argument &quot;.do&quot; was found in &quot;foo .dos bar&quot; IOW, the
operation is what is more usually called &quot;string match&quot;.
Perhaps it should be called &quot;@sm&quot;.

Because modsec provides &quot;set&quot; semantics (&quot;Collections&quot;) and
the appearance of tokenized input (such as your space-delimited
%{tx.restricted.extensions} it's sensible for you (and by
the evidence, the crs authors) to believe that @within will
understand the context and magically switch between strings 
and tokens. Maybe it c/should in some cases.

An operator like @containsWord does match on locale alphanum_ 
tokens, but on the reverse of match and target for the rule 
variable and operator argument.

@within is not, however, token based. So crs_30 rules like 
960035 and 960038 will unexpectedly match even when the 
operation appears 'obviously' token-based. (e.g., on 960038, 
the ordinary and acceptable &quot;Connection&quot; header will be found 
@within &quot;Proxy-Connection ...&quot;).

One might think @pm would be a workable substitute for the 
rule 960038 case, but @pm apparently doesn't perform %{macro} 
substitution for its entire argument (@2.5.12). In the case 
of this rule, tho, the simple workaround is to use @pm and 
just put the restricted headers list directly into the rule.

But in your case, with the longer list for rule 960035, @pm is 
out. As a workaround, perhaps use @pmFromFile. Just move the 
list to a one-per-line file of your making.

Let us know, please.

--Nick 

&gt;<i> Date: Tue, 25 May 2010 11:25:47 -0400
</I>&gt;<i> From: James Muse &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jfmtopnettlc at gmail.com</A>&gt;
</I>&gt;<i> Subject: [Owasp-modsecurity-core-rule-set] restricted extensions
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> Message-ID:
</I>&gt;<i> 	&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">AANLkTinrJIIQl9xGXL9jlrdSbxvJZv693oshxbzS2n-r at mail.gmail.com</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=&quot;iso-8859-1&quot;
</I>&gt;<i> 
</I>&gt;<i> Moderator,
</I>&gt;<i> 
</I>&gt;<i> I am having an issue with the restricted_extensions variable and core rule
</I>&gt;<i> file modsecurity_crs_30_http_policy.conf line 87.  One of my applications
</I>&gt;<i> uses the file extension .do and there appears to be a .dos in the
</I>&gt;<i> restricted extensions list.. The audit log shows the extension as [data
</I>&gt;<i> &quot;.do&quot;]  do is not in the restricted_extension list .dos is.  When I remove
</I>&gt;<i> .dos from the restricted extensions I no longer have this issue.  May be I
</I>&gt;<i> don't understand the within operator but do is no the same as dos.  Is there
</I>&gt;<i> a bug here or am I doing something wrong?  I think I would like to keep dos
</I>&gt;<i> and an extension I would like to block but it appears to be causing and
</I>&gt;<i> issue with my application which uses .do
</I>&gt;<i> 
</I>&gt;<i> James
</I>

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000388.html">[Owasp-modsecurity-core-rule-set] restricted extensions
</A></li>
	<LI>Next message: <A HREF="000390.html">[Owasp-modsecurity-core-rule-set] @within in crs_30 and similar	(restricted extensions)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#389">[ date ]</a>
              <a href="thread.html#389">[ thread ]</a>
              <a href="subject.html#389">[ subject ]</a>
              <a href="author.html#389">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
