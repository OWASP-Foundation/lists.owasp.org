<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level - Only send critical events
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20inbound_anomaly_score_level%20-%0A%20Only%20send%20critical%20events&In-Reply-To=%3CD023AFA8.10F698%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001640.html">
   <LINK REL="Next"  HREF="001644.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level - Only send critical events</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20inbound_anomaly_score_level%20-%0A%20Only%20send%20critical%20events&In-Reply-To=%3CD023AFA8.10F698%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level - Only send critical events">RBarnett at trustwave.com
       </A><BR>
    <I>Wed Aug 27 19:54:35 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001640.html">[Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level	-	Only send critical events
</A></li>
        <LI>Next message: <A HREF="001644.html">[Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -	Only send critical events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1643">[ date ]</a>
              <a href="thread.html#1643">[ thread ]</a>
              <a href="subject.html#1643">[ subject ]</a>
              <a href="author.html#1643">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Wesley,
What exactly are you trying to achieve here?

Ryan Barnett
Senior Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com &lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;




On 8/25/14 6:20 PM, &quot;Wesley Render&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">wrender at otherdata.com</A>&gt; wrote:

&gt;<i>I was just wanting to follow up.  Is anyone able to confirm the proper
</I>&gt;<i>logging settings when using ModSecurity, and sending the logs out via
</I>&gt;<i>mlogc
</I>&gt;<i>to AuditConsole?  Should we have our modsecurity_crs_10_setup.conf
</I>&gt;<i>SecDefaultAction lines set to the following?
</I>&gt;<i>
</I>&gt;<i>SecDefaultAction &quot;phase:1,pass,nolog&quot;
</I>&gt;<i>SecDefaultAction &quot;phase:2,pass,nolog&quot;
</I>&gt;<i>
</I>&gt;<i>Thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Wesley Render, IT Consultant, RHCSA
</I>&gt;<i>Phone: 1.403.228.1221 ext 201
</I>&gt;<i>www.otherdata.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>-----Original Message-----
</I>&gt;<i>From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>
</I>&gt;<i>[mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf
</I>&gt;<i>Of Wesley Render
</I>&gt;<i>Sent: August-20-14 11:30 AM
</I>&gt;<i>To: 'OWASP Mod Security'
</I>&gt;<i>Subject: Re: [Owasp-modsecurity-core-rule-set]
</I>&gt;<i>inbound_anomaly_score_level -
</I>&gt;<i>Only send critical events
</I>&gt;<i>
</I>&gt;<i>When I set it to the following, I get a lot less logs coming in.  I am
</I>&gt;<i>confused on how it should be set as well when sending logs to AuditConsole
</I>&gt;<i>using mlogc.  Here is a summary of relevant settings I have right now
</I>&gt;<i>(below).   I guess it seems as though the logging settings are not able to
</I>&gt;<i>combine one correlated event into the audit log.  They can only combine
</I>&gt;<i>one
</I>&gt;<i>correlated event into the apache error_log?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>############  modsecurity_crs_10_setup.conf  Settings
</I>&gt;<i>##########################
</I>&gt;<i>
</I>&gt;<i># Collaborative Detection Mode
</I>&gt;<i>SecDefaultAction &quot;phase:1,pass,nolog&quot;
</I>&gt;<i>SecDefaultAction &quot;phase:2,pass,nolog&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i># Collaborative Detection Blocking #
</I>&gt;<i>SecAction \
</I>&gt;<i>  &quot;id:'900004', \
</I>&gt;<i>  phase:1, \
</I>&gt;<i>  t:none, \
</I>&gt;<i>  setvar:tx.anomaly_score_blocking=on, \
</I>&gt;<i>  nolog, \
</I>&gt;<i>  pass&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>############ modsec2.user.conf  Settings
</I>&gt;<i>######################################
</I>&gt;<i>SecDataDir /usr/local/apache/conf/sec-data
</I>&gt;<i>SecTmpDir /usr/local/apache/conf/sec-tmp
</I>&gt;<i>
</I>&gt;<i>SecRuleEngine On
</I>&gt;<i>SecPcreMatchLimit 50000
</I>&gt;<i>SecPcreMatchLimitRecursion 50000
</I>&gt;<i>
</I>&gt;<i># With SecRequestBodyAccess turned on care needs to be taken with false
</I>&gt;<i>positives
</I>&gt;<i>SecRequestBodyAccess On
</I>&gt;<i>SecRequestBodyLimit 134217728
</I>&gt;<i>SecRequestBodyLimitAction ProcessPartial
</I>&gt;<i>SecRequestBodyNoFilesLimit 131072
</I>&gt;<i>SecRequestBodyInMemoryLimit 131072
</I>&gt;<i>
</I>&gt;<i>SecResponseBodyAccess On
</I>&gt;<i>SecResponseBodyMimeType (null) text/html text/plain text/xml
</I>&gt;<i>SecResponseBodyLimit 524228
</I>&gt;<i>SecResponseBodyLimitAction ProcessPartial
</I>&gt;<i>SecServerSignature Apache
</I>&gt;<i>SecCookieFormat 0
</I>&gt;<i>
</I>&gt;<i># Additional ModSecurity Logging Options for mlogc
</I>&gt;<i># Use ReleventOnly auditing
</I>&gt;<i>SecAuditEngine RelevantOnly
</I>&gt;<i>SecAuditLogRelevantStatus &quot;^(?:5|4(?!04))&quot;
</I>&gt;<i>
</I>&gt;<i># Must use concurrent logging
</I>&gt;<i>SecAuditLogType Concurrent
</I>&gt;<i>
</I>&gt;<i># Send all audit log parts
</I>&gt;<i>SecAuditLogParts ABDEFHIJKZ
</I>&gt;<i>
</I>&gt;<i># Use the same /CollectorRoot/LogStorageDir as in mlogc.conf
</I>&gt;<i>SecAuditLogStorageDir /var/log/mlogc/data
</I>&gt;<i>
</I>&gt;<i># Pipe audit log to mlogc with your configuration
</I>&gt;<i>SecAuditLog &quot;|/usr/local/modsecurity/bin/mlogc /etc/mlogc.conf&quot;
</I>&gt;<i>
</I>&gt;<i># OWASP Rules
</I>&gt;<i>Include conf/owasp-modsecurity-crs/modsecurity_crs_10_setup.conf
</I>&gt;<i>Include conf/owasp-modsecurity-crs/activated_rules/*.conf
</I>&gt;<i>
</I>&gt;<i># Trustwave Commercial Rules
</I>&gt;<i>Include conf/slr_vuln_rules/owasp_crs_integration/attack_type/*.conf
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Wesley Render, IT Consultant, RHCSA
</I>&gt;<i>Phone: 1.403.228.1221 ext 201
</I>&gt;<i>www.otherdata.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>-----Original Message-----
</I>&gt;<i>From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>
</I>&gt;<i>[mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf
</I>&gt;<i>Of Earl Fogel
</I>&gt;<i>Sent: August-20-14 9:59 AM
</I>&gt;<i>To: OWASP Mod Security
</I>&gt;<i>Subject: Re: [Owasp-modsecurity-core-rule-set]
</I>&gt;<i>inbound_anomaly_score_level -
</I>&gt;<i>Only send critical events
</I>&gt;<i>
</I>&gt;<i>I have this problem as well.  I also have:
</I>&gt;<i>
</I>&gt;<i>SecDefaultAction &quot;phase:1,pass,nolog,auditlog&quot;
</I>&gt;<i>SecDefaultAction &quot;phase:2,pass,nolog,auditlog&quot;
</I>&gt;<i>SecAuditEngine RelevantOnly
</I>&gt;<i>SecAuditLogRelevantStatus &quot;^(?:5|4(?!04))&quot;
</I>&gt;<i>
</I>&gt;<i>Could that be relevent?  How should these be set in collaborative
</I>&gt;<i>detection
</I>&gt;<i>mode?
</I>&gt;<i>
</I>&gt;<i>Earl
</I>&gt;<i>-
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>On Wed, 20 Aug 2014, Josh Amishav-Zlatin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamuse at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>On Wed, Aug 20, 2014 at 6:56 AM, Wesley Render &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">wrender at otherdata.com</A>&gt;
</I>&gt;<i>wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>      Would anyone know if it would be possible to adjust the core rule
</I>&gt;&gt;<i>set
</I>&gt;&gt;<i>      configuration file so that only events that have a total inbound
</I>&gt;<i>score of
</I>&gt;&gt;<i>      5 or higher are sent to the audit log.  (Running in Collaborative
</I>&gt;&gt;<i>      Detection and Anomaly Scoring &amp; Blocking)  Version:
</I>&gt;<i>SecComponentSignature
</I>&gt;&gt;<i>      &quot;OWASP_CRS/2.2.9&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Hi Wesley,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>When the CRS is used in anomaly mode it should not create audit logs
</I>&gt;&gt;<i>unless the event passes the threshold set in the 10 file. Can you send
</I>&gt;&gt;<i>me privately an event from AuditConsole that does not have an anomaly
</I>&gt;&gt;<i>score level above 5? I'm specifically interested in sections H and K.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>- Josh
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001640.html">[Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level	-	Only send critical events
</A></li>
	<LI>Next message: <A HREF="001644.html">[Owasp-modsecurity-core-rule-set] inbound_anomaly_score_level -	Only send critical events
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1643">[ date ]</a>
              <a href="thread.html#1643">[ thread ]</a>
              <a href="subject.html#1643">[ subject ]</a>
              <a href="author.html#1643">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
