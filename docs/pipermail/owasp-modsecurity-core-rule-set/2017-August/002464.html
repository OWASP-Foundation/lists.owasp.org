<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] File upload problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20File%20upload%20problem&In-Reply-To=%3C20170823193306.GA23031%40arxnet.hu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002463.html">
   <LINK REL="Next"  HREF="002465.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] File upload problem</H1>
    <B>Ervin Heged&#252;s</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20File%20upload%20problem&In-Reply-To=%3C20170823193306.GA23031%40arxnet.hu%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] File upload problem">airween at gmail.com
       </A><BR>
    <I>Wed Aug 23 19:33:06 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002463.html">[Owasp-modsecurity-core-rule-set] File upload problem
</A></li>
        <LI>Next message: <A HREF="002465.html">[Owasp-modsecurity-core-rule-set] Remove rule 970901 - CRS 2.2.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2464">[ date ]</a>
              <a href="thread.html#2464">[ thread ]</a>
              <a href="subject.html#2464">[ subject ]</a>
              <a href="author.html#2464">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Spartantri,

On Wed, Aug 23, 2017 at 06:36:48PM +0200, <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">spartantri at gmail.com</A> wrote:
&gt;<i> Hi Ervin,
</I>&gt;<i> 
</I>&gt;<i> Maybe the modsec engine multipart body processor is not rfc compliant and confuses the CRLF-- with a boundary delimiter instead of doing a full check as described in rfcs 7578 and 2046, try removing the dashes from the beginning and end of the gpg content and if it passes that may be the reason behind this.
</I>
in case of PGP there is no option to remove the lines from the
head (then the pgp app couldn't realise that is a pgp key).

I've try to upload a simple certificate (as attachment), which also
contains a header and footer lines:

-----BEGIN CERTIFICATE-----
MIIE3TCCA8WgAwIBAgIQX+iZdkBxaFky7vr2n2sS5zANBgkqhkiG9w0BAQsFADB4
...
jg==
-----END CERTIFICATE-----

I've got 403 Forbidden again. Then I removed the leader &quot;-&quot;
chars, and attachment had uploaded correctly.

I think there isn't a CRLF problem.

&gt;<i> To fix it you may add a rule to disable 200004 for that particular URL.
</I>
I don't want to disable this rule :)

&gt;<i> But read the warnings at the documentation.
</I>&gt;<i> 
</I>&gt;<i> File uploads are usually risky so it maybe good if you do a full check with @inspectFile for malware viruses etc
</I>&gt;<i> 
</I>&gt;<i> Something like
</I>&gt;<i> SecRule FILES_TMPNAMES &quot;@inspectFile path/inspectscript&quot; deny..
</I>
thanks, but I'm afraid that's not option (I mean to disable this
rule)


Thanks for your help,


a.
 

-- 
I &#65533; UTF-8
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002463.html">[Owasp-modsecurity-core-rule-set] File upload problem
</A></li>
	<LI>Next message: <A HREF="002465.html">[Owasp-modsecurity-core-rule-set] Remove rule 970901 - CRS 2.2.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2464">[ date ]</a>
              <a href="thread.html#2464">[ thread ]</a>
              <a href="subject.html#2464">[ subject ]</a>
              <a href="author.html#2464">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
