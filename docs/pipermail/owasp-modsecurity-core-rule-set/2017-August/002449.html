<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20What%20is%20the%20right%20process%20of%0A%20dealing%20with%20the%20false%20postivies&In-Reply-To=%3CB2B6B510-33B9-4F8F-B01B-F1B34BB572B6%40serversolution.info%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002444.html">
   <LINK REL="Next"  HREF="002450.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies</H1>
    <B>Georgi Georgiev</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20What%20is%20the%20right%20process%20of%0A%20dealing%20with%20the%20false%20postivies&In-Reply-To=%3CB2B6B510-33B9-4F8F-B01B-F1B34BB572B6%40serversolution.info%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies">georgi at serversolution.info
       </A><BR>
    <I>Thu Aug 17 16:27:49 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002444.html">[Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies
</A></li>
        <LI>Next message: <A HREF="002450.html">[Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2449">[ date ]</a>
              <a href="thread.html#2449">[ thread ]</a>
              <a href="subject.html#2449">[ subject ]</a>
              <a href="author.html#2449">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am getting started :) I would like to finally ask you these questions. I would be very thankful if you answer me.

 1. Is really paranoia level 1 less false postitive for a shared hosting environment and in such time enough for protection? Does it protect from sql injection and xss as I read that they are included in paranoia level2? What is the best practice - initially start with paranoia level 1, tune it and then switch to 2?

2. What is your anomaly inbound score set? Have you changed it to something other than 5 or you leaved it to 5 and changed the score of the rules?

3. I am not sure how to tune the tx.score for every rule in the OWASP as they are with variables such as follow:

  SecRule IP:REPUT_BLOCK_FLAG &quot;@eq 1&quot; \
    &quot;setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},\
    setvar:tx.%{rule.id}-AUTOMATION/MALICIOUS-%{matched_var_name}=%{matched_var}&quot;


Is this the correct default scores for the specific rulesets and attacks that I should tune?

# All _score variables start at 0, and are incremented by the various rules
# upon detection of a possible attack.
# sql_error_match is used for shortcutting rules for performance reasons.

SecAction \
 &quot;id:901200,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.anomaly_score=0,\
  setvar:tx.sql_injection_score=0,\
  setvar:tx.xss_score=0,\
  setvar:tx.rfi_score=0,\
  setvar:tx.lfi_score=0,\
  setvar:tx.rce_score=0,\
  setvar:tx.php_injection_score=0,\
  setvar:tx.http_violation_score=0,\
  setvar:tx.session_fixation_score=0,\
  setvar:tx.inbound_anomaly_score=0,\
  setvar:tx.outbound_anomaly_score=0,\
  setvar:tx.sql_error_match=0


4. Should I adjust the percentage of requests that are funnelled into the Core Rules below 100 as it&#8217;s recommended on some pages? Does this affect the false positives or only the performance?

Best regards,
Georgi Georgiev

&gt;<i> On Aug 15, 2017, at 6:10 PM, Georgi Georgiev &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">georgi at serversolution.info</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Ok, I removed the line SecDefaultAction &quot;log,deny,phase:1&#8221; so now I am in anomaly mode as a first step.
</I>&gt;<i> 
</I>&gt;<i> Later, I changed the threshold to 40 and xss stack test no longer been blocked.
</I>&gt;<i> 
</I>&gt;<i> SecRule &amp;TX:inbound_anomaly_score_threshold &quot;@eq 0&quot; \
</I>&gt;<i>     &quot;id:901100,\
</I>&gt;<i>     phase:1,\
</I>&gt;<i>     pass,\
</I>&gt;<i>     nolog,\
</I>&gt;<i>     setvar:tx.inbound_anomaly_score_threshold=40&#8221;
</I>&gt;<i> 
</I>&gt;<i> Last, but not least I added tx score to the following rule which is a custom one from me as I experimented with the valued, but I am always blocked. Is the problem in the rule (40 scores shouldn&#8217;t be reached from one rule)?
</I>&gt;<i> 
</I>&gt;<i> SecRule ARGS|REQUEST_URI &quot;c99&quot;  &quot;phase:3,log,id:153,setvar:tx.anomaly_score=0&#8221;
</I>&gt;<i> 
</I>&gt;<i> Should I do something other or now I should play only with this score? Are there any best practices or something other to suggest me? 
</I>&gt;<i> 
</I>&gt;<i> Best regards,
</I>&gt;<i> Georgi Georgiev
</I>&gt;<i> 
</I>&gt;&gt;<i> On Aug 15, 2017, at 3:55 PM, Christian Folini &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Georgi,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Yes, this is all correct.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Glad to help (just not always with enough time at my hands...)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Cheers,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Christian
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> On Tue, Aug 15, 2017 at 03:42:08PM +0300, Georgi Georgiev wrote:
</I>&gt;&gt;&gt;<i> Thank you about your reply again, it was useful. First of all I would like to apologize for the stupid for you questions. Currently I see that I have the following in the config which means from what I read that I am not in anomaly mode, but in traditional:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> SecDefaultAction &quot;log,deny,phase:1&quot;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> So, by your recommendation I understand that I should remove this lines to start using anomaly mode. Then, on every rule I can/ should add with setvar:tx.anomaly_score=5(for example) so I can control it&#8217;s score?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Also to decrease the false positives as a second step from the setup should I increase the threshold value here - or I am wrong?
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> # Default Inbound Anomaly Threshold Level (rule 900110 in setup.conf)
</I>&gt;&gt;&gt;<i> SecRule &amp;TX:inbound_anomaly_score_threshold &quot;@eq 0&quot; \
</I>&gt;&gt;&gt;<i>    &quot;id:901100,\
</I>&gt;&gt;&gt;<i>    phase:1,\
</I>&gt;&gt;&gt;<i>    pass,\
</I>&gt;&gt;&gt;<i>    nolog,\
</I>&gt;&gt;&gt;<i>    setvar:tx.inbound_anomaly_score_threshold=5&quot;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> On Aug 15, 2017, at 9:52 AM, Christian Folini &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Hello Georgi,
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> CRS3 comes with default rule exclusions for WP and Drupal that solve
</I>&gt;&gt;&gt;&gt;<i> many of the base installations FPs. Collaborating with the project on
</I>&gt;&gt;&gt;&gt;<i> a set of Joomla rule exclusions would be most helpful.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Starting with a higher anomaly threshold while you weed out the false
</I>&gt;&gt;&gt;&gt;<i> positives is a method that I advocate in my documentation.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Making sure that you do not base your tuning efforts on attack traffic
</I>&gt;&gt;&gt;&gt;<i> is an obvious problems. There are multiple approaches to this, and none
</I>&gt;&gt;&gt;&gt;<i> of them is hard science. I usually try to start off with tuning based on
</I>&gt;&gt;&gt;&gt;<i> known IP ranges.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> This is all discussed in great detail in the series of ModSecurity
</I>&gt;&gt;&gt;&gt;<i> tutorials at <A HREF="https://www.netnea.com/cms/apache-tutorials/">https://www.netnea.com/cms/apache-tutorials/</A> &lt;<A HREF="https://www.netnea.com/cms/apache-tutorials/">https://www.netnea.com/cms/apache-tutorials/</A>&gt;
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Besides, I am also running two public ModSec courses in October.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Good luck!
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Christian
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> On Mon, Aug 14, 2017 at 03:29:39PM +0300, Georgi Georgiev wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;&gt;&gt;<i> I am deploying mod security with nginx in shared hosting environment and most of the websites are Wordpress, Joomla and drupal. I don&#8217;t want to rewrite all the rules of owasp to minimize the false positives. Also, I searched for specific for Wordpress or Joomla ruleset but couldn&#8217;t find such thing (it would be very resourceful to research for every Wordpress and Joomla hack, even the most famouse one and to write rules about it, also to read how to write rules :)). Even, if I put mod security initially in a mode that does not block , only to log it would be very hard to see very queer if it&#8217;s false positive or whether it come from evil sources.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> I read that right practice is to change the score of the anomaly but didn&#8217;t understand it at all.
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> So, I would like to ask you how you deal with this? I know that false positives will be there all the time, but how you minimize them? Write your own ruleset? Is there any paid ruleset that you can recommend (it think that I found only one paid and many people cry from it). Just I want to explain me the process you follow with the rules :)
</I>&gt;&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;&gt;<i> Thank you in advance!
</I>&gt;&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> -- 
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://www.feistyduck.com/books/modsecurity-handbook/">https://www.feistyduck.com/books/modsecurity-handbook/</A> &lt;<A HREF="https://www.feistyduck.com/books/modsecurity-handbook/">https://www.feistyduck.com/books/modsecurity-handbook/</A>&gt;
</I>&gt;&gt;&gt;&gt;<i> mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
</I>&gt;&gt;&gt;&gt;<i> twitter: @ChrFolini
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> ModSecurity courses Oct 2017 in London and Zurich
</I>&gt;&gt;<i> <A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A> &lt;<A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://www.feistyduck.com/books/modsecurity-handbook/">https://www.feistyduck.com/books/modsecurity-handbook/</A>
</I>&gt;&gt;<i> mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
</I>&gt;&gt;<i> twitter: @ChrFolini
</I>&gt;<i> 
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170817/49550723/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170817/49550723/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002444.html">[Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies
</A></li>
	<LI>Next message: <A HREF="002450.html">[Owasp-modsecurity-core-rule-set] What is the right process of dealing with the false postivies
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2449">[ date ]</a>
              <a href="thread.html#2449">[ thread ]</a>
              <a href="subject.html#2449">[ subject ]</a>
              <a href="author.html#2449">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
