<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20400%20bad%20request%20when%20owasp%20is%0A%20enabled%20in%20detection%20only%20mode%20-%20why%3F&In-Reply-To=%3C20170822165340.xc7hjedaakdrawzh%40leander%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002453.html">
   <LINK REL="Next"  HREF="002455.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20400%20bad%20request%20when%20owasp%20is%0A%20enabled%20in%20detection%20only%20mode%20-%20why%3F&In-Reply-To=%3C20170822165340.xc7hjedaakdrawzh%40leander%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?">christian.folini at netnea.com
       </A><BR>
    <I>Tue Aug 22 16:53:40 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002453.html">[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
</A></li>
        <LI>Next message: <A HREF="002455.html">[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2454">[ date ]</a>
              <a href="thread.html#2454">[ thread ]</a>
              <a href="subject.html#2454">[ subject ]</a>
              <a href="author.html#2454">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Georgi,

The

&quot;Message: Audit log: Failed to lock global mutex: Permission denied&quot;

in combination with the SecRequestBodyAccess is a bad sign.

You should try and solve that permission problem. I would not be
surprised if it would be linked.

Ahoj,

Christian


On Tue, Aug 22, 2017 at 07:27:11PM +0300, Georgi Georgiev wrote:
&gt;<i>    If I comment this line everything works:
</I>&gt;<i>    SecRequestBodyAccess On
</I>&gt;<i>    But this should be enabled. Any suggestions?
</I>&gt;<i> 
</I>&gt;<i>      On Aug 22, 2017, at 6:16 PM, Georgi Georgiev
</I>&gt;<i>      &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">georgi at serversolution.info</A>&gt; wrote:
</I>&gt;<i>      Hello,
</I>&gt;<i>      If I enable crs for this domain on the Joomla search of the site it
</I>&gt;<i>      returns 400 bad request, but the modsec is in detection only mode. No
</I>&gt;<i>      rule is matched as I see. If I turn off the modsec everything is ok.
</I>&gt;<i>      This is the audit log if it helps: 
</I>&gt;<i>      [22/Aug/2017:17:08:15 +0300] IcAcAcVcAcccAcAcAAxcAcAc 77.70.108.119
</I>&gt;<i>      53428 127.0.0.1 80
</I>&gt;<i>      --bc7c6349-B--
</I>&gt;<i>      POST /index.php HTTP/2.0
</I>&gt;<i>      host: www.plevensport.eu
</I>&gt;<i>      content-length: 86
</I>&gt;<i>      cache-control: max-age=0
</I>&gt;<i>      origin: <A HREF="https://www.plevensport.eu">https://www.plevensport.eu</A>
</I>&gt;<i>      upgrade-insecure-requests: 1
</I>&gt;<i>      user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5)
</I>&gt;<i>      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101
</I>&gt;<i>      Safari/537.36
</I>&gt;<i>      content-type: application/x-www-form-urlencoded
</I>&gt;<i>      accept:
</I>&gt;<i>      text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
</I>&gt;<i>      referer: <A HREF="https://www.plevensport.eu/index.php">https://www.plevensport.eu/index.php</A>
</I>&gt;<i>      accept-encoding: gzip, deflate, br
</I>&gt;<i>      accept-language: en-US,en;q=0.8
</I>&gt;<i>      cookie:
</I>&gt;<i>      53f8f9fad3d3789bffbdbce160246b7e=3b72edc95ab809ce6dc6b3755305adf1;
</I>&gt;<i>      __utmt=1; _c=y;
</I>&gt;<i>      __utma=155943930.1578748701.1503409083.1503409083.1503409083.1;
</I>&gt;<i>      __utmb=155943930.9.10.1503409083; __utmc=155943930;
</I>&gt;<i>      __utmz=155943930.1503409083.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)
</I>&gt;<i>      --bc7c6349-C--
</I>&gt;<i>      searchword=%D0%BF%D0%BB%D0%B5%D0%B2%D0%B5%D0%BD&amp;task=search&amp;option=com_search&amp;Itemid=1
</I>&gt;<i>      --bc7c6349-F--
</I>&gt;<i>      HTTP/1.1 400
</I>&gt;<i>      Server: ws-httpd
</I>&gt;<i>      Content-Type: text/html
</I>&gt;<i>      Content-Length: 568
</I>&gt;<i>      Connection: close
</I>&gt;<i>      --bc7c6349-E--
</I>&gt;<i>      &lt;html&gt;
</I>&gt;<i>      &lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;
</I>&gt;<i>      &lt;body bgcolor=&quot;white&quot;&gt;
</I>&gt;<i>      &lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;
</I>&gt;<i>      &lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
</I>&gt;<i>      &lt;/body&gt;
</I>&gt;<i>      &lt;/html&gt;
</I>&gt;<i>      &lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
</I>&gt;<i>      &lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
</I>&gt;<i>      &lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
</I>&gt;<i>      &lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
</I>&gt;<i>      &lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
</I>&gt;<i>      &lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
</I>&gt;<i>      --bc7c6349-H--
</I>&gt;<i>      Message: Audit log: Failed to lock global mutex: Permission denied
</I>&gt;<i>      Apache-Handler: IIS
</I>&gt;<i>      Stopwatch: 1503410895000281 417063 (- - -)
</I>&gt;<i>      Stopwatch2: 1503410895000281 417063; combined=44304, p1=732, p2=42473,
</I>&gt;<i>      p3=47, p4=723, p5=229, sr=148, sw=100, l=0, gc=0
</I>&gt;<i>      Response-Body-Transformed: Dechunked
</I>&gt;<i>      Producer: ModSecurity for nginx (STABLE)/2.9.1
</I>&gt;<i>      (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); OWASP_CRS/3.0.2.
</I>&gt;<i>      Server: ModSecurity Standalone
</I>&gt;<i>      Engine-Mode: &quot;ENABLED&quot;
</I>&gt;<i>      --bc7c6349-Z--
</I>&gt;<i>      As it&#226;**s not exactly error which can occur because of modsec but it&#226;**s
</I>&gt;<i>      obviously the problem what can be the reason? Some directive?
</I>&gt;<i>      _______________________________________________
</I>&gt;<i>      Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i>      <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i>      <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

-- 
ModSecurity courses Oct 2017 in London and Zurich
<A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>
<A HREF="https://www.feistyduck.com/books/modsecurity-handbook/">https://www.feistyduck.com/books/modsecurity-handbook/</A>
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
twitter: @ChrFolini
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002453.html">[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
</A></li>
	<LI>Next message: <A HREF="002455.html">[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2454">[ date ]</a>
              <a href="thread.html#2454">[ thread ]</a>
              <a href="subject.html#2454">[ subject ]</a>
              <a href="author.html#2454">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
