<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] File upload problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20File%20upload%20problem&In-Reply-To=%3C20170823075432.obfagmgd6m3ds574%40leander%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002458.html">
   <LINK REL="Next"  HREF="002460.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] File upload problem</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20File%20upload%20problem&In-Reply-To=%3C20170823075432.obfagmgd6m3ds574%40leander%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] File upload problem">christian.folini at netnea.com
       </A><BR>
    <I>Wed Aug 23 07:54:32 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002458.html">[Owasp-modsecurity-core-rule-set] File upload problem
</A></li>
        <LI>Next message: <A HREF="002460.html">[Owasp-modsecurity-core-rule-set] File upload problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2459">[ date ]</a>
              <a href="thread.html#2459">[ thread ]</a>
              <a href="subject.html#2459">[ subject ]</a>
              <a href="author.html#2459">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

Is this the full &quot;H&quot; part of the Audit Log?

Are you sure it's not an extension filter defined on the application
itself?

Did you try this without CRS? Without ModSec?

Just questions that mean to guide you...

Ahoj,

Christian

On Wed, Aug 23, 2017 at 09:30:30AM +0200, Ervin Heged&#252;s wrote:
&gt;<i> Hi folks,
</I>&gt;<i> 
</I>&gt;<i> here is a new problem with CRS 3.0(.2). There is an nGinx with
</I>&gt;<i> Modsecurity 3.0, and CRS 3.0.2, and an Apache backend, which
</I>&gt;<i> serves a webmail (Roundcube).
</I>&gt;<i> 
</I>&gt;<i> When I try to import my GPG key through the upload, I got 403
</I>&gt;<i> Forbidden answer.
</I>&gt;<i> 
</I>&gt;<i> Here are the details:
</I>&gt;<i> 
</I>&gt;<i> HTTP req:
</I>&gt;<i> 
</I>&gt;<i> POST <A HREF="https://webmail.mydomain.com/?_task=settings&amp;_action=plugin.enigmakeys&amp;_a=import&amp;_unlock=loading1503472197200">https://webmail.mydomain.com/?_task=settings&amp;_action=plugin.enigmakeys&amp;_a=import&amp;_unlock=loading1503472197200</A>
</I>&gt;<i> ...
</I>&gt;<i> Content-Length	4443
</I>&gt;<i> Content-Type	multipart/form-data; boundary=---------------------------186567636118947579521451609378
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> HTTP resp:
</I>&gt;<i> 
</I>&gt;<i> 403 Forbidden
</I>&gt;<i> 
</I>&gt;<i> Content of audit.log:
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---A--
</I>&gt;<i> [23/Aug/2017:09:10:32 +0200] 15034722321.000000 client.ip.addr 51048 client.ip.addr 443
</I>&gt;<i> ---3U4kCbBk---B--
</I>&gt;<i> POST /?_task=settings&amp;_action=plugin.enigmakeys&amp;_a=import&amp;_unlock=loading1503472197200
</I>&gt;<i> HTTP/1.1
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> Referer: <A HREF="https://webmail.mydomain.com/?_task=settings&amp;_framed=1&amp;_action=plugin.enigmakeys&amp;_a=import">https://webmail.mydomain.com/?_task=settings&amp;_framed=1&amp;_action=plugin.enigmakeys&amp;_a=import</A>
</I>&gt;<i> Content-Type: multipart/form-data; boundary=---------------------------186567636118947579521451609378
</I>&gt;<i> Accept-Encoding: gzip, deflate, br
</I>&gt;<i> Cookie: language=hu; _ga=GA1.2.817NNNNNN.14NNNNNNNN; roundcube_sessid=sessionidtoken; roundcube_sessauth=sessauthidtoken
</I>&gt;<i> Content-Length: 4443
</I>&gt;<i> Accept-Language: hu-HU,hu;q=0.8,en-US;q=0.5,en;q=0.3
</I>&gt;<i> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</I>&gt;<i> User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:55.0) Gecko/20100101 Firefox/55.0
</I>&gt;<i> Host: webmail.mydomain.com
</I>&gt;<i> Upgrade-Insecure-Requests: 1
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---D--
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---E--
</I>&gt;<i> &#179;&#201;(&#201;&#881;&#227;&#229;&#178;&#201;HML&#177;&#179;)&#201;,&#201;I&#181;310Vp&#203;/J&#202;LII&#883;
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i> ---3U4kCbBk---F--
</I>&gt;<i> Server: nginx/1.6.2
</I>&gt;<i> Date: Wed, 23 Aug 2017 07:10:32 GMT
</I>&gt;<i> Content-Type: text/html
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> Content-Encoding: gzip
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---H--
</I>&gt;<i> ModSecurity: Warning. Matched &quot;Operator `Eq' with parameter `0' against variable `MULTIPART_UNMATCHED_BOUNDARY' (Value: `1' ) [file &quot;/etc/nginx/modsecurity.conf&quot;] [line &quot;66&quot;] [id &quot;200004&quot;] [rev &quot;&quot;] [msg &quot;Multipart parser detected a possible unmatched boundary.&quot;] [data &quot;&quot;] [severity &quot;0&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;] [accuracy &quot;0&quot;] [ref &quot;v810,1&quot;]
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---I--
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---J--
</I>&gt;<i> 
</I>&gt;<i> ---3U4kCbBk---Z--
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Here is the detail of POST request:
</I>&gt;<i> 
</I>&gt;<i> -----------------------------186567636118947579521451609378
</I>&gt;<i> Content-Disposition: form-data; name=&quot;_token&quot;
</I>&gt;<i> 
</I>&gt;<i> nEWGe3VUF9R1K7d0SSx4rZRYkYeN849B
</I>&gt;<i> -----------------------------186567636118947579521451609378
</I>&gt;<i> Content-Disposition: form-data; name=&quot;_framed&quot;
</I>&gt;<i> 
</I>&gt;<i> 1
</I>&gt;<i> -----------------------------186567636118947579521451609378
</I>&gt;<i> Content-Disposition: form-data; name=&quot;_file&quot;; filename=&quot;airween_at_gmail.com.asc&quot;
</I>&gt;<i> Content-Type: text/plain
</I>&gt;<i> 
</I>&gt;<i> -----BEGIN PGP PUBLIC KEY BLOCK-----
</I>&gt;<i> Version: GnuPG v1
</I>&gt;<i> 
</I>&gt;<i> mQINBFhwuigBEAC+gnmOXXTEtedn5hqcjLirPM6phHGLdeqVUsD0sRDWFjgcoh7b
</I>&gt;<i> ...
</I>&gt;<i> =G+Dl
</I>&gt;<i> -----END PGP PUBLIC KEY BLOCK-----
</I>&gt;<i> 
</I>&gt;<i> -----------------------------186567636118947579521451609378
</I>&gt;<i> Content-Disposition: form-data; name=&quot;_search&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----------------------------186567636118947579521451609378--
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> This error occures when I upload the .asc file above, when I try
</I>&gt;<i> to upload a &quot;simple&quot; csv, or png, everything works as well.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> What should I do? How can I fix this error?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> a.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
-- 
ModSecurity courses Oct 2017 in London and Zurich
<A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>
<A HREF="https://www.feistyduck.com/books/modsecurity-handbook/">https://www.feistyduck.com/books/modsecurity-handbook/</A>
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
twitter: @ChrFolini
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002458.html">[Owasp-modsecurity-core-rule-set] File upload problem
</A></li>
	<LI>Next message: <A HREF="002460.html">[Owasp-modsecurity-core-rule-set] File upload problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2459">[ date ]</a>
              <a href="thread.html#2459">[ thread ]</a>
              <a href="subject.html#2459">[ subject ]</a>
              <a href="author.html#2459">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
