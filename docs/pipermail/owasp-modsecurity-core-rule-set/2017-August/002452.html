<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] 400 bad request when owasp is	enabled in detection only mode - why?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20400%20bad%20request%20when%20owasp%20is%0A%09enabled%20in%20detection%20only%20mode%20-%20why%3F&In-Reply-To=%3C89B1338F-2D6D-4322-9B99-2EE1F07193F2%40serversolution.info%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002451.html">
   <LINK REL="Next"  HREF="002453.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is	enabled in detection only mode - why?</H1>
    <B>Georgi Georgiev</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20400%20bad%20request%20when%20owasp%20is%0A%09enabled%20in%20detection%20only%20mode%20-%20why%3F&In-Reply-To=%3C89B1338F-2D6D-4322-9B99-2EE1F07193F2%40serversolution.info%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is	enabled in detection only mode - why?">georgi at serversolution.info
       </A><BR>
    <I>Tue Aug 22 15:16:50 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002451.html">[Owasp-modsecurity-core-rule-set] Announcing www.coreruleset.org	and new project logo
</A></li>
        <LI>Next message: <A HREF="002453.html">[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2452">[ date ]</a>
              <a href="thread.html#2452">[ thread ]</a>
              <a href="subject.html#2452">[ subject ]</a>
              <a href="author.html#2452">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,
If I enable crs for this domain on the Joomla search of the site it returns 400 bad request, but the modsec is in detection only mode. No rule is matched as I see. If I turn off the modsec everything is ok. This is the audit log if it helps: 

[22/Aug/2017:17:08:15 +0300] IcAcAcVcAcccAcAcAAxcAcAc 77.70.108.119 53428 127.0.0.1 80
--bc7c6349-B--
POST /index.php HTTP/2.0
host: www.plevensport.eu
content-length: 86
cache-control: max-age=0
origin: <A HREF="https://www.plevensport.eu">https://www.plevensport.eu</A>
upgrade-insecure-requests: 1
user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36
content-type: application/x-www-form-urlencoded
accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
referer: <A HREF="https://www.plevensport.eu/index.php">https://www.plevensport.eu/index.php</A>
accept-encoding: gzip, deflate, br
accept-language: en-US,en;q=0.8
cookie: 53f8f9fad3d3789bffbdbce160246b7e=3b72edc95ab809ce6dc6b3755305adf1; __utmt=1; _c=y; __utma=155943930.1578748701.1503409083.1503409083.1503409083.1; __utmb=155943930.9.10.1503409083; __utmc=155943930; __utmz=155943930.1503409083.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)

--bc7c6349-C--
searchword=%D0%BF%D0%BB%D0%B5%D0%B2%D0%B5%D0%BD&amp;task=search&amp;option=com_search&amp;Itemid=1
--bc7c6349-F--
HTTP/1.1 400
Server: ws-httpd
Content-Type: text/html
Content-Length: 568
Connection: close

--bc7c6349-E--
&lt;html&gt;
&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;
&lt;body bgcolor=&quot;white&quot;&gt;
&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
&lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
&lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
&lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
&lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;
&lt;!-- a padding to disable MSIE and Chrome friendly error page --&gt;

--bc7c6349-H--
Message: Audit log: Failed to lock global mutex: Permission denied
Apache-Handler: IIS
Stopwatch: 1503410895000281 417063 (- - -)
Stopwatch2: 1503410895000281 417063; combined=44304, p1=732, p2=42473, p3=47, p4=723, p5=229, sr=148, sw=100, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for nginx (STABLE)/2.9.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); OWASP_CRS/3.0.2.
Server: ModSecurity Standalone
Engine-Mode: &quot;ENABLED&quot;

--bc7c6349-Z--

As it&#8217;s not exactly error which can occur because of modsec but it&#8217;s obviously the problem what can be the reason? Some directive?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170822/f7df9c03/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170822/f7df9c03/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002451.html">[Owasp-modsecurity-core-rule-set] Announcing www.coreruleset.org	and new project logo
</A></li>
	<LI>Next message: <A HREF="002453.html">[Owasp-modsecurity-core-rule-set] 400 bad request when owasp is enabled in detection only mode - why?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2452">[ date ]</a>
              <a href="thread.html#2452">[ thread ]</a>
              <a href="subject.html#2452">[ subject ]</a>
              <a href="author.html#2452">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
