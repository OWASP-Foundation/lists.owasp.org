From mmitchell at backstopsolutions.com  Fri Feb  1 00:22:26 2013
From: mmitchell at backstopsolutions.com (Matt Mitchell)
Date: Fri, 1 Feb 2013 00:22:26 +0000
Subject: [Owasp-modsecurity-core-rule-set] secRemoveTargetById
Message-ID: <107EB2C5-07B0-44F6-BB62-33814F0DD15F@backstopsolutions.com>

Hey gang,

I know this isn't a CRS issue per se, but I thought you might have some insight before I either dig through the mod_security code or ask them how I should do this.

Our application occasionally wants to accept stuff that looks scary, like HTML, from certain form submissions. After some thought, I figured the best way to do this was to make a small change to the application to put "html" in the parameter name, and then use ctl:secRemoveTargetById to whitelist those rules on the way through the CRS rule set.

Here's what I tried first, for one particular rule 973333:
SecRule REQUEST_URI "." id:1000200,phase:2,pass,ctl:ruleRemoveTargetById=973333;ARGS:/[Hh]tml/

But it doesn't seem to work. Everything is being treated as normal.

I've used that REQUEST_URI-matching-anything idiom in other rules, so I don't think that is failing to match. My intention is to remove 973333 for only those arguments that match the regex. Anyone have any suggestions for me, or attempt something similar? If I can get this rule working, I'd then expect to have additional rules removing other targets that look basically the same.

Thanks in advance --

-m

From RBarnett at trustwave.com  Fri Feb  1 01:06:00 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 1 Feb 2013 01:06:00 +0000
Subject: [Owasp-modsecurity-core-rule-set] secRemoveTargetById
In-Reply-To: <107EB2C5-07B0-44F6-BB62-33814F0DD15F@backstopsolutions.com>
References: <107EB2C5-07B0-44F6-BB62-33814F0DD15F@backstopsolutions.com>
Message-ID: <C434702F-41BA-493F-B380-9B271479124E@trustwave.com>

Matt,
What version of ModSecurity are you using?

Since you don't need to do this conditionally based on request data, you could try just using the directive to remove it vs using the ctl action.  Just make sure to our this in a custom Ruke file that is read AFTER the other rules.

The ctl action should work but you might want to try the directive instead.

--
Ryan Barnett

On Jan 31, 2013, at 7:27 PM, "Matt Mitchell" <mmitchell at backstopsolutions.com> wrote:

> Hey gang,
>
> I know this isn't a CRS issue per se, but I thought you might have some insight before I either dig through the mod_security code or ask them how I should do this.
>
> Our application occasionally wants to accept stuff that looks scary, like HTML, from certain form submissions. After some thought, I figured the best way to do this was to make a small change to the application to put "html" in the parameter name, and then use ctl:secRemoveTargetById to whitelist those rules on the way through the CRS rule set.
>
> Here's what I tried first, for one particular rule 973333:
> SecRule REQUEST_URI "." id:1000200,phase:2,pass,ctl:ruleRemoveTargetById=973333;ARGS:/[Hh]tml/
>
> But it doesn't seem to work. Everything is being treated as normal.
>
> I've used that REQUEST_URI-matching-anything idiom in other rules, so I don't think that is failing to match. My intention is to remove 973333 for only those arguments that match the regex. Anyone have any suggestions for me, or attempt something similar? If I can get this rule working, I'd then expect to have additional rules removing other targets that look basically the same.
>
> Thanks in advance --
>
> -m
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Fri Feb  1 13:23:32 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 1 Feb 2013 13:23:32 +0000
Subject: [Owasp-modsecurity-core-rule-set] [PATCH]
 modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature
 for dummy connection
In-Reply-To: <01987910BF74B341B5890120BCCE77DF0D4EFC@SKYMB1.trustwave.com>
References: <CAH5b-BX_j7y8V=oArjW7hQaGXBwELmiPHRxcJuLX0mX8US9DwQ@mail.gmail.com>,
	<01987910BF74B341B5890120BCCE77DF0D4EFC@SKYMB1.trustwave.com>
Message-ID: <AD2C4800-738B-4B5B-A679-217037B6DEC1@trustwave.com>

Got your GitHub Pull request, thanks.

Just for some background on my request to use github. Using GitHub for CRS Dev is critical for collaboration and community involvement. I realize this was a minor change and *easy* to do however I want to encourage use of GitHub for all updates.

Thanks for your contribution!

--
Ryan Barnett
Lead Security Researcher
Trustwave - SpiderLabs


On Jan 31, 2013, at 5:15 PM, "Ryan Barnett" <RBarnett at trustwave.com<mailto:RBarnett at trustwave.com>> wrote:

Please use GitHub and issue a Pull request.

Thanks.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

From: yersinia <yersinia.spiros at gmail.com<mailto:yersinia.spiros at gmail.com>>
Date: Thursday, January 31, 2013 12:33 PM
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection

Patch not useful or wrong way to post it ? Just for info.

Best

On Wed, Jan 30, 2013 at 11:57 AM, Elia Pinto <yersinia.spiros at gmail.com<mailto:yersinia.spiros at gmail.com>> wrote:
When the apache HTTP Server manages its child processes, it sends a simple HTTP request back to itself.
This request will appear in the access_log file with the remote address set to the loop-back interface
and if you log the User-Agent string you will see the server signature followed by "(internal dummy connection)"
on non-SSL servers. modsecurity_crs_47_common_exceptions already contain a chained rule for skipping
the apache internal dummy connection if the connection is from the lookback address.

But if the administrator has set the directive SecServerSignature
to one of the ./modsecurity_35_bad_robots.data, for example chinaclaw, the skip rule for the internal dummy connection is not used,
because in that case the User-Agent is defined by the valued of the SecServerSignature, and
not contain the value Apache: in this case the rule 990012 will fire wrongly.
Therefore, because the skip rule it is applied already to connection from 127.0.0.1,
so it is sufficently safe, don't cause any problem to eliminate the "Apache" control also on the User-Agent variables.
It is very similar to a standard iptables setup in which it is common to put a catchall ACCEPT rule
on the loopback interface.
---
 .../modsecurity_crs_47_common_exceptions.conf      |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/base_rules/modsecurity_crs_47_common_exceptions.conf b/base_rules/modsecurity_crs_47_common_exceptions.conf
index c63cabd..eda515b 100644
--- a/base_rules/modsecurity_crs_47_common_exceptions.conf
+++ b/base_rules/modsecurity_crs_47_common_exceptions.conf
@@ -23,7 +23,7 @@ SecRule REQUEST_LINE "^GET /$" "chain,phase:2,id:'981020',t:none,pass,nolog"
 #
 SecRule REQUEST_LINE "^(GET /|OPTIONS \*) HTTP/1.0$" "chain,phase:2,id:'981021',t:none,pass,nolog"
        SecRule REMOTE_ADDR "^(127\.0\.0\.|\:\:)1$" "chain,t:none"
-               SecRule REQUEST_HEADERS:User-Agent "^Apache.*\(internal dummy connection\)$" "t:none,t:none,chain"
+               SecRule REQUEST_HEADERS:User-Agent "^.*\(internal dummy connection\)$" "t:none,t:none,chain"
                        SecRule TX:'/PROTOCOL_VIOLATION\\\/MISSING_HEADER/' ".*" "chain,setvar:tx.missing_header=+1,setvar:tx.missing_header_%{tx.missing_header}=%{matched_var_name}"
                                SecRule TX:'/MISSING_HEADER_/' "TX\:(.*)" "capture,t:none,setvar:!tx.%{tx.1}"

--
1.7.1



________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130201/45c85d32/attachment.html>

From mmitchell at backstopsolutions.com  Fri Feb  1 20:50:23 2013
From: mmitchell at backstopsolutions.com (Matt Mitchell)
Date: Fri, 1 Feb 2013 20:50:23 +0000
Subject: [Owasp-modsecurity-core-rule-set] secRemoveTargetById
In-Reply-To: <C434702F-41BA-493F-B380-9B271479124E@trustwave.com>
Message-ID: <CD31862C.8F69%mmitchell@backstopsolutions.com>

Ryan,

I'm on 2.7.1. 

By "directive" I assume you mean something like SecRuleUpdateTargetById?
Along these lines?

SecRuleUpdateTargetById 973333 !ARGS:/[Hh]tml/


I'll give that a shot. Other ideas welcome.

-m


On 1/31/13 7:06 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

>Matt,
>What version of ModSecurity are you using?
>
>Since you don't need to do this conditionally based on request data, you
>could try just using the directive to remove it vs using the ctl action.
>Just make sure to our this in a custom Ruke file that is read AFTER the
>other rules.
>
>The ctl action should work but you might want to try the directive
>instead.
>
>--
>Ryan Barnett
>
>On Jan 31, 2013, at 7:27 PM, "Matt Mitchell"
><mmitchell at backstopsolutions.com> wrote:
>
>> Hey gang,
>>
>> I know this isn't a CRS issue per se, but I thought you might have some
>>insight before I either dig through the mod_security code or ask them
>>how I should do this.
>>
>> Our application occasionally wants to accept stuff that looks scary,
>>like HTML, from certain form submissions. After some thought, I figured
>>the best way to do this was to make a small change to the application to
>>put "html" in the parameter name, and then use ctl:secRemoveTargetById
>>to whitelist those rules on the way through the CRS rule set.
>>
>> Here's what I tried first, for one particular rule 973333:
>> SecRule REQUEST_URI "."
>>id:1000200,phase:2,pass,ctl:ruleRemoveTargetById=973333;ARGS:/[Hh]tml/
>>
>> But it doesn't seem to work. Everything is being treated as normal.
>>
>> I've used that REQUEST_URI-matching-anything idiom in other rules, so I
>>don't think that is failing to match. My intention is to remove 973333
>>for only those arguments that match the regex. Anyone have any
>>suggestions for me, or attempt something similar? If I can get this rule
>>working, I'd then expect to have additional rules removing other targets
>>that look basically the same.
>>
>> Thanks in advance --
>>
>> -m
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>
>________________________________
>
>This transmission may contain information that is privileged,
>confidential, and/or exempt from disclosure under applicable law. If you
>are not the intended recipient, you are hereby notified that any
>disclosure, copying, distribution, or use of the information contained
>herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
>received this transmission in error, please immediately contact the
>sender and destroy the material in its entirety, whether in electronic or
>hard copy format.
>


From multivers88888 at yahoo.com  Wed Feb  6 14:42:49 2013
From: multivers88888 at yahoo.com (cristian nicoara)
Date: Wed, 6 Feb 2013 06:42:49 -0800 (PST)
Subject: [Owasp-modsecurity-core-rule-set] protection againts UTF-8 attack
Message-ID: <1360161769.47477.YahooMailNeo@web124705.mail.ne1.yahoo.com>

Hello, 



I currently use mod-security rules from Atomicorp . The utf-8 rules are about 6 month old and looks like this:
#UTF abuse protection 
SecRule RESPONSE_HEADERS:Content-Type "charset=utf-8" \
"phase:3,t:none,pass,nolog,setvar:global.utf8_encoding_used=1"
SecRule GLOBAL:UTF8_ENCODING_USED "@eq 1" "chain,phase:2,t:none,auditlog,status:400,msg:'Atomicorp.com - FREE UNSUPPORTED DELAYED FEED - WAF Rules: UTF8 Encoding Abuse Attack Attempt',id:'390620',rev:3,severity:'7'"
SecRule REQUEST_FILENAME|ARGS|ARGS_NAMES|!ARGS:/text/|!ARGS:/txt/ "@validateUtf8Encoding"


I found reports about this to be buggy and I played with it a little , the behavior looks like this:
1.? the first rule is setting the global.utf8_encoding_used=1 , when RESPONSE_HEADERS contains charset=utf-8 .(actually one of my servers send charset=UTF=8 and the variable was never set, that is why I had different behavior)
2. the second rule, during phase 2, if global.utf8_encoding_used=1 and the third rule is a match , then status=400 is returned 


This looks like it's generating some false positives (reacting to &nbsp %C2%A0%) but it also behaves OK, for instance when bytes are missing, this is exactly what @validateUtf8Encoding is doing.
Also I noticed that the approach on the new AtomiCorp and on Owasp is not so intrusive , rather it just logging .. 


What do more experienced people think? Maybe I am not looking where I should. Can you help me in giving me some directions?

Thank you.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130206/d9980f16/attachment.html>

From cmbnetworks at gmail.com  Sun Feb 10 14:01:55 2013
From: cmbnetworks at gmail.com (Corey Bobb)
Date: Sun, 10 Feb 2013 09:01:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] Apache start-up issue with Rule
	Sets
Message-ID: <CAA2ZHnLvFT+1uMFN10_mvyqv-r=7eG58hZncdopOTD+15BZDTg@mail.gmail.com>

 Restarting web server
apache2
apache2: Syntax error on line 208 of /etc/apache2/apache2.conf: Syntax
error on line 2 of /etc/apache2/httpd.conf: Syntax error on line 51 of
/etc/apache2/modsecurity/modsecurity_crs_40_generic_attacks.conf: Expected
</link> but saw </head>


I am getting this error when I add the rule sets to the apache config.  I
have tried loading it a bunch of different ways, but cannot seem to get it
quite right.

It is installed on Ubuntu 10.04,

I have the modsecurity_crs_10_config.conf installed in /etc/apache2/conf.d

I have the rules installed in /etc/apache2/modsecurity/

When I start / restart apache I get the error at top of this message, what
am I missing?

Thanks in advance.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130210/05d47966/attachment.html>

From jamuse at owasp.org  Sun Feb 10 14:17:06 2013
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Sun, 10 Feb 2013 16:17:06 +0200
Subject: [Owasp-modsecurity-core-rule-set] Apache start-up issue with
	Rule Sets
In-Reply-To: <CAA2ZHnLvFT+1uMFN10_mvyqv-r=7eG58hZncdopOTD+15BZDTg@mail.gmail.com>
References: <CAA2ZHnLvFT+1uMFN10_mvyqv-r=7eG58hZncdopOTD+15BZDTg@mail.gmail.com>
Message-ID: <CAC+O4mH2Fhz_RmpKhz9LSqcKx21anjNYV_15GDqETS-BFxGQLA@mail.gmail.com>

On Sun, Feb 10, 2013 at 4:01 PM, Corey Bobb <cmbnetworks at gmail.com> wrote:

>  Restarting web server
> apache2
> apache2: Syntax error on line 208 of /etc/apache2/apache2.conf: Syntax
> error on line 2 of /etc/apache2/httpd.conf: Syntax error on line 51 of
> /etc/apache2/modsecurity/modsecurity_crs_40_generic_attacks.conf: Expected
> </link> but saw </head>
>
>
> I am getting this error when I add the rule sets to the apache config.  I
> have tried loading it a bunch of different ways, but cannot seem to get it
> quite right.
>
>
Hi Corey,

How are you including the CRS rules? What version of ModSecurity and the
CRS are you running?

--
 - Josh


> It is installed on Ubuntu 10.04,
>
> I have the modsecurity_crs_10_config.conf installed in /etc/apache2/conf.d
>
> I have the rules installed in /etc/apache2/modsecurity/
>
> When I start / restart apache I get the error at top of this message, what
> am I missing?
>
> Thanks in advance.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130210/1f04b252/attachment.html>

From RBarnett at trustwave.com  Sun Feb 10 14:51:28 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Sun, 10 Feb 2013 14:51:28 +0000
Subject: [Owasp-modsecurity-core-rule-set] Apache start-up issue with
 Rule	Sets
In-Reply-To: <CAA2ZHnLvFT+1uMFN10_mvyqv-r=7eG58hZncdopOTD+15BZDTg@mail.gmail.com>
References: <CAA2ZHnLvFT+1uMFN10_mvyqv-r=7eG58hZncdopOTD+15BZDTg@mail.gmail.com>
Message-ID: <3FE665A3-D0AA-48C1-9AFC-60400D9FB487@trustwave.com>

What is on line 51 of your CRS 40 generic attacks conf file?

--
Ryan Barnett
Lead Security Researcher
Trustwave - SpiderLabs

On Feb 10, 2013, at 9:10 AM, "Corey Bobb" <cmbnetworks at gmail.com> wrote:

>  Restarting web server apache2                                                                                                                                                                                                             apache2: Syntax error on line 208 of /etc/apache2/apache2.conf: Syntax error on line 2 of /etc/apache2/httpd.conf: Syntax error on line 51 of /etc/apache2/modsecurity/modsecurity_crs_40_generic_attacks.conf: Expected </link> but saw </head>
>
>
> I am getting this error when I add the rule sets to the apache config.  I have tried loading it a bunch of different ways, but cannot seem to get it quite right.
>
> It is installed on Ubuntu 10.04,
>
> I have the modsecurity_crs_10_config.conf installed in /etc/apache2/conf.d
>
> I have the rules installed in /etc/apache2/modsecurity/
>
> When I start / restart apache I get the error at top of this message, what am I missing?
>
> Thanks in advance.
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From jzy2000 at hotmail.com  Wed Feb 13 17:08:55 2013
From: jzy2000 at hotmail.com (Rolling Stone)
Date: Wed, 13 Feb 2013 12:08:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] LibInjection
In-Reply-To: <01987910BF74B341B5890120BCCE77DF0D4F20@SKYMB1.trustwave.com>
References: <SNT128-DS1391C71D20CD580C6762E4A41D0@phx.gbl>
	<01987910BF74B341B5890120BCCE77DF0D4F20@SKYMB1.trustwave.com>
Message-ID: <SNT128-DS1588F9D7B90AA1851BA9AAA4080@phx.gbl>

Hi Ryan, 

 

Adding "t:normalizeSQLi" for custom SQLi rules make perfect sense to me. 

 

I am also thinking if it makes sense to transform existing ModSecurity
signatures to libinjection fingerprints as well. So that ModSecurity will
work uniformly by calling libinjection using a single set of fingerprint
merged from both sources for SQLi and also share same level of accuracy, as
supposed to chaining the two together?

 

However, it will be interesting to learn the coverage in libinjection
fingerprint and Modsecurity signature, any thoughts on that?

 

I am about to plan this work based upon your feedback.

 

Thanks,

RS.

 

From: Ryan Barnett [mailto:RBarnett at trustwave.com] 
Sent: January-31-13 5:22 PM
To: Rolling Stone; 'Ryan Barnett';
owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] LibInjection

 

I agree with you that libinjection could be used potentially in all three of
the scenarios you outlined.  Our discussions so far have centered around
adding it as a new operator such as - @detectSQLi and you would pass it a
parameter which is the fingerprints.txt file -

 

SecRule ARGS "@detectSQLi fingerprints.txt"

 

The libinjection code would need to be updated to allow for passing the
fingerprints.txt file data rather than to have it compiled in as it is
today.  This would allow for updating fingerprints without the need to
recompile ModSecurity code.

 

As to your first point - I see value there as well.  The idea would be to
add a new transformation function such as - t:normalizeSQLi and then add it
to all SQLi signatures that you write.  This transformation function would
do the normalization/tokenization of the data.  This would then allow you to
write your signatures and rules in an easier manner as you wouldn't have to
account for the myriad of permutations and combinations of evasion.

 

Bottom line is that I see a lot of uses for this feature :)  I would LOVE
for someone to help.

 

-RB

 

 

From: Rolling Stone <jzy2000 at hotmail.com>
Date: Thursday, January 31, 2013 11:11 AM
To: Ryan Barnett <ryan.barnett at owasp.org>,
"owasp-modsecurity-core-rule-set at lists.owasp.org"
<owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] LibInjection

 

If my understanding correctly, there are possible 3 ways for libinjection to
be useful:

-Normalizing user input, to make CRS signature-based SQLi detection works
better.

-Streamlining signature-based SQLi detection and libinjection to improve
SQLi detection rate.

-Or, libinjection and fingerprint detection as replacement to
signature-based SQLi.

 

Which direction makes more sense if community support available?

Thanks,

-RS

 

From: Ryan Barnett [mailto:ryan.barnett at owasp.org] 
Sent: January-30-13 11:23 AM
To: Rolling Stone; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] LibInjection

 

No, not yet.  Breno will get to it eventually, however this could be
expedited if someone from the community wants to help.

 

-Ryan

 

From: Rolling Stone <jzy2000 at hotmail.com>
Date: Wednesday, January 30, 2013 11:20 AM
To: <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: [Owasp-modsecurity-core-rule-set] LibInjection

 

CRS Roadmap has plan to include C Libinjection, any idea when will this
integration be completed?

 

Thanks,

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
<https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>  

 

  _____  


This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130213/a7c993aa/attachment.html>

From RBarnett at trustwave.com  Wed Feb 13 21:08:43 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 13 Feb 2013 21:08:43 +0000
Subject: [Owasp-modsecurity-core-rule-set] LibInjection
In-Reply-To: <SNT128-DS1588F9D7B90AA1851BA9AAA4080@phx.gbl>
Message-ID: <01987910BF74B341B5890120BCCE77DF25AD82@SKYMB1.trustwave.com>

I actually like both ideas.  I think having the @detectSQLi operator with the path the fingerprints.txt file is a good approach as it would allow the rule itself to stay the same but the fingerprints.txt file can simply be update as new payloads are captured.

As for adding a new t:normalizeSQLi transformation function, I think it could have value, however we would need to revalidate/update all of the other SQLi rules to account for the normalizing that libinjection would do.  I am not saying that this is a bad thing, just needed.

I think adding libinjection code in any capacity would be a great step forward.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

From: Rolling Stone <jzy2000 at hotmail.com<mailto:jzy2000 at hotmail.com>>
Date: Wednesday, February 13, 2013 12:08 PM
To: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>, Ryan Barnett <ryan.barnett at owasp.org<mailto:ryan.barnett at owasp.org>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: RE: [Owasp-modsecurity-core-rule-set] LibInjection

Hi Ryan,

Adding ?t:normalizeSQLi? for custom SQLi rules make perfect sense to me.

I am also thinking if it makes sense to transform existing ModSecurity signatures to libinjection fingerprints as well. So that ModSecurity will work uniformly by calling libinjection using a single set of fingerprint merged from both sources for SQLi and also share same level of accuracy, as supposed to chaining the two together?

However, it will be interesting to learn the coverage in libinjection fingerprint and Modsecurity signature, any thoughts on that?

I am about to plan this work based upon your feedback.

Thanks,
RS.

From: Ryan Barnett [mailto:RBarnett at trustwave.com]
Sent: January-31-13 5:22 PM
To: Rolling Stone; 'Ryan Barnett'; owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] LibInjection

I agree with you that libinjection could be used potentially in all three of the scenarios you outlined.  Our discussions so far have centered around adding it as a new operator such as - @detectSQLi and you would pass it a parameter which is the fingerprints.txt file -

SecRule ARGS "@detectSQLi fingerprints.txt"

The libinjection code would need to be updated to allow for passing the fingerprints.txt file data rather than to have it compiled in as it is today.  This would allow for updating fingerprints without the need to recompile ModSecurity code.

As to your first point ? I see value there as well.  The idea would be to add a new transformation function such as ? t:normalizeSQLi and then add it to all SQLi signatures that you write.  This transformation function would do the normalization/tokenization of the data.  This would then allow you to write your signatures and rules in an easier manner as you wouldn't have to account for the myriad of permutations and combinations of evasion.

Bottom line is that I see a lot of uses for this feature :)  I would LOVE for someone to help.

-RB


From: Rolling Stone <jzy2000 at hotmail.com<mailto:jzy2000 at hotmail.com>>
Date: Thursday, January 31, 2013 11:11 AM
To: Ryan Barnett <ryan.barnett at owasp.org<mailto:ryan.barnett at owasp.org>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] LibInjection

If my understanding correctly, there are possible 3 ways for libinjection to be useful:
-Normalizing user input, to make CRS signature-based SQLi detection works better.
-Streamlining signature-based SQLi detection and libinjection to improve SQLi detection rate.
-Or, libinjection and fingerprint detection as replacement to signature-based SQLi.

Which direction makes more sense if community support available?
Thanks,
-RS

From: Ryan Barnett [mailto:ryan.barnett at owasp.org]
Sent: January-30-13 11:23 AM
To: Rolling Stone; owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] LibInjection

No, not yet.  Breno will get to it eventually, however this could be expedited if someone from the community wants to help.

-Ryan

From: Rolling Stone <jzy2000 at hotmail.com<mailto:jzy2000 at hotmail.com>>
Date: Wednesday, January 30, 2013 11:20 AM
To: <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] LibInjection

CRS Roadmap has plan to include C Libinjection, any idea when will this integration be completed?

Thanks,
_______________________________________________ Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130213/b68c76f3/attachment-0001.html>

From anders at kvistmail.dk  Thu Feb 14 10:20:14 2013
From: anders at kvistmail.dk (Anders Kvist)
Date: Thu, 14 Feb 2013 11:20:14 +0100
Subject: [Owasp-modsecurity-core-rule-set] Question about rule 981301-981316
	from modsecurity_crs_41_sql_injection_attacks.conf
Message-ID: <511CBA5E.2010202@kvistmail.dk>

Hi

I've seen some false positives with the rules mentioned in the subject...

They match for SQL keywords with the @contains operator and not the 
@containsWord operator and therefore we see some false positives. I've 
done some tests where I use @containsWord instead and it seems to work 
and it still blocks if the words are preset...

For example, I see a username, "havingfun", which matches "having" 
because of @contains...

Does anyone know why the rules uses @contains and not @containsWord?


/Anders

From leonardo at lbasolutions.com  Thu Feb 14 10:47:56 2013
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Thu, 14 Feb 2013 08:47:56 -0200
Subject: [Owasp-modsecurity-core-rule-set] disable modsecurity on specific
	port
Message-ID: <CAG+8EEYn8Jc8h_jaTsHGc9VNogF+z5hurwDSm11RjQxUebv+ZQ@mail.gmail.com>

Hi guys!

I'm using virtual hosts on port 80 and others ports like 8081, 8083.
I would like to turn modsecurity off for one specific port on my server (8081).

I don't know how to do it. Can you help me please ?

many thanks!

From jamuse at owasp.org  Thu Feb 14 10:58:28 2013
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Thu, 14 Feb 2013 12:58:28 +0200
Subject: [Owasp-modsecurity-core-rule-set] disable modsecurity on
	specific port
In-Reply-To: <CAG+8EEYn8Jc8h_jaTsHGc9VNogF+z5hurwDSm11RjQxUebv+ZQ@mail.gmail.com>
References: <CAG+8EEYn8Jc8h_jaTsHGc9VNogF+z5hurwDSm11RjQxUebv+ZQ@mail.gmail.com>
Message-ID: <CAC+O4mFbtr0mfiTVUVUQttRXcNpon2X0ag-2jLy6ch8oWTKziA@mail.gmail.com>

On Thu, Feb 14, 2013 at 12:47 PM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hi guys!
>
> I'm using virtual hosts on port 80 and others ports like 8081, 8083.
> I would like to turn modsecurity off for one specific port on my server
> (8081).
>
> I don't know how to do it. Can you help me please ?
>
>
Hi Leonardo,

Can you simply include the ModSecurity rules/configs only in the
appropriate virtual hosts as opposed to enabling it globally?

--
 - Josh


> many thanks!
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130214/a3fec306/attachment.html>

From leonardo at lbasolutions.com  Thu Feb 14 11:10:32 2013
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Thu, 14 Feb 2013 09:10:32 -0200
Subject: [Owasp-modsecurity-core-rule-set] disable modsecurity on
	specific port
In-Reply-To: <CAC+O4mFbtr0mfiTVUVUQttRXcNpon2X0ag-2jLy6ch8oWTKziA@mail.gmail.com>
References: <CAG+8EEYn8Jc8h_jaTsHGc9VNogF+z5hurwDSm11RjQxUebv+ZQ@mail.gmail.com>
	<CAC+O4mFbtr0mfiTVUVUQttRXcNpon2X0ag-2jLy6ch8oWTKziA@mail.gmail.com>
Message-ID: <CAG+8EEZqMHt+qUHmH=fW7Zr2b_ci8ZP2VoGm5NBm7n1UW_P3tA@mail.gmail.com>

Hi Josh,

I solved it including on virtual host config (apache)

        <IfModule security2_module>
                SecRuleEngine Off
        </IfModule>

many thanks!


On Thu, Feb 14, 2013 at 8:58 AM, Josh Amishav-Zlatin <jamuse at owasp.org> wrote:
> On Thu, Feb 14, 2013 at 12:47 PM, Leonardo Bacha Abrantes
> <leonardo at lbasolutions.com> wrote:
>>
>> Hi guys!
>>
>> I'm using virtual hosts on port 80 and others ports like 8081, 8083.
>> I would like to turn modsecurity off for one specific port on my server
>> (8081).
>>
>> I don't know how to do it. Can you help me please ?
>>
>
> Hi Leonardo,
>
> Can you simply include the ModSecurity rules/configs only in the appropriate
> virtual hosts as opposed to enabling it globally?
>
> --
>  - Josh
>
>>
>> many thanks!
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>

From RBarnett at trustwave.com  Fri Feb 15 13:29:07 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 15 Feb 2013 13:29:07 +0000
Subject: [Owasp-modsecurity-core-rule-set] Question about rule
 981301-981316 from modsecurity_crs_41_sql_injection_attacks.conf
In-Reply-To: <511CBA5E.2010202@kvistmail.dk>
Message-ID: <01987910BF74B341B5890120BCCE77DF271797@SKYMB1.trustwave.com>




On 2/14/13 5:20 AM, "Anders Kvist" <anders at kvistmail.dk> wrote:

>Hi
>
>I've seen some false positives with the rules mentioned in the subject...
>
>They match for SQL keywords with the @contains operator and not the
>@containsWord operator and therefore we see some false positives. I've
>done some tests where I use @containsWord instead and it seems to work
>and it still blocks if the words are preset...
>
>For example, I see a username, "havingfun", which matches "having"
>because of @contains...
>
>Does anyone know why the rules uses @contains and not @containsWord?

Good recommendation.  I just updated the GitHub repo and changed many of
those rules to use @containsWord instead.

-Ryan

>
>
>/Anders
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Fri Feb 15 20:15:52 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 15 Feb 2013 20:15:52 +0000
Subject: [Owasp-modsecurity-core-rule-set] Setting HoneyTraps with
	ModSecurity: Unused Web Ports
In-Reply-To: <01987910BF74B341B5890120BCCE77DF0AA5F9@SKYMB1.trustwave.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF27203D@SKYMB1.trustwave.com>

Resending to the list.

Anyone game to try this out???

The honeypot sensor configs are on the OWASP CRS /util directory - https://github.com/SpiderLabs/owasp-modsecurity-crs/tree/master/util/honeypot_sensor

-Ryan

From: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>
Date: Monday, December 17, 2012 4:32 PM
To: "mod-security-users at lists.sourceforge.net<mailto:mod-security-users at lists.sourceforge.net>" <mod-security-users at lists.sourceforge.net<mailto:mod-security-users at lists.sourceforge.net>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Setting HoneyTraps with ModSecurity: Unused Web Ports

I posted this today - http://blog.spiderlabs.com/2012/12/setting-honeytraps-with-modsecurity-unused-web-ports.html

I am hoping that you find it useful and that some folks will consider setting this up and sending logs to our WASC Distributed Web Honeypots central logging server.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130215/1d0f0820/attachment.html>

From Olivier.Demin at generali.be  Sat Feb 16 11:45:13 2013
From: Olivier.Demin at generali.be (Demin Olivier)
Date: Sat, 16 Feb 2013 12:45:13 +0100
Subject: [Owasp-modsecurity-core-rule-set] slow dos attacks detection problem
Message-ID: <6FDC88A9834BCC47ACC16EC4B87A5CD8030701D5@BE000000VAS03.be.top.com>


Hello,

I'm using the CRS 2.2.7 with mod security 2.7.2 and apache 2.2.14 on Linux Ubuntu.  I seem to have troubles with the modsecurity crs 11 slow dos protection.conf from the experimental ruleset.  In fact, the reqtimeout module is working fine and fires 408 errors after the specified number of seconds when I don't provide the HTTP header fast enough (I tested that by simply performing manual telnet sessions on the port 80 of my server).  But these 408 errors seem not to be intercepted by mod security at all.  Indeed, when I enable the maximum debug logs (level 9), nothing is appended in the debug log upon 408 firing:  no trace of any rule being checked in that particular case.

So it seems that the reqtimeout module returns in a way that prevents mod security from being activated.

Did any of you encounter similar problems?

Thanks for your help

Olivier Demin
###########################################<br>GENERALI BELGIUM NV-SA - Verzekeringen-Assurances<br>Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles<br>Ondernemingsnummer 0403.262.553 Num?ro d'entreprise<br>RPR Brussel - RPM Bruxelles<br>###########################################<br>This e-mail and any files transmitted with it are confidential and<br>intended solely for the use of the individual or entity to whom they <br>are addressed. If you have received this e-mail in error please notify <br>the system manager.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130216/954bd776/attachment.html>

From RBarnett at trustwave.com  Sat Feb 16 14:19:21 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Sat, 16 Feb 2013 14:19:21 +0000
Subject: [Owasp-modsecurity-core-rule-set] slow dos attacks detection
 problem
In-Reply-To: <6FDC88A9834BCC47ACC16EC4B87A5CD8030701D5@BE000000VAS03.be.top.com>
References: <6FDC88A9834BCC47ACC16EC4B87A5CD8030701D5@BE000000VAS03.be.top.com>
Message-ID: <FD28775D-F04F-46A9-AE0B-546B08ACDAC9@trustwave.com>

See this blog post -
http://blog.spiderlabs.com/2011/07/advanced-topic-of-the-week-mitigating-slow-http-dos-attacks.html


Caution: there are several reports that mod_reqtimeoutdoes not issue a 408 status code under various conditions<http://old.nabble.com/-users at httpd--mod_reqtimeout-not-returning-408-td31405422.html>.  This means that this implementation described below may not work reliably.

http://apache-http-server.18135.n6.nabble.com/users-httpd-mod-reqtimeout-not-returning-408-td4770478.html

--
Ryan Barnett
Lead Security Researcher
Trustwave - SpiderLabs

On Feb 16, 2013, at 6:50 AM, "Demin Olivier" <Olivier.Demin at generali.be<mailto:Olivier.Demin at generali.be>> wrote:



Hello,

I'm using the CRS 2.2.7 with mod security 2.7.2 and apache 2.2.14 on Linux Ubuntu.  I seem to have troubles with the modsecurity crs 11 slow dos protection.conf from the experimental ruleset.  In fact, the reqtimeout module is working fine and fires 408 errors after the specified number of seconds when I don't provide the HTTP header fast enough (I tested that by simply performing manual telnet sessions on the port 80 of my server).  But these 408 errors seem not to be intercepted by mod security at all.  Indeed, when I enable the maximum debug logs (level 9), nothing is appended in the debug log upon 408 firing:  no trace of any rule being checked in that particular case.

So it seems that the reqtimeout module returns in a way that prevents mod security from being activated.

Did any of you encounter similar problems?

Thanks for your help

Olivier Demin

###########################################
GENERALI BELGIUM NV-SA - Verzekeringen-Assurances
Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles
Ondernemingsnummer 0403.262.553 Num?ro d'entreprise
RPR Brussel - RPM Bruxelles
###########################################
This e-mail and any files transmitted with it are confidential and
intended solely for the use of the individual or entity to whom they
are addressed. If you have received this e-mail in error please notify
the system manager.
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130216/5cf340e6/attachment.html>

From Olivier.Demin at generali.be  Mon Feb 18 08:08:05 2013
From: Olivier.Demin at generali.be (Demin Olivier)
Date: Mon, 18 Feb 2013 09:08:05 +0100
Subject: [Owasp-modsecurity-core-rule-set] slow dos attacks detection
	problem
In-Reply-To: <FD28775D-F04F-46A9-AE0B-546B08ACDAC9@trustwave.com>
References: <6FDC88A9834BCC47ACC16EC4B87A5CD8030701D5@BE000000VAS03.be.top.com>
	<FD28775D-F04F-46A9-AE0B-546B08ACDAC9@trustwave.com>
Message-ID: <6FDC88A9834BCC47ACC16EC4B87A5CD805846AE9@BE000000VAS03.be.top.com>

Hi Ryan,

 

I had read these posts already, but I don't think that this is the problem in my case.  Here is what I get from the server: 

 

 

 

You can see that a status 408 is returned, not a 200.  In addition, I also have the following line in my apache access log:

80.201.47.144 - - [17/Feb/2013:11:01:26 -0500] "GET / HTTP/1.1" 408 498 "-" "-"

 

But nothing is written to the modsec debug log at all...

 

So I think it's a different problem than the one referred to in the posts you provided.  Any other thought or hint that could put me on the right track ?

 

Thanks

Olivier Demin

Head of Front Department/IT Change

Solution Architect

Tel:                                        +32 (0)2 403 8083

Mobile:                                +32 (0)473 83 10 29

Avenue Louise 149          Mail: olivier.demin at generali.be 

B-1050 Bruxelles               Site: www.generali.be <http://www.generali.be/> 

P Please consider your environmental responsibility before printing this e-mail, thanks for the planet.

 

From: Ryan Barnett [mailto:RBarnett at trustwave.com] 
Sent: samedi 16 f?vrier 2013 15:19
To: Demin Olivier
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] slow dos attacks detection problem

 

See this blog post -

http://blog.spiderlabs.com/2011/07/advanced-topic-of-the-week-mitigating-slow-http-dos-attacks.html

Caution: there are several reports that mod reqtimeoutdoes not issue a 408 status code under various conditions <http://old.nabble.com/-users at httpd--mod reqtimeout-not-returning-408-td31405422.html> .  This means that this implementation described below may not work reliably.

http://apache-http-server.18135.n6.nabble.com/users-httpd-mod-reqtimeout-not-returning-408-td4770478.html

 

--

Ryan Barnett

Lead Security Researcher

Trustwave - SpiderLabs


On Feb 16, 2013, at 6:50 AM, "Demin Olivier" <Olivier.Demin at generali.be> wrote:

	 

	Hello,
	
	I'm using the CRS 2.2.7 with mod security 2.7.2 and apache 2.2.14 on Linux Ubuntu.  I seem to have troubles with the modsecurity crs 11 slow dos protection.conf from the experimental ruleset.  In fact, the reqtimeout module is working fine and fires 408 errors after the specified number of seconds when I don't provide the HTTP header fast enough (I tested that by simply performing manual telnet sessions on the port 80 of my server).  But these 408 errors seem not to be intercepted by mod security at all.  Indeed, when I enable the maximum debug logs (level 9), nothing is appended in the debug log upon 408 firing:  no trace of any rule being checked in that particular case.
	
	So it seems that the reqtimeout module returns in a way that prevents mod security from being activated.
	
	Did any of you encounter similar problems?
	
	Thanks for your help
	
	Olivier Demin 

	
	###########################################
	GENERALI BELGIUM NV-SA - Verzekeringen-Assurances
	Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles
	Ondernemingsnummer 0403.262.553 Num?ro d'entreprise
	RPR Brussel - RPM Bruxelles
	###########################################
	This e-mail and any files transmitted with it are confidential and
	intended solely for the use of the individual or entity to whom they 
	are addressed. If you have received this e-mail in error please notify 
	the system manager. 

	                                               
	Owasp-modsecurity-core-rule-set mailing list
	Owasp-modsecurity-core-rule-set at lists.owasp.org
	https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

 

                                


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

###########################################<br>GENERALI BELGIUM NV-SA - Verzekeringen-Assurances<br>Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles<br>Ondernemingsnummer 0403.262.553 Num?ro d'entreprise<br>RPR Brussel - RPM Bruxelles<br>###########################################<br>This e-mail and any files transmitted with it are confidential and<br>intended solely for the use of the individual or entity to whom they <br>are addressed. If you have received this e-mail in error please notify <br>the system manager.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130218/74cc8534/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: image002.png
Type: image/png
Size: 15870 bytes
Desc: image002.png
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130218/74cc8534/attachment-0001.png>

From ryan.barnett at owasp.org  Mon Feb 18 13:32:23 2013
From: ryan.barnett at owasp.org (Ryan Barnett)
Date: Mon, 18 Feb 2013 08:32:23 -0500
Subject: [Owasp-modsecurity-core-rule-set] slow dos attacks detection
	problem
In-Reply-To: <6FDC88A9834BCC47ACC16EC4B87A5CD805846AE9@BE000000VAS03.be.top.com>
References: <6FDC88A9834BCC47ACC16EC4B87A5CD8030701D5@BE000000VAS03.be.top.com>
	<FD28775D-F04F-46A9-AE0B-546B08ACDAC9@trustwave.com>
	<6FDC88A9834BCC47ACC16EC4B87A5CD805846AE9@BE000000VAS03.be.top.com>
Message-ID: <7E153CAD-2BB5-43A2-956D-4A85DCD87D84@owasp.org>

In order for ModSecurity to "see" the request and assign a unique ID to it, make sure it is running in apache post-read-request hook for phase:1 by using --enable-request-early configure flag. 

Try that and see if it helps. 

--
Ryan Barnett
Lead Security Researcher
Trustwave - SpiderLabs

On Feb 18, 2013, at 3:08 AM, "Demin Olivier" <Olivier.Demin at generali.be> wrote:

> Hi Ryan,
>  
> I had read these posts already, but I don?t think that this is the problem in my case.  Here is what I get from the server:
>  
> <image002.png>
>  
> You can see that a status 408 is returned, not a 200.  In addition, I also have the following line in my apache access log:
> 80.201.47.144 - - [17/Feb/2013:11:01:26 -0500] "GET / HTTP/1.1" 408 498 "-" "-"
>  
> But nothing is written to the modsec debug log at all?
>  
> So I think it?s a different problem than the one referred to in the posts you provided.  Any other thought or hint that could put me on the right track ?
>  
> Thanks
> Olivier Demin
> Head of Front Department/IT Change
> Solution Architect
> Tel:                                        +32 (0)2 403 8083
> Mobile:                                +32 (0)473 83 10 29
> Avenue Louise 149          Mail: olivier.demin at generali.be
> B-1050 Bruxelles               Site: www.generali.be
> P Please consider your environmental responsibility before printing this e-mail, thanks for the planet.
>  
> From: Ryan Barnett [mailto:RBarnett at trustwave.com] 
> Sent: samedi 16 f?vrier 2013 15:19
> To: Demin Olivier
> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] slow dos attacks detection problem
>  
> See this blog post -
> http://blog.spiderlabs.com/2011/07/advanced-topic-of-the-week-mitigating-slow-http-dos-attacks.html
> 
> Caution: there are several reports that mod reqtimeoutdoes not issue a 408 status code under various conditions.  This means that this implementation described below may not work reliably.
> 
> http://apache-http-server.18135.n6.nabble.com/users-httpd-mod-reqtimeout-not-returning-408-td4770478.html
>  
> --
> Ryan Barnett
> Lead Security Researcher
> Trustwave - SpiderLabs
> 
> On Feb 16, 2013, at 6:50 AM, "Demin Olivier" <Olivier.Demin at generali.be> wrote:
> 
>  
> Hello,
> 
> I'm using the CRS 2.2.7 with mod security 2.7.2 and apache 2.2.14 on Linux Ubuntu.  I seem to have troubles with the modsecurity crs 11 slow dos protection.conf from the experimental ruleset.  In fact, the reqtimeout module is working fine and fires 408 errors after the specified number of seconds when I don't provide the HTTP header fast enough (I tested that by simply performing manual telnet sessions on the port 80 of my server).  But these 408 errors seem not to be intercepted by mod security at all.  Indeed, when I enable the maximum debug logs (level 9), nothing is appended in the debug log upon 408 firing:  no trace of any rule being checked in that particular case.
> 
> So it seems that the reqtimeout module returns in a way that prevents mod security from being activated.
> 
> Did any of you encounter similar problems?
> 
> Thanks for your help
> 
> Olivier Demin
> 
> 
> ###########################################
> GENERALI BELGIUM NV-SA - Verzekeringen-Assurances
> Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles
> Ondernemingsnummer 0403.262.553 Num?ro d'entreprise
> RPR Brussel - RPM Bruxelles
> ###########################################
> This e-mail and any files transmitted with it are confidential and
> intended solely for the use of the individual or entity to whom they 
> are addressed. If you have received this e-mail in error please notify 
> the system manager.
> 
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>  
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 
> ###########################################
> GENERALI BELGIUM NV-SA - Verzekeringen-Assurances
> Louizalaan 149 Avenue Louise - Brussel 1050 Bruxelles
> Ondernemingsnummer 0403.262.553 Num?ro d'entreprise
> RPR Brussel - RPM Bruxelles
> ###########################################
> This e-mail and any files transmitted with it are confidential and
> intended solely for the use of the individual or entity to whom they 
> are addressed. If you have received this e-mail in error please notify 
> the system manager.
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130218/a6f03648/attachment.html>

From leonardo at lbasolutions.com  Mon Feb 18 15:44:54 2013
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Mon, 18 Feb 2013 12:44:54 -0300
Subject: [Owasp-modsecurity-core-rule-set] block bad bot
Message-ID: <CAG+8EEZA32PQFUQbZmgJyomiwsMjGXucFj8xfsGSc1dm3RPfog@mail.gmail.com>

Hi guys,

Yandex, which ignores robots.txt, has been indexing my site.
I tried to block on httpd.conf with these configurations below but didn't
work.

SetEnvIfNoCase User-Agent "^YandexBot*" bad_bot
<Directory />
        Order Allow,Deny
        Allow from all
        Deny from env=bad_bot
</Directory>


How can I try to block it on modsecurity ?


->> apache log:

199.21.99.86 - - [18/Feb/2013:11:20:37 -0300] "GET / HTTP/1.1" *200* 8663
"-" "Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)"
199.21.99.86 - - [18/Feb/2013:11:21:29 -0300] "GET
/files_on_my_server/abc.pdf HTTP/1.1" *200 *97637 "-" "Mozilla/5.0
(compatible; YandexBot/3.0; +http://yandex.com/bots)"

many thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130218/44e6b959/attachment.html>

From jamuse at owasp.org  Tue Feb 19 08:33:40 2013
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Tue, 19 Feb 2013 10:33:40 +0200
Subject: [Owasp-modsecurity-core-rule-set] block bad bot
In-Reply-To: <CAG+8EEZA32PQFUQbZmgJyomiwsMjGXucFj8xfsGSc1dm3RPfog@mail.gmail.com>
References: <CAG+8EEZA32PQFUQbZmgJyomiwsMjGXucFj8xfsGSc1dm3RPfog@mail.gmail.com>
Message-ID: <CAC+O4mGYAE+4jEc9yHxhUn6+t6JXsLHfiyO+thixd_JcJ1sUww@mail.gmail.com>

On Mon, Feb 18, 2013 at 5:44 PM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hi guys,
>
> Yandex, which ignores robots.txt, has been indexing my site.
> I tried to block on httpd.conf with these configurations below but didn't
> work.
>
> SetEnvIfNoCase User-Agent "^YandexBot*" bad_bot
> <Directory />
>         Order Allow,Deny
>         Allow from all
>         Deny from env=bad_bot
> </Directory>
>
>
> How can I try to block it on modsecurity ?
>
>
Hi Leonardo,

Have you tried using a rule like:

SecRule REQUEST_HEADERS:User-Agent yandexbot
"phase:2,id:1,t:none,t:lowercase,block,msg:'YandexBot identified'"

If your using the CRS you could simply add the user-agent string to
the modsecurity_35_bad_robots.data file.

--
 - Josh


>
> ->> apache log:
>
> 199.21.99.86 - - [18/Feb/2013:11:20:37 -0300] "GET / HTTP/1.1" *200* 8663
> "-" "Mozilla/5.0 (compatible; YandexBot/3.0; +http://yandex.com/bots)"
> 199.21.99.86 - - [18/Feb/2013:11:21:29 -0300] "GET
> /files_on_my_server/abc.pdf HTTP/1.1" *200 *97637 "-" "Mozilla/5.0
> (compatible; YandexBot/3.0; +http://yandex.com/bots)"
>
> many thanks!
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130219/533d85df/attachment-0001.html>

From colin.watson at owasp.org  Fri Feb 22 16:09:49 2013
From: colin.watson at owasp.org (Colin Watson)
Date: Fri, 22 Feb 2013 16:09:49 +0000
Subject: [Owasp-modsecurity-core-rule-set] AppSensor cross-referencing
Message-ID: <CAAxdBBnDkZcxj25ZoS0B9dZYoVvi-zfc-m5UjNrUjAJNT__5aA@mail.gmail.com>

I have updated the AppSensor Detection Point wiki page to reflect what
is tagged in CRS v2.2.7:

  https://www.owasp.org/index.php/AppSensor_DetectionPoints

Note this OWASP page now also has new IDs added like:

   RE
   RE1
   RE2
   ...
   RP3
   RP4

and so the embedded links in the CRS such as:

  ...tag:'OWASP_AppSensor/RP3',tag:'https://www.owasp.org/index.php/AppSensor_DetectionPoints#RP3:_Suspicious_Client-Side_Behavior'"

could optionally be changed to the additional shorter code like:

 ...tag:'OWASP_AppSensor/RP3',tag:'https://www.owasp.org/index.php/AppSensor_DetectionPoints#RP3'"

This would mean that any changes to the names of the AppSensor
detection points wouldn't affect the links in CRS. But there are no
name changes planned by me!

Colin

From RBarnett at trustwave.com  Fri Feb 22 16:15:39 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 22 Feb 2013 16:15:39 +0000
Subject: [Owasp-modsecurity-core-rule-set] AppSensor cross-referencing
In-Reply-To: <CAAxdBBnDkZcxj25ZoS0B9dZYoVvi-zfc-m5UjNrUjAJNT__5aA@mail.gmail.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF347170@SKYMB1.trustwave.com>

Thanks Colin. I will take a look at updating the AppSensor TAG data.

-Ryan

On 2/22/13 11:09 AM, "Colin Watson" <colin.watson at owasp.org> wrote:

>I have updated the AppSensor Detection Point wiki page to reflect what
>is tagged in CRS v2.2.7:
>
>  https://www.owasp.org/index.php/AppSensor_DetectionPoints
>
>Note this OWASP page now also has new IDs added like:
>
>   RE
>   RE1
>   RE2
>   ...
>   RP3
>   RP4
>
>and so the embedded links in the CRS such as:
>
>
>...tag:'OWASP_AppSensor/RP3',tag:'https://www.owasp.org/index.php/AppSenso
>r_DetectionPoints#RP3:_Suspicious_Client-Side_Behavior'"
>
>could optionally be changed to the additional shorter code like:
>
>
>...tag:'OWASP_AppSensor/RP3',tag:'https://www.owasp.org/index.php/AppSenso
>r_DetectionPoints#RP3'"
>
>This would mean that any changes to the names of the AppSensor
>detection points wouldn't affect the links in CRS. But there are no
>name changes planned by me!
>
>Colin
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Wed Feb 27 22:07:37 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 27 Feb 2013 22:07:37 +0000
Subject: [Owasp-modsecurity-core-rule-set] CloudFlare vs Incapsula vs
	ModSecurity
Message-ID: <0A8AA836-06EB-427D-9308-89BD5C3D1F85@trustwave.com>

An interesting WAF eval report -
http://zeroscience.mk/files/wafreport2013.pdf

ModSecurity has the best false negative rate :)

I have just updated github repo with fixes for the 2 LFI/RFI bypasses -
https://github.com/SpiderLabs/owasp-modsecurity-crs/commit/7ff865deab72b0993824ce4ef53189745a4dd1a3

Note that for the LFI issue I applied the t:cmdLine transformation function -
https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#wiki-cmdLine

Thanks to Marc Stern for that contribution!

LFI Bypass fixed -
http://www.modsecurity.org/demo/phpids?test=cat%20\/etc\/passwd

RFI Bypass fixed -
http://www.modsecurity.org/demo/phpids?test=http://dni.destr0y.net/x.txt


--
Ryan Barnett


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130227/4ad33710/attachment.html>

From edarko at promnetwork.com  Thu Feb 28 15:44:37 2013
From: edarko at promnetwork.com (Emmanuel Darko)
Date: Thu, 28 Feb 2013 15:44:37 +0000
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to
	Modsecurity. Need Help
Message-ID: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DCDB7@HQEX01.promontory-hq.promcapital.com>

We use Apache RHEL 5 and we administered a patch at the a couple of days ago and Apache would not start due to error shown below;

Syntax error on line 47 of
/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf:
ModSecurity: SkipAfter actions can only be specified by chain starter rules

Any help with this as Google has not helped much.

Emmanuel
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130228/63ae390e/attachment.html>

From jamuse at owasp.org  Thu Feb 28 16:30:06 2013
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Thu, 28 Feb 2013 18:30:06 +0200
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due
 to Modsecurity. Need Help
In-Reply-To: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DCDB7@HQEX01.promontory-hq.promcapital.com>
References: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DCDB7@HQEX01.promontory-hq.promcapital.com>
Message-ID: <CAC+O4mE+X+FgWOyWN32=3LBGSTonyB9kg+Ybq6fVJDnfg7PE5A@mail.gmail.com>

On Thu, Feb 28, 2013 at 5:44 PM, Emmanuel Darko <edarko at promnetwork.com>wrote:

>  We use Apache RHEL 5 and we administered a patch at the a couple of days
> ago and Apache would not start due to error shown below;****
>
> ** **
>
> Syntax error on line 47 of****
>
>
> /etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf:
> ****
>
> ModSecurity: SkipAfter actions can only be specified by chain starter rules
> ****
>
> **
>

Hi Emmanuel,

Can you update your CRS rules as well?

--
 - Josh


>  **
>
> Any help with this as Google has not helped much.****
>
> ** **
>
> Emmanuel****
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130228/37687de9/attachment.html>

From RBarnett at trustwave.com  Thu Feb 28 19:02:00 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 28 Feb 2013 19:02:00 +0000
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due
 to Modsecurity. Need Help
In-Reply-To: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DCDB7@HQEX01.promontory-hq.promcapital.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF34DC7A@SKYMB1.trustwave.com>


From: Emmanuel Darko <edarko at promnetwork.com<mailto:edarko at promnetwork.com>>
Date: Thursday, February 28, 2013 10:44 AM
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to Modsecurity. Need Help

We use Apache RHEL 5 and we administered a patch at the a couple of days ago and Apache would not start due to error shown below;

Syntax error on line 47 of
/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf:
ModSecurity: SkipAfter actions can only be specified by chain starter rules

Any help with this as Google has not helped much.

Emmanuel

See line 47 here -
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules/modsecurity_crs_21_protocol_anomalies.conf

What does yours look like?

-Ryan

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130228/ecc4760e/attachment.html>

From edarko at promnetwork.com  Thu Feb 28 19:14:49 2013
From: edarko at promnetwork.com (Emmanuel Darko)
Date: Thu, 28 Feb 2013 19:14:49 +0000
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due
 to Modsecurity. Need Help
In-Reply-To: <01987910BF74B341B5890120BCCE77DF34DC7A@SKYMB1.trustwave.com>
References: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DCDB7@HQEX01.promontory-hq.promcapital.com>
	<01987910BF74B341B5890120BCCE77DF34DC7A@SKYMB1.trustwave.com>
Message-ID: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DDA17@HQEX01.promontory-hq.promcapital.com>

Ours looks like;

SecMarker BEGIN_ACCEPT_CHECK

        SecRule &REQUEST_HEADERS:Accept "@eq 0" \
                "chain,phase:2,rev:'2.0.5',t:none,nolog,auditlog,msg:'Request Missing an Accept Header', severity:'2',id:'960015',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',tag:'WASCTC/WASC-21',tag:'OWASP_TOP_10/A7',tag:'PCI/6.5.10'"
                SecRule REQUEST_METHOD "!^OPTIONS$" "skipAfter:END_ACCEPT_CHECK,t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
        SecRule REQUEST_HEADERS:Accept "^$" \
                "chain,phase:2,rev:'2.0.5',t:none,nolog,auditlog,msg:'Request Has an Empty Accept Header', severity:'2',id:'960021',tag:'PROTOCOL_VIOLATION/MISSING_HEADER'"
                SecRule REQUEST_METHOD "!^OPTIONS$" "t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"

SecMarker END_ACCEPT_CHECK


-Emmanuel

From: Ryan Barnett [mailto:RBarnett at trustwave.com]
Sent: Thursday, February 28, 2013 2:02 PM
To: Emmanuel Darko; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to Modsecurity. Need Help


From: Emmanuel Darko <edarko at promnetwork.com<mailto:edarko at promnetwork.com>>
Date: Thursday, February 28, 2013 10:44 AM
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to Modsecurity. Need Help

We use Apache RHEL 5 and we administered a patch at the a couple of days ago and Apache would not start due to error shown below;

Syntax error on line 47 of
/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf:
ModSecurity: SkipAfter actions can only be specified by chain starter rules

Any help with this as Google has not helped much.

Emmanuel

See line 47 here -
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules/modsecurity_crs_21_protocol_anomalies.conf

What does yours look like?

-Ryan

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130228/274e571f/attachment-0001.html>

From RBarnett at trustwave.com  Thu Feb 28 19:17:11 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 28 Feb 2013 19:17:11 +0000
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due
 to Modsecurity. Need Help
In-Reply-To: <09B328B0A41D8849BB9C5F9B5BF92A2C0A5DDA17@HQEX01.promontory-hq.promcapital.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF34DCEA@SKYMB1.trustwave.com>

There's your problem ? rev:'2.0.5' - that is really old.  Current ver is 2.2.7.  Use the rules from GitHub.  Download with this link -

https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/master

-Ryan

From: Emmanuel Darko <edarko at promnetwork.com<mailto:edarko at promnetwork.com>>
Date: Thursday, February 28, 2013 2:14 PM
To: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: RE: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to Modsecurity. Need Help

Ours looks like;

SecMarker BEGIN_ACCEPT_CHECK

        SecRule &REQUEST_HEADERS:Accept "@eq 0" \
                "chain,phase:2,rev:'2.0.5',t:none,nolog,auditlog,msg:'Request Missing an Accept Header', severity:'2',id:'960015',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',tag:'WASCTC/WASC-21',tag:'OWASP_TOP_10/A7',tag:'PCI/6.5.10'"
                SecRule REQUEST_METHOD "!^OPTIONS$" "skipAfter:END_ACCEPT_CHECK,t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
        SecRule REQUEST_HEADERS:Accept "^$" \
                "chain,phase:2,rev:'2.0.5',t:none,nolog,auditlog,msg:'Request Has an Empty Accept Header', severity:'2',id:'960021',tag:'PROTOCOL_VIOLATION/MISSING_HEADER'"
                SecRule REQUEST_METHOD "!^OPTIONS$" "t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"

SecMarker END_ACCEPT_CHECK


-Emmanuel

From: Ryan Barnett [mailto:RBarnett at trustwave.com]
Sent: Thursday, February 28, 2013 2:02 PM
To: Emmanuel Darko; owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to Modsecurity. Need Help


From: Emmanuel Darko <edarko at promnetwork.com<mailto:edarko at promnetwork.com>>
Date: Thursday, February 28, 2013 10:44 AM
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] Problem starting Apache due to Modsecurity. Need Help

We use Apache RHEL 5 and we administered a patch at the a couple of days ago and Apache would not start due to error shown below;

Syntax error on line 47 of
/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_21_protocol_anomalies.conf:
ModSecurity: SkipAfter actions can only be specified by chain starter rules

Any help with this as Google has not helped much.

Emmanuel

See line 47 here -
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules/modsecurity_crs_21_protocol_anomalies.conf

What does yours look like?

-Ryan

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130228/720fc5b8/attachment.html>

