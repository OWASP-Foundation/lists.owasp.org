<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Matched rule modification
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Matched%20rule%20modification&In-Reply-To=%3C20170530141946.GA26620%40arxnet.hu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002368.html">
   <LINK REL="Next"  HREF="002370.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Matched rule modification</H1>
    <B>Ervin Heged&#252;s</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Matched%20rule%20modification&In-Reply-To=%3C20170530141946.GA26620%40arxnet.hu%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Matched rule modification">airween at gmail.com
       </A><BR>
    <I>Tue May 30 14:19:46 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002368.html">[Owasp-modsecurity-core-rule-set] SecRuleUpdateActionById and	chained rules
</A></li>
        <LI>Next message: <A HREF="002370.html">[Owasp-modsecurity-core-rule-set] Matched rule modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2369">[ date ]</a>
              <a href="thread.html#2369">[ thread ]</a>
              <a href="subject.html#2369">[ subject ]</a>
              <a href="author.html#2369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

there is an existing web application, which have an API: the
client sends the requests to server in a fixed structure, and the
server answers to them. This app works since 4 years.

Now I've installed Libmodsecurity, and OWASP CRS (3.0.2).

Here is a client request (HTTP POST)

action	filter_tree
extraParams	{&quot;sort&quot;:&quot;folderid&quot;}
node	0
table	tea_user_folders

In extraParams, there could be several keys and values.

The modsecurity bans this request with these lines (in
audit.log):

---1InxQ6aA---B--
POST /api/tree HTTP/1.1
Referer: <A HREF="http://my.app/">http://my.app/</A>
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip, deflate
Cookie: _ga=GA1.2.978766370.1489422665; PHPSESSID=bbfcaq0r0ahruiqn49mjg9bcc6
Content-Length: 94
Accept-Language: hu-HU,hu;q=0.8,en-US;q=0.5,en;q=0.3
Accept: */*
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0
Host: my.app
Connection: keep-alive

---1InxQ6aA---D--

---1InxQ6aA---F--
Server: nginx/1.6.2
Date: Tue, 30 May 2017 13:55:47 GMT
Content-Length: 168
Content-Type: text/html
Connection: keep-alive

---1InxQ6aA---H--
ModSecurity: Warning. Matched &quot;Operator `Rx' with parameter `(?i)(?:;|\{|\||\|\||&amp;|&amp;&amp;|\n|\r|`)\s*[\(,@\'\&quot;\s]*(?:[\w'\&quot;\./]+/|[\\\\'\&quot;\^]*\w[\\\\'\&quot;\^]*:.*\\\\|[\^\.\w'\&quot;/\\\\]*\\\\)?[\&quot;\^]*(?:s[\&quot;\^]*(?:y[\&quot;\^]*s[\&quot;\^]*(?:t[\&quot;\^]*e[\&quot;\^]*m[\&quot;\^]*(?:p[\&quot;\^]*r[ (5092 characters omitted)' against variable `ARGS:extraParams' (Value: `{&quot;sort&quot;:&quot;folderid&quot;}' ) [file &quot;/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf&quot;] [line &quot;182&quot;] [id &quot;932115&quot;] [rev &quot;4&quot;] [msg &quot;Remote Command Execution: Windows Command Injection&quot;] [data &quot;Matched Data: {&quot;sort found within ARGS:extraParams: {&quot;sort&quot;:&quot;folderid&quot;}&quot;] [severity &quot;2&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] [accuracy &quot;8&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-shell&quot;] [tag &quot;platform-windows&quot;] [tag &quot;attack-rce&quot;] [tag &quot;OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION&quot;] [tag &quot;WASCTC/WASC-31&quot;] [tag &quot;OWASP_TOP_10/A1&quot;] [tag &quot;PCI/6.5.2&quot;] [ref &quot;o0,6v621,19&quot;]
ModSecurity: Warning. Matched &quot;Operator `Ge' with parameter `%{tx.inbound_anomaly_score_threshold}' against variable `TX:ANOMALY_SCORE' (Value: `5' ) [file &quot;/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;] [line &quot;36&quot;] [id &quot;949110&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score Exceeded (Total Score: 5)&quot;] [data &quot;&quot;] [severity &quot;2&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;] [accuracy &quot;0&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-generic&quot;] [ref &quot;&quot;]
ModSecurity: Warning. Matched &quot;Operator `Ge' with parameter `%{tx.inbound_anomaly_score_threshold}' against variable `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file &quot;/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf&quot;] [line &quot;61&quot;] [id &quot;980130&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score Exceeded (Total Inbound Score: 5 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=5,PHPI=0,HTTP=0,SESS=0): Remote Command Execution: Windows Command Injection'&quot;] [data &quot;&quot;] [severity &quot;0&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;] [accuracy &quot;0&quot;] [tag &quot;event-correlation&quot;] [ref &quot;&quot;]

---1InxQ6aA---I--


My question is: what can I do?
- ignore that rule (remove the /etc/nginx/owasp-modsecurity-crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf file?)
- change the &quot;sort&quot; keyword in full API (that would be a very
  hard work)? (and what should be the good choice? eg.
  &quot;sorting&quot;?)

There isn't any Windows based OS, there are several Linux
containers, and nGInx is a front-end proxy.


Many thanks,


a.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002368.html">[Owasp-modsecurity-core-rule-set] SecRuleUpdateActionById and	chained rules
</A></li>
	<LI>Next message: <A HREF="002370.html">[Owasp-modsecurity-core-rule-set] Matched rule modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2369">[ date ]</a>
              <a href="thread.html#2369">[ thread ]</a>
              <a href="subject.html#2369">[ subject ]</a>
              <a href="author.html#2369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
