<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Matched rule modification
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Matched%20rule%20modification&In-Reply-To=%3CCAE8hE%3Dq5%3DTCD%2B3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002369.html">
   <LINK REL="Next"  HREF="002371.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Matched rule modification</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Matched%20rule%20modification&In-Reply-To=%3CCAE8hE%3Dq5%3DTCD%2B3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Matched rule modification">chaim at chaimsanders.com
       </A><BR>
    <I>Wed May 31 01:15:53 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002369.html">[Owasp-modsecurity-core-rule-set] Matched rule modification
</A></li>
        <LI>Next message: <A HREF="002371.html">[Owasp-modsecurity-core-rule-set] Matched rule modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2370">[ date ]</a>
              <a href="thread.html#2370">[ thread ]</a>
              <a href="subject.html#2370">[ subject ]</a>
              <a href="author.html#2370">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Ervin,
Thanks for the report. It it is a combination of the curly and the word
'sort' (<A HREF="https://regex101.com/r/oV5rl6/1">https://regex101.com/r/oV5rl6/1</A>). As you noted this is a new rule
to the 3.x branch. Put together based on the list available here:
<A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/util/regexp-assemble/regexp-932115.txt.">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/util/regexp-assemble/regexp-932115.txt.</A>
There is probably an argument to be made for removing 'sort' from this
list. The other item of interest here is ModSecurity's pretty poor job at
being able to parse JSON (which this looks to be). In any event, I think it
is something we can probably address. At least for this version (3.0.2) you
can either add an exception for that argument to this rule (see below), or
rebuild the regex as outlined in the rule. If you wouldn't mind opening an
issue on our GitHub, we'll be able to have a more persistent log of the
issue and also be able to reach out to you if we have more questions. If
you don't have a GitHub or don't want to take the time I can also do it,
just let me know! Thanks!

SecRule REQUEST_URI &quot;@beginsWith /api/tree&quot;
&quot;id:1001,phase:1,pass,nolog,ctl:ruleRemoveTargetById=932115;ARGS:ExtraParams&quot;

On Tue, May 30, 2017 at 10:19 AM, Ervin Heged&#252;s &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">airween at gmail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> there is an existing web application, which have an API: the
</I>&gt;<i> client sends the requests to server in a fixed structure, and the
</I>&gt;<i> server answers to them. This app works since 4 years.
</I>&gt;<i>
</I>&gt;<i> Now I've installed Libmodsecurity, and OWASP CRS (3.0.2).
</I>&gt;<i>
</I>&gt;<i> Here is a client request (HTTP POST)
</I>&gt;<i>
</I>&gt;<i> action  filter_tree
</I>&gt;<i> extraParams     {&quot;sort&quot;:&quot;folderid&quot;}
</I>&gt;<i> node    0
</I>&gt;<i> table   tea_user_folders
</I>&gt;<i>
</I>&gt;<i> In extraParams, there could be several keys and values.
</I>&gt;<i>
</I>&gt;<i> The modsecurity bans this request with these lines (in
</I>&gt;<i> audit.log):
</I>&gt;<i>
</I>&gt;<i> ---1InxQ6aA---B--
</I>&gt;<i> POST /api/tree HTTP/1.1
</I>&gt;<i> Referer: <A HREF="http://my.app/">http://my.app/</A>
</I>&gt;<i> Content-Type: application/x-www-form-urlencoded; charset=UTF-8
</I>&gt;<i> X-Requested-With: XMLHttpRequest
</I>&gt;<i> Accept-Encoding: gzip, deflate
</I>&gt;<i> Cookie: _ga=GA1.2.978766370.1489422665; PHPSESSID=
</I>&gt;<i> bbfcaq0r0ahruiqn49mjg9bcc6
</I>&gt;<i> Content-Length: 94
</I>&gt;<i> Accept-Language: hu-HU,hu;q=0.8,en-US;q=0.5,en;q=0.3
</I>&gt;<i> Accept: */*
</I>&gt;<i> Cache-Control: max-age=0
</I>&gt;<i> User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101
</I>&gt;<i> Firefox/53.0
</I>&gt;<i> Host: my.app
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i>
</I>&gt;<i> ---1InxQ6aA---D--
</I>&gt;<i>
</I>&gt;<i> ---1InxQ6aA---F--
</I>&gt;<i> Server: nginx/1.6.2
</I>&gt;<i> Date: Tue, 30 May 2017 13:55:47 GMT
</I>&gt;<i> Content-Length: 168
</I>&gt;<i> Content-Type: text/html
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i>
</I>&gt;<i> ---1InxQ6aA---H--
</I>&gt;<i> ModSecurity: Warning. Matched &quot;Operator `Rx' with parameter
</I>&gt;<i> `(?i)(?:;|\{|\||\|\||&amp;|&amp;&amp;|\n|\r|`)\s*[\(,@\'\&quot;\s]*(?:[\w'\&quot;\
</I>&gt;<i> ./]+/|[\\\\'\&quot;\^]*\w[\\\\'\&quot;\^]*:.*\\\\|[\^\.\w'\&quot;/\\\\]*\\\
</I>&gt;<i> \)?[\&quot;\^]*(?:s[\&quot;\^]*(?:y[\&quot;\^]*s[\&quot;\^]*(?:t[\&quot;\^]*e[\&quot;\^]*m[\&quot;\^]*(?:p[\&quot;\^]*r[
</I>&gt;<i> (5092 characters omitted)' against variable `ARGS:extraParams' (Value:
</I>&gt;<i> `{&quot;sort&quot;:&quot;folderid&quot;}' ) [file &quot;/etc/nginx/owasp-modsecurity-
</I>&gt;<i> crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf&quot;] [line &quot;182&quot;] [id
</I>&gt;<i> &quot;932115&quot;] [rev &quot;4&quot;] [msg &quot;Remote Command Execution: Windows Command
</I>&gt;<i> Injection&quot;] [data &quot;Matched Data: {&quot;sort found within ARGS:extraParams:
</I>&gt;<i> {&quot;sort&quot;:&quot;folderid&quot;}&quot;] [severity &quot;2&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;]
</I>&gt;<i> [accuracy &quot;8&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-shell&quot;] [tag
</I>&gt;<i> &quot;platform-windows&quot;] [tag &quot;attack-rce&quot;] [tag &quot;OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION&quot;]
</I>&gt;<i> [tag &quot;WASCTC/WASC-31&quot;] [tag &quot;OWASP_TOP_10/A1&quot;] [tag &quot;PCI/6.5.2&quot;] [ref
</I>&gt;<i> &quot;o0,6v621,19&quot;]
</I>&gt;<i> ModSecurity: Warning. Matched &quot;Operator `Ge' with parameter
</I>&gt;<i> `%{tx.inbound_anomaly_score_threshold}' against variable
</I>&gt;<i> `TX:ANOMALY_SCORE' (Value: `5' ) [file &quot;/etc/nginx/owasp-modsecurity-
</I>&gt;<i> crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;] [line &quot;36&quot;] [id
</I>&gt;<i> &quot;949110&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score Exceeded (Total Score: 5)&quot;]
</I>&gt;<i> [data &quot;&quot;] [severity &quot;2&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;] [accuracy &quot;0&quot;] [tag
</I>&gt;<i> &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag
</I>&gt;<i> &quot;attack-generic&quot;] [ref &quot;&quot;]
</I>&gt;<i> ModSecurity: Warning. Matched &quot;Operator `Ge' with parameter
</I>&gt;<i> `%{tx.inbound_anomaly_score_threshold}' against variable
</I>&gt;<i> `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file
</I>&gt;<i> &quot;/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf&quot;]
</I>&gt;<i> [line &quot;61&quot;] [id &quot;980130&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score Exceeded
</I>&gt;<i> (Total Inbound Score: 5 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=5,PHPI=0,HTTP=0,SESS=0):
</I>&gt;<i> Remote Command Execution: Windows Command Injection'&quot;] [data &quot;&quot;] [severity
</I>&gt;<i> &quot;0&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;] [accuracy &quot;0&quot;] [tag &quot;event-correlation&quot;] [ref
</I>&gt;<i> &quot;&quot;]
</I>&gt;<i>
</I>&gt;<i> ---1InxQ6aA---I--
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My question is: what can I do?
</I>&gt;<i> - ignore that rule (remove the /etc/nginx/owasp-modsecurity-
</I>&gt;<i> crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf file?)
</I>&gt;<i> - change the &quot;sort&quot; keyword in full API (that would be a very
</I>&gt;<i>   hard work)? (and what should be the good choice? eg.
</I>&gt;<i>   &quot;sorting&quot;?)
</I>&gt;<i>
</I>&gt;<i> There isn't any Windows based OS, there are several Linux
</I>&gt;<i> containers, and nGInx is a front-end proxy.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Many thanks,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> a.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>


-- 
-- 
Chaim Sanders
<A HREF="http://www.ChaimSanders.com">http://www.ChaimSanders.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170530/743f7c06/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170530/743f7c06/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002369.html">[Owasp-modsecurity-core-rule-set] Matched rule modification
</A></li>
	<LI>Next message: <A HREF="002371.html">[Owasp-modsecurity-core-rule-set] Matched rule modification
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2370">[ date ]</a>
              <a href="thread.html#2370">[ thread ]</a>
              <a href="subject.html#2370">[ subject ]</a>
              <a href="author.html#2370">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
