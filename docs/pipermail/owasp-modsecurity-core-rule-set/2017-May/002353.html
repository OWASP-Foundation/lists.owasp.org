<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] 500-to-403 rule failing
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20500-to-403%20rule%20failing&In-Reply-To=%3C20170515141034.ci6f3misqth5m5m4%40nbmacvieebi.int.jumio.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002352.html">
   <LINK REL="Next"  HREF="002354.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] 500-to-403 rule failing</H1>
    <B>Elmar K. Bins</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20500-to-403%20rule%20failing&In-Reply-To=%3C20170515141034.ci6f3misqth5m5m4%40nbmacvieebi.int.jumio.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] 500-to-403 rule failing">ekb at bins.priv.at
       </A><BR>
    <I>Mon May 15 14:10:35 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002352.html">[Owasp-modsecurity-core-rule-set] OWASP Core Rule Set Version 3.0.2	Released
</A></li>
        <LI>Next message: <A HREF="002354.html">[Owasp-modsecurity-core-rule-set] Help interpreting rule violation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2353">[ date ]</a>
              <a href="thread.html#2353">[ thread ]</a>
              <a href="subject.html#2353">[ subject ]</a>
              <a href="author.html#2353">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We're running mod_security plus current CRS (3.0.0-4) as an Apache module here.
I have set paranoia_mode to 2, so the rule in question (950100) fires, and it
should translate all internal errors to 403s towards the outside.

Now, some internal errors (500s) are NOT translated to 403s. :-(

I wonder if anybody else has run into this problem and whether there is
a solution out there. Googling got me nowhere yet.


Obfuscated curl, result and log output is below.

Thank you for any direction you could point me to,
							Elmar.



=== Client View ===

curl --insecure -X DELETE <A HREF="https://*****">https://*****</A> -H 'accept: application/json' -H 'authorization: Basic *****' -H 'cache-control: no-cache' -H ...

--&gt;

{&quot;httpStatus&quot;:&quot;500&quot;,&quot;message&quot;:&quot;Internal Server Error&quot;,&quot;requestURI&quot;:&quot;<A HREF="https://*****">https://*****</A>&quot;}


=== Server View ===

--b962e37c-A--
[15/May/2017:14:03:22 +0000] ************** 10.**.**.** 61134 10.**.**.** 443
--b962e37c-B--
DELETE /***** HTTP/1.1
Host: *****
accept: application/json
authorization: Basic *****
cache-control: no-cache
content-type: application/json

--b962e37c-F--
HTTP/1.1 403 Forbidden
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-TrackingId: 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc
Vary: Accept-Encoding
Content-Type: application/json
Connection: close
Transfer-Encoding: chunked

--b962e37c-E--

--b962e37c-H--
Message: Access denied with code 403 (phase 4). Pattern match &quot;^5\\d{2}$&quot; at RESPONSE_STATUS. [file &quot;/etc/httpd/modsecurity.d/activated_rules/RESPONSE-950-DATA-LEAKAGES.conf&quot;] [line &quot;93&quot;] [id &quot;950100&quot;] [rev &quot;3&quot;] [msg &quot;The Application Returned a 500-Level Status Code&quot;] [data &quot;Matched Data: 500 found within RESPONSE_STATUS: 500&quot;] [severity &quot;ERROR&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] [accuracy &quot;9&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-disclosure&quot;] [tag &quot;WASCTC/WASC-13&quot;] [tag &quot;OWASP_TOP_10/A6&quot;] [tag &quot;PCI/6.5.6&quot;] [tag &quot;paranoia-level/2&quot;]
Message: Warning. Operator GE matched 4 at TX:outbound_anomaly_score. [file &quot;/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf&quot;] [line &quot;82&quot;] [id &quot;980140&quot;] [msg &quot;Outbound Anomaly Score Exceeded (score 4): The Application Returned a 500-Level Status Code&quot;] [tag &quot;event-correlation&quot;]
Action: Intercepted (phase 4)
Apache-Handler: proxy-server
Stopwatch: 1494857002287297 207077 (- - -)
Stopwatch2: 1494857002287297 207077; combined=18441, p1=681, p2=14548, p3=1891, p4=724, p5=597, sr=91, sw=0, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for Apache/2.9.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); OWASP_CRS/3.0.0.
Server: Apache
WebApp-Info: &quot;netverify&quot; &quot;-&quot; &quot;-&quot;
Engine-Mode: &quot;ENABLED&quot;

--b962e37c-Z--


==&gt; apache-request.log &lt;==
2017-05-15 14:03:22 UTC 10.**.**.** ***** - &quot;DELETE ***** HTTP/1.1&quot; 500 168 &quot;-&quot; &quot;*****&quot; 1071 3634 207355 on WRm1KgoKGoMAAD-yLjgAAABU - ***** TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 false 128 128 NULL 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc

==&gt; apache-error.log &lt;==
[Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity: Access denied with code 403 (phase 4). Pattern match &quot;^5\\\\d{2}$&quot; at RESPONSE_STATUS. [file &quot;/etc/httpd/modsecurity.d/activated_rules/RESPONSE-950-DATA-LEAKAGES.conf&quot;] [line &quot;93&quot;] [id &quot;950100&quot;] [rev &quot;3&quot;] [msg &quot;The Application Returned a 500-Level Status Code&quot;] [data &quot;Matched Data: 500 found within RESPONSE_STATUS: 500&quot;] [severity &quot;ERROR&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] [accuracy &quot;9&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-disclosure&quot;] [tag &quot;WASCTC/WASC-13&quot;] [tag &quot;OWASP_TOP_10/A6&quot;] [tag &quot;PCI/6.5.6&quot;] [tag &quot;paranoia-level/2&quot;] [hostname &quot;*****&quot;] [uri &quot;/*****&quot;] [unique_id &quot;WRm1KgoKGoMAAD-yLjgAAABU&quot;]

[Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity: Warning. Operator GE matched 4 at TX:outbound_anomaly_score. [file &quot;/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf&quot;] [line &quot;82&quot;] [id &quot;980140&quot;] [msg &quot;Outbound Anomaly Score Exceeded (score 4): The Application Returned a 500-Level Status Code&quot;] [tag &quot;event-correlation&quot;] [hostname &quot;*****&quot;] [uri &quot;/*****&quot;] [unique_id &quot;WRm1KgoKGoMAAD-yLjgAAABU&quot;]

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002352.html">[Owasp-modsecurity-core-rule-set] OWASP Core Rule Set Version 3.0.2	Released
</A></li>
	<LI>Next message: <A HREF="002354.html">[Owasp-modsecurity-core-rule-set] Help interpreting rule violation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2353">[ date ]</a>
              <a href="thread.html#2353">[ thread ]</a>
              <a href="subject.html#2353">[ subject ]</a>
              <a href="author.html#2353">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
