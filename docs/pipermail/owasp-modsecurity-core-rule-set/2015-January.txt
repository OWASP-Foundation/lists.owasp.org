From ilyassikai at gmail.com  Wed Jan 14 16:50:39 2015
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Wed, 14 Jan 2015 16:50:39 +0000
Subject: [Owasp-modsecurity-core-rule-set] =?utf-8?q?Probl=C3=A8me_with_Fa?=
	=?utf-8?q?lse_Positives?=
Message-ID: <CAMmziWde7-UOJOB7jvhUiKH+jMomTu1iXd=aAw8RMFB=Q0LK5w@mail.gmail.com>

Hi guys.

I don't understand why modsecurity blocking a comment with the character
'   in french.

comment

"Bonjour,

Nous sommes un cabinet sp?cialise dans l'accompagnement des PME
(chiffre d'affaires
inf?rieur ? 175 MDH) pour l'obtention de la prime ? l'investissement xxx
(programme de l'xxxx). 100% des dossiers que nous avons r?alis?s dans les
?ditions pass?es ont ?t? retenus.*"*

?log :

parentId=0&entId=0&typeMessage=2&portee=1&message=Bonjour%2c+%0d%0aNous+sommes+un+cabinet+sp%c3%a9cialise+dans+l%27accompagnement+des+PME+%28chiffre+d%27affaires+inf%c3%a9rieur+%c3%a0+175+MDH%29+pour+l%27obtention+de+la+prime+%c3%a0+l%27investissement+
?xxxxx
+%28programme+de+l%27
?xxxx
%29%2e+100%25+des+dossiers+que+nous+avons+r%c3%a9alis%c3%a9s+dans+les+%c3%a9ditions+pass%c3%a9es+ont+%c3%a9t%c3%a9+retenus%2e%0d%0acontacter+nous+au+%3a+contact%40pertinum%2ecom%0d%0acordialement%2e

--e95b6c45-F--

HTTP/1.1 403 Forbidden

Content-Length: 234

Connection: close

Content-Type: text/html; charset=iso-8859-1


--e95b6c45-E--


--e95b6c45-H--

Message: Access denied with code 403 (phase 2). Pattern match "(?i:[\"\\'][
]*(([^a-z0-9~_:\\' ])|(in)).+?\\(.*?\\))" at ARGS:message. [file
"/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_41_xss_attacks.conf"]
[line "506"] [id "973335"] [rev "2"] [msg "IE XSS Filters - Attack
Detected."] [data "Matched Data: 'investissement
?xxxx
 (programme de l'ANPME) found within ARGS:message: Bonjour, Nous sommes un
cabinet sp\xc3\xa9cialise dans l'accompagnement des PME (chiffre d'affaires
inf\xc3\xa9rieur \xc3 175 MDH) pour l'obtention de la prime \xc3
l'investissement IMTIAZ (programme de l'
?xxxx
). 100% des dossiers que nous avons r\xc3\xa9alis\xc3\xa9s dans les
\xc3\xa9ditions pass\xc3\xa9es ont \xc3\xa9t\xc3\xa9 retenus. contacter
nous au  cordialement."] [ver "OWASP_CRS/2.2.9"] [maturity "8"] [accuracy
"8"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] [tag
"WASCTC/WASC-22"] [tag "OWASP_TOP_10/A2"] [tag "OWASP_AppSensor/IE1"] [tag
"PCI/6.5.1"]

Action: Intercepted (phase 2)

Apache-Handler: proxy-server

Stopwatch: 1421251883487181 8586 (- - -)

Stopwatch2: 1421251883487181 8586; combined=1693, p1=106, p2=1582, p3=0,
p4=0, p5=5, sr=33, sw=0, l=0, gc=0

Response-Body-Transformed: Dechunked

Producer: ModSecurity for Apache/2.7.3 (http://www.modsecurity.org/);
OWASP_CRS/2.2.9.

Server: Apache
Engine-Mode: "ENABLED"?



Please can you give me solution
Tank you

--
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150114/70af17c1/attachment.html>

From jacob at fosterclub.com  Fri Jan 23 23:20:55 2015
From: jacob at fosterclub.com (Jacob Lear)
Date: Fri, 23 Jan 2015 15:20:55 -0800
Subject: [Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked
Message-ID: <54C2D757.2080500@fosterclub.com>

Hello,

I am working on setting up better security for my Debian 6 server. I am 
new to ModSecurity and OWASP Core Rules. The problem that I'm having is 
that it is blocking legitimate traffic and I don't understand why or how 
to fix it. Can somebody help me? Here is some pretty detailed 
information about my environment and my problem.

Apache2 is my webserver and it is installed from the Debian package. The 
version is 2.2.16-6+squeeze14. I'm using the Worker MPM.
I installed ModSecurity from the Debian package. The version is: 
2.5.12-1+squeeze4
Per the recommendation of an article I found online, I installed OWASP 
2.2.5-0. I had initially tried the most recent version of OWASP but this 
gave me errors (due to my version of ModSecurity).
I'm using PHP compiled from source, version 5.4.24.
I'm using PHP-FPM FastCGI.
I'm using MySQL 5.1.73-1+deb6u1.
I'm using Memcached 2.1.0.
ZendOpcode Cache 7.0.3 is installed.
Website is built using the Drupal CMS, version 7.28.
All non-SSL traffic is redirected to SSL.

I had some troubles getting Apache2 to pass the configtest but I was 
able to find the proper configuration changes needed via Google 
searching. I enabled all of the rules as per the INSTALL instructions 
included in OWASP CRS. I also enabled the experimental Brute Force, DOS, 
and Slow DOS rules (these don't appear to be causing any issues.)

I set ModSecurity to "On" mode but quickly got complaints from our staff 
being blocked by it. So now it is in "DetectionOnly" mode. I looked in 
the AuditLog but didn't see anything helpful in there (just a bunch of 
stuff about cookies -- perhaps because things in the 10 setup file are 
set to nolog?). However, the Apache2 SSL Error log shows a lot of 
information about the block attempts.

Our staff users are connecting from the IP address 63.227.218.204, so I 
filtered the SSL Error Log to dump all entries with that IP address to a 
separate file. All of the warnings/errors in this log are legitimate 
traffic. So I need help tuning ModSecurity and OWASP to permit this 
traffic. I've attached the log file to this post. 
https://www.fosterclub.com/sites/default/files/file/output.log

I have also attached my modsecurity.conf file and my 
modsecurity_crs_10_setup.conf file. 
https://www.fosterclub.com/sites/default/files/file/modsecurity.conf
https://www.fosterclub.com/sites/default/files/file/modsecurity_crs_10_setup.conf

I would very much appreciate any help anyone can offer. Please let me 
know if you need any additional information. Thanks!


-- 

Jacob Lear
Web Administrator
FosterClub, Inc.


---
This email has been checked for viruses by Avast antivirus software.
http://www.avast.com


From CSanders at trustwave.com  Tue Jan 27 15:56:49 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Tue, 27 Jan 2015 15:56:49 +0000
Subject: [Owasp-modsecurity-core-rule-set] Legitimate traffic being
 blocked
In-Reply-To: <D0ED131B.12CBF1%rbarnett@trustwave.com>
References: <54C2D757.2080500@fosterclub.com>
	<D0ED131B.12CBF1%rbarnett@trustwave.com>
Message-ID: <F684BDD553BAF1479F5380EDAD3BE371F77877@SKYMB1.trustwave.com>

Hello Jacob sorry for the slow response,
Based on your log file it seems clear that you are using an out dated version of CRS. Updating may fix *some* of the false positives you are facing. Upon inspecting your log the following rules are being triggered:
        Detects concatenated basic SQL Injection and SQLLFI attempts
        Request from Known SPAM Source
        Restricted SQL Character anomaly detection alert
        SQL Injection Attack: SQL Operator Detected
        Request content type is not allowed by policy
It is possible that some or all of these are false positives based on how the application is functioning. I suggest you follow the guidance set forth in the following blog post (http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-exception-handling.html) in order to analyze these events. If you are having additional issues please be sure to reach out and we will try to address them as best as possible. Thanks!


Chaim Sanders
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com


-----Original Message-----
From: Ryan Barnett
Sent: Tuesday, January 27, 2015 10:04 AM
To: Chaim Sanders
Subject: FW: [Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked

On 1/23/15, 6:20 PM, "Jacob Lear" <jacob at fosterclub.com> wrote:

>Hello,
>
>I am working on setting up better security for my Debian 6 server. I am
>new to ModSecurity and OWASP Core Rules. The problem that I'm having is
>that it is blocking legitimate traffic and I don't understand why or
>how to fix it. Can somebody help me? Here is some pretty detailed
>information about my environment and my problem.
>
>Apache2 is my webserver and it is installed from the Debian package.
>The version is 2.2.16-6+squeeze14. I'm using the Worker MPM.
>I installed ModSecurity from the Debian package. The version is:
>2.5.12-1+squeeze4
>Per the recommendation of an article I found online, I installed OWASP
>2.2.5-0. I had initially tried the most recent version of OWASP but
>this gave me errors (due to my version of ModSecurity).
>I'm using PHP compiled from source, version 5.4.24.
>I'm using PHP-FPM FastCGI.
>I'm using MySQL 5.1.73-1+deb6u1.
>I'm using Memcached 2.1.0.
>ZendOpcode Cache 7.0.3 is installed.
>Website is built using the Drupal CMS, version 7.28.
>All non-SSL traffic is redirected to SSL.
>
>I had some troubles getting Apache2 to pass the configtest but I was
>able to find the proper configuration changes needed via Google
>searching. I enabled all of the rules as per the INSTALL instructions
>included in OWASP CRS. I also enabled the experimental Brute Force,
>DOS, and Slow DOS rules (these don't appear to be causing any issues.)
>
>I set ModSecurity to "On" mode but quickly got complaints from our
>staff being blocked by it. So now it is in "DetectionOnly" mode. I
>looked in the AuditLog but didn't see anything helpful in there (just a
>bunch of stuff about cookies -- perhaps because things in the 10 setup
>file are set to nolog?). However, the Apache2 SSL Error log shows a lot
>of information about the block attempts.
>
>Our staff users are connecting from the IP address 63.227.218.204, so I
>filtered the SSL Error Log to dump all entries with that IP address to
>a separate file. All of the warnings/errors in this log are legitimate
>traffic. So I need help tuning ModSecurity and OWASP to permit this
>traffic. I've attached the log file to this post.
>http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
>GhD
>Vv7Jp46g&s=5&u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
>ffi
>les%2ffile%2foutput%2elog
>
>I have also attached my modsecurity.conf file and my
>modsecurity_crs_10_setup.conf file.
>http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
>GhD
>Ns5sp46Q&s=5&u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
>ffi
>les%2ffile%2fmodsecurity%2econf
>http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
>GhG
>Vrusp95w&s=5&u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
>ffi les%2ffile%2fmodsecurity%5fcrs%5f10%5fsetup%2econf
>
>I would very much appreciate any help anyone can offer. Please let me
>know if you need any additional information. Thanks!
>
>
>--
>
>Jacob Lear
>Web Administrator
>FosterClub, Inc.
>
>
>---
>This email has been checked for viruses by Avast antivirus software.
>http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
>GhG Ey688p7w&s=5&u=http%3a%2f%2fwww%2eavast%2ecom
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
>GhG
>Q65sp85w&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2
>fow
>asp-modsecurity-core-rule-set


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From jacob at fosterclub.com  Wed Jan 28 02:41:09 2015
From: jacob at fosterclub.com (Jacob Lear)
Date: Tue, 27 Jan 2015 18:41:09 -0800
Subject: [Owasp-modsecurity-core-rule-set] Legitimate traffic being
	blocked
Message-ID: <54C84C45.6030009@fosterclub.com>

Hi Chaim,

thanks for the response. I actually did stumble across that blog post 
and tried to write some exceptions to get things working. There are SO 
many exceptions needed though! I think I will try removing the DEB/RPM 
of ModSecurity and try installing it from source. That way I will be 
able to install the most recent version of CRS.

So far this is what I've written for exceptions. Am I doing it correctly??

In modsecurity_crs_15_customerules.conf:
SecRule REQUEST_FILENAME "@rx /node/*/edit" 
"phase:1,t:none,nolog,pass,ctl:ruleRemoveById=981173"

SecRule REQUEST_FILENAME "@streq /civicrm/contribute/search" 
"phase:1,t:none,nolog,pass,ctl:ruleRemoveById=981173"

SecRule REQUEST_FILENAME "@streq /civicrm/ajax/inline" 
"phase:1,t:none,nolog,pass,ctl:ruleRemoveById=981173"


In modsecurity_crs_48_local_exceptions.conf:
SecRule REQUEST_FILENAME "@rx /node/*/edit" 
"chain,phase:2,t:none,nolog,pass"
     SecRule TX:'/^960010/' "@streq Item 1=1" "chain,t:none"
            SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule REQUEST_FILENAME "@rx /node/*/edit" 
"chain,phase:2,t:none,nolog,pass"
     SecRule TX:'/^950109/' "@streq Item 1=1" "chain,t:none"
            SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-2"

SecRule TX:'/^950901.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^960024.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule TX:'/^960024.*ARGS:metatags[title][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule TX:'/^960024.*ARGS:metatags[title][default]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule TX:'/^981257.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981245.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981245.*ARGS:metatags[dcterms.rights][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981245.*ARGS:metatags[dcterms.rights][default]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981245.*ARGS:metatags[copyright][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981245.*ARGS:metatags[copyright][default]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981243.*ARGS:metatags[dcterms.rights][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981243.*ARGS:metatags[dcterms.rights][default]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981243.*ARGS:metatags[copyright][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981243.*ARGS:metatags[copyright][default]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973300.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973304.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973333.*ARGS:body[und][0][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973302.*ARGS:metatags[dcterms.format][value]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973302.*ARGS:metatags[dcterms.format][default]/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule REQUEST_FILENAME "@streq /modules/statistics/statistics.php" 
"chain,phase:2,t:none,nolog,pass"
     SecRule TX:'/^960010/' "@streq Item 1=1" "chain,t:none"
            SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule REQUEST_FILENAME "@streq /ckeditor/xss" 
"chain,phase:2,t:none,nolog,pass"
     SecRule TX:'/^960010/' "@streq Item 1=1" "chain,t:none"
            SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule REQUEST_FILENAME "@streq /ckeditor/xss" 
"chain,phase:2,t:none,nolog,pass"
     SecRule TX:'/^950109/' "@streq Item 1=1" "chain,t:none"
            SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-2"

SecRule TX:'/^950901.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^960024.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule TX:'/^981173.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule TX:'/^981257.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981245.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973300.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973304.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^973333.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981172.*REQUEST_COOKIES:CHOCOLATECHIPSSL/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"

SecRule TX:'/^981247.*ARGS:crmasmSelect0/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981247.*ARGS:crmasmSelect1/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981247.*ARGS:crmasmSelect2/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981247.*ARGS:crmasmSelect3/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

SecRule TX:'/^981247.*ARGS:crmasmSelect4/' ".*" 
"chain,phase:2,t:none,nolog,pass"
     SecRule MATCHED_VAR_NAME "TX\:(.*)" 
"capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"

-- 

Jacob Lear
Web Administrator
FosterClub, Inc.


---
This email has been checked for viruses by Avast antivirus software.
http://www.avast.com


From think.sabin at gmail.com  Wed Jan 28 07:42:57 2015
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Wed, 28 Jan 2015 13:27:57 +0545
Subject: [Owasp-modsecurity-core-rule-set] problem executing external bash
	script
Message-ID: <CAE9Kp-Ybfvhs8BEsPaR==Pi06-AT8pi7MxLm73A++Dpj+fFfgA@mail.gmail.com>

hi,
I'm trying to send email when specific rule get matched in the modsecurity
but the modsecurity gives execution error in the mod_audit.log.

I have written my own test rule like this:

SecRule REQUEST_HEADERS:User-Agent "FAKE-USER"
"chain,deny,log,exec:/root/send_alert_email_fake-user.sh,id:1234123455"
        SecRule REMOTE_ADDR "^192\.168\.203\.141"

and my script looks like this:

#!/bin/sh
echo "Fake user tried to access the web application" |mail -s "local server
under attack" user at user.com
echo Done.

The mod_audit.log is giving this message and email is being send.

Message: Exec: Execution failed while reading output:
/root/send_alert_email_fake-user.sh (End of file found)
Message: Failed to execute: /root/send_alert_email_fake-user.sh
Message: Warning. Pattern match "^192\\.168\\.203\\.141" at REMOTE_ADDR.
[file
"/usr/share/modsecurity-crs/activated_rules/check_user_agent_email.conf"]
[line "1"] [id "1234123455"]

Please help me to fix this? I'm also referencing ModSecurity 2.5 by Magnus
Mischel.

thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150128/286d00f4/attachment.html>

From think.sabin at gmail.com  Wed Jan 28 08:09:26 2015
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Wed, 28 Jan 2015 13:54:26 +0545
Subject: [Owasp-modsecurity-core-rule-set] problem executing external
	bash script
In-Reply-To: <CAE9Kp-Ybfvhs8BEsPaR==Pi06-AT8pi7MxLm73A++Dpj+fFfgA@mail.gmail.com>
References: <CAE9Kp-Ybfvhs8BEsPaR==Pi06-AT8pi7MxLm73A++Dpj+fFfgA@mail.gmail.com>
Message-ID: <CAE9Kp-Y52o=Gt5dU_aMk3QuPrpvu26FzLLKoZ7Z7u0sSMV9C3Q@mail.gmail.com>

email is not being send.

On Wed, Jan 28, 2015 at 1:27 PM, Sabin Ranjit <think.sabin at gmail.com> wrote:

> hi,
> I'm trying to send email when specific rule get matched in the modsecurity
> but the modsecurity gives execution error in the mod_audit.log.
>
> I have written my own test rule like this:
>
> SecRule REQUEST_HEADERS:User-Agent "FAKE-USER"
> "chain,deny,log,exec:/root/send_alert_email_fake-user.sh,id:1234123455"
>         SecRule REMOTE_ADDR "^192\.168\.203\.141"
>
> and my script looks like this:
>
> #!/bin/sh
> echo "Fake user tried to access the web application" |mail -s "local
> server under attack" user at user.com
> echo Done.
>
> The mod_audit.log is giving this message and email is being send.
>
> Message: Exec: Execution failed while reading output:
> /root/send_alert_email_fake-user.sh (End of file found)
> Message: Failed to execute: /root/send_alert_email_fake-user.sh
> Message: Warning. Pattern match "^192\\.168\\.203\\.141" at REMOTE_ADDR.
> [file
> "/usr/share/modsecurity-crs/activated_rules/check_user_agent_email.conf"]
> [line "1"] [id "1234123455"]
>
> Please help me to fix this? I'm also referencing ModSecurity 2.5 by Magnus
> Mischel.
>
> thanks.
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150128/75131767/attachment-0001.html>

From alexandre at objectdata.com.br  Wed Jan 28 08:49:47 2015
From: alexandre at objectdata.com.br (Alexandre Riveira)
Date: Wed, 28 Jan 2015 06:49:47 -0200
Subject: [Owasp-modsecurity-core-rule-set] Unsubscribe
Message-ID: <CAL5QHYHWJgqv4Jwn8HQeHGsUEGwxg+y4nBK0GtyovCJ3hH1b2Q@mail.gmail.com>

Em 28/01/2015 06:16, <
owasp-modsecurity-core-rule-set-request at lists.owasp.org> escreveu:

> Send Owasp-modsecurity-core-rule-set mailing list submissions to
>         owasp-modsecurity-core-rule-set at lists.owasp.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> or, via email, send a message with subject or body 'help' to
>         owasp-modsecurity-core-rule-set-request at lists.owasp.org
>
> You can reach the person managing the list at
>         owasp-modsecurity-core-rule-set-owner at lists.owasp.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-modsecurity-core-rule-set digest..."
>
>
> Today's Topics:
>
>    1. Re: Legitimate traffic being blocked (Chaim Sanders)
>    2. Re: Legitimate traffic being      blocked (Jacob Lear)
>    3. problem executing external bash   script (Sabin Ranjit)
>    4. Re: problem executing external    bash script (Sabin Ranjit)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Tue, 27 Jan 2015 15:56:49 +0000
> From: Chaim Sanders <CSanders at trustwave.com>
> To: "owasp-modsecurity-core-rule-set at lists.owasp.org"
>         <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Legitimate traffic
>         being blocked
> Message-ID:
>         <F684BDD553BAF1479F5380EDAD3BE371F77877 at SKYMB1.trustwave.com>
> Content-Type: text/plain; charset="iso-8859-1"
>
> Hello Jacob sorry for the slow response,
> Based on your log file it seems clear that you are using an out dated
> version of CRS. Updating may fix *some* of the false positives you are
> facing. Upon inspecting your log the following rules are being triggered:
>         Detects concatenated basic SQL Injection and SQLLFI attempts
>         Request from Known SPAM Source
>         Restricted SQL Character anomaly detection alert
>         SQL Injection Attack: SQL Operator Detected
>         Request content type is not allowed by policy
> It is possible that some or all of these are false positives based on how
> the application is functioning. I suggest you follow the guidance set forth
> in the following blog post (
> http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-exception-handling.html)
> in order to analyze these events. If you are having additional issues
> please be sure to reach out and we will try to address them as best as
> possible. Thanks!
>
>
> Chaim Sanders
> Security Researcher, SpiderLabs
>
> Trustwave | SMART SECURITY ON DEMAND
> www.trustwave.com
>
>
> -----Original Message-----
> From: Ryan Barnett
> Sent: Tuesday, January 27, 2015 10:04 AM
> To: Chaim Sanders
> Subject: FW: [Owasp-modsecurity-core-rule-set] Legitimate traffic being
> blocked
>
> On 1/23/15, 6:20 PM, "Jacob Lear" <jacob at fosterclub.com> wrote:
>
> >Hello,
> >
> >I am working on setting up better security for my Debian 6 server. I am
> >new to ModSecurity and OWASP Core Rules. The problem that I'm having is
> >that it is blocking legitimate traffic and I don't understand why or
> >how to fix it. Can somebody help me? Here is some pretty detailed
> >information about my environment and my problem.
> >
> >Apache2 is my webserver and it is installed from the Debian package.
> >The version is 2.2.16-6+squeeze14. I'm using the Worker MPM.
> >I installed ModSecurity from the Debian package. The version is:
> >2.5.12-1+squeeze4
> >Per the recommendation of an article I found online, I installed OWASP
> >2.2.5-0. I had initially tried the most recent version of OWASP but
> >this gave me errors (due to my version of ModSecurity).
> >I'm using PHP compiled from source, version 5.4.24.
> >I'm using PHP-FPM FastCGI.
> >I'm using MySQL 5.1.73-1+deb6u1.
> >I'm using Memcached 2.1.0.
> >ZendOpcode Cache 7.0.3 is installed.
> >Website is built using the Drupal CMS, version 7.28.
> >All non-SSL traffic is redirected to SSL.
> >
> >I had some troubles getting Apache2 to pass the configtest but I was
> >able to find the proper configuration changes needed via Google
> >searching. I enabled all of the rules as per the INSTALL instructions
> >included in OWASP CRS. I also enabled the experimental Brute Force,
> >DOS, and Slow DOS rules (these don't appear to be causing any issues.)
> >
> >I set ModSecurity to "On" mode but quickly got complaints from our
> >staff being blocked by it. So now it is in "DetectionOnly" mode. I
> >looked in the AuditLog but didn't see anything helpful in there (just a
> >bunch of stuff about cookies -- perhaps because things in the 10 setup
> >file are set to nolog?). However, the Apache2 SSL Error log shows a lot
> >of information about the block attempts.
> >
> >Our staff users are connecting from the IP address 63.227.218.204, so I
> >filtered the SSL Error Log to dump all entries with that IP address to
> >a separate file. All of the warnings/errors in this log are legitimate
> >traffic. So I need help tuning ModSecurity and OWASP to permit this
> >traffic. I've attached the log file to this post.
> >http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
> >GhD
> >Vv7Jp46g&s=5&u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
> >ffi
> >les%2ffile%2foutput%2elog
> >
> >I have also attached my modsecurity.conf file and my
> >modsecurity_crs_10_setup.conf file.
> >http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
> >GhD
> >Ns5sp46Q&s=5&u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
> >ffi
> >les%2ffile%2fmodsecurity%2econf
> >http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
> >GhG
> >Vrusp95w&s=5&u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
> >ffi les%2ffile%2fmodsecurity%5fcrs%5f10%5fsetup%2econf
> >
> >I would very much appreciate any help anyone can offer. Please let me
> >know if you need any additional information. Thanks!
> >
> >
> >--
> >
> >Jacob Lear
> >Web Administrator
> >FosterClub, Inc.
> >
> >
> >---
> >This email has been checked for viruses by Avast antivirus software.
> >http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
> >GhG Ey688p7w&s=5&u=http%3a%2f%2fwww%2eavast%2ecom
> >
> >_______________________________________________
> >Owasp-modsecurity-core-rule-set mailing list
> >Owasp-modsecurity-core-rule-set at lists.owasp.org
> >http://scanmail.trustwave.com/?c=4062&d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-
> >GhG
> >Q65sp85w&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2
> >fow
> >asp-modsecurity-core-rule-set
>
>
> ________________________________
>
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is strictly prohibited. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>
>
> ------------------------------
>
> Message: 2
> Date: Tue, 27 Jan 2015 18:41:09 -0800
> From: Jacob Lear <jacob at fosterclub.com>
> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Legitimate traffic
>         being   blocked
> Message-ID: <54C84C45.6030009 at fosterclub.com>
> Content-Type: text/plain; charset=utf-8; format=flowed
>
> Hi Chaim,
>
> thanks for the response. I actually did stumble across that blog post
> and tried to write some exceptions to get things working. There are SO
> many exceptions needed though! I think I will try removing the DEB/RPM
> of ModSecurity and try installing it from source. That way I will be
> able to install the most recent version of CRS.
>
> So far this is what I've written for exceptions. Am I doing it correctly??
>
> In modsecurity_crs_15_customerules.conf:
> SecRule REQUEST_FILENAME "@rx /node/*/edit"
> "phase:1,t:none,nolog,pass,ctl:ruleRemoveById=981173"
>
> SecRule REQUEST_FILENAME "@streq /civicrm/contribute/search"
> "phase:1,t:none,nolog,pass,ctl:ruleRemoveById=981173"
>
> SecRule REQUEST_FILENAME "@streq /civicrm/ajax/inline"
> "phase:1,t:none,nolog,pass,ctl:ruleRemoveById=981173"
>
>
> In modsecurity_crs_48_local_exceptions.conf:
> SecRule REQUEST_FILENAME "@rx /node/*/edit"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule TX:'/^960010/' "@streq Item 1=1" "chain,t:none"
>             SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule REQUEST_FILENAME "@rx /node/*/edit"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule TX:'/^950109/' "@streq Item 1=1" "chain,t:none"
>             SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-2"
>
> SecRule TX:'/^950901.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^960024.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule TX:'/^960024.*ARGS:metatags[title][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule TX:'/^960024.*ARGS:metatags[title][default]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule TX:'/^981257.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981245.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981245.*ARGS:metatags[dcterms.rights][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981245.*ARGS:metatags[dcterms.rights][default]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981245.*ARGS:metatags[copyright][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981245.*ARGS:metatags[copyright][default]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981243.*ARGS:metatags[dcterms.rights][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981243.*ARGS:metatags[dcterms.rights][default]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981243.*ARGS:metatags[copyright][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981243.*ARGS:metatags[copyright][default]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973300.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973304.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973333.*ARGS:body[und][0][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973302.*ARGS:metatags[dcterms.format][value]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973302.*ARGS:metatags[dcterms.format][default]/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule REQUEST_FILENAME "@streq /modules/statistics/statistics.php"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule TX:'/^960010/' "@streq Item 1=1" "chain,t:none"
>             SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule REQUEST_FILENAME "@streq /ckeditor/xss"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule TX:'/^960010/' "@streq Item 1=1" "chain,t:none"
>             SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule REQUEST_FILENAME "@streq /ckeditor/xss"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule TX:'/^950109/' "@streq Item 1=1" "chain,t:none"
>             SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-2"
>
> SecRule TX:'/^950901.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^960024.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule TX:'/^981173.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule TX:'/^981257.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981245.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973300.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973304.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^973333.*ARGS:text/' ".*" "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981172.*REQUEST_COOKIES:CHOCOLATECHIPSSL/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-3"
>
> SecRule TX:'/^981247.*ARGS:crmasmSelect0/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981247.*ARGS:crmasmSelect1/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981247.*ARGS:crmasmSelect2/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981247.*ARGS:crmasmSelect3/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> SecRule TX:'/^981247.*ARGS:crmasmSelect4/' ".*"
> "chain,phase:2,t:none,nolog,pass"
>      SecRule MATCHED_VAR_NAME "TX\:(.*)"
> "capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-5"
>
> --
>
> Jacob Lear
> Web Administrator
> FosterClub, Inc.
>
>
> ---
> This email has been checked for viruses by Avast antivirus software.
> http://www.avast.com
>
>
>
> ------------------------------
>
> Message: 3
> Date: Wed, 28 Jan 2015 13:27:57 +0545
> From: Sabin Ranjit <think.sabin at gmail.com>
> To: mod-security-users at lists.sourceforge.net,
>         owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: [Owasp-modsecurity-core-rule-set] problem executing external
>         bash    script
> Message-ID:
>         <CAE9Kp-Ybfvhs8BEsPaR==
> Pi06-AT8pi7MxLm73A++Dpj+fFfgA at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> hi,
> I'm trying to send email when specific rule get matched in the modsecurity
> but the modsecurity gives execution error in the mod_audit.log.
>
> I have written my own test rule like this:
>
> SecRule REQUEST_HEADERS:User-Agent "FAKE-USER"
> "chain,deny,log,exec:/root/send_alert_email_fake-user.sh,id:1234123455"
>         SecRule REMOTE_ADDR "^192\.168\.203\.141"
>
> and my script looks like this:
>
> #!/bin/sh
> echo "Fake user tried to access the web application" |mail -s "local server
> under attack" user at user.com
> echo Done.
>
> The mod_audit.log is giving this message and email is being send.
>
> Message: Exec: Execution failed while reading output:
> /root/send_alert_email_fake-user.sh (End of file found)
> Message: Failed to execute: /root/send_alert_email_fake-user.sh
> Message: Warning. Pattern match "^192\\.168\\.203\\.141" at REMOTE_ADDR.
> [file
> "/usr/share/modsecurity-crs/activated_rules/check_user_agent_email.conf"]
> [line "1"] [id "1234123455"]
>
> Please help me to fix this? I'm also referencing ModSecurity 2.5 by Magnus
> Mischel.
>
> thanks.
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150128/286d00f4/attachment-0001.html
> >
>
> ------------------------------
>
> Message: 4
> Date: Wed, 28 Jan 2015 13:54:26 +0545
> From: Sabin Ranjit <think.sabin at gmail.com>
> To: mod-security-users at lists.sourceforge.net,
>         owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] problem executing
>         external        bash script
> Message-ID:
>         <CAE9Kp-Y52o=
> Gt5dU_aMk3QuPrpvu26FzLLKoZ7Z7u0sSMV9C3Q at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> email is not being send.
>
> On Wed, Jan 28, 2015 at 1:27 PM, Sabin Ranjit <think.sabin at gmail.com>
> wrote:
>
> > hi,
> > I'm trying to send email when specific rule get matched in the
> modsecurity
> > but the modsecurity gives execution error in the mod_audit.log.
> >
> > I have written my own test rule like this:
> >
> > SecRule REQUEST_HEADERS:User-Agent "FAKE-USER"
> > "chain,deny,log,exec:/root/send_alert_email_fake-user.sh,id:1234123455"
> >         SecRule REMOTE_ADDR "^192\.168\.203\.141"
> >
> > and my script looks like this:
> >
> > #!/bin/sh
> > echo "Fake user tried to access the web application" |mail -s "local
> > server under attack" user at user.com
> > echo Done.
> >
> > The mod_audit.log is giving this message and email is being send.
> >
> > Message: Exec: Execution failed while reading output:
> > /root/send_alert_email_fake-user.sh (End of file found)
> > Message: Failed to execute: /root/send_alert_email_fake-user.sh
> > Message: Warning. Pattern match "^192\\.168\\.203\\.141" at REMOTE_ADDR.
> > [file
> > "/usr/share/modsecurity-crs/activated_rules/check_user_agent_email.conf"]
> > [line "1"] [id "1234123455"]
> >
> > Please help me to fix this? I'm also referencing ModSecurity 2.5 by
> Magnus
> > Mischel.
> >
> > thanks.
> >
> >
> >
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150128/75131767/attachment.html
> >
>
> ------------------------------
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
> End of Owasp-modsecurity-core-rule-set Digest, Vol 69, Issue 3
> **************************************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150128/72b30773/attachment-0001.html>

From think.sabin at gmail.com  Wed Jan 28 08:56:59 2015
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Wed, 28 Jan 2015 14:41:59 +0545
Subject: [Owasp-modsecurity-core-rule-set] problem executing external
	bash script
In-Reply-To: <CAE9Kp-Y52o=Gt5dU_aMk3QuPrpvu26FzLLKoZ7Z7u0sSMV9C3Q@mail.gmail.com>
References: <CAE9Kp-Ybfvhs8BEsPaR==Pi06-AT8pi7MxLm73A++Dpj+fFfgA@mail.gmail.com>
	<CAE9Kp-Y52o=Gt5dU_aMk3QuPrpvu26FzLLKoZ7Z7u0sSMV9C3Q@mail.gmail.com>
Message-ID: <CAE9Kp-YuKm4mr41hsztY16JrC+SYhkfBG_X7enu3GK9yH+7Haw@mail.gmail.com>

issue has been fixed.
the problem was that i put that bash script in the /root/ directory.
Keeping it inside /usr/share/modsecurity-crs/ it worked.


On Wed, Jan 28, 2015 at 1:54 PM, Sabin Ranjit <think.sabin at gmail.com> wrote:

> email is not being send.
>
> On Wed, Jan 28, 2015 at 1:27 PM, Sabin Ranjit <think.sabin at gmail.com>
> wrote:
>
>> hi,
>> I'm trying to send email when specific rule get matched in the
>> modsecurity but the modsecurity gives execution error in the mod_audit.log.
>>
>> I have written my own test rule like this:
>>
>> SecRule REQUEST_HEADERS:User-Agent "FAKE-USER"
>> "chain,deny,log,exec:/root/send_alert_email_fake-user.sh,id:1234123455"
>>         SecRule REMOTE_ADDR "^192\.168\.203\.141"
>>
>> and my script looks like this:
>>
>> #!/bin/sh
>> echo "Fake user tried to access the web application" |mail -s "local
>> server under attack" user at user.com
>> echo Done.
>>
>> The mod_audit.log is giving this message and email is being send.
>>
>> Message: Exec: Execution failed while reading output:
>> /root/send_alert_email_fake-user.sh (End of file found)
>> Message: Failed to execute: /root/send_alert_email_fake-user.sh
>> Message: Warning. Pattern match "^192\\.168\\.203\\.141" at REMOTE_ADDR.
>> [file
>> "/usr/share/modsecurity-crs/activated_rules/check_user_agent_email.conf"]
>> [line "1"] [id "1234123455"]
>>
>> Please help me to fix this? I'm also referencing ModSecurity 2.5 by
>> Magnus Mischel.
>>
>> thanks.
>>
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150128/091fc2a9/attachment.html>

From ilyassikai at gmail.com  Fri Jan 30 16:30:45 2015
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Fri, 30 Jan 2015 16:30:45 +0000
Subject: [Owasp-modsecurity-core-rule-set] Block upload file (jsp, php)
Message-ID: <CAMmziWd1RKwOStzrCS2CJHdC1ErWVqRGrSmO3OtMaVJE+XvGZQ@mail.gmail.com>

Hi ,

How can I block upload a specific file such as (.jsp/.php)
I configured this rule :
/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_30_http_policy.conf

with this :

SecAction \
  "id:'900012', \
                                                                      phase:1,
\
  t:none, \


  setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \



setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json',
\
  setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \


  setvar:'tx.restricted_extensions=.asa/ .jsp/ .asax/ .ascx/ .axd/ .backup/
.bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/
.csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ \
.idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
.pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/
.vsdisco/ .webinfo/ .xsd/ .xsx/', \
  setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
/Content-Range/ /Translate/ /via/ /if/', \

  nolog, \


  pass


?But it's don't stop upload .jsp file.

Have you any idea ?

Thank you?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150130/7d52b27c/attachment.html>

