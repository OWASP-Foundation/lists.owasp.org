<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20prevent%20request%20body%0A%09logging%3F&In-Reply-To=%3CCAAyjSBQdchMa0OmHA_-Wtf2Braye%3DvLo%3DtBYps7Mx-sdnRJUCA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001758.html">
   <LINK REL="Next"  HREF="001760.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?</H1>
    <B>Charles Farinella</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20prevent%20request%20body%0A%09logging%3F&In-Reply-To=%3CCAAyjSBQdchMa0OmHA_-Wtf2Braye%3DvLo%3DtBYps7Mx-sdnRJUCA%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?">cfarinella at appropriatesolutions.com
       </A><BR>
    <I>Wed Jun  3 14:22:10 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001758.html">[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
</A></li>
        <LI>Next message: <A HREF="001760.html">[Owasp-modsecurity-core-rule-set] How to prevent request body logging?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1759">[ date ]</a>
              <a href="thread.html#1759">[ thread ]</a>
              <a href="subject.html#1759">[ subject ]</a>
              <a href="author.html#1759">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the suggestions, but I don't think either of these will solve
our problem permanently.

The 'nolog' option is rule or status code dependent and we want to make
sure that *no* request bodies are ever printed to the Nginx log.
The 'SecAuditLogParts' option seems to only affect what gets sent to the
audit logs, we've tried this.  Mod_security docs say that &quot;Messages at
levels 1-3 are *always* copied to the Apache error log.&quot;   We are assuming
that this applies equally to Nginx logs, and this is what we need to
address.

We have clients sending credit card numbers in request bodies and they are
triggering mod_security SQL injection rules which then write these bodies
to the Nginx logs exposing the CC number.

We know that we can disable these specific rules, but are afraid that at
some future time, or after an upgrade, these or some other rules will be
triggered again exposing sensitive information.

Does OWASP have a &quot;best practices&quot; procedure for protecting this kind of
data in a PCI environment?
How can we prevent *all* level 1-3 messages from being sent to the Nginx
log?

Thanks again for your help.

--charlie

On Tue, Jun 2, 2015 at 4:08 PM, Joshua Roback &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jroback at gmail.com</A>&gt; wrote:

&gt;<i> Inside your base modsecurity.conf file, I believe the following directive
</I>&gt;<i> will allow you to choose which pars are logged based on the assigned letter
</I>&gt;<i> values.
</I>&gt;<i> Example below will remove REQUEST and RESPONSE body:
</I>&gt;<i> SecAuditLogParts ABIFEHZ
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Tue, Jun 2, 2015 at 11:39 AM Chaim Sanders &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>  Hey Charles,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You can use the nolog action to prevent ModSecurity from adding entries.
</I>&gt;&gt;<i> For instance:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> SecRule ARGS:test &quot;Test&quot; &quot;block,status:403,nolog,id:1&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Chaim Sanders    *
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Security Researcher, SpiderLabs
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *Trustwave* | SMART SECURITY ON DEMAND
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> www.trustwave.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> *From:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A> [mailto:
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] *On Behalf Of *Charles
</I>&gt;&gt;<i> Farinella
</I>&gt;&gt;<i> *Sent:* Tuesday, June 2, 2015 10:38 AM
</I>&gt;&gt;<i> *To:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> *Subject:* [Owasp-modsecurity-core-rule-set] How to prevent request body
</I>&gt;&gt;<i> logging?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We are seeing request bodies logged to our nginx logs.  mod_security
</I>&gt;&gt;<i> documentation says that &quot;Messages at levels 1-3 are always copied to the
</I>&gt;&gt;<i> Apache error log.&quot;  Does anyone know how we can prevent this behavior?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Charles Farinella
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Systems Administrator
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Appropriate Solutions, Inc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 603-924-6079
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------------------------
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This transmission may contain information that is privileged,
</I>&gt;&gt;<i> confidential, and/or exempt from disclosure under applicable law. If you
</I>&gt;&gt;<i> are not the intended recipient, you are hereby notified that any
</I>&gt;&gt;<i> disclosure, copying, distribution, or use of the information contained
</I>&gt;&gt;<i> herein (including any reliance thereon) is strictly prohibited. If you
</I>&gt;&gt;<i> received this transmission in error, please immediately contact the sender
</I>&gt;&gt;<i> and destroy the material in its entirety, whether in electronic or hard
</I>&gt;&gt;<i> copy format.
</I>&gt;&gt;<i>  _______________________________________________
</I>&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

-- 
Charles Farinella
Systems Administrator
Appropriate Solutions, Inc.
603-924-6079
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150603/715cefcc/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150603/715cefcc/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001758.html">[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
</A></li>
	<LI>Next message: <A HREF="001760.html">[Owasp-modsecurity-core-rule-set] How to prevent request body logging?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1759">[ date ]</a>
              <a href="thread.html#1759">[ thread ]</a>
              <a href="subject.html#1759">[ subject ]</a>
              <a href="author.html#1759">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
