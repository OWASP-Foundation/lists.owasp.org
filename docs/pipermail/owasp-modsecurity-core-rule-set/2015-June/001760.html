<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] How to prevent request body logging?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20prevent%20request%20body%0A%20logging%3F&In-Reply-To=%3CC310131DD0004743B2508B65C77B663150A08AA0%40PMEXGMB04.juniper.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001759.html">
   <LINK REL="Next"  HREF="001761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] How to prevent request body logging?</H1>
    <B>Thayyilekandy, Subin : Barclaycard US</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20prevent%20request%20body%0A%20logging%3F&In-Reply-To=%3CC310131DD0004743B2508B65C77B663150A08AA0%40PMEXGMB04.juniper.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] How to prevent request body logging?">sthayyilekan at BarclaycardUS.com
       </A><BR>
    <I>Wed Jun  3 14:34:40 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001759.html">[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
</A></li>
        <LI>Next message: <A HREF="001761.html">[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1760">[ date ]</a>
              <a href="thread.html#1760">[ thread ]</a>
              <a href="subject.html#1760">[ subject ]</a>
              <a href="author.html#1760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Did you try sanitizeArgs in your custom rules After  file  ? you can also specify pattern here I believe otherwise you will have to keep adding new/updated fields here that can possibly have sensitive data.

SecAction &quot;phase:5,id:200,nolog,pass,\
  sanitiseArg:password,\
  sanitiseArg:confirmPassword,\



Thanks

Subin

From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf Of Charles Farinella
Sent: Wednesday, June 03, 2015 10:22 AM
To: Joshua Roback
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: Re: [Owasp-modsecurity-core-rule-set] How to prevent request body logging?

Thanks for the suggestions, but I don't think either of these will solve our problem permanently.
The 'nolog' option is rule or status code dependent and we want to make sure that *no* request bodies are ever printed to the Nginx log.
The 'SecAuditLogParts' option seems to only affect what gets sent to the audit logs, we've tried this.  Mod_security docs say that &quot;Messages at levels 1-3 are *always* copied to the Apache error log.&quot;   We are assuming that this applies equally to Nginx logs, and this is what we need to address.
We have clients sending credit card numbers in request bodies and they are triggering mod_security SQL injection rules which then write these bodies to the Nginx logs exposing the CC number.
We know that we can disable these specific rules, but are afraid that at some future time, or after an upgrade, these or some other rules will be triggered again exposing sensitive information.
Does OWASP have a &quot;best practices&quot; procedure for protecting this kind of data in a PCI environment?
How can we prevent *all* level 1-3 messages from being sent to the Nginx log?

Thanks again for your help.
--charlie

On Tue, Jun 2, 2015 at 4:08 PM, Joshua Roback &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jroback at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jroback at gmail.com</A>&gt;&gt; wrote:
Inside your base modsecurity.conf file, I believe the following directive will allow you to choose which pars are logged based on the assigned letter values.
Example below will remove REQUEST and RESPONSE body:
SecAuditLogParts ABIFEHZ


On Tue, Jun 2, 2015 at 11:39 AM Chaim Sanders &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&gt;&gt; wrote:
Hey Charles,
You can use the nolog action to prevent ModSecurity from adding entries. For instance:
SecRule ARGS:test &quot;Test&quot; &quot;block,status:403,nolog,id:1&quot;


Chaim Sanders
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;

From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&gt; [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&gt;] On Behalf Of Charles Farinella
Sent: Tuesday, June 2, 2015 10:38 AM
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: [Owasp-modsecurity-core-rule-set] How to prevent request body logging?

We are seeing request bodies logged to our nginx logs.  mod_security documentation says that &quot;Messages at levels 1-3 are always copied to the Apache error log.&quot;  Does anyone know how we can prevent this behavior?

--
Charles Farinella
Systems Administrator
Appropriate Solutions, Inc.
603-924-6079&lt;tel:603-924-6079&gt;

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>



--
Charles Farinella
Systems Administrator
Appropriate Solutions, Inc.
603-924-6079

Barclaycard

www.barclaycardus.com&lt;<A HREF="http://www.barclaycardus.com">http://www.barclaycardus.com</A>&gt;

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150603/e65f867f/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150603/e65f867f/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001759.html">[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
</A></li>
	<LI>Next message: <A HREF="001761.html">[Owasp-modsecurity-core-rule-set] How to prevent request body	logging?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1760">[ date ]</a>
              <a href="thread.html#1760">[ thread ]</a>
              <a href="subject.html#1760">[ subject ]</a>
              <a href="author.html#1760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
