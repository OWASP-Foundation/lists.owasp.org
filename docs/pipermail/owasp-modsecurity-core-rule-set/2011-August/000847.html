<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off	recommendations
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20ctl%3AauditEngine%3DOff%0A%09recommendations&In-Reply-To=CA72897D.2FAE1%25rbarnett%40trustwave.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000845.html">
   <LINK REL="Next"  HREF="000844.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off	recommendations</H1>
    <B>Gil Vidals</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20ctl%3AauditEngine%3DOff%0A%09recommendations&In-Reply-To=CA72897D.2FAE1%25rbarnett%40trustwave.com"
       TITLE="[Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off	recommendations">gvidals at vmracks.com
       </A><BR>
    <I>Thu Aug 18 12:12:14 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000845.html">[Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off recommendations
</A></li>
        <LI>Next message: <A HREF="000844.html">[Owasp-modsecurity-core-rule-set] New Blog Post - ModSecurity Advanced Topic of the Week: Automated Virtual Patching Script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#847">[ date ]</a>
              <a href="thread.html#847">[ thread ]</a>
              <a href="subject.html#847">[ subject ]</a>
              <a href="author.html#847">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think there is a bug that won't allow us to omit log entries to the audit
log. In my case, I tried several different phases and crs files as you can
see below:

in modsecurity_crs_48_local_exceptions.conf AND I tried
modsecurity_crs_15_customrules.conf

   - SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot; &quot;nolog,noauditlog,pass&quot;
   - SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot;
   &quot;nolog,noauditlog,pass,ctl:auditEngine=Off&quot;


And after restarting apache, I still am getting these entries:

--4489f76b-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com_bot_version_1.4_(<A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>)
Host: blah.com

Gil Vidals / VM Racks
ESXi Hosting


On Thu, Aug 18, 2011 at 6:26 AM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> On 8/18/11 3:21 AM, &quot;Paul McGarry&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">paul at paulmcgarry.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt;Hi all,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;I have a site which is routinely scanned both internally and by
</I>&gt;<i> &gt;external service.
</I>&gt;<i> &gt;I want to have mod_security running and intervening but don't want any
</I>&gt;<i> &gt;of the associated log noise, the scans originate from known IPs and
</I>&gt;<i> &gt;have known User agents etc so I can easily identify them.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;So far I have been turning the auditEngine off with things like:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;SecRule REMOTE_ADDR &quot;^123\.123\.123\.123$&quot; &quot;nolog,ctl:auditEngine=Off&quot;
</I>&gt;<i>
</I>&gt;<i> Try this rule and see if it works any better -
</I>&gt;<i>
</I>&gt;<i> SecRule REMOTE_ADDR &quot;@ipMatch 123.123.123.123&quot;
</I>&gt;<i> &quot;phase:1,t:none,nolog,pass,ctl:auditEngine=Off&quot;
</I>&gt;<i>
</I>&gt;<i> This rule specifies phase:1 vs. defaulting to phase:2 if you don't
</I>&gt;<i> explicitly set one and it also uses the @ipMatch operator which is better
</I>&gt;<i> suited to handle IP addresses.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;but I have noticed this doesn't catch everything, specifically CRS
</I>&gt;<i> &gt;rule 981227 (Apache Error: Invalid URI in Request).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;If I understand things correctly this is because Apache is blocking
</I>&gt;<i> &gt;the request early and Modsec phases 1-4 don't run, it just goes
</I>&gt;<i> &gt;straight to 5?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Should I be putting my rule above in phase 5 (additionally or instead)?
</I>&gt;<i>
</I>&gt;<i> Good observation. Yes, there are some requests that may be handled by
</I>&gt;<i> Apache before it reaches the ModSecurity hooks.  You may need to replicate
</I>&gt;<i> this rule to also run in phase:5.
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Ryan's blog at:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://blog.spiderlabs.com/2010/12/advanced-topic-of-the-week-handling-aut">http://blog.spiderlabs.com/2010/12/advanced-topic-of-the-week-handling-aut</A>
</I>&gt;<i> &gt;horized-scanning-traffic.html
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;and modsecurity_crs_11_avs_traffic.conf CRS file seem to suggest that
</I>&gt;<i> &gt;phase 1 is the preferred place but that doesn't seem to be entirely
</I>&gt;<i> &gt;effective for me. Am I missing something?
</I>&gt;<i>
</I>&gt;<i> One other monkey wrench here... Reference this JIRA ticket -
</I>&gt;<i> <A HREF="https://www.modsecurity.org/tracker/browse/MODSEC-98.">https://www.modsecurity.org/tracker/browse/MODSEC-98.</A>  Ivan Ristic had
</I>&gt;<i> previously made a change to the code so that phase:1 and phase:2 actually
</I>&gt;<i> run in the same Apache hook (fixup phase -
</I>&gt;<i> <A HREF="https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen">https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen</A>
</I>&gt;<i> ce_Manual#Processing_Phases&lt;<A HREF="https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#Processing_Phases">https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#Processing_Phases</A>&gt;).
</I>&gt;<i>  This was done for a valid reason - running
</I>&gt;<i> rules in the post-read-request hook prevented users from nesting
</I>&gt;<i> ModSecurity SecRules within Apache scope locations (such as &lt;Location&gt;,
</I>&gt;<i> &lt;Directory&gt;, etc...).  His change fixes that, however there are some
</I>&gt;<i> examples where you actually want a rule to run in the old phase:1 hook
</I>&gt;<i> (post-read-request).  We are currently reviewing this change and
</I>&gt;<i> considering options.
</I>&gt;<i>
</I>&gt;<i> -Ryan
</I>&gt;<i>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Paul
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> &gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> &gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This transmission may contain information that is privileged, confidential,
</I>&gt;<i> and/or exempt from disclosure under applicable law. If you are not the
</I>&gt;<i> intended recipient, you are hereby notified that any disclosure, copying,
</I>&gt;<i> distribution, or use of the information contained herein (including any
</I>&gt;<i> reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
</I>&gt;<i> in error, please immediately contact the sender and destroy the material in
</I>&gt;<i> its entirety, whether in electronic or hard copy format.
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>


-- 
Gil Vidals, VCP
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>
www.vmracks.com - VMware Hosting Service Provider
t. 760.705.4022 IM: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may
contain privileged and confidential information.  It is intended only for
the use of the person(s) named above.  If you are not the intended
recipient, please contact the sender by reply email and permanently delete
the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110818/7d3debd0/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110818/7d3debd0/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000845.html">[Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off recommendations
</A></li>
	<LI>Next message: <A HREF="000844.html">[Owasp-modsecurity-core-rule-set] New Blog Post - ModSecurity Advanced Topic of the Week: Automated Virtual Patching Script
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#847">[ date ]</a>
              <a href="thread.html#847">[ thread ]</a>
              <a href="subject.html#847">[ subject ]</a>
              <a href="author.html#847">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
