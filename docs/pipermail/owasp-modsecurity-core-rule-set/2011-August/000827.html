<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] help with preventing entries to audit log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20help%20with%20preventing%20entries%0A%20to%20audit%20log&In-Reply-To=CAOPXycRxpygquttDfOFDWk8xdbWNb%3DCFjEm9W0wBMHt1qTdqvA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000826.html">
   <LINK REL="Next"  HREF="000829.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20help%20with%20preventing%20entries%0A%20to%20audit%20log&In-Reply-To=CAOPXycRxpygquttDfOFDWk8xdbWNb%3DCFjEm9W0wBMHt1qTdqvA%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log">RBarnett at trustwave.com
       </A><BR>
    <I>Tue Aug  9 10:02:55 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000826.html">[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log
</A></li>
        <LI>Next message: <A HREF="000829.html">[Owasp-modsecurity-core-rule-set] allow:request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#827">[ date ]</a>
              <a href="thread.html#827">[ thread ]</a>
              <a href="subject.html#827">[ subject ]</a>
              <a href="author.html#827">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Looks like you put this rule in your 48 local exceptions file.  I would suggest you put it in a modsecurity_crs_15_customrules.conf file and change the phase to 1 (phase:1).  This will ensure your rule runs before the current rule that is triggering the alert.

-Ryan

From: Gil Vidals &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&gt;
Date: Tue, 9 Aug 2011 00:35:45 -0500
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] help with preventing entries to audit log

Changing pass to allow didn't help.

I forgot to mention mod sec is operating under DetectionOnly mode for the time being. The debug log shows that the pattern does match, but there is still an audit log entry being made for &quot;pingdom&quot;!

Here is the output of the debug log:

[08/Aug/2011:21:51:24 --0700] [www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5&lt;<A HREF="http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5">http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5</A>&gt;] Rule 7fe340b17a40: SecRule &quot;REQUEST_HEADERS:User-Agent&quot; &quot;@rx pingdom&quot; &quot;phase:2,nolog,noauditlog,pass,ctl:auditEngine=Off&quot;
[08/Aug/2011:21:51:24 --0700] [www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4&lt;<A HREF="http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4">http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4</A>&gt;] Executing operator &quot;rx&quot; with param &quot;pingdom&quot; against REQUEST_HEADERS:User-Agent.
[08/Aug/2011:21:51:24 --0700] [www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4&lt;<A HREF="http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4">http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4</A>&gt;] Warning. Pattern match &quot;pingdom&quot; at REQUEST_HEADERS:User-Agent. [file &quot;/etc/apache2/modsecurity.d/base_rules/modsecurity_crs_48_local_exceptions.conf&quot;] [line &quot;69&quot;]

On Sat, Aug 6, 2011 at 12:06 PM, Josh Amishav-Zlatin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamuse at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamuse at gmail.com</A>&gt;&gt; wrote:
What happens if you use allow instead of pass? Can you see what rules are firing in the debug log?

--
 - Josh


On Sat, Aug 6, 2011 at 12:09 AM, Gil Vidals &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&gt; wrote:
Thanks for the response. There must be something deeper going on here because even after adding the line you suggested, I'm still getting these entries after restarting apache:

--c073772f-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com_bot_version_1.4_(<A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>)
Host: blah.com&lt;<A HREF="http://blah.com">http://blah.com</A>&gt;

Why isn't this rule being applied as I thought. Is it time to turn on mod sec debugging?
  SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot; &quot;nolog,noauditlog,pass,ctl:auditEngine=Off&quot;


Gil Vidals / VM Racks

On Fri, Aug 5, 2011 at 1:02 PM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;&gt; wrote:
You should use the ctl action in your rule to turn off the audit engine -

SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot; &quot;nolog,noauditlog,pass,ctl:auditEngine=Off&quot;

Due to the fact that the UA data is easily spoofed, I would recommend you also do a check on the IP range or something so that attackers aren't evading your logging by putting pingdom in the UA field.

Ryan

On Aug 5, 2011, at 12:42 PM, &quot;Gil Vidals&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&gt;&gt; wrote:

Need help in preventing the log entry from the monitoring system at &lt;<A HREF="http://pingdom.com">http://pingdom.com</A>&gt; pingdom.com&lt;<A HREF="http://pingdom.com">http://pingdom.com</A>&gt;&lt;<A HREF="http://pingdom.com">http://pingdom.com</A>&gt; because there are thousands of these entries per day. No matter, what I try, I can't prevent the entry from being logged. I'm using the anomaly scoring.

in modsecurity_crs_48_local_exceptions.conf:
SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot; &quot;nolog,noauditlog,pass&quot;

And after restarting apache, I still am getting these entries:

--4489f76b-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com&lt;<A HREF="http://Pingdom.com">http://Pingdom.com</A>&gt;_bot_version_1.4_(&lt;<A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>&gt;<A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>)
Host: &lt;<A HREF="http://blah.com">http://blah.com</A>&gt; blah.com&lt;<A HREF="http://blah.com">http://blah.com</A>&gt;&lt;<A HREF="http://blah.com">http://blah.com</A>&gt;

What else do you recommend I try?

--
Gil Vidals, VCP
&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&gt;
&lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt;www.vmracks.com&lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt;&lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt; - VMware Hosting Service Provider
t. 760.705.4022&lt;tel:760.705.4022&gt; IM: &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt;&gt;
[<A HREF="http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]">http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]</A>
HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.



--
Gil Vidals, VCP
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;
www.vmracks.com&lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt; - VMware Hosting Service Provider
t. 760.705.4022&lt;tel:760.705.4022&gt; IM: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt;

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.


_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>





--
Gil Vidals, VCP
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;
www.vmracks.com&lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt; - VMware Hosting Service Provider
t. 760.705.4022 IM: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt;
[<A HREF="http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]">http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]</A>
HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.


________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000826.html">[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log
</A></li>
	<LI>Next message: <A HREF="000829.html">[Owasp-modsecurity-core-rule-set] allow:request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#827">[ date ]</a>
              <a href="thread.html#827">[ thread ]</a>
              <a href="subject.html#827">[ subject ]</a>
              <a href="author.html#827">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
