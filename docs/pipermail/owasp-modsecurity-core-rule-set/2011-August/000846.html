<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] 981242 SQL Injection detection false positives?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20981242%20SQL%20Injection%0A%20detection%20false%20positives%3F&In-Reply-To=CAPrE0SZ2y1DZXRysYeoo_-xUNNfELBzr-NO8fQq9QZVDAg1T%3DA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000841.html">
   <LINK REL="Next"  HREF="000840.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] 981242 SQL Injection detection false positives?</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20981242%20SQL%20Injection%0A%20detection%20false%20positives%3F&In-Reply-To=CAPrE0SZ2y1DZXRysYeoo_-xUNNfELBzr-NO8fQq9QZVDAg1T%3DA%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] 981242 SQL Injection detection false positives?">RBarnett at trustwave.com
       </A><BR>
    <I>Thu Aug 18 09:40:06 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000841.html">[Owasp-modsecurity-core-rule-set] 981242 SQL Injection detection false positives?
</A></li>
        <LI>Next message: <A HREF="000840.html">[Owasp-modsecurity-core-rule-set] 981242 SQL Injection	detection false positives?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#846">[ date ]</a>
              <a href="thread.html#846">[ thread ]</a>
              <a href="subject.html#846">[ subject ]</a>
              <a href="author.html#846">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 8/18/11 1:15 AM, &quot;Paul McGarry&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">paul at paulmcgarry.com</A>&gt; wrote:

&gt;<i>Thanks for the feedback.
</I>&gt;<i>
</I>&gt;<i>On Wed, Aug 17, 2011 at 10:36 PM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;
</I>&gt;<i>wrote:
</I>&gt;&gt;<i> Thanks for the feedback Paul.  FYI - you can review some of the
</I>&gt;&gt;<i>reference
</I>&gt;<i>
</I>&gt;&gt;<i> For the specific rule you mentioned - 981242 - this is a converted
</I>&gt;&gt;<i>phpids
</I>&gt;<i>
</I>&gt;<i>Incidently there seems to be a double usage of that ID (and others
</I>&gt;<i>near it, 981231-981246 actually) in
</I>&gt;<i>modsecurity_crs_41_sql_injection_attacks.conf
</I>
I will fix these, thanks.

&gt;<i>
</I>&gt;&gt;<i> rule.  You can review example test payloads that they use here -
</I>&gt;&gt;<i>
</I>&gt;&gt;<i><A HREF="https://dev.itratos.de/projects/php-ids/repository/entry/trunk/tests/IDS/">https://dev.itratos.de/projects/php-ids/repository/entry/trunk/tests/IDS/</A>
</I>&gt;&gt;<i>Mo
</I>&gt;&gt;<i> nitorTest.php.  Look for the public function testSQLIList() sections.
</I>&gt;<i>
</I>&gt;<i>I think previously I have ended up disabling many the PHP-IDS based
</I>&gt;<i>rules because of the false positives.
</I>&gt;<i>
</I>&gt;<i>Is there some difference between how PHP-IDS executes the rules and
</I>&gt;<i>how modsecurity treats them?
</I>&gt;<i>
</I>&gt;<i>I note that if I put:
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">a_a_axoraaaaaa at aaaaa.com</A>
</I>&gt;<i>in the box on
</I>&gt;<i><A HREF="https://demo.phpids.org/">https://demo.phpids.org/</A>
</I>&gt;<i>it poses no problem
</I>&gt;<i>
</I>&gt;<i>while accessing
</I>&gt;<i>
</I>&gt;<i><A HREF="http://testing/index.php?email=a_a_axoraaaaaa%40aaaa.com">http://testing/index.php?email=a_a_axoraaaaaa%40aaaa.com</A>
</I>&gt;<i>
</I>&gt;<i>generates:
</I>&gt;<i>
</I>&gt;<i>Message: Warning. Pattern match
</I>&gt;<i>&quot;(?i:(\\!\\=|\\&amp;\\&amp;|\\|\\||&gt;&gt;|&lt;&lt;|&gt;=|&lt;=|&lt;&gt;|&lt;=&gt;|xor|rlike|regexp|isnull)|(?:
</I>&gt;<i>not\\s+between\\s+0\\s+and)|(?:is\\s+null)|(like\\s+null)|(?:(?:^|\\W)in[+
</I>&gt;<i>\\s]*\\([\\s\\d\&quot;]+[^()]*\\))|(?:xor|&lt;&gt;|rlike(?:\\s+binary)?)|(?:regexp\\s
</I>&gt;<i>+binary))&quot;
</I>&gt;<i>at ARGS:email. [file
</I>&gt;<i>&quot;/etc/httpd/conf.d/modsecurity-crs_2.2.1/base_rules/modsecurity_crs_41_sql
</I>&gt;<i>_injection_attacks.conf&quot;]
</I>&gt;<i>[line &quot;52&quot;] [id &quot;981212&quot;] [rev &quot;2.2.1&quot;] [msg &quot;SQL Injection Attack:
</I>&gt;<i>SQL Operator Detected&quot;] [data &quot;xor&quot;] [severity &quot;CRITICAL&quot;] [tag
</I>&gt;<i>&quot;WEB_ATTACK/SQL_INJECTION&quot;] [tag &quot;WASCTC/WASC-19&quot;] [tag
</I>&gt;<i>&quot;OWASP_TOP_10/A1&quot;] [tag &quot;OWASP_AppSensor/CIE1&quot;] [tag &quot;PCI/6.5.2&quot;]
</I>&gt;<i>
</I>&gt;<i>Similarly
</I>&gt;<i>3 Orchard Street
</I>&gt;<i>on the PHP_IDS demo is fine and
</I>&gt;<i><A HREF="http://testing/index.php?street=3+Orchard+Street">http://testing/index.php?street=3+Orchard+Street</A>
</I>&gt;<i>gives me warnings (981248 on &quot;3 Or&quot; and 981242 on &quot;3 Orc&quot;)
</I>
The rule that triggered is not a converted PHPIDS rule but rather one that
we developed as part of the SQL Injection Challenge analysis.  This
particular rule is trying to identify common SQL Operators.  Examples here
-
<A HREF="https://docs.google.com/Doc?docid=0AZNlBave77hiZGNjanptbV84Z25yaHJmMjk&amp;pli=">https://docs.google.com/Doc?docid=0AZNlBave77hiZGNjanptbV84Z25yaHJmMjk&amp;pli=</A>
1#Operators_671486718712981_8325.  We tried to lessen false positives by
not triggering only on common keywords like &quot;AND&quot; or &quot;IS&quot;.


&gt;<i>
</I>&gt;<i>Ironically the rules seem to cause the most problems in places where
</I>&gt;<i>they might be most useful, ie where the user is actually entitled to
</I>&gt;<i>enter 'free text' and validation will more likely be looser than on
</I>&gt;<i>fields containing more defined parameters. (The anomoly score tends to
</I>&gt;<i>get ramped up too, such as when there is an email and an email_confirm
</I>&gt;<i>field on the same page or the street name appears twice in a
</I>&gt;<i>submission as part of both the cardholder info and shipping address.)
</I>
Interestingly, the reverse seems to be true :)  I posed a similar theory
internally at SpiderLabs and based on analysis of customer engagements
(from our Global Security Report - <A HREF="https://www.trustwave.com/GSR">https://www.trustwave.com/GSR</A>) totaling
more than 220 forensic investigations and more than 2300 pentests - we
found that free-text form fields are the least likely to have SQL
Injection related vulnerabilities.  Parameter types other than free-text
(numeric, drop-down lists, hidden fields, buttons, etc...) are far more
likely to have injection-type flaws as Devs wrongly assume that clients
will not (or can not) manipulate them.

-Ryan

&gt;<i>
</I>&gt;<i>I do not believe the stuff I work on is vulnerable to SQL injection
</I>&gt;<i>but we all know about defence in depth. It would be nice to have as
</I>&gt;<i>much turned on as possible on (for example) a page collecting credit
</I>&gt;<i>card info but some of the rules seem too loose to be usable in
</I>&gt;<i>practice with real world input the forms should be able to receive.
</I>&gt;<i>
</I>&gt;<i>Paul
</I>&gt;<i>
</I>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000841.html">[Owasp-modsecurity-core-rule-set] 981242 SQL Injection detection false positives?
</A></li>
	<LI>Next message: <A HREF="000840.html">[Owasp-modsecurity-core-rule-set] 981242 SQL Injection	detection false positives?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#846">[ date ]</a>
              <a href="thread.html#846">[ thread ]</a>
              <a href="subject.html#846">[ subject ]</a>
              <a href="author.html#846">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
