<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] help with preventing entries to audit log
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20help%20with%20preventing%20entries%0A%20to%20audit%20log&In-Reply-To=CANnPkinjk22ADfQ%2BzfSw8fLercfyTKmMGu1%2BcrZevT7GvqA0bQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000828.html">
   <LINK REL="Next"  HREF="000826.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log</H1>
    <B>Gil Vidals</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20help%20with%20preventing%20entries%0A%20to%20audit%20log&In-Reply-To=CANnPkinjk22ADfQ%2BzfSw8fLercfyTKmMGu1%2BcrZevT7GvqA0bQ%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log">gvidals at vmracks.com
       </A><BR>
    <I>Tue Aug  9 01:35:45 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000828.html">[Owasp-modsecurity-core-rule-set] Google Analytics cookie __utmz often trigger mod_security
</A></li>
        <LI>Next message: <A HREF="000826.html">[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#825">[ date ]</a>
              <a href="thread.html#825">[ thread ]</a>
              <a href="subject.html#825">[ subject ]</a>
              <a href="author.html#825">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Changing pass to allow didn't help.

I forgot to mention mod sec is operating under DetectionOnly mode for the
time being. The debug log shows that the pattern does match, but there is
still an audit log entry being made for &quot;pingdom&quot;!

Here is the output of the debug log:

[08/Aug/2011:21:51:24 --0700] [
www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5] Rule 7fe340b17a40:
SecRule &quot;REQUEST_HEADERS:User-Agent&quot; &quot;@rx pingdom&quot;
&quot;phase:2,nolog,noauditlog,pass,ctl:auditEngine=Off&quot;
[08/Aug/2011:21:51:24 --0700] [
www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4] Executing operator
&quot;rx&quot; with param &quot;pingdom&quot; against REQUEST_HEADERS:User-Agent.
[08/Aug/2011:21:51:24 --0700] [
www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4] Warning. Pattern
match &quot;pingdom&quot; at REQUEST_HEADERS:User-Agent. [file
&quot;/etc/apache2/modsecurity.d/base_rules/modsecurity_crs_48_local_exceptions.conf&quot;]
[line &quot;69&quot;]

On Sat, Aug 6, 2011 at 12:06 PM, Josh Amishav-Zlatin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamuse at gmail.com</A>&gt;wrote:

&gt;<i> What happens if you use allow instead of pass? Can you see what rules are
</I>&gt;<i> firing in the debug log?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>  - Josh
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sat, Aug 6, 2011 at 12:09 AM, Gil Vidals &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Thanks for the response. There must be something deeper going on here
</I>&gt;&gt;<i> because even after adding the line you suggested, I'm still getting these
</I>&gt;&gt;<i> entries after restarting apache:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --c073772f-B--
</I>&gt;&gt;<i> GET /account/login/?next=/ HTTP/1.0
</I>&gt;&gt;<i> User-Agent: Pingdom.com_bot_version_1.4_(<A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>)
</I>&gt;&gt;<i> Host: blah.com
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Why isn't this rule being applied as I thought. Is it time to turn on mod
</I>&gt;&gt;<i> sec debugging?
</I>&gt;&gt;<i>   SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot;
</I>&gt;&gt;<i> &quot;nolog,noauditlog,pass,ctl:auditEngine=Off&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Gil Vidals / VM Racks
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, Aug 5, 2011 at 1:02 PM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You should use the ctl action in your rule to turn off the audit engine -
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot;
</I>&gt;&gt;&gt;<i> &quot;nolog,noauditlog,pass,ctl:auditEngine=Off&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Due to the fact that the UA data is easily spoofed, I would recommend you
</I>&gt;&gt;&gt;<i> also do a check on the IP range or something so that attackers aren't
</I>&gt;&gt;&gt;<i> evading your logging by putting pingdom in the UA field.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Ryan
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Aug 5, 2011, at 12:42 PM, &quot;Gil Vidals&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;&gt; wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Need help in preventing the log entry from the monitoring system at &lt;
</I>&gt;&gt;&gt;<i> <A HREF="http://pingdom.com">http://pingdom.com</A>&gt; pingdom.com&lt;<A HREF="http://pingdom.com">http://pingdom.com</A>&gt; because there are
</I>&gt;&gt;&gt;<i> thousands of these entries per day. No matter, what I try, I can't prevent
</I>&gt;&gt;&gt;<i> the entry from being logged. I'm using the anomaly scoring.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> in modsecurity_crs_48_local_exceptions.conf:
</I>&gt;&gt;&gt;<i> SecRule REQUEST_HEADERS:User-Agent &quot;pingdom&quot; &quot;nolog,noauditlog,pass&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> And after restarting apache, I still am getting these entries:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --4489f76b-B--
</I>&gt;&gt;&gt;<i> GET /account/login/?next=/ HTTP/1.0
</I>&gt;&gt;&gt;<i> User-Agent: Pingdom.com&lt;<A HREF="http://Pingdom.com">http://Pingdom.com</A>&gt;_bot_version_1.4_(&lt;
</I>&gt;&gt;&gt;<i> <A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>&gt;<A HREF="http://www.pingdom.com/">http://www.pingdom.com/</A>)
</I>&gt;&gt;&gt;<i> Host: &lt;<A HREF="http://blah.com">http://blah.com</A>&gt; blah.com&lt;<A HREF="http://blah.com">http://blah.com</A>&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> What else do you recommend I try?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> Gil Vidals, VCP
</I>&gt;&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&lt;mailto:
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>&gt;
</I>&gt;&gt;&gt;<i> &lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt;www.vmracks.com&lt;<A HREF="http://www.vmracks.com">http://www.vmracks.com</A>&gt; - VMware
</I>&gt;&gt;&gt;<i> Hosting Service Provider
</I>&gt;&gt;&gt;<i> t. 760.705.4022 IM: &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>
</I>&gt;&gt;&gt;<i> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>&gt;
</I>&gt;&gt;&gt;<i> [<A HREF="http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]">http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]</A>
</I>&gt;&gt;&gt;<i> HIPAA Compliant Hosting
</I>&gt;&gt;&gt;<i> VMware Hosting
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> CONFIDENTIALITY NOTICE: The information contained in this transmission
</I>&gt;&gt;&gt;<i> may contain privileged and confidential information.  It is intended only
</I>&gt;&gt;&gt;<i> for the use of the person(s) named above.  If you are not the intended
</I>&gt;&gt;&gt;<i> recipient, please contact the sender by reply email and permanently delete
</I>&gt;&gt;&gt;<i> the original message.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ________________________________
</I>&gt;&gt;&gt;<i> This transmission may contain information that is privileged,
</I>&gt;&gt;&gt;<i> confidential, and/or exempt from disclosure under applicable law. If you are
</I>&gt;&gt;&gt;<i> not the intended recipient, you are hereby notified that any disclosure,
</I>&gt;&gt;&gt;<i> copying, distribution, or use of the information contained herein (including
</I>&gt;&gt;&gt;<i> any reliance thereon) is STRICTLY PROHIBITED. If you received this
</I>&gt;&gt;&gt;<i> transmission in error, please immediately contact the sender and destroy the
</I>&gt;&gt;&gt;<i> material in its entirety, whether in electronic or hard copy format.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Gil Vidals, VCP
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>
</I>&gt;&gt;<i> www.vmracks.com - VMware Hosting Service Provider
</I>&gt;&gt;<i> t. 760.705.4022 IM: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HIPAA Compliant Hosting
</I>&gt;&gt;<i> VMware Hosting
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> CONFIDENTIALITY NOTICE: The information contained in this transmission may
</I>&gt;&gt;<i> contain privileged and confidential information.  It is intended only for
</I>&gt;&gt;<i> the use of the person(s) named above.  If you are not the intended
</I>&gt;&gt;<i> recipient, please contact the sender by reply email and permanently delete
</I>&gt;&gt;<i> the original message.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>

-- 
Gil Vidals, VCP
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gvidals at vmracks.com</A>
www.vmracks.com - VMware Hosting Service Provider
t. 760.705.4022 IM: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gilvidals at hotmail.com</A>

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may
contain privileged and confidential information.  It is intended only for
the use of the person(s) named above.  If you are not the intended
recipient, please contact the sender by reply email and permanently delete
the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110808/e7bdc47c/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110808/e7bdc47c/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000828.html">[Owasp-modsecurity-core-rule-set] Google Analytics cookie __utmz often trigger mod_security
</A></li>
	<LI>Next message: <A HREF="000826.html">[Owasp-modsecurity-core-rule-set] help with preventing entries to audit log
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#825">[ date ]</a>
              <a href="thread.html#825">[ thread ]</a>
              <a href="subject.html#825">[ subject ]</a>
              <a href="author.html#825">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
