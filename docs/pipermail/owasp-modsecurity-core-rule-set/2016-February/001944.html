<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Need%20suggestion%20for%20a%20SQLI%0A%20pattern&In-Reply-To=%3CD2E235CD.19F19%25csanders%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001943.html">
   <LINK REL="Next"  HREF="001953.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Need%20suggestion%20for%20a%20SQLI%0A%20pattern&In-Reply-To=%3CD2E235CD.19F19%25csanders%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern">CSanders at trustwave.com
       </A><BR>
    <I>Thu Feb 11 17:59:59 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="001943.html">[Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern
</A></li>
        <LI>Next message: <A HREF="001953.html">[Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI	pattern
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1944">[ date ]</a>
              <a href="thread.html#1944">[ thread ]</a>
              <a href="subject.html#1944">[ subject ]</a>
              <a href="author.html#1944">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Oh my dear dear friend Richard, never underestimate the inability of developers &#8211; if the language has support for violating good security development considerations &#8211; they will find a way to use that to create a vulnerability. In any event you&#8217;d have to look at the mission statement of libinjection &#8211; it is certainly possible and shouldn&#8217;t be used alone. It does have a very specific mission, for instance it is not designed to take cookies and separate them or request headers etc. That being said I do like libinjection I think it&#8217;s inclusion does add rather than retract from the ModSecurity suite and if you can make it better you are more than encouraged to try. :)

From: Richard Lin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&gt;&gt;
Date: Thursday, February 11, 2016 at 12:50 PM
To: Chaim Sanders &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&gt;&gt;, &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: RE: [Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern

Thanks Chaim and Christian and I agree that it is bad that a user controls a SQL statement.  I think libinjection covered 'Where' and 'Like' clause as you mentioned.

I am trying to judge if libinjection missed a category of attacking model in which the user's input is an independent SQLs which can be invoked by themselves (i.e, without prefix of &quot;1 UNION&quot;, '1 or&quot;, &quot;1 and&quot;, etc)  If that is the case, I would consider to propose a patch. But I am not sure how careless developers can directly take the input as SQL itself. That sounds too naive to be believed :)


________________________________
From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&gt;
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern
Date: Thu, 11 Feb 2016 13:28:40 +0000

Hey Richard, first I&#8217;ll echo what Christian said, but also what you have described is just a LIMITED case of SQL injection. SQL Injection can really deal with any area in which SQL may be introduced by an attacker and it will then be executed later. There is no need to limit this to a where clause. For instance it could be in a like clause, it could be the clause itself, it could be the statement (select for instance) etc. The underlying idea is that anywhere a user can control a SQL statement would be bad. In fairness to libinjection it isn&#8217;t factoring in all these situations it is designed with parameters in mind and SQL injections more a kin to the type you are describing. This is why we leave in complex regex patterns as well that can detect SQL patterns like the one you have described.
Another situation where it would be valuable to detect such statements would be in the case of stacked sql queries. Although not all engines support it, in some you may so things like:

select * from User where id =  [ input] to select * from User where id = 1; select a from uid2

These are good questions and from these often we&#8217;ll discover other facets of the problem or solutions we never thought of so please feel free to keep asking if you have any ideas or questions, or are unclear on something :)


From: Richard Lin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&gt;&gt;
Date: Thursday, February 11, 2016 at 1:06 AM
To: Chaim Sanders &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&gt;&gt;, &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: RE: [Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern

Thanks. Could you explain in more detail?

My understanding for SQL injection case is  that careless web developers take the web request parameters and add them to their &quot;where clause&quot;.

So if the input is  '1 union select a from uid2&quot; that would cause successful injection because the careless developer's SQL was modified from

select * from User where id =  [ input] to select * from User where id = 1 union select a from uid2

In above case, the SQL statement was successfully modified with correct syntax. Thus I can accept this is a successful injection.

But if the input is &quot;select a from uid2&quot;, then careless developers SQL is as:

select * from User where id = select a from uid2

The above SQL statement is not correct in syntax. So this injection will not be successful. Maybe due to this consideration, the libinjection does not consider input of &quot;select a from uid2&quot; is a SQL injection although its SQL pattern is so obvious.

Richard


________________________________
From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&gt;
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern
Date: Thu, 11 Feb 2016 02:51:44 +0000

Hey Richard,
I&#8217;ve seen things CLOSE to this in production. Sites where they&#8217;ve attempted to use prepared statements to secure a location where the variable injected in a table name. Of course prepared statements are designed for this environment and will fail miserably. But this accounts for a situation where all of the following except the word select is true. Granted it&#8217;s unusual.

From: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&gt;&gt; on behalf of Richard Lin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">hongpinglin at hotmail.com</A>&gt;&gt;
Date: Wednesday, February 10, 2016 at 7:31 PM
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: [Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern

Hi folks, I just joined the lists one day ago. And would like to seek the opinions of dealing with a SQLI pattern verdict-ed differently between regex rules and libinjection.

<A HREF="http://test.com?id=select&lt;http://scanmail.trustwave.com/?c=4062&amp;d=9cq81m-50sHLrlIm_iaLgMaFk8OtgRkZLr5vbovmVg&amp;s=5&amp;u=http%3a%2f%2ftest%2ecom%3fid%3dselect">http://test.com?id=select&lt;http://scanmail.trustwave.com/?c=4062&amp;d=9cq81m-50sHLrlIm_iaLgMaFk8OtgRkZLr5vbovmVg&amp;s=5&amp;u=http%3a%2f%2ftest%2ecom%3fid%3dselect</A>&gt; a from table b.

I did not make  SQLI &quot;select a from table b&quot; as URL encoded for easier discussion here.

Basically, libinjection does not consider this string as SQLI although its SQLI pattern is so obvious. Libinjection considers the SQL injections are typically in the context of


            select * from table where id =%input with or without injection%


&gt;<i>From libinjection point of view,  the input of &quot;select a from table b&quot; is unable to join the above statement with correct SQL syntax. But if we just use regex rules, this input is so easy to marked as SQLI. I would like to seek the opinion in this group.  Do you think the request as &quot;<A HREF="http://test.com?id=select">http://test.com?id=select</A> a from table b.&lt;<A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=9cq81m-50sHLrlIm_iaLgMaFk8OtgRkZLu1gaYy7Uw&amp;s=5&amp;u=http%3a%2f%2ftest%2ecom%3fid%3dselect%20a%20from%20table%20b">http://scanmail.trustwave.com/?c=4062&amp;d=9cq81m-50sHLrlIm_iaLgMaFk8OtgRkZLu1gaYy7Uw&amp;s=5&amp;u=http%3a%2f%2ftest%2ecom%3fid%3dselect%20a%20from%20table%20b</A>&gt;&quot; would cause really SQL injection successful in SQL syntax in any site?
</I>
Thanks
Richard

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160211/b914656d/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160211/b914656d/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001943.html">[Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI pattern
</A></li>
	<LI>Next message: <A HREF="001953.html">[Owasp-modsecurity-core-rule-set] Need suggestion for a SQLI	pattern
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1944">[ date ]</a>
              <a href="thread.html#1944">[ thread ]</a>
              <a href="subject.html#1944">[ subject ]</a>
              <a href="author.html#1944">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
