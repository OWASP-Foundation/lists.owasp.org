<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] New Generic Malicious JS	Detection in Outbound Content
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20New%20Generic%20Malicious%20JS%0A%09Detection%20in%20Outbound%20Content&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000743.html">
   <LINK REL="Next"  HREF="000740.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] New Generic Malicious JS	Detection in Outbound Content</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20New%20Generic%20Malicious%20JS%0A%09Detection%20in%20Outbound%20Content&In-Reply-To="
       TITLE="[Owasp-modsecurity-core-rule-set] New Generic Malicious JS	Detection in Outbound Content">RBarnett at trustwave.com
       </A><BR>
    <I>Fri Apr 15 14:40:30 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000743.html">[Owasp-modsecurity-core-rule-set] Current use of TAG data in rules and a new idea - CONFIDENCE_LEVEL
</A></li>
        <LI>Next message: <A HREF="000740.html">[Owasp-modsecurity-core-rule-set] help: Modsecurity 'ARGS' rules	match 'GET' request but can't match 'POST' request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#734">[ date ]</a>
              <a href="thread.html#734">[ thread ]</a>
              <a href="subject.html#734">[ subject ]</a>
              <a href="author.html#734">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I just added the following new signatures to the modsecurity_crs_50_outbound.conf file in SVN - <A HREF="http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_50_outbound.conf">http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_50_outbound.conf</A>

Please either sync from SVN or you can copy/paste them from below if you would like to try them out.

Please report any issues back to the list.

-Ryan

#
# Generic Malicious JS Detection
#
SecRule RESPONSE_BODY &quot;(?i)(String\.fromCharCode\(.*?){4,}&quot; \
                                &quot;t:none,phase:4,rev:'2.2.0',ctl:auditLogParts=+E,block,msg:'Potential Obfuscated Javascript in Output - Excessive fromCharCode',capture,logdata:'%{tx.0}',id:'981004',tag:'MALICIOUS_CODE',tag:'bugtraq,13544',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.outbound_anomaly_score=+%{tx.error_anomaly_score},setvar:tx.anomaly_score=+{tx.error_anomaly_score},setvar:tx.%{rule.id}-MALICIOUS_CODE-%{matched_var_name}=%{tx.0}&quot;

SecRule RESPONSE_BODY &quot;(?i)(eval\(.{0,15}unescape\()&quot; \
                                &quot;t:none,phase:4,rev:'2.2.0',ctl:auditLogParts=+E,block,msg:'Potential Obfuscated Javascript in Output - Eval+Unescape',capture,logdata:'%{tx.0}',id:'981005',tag:'MALICIOUS_CODE',tag:'bugtraq,13544',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.outbound_anomaly_score=+%{tx.error_anomaly_score},setvar:tx.anomaly_score=+{tx.error_anomaly_score},setvar:tx.%{rule.id}-MALICIOUS_CODE-%{matched_var_name}=%{tx.0}&quot;

SecRule RESPONSE_BODY &quot;(?i)(var[^=]+=\s*unescape\s*;)&quot; \
                                &quot;t:none,phase:4,rev:'2.2.0',ctl:auditLogParts=+E,block,msg:'Potential Obfuscated Javascript in Output - Unescape',capture,logdata:'%{tx.0}',id:'981006',tag:'MALICIOUS_CODE',tag:'bugtraq,13544',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.outbound_anomaly_score=+%{tx.error_anomaly_score},setvar:tx.anomaly_score=+{tx.error_anomaly_score},setvar:tx.%{rule.id}-MALICIOUS_CODE-%{matched_var_name}=%{tx.0}&quot;

SecRule RESPONSE_BODY &quot;(?i:%u0c0c%u0c0c|%u9090%u9090|%u4141%u4141)&quot; \
                                &quot;t:none,phase:4,rev:'2.2.0',ctl:auditLogParts=+E,block,msg:'Potential Obfuscated Javascript in Output - Heap Spray',id:'981007',tag:'MALICIOUS_CODE',tag:'bugtraq,13544',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.outbound_anomaly_score=+%{tx.error_anomaly_score},setvar:tx.anomaly_score=+{tx.error_anomaly_score},setvar:tx.%{rule.id}-MALICIOUS_CODE-%{matched_var_name}=%{tx.0}&quot;

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000743.html">[Owasp-modsecurity-core-rule-set] Current use of TAG data in rules and a new idea - CONFIDENCE_LEVEL
</A></li>
	<LI>Next message: <A HREF="000740.html">[Owasp-modsecurity-core-rule-set] help: Modsecurity 'ARGS' rules	match 'GET' request but can't match 'POST' request
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#734">[ date ]</a>
              <a href="thread.html#734">[ thread ]</a>
              <a href="subject.html#734">[ subject ]</a>
              <a href="author.html#734">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
