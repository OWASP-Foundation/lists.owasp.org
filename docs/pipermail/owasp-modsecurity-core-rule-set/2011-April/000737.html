<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Slow%20HTTP%20DOS%20protection%20not%0A%20behaving%20as%20expected&In-Reply-To=BANLkTi%3DND-4Qxb5gdpak3tWuYp7eUFTHTQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000736.html">
   <LINK REL="Next"  HREF="000738.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Slow%20HTTP%20DOS%20protection%20not%0A%20behaving%20as%20expected&In-Reply-To=BANLkTi%3DND-4Qxb5gdpak3tWuYp7eUFTHTQ%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected">RBarnett at trustwave.com
       </A><BR>
    <I>Sat Apr 16 09:44:55 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000736.html">[Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected
</A></li>
        <LI>Next message: <A HREF="000738.html">[Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#737">[ date ]</a>
              <a href="thread.html#737">[ thread ]</a>
              <a href="subject.html#737">[ subject ]</a>
              <a href="author.html#737">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What apache version are you using?

On Apr 16, 2011, at 9:43 AM, &quot;Guillaume Bilodeau&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&gt; wrote:

A little more information on the 200 return code:

It seems that mod_reqtimeout is not closing the connection after the 20 seconds, but rather truncating the request and letting it go through.  So the request is actually processed, and since the URL is referring to an actual resource, a 200 code is returned.

Surely there must be a problem with our configuration?  Or maybe our Apache build?

Cheers,
GB

On Sat, Apr 16, 2011 at 12:55 AM, Brian Rectanus &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">brectanu at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">brectanu at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">brectanu at gmail.com</A>&gt;&gt; wrote:
Probably not &quot;disastrous&quot; :)  You have the overhead of the TCP 3-way
handshake and also the shutdown, but the browsers should be using SSL
session resumption, which is not connection based.  It uses cached SSL
session IDs and should be reused on each connection up to the timeout
- just make sure this is enabled in the Apache config.  Personally, I
find that about 3 second timeouts w/low request limit works well for
keepalives, so it may be enough to just limit the keepalive timeout
and number of requests  (say 3 second timeout w/9 requests limit
instead of completely disabling them).  It really depends on your
latency requirements for your site.

-B

On Thu, Apr 14, 2011 at 2:37 PM, Guillaume Bilodeau
&lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&gt; wrote:
&gt;<i> We will try turning off connection keep-alive to see how Apache will react.
</I>&gt;<i>  However, isn't turning this off going to have a disastrous impact on
</I>&gt;<i> connection performance, especially since all traffic will be SSL?
</I>&gt;<i>
</I>&gt;<i> On Thu, Apr 14, 2011 at 3:19 PM, Ivan Ristic &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ivan.ristic at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ivan.ristic at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ivan.ristic at gmail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, it's probably because of keep-alives. Sounds like a bug in the
</I>&gt;&gt;<i> reqtimeout module, because, if the connection stays open, the module
</I>&gt;&gt;<i> isn't achieving much.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> IIRC, ModSecurity will turn off keep-alives on a connection on which it
</I>&gt;&gt;<i> blocks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Thu, Apr 14, 2011 at 8:11 PM, Guillaume Bilodeau
</I>&gt;&gt;<i> &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&gt; wrote:
</I>&gt;&gt;<i> &gt; Hi Ryan,
</I>&gt;&gt;<i> &gt; We installed WireShark and started sniffing on all traffic.  It seems
</I>&gt;&gt;<i> &gt; that
</I>&gt;&gt;<i> &gt; Apache is returning a 200 status code instead of a 408 when the request
</I>&gt;&gt;<i> &gt; reaches 30 seconds, so from what I understand ModSecurity can't do much
</I>&gt;&gt;<i> &gt; about that.  The funny thing is, if we follow one of the TCP streams, we
</I>&gt;&gt;<i> &gt; see
</I>&gt;&gt;<i> &gt; that http_dos_cli keeps sending data even after receiving the 200 code.
</I>&gt;&gt;<i> &gt;  Maybe something to do with  keep-alive connections?
</I>&gt;&gt;<i> &gt; Cheers,
</I>&gt;&gt;<i> &gt; GB
</I>&gt;&gt;<i> &gt; On Thu, Apr 14, 2011 at 2:12 PM, Ryan Barnett &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;&gt;
</I>&gt;&gt;<i> &gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; OK, if mod_reqtimeout is installed and that directive is working, then
</I>&gt;&gt;<i> &gt;&gt; after 30 sec if Apache has not received the entire request body then it
</I>&gt;&gt;<i> &gt;&gt; should terminate the request with a 408 status code.  The ModSecurity
</I>&gt;&gt;<i> &gt;&gt; CRS
</I>&gt;&gt;<i> &gt;&gt; rules are simply monitoring if/how many 408 alerts are generated by
</I>&gt;&gt;<i> &gt;&gt; Apache
</I>&gt;&gt;<i> &gt;&gt; per client.  After a certain amount, then ModSecurity will step in on
</I>&gt;&gt;<i> &gt;&gt; subsequent requests in phase:1 and do drop actions.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; So, by monitoring your Apache error log while you are running your
</I>&gt;&gt;<i> &gt;&gt; http_dos_cli tool, does Apache generate 408 alerts after 30 secs?  If
</I>&gt;&gt;<i> &gt;&gt; not,
</I>&gt;&gt;<i> &gt;&gt; then I don't think that the mod_reqtimeout module or directive is
</I>&gt;&gt;<i> &gt;&gt; working.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; -Ryan
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; From: Guillaume Bilodeau
</I>&gt;&gt;<i> &gt;&gt; &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Date: Thu, 14 Apr 2011 13:07:41 -0500
</I>&gt;&gt;<i> &gt;&gt; To: Ryan Barnett
</I>&gt;&gt;<i> &gt;&gt; &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Cc:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &quot;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;&quot;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Subject: Re: [Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection
</I>&gt;&gt;<i> &gt;&gt; not behaving as expected
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Hi Ryan,
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; I'm no Apache expert, but AFAICT the req_timeout module is installed.
</I>&gt;&gt;<i> &gt;&gt;  A
</I>&gt;&gt;<i> &gt;&gt; /server-info shows the req_timeout.c module with the RequestReadTimeout
</I>&gt;&gt;<i> &gt;&gt; parameter.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Thanks,
</I>&gt;&gt;<i> &gt;&gt; GB
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; On Thu, Apr 14, 2011 at 1:56 PM, Ryan Barnett
</I>&gt;&gt;<i> &gt;&gt; &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;&gt;&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt; Did you install the reqtimeout module?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; #
</I>&gt;&gt;<i> &gt;&gt; # Mitigate Slow HTTP POST attacks
</I>&gt;&gt;<i> &gt;&gt; #
</I>&gt;&gt;<i> &gt;&gt; # Must have the mod_reqtimeout module installed
</I>&gt;&gt;<i> &gt;&gt; # You should adjust the RequestReadTimeout body directive setting to a
</I>&gt;&gt;<i> &gt;&gt; limit
</I>&gt;&gt;<i> &gt;&gt; # that will allow any legitimate slow clients or large file uplaods.
</I>&gt;&gt;<i> &gt;&gt; #
</I>&gt;&gt;<i> &gt;&gt; &lt;IfModule reqtimeout_module&gt;
</I>&gt;&gt;<i> &gt;&gt; RequestReadTimeout body=30
</I>&gt;&gt;<i> &gt;&gt; &lt;/IfModule&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; -Ryan
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; From: Guillaume Bilodeau
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">guillaume.bilodeau at gmail.com</A>&gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Date: Thu, 14 Apr 2011 12:33:52 -0500
</I>&gt;&gt;<i> &gt;&gt; To:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &quot;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;&gt;&quot;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; &lt;&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&lt;mailto:&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;&gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Subject: [Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not
</I>&gt;&gt;<i> &gt;&gt; behaving as expected
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Hi all,
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; We are trying to setup the OWASP Core Rule Set to protect our
</I>&gt;&gt;<i> &gt;&gt; application
</I>&gt;&gt;<i> &gt;&gt; from Slow HTTP DOS attacks.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; We have setup ModSecurity 2.5.13 on our Apache 2.2.17 instance, loaded
</I>&gt;&gt;<i> &gt;&gt; the
</I>&gt;&gt;<i> &gt;&gt; module, and included all CRS base rules plus
</I>&gt;&gt;<i> &gt;&gt; modsecurity_crs_11_slow_dos_protection.conf.  We didn't change the
</I>&gt;&gt;<i> &gt;&gt; settings
</I>&gt;&gt;<i> &gt;&gt; defined in the conf file, so SecReadStateLimit is set to 5 and
</I>&gt;&gt;<i> &gt;&gt; RequestReadTimeout is set to body=30.  We are using the http_dos_cli
</I>&gt;&gt;<i> &gt;&gt; command
</I>&gt;&gt;<i> &gt;&gt; line tool to do our tests, with the connection parameter set to 500.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; When running the slow-headers test, ModSecurity seems to be protecting
</I>&gt;&gt;<i> &gt;&gt; the
</I>&gt;&gt;<i> &gt;&gt; application correctly, dropping most (all?) requests from the tester's
</I>&gt;&gt;<i> &gt;&gt; IP
</I>&gt;&gt;<i> &gt;&gt; and allowing requests from a different IP to be served.  However, when
</I>&gt;&gt;<i> &gt;&gt; running the slow-post test, ModSecurity doesn't seem to be doing
</I>&gt;&gt;<i> &gt;&gt; anything.
</I>&gt;&gt;<i> &gt;&gt;  From what I understand, the test successfully creates the 500
</I>&gt;&gt;<i> &gt;&gt; connections
</I>&gt;&gt;<i> &gt;&gt; and keeps them open; none of them are dropped.  Requests coming from a
</I>&gt;&gt;<i> &gt;&gt; different IP are not served and eventually time out.  A tail -f
</I>&gt;&gt;<i> &gt;&gt; error_log
</I>&gt;&gt;<i> &gt;&gt; shows nothing except the eventual message on MaxClients (set to 300
</I>&gt;&gt;<i> &gt;&gt; now)
</I>&gt;&gt;<i> &gt;&gt; being reached.  Interestingly, when we kill the http_dos_cli process,
</I>&gt;&gt;<i> &gt;&gt; the
</I>&gt;&gt;<i> &gt;&gt; error_log is then flooded with hundreds of entries such as this:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; [Mon Nov 22 17:44:46 2010] [warn] ModSecurity: Access denied with code
</I>&gt;&gt;<i> &gt;&gt; 400.
</I>&gt;&gt;<i> &gt;&gt; Too many connections [6] of 5 allowed in READ state from 211.144.112.20
</I>&gt;&gt;<i> &gt;&gt; -
</I>&gt;&gt;<i> &gt;&gt; Possible DoS Consumption Attack [Rejected]
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; (this has been taken from the SpiderLabs blog entry, dates and IPs are
</I>&gt;&gt;<i> &gt;&gt; obviously different)
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Any idea on why this isn't behaving like we're expecting it to be?
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Thanks!
</I>&gt;&gt;<i> &gt;&gt; GB
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; _______________________________________________
</I>&gt;&gt;<i> &gt; Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> &gt; &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;&gt;<i> &gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Ivan Risti&#263;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000736.html">[Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected
</A></li>
	<LI>Next message: <A HREF="000738.html">[Owasp-modsecurity-core-rule-set] Slow HTTP DOS protection not behaving as expected
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#737">[ date ]</a>
              <a href="thread.html#737">[ thread ]</a>
              <a href="subject.html#737">[ subject ]</a>
              <a href="author.html#737">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
