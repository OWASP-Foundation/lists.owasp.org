From chaim at chaimsanders.com  Thu Mar  1 00:30:53 2018
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Wed, 28 Feb 2018 19:30:53 -0500
Subject: [Owasp-modsecurity-core-rule-set] Upcoming March Meeting (3/5/2018)
Message-ID: <CAE8hE=ohLCHPYzC+8k3kGKXHRFx4BoJJ045D16=-Q6-ZfnH5iw@mail.gmail.com>

Greetings,
This is a reminder for the OWASP Core Rule Set monthly meeting.  Our
upcoming March meeting will take at 2:30PM (EST GMT-05) on the #modsecurity
channel on the Freenode IRC network. It is open to the public and we'd love
for you to join. If you have anything to add, please feel free to include
it on the agenda (https://github.com/SpiderLabs/owasp-modsecurity-
crs/issues/1026). See you then!

-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180228/c3f1d05b/attachment.html>

From chaim at chaimsanders.com  Mon Mar  5 19:11:23 2018
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Mon, 5 Mar 2018 14:11:23 -0500
Subject: [Owasp-modsecurity-core-rule-set] OWASP CRS Monthly meetup
Message-ID: <CAE8hE=qw3cTVW2R4zVe+mjLspnWXQvkWYQPUKwmS2oHhuz=TqA@mail.gmail.com>

It's that time of the month, in ~20 minutes  (2:30 EST) we'll be having our
monthly project meeting for CRS. Attached is the current agenda
<https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1026>. Everyone
is welcome to join and bring up any concerns or ideas. The meeting is held
on the #modsecurity freenode IRC channel. See you there!



-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180305/36a4c388/attachment.html>

From spartantri at gmail.com  Mon Mar  5 20:09:40 2018
From: spartantri at gmail.com (spartantri at gmail.com)
Date: Mon, 5 Mar 2018 21:09:40 +0100
Subject: [Owasp-modsecurity-core-rule-set] OWASP CRS Monthly meetup
In-Reply-To: <CAE8hE=qw3cTVW2R4zVe+mjLspnWXQvkWYQPUKwmS2oHhuz=TqA@mail.gmail.com>
References: <CAE8hE=qw3cTVW2R4zVe+mjLspnWXQvkWYQPUKwmS2oHhuz=TqA@mail.gmail.com>
Message-ID: <93700A58-7F0B-41E2-A6F0-9F4ED3802DE5@gmail.com>

I?ll join late if I can

Enviado desde mi iPhone

> El 5 mar 2018, a las 20:11, Chaim Sanders <chaim at chaimsanders.com> escribi?:
> 
> It's that time of the month, in ~20 minutes  (2:30 EST) we'll be having our monthly project meeting for CRS. Attached is the current agenda. Everyone is welcome to join and bring up any concerns or ideas. The meeting is held on the #modsecurity freenode IRC channel. See you there!
> 
> 
> 
> -- 
> -- 
> Chaim Sanders
> http://www.ChaimSanders.com
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180305/c5c933af/attachment.html>

From eero.volotinen at iki.fi  Tue Mar 13 12:20:30 2018
From: eero.volotinen at iki.fi (Eero Volotinen)
Date: Tue, 13 Mar 2018 14:20:30 +0200
Subject: [Owasp-modsecurity-core-rule-set] please add f-secure radar to
	scanners-user-agents.data
Message-ID: <CABzZrXfyggsKryn42gXx4vUpo9=V3E5t+c0SBER_-KW0iwNj+A@mail.gmail.com>

Hi,

Please add entry for f-secure radar:

#https://www.f-secure.com/en/web/business_global/radar
User-Agent: Mozilla/4.0 (Mozilla/4.0; MSIE 7.0; Windows NT 5.1; FDM; SV1;
.NET CLR 3.0.04506.30) F-Secure Radar


br,
Eero
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180313/5d4cf44b/attachment.html>

From chaim at chaimsanders.com  Wed Mar 14 05:39:05 2018
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Wed, 14 Mar 2018 01:39:05 -0400
Subject: [Owasp-modsecurity-core-rule-set] Core Rule Set Project March 2018
Message-ID: <CAE8hE=oYET4xCijJire122RUspfkTJ4G6cFdqOA69zM+HGfQCw@mail.gmail.com>

This is the CRS newsletter covering the period from Early February until
today.

We held our monthly community chat. We had quite a few people stop by.

   - csanders
   - lifeforms
   - franbuehler
   - emphazer
   - dune73
   - agi
   - squared
   - fzipi_
   - spartantri

Our agenda from before the chat is available here
<https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1026>. During
the chat we discussed the following:



We added support for ModSecurity-v3/Apache and Modsecurity-v2/Nginx to the CRS
Support ModSecurity Docker Repos
<https://github.com/CRS-support/modsecurity-docker>. These will be used
when testing before a release. Additionally, we will be adding testing with
Nginx+FTW in addition to Apache+FTW.

A blog about the current CI process will be created for next month.

Issue #990 <https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/990>
status
: Only issue was with FTW failing tests, this has since been fixed. This
was merged.

CRS Summit at AppSec EU:  The proposed CRS Summit will be on July 4, 4pm in
London, the closing day of the trainings, the night before the real
conference starts.

Dune73, Tin Zaw, and csanders-git submitted CFPs to AppSec EU.

#1013 FP resolution status: was merged.

#994 File detection: was built against ubuntu with ModSecurity on Apache.
This was causing conflicts. We decided as an organization to switch our CI
testing env to Ubuntu (instead of fedora).

#989 Fix Regression Tests: For some reasons even though tests were fixed,
these still failed, we'll be rebasing and that should fix the issue.

remaining @azhao155 issues represent actual issues with how the rules are
written.

CRS 3.1 release date shooting for May 2018

csanders-git put forth a number of options for increasing project
management capabilities within the project. A further email will be sent
out.

*Announcements:*

   - Posted a blog post from Karl Stoney - Creating an OpenWAF solution
   with Nginx, ElasticSearch and ModSecurity
   - Posted a blog post from Christian Peron - Building a WAF test harness
   - Posted a blog post from Christian Folini - How to tune your WAF
   installation to reduce false positives
   - CRS Summit July 4, 4pm in London @ AppSec EU

*The next community chats will be held on the following dates:*

April 2, 2018 20:30 CET

May 7, 2018 20:30 CET

June 4, 2018 20:30 CET


-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180314/835a0dea/attachment.html>

From christian.folini at netnea.com  Wed Mar 14 21:09:08 2018
From: christian.folini at netnea.com (Christian Folini)
Date: Wed, 14 Mar 2018 22:09:08 +0100
Subject: [Owasp-modsecurity-core-rule-set] please add f-secure radar to
 scanners-user-agents.data
In-Reply-To: <CABzZrXfyggsKryn42gXx4vUpo9=V3E5t+c0SBER_-KW0iwNj+A@mail.gmail.com>
References: <CABzZrXfyggsKryn42gXx4vUpo9=V3E5t+c0SBER_-KW0iwNj+A@mail.gmail.com>
Message-ID: <20180314210908.nmj57sjvszuxqjl5@leander>

Hey Eero,

Thank you for the suggestion. I just made this into a pull request.

https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/1039

Please try it out and confirm detection works as intended.
Ideally on github.

Ahoj,

Christian



On Tue, Mar 13, 2018 at 02:20:30PM +0200, Eero Volotinen wrote:
>    Hi,
>    Please add entry for f-secure radar:
>    #[1]https://www.f-secure.com/en/web/business_global/radar
>    User-Agent: Mozilla/4.0 (Mozilla/4.0; MSIE 7.0; Windows NT 5.1; FDM;
>    SV1; .NET CLR 3.0.04506.30) F-Secure Radar
>    br,
>    Eero
> 
> References
> 
>    1. https://www.f-secure.com/en/web/business_global/radar

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


-- 
https://www.feistyduck.com/training/modsecurity-training-course
https://www.feistyduck.com/books/modsecurity-handbook/
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From eero.volotinen at iki.fi  Wed Mar 14 22:57:49 2018
From: eero.volotinen at iki.fi (Eero Volotinen)
Date: Thu, 15 Mar 2018 00:57:49 +0200
Subject: [Owasp-modsecurity-core-rule-set] please add f-secure radar to
	scanners-user-agents.data
In-Reply-To: <20180314210908.nmj57sjvszuxqjl5@leander>
References: <CABzZrXfyggsKryn42gXx4vUpo9=V3E5t+c0SBER_-KW0iwNj+A@mail.gmail.com>
	<20180314210908.nmj57sjvszuxqjl5@leander>
Message-ID: <CABzZrXfeeQx1UxkMDo+OUjNROqYCG7XvwRtUx7pmRmfU+_wLTQ@mail.gmail.com>

Thanks, I will try to test it on today/tomorrow.

also noticed that useragent can also contain some random id string like '
59e85179-1c46-4f3a-acd1-5c5f6967dc00'
this might be related to scan task id? see grep from my logs:

https://pastebin.com/6wnitcXQ

Eero

On Wed, Mar 14, 2018 at 11:09 PM, Christian Folini <
christian.folini at netnea.com> wrote:

> Hey Eero,
>
> Thank you for the suggestion. I just made this into a pull request.
>
> https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/1039
>
> Please try it out and confirm detection works as intended.
> Ideally on github.
>
> Ahoj,
>
> Christian
>
>
>
> On Tue, Mar 13, 2018 at 02:20:30PM +0200, Eero Volotinen wrote:
> >    Hi,
> >    Please add entry for f-secure radar:
> >    #[1]https://www.f-secure.com/en/web/business_global/radar
> >    User-Agent: Mozilla/4.0 (Mozilla/4.0; MSIE 7.0; Windows NT 5.1; FDM;
> >    SV1; .NET CLR 3.0.04506.30) F-Secure Radar
> >    br,
> >    Eero
> >
> > References
> >
> >    1. https://www.f-secure.com/en/web/business_global/radar
>
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
> --
> https://www.feistyduck.com/training/modsecurity-training-course
> https://www.feistyduck.com/books/modsecurity-handbook/
> mailto:christian.folini at netnea.com
> twitter: @ChrFolini
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180315/27b5a446/attachment.html>

From chaim at chaimsanders.com  Wed Mar 14 23:11:47 2018
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Wed, 14 Mar 2018 19:11:47 -0400
Subject: [Owasp-modsecurity-core-rule-set] please add f-secure radar to
	scanners-user-agents.data
In-Reply-To: <CABzZrXfeeQx1UxkMDo+OUjNROqYCG7XvwRtUx7pmRmfU+_wLTQ@mail.gmail.com>
References: <CABzZrXfyggsKryn42gXx4vUpo9=V3E5t+c0SBER_-KW0iwNj+A@mail.gmail.com>
	<20180314210908.nmj57sjvszuxqjl5@leander>
	<CABzZrXfeeQx1UxkMDo+OUjNROqYCG7XvwRtUx7pmRmfU+_wLTQ@mail.gmail.com>
Message-ID: <CAE8hE=pHW_6FamMc+D_kGMS7sGts71W6xOfLFOhh8YQ0WprhYQ@mail.gmail.com>

Hey Eero,
I merged the PR earlier today, it is in the v3.1/dev branch if you want to
try it. Christian generalized the rule so it just looks for 'F-Secure
Radar' within the user agent, none of the random UID's should cause false
negatives. Best of luck!

On Wed, Mar 14, 2018 at 6:57 PM, Eero Volotinen <eero.volotinen at iki.fi>
wrote:

> Thanks, I will try to test it on today/tomorrow.
>
> also noticed that useragent can also contain some random id string like '
> 59e85179-1c46-4f3a-acd1-5c5f6967dc00'
> this might be related to scan task id? see grep from my logs:
>
> https://pastebin.com/6wnitcXQ
>
> Eero
>
> On Wed, Mar 14, 2018 at 11:09 PM, Christian Folini <
> christian.folini at netnea.com> wrote:
>
>> Hey Eero,
>>
>> Thank you for the suggestion. I just made this into a pull request.
>>
>> https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/1039
>>
>> Please try it out and confirm detection works as intended.
>> Ideally on github.
>>
>> Ahoj,
>>
>> Christian
>>
>>
>>
>> On Tue, Mar 13, 2018 at 02:20:30PM +0200, Eero Volotinen wrote:
>> >    Hi,
>> >    Please add entry for f-secure radar:
>> >    #[1]https://www.f-secure.com/en/web/business_global/radar
>> >    User-Agent: Mozilla/4.0 (Mozilla/4.0; MSIE 7.0; Windows NT 5.1; FDM;
>> >    SV1; .NET CLR 3.0.04506.30) F-Secure Radar
>> >    br,
>> >    Eero
>> >
>> > References
>> >
>> >    1. https://www.f-secure.com/en/web/business_global/radar
>>
>> > _______________________________________________
>> > Owasp-modsecurity-core-rule-set mailing list
>> > Owasp-modsecurity-core-rule-set at lists.owasp.org
>> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-
>> core-rule-set
>>
>>
>> --
>> https://www.feistyduck.com/training/modsecurity-training-course
>> https://www.feistyduck.com/books/modsecurity-handbook/
>> mailto:christian.folini at netnea.com
>> twitter: @ChrFolini
>>
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>


-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180314/7d59761d/attachment.html>

From christian.folini at netnea.com  Tue Mar 20 06:57:08 2018
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 20 Mar 2018 07:57:08 +0100
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity Core Rule Set
 Community Summit: July 4, 2018, in London
Message-ID: <20180320065708.jbr25rc4jzuirvv2@leander>

Hi there,

Please save the date of our first Community Summit: July 4, 2018, at 4pm
in London.

https://coreruleset.org/20180320/save-the-date-crs-community-summit-on-july-4-2018/

This is meant to be a get-together of the community. We want to learn about
you and how you use CRS in your setups - and we want to talk with you about
the road map for the project and various feature requests.

The date is the night before AppSecEU. So you can join this get-together on
Wednesday and then attend AppSec EU on Thursday / Friday.

Please do consider to join us when Chaim, Walter and I meet for the first
time face2face. :)

Best,

Christian


-- 
https://www.feistyduck.com/training/modsecurity-training-course
https://www.feistyduck.com/books/modsecurity-handbook/
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From Hiranmayi.Palanki at aexp.com  Tue Mar 20 14:19:50 2018
From: Hiranmayi.Palanki at aexp.com (Hiranmayi Palanki)
Date: Tue, 20 Mar 2018 14:19:50 +0000
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity Core Rule
 Set Community Summit: July 4, 2018, in London
In-Reply-To: <20180320065708.jbr25rc4jzuirvv2@leander>
References: <20180320065708.jbr25rc4jzuirvv2@leander>
Message-ID: <ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>

Hello Christian and team,

Having recently tried out ModSecurity, it appears that lower paranoia levels (Basic, PL1, PL2, PL3) are not fully blocking all flavors of XSS and SQL injection.

Encoded XSS attacks are bypassing the CRS rules. Example below:
http://localhost:8082/xss2?uid=%3Balert%281%29%3B

Similarly for SQLi, the below pattern is getting through.

http://localhost:8082/sqli2?uid=3-2

When the Paranoia Level is set to PL4, the encoded XSS attack is blocked, however it crashes the application. With PL4, SQLi attack reported by the vulnerability scanner above, is still not blocked.

Is it possible to selectively add custom rules (for encoded XSS attacks) to the basic level or other lower levels that do not adversely impact the application?

Thanks.

From: owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org] On Behalf Of Christian Folini
Sent: Tuesday, March 20, 2018 2:57 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org; mod-security-users at lists.sourceforge.net
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London

Hi there,

Please save the date of our first Community Summit: July 4, 2018, at 4pm
in London.

https://coreruleset.org/20180320/save-the-date-crs-community-summit-on-july-4-2018/<https://isolate.menlosecurity.com/1/3735928037/https:/coreruleset.org/20180320/save-the-date-crs-community-summit-on-july-4-2018/>

This is meant to be a get-together of the community. We want to learn about
you and how you use CRS in your setups - and we want to talk with you about
the road map for the project and various feature requests.

The date is the night before AppSecEU. So you can join this get-together on
Wednesday and then attend AppSec EU on Thursday / Friday.

Please do consider to join us when Chaim, Walter and I meet for the first
time face2face. :)

Best,

Christian


--
https://www.feistyduck.com/training/modsecurity-training-course<https://isolate.menlosecurity.com/1/3735928037/https:/www.feistyduck.com/training/modsecurity-training-course>
https://www.feistyduck.com/books/modsecurity-handbook/<https://isolate.menlosecurity.com/1/3735928037/https:/www.feistyduck.com/books/modsecurity-handbook/>
mailto:christian.folini at netnea.com<mailto:christian.folini at netnea.com>
twitter: @ChrFolini
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<https://isolate.menlosecurity.com/1/3735928037/https:/lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>


American Express made the following annotations
******************************************************************************
"This message and any attachments are solely for the intended recipient and may contain confidential or privileged information. If you are not the intended recipient, any disclosure, copying, use, or distribution of the information included in this message and any attachments is prohibited. If you have received this communication in error, please notify us by reply e-mail and immediately and permanently delete this message and any attachments. Thank you."

American Express a ajout? le commentaire suivant le Ce courrier et toute pi?ce jointe qu'il contient sont r?serv?s au seul destinataire indiqu? et peuvent renfermer des 
renseignements confidentiels et privil?gi?s. Si vous n'?tes pas le destinataire pr?vu, toute divulgation, duplication, utilisation ou distribution du courrier ou de toute pi?ce jointe est interdite. Si vous avez re?u cette communication par erreur, veuillez nous en aviser par courrier et d?truire imm?diatement le courrier et les pi?ces jointes. Merci.

******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180320/156387c4/attachment.html>

From eero.volotinen at iki.fi  Wed Mar 21 10:11:15 2018
From: eero.volotinen at iki.fi (Eero Volotinen)
Date: Wed, 21 Mar 2018 12:11:15 +0200
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] crs
	ruleset and trace method?
In-Reply-To: <20180321095314.otsc2rxroqkhjz2o@leander>
References: <CABzZrXdq4PPUcGY_Z3aQDziVHw2VS2T5o0=O00ju-d=tuRfbWQ@mail.gmail.com>
	<20180321095314.otsc2rxroqkhjz2o@leander>
Message-ID: <CABzZrXfUMCR50YV01p_kHWp3azVnGs5FBWizdS76zNrLogBFZg@mail.gmail.com>

Not enought familiar with modsecurity.

Just wondering, that there is no any rule to block trace in crs. is there
easy way to implement that?

--
Eero

On Wed, Mar 21, 2018 at 11:53 AM, Christian Folini <
christian.folini at netnea.com> wrote:

> Hey Eero,
>
> The TRACE method is somewhat special. At least in Apache. The request
> skips phase 2 and thus the CRS rule covering tx.allowed_methods.
>
> There are discussions to move this block of rules to phase 1 though.
> https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1015
>
> You may want to chime in there.
>
> Ahoj,
>
> Christian
>
> On Wed, Mar 21, 2018 at 09:15:52AM +0200, Eero Volotinen wrote:
> > Hi,
> >
> > Just noticed that crs ruleset is not blocking trace method, even
> > setvar:'tx.allowed_methods=GET POST'"
> >
> > Is this a bug?
> >
> > Eero
>
> > ------------------------------------------------------------
> ------------------
> > Check out the vibrant tech community on one of the world's most
> > engaging tech sites, Slashdot.org! http://sdm.link/slashdot
>
> > _______________________________________________
> > mod-security-users mailing list
> > mod-security-users at lists.sourceforge.net
> > https://lists.sourceforge.net/lists/listinfo/mod-security-users
> > Commercial ModSecurity Rules and Support from Trustwave's SpiderLabs:
> > http://www.modsecurity.org/projects/commercial/rules/
> > http://www.modsecurity.org/projects/commercial/support/
>
>
> --
> https://www.feistyduck.com/training/modsecurity-training-course
> https://www.feistyduck.com/books/modsecurity-handbook/
> mailto:christian.folini at netnea.com
> twitter: @ChrFolini
>
> ------------------------------------------------------------
> ------------------
> Check out the vibrant tech community on one of the world's most
> engaging tech sites, Slashdot.org! http://sdm.link/slashdot
> _______________________________________________
> mod-security-users mailing list
> mod-security-users at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
> Commercial ModSecurity Rules and Support from Trustwave's SpiderLabs:
> http://www.modsecurity.org/projects/commercial/rules/
> http://www.modsecurity.org/projects/commercial/support/
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180321/73133166/attachment-0001.html>

From christian.folini at netnea.com  Wed Mar 21 10:25:10 2018
From: christian.folini at netnea.com (Christian Folini)
Date: Wed, 21 Mar 2018 11:25:10 +0100
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] crs
	ruleset and trace method?
In-Reply-To: <CABzZrXfUMCR50YV01p_kHWp3azVnGs5FBWizdS76zNrLogBFZg@mail.gmail.com>
References: <CABzZrXdq4PPUcGY_Z3aQDziVHw2VS2T5o0=O00ju-d=tuRfbWQ@mail.gmail.com>
	<20180321095314.otsc2rxroqkhjz2o@leander>
	<CABzZrXfUMCR50YV01p_kHWp3azVnGs5FBWizdS76zNrLogBFZg@mail.gmail.com>
Message-ID: <20180321102510.eimdznkgaocvmztt@leander>

Hello Eero,

On Wed, Mar 21, 2018 at 12:11:15PM +0200, Eero Volotinen wrote:
> Just wondering, that there is no any rule to block trace in crs. is there
> easy way to implement that?

You can blog TRACE in 3 ways in Apache:
- TraceEnable Off (-> This is the default in 2.4)
- mod_allowmethods (never did this with TRACE. Maybe it has special treatment.
  better check.)
- Write ModSec Rule in phase 1 (Take existing CRS rule as a base or look
  at ModSec integration tutorial at netnea.com and take the method check
  in the whitelisting example)

Cheers,

Christian


> 
> --
> Eero
> 
> On Wed, Mar 21, 2018 at 11:53 AM, Christian Folini <
> christian.folini at netnea.com> wrote:
> 
> > Hey Eero,
> >
> > The TRACE method is somewhat special. At least in Apache. The request
> > skips phase 2 and thus the CRS rule covering tx.allowed_methods.
> >
> > There are discussions to move this block of rules to phase 1 though.
> > https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/1015
> >
> > You may want to chime in there.
> >
> > Ahoj,
> >
> > Christian
> >
> > On Wed, Mar 21, 2018 at 09:15:52AM +0200, Eero Volotinen wrote:
> > > Hi,
> > >
> > > Just noticed that crs ruleset is not blocking trace method, even
> > > setvar:'tx.allowed_methods=GET POST'"
> > >
> > > Is this a bug?
> > >
> > > Eero
> >
> > > ------------------------------------------------------------
> > ------------------
> > > Check out the vibrant tech community on one of the world's most
> > > engaging tech sites, Slashdot.org! http://sdm.link/slashdot
> >
> > > _______________________________________________
> > > mod-security-users mailing list
> > > mod-security-users at lists.sourceforge.net
> > > https://lists.sourceforge.net/lists/listinfo/mod-security-users
> > > Commercial ModSecurity Rules and Support from Trustwave's SpiderLabs:
> > > http://www.modsecurity.org/projects/commercial/rules/
> > > http://www.modsecurity.org/projects/commercial/support/
> >
> >
> > --
> > https://www.feistyduck.com/training/modsecurity-training-course
> > https://www.feistyduck.com/books/modsecurity-handbook/
> > mailto:christian.folini at netnea.com
> > twitter: @ChrFolini
> >
> > ------------------------------------------------------------
> > ------------------
> > Check out the vibrant tech community on one of the world's most
> > engaging tech sites, Slashdot.org! http://sdm.link/slashdot
> > _______________________________________________
> > mod-security-users mailing list
> > mod-security-users at lists.sourceforge.net
> > https://lists.sourceforge.net/lists/listinfo/mod-security-users
> > Commercial ModSecurity Rules and Support from Trustwave's SpiderLabs:
> > http://www.modsecurity.org/projects/commercial/rules/
> > http://www.modsecurity.org/projects/commercial/support/
> >

> ------------------------------------------------------------------------------
> Check out the vibrant tech community on one of the world's most
> engaging tech sites, Slashdot.org! http://sdm.link/slashdot

> _______________________________________________
> mod-security-users mailing list
> mod-security-users at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
> Commercial ModSecurity Rules and Support from Trustwave's SpiderLabs:
> http://www.modsecurity.org/projects/commercial/rules/
> http://www.modsecurity.org/projects/commercial/support/


-- 
https://www.feistyduck.com/training/modsecurity-training-course
https://www.feistyduck.com/books/modsecurity-handbook/
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From Hiranmayi.Palanki at aexp.com  Wed Mar 21 14:25:32 2018
From: Hiranmayi.Palanki at aexp.com (Hiranmayi Palanki)
Date: Wed, 21 Mar 2018 14:25:32 +0000
Subject: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP
 ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
In-Reply-To: <20180320195151.gvjcavot32jx7bhj@leander>
References: <20180320065708.jbr25rc4jzuirvv2@leander>
	<ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180320195151.gvjcavot32jx7bhj@leander>
Message-ID: <5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>

Thanks Christian.

What is the recommended Paranoia Level for an enterprise Internet facing application, that does not break the application functionality?

Let?s say if I have the default configuration enabled, and the encoded XSS attacks are getting through, what is the best way to block the encoded XSS attacks without enabling the higher Paranoia Levels?



From: Christian Folini [mailto:christian.folini at netnea.com]
Sent: Tuesday, March 20, 2018 3:52 PM
To: Hiranmayi Palanki <Hiranmayi.Palanki at aexp.com>
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)

Hello Hiranmayi,

On Tue, Mar 20, 2018 at 02:19:50PM +0000, Hiranmayi Palanki wrote:
> Having recently tried out ModSecurity, it appears that lower paranoia levels (Basic, PL1, PL2, PL3) are not fully blocking all flavors of XSS and SQL injection.
>
> Encoded XSS attacks are bypassing the CRS rules. Example below:
> http://localhost:8082/xss2?uid=%3Balert%281%29%3B

This results in a 3 rule alerts in CRS 3.0.2 for me:
942110 PL2 SQL Injection Attack: Common Injection Testing Detected
920273 PL4 Invalid character in request (outside of very strict set)
942432 PL4 Restricted SQL Character Anomaly Detection (args): # of special characters exceeded (2)

> Similarly for SQLi, the below pattern is getting through.
>
> http://localhost:8082/sqli2?uid=3-2

What's wrong with this parameter. "3-2" is by no means an SQL Injection. The
very fact that a security scanner is launching a request does not make it an
attack.

> When the Paranoia Level is set to PL4, the encoded XSS attack is blocked,
> however it crashes the application.

I am not sure what you mean by "crashes the application". You are probably
meaning to say that the application is no longer working properly with PL4.
That is expected behaviour at this high paranoia level. What you are facing
are false positives, that you need to tune away.

There is a tutorial dedicated to this work over at https://www.netnea.com<https://isolate.menlosecurity.com/1/3735928037/https:/www.netnea.com>

> Is it possible to selectively add custom rules (for encoded XSS attacks) to
> the basic level or other lower levels that do not adversely impact the
> application?

One of the criterias for putting rules in the higher paranoia levels is
there tendency to cause false positives. If they were less likely to have this
effect, we would shift them to a lower PL.

With that being said: No, you can not easily move rules around even if the
false positives were a non-issue.

Ahoj,

Christian

P.S. You responded to a message about the CRS summit and quoted that subject
line. Yet your message has a completely different topic. Please start a new
message when you want to start a new subject.


--
There are two primary choices in life: (1) To accept conditions as they
exist, or (2) accept responsibility for changing them.
-- Denis Waitley


American Express made the following annotations
******************************************************************************
"This message and any attachments are solely for the intended recipient and may contain confidential or privileged information. If you are not the intended recipient, any disclosure, copying, use, or distribution of the information included in this message and any attachments is prohibited. If you have received this communication in error, please notify us by reply e-mail and immediately and permanently delete this message and any attachments. Thank you."

American Express a ajout? le commentaire suivant le Ce courrier et toute pi?ce jointe qu'il contient sont r?serv?s au seul destinataire indiqu? et peuvent renfermer des 
renseignements confidentiels et privil?gi?s. Si vous n'?tes pas le destinataire pr?vu, toute divulgation, duplication, utilisation ou distribution du courrier ou de toute pi?ce jointe est interdite. Si vous avez re?u cette communication par erreur, veuillez nous en aviser par courrier et d?truire imm?diatement le courrier et les pi?ces jointes. Merci.

******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180321/7030d377/attachment.html>

From christian.folini at netnea.com  Wed Mar 21 19:20:10 2018
From: christian.folini at netnea.com (Christian Folini)
Date: Wed, 21 Mar 2018 20:20:10 +0100
Subject: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP
 ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
In-Reply-To: <5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>
References: <20180320065708.jbr25rc4jzuirvv2@leander>
	<ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180320195151.gvjcavot32jx7bhj@leander>
	<5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>
Message-ID: <20180321192010.zyouu67khyunpqgb@leander>

Hey Hiranmayi,

On Wed, Mar 21, 2018 at 02:25:32PM +0000, Hiranmayi Palanki wrote:
> What is the recommended Paranoia Level for an enterprise Internet facing
> application, that does not break the application functionality?

I'd say you should put it at least on level 2. This will bring some false
positives and you deal with those as described in the documentation.

> Let?s say if I have the default configuration enabled, and the encoded XSS
> attacks are getting through, what is the best way to block the encoded XSS
> attacks without enabling the higher Paranoia Levels?

If you do not want to use CRS rules, you need to write your own XSS rules
that do a better job than CRS. There are very good XSS documents around,
many of them several pages long with lots of example payloads. You need to
cover all these without breaking your application.

Most people find it easier to use CRS and deal with the false positives.

Ahoj,

Christian

-- 
I have always observed that to succeed in the world one should appear
like a fool but be wise.
-- Charles de Montesquieu

From spartantri at gmail.com  Thu Mar 22 17:30:47 2018
From: spartantri at gmail.com (Manuel Spartan)
Date: Thu, 22 Mar 2018 18:30:47 +0100
Subject: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP
 ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
In-Reply-To: <20180321192010.zyouu67khyunpqgb@leander>
References: <20180320065708.jbr25rc4jzuirvv2@leander>
	<ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180320195151.gvjcavot32jx7bhj@leander>
	<5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180321192010.zyouu67khyunpqgb@leander>
Message-ID: <CAN6xG9t0YdGVJxUsTku_=wUrYYprD4ZkFLq6gNcTVdHisrZVFQ@mail.gmail.com>

 Hi Hiranmayi,

Do you think in implementing input validation at all in your app?

>* Encoded XSS attacks (stopped at PL2 as Christian said)
*>* http://localhost:8082/xss2?uid=%3Balert%281%29%3B
<http://localhost:8082/xss2?uid=%3Balert%281%29%3B>
*
>* SQLi
*>* http://localhost:8082/sqli2?uid=3-2 <http://localhost:8082/sqli2?uid=3-2>*

If the response display the same as uid=1 you have a nice injection as the
back-end engine is evaluating the operation, however sending long
complicated payloads will be difficult in Paranoia Level 2 due to
libinjection inspections on ARGS and very hard in PL 4 as all non
alphanumeric characters will cause a blocked request but that will be
extremely annoying to implement if you use non-alphanumeric characters.

Why don't you simply make positive validation rules additional to CRS in
paranoia level 2? That will be easier, faster and more effective if your
app is not so complex but requires tailor made configurations and
application knowledge while the CRS is generic and do not require much
application knowledge.

i.e. This rule will accept only numeric values on the uid parameter on GET
requests, with this you will get rid of both issues with the least effort,
this is the kick... positive security power in action :)
SecRule ARGS:uid "!@rx [0-9]+" "id:1,phase:1,deny,log,msg:'Bad value
received'"

Notice that the phase:1 is only for GET parameters and cannot be placed
inside Apache locations or it may be silently ignored but is faster as most
CRS rules are in phase:2 it will execute earlier and save you the execution
of many rules.

You may find very useful to learn the basics on ModSecurity rule writing,
other than the netnea tutorial to deal with False Positives shared by
Christian:
Web Application Defender's Cookbook: Battling Hackers and Protecting Users
(RBarnett) for quick receipes
ModSecurity Handbook (CFolini, IRistic) for general knowledge
https://coreruleset.org/category/blog/ (CRS blog)
https://spartantri.com/ModSecurity/ (My blog, read the whitepaper on white
listing)

Have fun!



2018-03-21 20:20 GMT+01:00 Christian Folini <christian.folini at netnea.com>:

> Hey Hiranmayi,
>
> On Wed, Mar 21, 2018 at 02:25:32PM +0000, Hiranmayi Palanki wrote:
> > What is the recommended Paranoia Level for an enterprise Internet facing
> > application, that does not break the application functionality?
>
> I'd say you should put it at least on level 2. This will bring some false
> positives and you deal with those as described in the documentation.
>
> > Let?s say if I have the default configuration enabled, and the encoded
> XSS
> > attacks are getting through, what is the best way to block the encoded
> XSS
> > attacks without enabling the higher Paranoia Levels?
>
> If you do not want to use CRS rules, you need to write your own XSS rules
> that do a better job than CRS. There are very good XSS documents around,
> many of them several pages long with lots of example payloads. You need to
> cover all these without breaking your application.
>
> Most people find it easier to use CRS and deal with the false positives.
>
> Ahoj,
>
> Christian
>
> --
> I have always observed that to succeed in the world one should appear
> like a fool but be wise.
> -- Charles de Montesquieu
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180322/597dbc28/attachment.html>

From Hiranmayi.Palanki at aexp.com  Thu Mar 22 17:40:14 2018
From: Hiranmayi.Palanki at aexp.com (Hiranmayi Palanki)
Date: Thu, 22 Mar 2018 17:40:14 +0000
Subject: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP
 ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
In-Reply-To: <CAN6xG9t0YdGVJxUsTku_=wUrYYprD4ZkFLq6gNcTVdHisrZVFQ@mail.gmail.com>
References: <20180320065708.jbr25rc4jzuirvv2@leander>
	<ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180320195151.gvjcavot32jx7bhj@leander>
	<5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180321192010.zyouu67khyunpqgb@leander>
	<CAN6xG9t0YdGVJxUsTku_=wUrYYprD4ZkFLq6gNcTVdHisrZVFQ@mail.gmail.com>
Message-ID: <35d55b354da3439e94284d04a1f25b8a@BL2PR9302MB0003.024d.mgd.msft.net>

Thanks Manuel and Christian for your responses.

The application will have a thin layer of business rule whitelist regex based input validation ? therefore the issue with XSS noted below may not be that much of a problem. For SQLinjection, it?s hard to guarantee that developers will always use parameterized queries consistently throughout the SDLC. In my opinion, encoded XSS attacks should be tackled at the lower paranoia levels.

I?d have to familiarize myself with the process of creating custom rules.

Is there a plan to enforce Content Security Policy Directives and other HTTP security response headers (e.g. X-Frame-Options/Frame-Ancestors). In some of the testing that I did, it is evident that these security headers are not being injected.



From: owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org] On Behalf Of Manuel Spartan
Sent: Thursday, March 22, 2018 1:31 PM
To: Christian Folini <christian.folini at netnea.com>
Cc: OWASP CRS <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)

Hi Hiranmayi,

Do you think in implementing input validation at all in your app?

> Encoded XSS attacks (stopped at PL2 as Christian said)

> http://localhost:8082/xss2?uid=%3Balert%281%29%3B



> SQLi

> http://localhost:8082/sqli2?uid=3-2
If the response display the same as uid=1 you have a nice injection as the back-end engine is evaluating the operation, however sending long complicated payloads will be difficult in Paranoia Level 2 due to libinjection inspections on ARGS and very hard in PL 4 as all non alphanumeric characters will cause a blocked request but that will be extremely annoying to implement if you use non-alphanumeric characters.

Why don't you simply make positive validation rules additional to CRS in paranoia level 2? That will be easier, faster and more effective if your app is not so complex but requires tailor made configurations and application knowledge while the CRS is generic and do not require much application knowledge.

i.e. This rule will accept only numeric values on the uid parameter on GET requests, with this you will get rid of both issues with the least effort, this is the kick... positive security power in action :)
SecRule ARGS:uid "!@rx [0-9]+" "id:1,phase:1,deny,log,msg:'Bad value received'"

Notice that the phase:1 is only for GET parameters and cannot be placed inside Apache locations or it may be silently ignored but is faster as most CRS rules are in phase:2 it will execute earlier and save you the execution of many rules.

You may find very useful to learn the basics on ModSecurity rule writing, other than the netnea tutorial to deal with False Positives shared by Christian:
Web Application Defender's Cookbook: Battling Hackers and Protecting Users (RBarnett) for quick receipes
ModSecurity Handbook (CFolini, IRistic) for general knowledge
https://coreruleset.org/category/blog/<https://isolate.menlosecurity.com/1/3735928037/https:/coreruleset.org/category/blog/> (CRS blog)
https://spartantri.com/ModSecurity/<https://isolate.menlosecurity.com/1/3735928037/https:/spartantri.com/ModSecurity/> (My blog, read the whitepaper on white listing)

Have fun!


2018-03-21 20:20 GMT+01:00 Christian Folini <christian.folini at netnea.com<mailto:christian.folini at netnea.com>>:
Hey Hiranmayi,

On Wed, Mar 21, 2018 at 02:25:32PM +0000, Hiranmayi Palanki wrote:
> What is the recommended Paranoia Level for an enterprise Internet facing
> application, that does not break the application functionality?

I'd say you should put it at least on level 2. This will bring some false
positives and you deal with those as described in the documentation.

> Let?s say if I have the default configuration enabled, and the encoded XSS
> attacks are getting through, what is the best way to block the encoded XSS
> attacks without enabling the higher Paranoia Levels?

If you do not want to use CRS rules, you need to write your own XSS rules
that do a better job than CRS. There are very good XSS documents around,
many of them several pages long with lots of example payloads. You need to
cover all these without breaking your application.

Most people find it easier to use CRS and deal with the false positives.

Ahoj,

Christian

--
I have always observed that to succeed in the world one should appear
like a fool but be wise.
-- Charles de Montesquieu
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<https://isolate.menlosecurity.com/1/3735928037/https:/lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>



American Express made the following annotations
******************************************************************************
"This message and any attachments are solely for the intended recipient and may contain confidential or privileged information. If you are not the intended recipient, any disclosure, copying, use, or distribution of the information included in this message and any attachments is prohibited. If you have received this communication in error, please notify us by reply e-mail and immediately and permanently delete this message and any attachments. Thank you."

American Express a ajout? le commentaire suivant le Ce courrier et toute pi?ce jointe qu'il contient sont r?serv?s au seul destinataire indiqu? et peuvent renfermer des 
renseignements confidentiels et privil?gi?s. Si vous n'?tes pas le destinataire pr?vu, toute divulgation, duplication, utilisation ou distribution du courrier ou de toute pi?ce jointe est interdite. Si vous avez re?u cette communication par erreur, veuillez nous en aviser par courrier et d?truire imm?diatement le courrier et les pi?ces jointes. Merci.

******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180322/5328895c/attachment-0001.html>

From Hiranmayi.Palanki at aexp.com  Thu Mar 22 17:46:55 2018
From: Hiranmayi.Palanki at aexp.com (Hiranmayi Palanki)
Date: Thu, 22 Mar 2018 17:46:55 +0000
Subject: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP
 ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
References: <20180320065708.jbr25rc4jzuirvv2@leander>
	<ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180320195151.gvjcavot32jx7bhj@leander>
	<5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180321192010.zyouu67khyunpqgb@leander>
	<CAN6xG9t0YdGVJxUsTku_=wUrYYprD4ZkFLq6gNcTVdHisrZVFQ@mail.gmail.com> 
Message-ID: <eb80e8d3418a4aa69574fde20dc875dc@BL2PR9302MB0003.024d.mgd.msft.net>

I?ll try the custom rule you provided.

Also, is there generally any guidance available on the performance measurement metrics for each paranoia level.

From: Hiranmayi Palanki
Sent: Thursday, March 22, 2018 1:40 PM
To: 'Manuel Spartan' <spartantri at gmail.com>; 'Christian Folini' <christian.folini at netnea.com>
Cc: 'OWASP CRS' <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: RE: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)

Thanks Manuel and Christian for your responses.

The application will have a thin layer of business rule whitelist regex based input validation ? therefore the issue with XSS noted below may not be that much of a problem. For SQLinjection, it?s hard to guarantee that developers will always use parameterized queries consistently throughout the SDLC. In my opinion, encoded XSS attacks should be tackled at the lower paranoia levels.

I?d have to familiarize myself with the process of creating custom rules.

Is there a plan to enforce Content Security Policy Directives and other HTTP security response headers (e.g. X-Frame-Options/Frame-Ancestors). In some of the testing that I did, it is evident that these security headers are not being injected.



From: owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org> [mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org] On Behalf Of Manuel Spartan
Sent: Thursday, March 22, 2018 1:31 PM
To: Christian Folini <christian.folini at netnea.com<mailto:christian.folini at netnea.com>>
Cc: OWASP CRS <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)

Hi Hiranmayi,

Do you think in implementing input validation at all in your app?

> Encoded XSS attacks (stopped at PL2 as Christian said)

> http://localhost:8082/xss2?uid=%3Balert%281%29%3B



> SQLi

> http://localhost:8082/sqli2?uid=3-2
If the response display the same as uid=1 you have a nice injection as the back-end engine is evaluating the operation, however sending long complicated payloads will be difficult in Paranoia Level 2 due to libinjection inspections on ARGS and very hard in PL 4 as all non alphanumeric characters will cause a blocked request but that will be extremely annoying to implement if you use non-alphanumeric characters.

Why don't you simply make positive validation rules additional to CRS in paranoia level 2? That will be easier, faster and more effective if your app is not so complex but requires tailor made configurations and application knowledge while the CRS is generic and do not require much application knowledge.

i.e. This rule will accept only numeric values on the uid parameter on GET requests, with this you will get rid of both issues with the least effort, this is the kick... positive security power in action :)
SecRule ARGS:uid "!@rx [0-9]+" "id:1,phase:1,deny,log,msg:'Bad value received'"

Notice that the phase:1 is only for GET parameters and cannot be placed inside Apache locations or it may be silently ignored but is faster as most CRS rules are in phase:2 it will execute earlier and save you the execution of many rules.

You may find very useful to learn the basics on ModSecurity rule writing, other than the netnea tutorial to deal with False Positives shared by Christian:
Web Application Defender's Cookbook: Battling Hackers and Protecting Users (RBarnett) for quick receipes
ModSecurity Handbook (CFolini, IRistic) for general knowledge
https://coreruleset.org/category/blog/<https://isolate.menlosecurity.com/1/3735928037/https:/coreruleset.org/category/blog/> (CRS blog)
https://spartantri.com/ModSecurity/<https://isolate.menlosecurity.com/1/3735928037/https:/spartantri.com/ModSecurity/> (My blog, read the whitepaper on white listing)

Have fun!


2018-03-21 20:20 GMT+01:00 Christian Folini <christian.folini at netnea.com<mailto:christian.folini at netnea.com>>:
Hey Hiranmayi,

On Wed, Mar 21, 2018 at 02:25:32PM +0000, Hiranmayi Palanki wrote:
> What is the recommended Paranoia Level for an enterprise Internet facing
> application, that does not break the application functionality?

I'd say you should put it at least on level 2. This will bring some false
positives and you deal with those as described in the documentation.

> Let?s say if I have the default configuration enabled, and the encoded XSS
> attacks are getting through, what is the best way to block the encoded XSS
> attacks without enabling the higher Paranoia Levels?

If you do not want to use CRS rules, you need to write your own XSS rules
that do a better job than CRS. There are very good XSS documents around,
many of them several pages long with lots of example payloads. You need to
cover all these without breaking your application.

Most people find it easier to use CRS and deal with the false positives.

Ahoj,

Christian

--
I have always observed that to succeed in the world one should appear
like a fool but be wise.
-- Charles de Montesquieu
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<https://isolate.menlosecurity.com/1/3735928037/https:/lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>



American Express made the following annotations
******************************************************************************
"This message and any attachments are solely for the intended recipient and may contain confidential or privileged information. If you are not the intended recipient, any disclosure, copying, use, or distribution of the information included in this message and any attachments is prohibited. If you have received this communication in error, please notify us by reply e-mail and immediately and permanently delete this message and any attachments. Thank you."

American Express a ajout? le commentaire suivant le Ce courrier et toute pi?ce jointe qu'il contient sont r?serv?s au seul destinataire indiqu? et peuvent renfermer des 
renseignements confidentiels et privil?gi?s. Si vous n'?tes pas le destinataire pr?vu, toute divulgation, duplication, utilisation ou distribution du courrier ou de toute pi?ce jointe est interdite. Si vous avez re?u cette communication par erreur, veuillez nous en aviser par courrier et d?truire imm?diatement le courrier et les pi?ces jointes. Merci.

******************************************************************************
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20180322/4365951c/attachment-0001.html>

From christian.folini at netnea.com  Thu Mar 22 19:02:15 2018
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 22 Mar 2018 20:02:15 +0100
Subject: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP
 ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
In-Reply-To: <eb80e8d3418a4aa69574fde20dc875dc@BL2PR9302MB0003.024d.mgd.msft.net>
References: <20180320065708.jbr25rc4jzuirvv2@leander>
	<ed6916cd7e6c4306adaaaec15bfd25a2@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180320195151.gvjcavot32jx7bhj@leander>
	<5daa41504b704703bdf87a7af1dc5617@BL2PR9302MB0003.024d.mgd.msft.net>
	<20180321192010.zyouu67khyunpqgb@leander>
	<CAN6xG9t0YdGVJxUsTku_=wUrYYprD4ZkFLq6gNcTVdHisrZVFQ@mail.gmail.com>
	<eb80e8d3418a4aa69574fde20dc875dc@BL2PR9302MB0003.024d.mgd.msft.net>
Message-ID: <20180322190215.sbwtv4mbiqjwwcnu@leander>

The 2nd edition of the ModSec Handbook covers this somewhat, but it does not
go very deep. Also, the mileage really depends on the application.

Regs,

Christian


On Thu, Mar 22, 2018 at 05:46:55PM +0000, Hiranmayi Palanki wrote:
> I?ll try the custom rule you provided.
> 
> Also, is there generally any guidance available on the performance measurement metrics for each paranoia level.
> 
> From: Hiranmayi Palanki
> Sent: Thursday, March 22, 2018 1:40 PM
> To: 'Manuel Spartan' <spartantri at gmail.com>; 'Christian Folini' <christian.folini at netnea.com>
> Cc: 'OWASP CRS' <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: RE: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
> 
> Thanks Manuel and Christian for your responses.
> 
> The application will have a thin layer of business rule whitelist regex based input validation ? therefore the issue with XSS noted below may not be that much of a problem. For SQLinjection, it?s hard to guarantee that developers will always use parameterized queries consistently throughout the SDLC. In my opinion, encoded XSS attacks should be tackled at the lower paranoia levels.
> 
> I?d have to familiarize myself with the process of creating custom rules.
> 
> Is there a plan to enforce Content Security Policy Directives and other HTTP security response headers (e.g. X-Frame-Options/Frame-Ancestors). In some of the testing that I did, it is evident that these security headers are not being injected.
> 
> 
> 
> From: owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org> [mailto:owasp-modsecurity-core-rule-set-bounces+hiranmayi.palanki=aexp.com at lists.owasp.org] On Behalf Of Manuel Spartan
> Sent: Thursday, March 22, 2018 1:31 PM
> To: Christian Folini <christian.folini at netnea.com<mailto:christian.folini at netnea.com>>
> Cc: OWASP CRS <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
> Subject: Re: [Owasp-modsecurity-core-rule-set] False Negatives (was: OWASP ModSecurity Core Rule Set Community Summit: July 4, 2018, in London)
> 
> Hi Hiranmayi,
> 
> Do you think in implementing input validation at all in your app?
> 
> > Encoded XSS attacks (stopped at PL2 as Christian said)
> 
> > http://localhost:8082/xss2?uid=%3Balert%281%29%3B
> 
> 
> 
> > SQLi
> 
> > http://localhost:8082/sqli2?uid=3-2
> If the response display the same as uid=1 you have a nice injection as the back-end engine is evaluating the operation, however sending long complicated payloads will be difficult in Paranoia Level 2 due to libinjection inspections on ARGS and very hard in PL 4 as all non alphanumeric characters will cause a blocked request but that will be extremely annoying to implement if you use non-alphanumeric characters.
> 
> Why don't you simply make positive validation rules additional to CRS in paranoia level 2? That will be easier, faster and more effective if your app is not so complex but requires tailor made configurations and application knowledge while the CRS is generic and do not require much application knowledge.
> 
> i.e. This rule will accept only numeric values on the uid parameter on GET requests, with this you will get rid of both issues with the least effort, this is the kick... positive security power in action :)
> SecRule ARGS:uid "!@rx [0-9]+" "id:1,phase:1,deny,log,msg:'Bad value received'"
> 
> Notice that the phase:1 is only for GET parameters and cannot be placed inside Apache locations or it may be silently ignored but is faster as most CRS rules are in phase:2 it will execute earlier and save you the execution of many rules.
> 
> You may find very useful to learn the basics on ModSecurity rule writing, other than the netnea tutorial to deal with False Positives shared by Christian:
> Web Application Defender's Cookbook: Battling Hackers and Protecting Users (RBarnett) for quick receipes
> ModSecurity Handbook (CFolini, IRistic) for general knowledge
> https://coreruleset.org/category/blog/<https://isolate.menlosecurity.com/1/3735928037/https:/coreruleset.org/category/blog/> (CRS blog)
> https://spartantri.com/ModSecurity/<https://isolate.menlosecurity.com/1/3735928037/https:/spartantri.com/ModSecurity/> (My blog, read the whitepaper on white listing)
> 
> Have fun!
> 
> 
> 2018-03-21 20:20 GMT+01:00 Christian Folini <christian.folini at netnea.com<mailto:christian.folini at netnea.com>>:
> Hey Hiranmayi,
> 
> On Wed, Mar 21, 2018 at 02:25:32PM +0000, Hiranmayi Palanki wrote:
> > What is the recommended Paranoia Level for an enterprise Internet facing
> > application, that does not break the application functionality?
> 
> I'd say you should put it at least on level 2. This will bring some false
> positives and you deal with those as described in the documentation.
> 
> > Let?s say if I have the default configuration enabled, and the encoded XSS
> > attacks are getting through, what is the best way to block the encoded XSS
> > attacks without enabling the higher Paranoia Levels?
> 
> If you do not want to use CRS rules, you need to write your own XSS rules
> that do a better job than CRS. There are very good XSS documents around,
> many of them several pages long with lots of example payloads. You need to
> cover all these without breaking your application.
> 
> Most people find it easier to use CRS and deal with the false positives.
> 
> Ahoj,
> 
> Christian
> 
> --
> I have always observed that to succeed in the world one should appear
> like a fool but be wise.
> -- Charles de Montesquieu
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set<https://isolate.menlosecurity.com/1/3735928037/https:/lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>
> 
> 
> 
> American Express made the following annotations
> ******************************************************************************
> "This message and any attachments are solely for the intended recipient and may contain confidential or privileged information. If you are not the intended recipient, any disclosure, copying, use, or distribution of the information included in this message and any attachments is prohibited. If you have received this communication in error, please notify us by reply e-mail and immediately and permanently delete this message and any attachments. Thank you."
> 
> American Express a ajout? le commentaire suivant le Ce courrier et toute pi?ce jointe qu'il contient sont r?serv?s au seul destinataire indiqu? et peuvent renfermer des 
> renseignements confidentiels et privil?gi?s. Si vous n'?tes pas le destinataire pr?vu, toute divulgation, duplication, utilisation ou distribution du courrier ou de toute pi?ce jointe est interdite. Si vous avez re?u cette communication par erreur, veuillez nous en aviser par courrier et d?truire imm?diatement le courrier et les pi?ces jointes. Merci.
> 
> ******************************************************************************

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


-- 
https://www.feistyduck.com/training/modsecurity-training-course
https://www.feistyduck.com/books/modsecurity-handbook/
mailto:christian.folini at netnea.com
twitter: @ChrFolini

