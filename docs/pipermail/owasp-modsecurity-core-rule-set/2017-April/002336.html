<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Session fixating test - general CRS test
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Session%20fixating%20test%20-%0A%20general%20CRS%20test&In-Reply-To=%3C20170417074116.GB27548%40arxnet.hu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002334.html">
   <LINK REL="Next"  HREF="002337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Session fixating test - general CRS test</H1>
    <B>Ervin Heged&#252;s</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Session%20fixating%20test%20-%0A%20general%20CRS%20test&In-Reply-To=%3C20170417074116.GB27548%40arxnet.hu%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Session fixating test - general CRS test">airween at gmail.com
       </A><BR>
    <I>Mon Apr 17 07:41:16 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002334.html">[Owasp-modsecurity-core-rule-set] Session fixating test -	general	CRS test
</A></li>
        <LI>Next message: <A HREF="002337.html">[Owasp-modsecurity-core-rule-set] Session fixating test - general CRS test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2336">[ date ]</a>
              <a href="thread.html#2336">[ thread ]</a>
              <a href="subject.html#2336">[ subject ]</a>
              <a href="author.html#2336">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Barry,

first, thank you for your very detailed answer.

On Sun, Apr 16, 2017 at 08:46:44PM +0000, Barry Pollard wrote:
&gt;<i> This is a VERY subjective topic, but my opinions are below.
</I>&gt;<i> 
</I>&gt;<i> On 16 Apr 2017, at 20:26, Ervin Hegedus &lt;
</I>&gt;<i> 
</I>&gt;&gt;<i> ...and I
</I>&gt;&gt;<i> could demonstrate the advantages of WAF to my collegues. But
</I>&gt;&gt;<i> there were only two basic attack, what I could show them: XSS and
</I>&gt;&gt;<i> SQL injection.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> My 2 cents question is: how can I demonstrate another features? I
</I>&gt;&gt;<i> meant, it could be show the session fixating: I put a simple PHP
</I>&gt;&gt;<i> script to a webroot, load the page in a browser. I found the
</I>&gt;&gt;<i> PHPSESSID cookie, and then I tried to load the page in another
</I>&gt;&gt;<i> browser (on another host) - but there didn't happened anything...
</I>&gt;&gt;<i> the page had been loaded as well with the hijacked session.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> What did I miss, or how can I show this feature?
</I>&gt;<i> 
</I>&gt;<i> The Session Fixation protection in the OWASP CRS won't protect
</I>&gt;<i> against you coping and pasting the session id to another browser
</I>&gt;<i> (I presume that's what you did btw?).
</I>
yes, I just tried to that.

&gt;<i> To do that it would need to either 1) keep a collection of Session
</I>&gt;<i> ids versus IP addresses or 2) Somehow inject the session id into
</I>&gt;<i> the page and check it again as a XSRF-type protection. ModSecurity
</I>&gt;<i> CAN do both of these things but is not very good at either to be honest.
</I>
I thought through that before, but I thought Modsecurity stores
it in memory... I've found few e-mails on mailing lists, where
users discusses about hash tables for session/ip, session/UA, but
I didn't dound any other information about that.

Anyway, is there any information about it in Modsecurity DOCS?

&gt;<i> The OWASP Session-Fixation protection
</I>&gt;<i> (<A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/rules/REQUEST-943-APPLICATION-ATTACK-SESSION-FIXATION.conf">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/rules/REQUEST-943-APPLICATION-ATTACK-SESSION-FIXATION.conf</A>)
</I>&gt;<i> has basically three protections:
</I>&gt;<i> 
</I>&gt;<i> 1) It looks for attempts to manipulation HTTP data (e.g. &quot;set-cookie&quot;
</I>&gt;<i> mentions in request arguments), which shouldn't be sent and may be
</I>&gt;<i> examples of someone trying to use XSS or software bugs/flaws to
</I>&gt;<i> reflect the setting of the cookie back.
</I>&gt;<i> 2) It looks for requests where the arguments include common session
</I>&gt;<i> variable names and the referrer domain is different from the host
</I>&gt;<i> domain, which may be examples of a phishing attempt being used to
</I>&gt;<i> provide these variables.
</I>&gt;<i> 3) It looks for request where the arguments include common session
</I>&gt;<i> variable names and the referrer domain is not supplied (similar to
</I>&gt;<i> above).
</I>
well, now that's clear, many thanks for your explanation.

&gt;&gt;<i> In general way, how can I show the all features of Modsecurity,
</I>&gt;&gt;<i> and OWASP CRS?
</I>&gt;<i> 
</I>&gt;<i> That's a VERY subjective question. In my opinion XSS, SQL injection
</I>&gt;<i> are two of the most useful protections of ModSecurity (though SQLi
</I>&gt;<i> in particular is prone to false alterting!).
</I>
yes, I found those features and I could tested them.

&gt;<i> Other benefits, many of which are easily demonstrable, include:
</I>&gt;<i> 
</I>&gt;<i> 1) Full logging of requests (including POST arguments). Very useful
</I>&gt;<i> extra feature - even if running in DetectionOnly mode as you should
</I>&gt;<i> when you first install this. The ability to Debug issues and/or
</I>&gt;<i> retrospectively review logs after and incident is invaluable.
</I>&gt;<i> Though make sure you set it up properly and sanitise passwords,
</I>&gt;<i> credit cards and other personal data or you're just creating security
</I>&gt;<i> issues!
</I>
right,

&gt;<i> 2) Virtual Patching. If a particular attack is identified it's often
</I>&gt;<i> a lot easier to write and deploy a ModSecurity rule, than to fix in
</I>&gt;<i> the code. This gives you protection immediately and time to do the
</I>&gt;<i> proper fix instead of rushing out a half-baked, half tested fix.
</I>&gt;<i> Though this short be seen as a short term fix and the proper fix
</I>&gt;<i> should be applied. Who knows when you'll move away from a webserver
</I>&gt;<i> that supports ModSecurity and/or turn it or this additional rule
</I>&gt;<i> off (either accidentally or on purpose for some reason)?
</I>
yes, but this answer indicates new question(s) :). Eg. is there a
good documentation about the ruleset language? I mean, where can
I see the BNF of language? Where can I find any documentation how
can I write a custom own rules?

(Sorry, I know that's these questions aren't relates to CRS,
rather to libmodsecurity.)

&gt;<i> 3) Path traversal or remote code execution attacks. E.g. it's
</I>&gt;<i> easy to block requests looking for /etc/password or variants in
</I>&gt;<i> arguments. Or any request looking for .exe or .bat files.
</I>
good feature,

&gt;<i> 4) Identification and/or blocking of bots and other scripts that
</I>&gt;<i> use malformed requests. On one side, often these are harmless,
</I>&gt;<i> but on other most browsers behave and send valid request so why
</I>&gt;<i> not block the noise and let you concentrate on real requests.
</I>
I'ld like to protect my webservers against the attackers, not the
&quot;regular&quot; users, so I think that's a good and useful feature :).

&gt;<i> 5) Data leakages - including stack traces and the like. Though
</I>&gt;<i> scanning of outbound data is usually a bigger overhead than
</I>&gt;<i> inbound due to the size of the requests involved so think
</I>&gt;<i> carefully before you turn this on. But it's very easy to
</I>&gt;<i> write a rule so a 500 response code, triggers checks for stack
</I>&gt;<i> traces for example.
</I>
I could't reached this point - as I wrote above, I'm looking up a
mini-howto, or any other doc about the own rules.

&gt;<i> A lot of the other protections that it COULD give, are not as
</I>&gt;<i> robust - and used to be in a folder called &quot;experimental for
</I>&gt;<i> that reason in CRSv2. They involve using collections (which
</I>&gt;<i> don't work well in ModSecurity once you get any volume) and/or
</I>&gt;<i> content injection (which I personally don't think a WAF should
</I>&gt;<i> do). Don't mean to sound negative and I'm a big fan of
</I>&gt;<i> ModSecurity and all it can do, but just warning you to not get
</I>&gt;<i> too excited by DoS protection (thankful removed from OWASP CRS
</I>&gt;<i> page as used to be stated as a feature there) or the like. At
</I>&gt;<i> least until you understand how it could implement that and the
</I>&gt;<i> downsides of its implementation.
</I>
well, thanks for your personal opinion. I don't want to confide
the full protection to Modsecurity, but I think that would be a
good additional module for a full stack.

&gt;<i> To really get the most out of ModSecurity I recommend the
</I>&gt;<i> ModSecurity handbook (<A HREF="https://www.feistyduck.com/books/modsecurity-handbook/">https://www.feistyduck.com/books/modsecurity-handbook/</A>)
</I>&gt;<i> originally written by ModSecurity's created Ivan Risti&#263; (who's
</I>&gt;<i> since moved on to other things in the security industry) and
</I>&gt;<i> recently updated by Christian Folini (who's pretty active on
</I>&gt;<i> this mailing list and I'm sure will pipe up with his own
</I>&gt;<i> answer - possibly before I hit send on this one!). They also
</I>&gt;<i> run a training course on same site.
</I>
thanks for your tips, I'll review those.

&gt;<i> To read up a bit more explanation as to how the OWASP CRS
</I>&gt;<i> protects, and also see some proof of concepts with the more
</I>&gt;<i> advanced techniques (though in my opinion they shouldn't all
</I>&gt;<i> be used in production systems) then the &quot;Web Application
</I>&gt;<i> Defender's Cookbook&quot; by Ryan Barnett gives some food for
</I>&gt;<i> thought. The book isn't without flaws, but does show how you
</I>&gt;<i> could push ModSecurity to cover more. Ryan also used to be
</I>&gt;<i> heavily involved in maintaining both ModSecurity and OWASP
</I>&gt;<i> CRS but has also moved on (though does lurk here so apologies
</I>&gt;<i> to him if he takes the &quot;flawed&quot; statement above personally!).
</I>
thanks too,

&gt;<i> Not sure how this mailing list feels about blatant
</I>&gt;<i> recommendations like that, but since I'm not directly
</I>&gt;<i> affiliated with ModSecurity, OWASP or either if the books
</I>&gt;<i> above, hopefully no one will mind me sharing my opinion.
</I>
yes, you're right, I know - and apologize for this thread.


Many thanks for your help again.



a.

-- 
I &#65533; UTF-8
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002334.html">[Owasp-modsecurity-core-rule-set] Session fixating test -	general	CRS test
</A></li>
	<LI>Next message: <A HREF="002337.html">[Owasp-modsecurity-core-rule-set] Session fixating test - general CRS test
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2336">[ date ]</a>
              <a href="thread.html#2336">[ thread ]</a>
              <a href="subject.html#2336">[ subject ]</a>
              <a href="author.html#2336">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
