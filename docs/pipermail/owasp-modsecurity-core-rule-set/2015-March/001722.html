<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Questions about	modsecurity_crs_11_dos_protection.conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Questions%20about%0A%09modsecurity_crs_11_dos_protection.conf&In-Reply-To=%3CDUB129-W8869A3CAEABF9681EBF5A6821C0%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001721.html">
   <LINK REL="Next"  HREF="001724.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Questions about	modsecurity_crs_11_dos_protection.conf</H1>
    <B>Barry Pollard</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Questions%20about%0A%09modsecurity_crs_11_dos_protection.conf&In-Reply-To=%3CDUB129-W8869A3CAEABF9681EBF5A6821C0%40phx.gbl%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Questions about	modsecurity_crs_11_dos_protection.conf">barry_pollard at hotmail.com
       </A><BR>
    <I>Fri Mar  6 12:52:43 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001721.html">[Owasp-modsecurity-core-rule-set]	Owasp-modsecurity-core-rule-set Digest, Vol 71, Issue 2
</A></li>
        <LI>Next message: <A HREF="001724.html">[Owasp-modsecurity-core-rule-set] Questions about modsecurity_crs_11_dos_protection.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1722">[ date ]</a>
              <a href="thread.html#1722">[ thread ]</a>
              <a href="subject.html#1722">[ subject ]</a>
              <a href="author.html#1722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've a few questions about&#160;modsecurity_crs_11_dos_protection.conf

Question 1. The first set of rules are these:

#
# Enforce an existing IP address block and log only 1-time/minute
# We don't want to get flooded by alerts during an attack or scan so
# we are only triggering an alert once/minute. &#160;You can adjust how often
# you want to receive status alerts by changing the expirevar setting below.
#
SecRule IP:DOS_BLOCK &quot;@eq 1&quot; &quot;chain,phase:1,id:'981044',drop,msg:'Denial of Service (DoS) Attack Identified from %{tx.real_ip} (%{tx.dos_block_counter} hits since last alert)',setvar:ip.dos_block_counter=+1&quot;
	SecRule &amp;IP:DOS_BLOCK_FLAG &quot;@eq 0&quot; &quot;setvar:ip.dos_block_flag=1,expirevar:ip.dos_block_flag=60,setvar:tx.dos_block_counter=%{ip.dos_block_counter},setvar:ip.dos_block_counter=0&quot;

#
# Block and track # of requests but don't log
SecRule IP:DOS_BLOCK &quot;@eq 1&quot; &quot;phase:1,id:'981045',t:none,drop,nolog,setvar:ip.dos_block_counter=+1&quot;


Is rule 981045 needed? Rule 981044 already increments the counter even if the chained rule does not match so I don't see the point in rule 981045. Or am I misunderstanding this:
<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#setvar">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#setvar</A>


Question 2:

#
# DOS Counter
# Count the number of requests to non-static resoures
#&#160;
SecRule REQUEST_BASENAME &quot;!\.(jpe?g|png|gif|js|css|ico)$&quot; &quot;phase:5,id:'981047',t:none,nolog,pass,setvar:ip.dos_counter=+1&quot;

Any reason we don't use t:lowercase instead of assuming the file extensions are already in lowercase? Would also be nice to specify the exact pattern match in&#160;modsecurity_crs_10_setup.conf with it defaulting to above though I guess you can always use&#160;SecRuleUpdateTargetById to add your own extensions or other pattern matching.


Question 3:

#
# Check DOS Counter
# If the request count is greater than or equal to user settings,
# we then set the burst counter
#&#160;
SecRule IP:DOS_COUNTER &quot;@gt %{tx.dos_counter_threshold}&quot; &quot;phase:5,id:'981048',t:none,nolog,pass,t:none,setvar:ip.dos_burst_counter=+1,expirevar:ip.dos_burst_counter=%{tx.dos_burst_time_slice},setvar:!ip.dos_counter&quot;

I presume this is a typo to have t:none specified twice in this rule?

Question 4:

Not directly related to this but has anyone made any progress in keeping ip.pag down to a reasonable size as doesn't seem to clean up like it should do? Several posts about this about the place but not managed to find any definitive answers...



 		 	   		  
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001721.html">[Owasp-modsecurity-core-rule-set]	Owasp-modsecurity-core-rule-set Digest, Vol 71, Issue 2
</A></li>
	<LI>Next message: <A HREF="001724.html">[Owasp-modsecurity-core-rule-set] Questions about modsecurity_crs_11_dos_protection.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1722">[ date ]</a>
              <a href="thread.html#1722">[ thread ]</a>
              <a href="subject.html#1722">[ subject ]</a>
              <a href="author.html#1722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
