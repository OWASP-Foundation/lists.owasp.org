From Ryan.Barnett at breach.com  Mon Feb  1 15:08:26 2010
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Mon, 1 Feb 2010 12:08:26 -0800
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-28)
	Use only numerical rule IDs
Message-ID: <25172814.1265054906608.JavaMail.tomcat@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-28?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-28.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

All rules have numeric-only IDs in the CRS v2.0.5.

> Use only numerical rule IDs
> ---------------------------
>
>                 Key: CORERULES-28
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-28
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>            Reporter: Ivan Risti?
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> The Core Rules use non-numerical rule IDs in many places. As a result, rule removal (exceptions) is not possible. Also see MODSEC-114.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

       

From ossec.junkie at gmail.com  Thu Feb  4 17:29:01 2010
From: ossec.junkie at gmail.com (OSSEC junkie)
Date: Thu, 4 Feb 2010 14:29:01 -0800
Subject: [Owasp-modsecurity-core-rule-set] RBL Lookup File - ip.pag help!
In-Reply-To: <869a38361001290901q390d0b61kc7801f5ded1ae94d@mail.gmail.com>
References: <869a38361001250805s56ab587fm4d603c2b5229ebd6@mail.gmail.com>
	<869a38361001290901q390d0b61kc7801f5ded1ae94d@mail.gmail.com>
Message-ID: <869a38361002041429v7b5e1139lbdd2e4186e01cfb8@mail.gmail.com>

All:

I am using the RBL lookup and the ip.pag file is huge. ?I thought this
would be recycled nightly but I guess not. ?Any ideas or insight on
how to shrink would be great. ?I could script the file to be deleted
nightly but just wanted to make sure there isn't something I need to
be doing but am not..

My current rule set being used is:
SecRule IP:PREVIOUS_RBL_CHECK "@eq 1"
"phase:1,t:none,pass,nolog,skipAfter:END_RBL_LOOKUP"

?SecRule REMOTE_ADDR "@rbl sbl-xbl.spamhaus.org

"
"phase:1,t:none,log,auditlog,msg:'RBL Match for SPAM
Source',tag:'AUTOMATION/MALICIOUS',severity:'2',setvar:'tx.msg=%{rule
.msg}',setvar:tx.automation_score=+1,logdata:'%{TX.0}',setvar:tx.%{rule.id

}-AUTOMATION/MALICIOUS-%{rule.severity}-%{rule.msg}-%{matched_var_name}=%{matched_var},setvar:ip.s
pammer=1,expirevar:ip.spammer=86400,setvar:ip.previous_rbl_check=1,expirevar:ip.previous_rbl_check=86400,skipAfter:END_RBL_CHECK"

?SecAction "phase:1.t:none,nolog,pass,setvar:ip.previous_rbl_check=1,expirevar:ip.previous_rbl_check=86400"

SecMarker END_RBL_LOOKUP

?SecRule IP:SPAMMER "@eq 1" "phase:1,t:none,log,auditlog,msg:'Request
from Known SPAM Source (Previous
RBLMatch)',tag:'AUTOMATION/MALICIOUS',severity:'2',setvar:'tx.msg=%{
rule.msg}',setvar:tx.automation_score=+1,logdata:'%{TX.0}',setvar:tx.%{rule.id

}-AUTOMATION/MALICIOUS-%{rule.severity}-%{rule.msg}-%{matched_var_name}=%{matched_var}"

SecMarker END_RBL_CHECK

Any ideas as to why the log file is so huge? ? The expirevar option is
in the configuration but no luck. ?I will ultimately be forced to
delete the file nightly...or is that the ideal way to handle it?

From rcbarnett at gmail.com  Fri Feb  5 16:03:13 2010
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Fri, 5 Feb 2010 16:03:13 -0500
Subject: [Owasp-modsecurity-core-rule-set] New CRS Release - v2.0.5
Message-ID: <201002051603.13793.rcbarnett@gmail.com>

--------------------------
Version 2.0.5 - 02/01/2100
--------------------------

Improvements:
- Removed previous 10 config files as they may conflict with local customized Mod configs.
- Added a new 10 config file that allows the user to globally set TX variables to turn on/off
  PARANOID_MODE inspection, set anomaly score levels and http policies.
  Must have ModSecurity 2.5.12 to use the macro expansion in numeric operators.
- Added Rule Logic and Reference links to rules descriptions.
- Added Rule IDs to all rules.
- Added tag data mapping to new OWASP Top 10 and AppSensor Projects, WASC Threat 
  Classification
- Removed Apache limit directives from the 23 file
- Added macro expansion to 23 file checks.
- Added @pmFromFile check to 35 bad robots file
- Added malicious UA strings to 35 bad robots check
- Created an experimental rules file
- Updated HTTP Parameter Pollution (HPP) rule logic to concat data into a TX variable for 
  inspection
- Removed TX inspections for generic attacks and reverted to standard ARGS inspection
  https://www.modsecurity.org/tracker/browse/MODSEC-120
- Updated the variable list for standard inspections (ARGS|ARGS_NAMES|XML:/*) and moved 
  the other variables to the PARANOID list (REQUEST_URI|REQUEST_BODY|REQUEST_HEADERS|
  HX:HPP_DATA)
- Moved converted ET Snort rules to the /optional_rules directory
- Created a new Header Tagging ruleset (optional_rules) that will add matched rule data to 
  the request headers.
- Updated Inbound blocking conf file to use macro expansion from the 10 config file settings
- Added separate anomaly scores for inbound, outbound and total to be evaluated for 
  blocking.
- Updated the regex logic in the (1=1) rule to factor in quotes and other logical 
  operators. 
- Updated the SPAMMER RBL check rules logic to only check once per IP/Day.
- Added new outbound malware link detection rules.
- Added PHP "call_user_func" to blacklist
  Identified by SOGETI ESEC R&D
 
Bug Fixes:
- Removed Non-numeric Rule IDs
  https://www.modsecurity.org/tracker/browse/CORERULES-28
- Updated the variable list on SQLi rules.
- Fixed outbound @pmFromFile action from allow to skipAfter to allow for outbound anomaly 
  scoring and blocking

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com


From misc.lists at blueyonder.co.uk  Sat Feb  6 05:23:42 2010
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Sat, 06 Feb 2010 10:23:42 +0000
Subject: [Owasp-modsecurity-core-rule-set] New CRS Release - v2.0.5
In-Reply-To: <201002051603.13793.rcbarnett@gmail.com>
References: <201002051603.13793.rcbarnett@gmail.com>
Message-ID: <1265451822.3307.3.camel@localhost>

On Fri, 2010-02-05 at 16:03 -0500, Ryan Barnett wrote:
> --------------------------
> Version 2.0.5 - 02/01/2100
> --------------------------
> 

Thanks!

But might I make a suggestion....

Each time you make such an announcement could you please include a link
to the location of the files?

I know where it is now and have it bookmarked, but it can be a little
difficult to find otherwise...

http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project#tab=Download

Best regards

Mark




From misc.lists at blueyonder.co.uk  Sat Feb  6 08:03:59 2010
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Sat, 06 Feb 2010 13:03:59 +0000
Subject: [Owasp-modsecurity-core-rule-set] Updating CRS
Message-ID: <1265461439.3307.19.camel@localhost>

Hello,

In the latest version of CRS the README file contains the following
text:

"You can optionally automatically download the latest rules by using the
rules-updater.pl script in the /util directory.  Refer to the README
file in the /util dir."

The util directory in the tarball however contains neither a
rules-updater script, nor a readme file.

This leads me to a more generic question - How best to maintain one's
ruleset.

I would very much like some sort of automatic (or configurable
semi-automatic) updating process. I am also a little concerned about
local exceptions. A little while ago Ryan was very helpful in getting me
over some FP problems. The solution involved updating
modsecurity_crs_48_local_exceptions.conf. Today I updated to CRS 2.0.5
and, having unpacked the tarball, was merrily copying the files
into /etc/httpd/modsecurity.d/base_rules/ Fortunately my root
environment has overwrite confirmation on, and I realised just in the
nick of time that I was about to overwrite the file with Ryan's rule
exceptions in.

Is there no way to engineer a system - possibly a bit like
spamassassin's sa-update which receives rule updates, but where local
modifications are stored in a local.conf file which is untouched by the
update process?

Just a thought...

Mark




From rcbarnett at gmail.com  Sat Feb  6 11:17:07 2010
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Sat, 6 Feb 2010 11:17:07 -0500
Subject: [Owasp-modsecurity-core-rule-set] New CRS Release - v2.0.5
In-Reply-To: <1265451822.3307.3.camel@localhost>
References: <201002051603.13793.rcbarnett@gmail.com>
	<1265451822.3307.3.camel@localhost>
Message-ID: <cba0286a1002060817j57b8aa58v483453d637ea792f@mail.gmail.com>

On Sat, Feb 6, 2010 at 5:23 AM, Arthur Dent <misc.lists at blueyonder.co.uk>wrote:

> On Fri, 2010-02-05 at 16:03 -0500, Ryan Barnett wrote:
> > --------------------------
> > Version 2.0.5 - 02/01/2100
> > --------------------------
> >
>
> Thanks!
>
> But might I make a suggestion....
>
> Each time you make such an announcement could you please include a link
> to the location of the files?
>
> I know where it is now and have it bookmarked, but it can be a little
> difficult to find otherwise...
>
>
> http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project#tab=Download
>
> Best regards
>
> Mark
>
>
>
Great point Mark.  I will include the direct link in all future update
emails.

Thanks.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100206/1f64e9c8/attachment.html 

From rcbarnett at gmail.com  Sat Feb  6 11:35:54 2010
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Sat, 6 Feb 2010 11:35:54 -0500
Subject: [Owasp-modsecurity-core-rule-set] Updating CRS
In-Reply-To: <1265461439.3307.19.camel@localhost>
References: <1265461439.3307.19.camel@localhost>
Message-ID: <cba0286a1002060835m14674c57qc20a0e7d07a2487e@mail.gmail.com>

On Sat, Feb 6, 2010 at 8:03 AM, Arthur Dent <misc.lists at blueyonder.co.uk>wrote:

> Hello,
>
> In the latest version of CRS the README file contains the following
> text:
>
> "You can optionally automatically download the latest rules by using the
> rules-updater.pl script in the /util directory.  Refer to the README
> file in the /util dir."
>
> The util directory in the tarball however contains neither a
> rules-updater script, nor a readme file.
>
>
Yeah, I jumped the gun a bit on that one...  The rules-updater.pl script is
currently part of the Mod source archive in the /tools directory.  We are
planning to move it over to the CRS archive instead.  We are actually
testing the rules-updater.pl script functionality right now.  I have the
target repository setup on the Mod site and the script seems to work for me.
 Brian and I were talking and we thought that we should get some volunteers
to test it to before releasing it to the public.  If anyone wants to test it
out, shoot me an email and I will give you the proper conf details.



> This leads me to a more generic question - How best to maintain one's
> ruleset.
>
> I would very much like some sort of automatic (or configurable
> semi-automatic) updating process. I am also a little concerned about
> local exceptions. A little while ago Ryan was very helpful in getting me
> over some FP problems. The solution involved updating
> modsecurity_crs_48_local_exceptions.conf. Today I updated to CRS 2.0.5
> and, having unpacked the tarball, was merrily copying the files
> into /etc/httpd/modsecurity.d/base_rules/ Fortunately my root
> environment has overwrite confirmation on, and I realised just in the
> nick of time that I was about to overwrite the file with Ryan's rule
> exceptions in.
>
> This is my bad.  I understand the situation and I *thought* I had it fixed.
 What will happen in the next rev is that the 49 local exceptions file will
be moved up out of the base_rules dir and it will also be re-named to -
modsecurity_crs_48_local_exceptions.conf.example.  This way, if you have a
customized version, then the ".example" extension should not overwrite it if
you unpack it into your local dirs.


> Is there no way to engineer a system - possibly a bit like
> spamassassin's sa-update which receives rule updates, but where local
> modifications are stored in a local.conf file which is untouched by the
> update process?
>
>
Agreed.  Right now, the rules-updater.pl script is just an auto-download
utility but we can certainly extend it to more of a rules management app.  I
am thinking that it needs to be similar to oinkmaster -
http://oinkmaster.sourceforge.net/ - so that it can help the user to
understand what rules have been added, removed or updated and to make
management easier.  We will look into this.

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100206/13e52e1c/attachment.html 

From d3taveras38d3 at gmail.com  Wed Feb 10 18:56:36 2010
From: d3taveras38d3 at gmail.com (David Taveras)
Date: Wed, 10 Feb 2010 17:56:36 -0600
Subject: [Owasp-modsecurity-core-rule-set] basic questions of apache
	exploitation & modsecurity.
Message-ID: <ed3aec3e1002101556yd65dca6reb5f7a41c6098120@mail.gmail.com>

Hello,

Iam trying to build a very general panorama on the paths a hack can
take place with modsecurity & an apache webserver. So i have some
general questions!

a.) all possible apache attacks start via a request method, correct ?
(DELETE, GET, HEAD, PUT, POST), correct?

b.) Although modsecurity inspects the REQUEST_URI, the focus is
actually the QUERY_STRING this is what all the rules end up inspecting
right (aside from the body content for data leakage). Right?

c.) If I host an apache webserver with vulerabilities within the
apache code and this one hosts no scripts or data. Is it possible to
exploit those vulerabilities on apache?

d.) How if a buffer overflow exploited on a webserver hosting images
and php scripts?

e.) What is the point of installing modsecurity aside from certain
protection of DoS attacks, or security awareness if I host an apache
webserver with only html pages?

Thanks

From ivan.ristic at gmail.com  Sat Feb 13 10:25:45 2010
From: ivan.ristic at gmail.com (Ivan Ristic)
Date: Sat, 13 Feb 2010 15:25:45 +0000
Subject: [Owasp-modsecurity-core-rule-set] basic questions of apache
	exploitation & modsecurity.
In-Reply-To: <ed3aec3e1002101556yd65dca6reb5f7a41c6098120@mail.gmail.com>
References: <ed3aec3e1002101556yd65dca6reb5f7a41c6098120@mail.gmail.com>
Message-ID: <1f9222b71002130725s35320c6cnfc419981e67239f2@mail.gmail.com>

Hi David,

In principle, ModSecurity was not designed to protect Apache itself.
It may do, but if it can, it's a byproduct of whatever else we are
trying to accomplish. I never used ModSecurity in that way, although
others may have. More responses below.


On Wed, Feb 10, 2010 at 11:56 PM, David Taveras <d3taveras38d3 at gmail.com> wrote:
> Hello,
>
> Iam trying to build a very general panorama on the paths a hack can
> take place with modsecurity & an apache webserver. So i have some
> general questions!
>
> a.) all possible apache attacks start via a request method, correct ?
> (DELETE, GET, HEAD, PUT, POST), correct?

The request method does not matter if there's a vulnerability in the
code somewhere that can be exploited before Apache evaluates the
request method. Overall, I don't think Apache cares much about request
methods.


> b.) Although modsecurity inspects the REQUEST_URI, the focus is
> actually the QUERY_STRING this is what all the rules end up inspecting
> right (aside from the body content for data leakage). Right?

You would inspect response bodies for leakage, but input data can also
be in the request headers and the request body.


> c.) If I host an apache webserver with vulerabilities within the
> apache code and this one hosts no scripts or data. Is it possible to
> exploit those vulerabilities on apache?

It depends on the configuration and on the vulnerabilities. It might be.


> d.) How if a buffer overflow exploited on a webserver hosting images
> and php scripts?

Can you please rephrase the question?


> e.) What is the point of installing modsecurity aside from certain
> protection of DoS attacks, or security awareness if I host an apache
> webserver with only html pages?

I would say that ModSecurity has little to add in that situation.


> Thanks
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Ivan Ristic
ModSecurity Handbook [https://www.feistyduck.com]
SSL Labs [https://www.ssllabs.com/ssldb/]

From Brian.Rectanus at breach.com  Sat Feb 13 17:25:28 2010
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Sat, 13 Feb 2010 14:25:28 -0800
Subject: [Owasp-modsecurity-core-rule-set] basic questions of
 apache	exploitation & modsecurity.
In-Reply-To: <1f9222b71002130725s35320c6cnfc419981e67239f2@mail.gmail.com>
References: <ed3aec3e1002101556yd65dca6reb5f7a41c6098120@mail.gmail.com>
	<1f9222b71002130725s35320c6cnfc419981e67239f2@mail.gmail.com>
Message-ID: <4B7726D8.1060507@breach.com>

I think that this is deviating from the list topic (core rule set).
Please take it to the mod-security-users list if you want to discuss
ModSecurity itself.  I've CC'd that list, so please reply there.

Some further comments below...

Ivan Ristic wrote:
> Hi David,
> 
> In principle, ModSecurity was not designed to protect Apache itself.
> It may do, but if it can, it's a byproduct of whatever else we are
> trying to accomplish. I never used ModSecurity in that way, although
> others may have. More responses below.
> 
> 
> On Wed, Feb 10, 2010 at 11:56 PM, David Taveras <d3taveras38d3 at gmail.com> wrote:
>> Hello,
>>
>> Iam trying to build a very general panorama on the paths a hack can
>> take place with modsecurity & an apache webserver. So i have some
>> general questions!
>>
>> a.) all possible apache attacks start via a request method, correct ?
>> (DELETE, GET, HEAD, PUT, POST), correct?
> 
> The request method does not matter if there's a vulnerability in the
> code somewhere that can be exploited before Apache evaluates the
> request method. Overall, I don't think Apache cares much about request
> methods.

Some examples:

* SSL processing

* Parsing the request line (required before you can see the method)

* Header parsing, such as the Host header which may determine the Apache
config (and thus the ModSecurity config) used to process the request.

> 
> 
>> b.) Although modsecurity inspects the REQUEST_URI, the focus is
>> actually the QUERY_STRING this is what all the rules end up inspecting
>> right (aside from the body content for data leakage). Right?
> 
> You would inspect response bodies for leakage, but input data can also
> be in the request headers and the request body.

All aspects of the request are used, but generally speaking it is ARGS
that is probably the most common.

Common examples that you seem to have overlooked:

* Cookie values (both incoming and outgoing)

* General HTTP request abnormalities:
  - Known HTTP method
  - Checking for headers that should normally be there (or not there)
  - Using strict parsing for multi-part form posts

* URI based parameters:
  http://my.host.tld/myapp/view/record/record-id-12345

* Auth values (ie check brute forcing and that passwords fall within a
policy guidelines).

> 
> 
>> c.) If I host an apache webserver with vulerabilities within the
>> apache code and this one hosts no scripts or data. Is it possible to
>> exploit those vulerabilities on apache?
> 
> It depends on the configuration and on the vulnerabilities. It might be.

I would say yes.  Take an SSL exploit as an example.  Also a buffer
overflow in processing the request line.  Both of these fall before
ModSecurity sees the request and there is zero chance of ModSecurity
stopping anything it never sees ;)

> 
> 
>> d.) How if a buffer overflow exploited on a webserver hosting images
>> and php scripts?
> 
> Can you please rephrase the question?

Assuming you meant: How *is* a buffer overflow exploited on a webserver
*only* hosting images and php scripts?

While these may seem like they are both "non-executing" ways of
processing (as apposed to the obvious execution of a CGI script), they
are still executing code.

* All request still require HTTP parsing and there could be a buffer
overflow in this parsing code.

* Most images are static, but they can be dynamic (rendered from a
script - such as CAPTCHAs, routes on maps, etc).  So there could be
external code executed.

* PHP is typically handled in two ways.  You can load mod_php and then
the PHP processing is executed within the Apache processing space.
Another (maybe even more common method due to threading issues in php)
is running PHP as a fast-cgi application, which runs the PHP processing
within a separate processing space which Apache then communicates via
IPC.  In either case any buffer overflow in PHP processing may mean that
protections could be bypassed, or worse allow for arbitrary code
execution.  You may think you are protected because the code normally is
running as a non-admin user (www-data, apache, nobody, etc), but if
there is a local exploit on your machine, then this code could be
escalated into running arbitrary code as root.

* And of course there is the possibility of a buffer overflow in the SSL
processing.

* Other exploits could target the caching sub-system (mod_cache), etc.
which would even put static images and pages at risk.


> 
> 
>> e.) What is the point of installing modsecurity aside from certain
>> protection of DoS attacks, or security awareness if I host an apache
>> webserver with only html pages?
> 
> I would say that ModSecurity has little to add in that situation.

You mean only *static*, on disk data, not generated HTML?  Even
seemingly static HTML may be combining headers/footers at runtime.
Also, even static sites generally will have some sort of authentication,
sessions and may even process requests with parameters, but still serve
static data.  But Ivan is correct, ModSecurity really will not help you
as much as it is meant for processing the request/response data.

However, a few exceptions that I can think of:

* Running as a caching reverse-proxy in front of web servers that may be
vulnerable to attacks and cannot be patched/updated for any number of
reasons.

* Aiding in the prevention of path traversal attacks.  That is,
preventing a user from getting to data that the user may not have been
authorized for.

* Aiding in detecting issues with authentication (credentials) and
authorization (sessions).

* Aiding in the detection of site defacement (ie making sure outgoing
data is okay).

* Aiding in the detection of data theft (ie private data leaving the
server, such as confidential documents, etc.)

* Providing a full audit log of requests (all or maybe just for
confidential docs).

* Aiding in the prevention of site scraping.

-B

-- 
Brian Rectanus
Breach Security

From Ryan.Barnett at breach.com  Wed Feb 17 08:35:45 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 17 Feb 2010 08:35:45 -0500
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] base
	rules phpids
In-Reply-To: <be95b6c51002170523y3f715c46idd49cccb0a721359@mail.gmail.com>
References: <be95b6c51002170523y3f715c46idd49cccb0a721359@mail.gmail.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F879075C@MONET.utopiasystems.net>

Tim,
There is a separate email list for the CRS - 
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

I am cross-posting this thread however.  The security filters taken from PHPIDS are applicable to *all* web applications.  The filters use the same "attack payload detection" approach that the CRS does.  They are not specifically focusing on any PHP vulnerabilities.  They are looking for XSS, SQLi, RFI, etc...  Looking at the rule you listed below, it looks as though it is triggering on some XSS/Javascript data.  If you can post an example audit log entry it may help to diagnose.

-Ryan

________________________________________
From: Timothy Legge [timlegge at gmail.com]
Sent: Wednesday, February 17, 2010 8:23 AM
To: mod-security-users at lists.sourceforge.net
Subject: [mod-security-users] base rules phpids

Hi

We have a couple of pages that are hitting the following rule:

SecRule REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/*
"(?:\.\s*\w+\W*=)|(?:\W\s*(?:location|document)\s*\W[^({[;]+[({[;])|(?:\(\w+\?[:\w]+\))|(?:\w{2,}\s*=\s*\d+[^&\w]\w+)|(?:\]\s*\(\s*\w+)"
"phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects
JavaScript location/document property access and window access
obfuscation',id:'phpids-23',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}"

Our site is not php is there any good reason to use the phpids rules?

Tim

------------------------------------------------------------------------------
SOLARIS 10 is the OS for Data Centers - provides features such as DTrace,
Predictive Self Healing and Award Winning ZFS. Get Solaris 10 NOW
http://p.sf.net/sfu/solaris-dev2dev
_______________________________________________
mod-security-users mailing list
mod-security-users at lists.sourceforge.net
https://lists.sourceforge.net/lists/listinfo/mod-security-users
Commercial ModSecurity Appliances, Rule Sets and Support:
http://www.modsecurity.org/breach/index.html

From timlegge at gmail.com  Wed Feb 17 08:56:15 2010
From: timlegge at gmail.com (Timothy Legge)
Date: Wed, 17 Feb 2010 09:56:15 -0400
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] base
	rules phpids
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F879075C@MONET.utopiasystems.net>
References: <be95b6c51002170523y3f715c46idd49cccb0a721359@mail.gmail.com>
	<8A1B4B015C52A54886DF15E9A97C7FB9F879075C@MONET.utopiasystems.net>
Message-ID: <be95b6c51002170556y4cabf372i3083217fec6b9b60@mail.gmail.com>

Ryan

Thanks, I have subscribed.

I think it is hitting on

selections=5-O%2C6-O&nums=110%2C105&baseAmount=2.00&withTax=2.35&view=all&tab=&ps_viewType=all&baseAmount=2.00&5-O=1.10&6-O=1.05

specifically I think the encoded comma %2C but I am not certain.

Tim



On Wed, Feb 17, 2010 at 9:35 AM, Ryan Barnett <Ryan.Barnett at breach.com> wrote:
> Tim,
> There is a separate email list for the CRS -
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> I am cross-posting this thread however. ?The security filters taken from PHPIDS are applicable to *all* web applications. ?The filters use the same "attack payload detection" approach that the CRS does. ?They are not specifically focusing on any PHP vulnerabilities. ?They are looking for XSS, SQLi, RFI, etc... ?Looking at the rule you listed below, it looks as though it is triggering on some XSS/Javascript data. ?If you can post an example audit log entry it may help to diagnose.
>
> -Ryan
>
> ________________________________________
> From: Timothy Legge [timlegge at gmail.com]
> Sent: Wednesday, February 17, 2010 8:23 AM
> To: mod-security-users at lists.sourceforge.net
> Subject: [mod-security-users] base rules phpids
>
> Hi
>
> We have a couple of pages that are hitting the following rule:
>
> SecRule REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/*
> "(?:\.\s*\w+\W*=)|(?:\W\s*(?:location|document)\s*\W[^({[;]+[({[;])|(?:\(\w+\?[:\w]+\))|(?:\w{2,}\s*=\s*\d+[^&\w]\w+)|(?:\]\s*\(\s*\w+)"
> "phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects
> JavaScript location/document property access and window access
> obfuscation',id:'phpids-23',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}"
>
> Our site is not php is there any good reason to use the phpids rules?
>
> Tim
>
> ------------------------------------------------------------------------------
> SOLARIS 10 is the OS for Data Centers - provides features such as DTrace,
> Predictive Self Healing and Award Winning ZFS. Get Solaris 10 NOW
> http://p.sf.net/sfu/solaris-dev2dev
> _______________________________________________
> mod-security-users mailing list
> mod-security-users at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
> Commercial ModSecurity Appliances, Rule Sets and Support:
> http://www.modsecurity.org/breach/index.html
>

From Ryan.Barnett at breach.com  Wed Feb 17 09:02:30 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 17 Feb 2010 09:02:30 -0500
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] base
	rules phpids
In-Reply-To: <be95b6c51002170556y4cabf372i3083217fec6b9b60@mail.gmail.com>
References: <be95b6c51002170523y3f715c46idd49cccb0a721359@mail.gmail.com>
	<8A1B4B015C52A54886DF15E9A97C7FB9F879075C@MONET.utopiasystems.net>,
	<be95b6c51002170556y4cabf372i3083217fec6b9b60@mail.gmail.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F879075D@MONET.utopiasystems.net>

If you look in the audit log for transaction, the "data" field in the Message line will tell you what portion of the payload matched the regex.

-Ryan
________________________________________
From: Timothy Legge [timlegge at gmail.com]
Sent: Wednesday, February 17, 2010 8:56 AM
To: Ryan Barnett
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [mod-security-users] base rules phpids

Ryan

Thanks, I have subscribed.

I think it is hitting on

selections=5-O%2C6-O&nums=110%2C105&baseAmount=2.00&withTax=2.35&view=all&tab=&ps_viewType=all&baseAmount=2.00&5-O=1.10&6-O=1.05

specifically I think the encoded comma %2C but I am not certain.

Tim



On Wed, Feb 17, 2010 at 9:35 AM, Ryan Barnett <Ryan.Barnett at breach.com> wrote:
> Tim,
> There is a separate email list for the CRS -
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> I am cross-posting this thread however.  The security filters taken from PHPIDS are applicable to *all* web applications.  The filters use the same "attack payload detection" approach that the CRS does.  They are not specifically focusing on any PHP vulnerabilities.  They are looking for XSS, SQLi, RFI, etc...  Looking at the rule you listed below, it looks as though it is triggering on some XSS/Javascript data.  If you can post an example audit log entry it may help to diagnose.
>
> -Ryan
>
> ________________________________________
> From: Timothy Legge [timlegge at gmail.com]
> Sent: Wednesday, February 17, 2010 8:23 AM
> To: mod-security-users at lists.sourceforge.net
> Subject: [mod-security-users] base rules phpids
>
> Hi
>
> We have a couple of pages that are hitting the following rule:
>
> SecRule REQUEST_BODY|REQUEST_URI_RAW|ARGS|ARGS_NAMES|FILES|FILES_NAMES|XML:/*
> "(?:\.\s*\w+\W*=)|(?:\W\s*(?:location|document)\s*\W[^({[;]+[({[;])|(?:\(\w+\?[:\w]+\))|(?:\w{2,}\s*=\s*\d+[^&\w]\w+)|(?:\]\s*\(\s*\w+)"
> "phase:2,capture,multiMatch,t:none,t:urlDecodeUni,t:urlDecodeUni,t:htmlEntityDecode,t:replaceComments,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,block,nolog,auditlog,msg:'Detects
> JavaScript location/document property access and window access
> obfuscation',id:'phpids-23',tag:'WEB_ATTACK',logdata:'%{TX.0}',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.%{rule.id}-WEB_ATTACK-%{matched_var_name}=%{matched_var}"
>
> Our site is not php is there any good reason to use the phpids rules?
>
> Tim
>
> ------------------------------------------------------------------------------
> SOLARIS 10 is the OS for Data Centers - provides features such as DTrace,
> Predictive Self Healing and Award Winning ZFS. Get Solaris 10 NOW
> http://p.sf.net/sfu/solaris-dev2dev
> _______________________________________________
> mod-security-users mailing list
> mod-security-users at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
> Commercial ModSecurity Appliances, Rule Sets and Support:
> http://www.modsecurity.org/breach/index.html
>

From timlegge at gmail.com  Wed Feb 17 10:28:48 2010
From: timlegge at gmail.com (Timothy Legge)
Date: Wed, 17 Feb 2010 11:28:48 -0400
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] base
	rules phpids
In-Reply-To: <be95b6c51002170607x67a2af1cr36f9c45dc91eba4f@mail.gmail.com>
References: <be95b6c51002170523y3f715c46idd49cccb0a721359@mail.gmail.com>
	<8A1B4B015C52A54886DF15E9A97C7FB9F879075C@MONET.utopiasystems.net>
	<be95b6c51002170556y4cabf372i3083217fec6b9b60@mail.gmail.com>
	<8A1B4B015C52A54886DF15E9A97C7FB9F879075D@MONET.utopiasystems.net>
	<be95b6c51002170607x67a2af1cr36f9c45dc91eba4f@mail.gmail.com>
Message-ID: <be95b6c51002170728m3ebcdd19n3a1673610f008f62@mail.gmail.com>

Hi

I have tracked down in the regex what matches.  If I understand regex
at all it seems to be matching on

(?:\w{2,}\s*=\s*\d+[^&\w]\w+)

which matches a word of two or more characters followed by an equals
sign followed by digits.

So selections=5-O matches but selections="5-O" would not.

Should I simply tell our web developers that the values should have
quotes around them or is there a bigger issue that I am missing?

Tim


Hi

On Wed, Feb 17, 2010 at 10:02 AM, Ryan Barnett <Ryan.Barnett at breach.com> wrote:
> If you look in the audit log for transaction, the "data" field in the Message line will tell you what portion of the payload matched the regex.

It is matching on:

[data "selections=5-O"] and [data "selections=5-o"]
Message: Pattern match
"(?:\.\s*\w+\W*=)|(?:\W\s*(?:location|document)\s*\W[^({[;]+[({[;])|(?:\(\w+\?[:\w]+\))|(?:\w{2,}\s*=\s*\d+[^&\w]\w+)|(?:\]\s*\(\s*\w+)"
at REQUEST_BODY. [file
"/usr/local/apache2/conf/modsecurity/base_rules/modsecurity_crs_41_phpids_filters.conf"]
[line "123"] [id "phpids-23"] [msg "Detects JavaScript
location/document property access and window access obfuscation"]
[data "selections=5-O"] [severity "CRITICAL"] [tag "WEB_ATTACK"]
Message: Pattern match
"(?:\.\s*\w+\W*=)|(?:\W\s*(?:location|document)\s*\W[^({[;]+[({[;])|(?:\(\w+\?[:\w]+\))|(?:\w{2,}\s*=\s*\d+[^&\w]\w+)|(?:\]\s*\(\s*\w+)"
at REQUEST_BODY. [file
"/usr/local/apache2/conf/modsecurity/base_rules/modsecurity_crs_41_phpids_filters.conf"]
[line "123"] [id "phpids-23"] [msg "Detects JavaScript
location/document property access and window access obfuscation"]
[data "selections=5-o"] [severity "CRITICAL"] [tag "WEB_ATTACK"]
Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
"/usr/local/apache2/conf/modsecurity/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 40): Detects
JavaScript location/document property access and window access
obfuscation"]

From s.bhatia at qut.edu.au  Thu Feb 18 22:13:08 2010
From: s.bhatia at qut.edu.au (SAJAL BHATIA)
Date: Fri, 19 Feb 2010 13:13:08 +1000
Subject: [Owasp-modsecurity-core-rule-set] related to mlogc
Message-ID: <EF5541F04426FD40ACD8600636961B470F378CAE67@QUTEXMBX02.qut.edu.au>

Hi, 

I am using modsecurity version 2.5.12 on an apache version 2.2.14. When I access the apache server, the server logs are showing the activities but the logs in mlogc directory are NOT showing any activity. Here is a sample of mlogc-error.log file 

[Fri Feb 19 04:09:59 2010] [3] [28391/0] Configuring ModSecurity Audit Log Collector 2.5.12.
[Fri Feb 19 04:09:59 2010] [3] [28391/0] Delaying execution for 5000ms.
[Fri Feb 19 04:10:03 2010] [3] [28389/0] Queue file not found. New one will be created.

Can someone please tell what exactly is the problem with logging.

Thanks and Regards


----
Sajal Bhatia
Research Masters Student
QUT, Brisbane
AUSTRALIA

From listas at sapao.net  Tue Feb 23 16:59:40 2010
From: listas at sapao.net (Lucas Ferreira)
Date: Tue, 23 Feb 2010 18:59:40 -0300
Subject: [Owasp-modsecurity-core-rule-set] Core Rules version 2.0.5 and
	ModSecurity 2.5.11
Message-ID: <245770851002231359o4d199f0ete93bd2423992f2d7@mail.gmail.com>

Hello,

the CRS 2.0.5 Release notes say: "Must have ModSecurity 2.5.12 to use
the macro expansion in numeric operators."

My question is: Do the CRS 2.05 work with ModSecurity 2.5.11?

Thanks,

Lucas

-- 
Homo sapiens non urinat in ventum.

From Ryan.Barnett at breach.com  Wed Feb 24 09:21:55 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 24 Feb 2010 09:21:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-26)
 HTTP error code 501 are returned for localized Indonesian version of
 Firefox
In-Reply-To: <30532388.1267021159702.JavaMail.tomcat@modsec-apps.colo.breach.com>
References: <27383834.1259414718444.JavaMail.tomcat@modsec-apps.colo.breach.com>,
	<30532388.1267021159702.JavaMail.tomcat@modsec-apps.colo.breach.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F8790776@MONET.utopiasystems.net>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-26?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-26.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Fixed in CRS v2.0.6.  Due to the low attack frequency and high false positive rate, I removed REQUEST_HEADERS:User-Agent from inspection for these OS commanding rules.

> HTTP error code 501 are returned for localized Indonesian version of Firefox
> ----------------------------------------------------------------------------
>
>                 Key: CORERULES-26
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-26
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>          Components: False positive
>         Environment: Web Servers:
> 1. CentOS 5.4 on VirtualBox, using compiled Apache (2.2.14) annd compiled Modsecurity (2.1.7)
> 2. Fedora 10 on VirtualBox, using Apache RPM (2.2.11-2.fc10) and Modsecurity RPM (2.5.10-2.fc10)
> Web Browser:
> Firefox Localized Indonesian version, User-Agents:
> "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; id; rv:1.9.2b5pre) Gecko/20091126 Namoroka/3.6b5pre"
>            Reporter: Romi Hardiyanto
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> At least two localized Firefox are suffering from modsecurity_crs_40_generic_attacks.conf.
> Please see following newsgroup discussions:
> http://groups.google.com/group/mozilla.dev.l10n/browse_thread/thread/a165f75e2947d5ee
> I'm testing using
> - Firefox 3.6 (Localized version: Indonesia, nightly build) using following User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; id; rv:1.9.2b5pre) Gecko/20091126 Namoroka/3.6b5pre
> - Firefox 3.6 (Localized version: Indonesia) on other platforms (win32 and linux)
> - Released versions: Firefox 3.5, Firefox 3.0 (Localized version: Indonesia)
> - wget -U "Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; id)".
> Webserver systems tested are:
> 1. CentOS 5.4 on VirtualBox, using compiled Apache (2.2.14) annd compiled Modsecurity (2.1.7)
> 2. Fedora 10 on VirtualBox, using Apache RPM (2.2.11-2.fc10) and Modsecurity RPM (2.5.10-2.fc10)
> For both system, browsing with mentioned web browser, HTTP error code 501 is returned. Using English/French/Germany version of Firefox doesn't result this HTTP error.
> For system #1 (modsecurity 2.1.7):
> Rule id:950006 (line 105-108 in modsecurity_crs_40_generic_attacks.conf) is causing the problem.
> For system #2 (modsecurity 2.5.10):
> Rule id:958885 (line 254 in modsecurity_crs_40_generic_attacks.conf) is causing the problem. Romansh (locale code: rm) are also suffer from similar rule id:958894, and I suspect future localized Firefox with locale code "ps" will also suffer with rule id:958886.
> Workaround for 2.5.10 is to disable the rule in the configuration, workaround for modsecurity 2.17 is removing string "id" in the regular expression
> More info for Firefox/Mozilla locale codes that currently ships is here:
> - http://l10n.mozilla.org/dashboard/?tree=fx36x
> - http://l10n.mozilla.org/dashboard/?tree=fx35x
> - http://l10n.mozilla.org/dashboard/?tree=fennec10x
> And guidelines for Mozilla locale codes are on: https://wiki.mozilla.org/L10n:Simple_locale_names

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



From Ryan.Barnett at breach.com  Wed Feb 24 09:22:41 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 24 Feb 2010 09:22:41 -0500
Subject: [Owasp-modsecurity-core-rule-set] FW: [JIRA] Resolved:
 (CORERULES-32) SQL Injection rules should be case-insensitive
In-Reply-To: <4865822.1266925218666.JavaMail.tomcat@modsec-apps.colo.breach.com>
References: <1004708.1265552418429.JavaMail.tomcat@modsec-apps.colo.breach.com>,
	<4865822.1266925218666.JavaMail.tomcat@modsec-apps.colo.breach.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F8790777@MONET.utopiasystems.net>

     [ https://www.modsecurity.org/tracker/browse/CORERULES-32?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-32.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Fixed in v2.0.6

> SQL Injection rules should be case-insensitive
> ----------------------------------------------
>
>                 Key: CORERULES-32
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-32
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>    Affects Versions: 2.0.0
>         Environment: mod_security-2.5.12 Windows
>            Reporter: Tom Donovan
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> Rules in modsecurity_crs_41_sql_injection_attacks.conf should not be case-sensitive (t:lowercase).
> SQL language keywords are never case-sensitive.  Table names, column names, etc. vary by database whether they are case-sensitive.
> Example:
>    http://hostname/?;delete from myTable;              is denied by 959075
>    http://hostname/?;DELETE FROM myTable;       is not denied by 959075

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



From Ryan.Barnett at breach.com  Wed Feb 24 09:28:46 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 24 Feb 2010 09:28:46 -0500
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-34)
	@pmFromFile typo in rule ID 958297
In-Reply-To: <29487914.1266586518442.JavaMail.tomcat@modsec-apps.colo.breach.com>
References: <22234139.1266571939418.JavaMail.tomcat@modsec-apps.colo.breach.com>,
	<29487914.1266586518442.JavaMail.tomcat@modsec-apps.colo.breach.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F8790778@MONET.utopiasystems.net>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-34?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-34.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Fixed in v2.0.6

> @pmFromFile typo in rule ID 958297
> ----------------------------------
>
>                 Key: CORERULES-34
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-34
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>          Components: Configuration
>    Affects Versions: 2.0.0
>         Environment: Apache 2.2.14
> ModSecurity 2.5.12
> ModSecurity Core Rules 2.0.5
>            Reporter: Colin Watson
>            Assignee: Ryan Barnett
>            Priority: Low
>             Fix For: 2.0
>
>
> After upgrading to 2.0.5, Apache HTTPD would not start - syntax error warning.  In the optional rule set modsecurity_crs_42_comment_spam.conf at line 30:
> SecRule REQUEST_HEADERS:User-Agent "@pmFromFil modsecurity_42_comment_spam.data" \
>         "phase:2,rev:'2.0.5',t:none,t:lowercase,pass,nolog,auditlog,status:404,msg:'Common SPAM/Email Harvester crawler',id:'958297',tag:'AUTOMATION/MALICIOUS',severity:'2',setvar:'tx.msg=%{rule.msg}',setvar:tx.automation_score=+%{tx.warning_anomaly_score},setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:'tx.%{rule.id}-AUTOMATION/MALICIOUS-%{matched_var_name}=%{matched_var}'"
> I think "@pmFromFil" should be "@pmFromFile".

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



From Ryan.Barnett at breach.com  Wed Feb 24 09:29:14 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 24 Feb 2010 09:29:14 -0500
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-35)
 tx.restricted_headers variable isn't used anywhere in the rules by default
In-Reply-To: <8411356.1266586278446.JavaMail.tomcat@modsec-apps.colo.breach.com>
References: <1035953.1266575358429.JavaMail.tomcat@modsec-apps.colo.breach.com>,
	<8411356.1266586278446.JavaMail.tomcat@modsec-apps.colo.breach.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F8790779@MONET.utopiasystems.net>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-35?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-35.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Fixed in v2.0.6

> tx.restricted_headers variable isn't used anywhere in the rules by default
> --------------------------------------------------------------------------
>
>                 Key: CORERULES-35
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-35
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>          Components: Configuration
>    Affects Versions: 2.0.0
>         Environment: modsecurity 2.5.12, crs 2.0.5
>            Reporter: Artyom Davidov
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> The tx.restricted_headers variable from modsecurity_crs_10_config.conf isn't used in modsecurity_crs_30_http_policy.conf nor in any other .conf file
> It looks like modsecurity_crs_30_http_policy.conf is using hard coded values for SecRule REQUEST_HEADERS_NAMES instead of the ones supplied in the tx.restricted_headers variable.

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



From Ryan.Barnett at breach.com  Wed Feb 24 09:29:39 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 24 Feb 2010 09:29:39 -0500
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-36)
 Missing default action in outbound checks conf prevents operations with
 SecDefaultAction set to desruptive action.
In-Reply-To: <537240.1266925098452.JavaMail.tomcat@modsec-apps.colo.breach.com>
References: <27578708.1266720618428.JavaMail.tomcat@modsec-apps.colo.breach.com>,
	<537240.1266925098452.JavaMail.tomcat@modsec-apps.colo.breach.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F879077A@MONET.utopiasystems.net>

     [ https://www.modsecurity.org/tracker/browse/CORERULES-36?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-36.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Fixed in v2.0.6

> Missing default action in outbound checks conf prevents operations with SecDefaultAction set to desruptive action.
> ------------------------------------------------------------------------------------------------------------------
>
>                 Key: CORERULES-36
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-36
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>    Affects Versions: 2.0.0
>         Environment: modsecurity 2.5.12, crs 2.0.5
>            Reporter: Artyom Davidov
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> In modsecurity_crs_50_outbund.conf the SecRule which should speedup processing of phase4 checks is missing a default action option.
> As a result when setting SecDefaultAction in modsecurity_crs_10_config.conf to something other then default "phase:2,pass" setting will result in disruptive actions on almost every request.
> Also a skipAfter option refers to a non existing SecMarker END_OUTBOUD_CHECK (typo - missing N).
> In modsecurity_crs_50_outbound.conf file near the line 84
> SecRule RESPONSE_BODY "!@pmFromFile modsecurity_50_outbound.data" \
>         "phase:4,rev:'2.0.5',t:none,capture,t:urlDecodeUni,t:htmlEntityDecode,nolog,skipAfter:END_OUTBOUD_CHECK"
> should be changed to
> SecRule RESPONSE_BODY "!@pmFromFile modsecurity_50_outbound.data" \
>         "phase:4,rev:'2.0.5',t:none,capture,t:urlDecodeUni,t:htmlEntityDecode,pass,nolog,skipAfter:END_OUTBOUND_CHECK"
> to fix this issues.

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



From Ryan.Barnett at breach.com  Wed Feb 24 09:30:03 2010
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 24 Feb 2010 09:30:03 -0500
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-37)
 Missing chain action breaks content-type inspection rule logics
In-Reply-To: <1129253.1266924978445.JavaMail.tomcat@modsec-apps.colo.breach.com>
References: <11070332.1266858858434.JavaMail.tomcat@modsec-apps.colo.breach.com>,
	<1129253.1266924978445.JavaMail.tomcat@modsec-apps.colo.breach.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F879077B@MONET.utopiasystems.net>

     [ https://www.modsecurity.org/tracker/browse/CORERULES-37?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-37.
-----------------------------------

       Resolution: Fixed
    Fix Version/s: 2.0

Fixed in v2.0.6

> Missing chain action breaks content-type inspection rule logics
> ---------------------------------------------------------------
>
>                 Key: CORERULES-37
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-37
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: New
>          Components: Configuration
>    Affects Versions: 2.0.0
>         Environment: modsecurity 2.5.12, crs 2.0.5
>            Reporter: Artyom Davidov
>            Assignee: Ryan Barnett
>             Fix For: 2.0
>
>
> In modsecurity_crs_30_http_policy.conf at line 64 there is missing chain action, so the %{tx.allowed_request_content_type}" inspection SecRule is never executed.
> SecRule at line 64 should be changed from:
> SecRule REQUEST_HEADERS:Content-Type "^([^;\s]+)" "capture"
> to:
> SecRule REQUEST_HEADERS:Content-Type "^([^;\s]+)" "chain,capture"
> to fix this issue.

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



From listas at sapao.net  Wed Feb 24 16:08:55 2010
From: listas at sapao.net (Lucas Ferreira)
Date: Wed, 24 Feb 2010 18:08:55 -0300
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Unable to retrieve
	collection
Message-ID: <245770851002241308u790de07as454b046189ed6a36@mail.gmail.com>

Hello,

I am getting the following error several times for each client since I
upgraded the CRS to 2.0.5:

ModSecurity: Unable to retrieve collection (name "ip", key "<client IP>").
Use SecDataDir to define data directory first.

What does this mean? My config has "SecDataDir /tmp"

Thanks,

Lucas

-- 
Homo sapiens non urinat in ventum.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100224/d77df923/attachment.html 

From ard at 100.pfr.ru  Wed Feb 24 17:07:23 2010
From: ard at 100.pfr.ru (ard at 100.pfr.ru)
Date: Thu, 25 Feb 2010 01:07:23 +0300
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Unable to retrieve
 collection
Message-ID: <OF6E9EE793.4B84B477-ONC32576D4.0078E9C7-C32576D4.00798721@100.pfr.ru>



Hi Lucas!

>I am getting the following error several times for each client since I
>upgraded the CRS to 2.0.5:
>
>ModSecurity: Unable to retrieve collection (name "ip", key "<client IP>").
>Use SecDataDir to define data directory first.
>
>What does this mean? My config has "SecDataDir /tmp"

Does your config has "SecTmpDir" variable set to some directory?

wbr,
Artyom


From listas at sapao.net  Wed Feb 24 17:08:53 2010
From: listas at sapao.net (Lucas Ferreira)
Date: Wed, 24 Feb 2010 19:08:53 -0300
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Unable to
	retrieve collection
In-Reply-To: <OF6E9EE793.4B84B477-ONC32576D4.0078E9C7-C32576D4.00798721@100.pfr.ru>
References: <OF6E9EE793.4B84B477-ONC32576D4.0078E9C7-C32576D4.00798721@100.pfr.ru>
Message-ID: <245770851002241408k40d4e273x99f8106eb6fc2862@mail.gmail.com>

Hello Artyom,

Yes, they are set to the same directory. Is this a problem?

Thanks,

Lucas

On Wed, Feb 24, 2010 at 19:07, <ard at 100.pfr.ru> wrote:

>
>
> Hi Lucas!
>
> >I am getting the following error several times for each client since I
> >upgraded the CRS to 2.0.5:
> >
> >ModSecurity: Unable to retrieve collection (name "ip", key "<client IP>").
> >Use SecDataDir to define data directory first.
> >
> >What does this mean? My config has "SecDataDir /tmp"
>
> Does your config has "SecTmpDir" variable set to some directory?
>
> wbr,
> Artyom
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Homo sapiens non urinat in ventum.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100224/e99b8711/attachment.html 

From ard at 100.pfr.ru  Wed Feb 24 17:23:11 2010
From: ard at 100.pfr.ru (ard at 100.pfr.ru)
Date: Thu, 25 Feb 2010 01:23:11 +0300
Subject: [Owasp-modsecurity-core-rule-set] Ha: Re: ModSecurity: Unable to
 retrieve collection
In-Reply-To: <245770851002241408k40d4e273x99f8106eb6fc2862@mail.gmail.com>
Message-ID: <OF33E6EB67.95616DEE-ONC32576D4.007AE8A9-C32576D4.007AF931@100.pfr.ru>



> Hello Artyom,
>
> Yes, they are set to the same directory. Is this a problem?

No it isn't, but you have to make sure that both of this variables point
to the directory writeable by webserver user.
Also you can try to move them to the place before the IP collection
creation
rule to make sure they already present at time when Global and IP
collections
are initiated.

Try to put put them temporary at top of modsecurity_crs_10_config.conf, to
see if this helps.

wbr,
Artyom



From listas at sapao.net  Wed Feb 24 18:29:55 2010
From: listas at sapao.net (Lucas Ferreira)
Date: Wed, 24 Feb 2010 20:29:55 -0300
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Unable to
	retrieve collection
In-Reply-To: <OF0A806DFC.C83CC83B-ONC32576D4.0079D9FA-C32576D4.007AD02D@100.pfr.ru>
References: <245770851002241408k40d4e273x99f8106eb6fc2862@mail.gmail.com> 
	<OF0A806DFC.C83CC83B-ONC32576D4.0079D9FA-C32576D4.007AD02D@100.pfr.ru>
Message-ID: <245770851002241529s419b25b9y812130ddb73f6b5e@mail.gmail.com>

This seams to solve the problem, thanks.

I had to put my local configs before the modsecurity_crs_10_config.conf
file.

Thanks,

Lucas

2010/2/24 <ard at 100.pfr.ru>

>
>
> lucas.ferreira at gmail.com ???????? 25.02.2010 01:08:53:
>
> > Hello Artyom,
> >
> > Yes, they are set to the same directory. Is this a problem?
>
> No it isn't, but you have to make sure that both of this variables point
> to the directory writeable by webserver user.
> Also you can try to move them to the place before the IP collection
> creation
> rule to make sure they already present at time when Global and IP
> collections
> are initiated.
>
> Try to put put them temporary at top of modsecurity_crs_10_config.conf, to
> see if this helps.
>
> wbr,
> Artyom
>



-- 
Homo sapiens non urinat in ventum.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100224/97f2fb88/attachment.html 

From ryan.barnett at breach.com  Fri Feb 26 12:50:13 2010
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 26 Feb 2010 12:50:13 -0500
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Unable to
	retrieve collection
In-Reply-To: <245770851002241529s419b25b9y812130ddb73f6b5e@mail.gmail.com>
References: <245770851002241408k40d4e273x99f8106eb6fc2862@mail.gmail.com>
	<OF0A806DFC.C83CC83B-ONC32576D4.0079D9FA-C32576D4.007AD02D@100.pfr.ru>
	<245770851002241529s419b25b9y812130ddb73f6b5e@mail.gmail.com>
Message-ID: <201002261250.13702.ryan.barnett@breach.com>

On Wednesday 24 February 2010 18:29:55 Lucas Ferreira wrote:
> This seams to solve the problem, thanks.
> 
> I had to put my local configs before the modsecurity_crs_10_config.conf
> file.
> 

Good point - all of your local main Mod configs should come before the CRS 10 config file.


From chris.datfung at gmail.com  Sat Feb 27 15:13:35 2010
From: chris.datfung at gmail.com (Chris Datfung)
Date: Sat, 27 Feb 2010 22:13:35 +0200
Subject: [Owasp-modsecurity-core-rule-set] whitelisting a parameter
Message-ID: <4c9cc6791002271213t3fa1da25ga7cc2b97dca329e4@mail.gmail.com>

I'm getting a large number of false positives in various requests due to the
encrypted value of the ViewState parameter. I can whitelist the false
positives one by one via SecRuleRemoveById, but instead of waiting for the
next false positive (I have blocking enabled) I want to put any rules that
want to block due to a suspicious ViewState parameter into DetectionOnly
mode and still have the rest of the request in blocking mode. Is this
possible?

Thanks,
  Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100227/5b71ffe9/attachment.html 

