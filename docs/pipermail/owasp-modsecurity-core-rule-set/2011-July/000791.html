<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] sql injection and xss bypassing 2.2.0 core-rule-set
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20sql%20injection%20and%20xss%0A%20bypassing%202.2.0%20core-rule-set&In-Reply-To=CAGF-nS4jR48iz9jvFMVzLsm-r0qGxOdtKRu%3D22ffXyrxJSMtVQ%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000790.html">
   <LINK REL="Next"  HREF="000792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] sql injection and xss bypassing 2.2.0 core-rule-set</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20sql%20injection%20and%20xss%0A%20bypassing%202.2.0%20core-rule-set&In-Reply-To=CAGF-nS4jR48iz9jvFMVzLsm-r0qGxOdtKRu%3D22ffXyrxJSMtVQ%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] sql injection and xss bypassing 2.2.0 core-rule-set">RBarnett at trustwave.com
       </A><BR>
    <I>Mon Jul 11 08:10:14 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000790.html">[Owasp-modsecurity-core-rule-set] sql injection and xss bypassing 2.2.0 core-rule-set
</A></li>
        <LI>Next message: <A HREF="000792.html">[Owasp-modsecurity-core-rule-set] Problem with	modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#791">[ date ]</a>
              <a href="thread.html#791">[ thread ]</a>
              <a href="subject.html#791">[ subject ]</a>
              <a href="author.html#791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As Josh mentioned, if you test these payloads against the CRS demo
(<A HREF="http://www.modsecurity.org/demo/crs-demo.html">http://www.modsecurity.org/demo/crs-demo.html</A>) you will see that these
requests are flagged.  Some of the detection was done by generic detection
rules that you may not have had activated (check the experimental
directory).

Additionally, as a result of the ModSecurity SQL Injection Challenge
(<A HREF="http://www.modsecurity.org/demo/challenge.html">http://www.modsecurity.org/demo/challenge.html</A>) we are making significant
updates to the SQL Injection detection rules within ModSecurity.

We will be releasing a CRS updating this week.



--
Ryan Barnett
Senior Security Researcher
Trustwave - SpiderLabs



On 7/10/11 11:20 AM, &quot;Alexandre Biancalana&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">biancalana at gmail.com</A>&gt; wrote:

&gt;<i>Hi list,
</I>&gt;<i>
</I>&gt;<i> I've configured mod_security 2.6.0 with modsecurity-crs_2.2.0 rules
</I>&gt;<i>in paranoid mode.
</I>&gt;<i>
</I>&gt;<i> Looking at apache logs I've perceived that some tries of sql
</I>&gt;<i>injection and xss aren't blocked by mod_security even in paranoid
</I>&gt;<i>mode.
</I>&gt;<i>
</I>&gt;<i> Follow my mod_security_crs_10_config.conf:
</I>&gt;<i>
</I>&gt;<i>SecComponentSignature &quot;core ruleset/2.2.0&quot;
</I>&gt;<i>SecRuleEngine On
</I>&gt;<i>SecDefaultAction &quot;phase:2,pass,log&quot;
</I>&gt;<i>SecAction
</I>&gt;<i>&quot;phase:1,id:'981206',t:none,nolog,pass,setvar:tx.anomaly_score_blocking=on
</I>&gt;<i>&quot;
</I>&gt;<i>SecAction &quot;phase:1,id:'981207',t:none,nolog,pass, \
</I>&gt;<i>setvar:tx.critical_anomaly_score=10, \
</I>&gt;<i>setvar:tx.error_anomaly_score=4, \
</I>&gt;<i>setvar:tx.warning_anomaly_score=3, \
</I>&gt;<i>setvar:tx.notice_anomaly_score=2&quot;
</I>&gt;<i>SecAction
</I>&gt;<i>&quot;phase:1,id:'981208',t:none,nolog,pass,setvar:tx.inbound_anomaly_score_lev
</I>&gt;<i>el=5&quot;
</I>&gt;<i>SecAction
</I>&gt;<i>&quot;phase:1,id:'981209',t:none,nolog,pass,setvar:tx.outbound_anomaly_score_le
</I>&gt;<i>vel=4&quot;
</I>&gt;<i>SecAction
</I>&gt;<i>&quot;phase:1,id:'981210',t:none,nolog,pass,setvar:tx.paranoid_mode=1&quot;
</I>&gt;<i>SecAction
</I>&gt;<i>&quot;phase:1,id:'981211',t:none,nolog,pass,setvar:tx.max_num_args=255&quot;
</I>&gt;<i>SecAction &quot;phase:1,id:'981212',t:none,nolog,pass, \
</I>&gt;<i>setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \
</I>&gt;<i>setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded
</I>&gt;<i>multipart/form-data text/xml application/xml application/x-amf', \
</I>&gt;<i>setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \
</I>&gt;<i>setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/ .backup/
</I>&gt;<i>.bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/
</I>&gt;<i>.csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .ht
</I>&gt;<i>r/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/
</I>&gt;<i>.old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/
</I>&gt;<i>.sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webin
</I>&gt;<i>fo/ .xsd/ .xsx/', \
</I>&gt;<i>setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
</I>&gt;<i>/Content-Range/ /Translate/ /via/ /if/'&quot;
</I>&gt;<i>SecRule REQUEST_HEADERS:Content-Type &quot;text/xml&quot; \
</I>&gt;<i>        &quot;chain,phase:1,id:'981053',t:none,t:lowercase,pass,nolog&quot;
</I>&gt;<i>        SecRule REQBODY_PROCESSOR &quot;!@streq XML&quot;
</I>&gt;<i>&quot;ctl:requestBodyProcessor=XML&quot;
</I>&gt;<i>SecRule REQUEST_HEADERS:User-Agent &quot;^(.*)$&quot;
</I>&gt;<i>&quot;phase:1,id:'981217',t:none,pass,nolog,t:sha1,t:hexEncode,setvar:tx.ua_has
</I>&gt;<i>h=%{matched_var}&quot;
</I>&gt;<i>SecRule REQUEST_HEADERS:x-forwarded-for
</I>&gt;<i>&quot;^\b(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\b&quot;
</I>&gt;<i>&quot;phase:1,id:'981225',t:none,pass,nolog,capture,setvar:tx.real_ip=%{tx.1}&quot;
</I>&gt;<i>SecRule &amp;TX:REAL_IP &quot;!@eq 0&quot;
</I>&gt;<i>&quot;phase:1,id:'981226',t:none,pass,nolog,initcol:global=global,initcol:ip=%{
</I>&gt;<i>tx.real_ip}_%{tx.ua_hash}&quot;
</I>&gt;<i>SecRule &amp;TX:REAL_IP &quot;@eq 0&quot;
</I>&gt;<i>&quot;phase:1,id:'981218',t:none,pass,nolog,initcol:global=global,initcol:ip=%{
</I>&gt;<i>remote_addr}_%{tx.ua_hash}&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Here are some examples of request that aren't blocked:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>/search.php?idS=c4ca4238a0b923820dcc509a6f75849b%27%20or%20%28sleep%284%29
</I>&gt;<i>%2b1%29%20limit%201%20--
</I>&gt;<i>%20
</I>&gt;<i>
</I>&gt;<i>/album.php?idalbum=35&amp;idfoto=163&amp;idsel=1%3C%00ScRiPt%20%0d%0a%3Eprompt%289
</I>&gt;<i>73555%29%3C%2fScRiPt%3E
</I>&gt;<i>
</I>&gt;<i>/stats.php?idJ=%21%28%28%29%26%26%21%7c*%7c*%7c
</I>&gt;<i>
</I>&gt;<i>I added the word &quot;sleep&quot; to modsecurity_41_sql_injection_attacks.data
</I>&gt;<i>and that starts to stop some requests, but not all.
</I>&gt;<i>
</I>&gt;<i>That is suppose to happen ?
</I>&gt;<i>
</I>&gt;<i>Best Regards,
</I>&gt;<i>
</I>&gt;<i>Alexandre
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000790.html">[Owasp-modsecurity-core-rule-set] sql injection and xss bypassing 2.2.0 core-rule-set
</A></li>
	<LI>Next message: <A HREF="000792.html">[Owasp-modsecurity-core-rule-set] Problem with	modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#791">[ date ]</a>
              <a href="thread.html#791">[ thread ]</a>
              <a href="subject.html#791">[ subject ]</a>
              <a href="author.html#791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
