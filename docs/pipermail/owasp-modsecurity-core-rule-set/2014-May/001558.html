<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] problems with upload jpg
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20problems%20with%20upload%20jpg&In-Reply-To=%3CCFA20BAC.F4E52%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001557.html">
   <LINK REL="Next"  HREF="001560.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] problems with upload jpg</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20problems%20with%20upload%20jpg&In-Reply-To=%3CCFA20BAC.F4E52%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] problems with upload jpg">RBarnett at trustwave.com
       </A><BR>
    <I>Wed May 21 11:52:50 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001557.html">[Owasp-modsecurity-core-rule-set] problems with upload jpg
</A></li>
        <LI>Next message: <A HREF="001560.html">[Owasp-modsecurity-core-rule-set] problems with upload jpg
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1558">[ date ]</a>
              <a href="thread.html#1558">[ thread ]</a>
              <a href="subject.html#1558">[ subject ]</a>
              <a href="author.html#1558">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Edit this line in the OWASP CRS 10 setup conf file -

<A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/modsecurity_crs_10_setup.conf.example#L279">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/modsecurity_crs_10_setup.conf.example#L279</A>

Add in the allowed content type you need.

Ryan Barnett
Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;

From: Ilyass Kaouam &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&gt;&gt;
Reply-To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&gt;&gt;
Date: Wednesday, May 21, 2014 7:26 AM
To: Jerome Athias &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">athiasjerome at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">athiasjerome at gmail.com</A>&gt;&gt;
Cc: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] problems with upload jpg

Thank you for you help.
I'm understand &quot;fhamt&quot;  :)

But i don't know hwo define a proper whitelist ? :(

please help me.


2014-05-21 12:08 GMT+01:00 Jerome Athias &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">athiasjerome at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">athiasjerome at gmail.com</A>&gt;&gt;:
You are not setting the proper Content-Type in your XMLHttpRequest,
you should use

setRequestHeader('Content-Type', 'image/jpeg');
in this case

and define a proper whitelist

famti?

2014-05-21 13:41 GMT+04:00 Ilyass Kaouam &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&gt;&gt;:
&gt;<i>
</I>&gt;<i> Hello
</I>&gt;<i> I've a problems when i'd like upload a jpg file.
</I>&gt;<i> how i can allow upload some type of file like : jpg, pdf ...
</I>&gt;<i>
</I>&gt;<i> this is the output of modsec_audit.log
</I>&gt;<i>
</I>&gt;<i> --a7f42c69-A--
</I>&gt;<i>
</I>&gt;<i> [21/May/2014:11:35:27 +0200] U3xzXX8AAAEAACYTAbUAAAAG xx.xx.xx.xx 60416
</I>&gt;<i> xx.xx.xx.xx 80
</I>&gt;<i>
</I>&gt;<i> --a7f42c69-B--
</I>&gt;<i>
</I>&gt;<i> POST /upload-useravatar?qqfile=xxxx.jpg HTTP/1.1
</I>&gt;<i>
</I>&gt;<i> Host: www.xxxxxx.com&lt;<A HREF="http://www.xxxxxx.com">http://www.xxxxxx.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i>
</I>&gt;<i> Content-Length: 159959
</I>&gt;<i>
</I>&gt;<i> Origin: <A HREF="http://www.xxxxxx.com">http://www.xxxxxx.com</A>
</I>&gt;<i>
</I>&gt;<i> X-Requested-With: XMLHttpRequest
</I>&gt;<i>
</I>&gt;<i> X-File-Name: xxxx.jpg
</I>&gt;<i>
</I>&gt;<i> User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2)
</I>&gt;<i> AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.137 Safari/537.36
</I>&gt;<i>
</I>&gt;<i> Content-Type: application/octet-stream
</I>&gt;<i>
</I>&gt;<i> Accept: */*
</I>&gt;<i>
</I>&gt;<i> Referer: <A HREF="http://www.xxxxxx.com/user">http://www.xxxxxx.com/user</A>
</I>&gt;<i>
</I>&gt;<i> Accept-Encoding: gzip,deflate,sdch
</I>&gt;<i>
</I>&gt;<i> Accept-Language: fr-FR,fr;q=0.8,en-US;q=0.6,en;q=0.4,ar;q=0.2
</I>&gt;<i>
</I>&gt;<i> Cookie: JSESSIONID=5B361D7404F645627AFB171BBA0B3F8B;
</I>&gt;<i> __utma=111125463.1873502041.1396101474.1400599956.1400664807.23;
</I>&gt;<i> __utmb=111125463.4.10.1400664807; __utmc=111125463;
</I>&gt;<i> __utmz=111125463.1396101474.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --a7f42c69-F--
</I>&gt;<i>
</I>&gt;<i> HTTP/1.1 403 Forbidden
</I>&gt;<i>
</I>&gt;<i> Content-Length: 219
</I>&gt;<i>
</I>&gt;<i> Connection: close
</I>&gt;<i>
</I>&gt;<i> Content-Type: text/html; charset=iso-8859-1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --a7f42c69-E--
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --a7f42c69-H--
</I>&gt;<i>
</I>&gt;<i> Message: Access denied with code 403 (phase 1). Match of &quot;rx
</I>&gt;<i> ^%{tx.allowed_request_content_type}$&quot; against &quot;TX:0&quot; required. [file
</I>&gt;<i> &quot;/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_30_http_policy.conf&quot;]
</I>&gt;<i> [line &quot;64&quot;] [id &quot;960010&quot;] [rev &quot;2&quot;] [msg &quot;Request content type is not
</I>&gt;<i> allowed by policy&quot;] [data &quot;application/octet-stream&quot;] [severity &quot;CRITICAL&quot;]
</I>&gt;<i> [ver &quot;OWASP_CRS/2.2.9&quot;] [maturity &quot;9&quot;] [accuracy &quot;9&quot;] [tag
</I>&gt;<i> &quot;OWASP_CRS/POLICY/ENCODING_NOT_ALLOWED&quot;] [tag &quot;WASCTC/WASC-20&quot;] [tag
</I>&gt;<i> &quot;OWASP_TOP_10/A1&quot;] [tag &quot;OWASP_AppSensor/EE2&quot;] [tag &quot;PCI/12.1&quot;]
</I>&gt;<i>
</I>&gt;<i> Action: Intercepted (phase 1)
</I>&gt;<i>
</I>&gt;<i> Stopwatch: 1400664925455373 1654382 (- - -)
</I>&gt;<i>
</I>&gt;<i> Stopwatch2: 1400664925455373 1654382; combined=371, p1=195, p2=0, p3=0,
</I>&gt;<i> p4=0, p5=105, sr=47, sw=1, l=0, gc=70
</I>&gt;<i>
</I>&gt;<i> Response-Body-Transformed: Dechunked
</I>&gt;<i>
</I>&gt;<i> Producer: ModSecurity for Apache/2.7.3 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;<i> OWASP_CRS/2.2.9.&lt;<A HREF="http://2.2.9.">http://2.2.9.</A>&gt;
</I>&gt;<i>
</I>&gt;<i> Server: Apache
</I>&gt;<i>
</I>&gt;<i> Engine-Mode: &quot;ENABLED&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --a7f42c69-Z-
</I>&gt;<i>
</I>&gt;<i> thank you
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140521/65303f36/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140521/65303f36/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001557.html">[Owasp-modsecurity-core-rule-set] problems with upload jpg
</A></li>
	<LI>Next message: <A HREF="001560.html">[Owasp-modsecurity-core-rule-set] problems with upload jpg
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1558">[ date ]</a>
              <a href="thread.html#1558">[ thread ]</a>
              <a href="subject.html#1558">[ subject ]</a>
              <a href="author.html#1558">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
