From paolo.luiseit at gmail.com  Sun Feb  1 10:39:47 2015
From: paolo.luiseit at gmail.com (Paolo Luise)
Date: Sun, 1 Feb 2015 11:39:47 +0100
Subject: [Owasp-modsecurity-core-rule-set] Block upload file (jsp,php)
Message-ID: <CAPF6YCk6gf4AeDzHvmLBveZiaQKMpTjXJHaCJ1h2C7s5MSTz2Q@mail.gmail.com>

Hi Ilyass,
the rule 960035 in the file modsecurity_crs_30_http_policy.conf, which is
the one that uses the restricted_extensions variable, bases its match on
the REQUEST_BASENAME, that is "the filename part of REQUEST_FILENAME" (
https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BASENAME
).

File uploads are handled in the body of the POST request, and then the
basename is that of the script which orchestrates the upload.

I would suggest you to intercept your upload request with a tool such as
ZAP by OWASP, and identify the process of the uploads in your application.

For example, you may find a request like this:

POST http://mysite/upload.php HTTP/1.1
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:34.0) Gecko/20100101
Firefox/34.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Referer: http://mysite/contentadmin.php
Content-Length: 15748
Content-Type: multipart/form-data;
boundary=---------------------------100259790820425171131264960
Host: mysite

The content-type is multipart so, in the body, there will be more than one
separated by the boundary identifier. Among these, there is the one
referred to a png image:

-----------------------------100259790820425171131264960
Content-Disposition: form-data; name="upload"; filename="waf.png"
Content-Type: image/png

In this case you should have to write rules acting on phase 2 body content,
checking the filename and content-type headers.

Hope this could be of any help for you

Paolo


Hi ,
>
> How can I block upload a specific file such as (.jsp/.php)
> I configured this rule :
> /etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_30_http_policy.conf
>
> with this :
>
> SecAction \
>   "id:'900012', \
>
> phase:1,
> \
>   t:none, \
>
>
>   setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \
>
>
>
>
> setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json',
> \
>   setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \
>
>
>   setvar:'tx.restricted_extensions=.asa/ .jsp/ .asax/ .ascx/ .axd/ .backup/
> .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/
> .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ \
> .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
> .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/
> .vsdisco/ .webinfo/ .xsd/ .xsx/', \
>   setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
> /Content-Range/ /Translate/ /via/ /if/', \
>
>   nolog, \
>
>
>   pass
>
>
> ?But it's don't stop upload .jsp file.
>
> Have you any idea ?
>
> Thank you?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150201/0c979474/attachment.html>

From ilyassikai at gmail.com  Mon Feb  2 10:39:35 2015
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Mon, 2 Feb 2015 10:39:35 +0000
Subject: [Owasp-modsecurity-core-rule-set]
	Owasp-modsecurity-core-rule-set Digest, Vol 70, Issue 1
In-Reply-To: <mailman.11.1422792004.24342.owasp-modsecurity-core-rule-set@lists.owasp.org>
References: <mailman.11.1422792004.24342.owasp-modsecurity-core-rule-set@lists.owasp.org>
Message-ID: <CAMmziWdnDCYiVNR-gR28YX8TEPouuNvS9yvtOTVFy56LU3uvtQ@mail.gmail.com>

Thak you Paolo :)
I'll tried this (y)


2015-02-01 12:00 GMT+00:00 <
owasp-modsecurity-core-rule-set-request at lists.owasp.org>:

> Send Owasp-modsecurity-core-rule-set mailing list submissions to
>         owasp-modsecurity-core-rule-set at lists.owasp.org
>
> To subscribe or unsubscribe via the World Wide Web, visit
>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> or, via email, send a message with subject or body 'help' to
>         owasp-modsecurity-core-rule-set-request at lists.owasp.org
>
> You can reach the person managing the list at
>         owasp-modsecurity-core-rule-set-owner at lists.owasp.org
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-modsecurity-core-rule-set digest..."
>
>
> Today's Topics:
>
>    1. Re: Block upload file (jsp,php) (Paolo Luise)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Sun, 1 Feb 2015 11:39:47 +0100
> From: Paolo Luise <paolo.luiseit at gmail.com>
> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Block upload file
>         (jsp,php)
> Message-ID:
>         <
> CAPF6YCk6gf4AeDzHvmLBveZiaQKMpTjXJHaCJ1h2C7s5MSTz2Q at mail.gmail.com>
> Content-Type: text/plain; charset="utf-8"
>
> Hi Ilyass,
> the rule 960035 in the file modsecurity_crs_30_http_policy.conf, which is
> the one that uses the restricted_extensions variable, bases its match on
> the REQUEST_BASENAME, that is "the filename part of REQUEST_FILENAME" (
>
> https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BASENAME
> ).
>
> File uploads are handled in the body of the POST request, and then the
> basename is that of the script which orchestrates the upload.
>
> I would suggest you to intercept your upload request with a tool such as
> ZAP by OWASP, and identify the process of the uploads in your application.
>
> For example, you may find a request like this:
>
> POST http://mysite/upload.php HTTP/1.1
> User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:34.0) Gecko/20100101
> Firefox/34.0
> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> Accept-Language: en-US,en;q=0.5
> Referer: http://mysite/contentadmin.php
> Content-Length: 15748
> Content-Type: multipart/form-data;
> boundary=---------------------------100259790820425171131264960
> Host: mysite
>
> The content-type is multipart so, in the body, there will be more than one
> separated by the boundary identifier. Among these, there is the one
> referred to a png image:
>
> -----------------------------100259790820425171131264960
> Content-Disposition: form-data; name="upload"; filename="waf.png"
> Content-Type: image/png
>
> In this case you should have to write rules acting on phase 2 body content,
> checking the filename and content-type headers.
>
> Hope this could be of any help for you
>
> Paolo
>
>
> Hi ,
> >
> > How can I block upload a specific file such as (.jsp/.php)
> > I configured this rule :
> > /etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_30_http_policy.conf
> >
> > with this :
> >
> > SecAction \
> >   "id:'900012', \
> >
> > phase:1,
> > \
> >   t:none, \
> >
> >
> >   setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \
> >
> >
> >
> >
> >
> setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json',
> > \
> >   setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \
> >
> >
> >   setvar:'tx.restricted_extensions=.asa/ .jsp/ .asax/ .ascx/ .axd/
> .backup/
> > .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/
> > .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ \
> > .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
> > .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/
> > .vsdisco/ .webinfo/ .xsd/ .xsx/', \
> >   setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
> > /Content-Range/ /Translate/ /via/ /if/', \
> >
> >   nolog, \
> >
> >
> >   pass
> >
> >
> > ?But it's don't stop upload .jsp file.
> >
> > Have you any idea ?
> >
> > Thank you?
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: <
> http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150201/0c979474/attachment-0001.html
> >
>
> ------------------------------
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
> End of Owasp-modsecurity-core-rule-set Digest, Vol 70, Issue 1
> **************************************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150202/0266f59c/attachment.html>

From aniyan.rajan6 at gmail.com  Mon Feb  9 07:04:29 2015
From: aniyan.rajan6 at gmail.com (Aniyan Rajan)
Date: Mon, 09 Feb 2015 12:34:29 +0530
Subject: [Owasp-modsecurity-core-rule-set] block CONNECT
Message-ID: <54D85BFD.9050809@gmail.com>

Hello,


I am getting the following in the apache/error.log. There are plenty of 
such errors coming in daily. So I would like to block them. They are 
from different ips. So fail2ban is not a good option. They come from 
"mail2000.com.tw". How can I block this domain from trying to CONNECT ?


[Sat Feb 07 09:52:21 2015] [error] [client 118.165.130.55] ModSecurity: 
Access denied with code 403 (phase 1). Match of "rx 
^(?:(?:[a-z]{3,10}\\\\s+(?:\\\\w{3,7}?://[\\\\w\\\\-\\\\./]*(?::\\\\d+)?)?/[^?#]*(?:\\\\?[^#\\\\s]*)?(?:#[\\\\S]*)?|connect 
(?:\\\\d{1,3}\\\\.){3}\\\\d{1,3}\\\\.?(?::\\\\d+)?|options 
\\\\*)\\\\s+[\\\\w\\\\./]+|get 
/[^?#]*(?:\\\\?[^#\\\\s]*)?(?:#[\\\\S]*)?)$" against "REQUEST_LINE" 
required. [file 
"/usr/share/modsecurity-crs/activated_rules/modsecurity_crs_20_protocol_violations.conf"] 
[line "37"] [id "960911"] [rev "2.2.5"] [msg "Invalid HTTP Request 
Line"] [data "CONNECT mx0.mail2000.com.tw:25 HTTP/1.0"] [severity 
"WARNING"] [tag 
"https://www.owasp.org/index.php/ModSecurity_CRS_RuleID-960911"] [tag 
"http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.2.1"] [tag 
"RULE_MATURITY/8"] [tag "RULE_ACCURACY/8"] [hostname 
"mx0.mail2000.com.tw"] [uri "/"] [unique_id "VNXgVX8AAAEAAHqycsoAAAAC"]


I tried the following in /etc/apache2/sites-available/default. Will this 
work ?
<VirtualHost *:80>
.....
.....
</VirtualHost>

<Files *>
<LimitExcept GET POST>
deny from all
</LimitExcept>


Thanks.

From reginal.laurent at gmail.com  Mon Feb  9 08:22:47 2015
From: reginal.laurent at gmail.com (Reginal Laurent)
Date: Mon, 9 Feb 2015 09:22:47 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Rules - Windows
	server 2008 R2
Message-ID: <CAFMMpY9fhT9NpRXMA7qxrykVepiZiu22U2xS2-p_uvVJqmDw2A@mail.gmail.com>

Hello,

I have a Windows Server 2008 R2 running Apache2 and PHP. ?I have configured
Modsecurity for protection against Injection SQL or other attacks.
However, when i scanned vulnerabilities on my server, i still have
Injection SQL vulnerabilities and other based attacks. Is it normal ? Could
you help me ?

Thank you for feedback.

-- 

Cordialement,
-------------------------

R?ginal LAURENT
Ing?nieur R?seaux et S?curit? des SI
CCNA - ID: CSCO12321512
skype : laurent.reginal
Site perso : reginallaurent.info
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150209/7bb6e1c1/attachment.html>

From CSanders at trustwave.com  Mon Feb  9 19:40:01 2015
From: CSanders at trustwave.com (Chaim Sanders)
Date: Mon, 9 Feb 2015 19:40:01 +0000
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Rules -
	Windows	server 2008 R2
In-Reply-To: <CAFMMpY9fhT9NpRXMA7qxrykVepiZiu22U2xS2-p_uvVJqmDw2A@mail.gmail.com>
References: <CAFMMpY9fhT9NpRXMA7qxrykVepiZiu22U2xS2-p_uvVJqmDw2A@mail.gmail.com>
Message-ID: <F684BDD553BAF1479F5380EDAD3BE371F7B891@SKYMB1.trustwave.com>

Not being able to see your configuration, I am assuming that you do not have your ModSecurity instance in blocking mode. I suggest you check the SecRuleEngine configuration option (https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleEngine) and also ensure that ModSecurity is working properly. Unless this is a very novel SQL injection attack (in which case we can amend the rules to detect it) it should be detected by ModSecurity. Try pasting your payload in our demo site to ensure it will be detected by stock CRS rules (http://modsecurity.org/crs-demo.html). Hope this helps!


Chaim Sanders
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Reginal Laurent
Sent: Monday, February 9, 2015 3:23 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Rules - Windows server 2008 R2

Hello,

I have a Windows Server 2008 R2 running Apache2 and PHP. ?I have configured Modsecurity for protection against Injection SQL or other attacks.
However, when i scanned vulnerabilities on my server, i still have Injection SQL vulnerabilities and other based attacks. Is it normal ? Could you help me ?

Thank you for feedback.

--

Cordialement,
-------------------------

R?ginal LAURENT
Ing?nieur R?seaux et S?curit? des SI
CCNA - ID: CSCO12321512
skype : laurent.reginal
Site perso : reginallaurent.info

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150209/8a484f0b/attachment.html>

From reginal.laurent at gmail.com  Wed Feb 11 17:56:43 2015
From: reginal.laurent at gmail.com (Reginal Laurent)
Date: Wed, 11 Feb 2015 18:56:43 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Rules - Windows
 server 2008 R2
In-Reply-To: <F684BDD553BAF1479F5380EDAD3BE371F7B891@SKYMB1.trustwave.com>
References: <CAFMMpY9fhT9NpRXMA7qxrykVepiZiu22U2xS2-p_uvVJqmDw2A@mail.gmail.com>
	<F684BDD553BAF1479F5380EDAD3BE371F7B891@SKYMB1.trustwave.com>
Message-ID: <CAFMMpY8DO89oFc=khEMoRVZ3H9XA7VdR5XZabfbi27u-wm9mGA@mail.gmail.com>

Hello,


Thank you for your feedback. It was that, i did not have my ModSecurity
instance on ON. It was on DectectionOnly.

Now, i have another problem with sites running on Symphony 2. Do you have
specific rules for this framework ? A lot of links to web pages are not
available when ModSecurity intance is ON, when i change it to DetectionOnly
the web application is 100% available. Please, could you help with that ?
The errors regarding "SQL injection" are not true i think. And the
mentioned errors by ModSecurity are not so detailed.

Reginal



On Mon, Feb 9, 2015 at 8:40 PM, Chaim Sanders <CSanders at trustwave.com>
wrote:

>  Not being able to see your configuration, I am assuming that you do not
> have your ModSecurity instance in blocking mode. I suggest you check the
> SecRuleEngine configuration option (
> https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleEngine)
> and also ensure that ModSecurity is working properly. Unless this is a very
> novel SQL injection attack (in which case we can amend the rules to detect
> it) it should be detected by ModSecurity. Try pasting your payload in our
> demo site to ensure it will be detected by stock CRS rules (
> http://modsecurity.org/crs-demo.html). Hope this helps!
>
>
>
>
>
> *Chaim Sanders    *
>
> Security Researcher, SpiderLabs
>
>
>
> *Trustwave* | SMART SECURITY ON DEMAND
>
> www.trustwave.com
>
>
>
> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:
> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] *On Behalf Of *Reginal
> Laurent
> *Sent:* Monday, February 9, 2015 3:23 AM
> *To:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* [Owasp-modsecurity-core-rule-set] ModSecurity Rules - Windows
> server 2008 R2
>
>
>
> Hello,
>
>
>
> I have a Windows Server 2008 R2 running Apache2 and PHP. ?I have
> configured Modsecurity for protection against Injection SQL or other
> attacks.
>
> However, when i scanned vulnerabilities on my server, i still have
> Injection SQL vulnerabilities and other based attacks. Is it normal ? Could
> you help me ?
>
>
>
> Thank you for feedback.
>
>
>
> --
>
> Cordialement,
>
> -------------------------
>
>
> R?ginal LAURENT
> Ing?nieur R?seaux et S?curit? des SI
> CCNA - ID: CSCO12321512
> skype : laurent.reginal
> Site perso : reginallaurent.info
>
> ------------------------------
>
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is strictly prohibited. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150211/92e9765f/attachment.html>

From reginal.laurent at gmail.com  Thu Feb 12 14:29:02 2015
From: reginal.laurent at gmail.com (Reginal Laurent)
Date: Thu, 12 Feb 2015 15:29:02 +0100
Subject: [Owasp-modsecurity-core-rule-set] Modsecurity - Symphony rules
Message-ID: <CAFMMpY8H2vSzD5OB5pONwJMNWv6U7+p6VwUbnb0AGbOejGnB_Q@mail.gmail.com>

Hello,


I have a problem with sites running on Symphony 2. Do you have specific
rules for this framework ? A lot of links to web pages are not available
when ModSecurity intance is ON, when i change it to DetectionOnly the web
application is 100% available. Please, could you help with that ? The
errors regarding "SQL injection" are not true i think. And the mentioned
errors by ModSecurity are not so detailed.

-

?Thank you for your feedback.


BR,
Reginal?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150212/f93bde68/attachment.html>

From barry_pollard at hotmail.com  Fri Feb 13 11:36:12 2015
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Fri, 13 Feb 2015 11:36:12 +0000
Subject: [Owasp-modsecurity-core-rule-set] Exception for DoS rules for IP
	range
Message-ID: <DUB126-W700C97AFD03E3E189A67FD82230@phx.gbl>

Is it possible to exclude?modsecurity_crs_11_dos_protection.conf rules only for certain IP ranges?

Our internal test suites are being flagged with this (as expected as they run a lot of tests in a short period of time) so I would like them excluded. However I want the other CRS tests to be included in case we add changes that cause issues with them (and also because ModSecurity is proving quite helpful in identifying issues in our code!).

I also don't want to have to set SecRuleEngine to DetectionOnly in test, and ignore the DoS errors as there are a lot of them in the logs and could easily lead to real alerts being ignored.

I could just not include this conf file on test environments but would prefer to keep my production and testing configuration the same, with a few exceptions I have based on environment variables (e.g. to have extra logging on in test). Or is there a way to only include files in Apache based on an environment variable?

I also tried to use SecRuleRemoveByMsg but think that checks the actual rule message configured in the rule, rather than the one outputted after the rule runs, so below does not work to exclude 127.0.x.x IP addresses for example:

#Remove internal IPs from DoS blocking so Testing can run scripts
SecRuleRemoveByMsg "Denial of Service \(DoS\) Attack Identified from 127\.0"
SecRuleRemoveByMsg "Potential Denial of Service \(DoS\) Attack from 127\.0"

On a separate but related topic, why are these still marked as "experimental" rules rather than optional ones despite being over two years old? Is there a definition on this? Are there extra risks for the experimental rules that I should be aware of and are they not recommended for production use?

Finally is there a way of searching the mail archives in case any of this has been asked before as going step by step through the posts on http://lists.owasp.org.pipermail/owasp-modsecurity-core-rule-set/ isn't the easiest.

Thanks,
Barry 		 	   		  

From barry_pollard at hotmail.com  Tue Feb 17 11:29:13 2015
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 17 Feb 2015 11:29:13 +0000
Subject: [Owasp-modsecurity-core-rule-set] Exception for DoS rules for
 IP range
In-Reply-To: <DUB126-W700C97AFD03E3E189A67FD82230@phx.gbl>
References: <DUB126-W700C97AFD03E3E189A67FD82230@phx.gbl>
Message-ID: <DUB126-W72703CDF3B92149C44F101822F0@phx.gbl>

Figured out this myself if anyone's interested.

You don't seem to have access to any variables or headers not specified in the rule arguments, so not as simple as adding a new rule filter (especially if you want to use other fields such as X-Forwarded-For header).

The best way I found was to put a rule in before with a ctl to remove the applicable rule:
? SecRule REMOTE_ADDR "^127\.0\." "id:4,nolog,pass,ctl:ruleRemoveById=981044"
And similarly for other rules or other criteria (e.g. X-Forward-By headers...etc).

The gives me flexibility to remove the rule based on exact criteria I want rather than complicating the rule itself.

BTW I've found Ivan Ristic's Mod Security Handbook a very good resource for learning Mod Security. Was initially worried it was too old as only covers up to ModSecurity 2.6 but seems to only be small changes since then so still very relevant. Main thing I've noticed is the id is now mandatory since 2.7. And first chapters are available free on feistyduck.com.

Thanks,
Barry

----------------------------------------
> From: barry_pollard at hotmail.com
> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> Date: Fri, 13 Feb 2015 11:36:12 +0000
> Subject: [Owasp-modsecurity-core-rule-set] Exception for DoS rules for IP range
>
> Is it possible to exclude modsecurity_crs_11_dos_protection.conf rules only for certain IP ranges?
>
> Our internal test suites are being flagged with this (as expected as they run a lot of tests in a short period of time) so I would like them excluded. However I want the other CRS tests to be included in case we add changes that cause issues with them (and also because ModSecurity is proving quite helpful in identifying issues in our code!).
>
> I also don't want to have to set SecRuleEngine to DetectionOnly in test, and ignore the DoS errors as there are a lot of them in the logs and could easily lead to real alerts being ignored.
>
> I could just not include this conf file on test environments but would prefer to keep my production and testing configuration the same, with a few exceptions I have based on environment variables (e.g. to have extra logging on in test). Or is there a way to only include files in Apache based on an environment variable?
>
> I also tried to use SecRuleRemoveByMsg but think that checks the actual rule message configured in the rule, rather than the one outputted after the rule runs, so below does not work to exclude 127.0.x.x IP addresses for example:
>
> #Remove internal IPs from DoS blocking so Testing can run scripts
> SecRuleRemoveByMsg "Denial of Service \(DoS\) Attack Identified from 127\.0"
> SecRuleRemoveByMsg "Potential Denial of Service \(DoS\) Attack from 127\.0"
>
> On a separate but related topic, why are these still marked as "experimental" rules rather than optional ones despite being over two years old? Is there a definition on this? Are there extra risks for the experimental rules that I should be aware of and are they not recommended for production use?
>
> Finally is there a way of searching the mail archives in case any of this has been asked before as going step by step through the posts on http://lists.owasp.org.pipermail/owasp-modsecurity-core-rule-set/ isn't the easiest.
>
> Thanks,
> Barry
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
 		 	   		  

From think.sabin at gmail.com  Thu Feb 26 11:31:49 2015
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Thu, 26 Feb 2015 17:16:49 +0545
Subject: [Owasp-modsecurity-core-rule-set] modsecurity not detecting php
	reverse shell
Message-ID: <CAE9Kp-Y=BktpocvyH=pgSAxD+uQWkBFE7So5US6=bvsPv5=MOQ@mail.gmail.com>

hi,
I implemented modsecurity and clamav in a server, and used rules,
 modsecurity_crs_46_av_scanning.conf
modsecurity_crs_45_trojans.conf

The found out during upload of php-reverse-shell.php file clamav wont
detect it as a malware and modsecurity wont block it. similarly the
modsecurity_crs_45_trojans.conf wont detect it.

Is there any way I can detect reverse-shell files and similar malware??

Many thanks.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150226/33a57163/attachment.html>

