<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Input%20filter%3A%20failed%20to%0A%20create%20temporary%20file&In-Reply-To=4B4B8E0F.90703%40breach.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000238.html">
   <LINK REL="Next"  HREF="000260.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file</H1>
    <B>Matthew Saltzman</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Input%20filter%3A%20failed%20to%0A%20create%20temporary%20file&In-Reply-To=4B4B8E0F.90703%40breach.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file">mjs at clemson.edu
       </A><BR>
    <I>Mon Jan 11 22:04:28 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000238.html">[Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file
</A></li>
        <LI>Next message: <A HREF="000260.html">[Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#244">[ date ]</a>
              <a href="thread.html#244">[ thread ]</a>
              <a href="subject.html#244">[ subject ]</a>
              <a href="author.html#244">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2010-01-11 at 12:46 -0800, Brian Rectanus wrote: 
&gt;<i> Matthew Saltzman wrote:
</I>&gt;<i> &gt; On Mon, 2010-01-11 at 12:57 -0500, Ryan Barnett wrote: 
</I>&gt;<i> &gt;&gt; On Monday 11 January 2010 12:50:00 pm Matthew Saltzman wrote:
</I>&gt;<i> &gt;&gt;&gt; On Mon, 2010-01-11 at 11:57 -0500, Ryan Barnett wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt; On Friday 08 January 2010 08:26:35 pm Matthew Saltzman wrote:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Hello, I hope I'm in the right place--I'm a complete newbie at this and
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; it's not my day job.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Could someone please explain to me what's going on with the following:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;         [Fri Jan 08 13:07:45 2010] [error] [client 129.138.19.192]
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;  ModSecurity: Input fi lter: Failed to create temporary file:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;  /tmp/httpd/20100108-130745-EHX6ekKtxHEAAC
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; F9asQAAAAB-request_body-RFm2a5 [hostname &quot;projects.coin-or.org&quot;] [uri
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; &quot;/Csdp/att
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;  achment/wiki/WikiStart/&quot;] [unique_id &quot;EHX6ekKtxHEAACF9asQAAAAB&quot;] [Fri
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Jan 08 13:07:45 2010] [error] [client 129.138.19.192] ModSecurity:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; Input fi lter: Failed to delete temporary file:
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;  /tmp/httpd/20100108-130745-EHX6ekKtxHEAAC
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; F9asQAAAAB-request_body-RFm2a5 [hostname &quot;projects.coin-or.org&quot;] [uri
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; &quot;/Csdp/att
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;  achment/wiki/WikiStart/&quot;] [unique_id &quot;EHX6ekKtxHEAACF9asQAAAAB&quot;]
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; I have a pristine installation of mod_security-2.5.9-1.el5 from the
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; EPEL repository on a Red Hat Enterprise 5 system.  The problem is from
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; a trac-0.11.5-1.el5.rf project page.
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; If you need more info to help, I'm glad to provide whatever I can, or
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; if I should be asking elsewhere, please let me know.  TIA for your kind
</I>&gt;<i> &gt;&gt;&gt;&gt;&gt; assistance.
</I>&gt;<i> &gt;&gt;&gt;&gt; Matt,
</I>&gt;<i> &gt;&gt;&gt;&gt; Looking at the error message and the temporary path/filename ModSecurity
</I>&gt;<i> &gt;&gt;&gt;&gt; is attempting to create, this looks like it is related to either the
</I>&gt;<i> &gt;&gt;&gt;&gt; SecTmpDir or SecUploadDir directives -
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; <A HREF="http://www.modsecurity.org/documentation/modsecurity-apache/2.5.11/modsec">http://www.modsecurity.org/documentation/modsecurity-apache/2.5.11/modsec</A>
</I>&gt;<i> &gt;&gt;&gt;&gt; urity2-apache- reference.html#N10C18
</I>&gt;<i> &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;&gt; Check your mod configs and see where you have specified /tmp/httpd in
</I>&gt;<i> &gt;&gt;&gt;&gt; those directives.  You will need to follow the ownership/perms
</I>&gt;<i> &gt;&gt;&gt;&gt; requirements for these directives related to the Apache user.
</I>&gt;<i> &gt;&gt;&gt; Both of these directives in modsecurity_crs_10_config.conf are set
</I>&gt;<i> &gt;&gt;&gt; to /tmp.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; $ ls -ld /tmp
</I>&gt;<i> &gt;&gt;&gt; drwxrwxrwt 7 root root 4096 Jan 11 12:45 /tmp
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Actually,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; $ ls -ldZ /tmp
</I>&gt;<i> &gt;&gt;&gt; drwxrwxrwt. root root system_u:object_r:tmp_t:s0       /tmp
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Could this be an SELinux issue?
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt; Good question.  Anyone else running SELinux run into similar perm issues?
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I will also check with Brian Rectanus (Lead Mod Developer).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Answering my own question, no changing to permissive mode doesn't affect
</I>&gt;<i> &gt; the error.
</I>&gt;<i> 
</I>&gt;<i> I don't think temp files will create the directory structure (working
</I>&gt;<i> from memory here).  Verify that it does not happen after creating
</I>&gt;<i> /tmp/httpd with mode 1777.  I would not create it there, though.  Better
</I>&gt;<i> in something like /var/httpd/modsec/tmp and used only for modsec.
</I>
Interesting:

      * Making /tmp/httpd, mode 1777, owner apache:apache solves the
        problem.

This seems like a bug--you can't count on the directory to exist
(particularly if it lives in /tmp), so you have to check and either not
use it or create it.

      * Changing /etc/httpd/modsecurity.d/modsecurity_crs_10_config.conf
        to point to a different directory for SecUploadDir, SecDataDir,
        and SecTmpDir and either reloading or restarting httpd doesn't
        change where the file is created--it's still in /tmp. 
      * Moving the directives to modsecurity_localrules.conf has the
        same lack of effect on the location where the file is written.

So either I'm doing something wrong here, or my directives are being
ignored for some reason.  More hints welcome.

Thanks for your help so far.

&gt;<i> 
</I>&gt;<i> -B
</I>&gt;<i> 
</I>
-- 
                Matthew Saltzman

Clemson University Math Sciences
mjs AT clemson DOT edu
<A HREF="http://www.math.clemson.edu/~mjs">http://www.math.clemson.edu/~mjs</A>
</PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000238.html">[Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file
</A></li>
	<LI>Next message: <A HREF="000260.html">[Owasp-modsecurity-core-rule-set] Input filter: failed to create temporary file
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#244">[ date ]</a>
              <a href="thread.html#244">[ thread ]</a>
              <a href="subject.html#244">[ subject ]</a>
              <a href="author.html#244">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
