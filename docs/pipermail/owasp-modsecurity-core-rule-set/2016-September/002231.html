<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] CRS Version 3.0 RC1 Rules 930100, 930110 definitions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20CRS%20Version%203.0%20RC1%20Rules%0A%20930100%2C%20930110%20definitions&In-Reply-To=%3C20160905110225.GA14654%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002230.html">
   <LINK REL="Next"  HREF="002227.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] CRS Version 3.0 RC1 Rules 930100, 930110 definitions</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20CRS%20Version%203.0%20RC1%20Rules%0A%20930100%2C%20930110%20definitions&In-Reply-To=%3C20160905110225.GA14654%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] CRS Version 3.0 RC1 Rules 930100, 930110 definitions">christian.folini at netnea.com
       </A><BR>
    <I>Mon Sep  5 11:02:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002230.html">[Owasp-modsecurity-core-rule-set] CRS Version 3.0 RC1 Rules	930100, 930110 definitions
</A></li>
        <LI>Next message: <A HREF="002227.html">[Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive	rule 920120
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2231">[ date ]</a>
              <a href="thread.html#2231">[ thread ]</a>
              <a href="subject.html#2231">[ subject ]</a>
              <a href="author.html#2231">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Ken and Barry,

Thank you for reporting Ken. This is an interesting case.

As Barry has already laid down, these rules are somewhat historical
and we can not really guarantee everything was really, really
considered during the migration steps. At least a considerate
documentation of the reasoning behind the design decision was
not done.

My 2 cents:
- These are phase:2 rules. There are subtle implicit parameter
  transformation happening between phase 1 and 2. The use of
  REQUEST_URI_RAW (where these transformations are not happening)
  in 930100 could be a hint in this direction. However, 930110 does
  not use this. Actually I get a feeling, that REQUEST_URI won't
  necessarily catch &quot;../&quot; in the request uri on application server.
  But maybe I am wrong.
- Maybe there is a performance advantage in using regexes on 
  REQUEST_BODY over ARGS. With the disadvantage that you won't know
  where the hit occurred. So maybe this is an artefact. Maybe it is
  not. 
- 930100 is one of the optimized regexes, where we no longer have the
  source pattern list. If somebody could dis-assemble it, that would
  be neat.

So under the line, I do not have a lot to contribute. Sorry.

Christian


On Sun, Sep 04, 2016 at 04:28:40PM -0700, Ken Brucker wrote:
&gt;<i> The false positive I get is on the WordPress backend.  If a post happens to include example path text that includes '../', it will trigger on these rules as the post is being saved.
</I>&gt;<i> 
</I>&gt;<i> I appreciate the hints on how to modify the rule locally. Much preferred over changing the rule set source.
</I>&gt;<i> 
</I>&gt;<i> In this case, I think the URI is OK and it's the REQUEST_BODY that I need to change. I don't recall which I saw in the audit log.
</I>&gt;<i> 
</I>&gt;<i> -- Ken
</I>&gt;<i> 
</I>&gt;<i> &gt; On Sep 4, 2016, at 10:43 AM, Barry Pollard &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">barry_pollard at hotmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Been thinking about this and you've got me intrigued as to whether this was an intentional decision or not...
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; As far as I can see, you are right these could have been written using REQUEST_FILENAME and ARGS rather than REQUEST_URI and REQUEST_BODY.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; ModSecurity is quite flexible and there are a few different ways of doing things. So it can depend on whoever writes the rules as to which version they use.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; This is just a guess, but I wonder if the reason these variables were chosen is hinted at in this line in the manual ModSecurity manual (<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BODY">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BODY</A> &lt;<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BODY">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BODY</A>&gt;):
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; There are no default transformation functions, as there were in the first generation of ModSecurity (1.x).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; and also lines like this:
</I>&gt;<i> &gt; Note : Please note that anti-evasion transformations are not used on REQUEST_URI, which means that you will have to specify them in the rules that use this variable.
</I>&gt;<i> &gt; I'm not sure what the default transformations were in ModSecurity 1.x, or if these were the anti-evasion transformations being discussed but wonder that was the reason - as it would prevent these rules from working if the ARGS were used and default transformations were applied?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; If you need the ability to override these on certain ARGS (though I think that could be dangerous - and have personally never seen any false positives with these) you could replace them as you see fit - either directly in the file (not recommended as will be overwritten if you ever upgrade the CRS) or by altering the rules dynamically:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; #Replace REQUEST_URI with REQUEST_FILENAME
</I>&gt;<i> &gt; SecRuleUpdateTargetById 930100 REQUEST_URI REQUEST_FILENAME
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; #Also add in ARGS
</I>&gt;<i> &gt; SecRuleUpdateTargetById 930100 ARGS
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Or use ctl:ruleRemoveById version to only do this for certain URLs.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks,
</I>&gt;<i> &gt; Barry
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On 4 Sep 2016, at 18:25, Christian Folini &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt;&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; On Sun, Sep 04, 2016 at 08:08:53AM -0700, Ken Brucker wrote:
</I>&gt;<i> &gt;&gt;&gt; [ Not sure my first try posting made it through, I see it in the archive, but have had no response which I find odd. ]
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I do not think the first inquiry made it through. But this time it did.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Thanks for the report. We'll investigate.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Cheers,
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Christian
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; I have V3 rules running in a test environment playing with how it interacts with WordPress. My early investigation is showing a few rules that need to be addressed to allow code, sql examples etc. to be included in a post, nothing overly surprising.
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; I have a question about the construction of rules 930100 and 930110. These rules both examine REQUEST_BODY and REQUEST_HEADERS. Other rules, such as 930120 use ARGS and ARGS_NAMES, etc.
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; The result is it's not possible to disable 930100 and 930110 for specific ARGS where the patterns would be acceptable.
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; What is the motivation for the difference in how these rules are defined?
</I>&gt;<i> &gt;&gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; -- Ken
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt;&gt; Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>&gt;
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; -- 
</I>&gt;<i> &gt;&gt; <A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A> &lt;<A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>&gt;
</I>&gt;<i> &gt;&gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt;
</I>&gt;<i> &gt;&gt; twitter: @ChrFolini
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>&gt;
</I>&gt;<i> 
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

-- 
<A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
twitter: @ChrFolini
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002230.html">[Owasp-modsecurity-core-rule-set] CRS Version 3.0 RC1 Rules	930100, 930110 definitions
</A></li>
	<LI>Next message: <A HREF="002227.html">[Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive	rule 920120
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2231">[ date ]</a>
              <a href="thread.html#2231">[ thread ]</a>
              <a href="subject.html#2231">[ subject ]</a>
              <a href="author.html#2231">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
