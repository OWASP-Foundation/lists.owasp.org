<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive rule 920120
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20OWASP%20CRS%20v3.0%20False%20Positive%0A%20rule%20920120&In-Reply-To=%3C20160905151824.GA7941%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002233.html">
   <LINK REL="Next"  HREF="002235.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive rule 920120</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20OWASP%20CRS%20v3.0%20False%20Positive%0A%20rule%20920120&In-Reply-To=%3C20160905151824.GA7941%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive rule 920120">christian.folini at netnea.com
       </A><BR>
    <I>Mon Sep  5 15:18:24 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002233.html">[Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive	rule 920120
</A></li>
        <LI>Next message: <A HREF="002235.html">[Owasp-modsecurity-core-rule-set] CRS v3.0 Wordpress False Positives
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2234">[ date ]</a>
              <a href="thread.html#2234">[ thread ]</a>
              <a href="subject.html#2234">[ subject ]</a>
              <a href="author.html#2234">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Cool. Thanks.

On Mon, Sep 05, 2016 at 08:05:51AM -0700, Ken Brucker wrote:
&gt;<i> Hi Christian,
</I>&gt;<i> 
</I>&gt;<i> Here's a redacted version that includes the C bit minus the content of the jpg file itself. I've added this to a github issue.
</I>&gt;<i> 
</I>&gt;<i> -- Ken
</I>&gt;<i> 
</I>&gt;<i> --0c41777f-A--
</I>&gt;<i> [05/Sep/2016:06:56:20 --0700] V815hH8AAAEAAFYB3d0AAABQ 192.168.56.1 62686 192.16
</I>&gt;<i> 8.56.101 80
</I>&gt;<i> --0c41777f-B--
</I>&gt;<i> POST /picasa_album_uploader/upload HTTP/1.1
</I>&gt;<i> Host: wpdev.local
</I>&gt;<i> Accept: */*
</I>&gt;<i> Accept-Encoding: gzip
</I>&gt;<i> Content-Length: 134956
</I>&gt;<i> Content-Type: multipart/form-data; boundary=---------------------------482C81C09
</I>&gt;<i> 614
</I>&gt;<i> Cookie: wordpress_logged_in_bdc5a801bed99bd8e2693412031c90e0=thor%7C1473256578%7
</I>&gt;<i> CqBvxoWnF7B59roUjZK1ypaRxJ6uqqhXJoKkgE1bUfGQ%7C0d1f9bd3868cf2a2df1330248d35e3689
</I>&gt;<i> 623535f486e66910a9700ae4c2c16dd; wordpress_test_cookie=WP+Cookie+check
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> User-Agent: Picasa/3.9.141.306 (gzip)
</I>&gt;<i> 
</I>&gt;<i> --0c41777f-C--
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;picasa-album-uploader-upload-images&quot;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> 0349e21fed
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;_wp_http_referer&quot;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> /picasa_album_uploader/minibrowser
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;size&quot;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> on
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;<A HREF="http://localhost:62667/2d1afc4dac01219e865">http://localhost:62667/2d1afc4dac01219e865</A>
</I>&gt;<i> 92ecb3f4a9d8e/image/2fa2bc77befd46db.jpg?size=1024&quot;; filename=&quot;IMG_6822.JPG&quot;
</I>&gt;<i> Content-Type: image/jpeg
</I>&gt;<i>  
</I>&gt;<i> [ Redacted ]
</I>&gt;<i> 
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;title[]&quot;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> IMG_6822.JPG
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;caption[]&quot;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----------------------------482C81C09614
</I>&gt;<i> Content-Disposition: form-data; name=&quot;description[]&quot;
</I>&gt;<i> Content-Type: text/plain; charset=utf-8
</I>&gt;<i> 
</I>&gt;<i> Deer in Austin
</I>&gt;<i> -----------------------------482C81C09614--
</I>&gt;<i> 
</I>&gt;<i> --0c41777f-F--
</I>&gt;<i> HTTP/1.1 403 Forbidden
</I>&gt;<i> Content-Length: 237
</I>&gt;<i> Connection: close
</I>&gt;<i> Content-Type: text/html; charset=iso-8859-1
</I>&gt;<i> 
</I>&gt;<i> --0c41777f-H--
</I>&gt;<i> Message: Warning. Pattern match &quot;['\&quot;;=]&quot; at FILES_NAMES:<A HREF="http://localhost:62667/">http://localhost:62667/</A>
</I>&gt;<i> 2d1afc4dac01219e86592ecb3f4a9d8e/image/2fa2bc77befd46db.jpg?size=1024. [file &quot;/vagrant/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf&quot;] [line &quot;108&quot;] [id &quot;920120&quot;] [rev &quot;1&quot;] [msg &quot;Attempted multipart/form-data bypass&quot;] [data &quot;<A HREF="http://localhost:62667/2d1afc4dac01219e86592ecb3f4a9d8e/image/2fa2bc77befd46db.jpg?size=1024">http://localhost:62667/2d1afc4dac01219e86592ecb3f4a9d8e/image/2fa2bc77befd46db.jpg?size=1024</A>&quot;] [severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] [accuracy &quot;7&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-protocol&quot;] [tag &quot;OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ&quot;] [tag &quot;CAPEC-272&quot;]
</I>&gt;<i> Message: Access denied with code 403 (phase 2). Operator GE matched 5 at TX:anomaly_score. [file &quot;/vagrant/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;] [line &quot;53&quot;] [id &quot;949110&quot;] [msg &quot;Inbound Anomaly Score Exceeded (Total Score: 5)&quot;] [severity &quot;CRITICAL&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-generic&quot;]
</I>&gt;<i> Message: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. [file &quot;/vagrant/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf&quot;] [line &quot;73&quot;] [id &quot;980130&quot;] [msg &quot;Inbound Anomaly Score Exceeded (Total Inbound Score: 5 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): Attempted multipart/form-data bypass&quot;] [tag &quot;event-correlation&quot;]
</I>&gt;<i> Apache-Error: [file &quot;apache2_util.c&quot;] [line 271] [level 3] [client %s] ModSecurity: %s%s [uri &quot;%s&quot;]%s
</I>&gt;<i> Apache-Error: [file &quot;apache2_util.c&quot;] [line 271] [level 3] [client %s] ModSecurity: %s%s [uri &quot;%s&quot;]%s
</I>&gt;<i> Apache-Error: [file &quot;apache2_util.c&quot;] [line 271] [level 3] [client %s] ModSecurity: %s%s [uri &quot;%s&quot;]%s
</I>&gt;<i> Action: Intercepted (phase 2)
</I>&gt;<i> Stopwatch: 1473083780329702 6475 (- - -)
</I>&gt;<i> Stopwatch2: 1473083780329702 6475; combined=2451, p1=208, p2=2078, p3=0, p4=0, p5=164, sr=26, sw=1, l=0, gc=0
</I>&gt;<i> Producer: ModSecurity for Apache/2.9.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); OWASP_CRS/3.0.0.
</I>&gt;<i> Server: Apache/2.4.23 (Ubuntu)
</I>&gt;<i> Engine-Mode: &quot;ENABLED&quot;
</I>&gt;<i> 
</I>&gt;<i> --0c41777f-J--
</I>&gt;<i> 4,133750,&quot;IMG_6822.JPG&quot;,&quot;&lt;Unknown ContentType&gt;&quot;
</I>&gt;<i> Total,133750
</I>&gt;<i> 
</I>&gt;<i> --0c41777f-Z--
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; On Sep 5, 2016, at 4:09 AM, Christian Folini &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt; wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hello Ken,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Classical False Positive.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; You have your audit log parts configured to include only the I part.
</I>&gt;<i> &gt; I think the uploaded filename in question is
</I>&gt;<i> &gt; <A HREF="http://localhost:63391/d8edaf7f8a66068039906ecb9d04c451/image/7c2c6d05f122032b.jpg?size=1024">http://localhost:63391/d8edaf7f8a66068039906ecb9d04c451/image/7c2c6d05f122032b.jpg?size=1024</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; But could you please show us the C part - or dump the full traffic,
</I>&gt;<i> &gt; we this becomes visible.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; And then, would you please open an issue on github for this?
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cheers,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Christian
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On Sun, Sep 04, 2016 at 08:26:37AM -0700, Ken Brucker wrote:
</I>&gt;<i> &gt;&gt; Playing with OWASP CRS v3.0 and have a false positive on rule 920120.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; The application is Picasa (no longer available from Google). During file uploads it produces the failing pattern when communicating with the target website. I have no control over the application end of this and there's no hope for a fix from Google since they have dropped the product. It does still work however so I continue to use it.
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; I'm disabling this rule for this user agent using:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; SecRule REQUEST_HEADERS:User-Agent &quot;@beginsWith Picasa/3.&quot; &quot;id:1010,phase:1,t:none,nolog,pass,ctl:ruleRemoveById=920120&quot;
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; Here's the entry from the audit log:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; --93ede52c-A--
</I>&gt;<i> &gt;&gt; [04/Sep/2016:07:57:20 --0700] V8w2UH8AAAEAADHQvy0AAABV 192.168.56.1 64619 192.16
</I>&gt;<i> &gt;&gt; 8.56.101 80
</I>&gt;<i> &gt;&gt; --93ede52c-B--
</I>&gt;<i> &gt;&gt; POST /picasa_album_uploader/upload HTTP/1.1
</I>&gt;<i> &gt;&gt; Host: wpdev.local
</I>&gt;<i> &gt;&gt; Accept: */*
</I>&gt;<i> &gt;&gt; Accept-Encoding: gzip
</I>&gt;<i> &gt;&gt; Content-Length: 117779
</I>&gt;<i> &gt;&gt; Content-Type: multipart/form-data; boundary=---------------------------98E77E01B
</I>&gt;<i> &gt;&gt; 348
</I>&gt;<i> &gt;&gt; Cookie: wordpress_logged_in_bdc5a801bed99bd8e2693412031c90e0=thor%7C1473173832%7
</I>&gt;<i> &gt;&gt; COzgZxmia5N6cIlq8cByzDuXNOUtUG8ksqAsyHg12XMA%7Cd70c349c19dfc0274e629711840a30937
</I>&gt;<i> &gt;&gt; a640e3c6f07362d76dab9bac3b58e68; wordpress_test_cookie=WP+Cookie+check
</I>&gt;<i> &gt;&gt; Connection: keep-alive
</I>&gt;<i> &gt;&gt; User-Agent: Picasa/3.9.141.306 (gzip)
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; --93ede52c-I--
</I>&gt;<i> &gt;&gt; picasa%2dalbum%2duploader%2dupload%2dimages=48fd37703c&amp;%5fwp%5fhttp%5freferer=%2
</I>&gt;<i> &gt;&gt; fpicasa%5falbum%5fuploader%2fminibrowser&amp;size=on&amp;title%5b%5d=IMG%5f5306%2eJPG&amp;ca
</I>&gt;<i> &gt;&gt; ption%5b%5d=&amp;description%5b%5d=
</I>&gt;<i> &gt;&gt; --93ede52c-F--
</I>&gt;<i> &gt;&gt; HTTP/1.1 403 Forbidden
</I>&gt;<i> &gt;&gt; Content-Length: 237
</I>&gt;<i> &gt;&gt; Connection: close
</I>&gt;<i> &gt;&gt; Content-Type: text/html; charset=iso-8859-1
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; --93ede52c-E--
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; --93ede52c-H--
</I>&gt;<i> &gt;&gt; Message: Warning. Pattern match &quot;['\&quot;;=]&quot; at FILES_NAMES:<A HREF="http://localhost:63391/">http://localhost:63391/</A>
</I>&gt;<i> &gt;&gt; d8edaf7f8a66068039906ecb9d04c451/image/7c2c6d05f122032b.jpg?size=1024. [file &quot;/v
</I>&gt;<i> &gt;&gt; agrant/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf&quot;] [line
</I>&gt;<i> &gt;&gt; &quot;108&quot;] [id &quot;920120&quot;] [rev &quot;1&quot;] [msg &quot;Attempted multipart/form-data bypass&quot;] [da
</I>&gt;<i> &gt;&gt; ta &quot;<A HREF="http://localhost:63391/d8edaf7f8a66068039906ecb9d04c451/image/7c2c6d05f12203">http://localhost:63391/d8edaf7f8a66068039906ecb9d04c451/image/7c2c6d05f12203</A>
</I>&gt;<i> &gt;&gt; 2b.jpg?size=1024&quot;] [severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] 
</I>&gt;<i> &gt;&gt; [accuracy &quot;7&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag &quot;platform-m
</I>&gt;<i> &gt;&gt; ulti&quot;] [tag &quot;attack-protocol&quot;] [tag &quot;OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ&quot;] 
</I>&gt;<i> &gt;&gt; [tag &quot;CAPEC-272&quot;]
</I>&gt;<i> &gt;&gt; Message: Access denied with code 403 (phase 2). Operator GE matched 5 at TX:anom
</I>&gt;<i> &gt;&gt; aly_score. [file &quot;/vagrant/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVAL
</I>&gt;<i> &gt;&gt; UATION.conf&quot;] [line &quot;53&quot;] [id &quot;949110&quot;] [msg &quot;Inbound Anomaly Score Exceeded (To
</I>&gt;<i> &gt;&gt; tal Score: 5)&quot;] [severity &quot;CRITICAL&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-m
</I>&gt;<i> &gt;&gt; ulti&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-generic&quot;]
</I>&gt;<i> &gt;&gt; Message: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. [file &quot;/vag
</I>&gt;<i> &gt;&gt; rant/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf&quot;] [line &quot;73&quot;] [id
</I>&gt;<i> &gt;&gt; &quot;980130&quot;] [msg &quot;Inbound Anomaly Score Exceeded (Total Inbound Score: 5 - SQLI=0
</I>&gt;<i> &gt;&gt; ,XSS=0,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): Attempted multipart/form-data by
</I>&gt;<i> &gt;&gt; pass&quot;] [tag &quot;event-correlation&quot;]
</I>&gt;<i> &gt;&gt; Apache-Error: [file &quot;apache2_util.c&quot;] [line 271] [level 3] [client %s] ModSecuri
</I>&gt;<i> &gt;&gt; ty: %s%s [uri &quot;%s&quot;]%s
</I>&gt;<i> &gt;&gt; Apache-Error: [file &quot;apache2_util.c&quot;] [line 271] [level 3] [client %s] ModSecuri
</I>&gt;<i> &gt;&gt; ty: %s%s [uri &quot;%s&quot;]%s
</I>&gt;<i> &gt;&gt; Apache-Error: [file &quot;apache2_util.c&quot;] [line 271] [level 3] [client %s] ModSecuri
</I>&gt;<i> &gt;&gt; ty: %s%s [uri &quot;%s&quot;]%s
</I>&gt;<i> &gt;&gt; Action: Intercepted (phase 2)
</I>&gt;<i> &gt;&gt; Stopwatch: 1473001040658089 39084 (- - -)
</I>&gt;<i> &gt;&gt; Stopwatch2: 1473001040658089 39084; combined=2811, p1=201, p2=2420, p3=0, p4=0, 
</I>&gt;<i> &gt;&gt; p5=189, sr=27, sw=1, l=0, gc=0
</I>&gt;<i> &gt;&gt; Response-Body-Transformed: Dechunked
</I>&gt;<i> &gt;&gt; Producer: ModSecurity for Apache/2.9.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); OWASP_CRS/
</I>&gt;<i> &gt;&gt; 3.0.0.
</I>&gt;<i> &gt;&gt; Server: Apache/2.4.23 (Ubuntu)
</I>&gt;<i> &gt;&gt; Engine-Mode: &quot;ENABLED&quot;
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; --93ede52c-J--
</I>&gt;<i> &gt;&gt; 4,116587,&quot;IMG_5306.JPG&quot;,&quot;&lt;Unknown ContentType&gt;&quot;
</I>&gt;<i> &gt;&gt; Total,116587
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; --93ede52c-Z--
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; -- Ken
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; -- 
</I>&gt;<i> &gt; <A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>
</I>&gt;<i> &gt; mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
</I>&gt;<i> &gt; twitter: @ChrFolini
</I>&gt;<i> 
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002233.html">[Owasp-modsecurity-core-rule-set] OWASP CRS v3.0 False Positive	rule 920120
</A></li>
	<LI>Next message: <A HREF="002235.html">[Owasp-modsecurity-core-rule-set] CRS v3.0 Wordpress False Positives
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2234">[ date ]</a>
              <a href="thread.html#2234">[ thread ]</a>
              <a href="subject.html#2234">[ subject ]</a>
              <a href="author.html#2234">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
