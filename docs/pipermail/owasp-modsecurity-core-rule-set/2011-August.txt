From michael.haas10 at gmail.com  Mon Aug  1 13:46:01 2011
From: michael.haas10 at gmail.com (Michael Haas)
Date: Mon, 1 Aug 2011 19:46:01 +0200
Subject: [Owasp-modsecurity-core-rule-set] core rule ids
Message-ID: <CAFW5hxDR2o_JOTvbAkoj1n_pNbggUutuQ=eeDGLX5MAHKVJE-g@mail.gmail.com>

Hi,

should the core rule ids be unique?
Is it a problem that the id's in
modsecurity_crs_10_config.conf.example?and
modsecurity_crs_41_sql_injection_attacks.conf are the same (e.g. id
981212) or should this be changed?

Thanks
Michael

From RBarnett at trustwave.com  Mon Aug  1 13:48:55 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Mon, 1 Aug 2011 12:48:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] core rule ids
In-Reply-To: <CAFW5hxDR2o_JOTvbAkoj1n_pNbggUutuQ=eeDGLX5MAHKVJE-g@mail.gmail.com>
Message-ID: <CA5C5F36.2DFD4%rbarnett@trustwave.com>

They should be unique. We will fix.

Thanks,
Ryan



On 8/1/11 1:46 PM, "Michael Haas" <michael.haas10 at gmail.com> wrote:

>Hi,
>
>should the core rule ids be unique?
>Is it a problem that the id's in
>modsecurity_crs_10_config.conf.example and
>modsecurity_crs_41_sql_injection_attacks.conf are the same (e.g. id
>981212) or should this be changed?
>
>Thanks
>Michael
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Tue Aug  2 10:14:44 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 2 Aug 2011 09:14:44 -0500
Subject: [Owasp-modsecurity-core-rule-set] New Blog Post - Detecting Malice
	with ModSecurity: HoneyTraps
Message-ID: <CA5D7E94.2E028%rbarnett@trustwave.com>

http://blog.spiderlabs.com/2011/08/detecting-malice-with-modsecurity-honeytraps.html

If you have ideas for more HoneyTrap concepts, please send them to the list CRS mail-list.

-Ryan

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From chris at derham.me.uk  Thu Aug  4 08:46:36 2011
From: chris at derham.me.uk (chris derham)
Date: Thu, 4 Aug 2011 09:46:36 -0300
Subject: [Owasp-modsecurity-core-rule-set] Possible false positive for 981244
Message-ID: <CAG6aRdUm54HyWZk4p+kd3EVpANsuu=CuOfxU5LBrcZ-01PD-Qg@mail.gmail.com>

All,

Not sure if this is the correct way to report false positives, but we are
testing our app works following upgrade to mod_security and to core ruleset
2.2.1. We are now hitting a false positive on rule 981244. I believe the
relevant section of the logs is shown below. Our app needs to login via a
http call, and it appears that the rule is rejecting the call as it contains
a parameter "j_username". We have turned the rule off for this particular
url using a location match shown below which seems to overcome the issue. Is
this the correct way, or is this really a false positive? Rule says it is
trying to catch SQL login attempts

    <LocationMatch "/secure*">
        SecRuleRemoveById 981244
    </LocationMatch>

Thanks for any pointers

Chris

--23480000-B--
POST /secure/j_acegi_security_check
HTTP/1.1
Host: <host name>
User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:5.0) Gecko/20100101
Firefox/5.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-gb,en;q=0.5
Accept-Encoding: gzip, deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Connection: keep-alive
Referer: http://<host name>/internet/shop
Cookie: JSESSIONID=872EE0D25BB05A9D8376C67A9808AB18
Content-Type: application/x-www-form-urlencoded
Content-Length: 62

--23480000-C--
j_username=<username>&j_password=<password>

--23480000-F--
HTTP/1.1 412 Precondition Failed
Last-Modified: Tue, 25 Jan 2011 18:00:46 GMT
ETag: "100000002f836-18e-49aaf7eea50aa"
Accept-Ranges: bytes
Vary:Accept-Encoding
Content-Encoding: gzip
Content-Length: 262
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Type: text/html

--23480000-H-- Message: Access denied with code 412 (phase 2). Pattern match
"(?i:(?:\\d(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)\\s+(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)\\s+\\d)|(?:^admin\\s*(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)|(\\/\\*)+(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)+\\s?(?:--|#|\\/\\*|{)?)|(?:(\"|'|
..." at ARGS:j_username. [file
"D:/apps/Apache2.2/conf/modsecurity2/modsecurity-crs_2.2.1/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"]
[line "560"] [id "981244"] [msg "Detects basic SQL authentication bypass
attempts 1/3"] [data "like"] [severity "CRITICAL"] [tag "WEB_ATTACK/SQLI"]
[tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"]
Action: Intercepted (phase 2)
Stopwatch: 1312456696272672 15001 (- - -)
Stopwatch2: 1312456696272672 15001; combined=14001, p1=2001, p2=8000, p3=0,
p4=0, p5=2000, sr=2001, sw=0, l=0, gc=2000
Producer: ModSecurity for Apache/2.6.1 (http://www.modsecurity.org/); core
ruleset/2.2.1.
Server: Apache
WebApp-Info: "rbge" "-" "-" /); core ruleset/2.1.2. Server: Apache
WebApp-Info: "rbge" "-" "-"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110804/9ff096dc/attachment.html 

From chris at jwall.org  Fri Aug  5 04:12:29 2011
From: chris at jwall.org (Christian Bockermann)
Date: Fri, 5 Aug 2011 10:12:29 +0200
Subject: [Owasp-modsecurity-core-rule-set] Possible false positive for
	981244
In-Reply-To: <CAG6aRdUm54HyWZk4p+kd3EVpANsuu=CuOfxU5LBrcZ-01PD-Qg@mail.gmail.com>
References: <CAG6aRdUm54HyWZk4p+kd3EVpANsuu=CuOfxU5LBrcZ-01PD-Qg@mail.gmail.com>
Message-ID: <A67E7C60-EB2F-475E-A8C5-AEADFC6846E0@jwall.org>

Hi Chris!


Am 04.08.2011 um 14:46 schrieb chris derham:
> Not sure if this is the correct way to report false positives, but we are testing our app works following upgrade to mod_security and to core ruleset 2.2.1. We are now hitting a false positive on rule 981244. I believe the relevant section of the logs is shown below. Our app needs to login via a http call, and it appears that the rule is rejecting the call as it contains a parameter "j_username". We have turned the rule off for this particular url using a location match shown below which seems to overcome the issue. Is this the correct way, or is this really a false positive? Rule says it is trying to catch SQL login attempts
> 
>     <LocationMatch "/secure*">
>         SecRuleRemoveById 981244
>     </LocationMatch>

That's a reasonable way to exclude rules for specific contexts.
The problem in your request is the password string that has been entered
into the login form (or sent otherwise).

It looks like the string "like" is somehow part of the password as can be
seen by the

     ... [data "like"] ....

part of the log event you attached.
As "like" is part of the SQL language, this request is flagged as possible
intrusion.

As for the exclusion, your proposed version will exclude that rule for all
requests to /secure/*
You might also consider just removing the parameter 'j_password' from the
rule, which can be done with:

   <Location /secure>
        #
        # Remove rule 981244 from j_password parameter for all /secure/ requests
        #
	SecRuleUpdateTargetById 981244 !ARGS:j_password 
   </Location>

Please note, that SecRuleUpdateTargetById is rather new and requires ModSecurity
2.6 (which you obviously have deployed, just mentioning that here for completeness).

Best regards,
    Chris


> 
> Thanks for any pointers
> 
> Chris
> 
> --23480000-B--
> POST /secure/j_acegi_security_check
> HTTP/1.1
> Host: <host name>
> User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:5.0) Gecko/20100101 Firefox/5.0 
> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> Accept-Language: en-gb,en;q=0.5
> Accept-Encoding: gzip, deflate 
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7 
> Connection: keep-alive 
> Referer: http://<host name>/internet/shop 
> Cookie: JSESSIONID=872EE0D25BB05A9D8376C67A9808AB18
> Content-Type: application/x-www-form-urlencoded
> Content-Length: 62 
> 
> --23480000-C-- 
> j_username=<username>&j_password=<password>
> 
> --23480000-F--
> HTTP/1.1 412 Precondition Failed
> Last-Modified: Tue, 25 Jan 2011 18:00:46 GMT
> ETag: "100000002f836-18e-49aaf7eea50aa"
> Accept-Ranges: bytes
> Vary:Accept-Encoding
> Content-Encoding: gzip
> Content-Length: 262
> Keep-Alive: timeout=15, max=100
> Connection: Keep-Alive
> Content-Type: text/html 
> 
> --23480000-H-- Message: Access denied with code 412 (phase 2). Pattern match "(?i:(?:\\d(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)\\s+(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)\\s+\\d)|(?:^admin\\s*(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)|(\\/\\*)+(\"|'|`|\xc2\xb4|\xe2\x80\x99|\xe2\x80\x98)+\\s?(?:--|#|\\/\\*|{)?)|(?:(\"|'| ..." at ARGS:j_username. [file "D:/apps/Apache2.2/conf/modsecurity2/modsecurity-crs_2.2.1/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "560"] [id "981244"] [msg "Detects basic SQL authentication bypass attempts 1/3"] [data "like"] [severity "CRITICAL"] [tag "WEB_ATTACK/SQLI"] [tag "WEB_ATTACK/ID"] [tag "WEB_ATTACK/LFI"] 
> Action: Intercepted (phase 2)
> Stopwatch: 1312456696272672 15001 (- - -)
> Stopwatch2: 1312456696272672 15001; combined=14001, p1=2001, p2=8000, p3=0, p4=0, p5=2000, sr=2001, sw=0, l=0, gc=2000
> Producer: ModSecurity for Apache/2.6.1 (http://www.modsecurity.org/); core ruleset/2.2.1.
> Server: Apache
> WebApp-Info: "rbge" "-" "-" /); core ruleset/2.1.2. Server: Apache WebApp-Info: "rbge" "-" "-" 
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From gvidals at vmracks.com  Fri Aug  5 15:41:59 2011
From: gvidals at vmracks.com (Gil Vidals)
Date: Fri, 5 Aug 2011 12:41:59 -0700
Subject: [Owasp-modsecurity-core-rule-set] help with preventing entries to
	audit log
Message-ID: <CAOPXycTc9-vTEzYjiSho4q8tjdMFP-xtJyUA=zzgmpd3KrRKzQ@mail.gmail.com>

Need help in preventing the log entry from the monitoring system at
pingdom.com because there are thousands of these entries per day. No matter,
what I try, I can't prevent the entry from being logged. I'm using the
anomaly scoring.

in modsecurity_crs_48_local_exceptions.conf:

SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"


And after restarting apache, I still am getting these entries:

--4489f76b-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com_bot_version_1.4_(http://www.pingdom.com/)
Host: blah.com


What else do you recommend I try?

-- 
Gil Vidals, VCP
gvidals at vmracks.com
www.vmracks.com - VMware Hosting Service Provider
t. 760.705.4022 IM: gilvidals at hotmail.com

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may
contain privileged and confidential information.  It is intended only for
the use of the person(s) named above.  If you are not the intended
recipient, please contact the sender by reply email and permanently delete
the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110805/8a88ddea/attachment.html 

From RBarnett at trustwave.com  Fri Aug  5 16:02:56 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 5 Aug 2011 15:02:56 -0500
Subject: [Owasp-modsecurity-core-rule-set] help with preventing entries
 to	audit log
In-Reply-To: <CAOPXycTc9-vTEzYjiSho4q8tjdMFP-xtJyUA=zzgmpd3KrRKzQ@mail.gmail.com>
References: <CAOPXycTc9-vTEzYjiSho4q8tjdMFP-xtJyUA=zzgmpd3KrRKzQ@mail.gmail.com>
Message-ID: <CC79E436-E92C-4FEC-A2BB-48F5BBB7B8DB@trustwave.com>

You should use the ctl action in your rule to turn off the audit engine -

SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass,ctl:auditEngine=Off"

Due to the fact that the UA data is easily spoofed, I would recommend you also do a check on the IP range or something so that attackers aren't evading your logging by putting pingdom in the UA field.

Ryan

On Aug 5, 2011, at 12:42 PM, "Gil Vidals" <gvidals at vmracks.com<mailto:gvidals at vmracks.com>> wrote:

Need help in preventing the log entry from the monitoring system at <http://pingdom.com> pingdom.com<http://pingdom.com> because there are thousands of these entries per day. No matter, what I try, I can't prevent the entry from being logged. I'm using the anomaly scoring.

in modsecurity_crs_48_local_exceptions.conf:
SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"

And after restarting apache, I still am getting these entries:

--4489f76b-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com<http://Pingdom.com>_bot_version_1.4_(<http://www.pingdom.com/>http://www.pingdom.com/)
Host: <http://blah.com> blah.com<http://blah.com>

What else do you recommend I try?

--
Gil Vidals, VCP
<mailto:gvidals at vmracks.com>gvidals at vmracks.com<mailto:gvidals at vmracks.com>
<http://www.vmracks.com>www.vmracks.com<http://www.vmracks.com> - VMware Hosting Service Provider
t. 760.705.4022 IM: <mailto:gilvidals at hotmail.com> gilvidals at hotmail.com<mailto:gilvidals at hotmail.com>
[http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]
HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From gvidals at vmracks.com  Fri Aug  5 17:09:03 2011
From: gvidals at vmracks.com (Gil Vidals)
Date: Fri, 5 Aug 2011 14:09:03 -0700
Subject: [Owasp-modsecurity-core-rule-set] help with preventing entries
 to audit log
In-Reply-To: <CC79E436-E92C-4FEC-A2BB-48F5BBB7B8DB@trustwave.com>
References: <CAOPXycTc9-vTEzYjiSho4q8tjdMFP-xtJyUA=zzgmpd3KrRKzQ@mail.gmail.com>
	<CC79E436-E92C-4FEC-A2BB-48F5BBB7B8DB@trustwave.com>
Message-ID: <CAOPXycT8h7DP=7_adfi4FPeUfwopPt-gQUPuwiZ3-ThtVEfynw@mail.gmail.com>

Thanks for the response. There must be something deeper going on here
because even after adding the line you suggested, I'm still getting these
entries after restarting apache:

--c073772f-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com_bot_version_1.4_(http://www.pingdom.com/)
Host: blah.com

Why isn't this rule being applied as I thought. Is it time to turn on mod
sec debugging?
  SecRule REQUEST_HEADERS:User-Agent "pingdom"
"nolog,noauditlog,pass,ctl:auditEngine=Off"


Gil Vidals / VM Racks

On Fri, Aug 5, 2011 at 1:02 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:

> You should use the ctl action in your rule to turn off the audit engine -
>
> SecRule REQUEST_HEADERS:User-Agent "pingdom"
> "nolog,noauditlog,pass,ctl:auditEngine=Off"
>
> Due to the fact that the UA data is easily spoofed, I would recommend you
> also do a check on the IP range or something so that attackers aren't
> evading your logging by putting pingdom in the UA field.
>
> Ryan
>
> On Aug 5, 2011, at 12:42 PM, "Gil Vidals" <gvidals at vmracks.com<mailto:
> gvidals at vmracks.com>> wrote:
>
> Need help in preventing the log entry from the monitoring system at <
> http://pingdom.com> pingdom.com<http://pingdom.com> because there are
> thousands of these entries per day. No matter, what I try, I can't prevent
> the entry from being logged. I'm using the anomaly scoring.
>
> in modsecurity_crs_48_local_exceptions.conf:
> SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"
>
> And after restarting apache, I still am getting these entries:
>
> --4489f76b-B--
> GET /account/login/?next=/ HTTP/1.0
> User-Agent: Pingdom.com<http://Pingdom.com>_bot_version_1.4_(<
> http://www.pingdom.com/>http://www.pingdom.com/)
> Host: <http://blah.com> blah.com<http://blah.com>
>
> What else do you recommend I try?
>
> --
> Gil Vidals, VCP
> <mailto:gvidals at vmracks.com>gvidals at vmracks.com<mailto:gvidals at vmracks.com
> >
> <http://www.vmracks.com>www.vmracks.com<http://www.vmracks.com> - VMware
> Hosting Service Provider
> t. 760.705.4022 IM: <mailto:gilvidals at hotmail.com> gilvidals at hotmail.com
> <mailto:gilvidals at hotmail.com>
> [http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]
> HIPAA Compliant Hosting
> VMware Hosting
>
> CONFIDENTIALITY NOTICE: The information contained in this transmission may
> contain privileged and confidential information.  It is intended only for
> the use of the person(s) named above.  If you are not the intended
> recipient, please contact the sender by reply email and permanently delete
> the original message.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
> Owasp-modsecurity-core-rule-set at lists.owasp.org>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> ________________________________
> This transmission may contain information that is privileged, confidential,
> and/or exempt from disclosure under applicable law. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution, or use of the information contained herein (including any
> reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
> in error, please immediately contact the sender and destroy the material in
> its entirety, whether in electronic or hard copy format.
>



-- 
Gil Vidals, VCP
gvidals at vmracks.com
www.vmracks.com - VMware Hosting Service Provider
t. 760.705.4022 IM: gilvidals at hotmail.com

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may
contain privileged and confidential information.  It is intended only for
the use of the person(s) named above.  If you are not the intended
recipient, please contact the sender by reply email and permanently delete
the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110805/5af16b8f/attachment.html 

From chris at jwall.org  Sat Aug  6 13:22:15 2011
From: chris at jwall.org (Christian Bockermann)
Date: Sat, 6 Aug 2011 19:22:15 +0200
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Training at Hashdays
	2011
Message-ID: <FBBE2DEE-8AD0-4E0E-8AC5-B13024D84A58@jwall.org>

Dear ModSecurity users,

I am happy to announce a 2-day ModSecurity training taking place
at the Hashdays 2011 conference in Lucerne, Switzerland.

The training will be on the 26th and 27th of October and will cover
an introduction to ModSecurity, rule writing and alert management
with the AuditConsole.

As a special gift, the ModSecurity Handbook of Ivan Ristic is included
as paperback and e-book for all participants.

Information about the Training can be found at

	https://secure.jwall.org/blog/2011/08/06/1312615320000.html

or at the Hashdays conference page:  https://www.hashdays.ch/

For any additional information, please contact me via e-mail at
chris (at) jwall.org


Best regards,

    Chris

From danilo.godec at agenda.si  Mon Aug  8 04:04:36 2011
From: danilo.godec at agenda.si (Danilo Godec)
Date: Mon, 08 Aug 2011 10:04:36 +0200
Subject: [Owasp-modsecurity-core-rule-set] Google Analytics cookie __utmz
	often trigger mod_security
Message-ID: <4E3F9894.1080308@agenda.si>

Hello,

I'm very new to mod_security - installed it on one of my server a couple 
of days ago along with core rules 2.2.1.

I had to create a couple of exceptions as some common Slovene words 
contain strings that trigger some SQL injection rules. For example - the 
word 'slike' (meaning 'pictures') obviously contains 'like' which 
triggers one or more of the rules in 
modsecurity_crs_41_sql_injection_attacks.conf.


Anyway, I also noticed that Google Analytics cookie __utmz often 
triggers these rules as it sometimes (quite often, actually) contains 
things like 'n=(n' - for example:

__utmz=42207527.1312789542.1.1.utmgclid=CIvzq5Gav6oCFZQm3wodY1mF5w|utmccn=(not+set)|utmcmd=(not+set)


What's a recommended practice to handle thinks like that?

  Danilo


From gvidals at vmracks.com  Tue Aug  9 01:35:45 2011
From: gvidals at vmracks.com (Gil Vidals)
Date: Mon, 8 Aug 2011 22:35:45 -0700
Subject: [Owasp-modsecurity-core-rule-set] help with preventing entries
 to audit log
In-Reply-To: <CANnPkinjk22ADfQ+zfSw8fLercfyTKmMGu1+crZevT7GvqA0bQ@mail.gmail.com>
References: <CAOPXycTc9-vTEzYjiSho4q8tjdMFP-xtJyUA=zzgmpd3KrRKzQ@mail.gmail.com>
	<CC79E436-E92C-4FEC-A2BB-48F5BBB7B8DB@trustwave.com>
	<CAOPXycT8h7DP=7_adfi4FPeUfwopPt-gQUPuwiZ3-ThtVEfynw@mail.gmail.com>
	<CANnPkinjk22ADfQ+zfSw8fLercfyTKmMGu1+crZevT7GvqA0bQ@mail.gmail.com>
Message-ID: <CAOPXycRxpygquttDfOFDWk8xdbWNb=CFjEm9W0wBMHt1qTdqvA@mail.gmail.com>

Changing pass to allow didn't help.

I forgot to mention mod sec is operating under DetectionOnly mode for the
time being. The debug log shows that the pattern does match, but there is
still an audit log entry being made for "pingdom"!

Here is the output of the debug log:

[08/Aug/2011:21:51:24 --0700] [
www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5] Rule 7fe340b17a40:
SecRule "REQUEST_HEADERS:User-Agent" "@rx pingdom"
"phase:2,nolog,noauditlog,pass,ctl:auditEngine=Off"
[08/Aug/2011:21:51:24 --0700] [
www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4] Executing operator
"rx" with param "pingdom" against REQUEST_HEADERS:User-Agent.
[08/Aug/2011:21:51:24 --0700] [
www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4] Warning. Pattern
match "pingdom" at REQUEST_HEADERS:User-Agent. [file
"/etc/apache2/modsecurity.d/base_rules/modsecurity_crs_48_local_exceptions.conf"]
[line "69"]

On Sat, Aug 6, 2011 at 12:06 PM, Josh Amishav-Zlatin <jamuse at gmail.com>wrote:

> What happens if you use allow instead of pass? Can you see what rules are
> firing in the debug log?
>
> --
>  - Josh
>
>
> On Sat, Aug 6, 2011 at 12:09 AM, Gil Vidals <gvidals at vmracks.com> wrote:
>
>> Thanks for the response. There must be something deeper going on here
>> because even after adding the line you suggested, I'm still getting these
>> entries after restarting apache:
>>
>> --c073772f-B--
>> GET /account/login/?next=/ HTTP/1.0
>> User-Agent: Pingdom.com_bot_version_1.4_(http://www.pingdom.com/)
>> Host: blah.com
>>
>> Why isn't this rule being applied as I thought. Is it time to turn on mod
>> sec debugging?
>>   SecRule REQUEST_HEADERS:User-Agent "pingdom"
>> "nolog,noauditlog,pass,ctl:auditEngine=Off"
>>
>>
>> Gil Vidals / VM Racks
>>
>> On Fri, Aug 5, 2011 at 1:02 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:
>>
>>> You should use the ctl action in your rule to turn off the audit engine -
>>>
>>> SecRule REQUEST_HEADERS:User-Agent "pingdom"
>>> "nolog,noauditlog,pass,ctl:auditEngine=Off"
>>>
>>> Due to the fact that the UA data is easily spoofed, I would recommend you
>>> also do a check on the IP range or something so that attackers aren't
>>> evading your logging by putting pingdom in the UA field.
>>>
>>> Ryan
>>>
>>> On Aug 5, 2011, at 12:42 PM, "Gil Vidals" <gvidals at vmracks.com<mailto:
>>> gvidals at vmracks.com>> wrote:
>>>
>>> Need help in preventing the log entry from the monitoring system at <
>>> http://pingdom.com> pingdom.com<http://pingdom.com> because there are
>>> thousands of these entries per day. No matter, what I try, I can't prevent
>>> the entry from being logged. I'm using the anomaly scoring.
>>>
>>> in modsecurity_crs_48_local_exceptions.conf:
>>> SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"
>>>
>>> And after restarting apache, I still am getting these entries:
>>>
>>> --4489f76b-B--
>>> GET /account/login/?next=/ HTTP/1.0
>>> User-Agent: Pingdom.com<http://Pingdom.com>_bot_version_1.4_(<
>>> http://www.pingdom.com/>http://www.pingdom.com/)
>>> Host: <http://blah.com> blah.com<http://blah.com>
>>>
>>> What else do you recommend I try?
>>>
>>> --
>>> Gil Vidals, VCP
>>> <mailto:gvidals at vmracks.com>gvidals at vmracks.com<mailto:
>>> gvidals at vmracks.com>
>>> <http://www.vmracks.com>www.vmracks.com<http://www.vmracks.com> - VMware
>>> Hosting Service Provider
>>> t. 760.705.4022 IM: <mailto:gilvidals at hotmail.com> gilvidals at hotmail.com
>>> <mailto:gilvidals at hotmail.com>
>>> [http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]
>>> HIPAA Compliant Hosting
>>> VMware Hosting
>>>
>>> CONFIDENTIALITY NOTICE: The information contained in this transmission
>>> may contain privileged and confidential information.  It is intended only
>>> for the use of the person(s) named above.  If you are not the intended
>>> recipient, please contact the sender by reply email and permanently delete
>>> the original message.
>>>
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org>
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>
>>> ________________________________
>>> This transmission may contain information that is privileged,
>>> confidential, and/or exempt from disclosure under applicable law. If you are
>>> not the intended recipient, you are hereby notified that any disclosure,
>>> copying, distribution, or use of the information contained herein (including
>>> any reliance thereon) is STRICTLY PROHIBITED. If you received this
>>> transmission in error, please immediately contact the sender and destroy the
>>> material in its entirety, whether in electronic or hard copy format.
>>>
>>
>>
>>
>> --
>> Gil Vidals, VCP
>> gvidals at vmracks.com
>> www.vmracks.com - VMware Hosting Service Provider
>> t. 760.705.4022 IM: gilvidals at hotmail.com
>>
>> HIPAA Compliant Hosting
>> VMware Hosting
>>
>> CONFIDENTIALITY NOTICE: The information contained in this transmission may
>> contain privileged and confidential information.  It is intended only for
>> the use of the person(s) named above.  If you are not the intended
>> recipient, please contact the sender by reply email and permanently delete
>> the original message.
>>
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>>
>


-- 
Gil Vidals, VCP
gvidals at vmracks.com
www.vmracks.com - VMware Hosting Service Provider
t. 760.705.4022 IM: gilvidals at hotmail.com

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may
contain privileged and confidential information.  It is intended only for
the use of the person(s) named above.  If you are not the intended
recipient, please contact the sender by reply email and permanently delete
the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110808/e7bdc47c/attachment.html 

From jamuse at gmail.com  Tue Aug  9 07:43:19 2011
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Tue, 9 Aug 2011 14:43:19 +0300
Subject: [Owasp-modsecurity-core-rule-set] help with preventing entries
 to audit log
In-Reply-To: <CAOPXycRxpygquttDfOFDWk8xdbWNb=CFjEm9W0wBMHt1qTdqvA@mail.gmail.com>
References: <CAOPXycTc9-vTEzYjiSho4q8tjdMFP-xtJyUA=zzgmpd3KrRKzQ@mail.gmail.com>
	<CC79E436-E92C-4FEC-A2BB-48F5BBB7B8DB@trustwave.com>
	<CAOPXycT8h7DP=7_adfi4FPeUfwopPt-gQUPuwiZ3-ThtVEfynw@mail.gmail.com>
	<CANnPkinjk22ADfQ+zfSw8fLercfyTKmMGu1+crZevT7GvqA0bQ@mail.gmail.com>
	<CAOPXycRxpygquttDfOFDWk8xdbWNb=CFjEm9W0wBMHt1qTdqvA@mail.gmail.com>
Message-ID: <CANnPkim892W3VZOJ-sjQLwH_ssGTat50S9G8fRr1aZGTaY4FhA@mail.gmail.com>

Hi Gil,

Can you show us the complete audit event that still shows up in your logs?

--
 - Josh

On Tue, Aug 9, 2011 at 8:35 AM, Gil Vidals <gvidals at vmracks.com> wrote:

> Changing pass to allow didn't help.
>
> I forgot to mention mod sec is operating under DetectionOnly mode for the
> time being. The debug log shows that the pattern does match, but there is
> still an audit log entry being made for "pingdom"!
>
> Here is the output of the debug log:
>
> [08/Aug/2011:21:51:24 --0700] [
> www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5<http://www.commq.org/sid#7fe3411dd3e0][rid%237fe341733ca0%5D%5B/%5D%5B5>]
> Rule 7fe340b17a40: SecRule "REQUEST_HEADERS:User-Agent" "@rx pingdom"
> "phase:2,nolog,noauditlog,pass,ctl:auditEngine=Off"
> [08/Aug/2011:21:51:24 --0700] [
> www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4<http://www.commq.org/sid#7fe3411dd3e0][rid%237fe341733ca0%5D%5B/%5D%5B4>]
> Executing operator "rx" with param "pingdom" against
> REQUEST_HEADERS:User-Agent.
> [08/Aug/2011:21:51:24 --0700] [
> www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4<http://www.commq.org/sid#7fe3411dd3e0][rid%237fe341733ca0%5D%5B/%5D%5B4>]
> Warning. Pattern match "pingdom" at REQUEST_HEADERS:User-Agent. [file
> "/etc/apache2/modsecurity.d/base_rules/modsecurity_crs_48_local_exceptions.conf"]
> [line "69"]
>
> On Sat, Aug 6, 2011 at 12:06 PM, Josh Amishav-Zlatin <jamuse at gmail.com>wrote:
>
>> What happens if you use allow instead of pass? Can you see what rules are
>> firing in the debug log?
>>
>> --
>>  - Josh
>>
>>
>> On Sat, Aug 6, 2011 at 12:09 AM, Gil Vidals <gvidals at vmracks.com> wrote:
>>
>>> Thanks for the response. There must be something deeper going on here
>>> because even after adding the line you suggested, I'm still getting these
>>> entries after restarting apache:
>>>
>>> --c073772f-B--
>>> GET /account/login/?next=/ HTTP/1.0
>>> User-Agent: Pingdom.com_bot_version_1.4_(http://www.pingdom.com/)
>>> Host: blah.com
>>>
>>> Why isn't this rule being applied as I thought. Is it time to turn on mod
>>> sec debugging?
>>>   SecRule REQUEST_HEADERS:User-Agent "pingdom"
>>> "nolog,noauditlog,pass,ctl:auditEngine=Off"
>>>
>>>
>>> Gil Vidals / VM Racks
>>>
>>> On Fri, Aug 5, 2011 at 1:02 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:
>>>
>>>> You should use the ctl action in your rule to turn off the audit engine
>>>> -
>>>>
>>>> SecRule REQUEST_HEADERS:User-Agent "pingdom"
>>>> "nolog,noauditlog,pass,ctl:auditEngine=Off"
>>>>
>>>> Due to the fact that the UA data is easily spoofed, I would recommend
>>>> you also do a check on the IP range or something so that attackers aren't
>>>> evading your logging by putting pingdom in the UA field.
>>>>
>>>> Ryan
>>>>
>>>> On Aug 5, 2011, at 12:42 PM, "Gil Vidals" <gvidals at vmracks.com<mailto:
>>>> gvidals at vmracks.com>> wrote:
>>>>
>>>> Need help in preventing the log entry from the monitoring system at <
>>>> http://pingdom.com> pingdom.com<http://pingdom.com> because there are
>>>> thousands of these entries per day. No matter, what I try, I can't prevent
>>>> the entry from being logged. I'm using the anomaly scoring.
>>>>
>>>> in modsecurity_crs_48_local_exceptions.conf:
>>>> SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"
>>>>
>>>> And after restarting apache, I still am getting these entries:
>>>>
>>>> --4489f76b-B--
>>>> GET /account/login/?next=/ HTTP/1.0
>>>> User-Agent: Pingdom.com<http://Pingdom.com>_bot_version_1.4_(<
>>>> http://www.pingdom.com/>http://www.pingdom.com/)
>>>> Host: <http://blah.com> blah.com<http://blah.com>
>>>>
>>>> What else do you recommend I try?
>>>>
>>>> --
>>>> Gil Vidals, VCP
>>>> <mailto:gvidals at vmracks.com>gvidals at vmracks.com<mailto:
>>>> gvidals at vmracks.com>
>>>> <http://www.vmracks.com>www.vmracks.com<http://www.vmracks.com> -
>>>> VMware Hosting Service Provider
>>>> t. 760.705.4022 IM: <mailto:gilvidals at hotmail.com>
>>>> gilvidals at hotmail.com<mailto:gilvidals at hotmail.com>
>>>> [http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]
>>>> HIPAA Compliant Hosting
>>>> VMware Hosting
>>>>
>>>> CONFIDENTIALITY NOTICE: The information contained in this transmission
>>>> may contain privileged and confidential information.  It is intended only
>>>> for the use of the person(s) named above.  If you are not the intended
>>>> recipient, please contact the sender by reply email and permanently delete
>>>> the original message.
>>>>
>>>> _______________________________________________
>>>> Owasp-modsecurity-core-rule-set mailing list
>>>> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
>>>> Owasp-modsecurity-core-rule-set at lists.owasp.org>
>>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>>
>>>> ________________________________
>>>> This transmission may contain information that is privileged,
>>>> confidential, and/or exempt from disclosure under applicable law. If you are
>>>> not the intended recipient, you are hereby notified that any disclosure,
>>>> copying, distribution, or use of the information contained herein (including
>>>> any reliance thereon) is STRICTLY PROHIBITED. If you received this
>>>> transmission in error, please immediately contact the sender and destroy the
>>>> material in its entirety, whether in electronic or hard copy format.
>>>>
>>>
>>>
>>>
>>> --
>>> Gil Vidals, VCP
>>> gvidals at vmracks.com
>>> www.vmracks.com - VMware Hosting Service Provider
>>> t. 760.705.4022 IM: gilvidals at hotmail.com
>>>
>>> HIPAA Compliant Hosting
>>> VMware Hosting
>>>
>>> CONFIDENTIALITY NOTICE: The information contained in this transmission
>>> may contain privileged and confidential information.  It is intended only
>>> for the use of the person(s) named above.  If you are not the intended
>>> recipient, please contact the sender by reply email and permanently delete
>>> the original message.
>>>
>>>
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>
>>>
>>
>
>
> --
> Gil Vidals, VCP
> gvidals at vmracks.com
> www.vmracks.com - VMware Hosting Service Provider
> t. 760.705.4022 IM: gilvidals at hotmail.com
>
> HIPAA Compliant Hosting
> VMware Hosting
>
> CONFIDENTIALITY NOTICE: The information contained in this transmission may
> contain privileged and confidential information.  It is intended only for
> the use of the person(s) named above.  If you are not the intended
> recipient, please contact the sender by reply email and permanently delete
> the original message.
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110809/3e445e75/attachment-0001.html 

From RBarnett at trustwave.com  Tue Aug  9 10:02:55 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 9 Aug 2011 09:02:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] help with preventing entries
 to audit log
In-Reply-To: <CAOPXycRxpygquttDfOFDWk8xdbWNb=CFjEm9W0wBMHt1qTdqvA@mail.gmail.com>
Message-ID: <CA66B5F3.2E842%rbarnett@trustwave.com>

Looks like you put this rule in your 48 local exceptions file.  I would suggest you put it in a modsecurity_crs_15_customrules.conf file and change the phase to 1 (phase:1).  This will ensure your rule runs before the current rule that is triggering the alert.

-Ryan

From: Gil Vidals <gvidals at vmracks.com<mailto:gvidals at vmracks.com>>
Date: Tue, 9 Aug 2011 00:35:45 -0500
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] help with preventing entries to audit log

Changing pass to allow didn't help.

I forgot to mention mod sec is operating under DetectionOnly mode for the time being. The debug log shows that the pattern does match, but there is still an audit log entry being made for "pingdom"!

Here is the output of the debug log:

[08/Aug/2011:21:51:24 --0700] [www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5<http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][5>] Rule 7fe340b17a40: SecRule "REQUEST_HEADERS:User-Agent" "@rx pingdom" "phase:2,nolog,noauditlog,pass,ctl:auditEngine=Off"
[08/Aug/2011:21:51:24 --0700] [www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4<http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4>] Executing operator "rx" with param "pingdom" against REQUEST_HEADERS:User-Agent.
[08/Aug/2011:21:51:24 --0700] [www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4<http://www.commq.org/sid#7fe3411dd3e0][rid#7fe341733ca0][/][4>] Warning. Pattern match "pingdom" at REQUEST_HEADERS:User-Agent. [file "/etc/apache2/modsecurity.d/base_rules/modsecurity_crs_48_local_exceptions.conf"] [line "69"]

On Sat, Aug 6, 2011 at 12:06 PM, Josh Amishav-Zlatin <jamuse at gmail.com<mailto:jamuse at gmail.com>> wrote:
What happens if you use allow instead of pass? Can you see what rules are firing in the debug log?

--
 - Josh


On Sat, Aug 6, 2011 at 12:09 AM, Gil Vidals <gvidals at vmracks.com<mailto:gvidals at vmracks.com>> wrote:
Thanks for the response. There must be something deeper going on here because even after adding the line you suggested, I'm still getting these entries after restarting apache:

--c073772f-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com_bot_version_1.4_(http://www.pingdom.com/)
Host: blah.com<http://blah.com>

Why isn't this rule being applied as I thought. Is it time to turn on mod sec debugging?
  SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass,ctl:auditEngine=Off"


Gil Vidals / VM Racks

On Fri, Aug 5, 2011 at 1:02 PM, Ryan Barnett <RBarnett at trustwave.com<mailto:RBarnett at trustwave.com>> wrote:
You should use the ctl action in your rule to turn off the audit engine -

SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass,ctl:auditEngine=Off"

Due to the fact that the UA data is easily spoofed, I would recommend you also do a check on the IP range or something so that attackers aren't evading your logging by putting pingdom in the UA field.

Ryan

On Aug 5, 2011, at 12:42 PM, "Gil Vidals" <gvidals at vmracks.com<mailto:gvidals at vmracks.com><mailto:gvidals at vmracks.com<mailto:gvidals at vmracks.com>>> wrote:

Need help in preventing the log entry from the monitoring system at <http://pingdom.com> pingdom.com<http://pingdom.com><http://pingdom.com> because there are thousands of these entries per day. No matter, what I try, I can't prevent the entry from being logged. I'm using the anomaly scoring.

in modsecurity_crs_48_local_exceptions.conf:
SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"

And after restarting apache, I still am getting these entries:

--4489f76b-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com<http://Pingdom.com>_bot_version_1.4_(<http://www.pingdom.com/>http://www.pingdom.com/)
Host: <http://blah.com> blah.com<http://blah.com><http://blah.com>

What else do you recommend I try?

--
Gil Vidals, VCP
<mailto:gvidals at vmracks.com<mailto:gvidals at vmracks.com>>gvidals at vmracks.com<mailto:gvidals at vmracks.com><mailto:gvidals at vmracks.com<mailto:gvidals at vmracks.com>>
<http://www.vmracks.com>www.vmracks.com<http://www.vmracks.com><http://www.vmracks.com> - VMware Hosting Service Provider
t. 760.705.4022<tel:760.705.4022> IM: <mailto:gilvidals at hotmail.com<mailto:gilvidals at hotmail.com>> gilvidals at hotmail.com<mailto:gilvidals at hotmail.com><mailto:gilvidals at hotmail.com<mailto:gilvidals at hotmail.com>>
[http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]
HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org><mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.



--
Gil Vidals, VCP
gvidals at vmracks.com<mailto:gvidals at vmracks.com>
www.vmracks.com<http://www.vmracks.com> - VMware Hosting Service Provider
t. 760.705.4022<tel:760.705.4022> IM: gilvidals at hotmail.com<mailto:gilvidals at hotmail.com>

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.


_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set





--
Gil Vidals, VCP
gvidals at vmracks.com<mailto:gvidals at vmracks.com>
www.vmracks.com<http://www.vmracks.com> - VMware Hosting Service Provider
t. 760.705.4022 IM: gilvidals at hotmail.com<mailto:gilvidals at hotmail.com>
[http://esx-hosting.vm-racks.com/images/VMracks/VMracks-logo.png]
HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may contain privileged and confidential information.  It is intended only for the use of the person(s) named above.  If you are not the intended recipient, please contact the sender by reply email and permanently delete the original message.


________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Tue Aug  9 12:55:38 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 9 Aug 2011 11:55:38 -0500
Subject: [Owasp-modsecurity-core-rule-set] Google Analytics cookie
 __utmz often trigger mod_security
In-Reply-To: <4E3F9894.1080308@agenda.si>
Message-ID: <CA66DEBF.2E89A%rbarnett@trustwave.com>

I suggest that you add in the following SecRuleUpdateTargetById directive
(http://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen
ce_Manual#SecRuleUpdateTargetById) to a local
modsecurity_crs_60_customrules.conf file -

SecRuleUpdateTargetById 981172 !REQUEST_COOKIES:'/^__utm/'

This will create an exception so that the existing rule will not inspect
the Google Analytics Cookie data.

-Ryan




On 8/8/11 4:04 AM, "Danilo Godec" <danilo.godec at agenda.si> wrote:

>Hello,
>
>I'm very new to mod_security - installed it on one of my server a couple
>of days ago along with core rules 2.2.1.
>
>I had to create a couple of exceptions as some common Slovene words
>contain strings that trigger some SQL injection rules. For example - the
>word 'slike' (meaning 'pictures') obviously contains 'like' which
>triggers one or more of the rules in
>modsecurity_crs_41_sql_injection_attacks.conf.
>
>
>Anyway, I also noticed that Google Analytics cookie __utmz often
>triggers these rules as it sometimes (quite often, actually) contains
>things like 'n=(n' - for example:
>
>__utmz=42207527.1312789542.1.1.utmgclid=CIvzq5Gav6oCFZQm3wodY1mF5w|utmccn=
>(not+set)|utmcmd=(not+set)
>
>
>What's a recommended practice to handle thinks like that?
>
>  Danilo
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From dbsinclair at multiservice.com  Tue Aug  9 17:37:12 2011
From: dbsinclair at multiservice.com (David Sinclair)
Date: Tue, 9 Aug 2011 16:37:12 -0500
Subject: [Owasp-modsecurity-core-rule-set] allow:request
Message-ID: <80044544b1acfe02f4f1575f02621078@mail.gmail.com>

I am rather new to modsecurity rules and am having trouble understanding the
functionality of allow:request.  From this debug log snippet, I have written
a custom rule, modsecurity_crs_15_custom_rules.conf,  that is designed to
allow the GET of a .dtd and skip the remainder of request phase processing
with allow:request.  However, this log shows that the processing of the
rules in the request phases continues with crs_20 that I am trying to
avoid.  Is there something that I have missed?



 Warning. Operator EQ matched 0 at TX. [file
"/etc/httpd/conf/modsecurity_crs/modsecurity_crs_10_config.conf"] [line
"309"] [id "98

 Rule returned
1.


 Match -> mode
NEXT_RULE.


 Recipe: Invoking rule 2ad8c7cf62e0; [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rules.conf"]
[line

 Rule 2ad8c7cf62e0: SecRule "REQUEST_METHOD" "@rx ^GET$"
"phase:1,chain,nolog,t:none,severity:6,rev:1.0.0,allow:request,msg:'Allow

 Transformation completed in 1
usec.


 Executing operator "rx" with param "^GET$" against
REQUEST_METHOD.


 Target value:
"GET"


 Operator completed in 2 usec.


 Rule returned
1.


 Match -> mode NEXT_RULE.


 Recipe: Invoking rule 2ad8c7cf6ea0; [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rules.conf"]
[line

 Rule 2ad8c7cf6ea0: SecRule "REQUEST_FILENAME" "@rx ^/dtd/.*[.]dtd$"
"t:none"

 Transformation completed in 1
usec.


 Executing operator "rx" with param "^/dtd/.*[.]dtd$" against
REQUEST_FILENAME.

 Target value:
"/dtd/BCSSRequest-v1.1.dtd"


 Operator completed in 3 usec.


 Warning. Pattern match "^/dtd/.*[.]dtd$" at REQUEST_FILENAME. [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15

 Rule returned
1.


 Match -> mode
NEXT_RULE.


 Recipe: Invoking rule 2ad8c7cf9ef8; [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_20_protocol_violations.conf"

 Rule 2ad8c7cf9ef8: SecRule "REQUEST_LINE" "!@rx
^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\\?[^#\\s]

 T (0) lowercase: "get /dtd/bcssrequest-v1.1.dtd
http/1.0"


 Transformation completed in 9
usec.


 Executing operator "!rx" with param
"^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\\?[^#\\s]*)?(?:#[\\S

 Target value: "get /dtd/bcssrequest-v1.1.dtd
http/1.0"


 Operator completed in 8
usec.


 Rule returned
0.


 No match, not chained -> mode
NEXT_RULE.



David B. Sinclair

Security Manager

Email:   dbsinclair at multiservice.com


---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110809/eb9225f8/attachment.html 

From RBarnett at trustwave.com  Tue Aug  9 17:41:11 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 9 Aug 2011 16:41:11 -0500
Subject: [Owasp-modsecurity-core-rule-set] allow:request
In-Reply-To: <80044544b1acfe02f4f1575f02621078@mail.gmail.com>
Message-ID: <CA67212E.2E931%rbarnett@trustwave.com>

What is your SecRuleEngine set to?  If it is DetectionOnly then it will not execute allow actions as they are considered disruptive.  If this is the case, then you can add "ctl:ruleEngine=On" to your rule to trigger the allow.  Remember though, that this has now enabled blocking mode for this transaction which means that any phase 3 and 4 rules may trigger blocks.  If you don't want that, then you should add another phase:3 rule to your custom rules file to "ctl:ruleEngine=DetectionOnly".

-Ryan

From: David Sinclair <dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>>
Date: Tue, 9 Aug 2011 16:37:12 -0500
To: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] allow:request

I am rather new to modsecurity rules and am having trouble understanding the functionality of allow:request.  From this debug logsnippet, I have written a custom rule, modsecurity_crs_15_custom_rules.conf,  that is designed to allow the GET of a .dtd and skip the remainder of request phase processing with allow:request.  However, this log shows that the processing of the rules in the request phases continues with crs_20 that I am trying to avoid.  Is there something that I have missed?

 Warning. Operator EQ matched 0 at TX. [file "/etc/httpd/conf/modsecurity_crs/modsecurity_crs_10_config.conf"] [line "309"] [id "98
 Rule returned 1.
 Match -> mode NEXT_RULE.
 Recipe: Invoking rule 2ad8c7cf62e0; [file "/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rules.conf"] [line
 Rule 2ad8c7cf62e0: SecRule "REQUEST_METHOD" "@rx ^GET$" "phase:1,chain,nolog,t:none,severity:6,rev:1.0.0,allow:request,msg:'Allow
 Transformation completed in 1 usec.
 Executing operator "rx" with param "^GET$" against REQUEST_METHOD.
 Target value: "GET"
 Operator completed in 2 usec.
 Rule returned 1.
 Match -> mode NEXT_RULE.
 Recipe: Invoking rule 2ad8c7cf6ea0; [file "/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rules.conf"] [line
 Rule 2ad8c7cf6ea0: SecRule "REQUEST_FILENAME" "@rx ^/dtd/.*[.]dtd$" "t:none"
 Transformation completed in 1 usec.
 Executing operator "rx" with param "^/dtd/.*[.]dtd$" against REQUEST_FILENAME.
 Target value: "/dtd/BCSSRequest-v1.1.dtd"
 Operator completed in 3 usec.
 Warning. Pattern match "^/dtd/.*[.]dtd$" at REQUEST_FILENAME. [file "/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15
 Rule returned 1.
 Match -> mode NEXT_RULE.
 Recipe: Invoking rule 2ad8c7cf9ef8; [file "/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_20_protocol_violations.conf"
 Rule 2ad8c7cf9ef8: SecRule "REQUEST_LINE" "!@rx ^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\\?[^#\\s]
 T (0) lowercase: "get /dtd/bcssrequest-v1.1.dtd http/1.0"
 Transformation completed in 9 usec.
 Executing operator "!rx" with param "^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\\?[^#\\s]*)?(?:#[\\S
 Target value: "get /dtd/bcssrequest-v1.1.dtd http/1.0"
 Operator completed in 8 usec.
 Rule returned 0.
 No match, not chained -> mode NEXT_RULE.

David B. Sinclair
Security Manager
Email:   dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>


---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------



________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From dbsinclair at multiservice.com  Tue Aug  9 17:46:21 2011
From: dbsinclair at multiservice.com (David Sinclair)
Date: Tue, 9 Aug 2011 16:46:21 -0500
Subject: [Owasp-modsecurity-core-rule-set] allow:request
In-Reply-To: <CA67212E.2E931%rbarnett@trustwave.com>
References: <80044544b1acfe02f4f1575f02621078@mail.gmail.com>
	<CA67212E.2E931%rbarnett@trustwave.com>
Message-ID: <db523627fd193d6bbef6e6f78a1652e5@mail.gmail.com>

The SecRuleEngine variable is set to DetectionOnly.  I guess that makes
sense if it only detecting but wish it had been documented a bit more.
Thank you for the help and quick response.

David B. Sinclair
Security Manager
Email:   dbsinclair at multiservice.com
-----Original Message-----
From: Ryan Barnett [mailto:RBarnett at trustwave.com]
Sent: Tuesday, August 09, 2011 4:41 PM
To: David Sinclair; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] allow:request

What is your SecRuleEngine set to?  If it is DetectionOnly then it will
not execute allow actions as they are considered disruptive.  If this is
the case, then you can add "ctl:ruleEngine=On" to your rule to trigger the
allow.  Remember though, that this has now enabled blocking mode for this
transaction which means that any phase 3 and 4 rules may trigger blocks.
If you don't want that, then you should add another phase:3 rule to your
custom rules file to "ctl:ruleEngine=DetectionOnly".

-Ryan

From: David Sinclair
<dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>>
Date: Tue, 9 Aug 2011 16:37:12 -0500
To:
"owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-
core-rule-set at lists.owasp.org>"
<owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-
core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] allow:request

I am rather new to modsecurity rules and am having trouble understanding
the functionality of allow:request.  From this debug logsnippet, I have
written a custom rule, modsecurity_crs_15_custom_rules.conf,  that is
designed to allow the GET of a .dtd and skip the remainder of request
phase processing with allow:request.  However, this log shows that the
processing of the rules in the request phases continues with crs_20 that I
am trying to avoid.  Is there something that I have missed?

 Warning. Operator EQ matched 0 at TX. [file
"/etc/httpd/conf/modsecurity_crs/modsecurity_crs_10_config.conf"] [line
"309"] [id "98
 Rule returned 1.
 Match -> mode NEXT_RULE.
 Recipe: Invoking rule 2ad8c7cf62e0; [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rule
s.conf"] [line
 Rule 2ad8c7cf62e0: SecRule "REQUEST_METHOD" "@rx ^GET$"
"phase:1,chain,nolog,t:none,severity:6,rev:1.0.0,allow:request,msg:'Allow
 Transformation completed in 1 usec.
 Executing operator "rx" with param "^GET$" against REQUEST_METHOD.
 Target value: "GET"
 Operator completed in 2 usec.
 Rule returned 1.
 Match -> mode NEXT_RULE.
 Recipe: Invoking rule 2ad8c7cf6ea0; [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rule
s.conf"] [line
 Rule 2ad8c7cf6ea0: SecRule "REQUEST_FILENAME" "@rx ^/dtd/.*[.]dtd$"
"t:none"
 Transformation completed in 1 usec.
 Executing operator "rx" with param "^/dtd/.*[.]dtd$" against
REQUEST_FILENAME.
 Target value: "/dtd/BCSSRequest-v1.1.dtd"
 Operator completed in 3 usec.
 Warning. Pattern match "^/dtd/.*[.]dtd$" at REQUEST_FILENAME. [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15
 Rule returned 1.
 Match -> mode NEXT_RULE.
 Recipe: Invoking rule 2ad8c7cf9ef8; [file
"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_20_protocol_vi
olations.conf"
 Rule 2ad8c7cf9ef8: SecRule "REQUEST_LINE" "!@rx
^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\\
?[^#\\s]
 T (0) lowercase: "get /dtd/bcssrequest-v1.1.dtd http/1.0"
 Transformation completed in 9 usec.
 Executing operator "!rx" with param
"^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\
\?[^#\\s]*)?(?:#[\\S
 Target value: "get /dtd/bcssrequest-v1.1.dtd http/1.0"
 Operator completed in 8 usec.
 Rule returned 0.
 No match, not chained -> mode NEXT_RULE.

David B. Sinclair
Security Manager
Email:   dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>


--------------------------------------------------------------------------
-------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
--------------------------------------------------------------------------
-------------



________________________________
This transmission may contain information that is privileged,
confidential, and/or exempt from disclosure under applicable law. If you
are not the intended recipient, you are hereby notified that any
disclosure, copying, distribution, or use of the information contained
herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
received this transmission in error, please immediately contact the sender
and destroy the material in its entirety, whether in electronic or hard
copy format.

---------------------------------------------------------------------------------------
This email is intended solely for the use of the addressee and may
contain information that is confidential, proprietary, or both.
If you receive this email in error please immediately notify the
sender and delete the email.
---------------------------------------------------------------------------------------


From RBarnett at trustwave.com  Wed Aug 10 08:54:20 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 10 Aug 2011 07:54:20 -0500
Subject: [Owasp-modsecurity-core-rule-set] allow:request
In-Reply-To: <db523627fd193d6bbef6e6f78a1652e5@mail.gmail.com>
Message-ID: <CA67F6BB.2E973%rbarnett@trustwave.com>

On 8/9/11 5:46 PM, "David Sinclair" <dbsinclair at multiservice.com> wrote:


>The SecRuleEngine variable is set to DetectionOnly.  I guess that makes
>sense if it only detecting but wish it had been documented a bit more.

Good point David.  I updated the SecRuleEngine info for DetectionOnly and
added a NOTE to the Reference Manual to point this out -

https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen
ce_Manual#SecRuleEngine

https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen
ce_Manual#Actions


-Ryan

>Thank you for the help and quick response.
>
>David B. Sinclair
>Security Manager
>Email:   dbsinclair at multiservice.com
>-----Original Message-----
>From: Ryan Barnett [mailto:RBarnett at trustwave.com]
>Sent: Tuesday, August 09, 2011 4:41 PM
>To: David Sinclair; owasp-modsecurity-core-rule-set at lists.owasp.org
>Subject: Re: [Owasp-modsecurity-core-rule-set] allow:request
>
>What is your SecRuleEngine set to?  If it is DetectionOnly then it will
>not execute allow actions as they are considered disruptive.  If this is
>the case, then you can add "ctl:ruleEngine=On" to your rule to trigger the
>allow.  Remember though, that this has now enabled blocking mode for this
>transaction which means that any phase 3 and 4 rules may trigger blocks.
>If you don't want that, then you should add another phase:3 rule to your
>custom rules file to "ctl:ruleEngine=DetectionOnly".
>
>-Ryan
>
>From: David Sinclair
><dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>>
>Date: Tue, 9 Aug 2011 16:37:12 -0500
>To:
>"owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-
>core-rule-set at lists.owasp.org>"
><owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-
>core-rule-set at lists.owasp.org>>
>Subject: [Owasp-modsecurity-core-rule-set] allow:request
>
>I am rather new to modsecurity rules and am having trouble understanding
>the functionality of allow:request.  From this debug logsnippet, I have
>written a custom rule, modsecurity_crs_15_custom_rules.conf,  that is
>designed to allow the GET of a .dtd and skip the remainder of request
>phase processing with allow:request.  However, this log shows that the
>processing of the rules in the request phases continues with crs_20 that I
>am trying to avoid.  Is there something that I have missed?
>
> Warning. Operator EQ matched 0 at TX. [file
>"/etc/httpd/conf/modsecurity_crs/modsecurity_crs_10_config.conf"] [line
>"309"] [id "98
> Rule returned 1.
> Match -> mode NEXT_RULE.
> Recipe: Invoking rule 2ad8c7cf62e0; [file
>"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rule
>s.conf"] [line
> Rule 2ad8c7cf62e0: SecRule "REQUEST_METHOD" "@rx ^GET$"
>"phase:1,chain,nolog,t:none,severity:6,rev:1.0.0,allow:request,msg:'Allow
> Transformation completed in 1 usec.
> Executing operator "rx" with param "^GET$" against REQUEST_METHOD.
> Target value: "GET"
> Operator completed in 2 usec.
> Rule returned 1.
> Match -> mode NEXT_RULE.
> Recipe: Invoking rule 2ad8c7cf6ea0; [file
>"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15_custom_rule
>s.conf"] [line
> Rule 2ad8c7cf6ea0: SecRule "REQUEST_FILENAME" "@rx ^/dtd/.*[.]dtd$"
>"t:none"
> Transformation completed in 1 usec.
> Executing operator "rx" with param "^/dtd/.*[.]dtd$" against
>REQUEST_FILENAME.
> Target value: "/dtd/BCSSRequest-v1.1.dtd"
> Operator completed in 3 usec.
> Warning. Pattern match "^/dtd/.*[.]dtd$" at REQUEST_FILENAME. [file
>"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_15
> Rule returned 1.
> Match -> mode NEXT_RULE.
> Recipe: Invoking rule 2ad8c7cf9ef8; [file
>"/etc/httpd/conf/modsecurity_crs/base_rules/modsecurity_crs_20_protocol_vi
>olations.conf"
> Rule 2ad8c7cf9ef8: SecRule "REQUEST_LINE" "!@rx
>^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\\
>?[^#\\s]
> T (0) lowercase: "get /dtd/bcssrequest-v1.1.dtd http/1.0"
> Transformation completed in 9 usec.
> Executing operator "!rx" with param
>"^(?:(?:[a-z]{3,10}\\s+(?:\\w{3,7}?://[\\w\\-\\./]*(?::\\d+)?)?/[^?#]*(?:\
>\?[^#\\s]*)?(?:#[\\S
> Target value: "get /dtd/bcssrequest-v1.1.dtd http/1.0"
> Operator completed in 8 usec.
> Rule returned 0.
> No match, not chained -> mode NEXT_RULE.
>
>David B. Sinclair
>Security Manager
>Email:   dbsinclair at multiservice.com<mailto:dbsinclair at multiservice.com>
>
>
>--------------------------------------------------------------------------
>-------------
>This email is intended solely for the use of the addressee and may
>contain information that is confidential, proprietary, or both.
>If you receive this email in error please immediately notify the
>sender and delete the email.
>--------------------------------------------------------------------------
>-------------
>
>
>
>________________________________
>This transmission may contain information that is privileged,
>confidential, and/or exempt from disclosure under applicable law. If you
>are not the intended recipient, you are hereby notified that any
>disclosure, copying, distribution, or use of the information contained
>herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
>received this transmission in error, please immediately contact the sender
>and destroy the material in its entirety, whether in electronic or hard
>copy format.
>
>--------------------------------------------------------------------------
>-------------
>This email is intended solely for the use of the addressee and may
>contain information that is confidential, proprietary, or both.
>If you receive this email in error please immediately notify the
>sender and delete the email.
>--------------------------------------------------------------------------
>-------------
>
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Thu Aug 11 13:44:33 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 11 Aug 2011 12:44:33 -0500
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Advanced Topic of the
 Week: Audit Log Searching with ModGrep
Message-ID: <CA698D41.2F2CA%rbarnett@trustwave.com>

New blog post -
http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-audit-log-searching-with-modgrep.html

-Ryan

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From paul at paulmcgarry.com  Tue Aug 16 23:34:16 2011
From: paul at paulmcgarry.com (Paul McGarry)
Date: Wed, 17 Aug 2011 13:34:16 +1000
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection detection
	false positives?
Message-ID: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>

Hi all,

I am seeing quite a lot of false positives on SQL injection errors.

On of them is rule 981242 which is objecting to a cookie:
test=asfnsdh2fub9tl6gt0mand504
with the regex:
(\"|'|`|?|?|?)\s*x?or|div|like|between|and\s*(\"|'|`|?|?|?)?\d
matching on "and5"

1) Is the regex missing some grouping?
As written it seems that (x)or is being treated differently than
div/like/between/and, ie the (x)or case requires one of the quote
characters before it while the others don't.
Should that part of the regex be:
(\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)\s*(\"|'|`|?|?|?)?\d

2) Should "and" being followed directly by a number, without space or
a quote, be a match?
On my SQL server (Postgres) I think "and5" would be a syntax error (as
opposed to "and'5" or "and 5"
Would:
(\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)(?:(\"|'|`|?|?|?)|\s+(\"|'|`|?|?|?)?)\d
be a tighter match?

Paul

From Jason_Haar at trimble.com  Wed Aug 17 00:02:39 2011
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 17 Aug 2011 16:02:39 +1200
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
 detectionfalse positives?
In-Reply-To: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
References: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
Message-ID: <4E4B3D5F.90905@trimble.com>

Me too - I'm seeing 981248 and 981173 trigger on cookies containing
"7or" and "8Or" (ie "8or"). Sounds like there's a bunch of rules that
are triggering on 3-char matches - that is waaaaay too small - the FP
rate is guaranteed to be large!

(I just joined today and the very first email I see is about the very
problem I just joined the list about. Freaky)

Jason

On 17/08/11 15:34, Paul McGarry wrote:
>
> Hi all,
>
> I am seeing quite a lot of false positives on SQL injection errors.
>
> On of them is rule 981242 which is objecting to a cookie:
> test=asfnsdh2fub9tl6gt0mand504
> with the regex:
> (\"|'|`|?|?|?)\s*x?or|div|like|between|and\s*(\"|'|`|?|?|?)?\d
> matching on "and5"
>
> 1) Is the regex missing some grouping?
> As written it seems that (x)or is being treated differently than
> div/like/between/and, ie the (x)or case requires one of the quote
> characters before it while the others don't.
> Should that part of the regex be:
> (\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)\s*(\"|'|`|?|?|?)?\d
>
> 2) Should "and" being followed directly by a number, without space or
> a quote, be a match?
> On my SQL server (Postgres) I think "and5" would be a syntax error (as
> opposed to "and'5" or "and 5"
> Would:
> (\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)(?:(\"|'|`|?|?|?)|\s+(\"|'|`|?|?|?)?)\d
> be a tighter match?
>
> Paul
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

-- 
Cheers

Jason Haar
Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110817/cf39a895/attachment.html 

From paul at paulmcgarry.com  Wed Aug 17 01:18:31 2011
From: paul at paulmcgarry.com (Paul McGarry)
Date: Wed, 17 Aug 2011 15:18:31 +1000
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
 detectionfalse positives?
In-Reply-To: <4E4B3D5F.90905@trimble.com>
References: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
	<4E4B3D5F.90905@trimble.com>
Message-ID: <CAPrE0SbAkt7sHmkrETANWwiuqTEJ+ZWgPa9FMWz5gRUPah1Mzg@mail.gmail.com>

On Wed, Aug 17, 2011 at 2:02 PM, Jason Haar <Jason_Haar at trimble.com> wrote:
> Me too - I'm seeing 981248 and 981173 trigger on cookies containing "7or"
> and "8Or" (ie "8or"). Sounds like there's a bunch of rules that are
> triggering on 3-char matches - that is waaaaay too small - the FP rate is
> guaranteed to be large!
>
> (I just joined today and the very first email I see is about the very
> problem I just joined the list about. Freaky)

The "trouble" from my perspective is it's difficult to determine
whether there is some nuance of SQL injection that the rules are
catering to that I'm not seeing.

For your example it's fairly easy to understand that "7or 1=1", "7or
true", "or'true'"  etc would be a problem, eg if SQL such as:
select * from thing where thingid=(variable)
were exploitable.

It's not immediately clear (to me) that "7or" is enough to trigger an
exploit but the worry that I'm just not seeing something makes me
reticent to modify rules.

At the moment I find it difficult to determine the specific intent
behind the more complex rules. Without an explanation of exactly what
they are supposed to catch (and why) it's difficult to know if they
are over-zealous.

Paul







>
> Jason
>
> On 17/08/11 15:34, Paul McGarry wrote:
>
> Hi all,
>
> I am seeing quite a lot of false positives on SQL injection errors.
>
> On of them is rule 981242 which is objecting to a cookie:
> test=asfnsdh2fub9tl6gt0mand504
> with the regex:
> (\"|'|`|?|?|?)\s*x?or|div|like|between|and\s*(\"|'|`|?|?|?)?\d
> matching on "and5"
>
> 1) Is the regex missing some grouping?
> As written it seems that (x)or is being treated differently than
> div/like/between/and, ie the (x)or case requires one of the quote
> characters before it while the others don't.
> Should that part of the regex be:
> (\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)\s*(\"|'|`|?|?|?)?\d
>
> 2) Should "and" being followed directly by a number, without space or
> a quote, be a match?
> On my SQL server (Postgres) I think "and5" would be a syntax error (as
> opposed to "and'5" or "and 5"
> Would:
> (\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)(?:(\"|'|`|?|?|?)|\s+(\"|'|`|?|?|?)?)\d
> be a tighter match?
>
> Paul
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> --
> Cheers
>
> Jason Haar
> Information Security Manager, Trimble Navigation Ltd.
> Phone: +1 408 481 8171
> PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>

From Jason_Haar at trimble.com  Wed Aug 17 01:26:58 2011
From: Jason_Haar at trimble.com (Jason Haar)
Date: Wed, 17 Aug 2011 17:26:58 +1200
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
 detectionfalse positives?
In-Reply-To: <CAPrE0SbAkt7sHmkrETANWwiuqTEJ+ZWgPa9FMWz5gRUPah1Mzg@mail.gmail.com>
References: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com><4E4B3D5F.90905@trimble.com>
	<CAPrE0SbAkt7sHmkrETANWwiuqTEJ+ZWgPa9FMWz5gRUPah1Mzg@mail.gmail.com>
Message-ID: <4E4B5122.7020000@trimble.com>

On 17/08/11 17:18, Paul McGarry wrote:
>
>
> The "trouble" from my perspective is it's difficult to determine
> whether there is some nuance of SQL injection that the rules are
> catering to that I'm not seeing.
>
I  know what you mean, but this is the Cookie that triggered ours

"LtpaToken2=X1K3I8jgKO7or"

...in what universe could that be a SQL injection attack?


-- 
Cheers

Jason Haar
Information Security Manager, Trimble Navigation Ltd.
Phone: +1 408 481 8171
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110817/a1952f71/attachment.html 

From RBarnett at trustwave.com  Wed Aug 17 08:36:20 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 17 Aug 2011 07:36:20 -0500
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
 detection false positives?
In-Reply-To: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
Message-ID: <CA712B19.2F8DB%rbarnett@trustwave.com>

Thanks for the feedback Paul.  FYI - you can review some of the reference
links at the top of the file to see some example payloads that we
referenced while creating these rules -


#
# References:
#
# SQL Injection Pocket Reference (via @LightOS) -
# https://docs.google.com/Doc?docid=0AZNlBave77hiZGNjanptbV84Z25yaHJmMjk
#
# SQLi Filter Evasion Cheat Sheet -
#
http://websec.wordpress.com/2010/12/04/sqli-filter-evasion-cheat-sheet-mysq
l/
#
# SQL Injection Cheat Sheet -
# http://ferruh.mavituna.com/sql-injection-cheatsheet-oku/
#
# SQLMap's Tamper Scripts (for evasions)
# https://svn.sqlmap.org/sqlmap/trunk/sqlmap/tamper/
#

For the specific rule you mentioned - 981242 - this is a converted phpids
rule.  You can review example test payloads that they use here -
https://dev.itratos.de/projects/php-ids/repository/entry/trunk/tests/IDS/Mo
nitorTest.php.  Look for the public function testSQLIList() sections.


In reviewing your recommendations, I agree with #1 and we should probably
group the AND operator group together.  This should fix the FP as it would
require one of the leading quotes to be present.  I will do this in the
next CRS release.

-Ryan

On 8/16/11 11:34 PM, "Paul McGarry" <paul at paulmcgarry.com> wrote:

>Hi all,
>
>I am seeing quite a lot of false positives on SQL injection errors.
>
>On of them is rule 981242 which is objecting to a cookie:
>test=asfnsdh2fub9tl6gt0mand504
>with the regex:
>(\"|'|`|?|?|?)\s*x?or|div|like|between|and\s*(\"|'|`|?|?|?)?\d
>matching on "and5"
>
>1) Is the regex missing some grouping?
>As written it seems that (x)or is being treated differently than
>div/like/between/and, ie the (x)or case requires one of the quote
>characters before it while the others don't.
>Should that part of the regex be:
>(\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)\s*(\"|'|`|?|?|?)?\d
>
>2) Should "and" being followed directly by a number, without space or
>a quote, be a match?
>On my SQL server (Postgres) I think "and5" would be a syntax error (as
>opposed to "and'5" or "and 5"
>Would:
>(\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)(?:(\"|'|`|?|?|?)|\s+(\"|'|`
>|?|?|?)?)\d
>be a tighter match?
>
>Paul
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From majedb at gmail.com  Wed Aug 17 10:22:56 2011
From: majedb at gmail.com (Majed B.)
Date: Wed, 17 Aug 2011 17:22:56 +0300
Subject: [Owasp-modsecurity-core-rule-set] Problem with package signature
Message-ID: <CAKA73TBi=iEGKk3sBvgkpib82Ux_pY247GmofB3RHKis_Q+_+A@mail.gmail.com>

Hello everyone,

I'm setting up the ruler-updater to auto download and unpack the latest
stable but I'm having a problem with the signature.

rules-updater.pl -c rules-updater.conf -Smodsecurity-crs
Fetching: modsecurity-crs/modsecurity-crs_2.2.1.zip ...
Verifying
"/etc/apache2/mods-available/mod-security/modsecurity-crs/modsecurity-crs_2.2.1.zip"
with signature
"/etc/apache2/mods-available/mod-security/modsecurity-crs/modsecurity-crs_2.2.1.zip.sig"
Signature made Wed Jul 20 20:42:26 2011 by Ryan Barnett (OWASP Core Rule Set
Project Leader) <rbarnett at trustwave.com> (ID: C976607D9624FCD2) and is not
trusted.
Signature is not trusted fully.

I imported the key into gpg and signed it locally: gpg --lsign-key
0xC976607D9624FCD2, but still get the error above.

Any hints on this?

Thank you.
-- 
       Majed B.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110817/703530c5/attachment-0001.html 

From uzoka_a at yahoo.co.uk  Wed Aug 17 11:28:56 2011
From: uzoka_a at yahoo.co.uk (kwenu)
Date: Wed, 17 Aug 2011 16:28:56 +0100
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
	detection false positives?
In-Reply-To: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
References: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
Message-ID: <4E4BDE38.6020305@yahoo.co.uk>

You could exclude checking of those cookies by putting the following in 
modsecurity_crs_15_customrules.conf

SecRule REQUEST_HEADERS:Host "!@rx (^$)" \
    
"phase:2,t:none,nolog,pass,ctl:ruleUpdateTargetById=981242;!REQUEST_COOKIES:test" 


Ive had the same problem with these rules in that they are very 
sensitive indeed by necessary
The above rule works well in that rule 981242 is not disabled entirely 
but simply ignores inspection of the named cookie.

On 17/08/11 04:34, Paul McGarry wrote:
> Hi all,
>
> I am seeing quite a lot of false positives on SQL injection errors.
>
> On of them is rule 981242 which is objecting to a cookie:
> test=asfnsdh2fub9tl6gt0mand504
> with the regex:
> (\"|'|`|?|?|?)\s*x?or|div|like|between|and\s*(\"|'|`|?|?|?)?\d
> matching on "and5"
>
> 1) Is the regex missing some grouping?
> As written it seems that (x)or is being treated differently than
> div/like/between/and, ie the (x)or case requires one of the quote
> characters before it while the others don't.
> Should that part of the regex be:
> (\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)\s*(\"|'|`|?|?|?)?\d
>
> 2) Should "and" being followed directly by a number, without space or
> a quote, be a match?
> On my SQL server (Postgres) I think "and5" would be a syntax error (as
> opposed to "and'5" or "and 5"
> Would:
> (\"|'|`|?|?|?)\s*(?:x?or|div|like|between|and)(?:(\"|'|`|?|?|?)|\s+(\"|'|`|?|?|?)?)\d
> be a tighter match?
>
> Paul

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110817/1836bd81/attachment.html 

From paul at paulmcgarry.com  Thu Aug 18 01:15:22 2011
From: paul at paulmcgarry.com (Paul McGarry)
Date: Thu, 18 Aug 2011 15:15:22 +1000
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
 detection false positives?
In-Reply-To: <CA712B19.2F8DB%rbarnett@trustwave.com>
References: <CAPrE0SYFrFRfGrCmiCV2vfYYPUatkMJJiMH1d=F4dpg-dFY63g@mail.gmail.com>
	<CA712B19.2F8DB%rbarnett@trustwave.com>
Message-ID: <CAPrE0SZ2y1DZXRysYeoo_-xUNNfELBzr-NO8fQq9QZVDAg1T=A@mail.gmail.com>

Thanks for the feedback.

On Wed, Aug 17, 2011 at 10:36 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:
> Thanks for the feedback Paul. ?FYI - you can review some of the reference

> For the specific rule you mentioned - 981242 - this is a converted phpids

Incidently there seems to be a double usage of that ID (and others
near it, 981231-981246 actually) in
modsecurity_crs_41_sql_injection_attacks.conf

> rule. ?You can review example test payloads that they use here -
> https://dev.itratos.de/projects/php-ids/repository/entry/trunk/tests/IDS/Mo
> nitorTest.php. ?Look for the public function testSQLIList() sections.

I think previously I have ended up disabling many the PHP-IDS based
rules because of the false positives.

Is there some difference between how PHP-IDS executes the rules and
how modsecurity treats them?

I note that if I put:
a_a_axoraaaaaa at aaaaa.com
in the box on
https://demo.phpids.org/
it poses no problem

while accessing

http://testing/index.php?email=a_a_axoraaaaaa%40aaaa.com

generates:

Message: Warning. Pattern match
"(?i:(\\!\\=|\\&\\&|\\|\\||>>|<<|>=|<=|<>|<=>|xor|rlike|regexp|isnull)|(?:not\\s+between\\s+0\\s+and)|(?:is\\s+null)|(like\\s+null)|(?:(?:^|\\W)in[+\\s]*\\([\\s\\d\"]+[^()]*\\))|(?:xor|<>|rlike(?:\\s+binary)?)|(?:regexp\\s+binary))"
at ARGS:email. [file
"/etc/httpd/conf.d/modsecurity-crs_2.2.1/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"]
[line "52"] [id "981212"] [rev "2.2.1"] [msg "SQL Injection Attack:
SQL Operator Detected"] [data "xor"] [severity "CRITICAL"] [tag
"WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
"OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"]

Similarly
3 Orchard Street
on the PHP_IDS demo is fine and
http://testing/index.php?street=3+Orchard+Street
gives me warnings (981248 on "3 Or" and 981242 on "3 Orc")

Ironically the rules seem to cause the most problems in places where
they might be most useful, ie where the user is actually entitled to
enter 'free text' and validation will more likely be looser than on
fields containing more defined parameters. (The anomoly score tends to
get ramped up too, such as when there is an email and an email_confirm
field on the same page or the street name appears twice in a
submission as part of both the cardholder info and shipping address.)

I do not believe the stuff I work on is vulnerable to SQL injection
but we all know about defence in depth. It would be nice to have as
much turned on as possible on (for example) a page collecting credit
card info but some of the rules seem too loose to be usable in
practice with real world input the forms should be able to receive.

Paul

From paul at paulmcgarry.com  Thu Aug 18 03:21:01 2011
From: paul at paulmcgarry.com (Paul McGarry)
Date: Thu, 18 Aug 2011 17:21:01 +1000
Subject: [Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off
	recommendations
Message-ID: <CAPrE0SZ0aq080vQrO3XJMrBmuzHs=+gXRnw=zxAORKXkOGi8WA@mail.gmail.com>

Hi all,

I have a site which is routinely scanned both internally and by
external service.
I want to have mod_security running and intervening but don't want any
of the associated log noise, the scans originate from known IPs and
have known User agents etc so I can easily identify them.

So far I have been turning the auditEngine off with things like:

SecRule REMOTE_ADDR "^123\.123\.123\.123$" "nolog,ctl:auditEngine=Off"

but I have noticed this doesn't catch everything, specifically CRS
rule 981227 (Apache Error: Invalid URI in Request).

If I understand things correctly this is because Apache is blocking
the request early and Modsec phases 1-4 don't run, it just goes
straight to 5?

Should I be putting my rule above in phase 5 (additionally or instead)?

Ryan's blog at:

http://blog.spiderlabs.com/2010/12/advanced-topic-of-the-week-handling-authorized-scanning-traffic.html

and modsecurity_crs_11_avs_traffic.conf CRS file seem to suggest that
phase 1 is the preferred place but that doesn't seem to be entirely
effective for me. Am I missing something?

Paul

From chris at jwall.org  Thu Aug 18 03:41:08 2011
From: chris at jwall.org (Christian Bockermann)
Date: Thu, 18 Aug 2011 09:41:08 +0200
Subject: [Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off
	recommendations
In-Reply-To: <CAPrE0SZ0aq080vQrO3XJMrBmuzHs=+gXRnw=zxAORKXkOGi8WA@mail.gmail.com>
References: <CAPrE0SZ0aq080vQrO3XJMrBmuzHs=+gXRnw=zxAORKXkOGi8WA@mail.gmail.com>
Message-ID: <0FA3940B-F52D-46BA-9F5F-EE2244C5A60F@jwall.org>

Hi Paul,

in which phase are you putting your ctl:auditEngine=off rule?

The ModSecurity default phase is 2. You might want to turn off the
audit-logging as soon as possible, so putting your rule into phase 1
and moving it to the very beginning should solve your problem.

Best regards,

    Chris


Am 18.08.2011 um 09:21 schrieb Paul McGarry:

> Hi all,
> 
> I have a site which is routinely scanned both internally and by
> external service.
> I want to have mod_security running and intervening but don't want any
> of the associated log noise, the scans originate from known IPs and
> have known User agents etc so I can easily identify them.
> 
> So far I have been turning the auditEngine off with things like:
> 
> SecRule REMOTE_ADDR "^123\.123\.123\.123$" "nolog,ctl:auditEngine=Off"
> 
> but I have noticed this doesn't catch everything, specifically CRS
> rule 981227 (Apache Error: Invalid URI in Request).
> 
> If I understand things correctly this is because Apache is blocking
> the request early and Modsec phases 1-4 don't run, it just goes
> straight to 5?
> 
> Should I be putting my rule above in phase 5 (additionally or instead)?
> 
> Ryan's blog at:
> 
> http://blog.spiderlabs.com/2010/12/advanced-topic-of-the-week-handling-authorized-scanning-traffic.html
> 
> and modsecurity_crs_11_avs_traffic.conf CRS file seem to suggest that
> phase 1 is the preferred place but that doesn't seem to be entirely
> effective for me. Am I missing something?
> 
> Paul
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From RBarnett at trustwave.com  Thu Aug 18 09:10:34 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 18 Aug 2011 08:10:34 -0500
Subject: [Owasp-modsecurity-core-rule-set] New Blog Post - ModSecurity
 Advanced Topic of the Week: Automated Virtual Patching Script
Message-ID: <CA72878A.2FA72%rbarnett@trustwave.com>

This blog post describes a new script that we just added to the CRS SVN repo /util directory which will auto-create virtual patches from XML data from the Arachni web application security scanner framework tool -

http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-automated-virtual-patching-script.html

Hope this script helps.  Please provide feedback and comments if you test out the script.

--
Ryan Barnett


________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Thu Aug 18 09:26:54 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 18 Aug 2011 08:26:54 -0500
Subject: [Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off
 recommendations
In-Reply-To: <CAPrE0SZ0aq080vQrO3XJMrBmuzHs=+gXRnw=zxAORKXkOGi8WA@mail.gmail.com>
Message-ID: <CA72897D.2FAE1%rbarnett@trustwave.com>


On 8/18/11 3:21 AM, "Paul McGarry" <paul at paulmcgarry.com> wrote:

>Hi all,
>
>I have a site which is routinely scanned both internally and by
>external service.
>I want to have mod_security running and intervening but don't want any
>of the associated log noise, the scans originate from known IPs and
>have known User agents etc so I can easily identify them.
>
>So far I have been turning the auditEngine off with things like:
>
>SecRule REMOTE_ADDR "^123\.123\.123\.123$" "nolog,ctl:auditEngine=Off"

Try this rule and see if it works any better -

SecRule REMOTE_ADDR "@ipMatch 123.123.123.123"
"phase:1,t:none,nolog,pass,ctl:auditEngine=Off"

This rule specifies phase:1 vs. defaulting to phase:2 if you don't
explicitly set one and it also uses the @ipMatch operator which is better
suited to handle IP addresses.


>
>but I have noticed this doesn't catch everything, specifically CRS
>rule 981227 (Apache Error: Invalid URI in Request).
>
>If I understand things correctly this is because Apache is blocking
>the request early and Modsec phases 1-4 don't run, it just goes
>straight to 5?
>
>Should I be putting my rule above in phase 5 (additionally or instead)?

Good observation. Yes, there are some requests that may be handled by
Apache before it reaches the ModSecurity hooks.  You may need to replicate
this rule to also run in phase:5.

>
>Ryan's blog at:
>
>http://blog.spiderlabs.com/2010/12/advanced-topic-of-the-week-handling-aut
>horized-scanning-traffic.html
>
>and modsecurity_crs_11_avs_traffic.conf CRS file seem to suggest that
>phase 1 is the preferred place but that doesn't seem to be entirely
>effective for me. Am I missing something?

One other monkey wrench here... Reference this JIRA ticket -
https://www.modsecurity.org/tracker/browse/MODSEC-98.  Ivan Ristic had
previously made a change to the code so that phase:1 and phase:2 actually
run in the same Apache hook (fixup phase -
https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen
ce_Manual#Processing_Phases).  This was done for a valid reason - running
rules in the post-read-request hook prevented users from nesting
ModSecurity SecRules within Apache scope locations (such as <Location>,
<Directory>, etc...).  His change fixes that, however there are some
examples where you actually want a rule to run in the old phase:1 hook
(post-read-request).  We are currently reviewing this change and
considering options.

-Ryan

>
>Paul
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From RBarnett at trustwave.com  Thu Aug 18 09:40:06 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 18 Aug 2011 08:40:06 -0500
Subject: [Owasp-modsecurity-core-rule-set] 981242 SQL Injection
 detection false positives?
In-Reply-To: <CAPrE0SZ2y1DZXRysYeoo_-xUNNfELBzr-NO8fQq9QZVDAg1T=A@mail.gmail.com>
Message-ID: <CA728B8E.2FAF4%rbarnett@trustwave.com>


On 8/18/11 1:15 AM, "Paul McGarry" <paul at paulmcgarry.com> wrote:

>Thanks for the feedback.
>
>On Wed, Aug 17, 2011 at 10:36 PM, Ryan Barnett <RBarnett at trustwave.com>
>wrote:
>> Thanks for the feedback Paul.  FYI - you can review some of the
>>reference
>
>> For the specific rule you mentioned - 981242 - this is a converted
>>phpids
>
>Incidently there seems to be a double usage of that ID (and others
>near it, 981231-981246 actually) in
>modsecurity_crs_41_sql_injection_attacks.conf

I will fix these, thanks.

>
>> rule.  You can review example test payloads that they use here -
>>
>>https://dev.itratos.de/projects/php-ids/repository/entry/trunk/tests/IDS/
>>Mo
>> nitorTest.php.  Look for the public function testSQLIList() sections.
>
>I think previously I have ended up disabling many the PHP-IDS based
>rules because of the false positives.
>
>Is there some difference between how PHP-IDS executes the rules and
>how modsecurity treats them?
>
>I note that if I put:
>a_a_axoraaaaaa at aaaaa.com
>in the box on
>https://demo.phpids.org/
>it poses no problem
>
>while accessing
>
>http://testing/index.php?email=a_a_axoraaaaaa%40aaaa.com
>
>generates:
>
>Message: Warning. Pattern match
>"(?i:(\\!\\=|\\&\\&|\\|\\||>>|<<|>=|<=|<>|<=>|xor|rlike|regexp|isnull)|(?:
>not\\s+between\\s+0\\s+and)|(?:is\\s+null)|(like\\s+null)|(?:(?:^|\\W)in[+
>\\s]*\\([\\s\\d\"]+[^()]*\\))|(?:xor|<>|rlike(?:\\s+binary)?)|(?:regexp\\s
>+binary))"
>at ARGS:email. [file
>"/etc/httpd/conf.d/modsecurity-crs_2.2.1/base_rules/modsecurity_crs_41_sql
>_injection_attacks.conf"]
>[line "52"] [id "981212"] [rev "2.2.1"] [msg "SQL Injection Attack:
>SQL Operator Detected"] [data "xor"] [severity "CRITICAL"] [tag
>"WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
>"OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"]
>
>Similarly
>3 Orchard Street
>on the PHP_IDS demo is fine and
>http://testing/index.php?street=3+Orchard+Street
>gives me warnings (981248 on "3 Or" and 981242 on "3 Orc")

The rule that triggered is not a converted PHPIDS rule but rather one that
we developed as part of the SQL Injection Challenge analysis.  This
particular rule is trying to identify common SQL Operators.  Examples here
-
https://docs.google.com/Doc?docid=0AZNlBave77hiZGNjanptbV84Z25yaHJmMjk&pli=
1#Operators_671486718712981_8325.  We tried to lessen false positives by
not triggering only on common keywords like "AND" or "IS".


>
>Ironically the rules seem to cause the most problems in places where
>they might be most useful, ie where the user is actually entitled to
>enter 'free text' and validation will more likely be looser than on
>fields containing more defined parameters. (The anomoly score tends to
>get ramped up too, such as when there is an email and an email_confirm
>field on the same page or the street name appears twice in a
>submission as part of both the cardholder info and shipping address.)

Interestingly, the reverse seems to be true :)  I posed a similar theory
internally at SpiderLabs and based on analysis of customer engagements
(from our Global Security Report - https://www.trustwave.com/GSR) totaling
more than 220 forensic investigations and more than 2300 pentests - we
found that free-text form fields are the least likely to have SQL
Injection related vulnerabilities.  Parameter types other than free-text
(numeric, drop-down lists, hidden fields, buttons, etc...) are far more
likely to have injection-type flaws as Devs wrongly assume that clients
will not (or can not) manipulate them.

-Ryan

>
>I do not believe the stuff I work on is vulnerable to SQL injection
>but we all know about defence in depth. It would be nice to have as
>much turned on as possible on (for example) a page collecting credit
>card info but some of the rules seem too loose to be usable in
>practice with real world input the forms should be able to receive.
>
>Paul
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From gvidals at vmracks.com  Thu Aug 18 12:12:14 2011
From: gvidals at vmracks.com (Gil Vidals)
Date: Thu, 18 Aug 2011 09:12:14 -0700
Subject: [Owasp-modsecurity-core-rule-set] ctl:auditEngine=Off
	recommendations
In-Reply-To: <CA72897D.2FAE1%rbarnett@trustwave.com>
References: <CAPrE0SZ0aq080vQrO3XJMrBmuzHs=+gXRnw=zxAORKXkOGi8WA@mail.gmail.com>
	<CA72897D.2FAE1%rbarnett@trustwave.com>
Message-ID: <CAOPXycT5S02rWVoD14udtVbMEw=3UKs-YXuTvPEE3=hpXkMUqg@mail.gmail.com>

I think there is a bug that won't allow us to omit log entries to the audit
log. In my case, I tried several different phases and crs files as you can
see below:

in modsecurity_crs_48_local_exceptions.conf AND I tried
modsecurity_crs_15_customrules.conf

   - SecRule REQUEST_HEADERS:User-Agent "pingdom" "nolog,noauditlog,pass"
   - SecRule REQUEST_HEADERS:User-Agent "pingdom"
   "nolog,noauditlog,pass,ctl:auditEngine=Off"


And after restarting apache, I still am getting these entries:

--4489f76b-B--
GET /account/login/?next=/ HTTP/1.0
User-Agent: Pingdom.com_bot_version_1.4_(http://www.pingdom.com/)
Host: blah.com

Gil Vidals / VM Racks
ESXi Hosting


On Thu, Aug 18, 2011 at 6:26 AM, Ryan Barnett <RBarnett at trustwave.com>wrote:

>
> On 8/18/11 3:21 AM, "Paul McGarry" <paul at paulmcgarry.com> wrote:
>
> >Hi all,
> >
> >I have a site which is routinely scanned both internally and by
> >external service.
> >I want to have mod_security running and intervening but don't want any
> >of the associated log noise, the scans originate from known IPs and
> >have known User agents etc so I can easily identify them.
> >
> >So far I have been turning the auditEngine off with things like:
> >
> >SecRule REMOTE_ADDR "^123\.123\.123\.123$" "nolog,ctl:auditEngine=Off"
>
> Try this rule and see if it works any better -
>
> SecRule REMOTE_ADDR "@ipMatch 123.123.123.123"
> "phase:1,t:none,nolog,pass,ctl:auditEngine=Off"
>
> This rule specifies phase:1 vs. defaulting to phase:2 if you don't
> explicitly set one and it also uses the @ipMatch operator which is better
> suited to handle IP addresses.
>
>
> >
> >but I have noticed this doesn't catch everything, specifically CRS
> >rule 981227 (Apache Error: Invalid URI in Request).
> >
> >If I understand things correctly this is because Apache is blocking
> >the request early and Modsec phases 1-4 don't run, it just goes
> >straight to 5?
> >
> >Should I be putting my rule above in phase 5 (additionally or instead)?
>
> Good observation. Yes, there are some requests that may be handled by
> Apache before it reaches the ModSecurity hooks.  You may need to replicate
> this rule to also run in phase:5.
>
> >
> >Ryan's blog at:
> >
> >
> http://blog.spiderlabs.com/2010/12/advanced-topic-of-the-week-handling-aut
> >horized-scanning-traffic.html
> >
> >and modsecurity_crs_11_avs_traffic.conf CRS file seem to suggest that
> >phase 1 is the preferred place but that doesn't seem to be entirely
> >effective for me. Am I missing something?
>
> One other monkey wrench here... Reference this JIRA ticket -
> https://www.modsecurity.org/tracker/browse/MODSEC-98.  Ivan Ristic had
> previously made a change to the code so that phase:1 and phase:2 actually
> run in the same Apache hook (fixup phase -
> https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Referen
> ce_Manual#Processing_Phases<https://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#Processing_Phases>).
>  This was done for a valid reason - running
> rules in the post-read-request hook prevented users from nesting
> ModSecurity SecRules within Apache scope locations (such as <Location>,
> <Directory>, etc...).  His change fixes that, however there are some
> examples where you actually want a rule to run in the old phase:1 hook
> (post-read-request).  We are currently reviewing this change and
> considering options.
>
> -Ryan
>
> >
> >Paul
> >_______________________________________________
> >Owasp-modsecurity-core-rule-set mailing list
> >Owasp-modsecurity-core-rule-set at lists.owasp.org
> >https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >
>
>
> This transmission may contain information that is privileged, confidential,
> and/or exempt from disclosure under applicable law. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution, or use of the information contained herein (including any
> reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
> in error, please immediately contact the sender and destroy the material in
> its entirety, whether in electronic or hard copy format.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Gil Vidals, VCP
gvidals at vmracks.com
www.vmracks.com - VMware Hosting Service Provider
t. 760.705.4022 IM: gilvidals at hotmail.com

HIPAA Compliant Hosting
VMware Hosting

CONFIDENTIALITY NOTICE: The information contained in this transmission may
contain privileged and confidential information.  It is intended only for
the use of the person(s) named above.  If you are not the intended
recipient, please contact the sender by reply email and permanently delete
the original message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110818/7d3debd0/attachment.html 

From Anna.Chulaki at nasa.gov  Thu Aug 18 12:33:19 2011
From: Anna.Chulaki at nasa.gov (Anna Chulaki)
Date: Thu, 18 Aug 2011 12:33:19 -0400
Subject: [Owasp-modsecurity-core-rule-set]  persistent blocking of IP
Message-ID: <6FAAED96-52FC-4D31-80A9-4184E0ED828F@nasa.gov>

I am a total newby. How can I block an IP for a while, if, for  
example, critical anomaly score reaches some point?

Anna

From RBarnett at trustwave.com  Wed Aug 24 10:54:46 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 24 Aug 2011 09:54:46 -0500
Subject: [Owasp-modsecurity-core-rule-set] Mitigation of Apache Range Header
	DoS Attack
Message-ID: <CA7A88F6.3032E%rbarnett@trustwave.com>

FYI - http://blog.spiderlabs.com/2011/08/mitigation-of-apache-range-header-dos-attack.html

If you are concerned about this attack, I suggest that you download the latest modsecurity_crs_20_protocol_violations.conf file from SVN as it has the new rules -
http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_20_protocol_violations.conf

--
Ryan Barnett
Senior Security Researcher
Trustwave - SpiderLabs


________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From ryan.barnett at owasp.org  Wed Aug 31 17:17:00 2011
From: ryan.barnett at owasp.org (Ryan Barnett)
Date: Wed, 31 Aug 2011 17:17:00 -0400
Subject: [Owasp-modsecurity-core-rule-set] Implementing OWASP AppSensor
 Detection Points in the OWASP ModSecurity Core Rule Set
Message-ID: <CA841D0C.313C1%ryan.barnett@owasp.org>

Please forgive the cross postings, but I wanted to make sure that all
relevant parties were informed of this update.  I have begun the process of
implementing the OWASP AppSensor Detection Points
(https://www.owasp.org/index.php/AppSensor_DetectionPoints) within the OWASP
ModSecurity Core Rule Set
(https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Pr
oject).  

I am pleased to announce that I have just made an update to the OWASP CRS
SVN repository that fully implements the Request Exception (RE) category -
https://www.owasp.org/index.php/AppSensor_DetectionPoints#RequestException.
See the following blog post for more details -
http://blog.spiderlabs.com/2011/08/implementing-appsensor-detection-points-i
n-modsecurity.html

The major change in this version vs. the earlier one outlined in this blog
post 
(http://blog.spiderlabs.com/2011/02/modsecurity-advanced-topic-of-the-week-r
eal-time-application-profiling.html) is that both the profiling and
detection logic has been moved to Lua scripts.  With the increased logic
capabilities of Lua, we are now able to more accurately profile the
application in real-time by analyzing traffic and automatically generating
profiles for the following resource characteristics -
* Enforcing the expected Request Method(s)
* Enforce the number of expected parameters (min-max range)
* Enforce parameter names
* Enforce parameter lengths (min-max range)
* Enforce Character Classes
> * Flag (e.g. - /path/to/foo.php?param)
> * Digits  (e.g. - /path/to/foo.php?param=1234)
> * Alpha  (e.g. - /path/to/foo.php?param=abcd)
> * AlphaNumeric  (e.g. - /path/to/foo.php?param=abcd1234)
> * Email  (e.g. - /path/to/foo.php?param=foo at bar.com)
> * Path  (e.g. - /path/to/foo.php?param=/dir/somefile.txt)
> * URL  (e.g. - /path/to/foo.php?param=http://somehost/dir/file.txt)
> * SafeText  (e.g. - /path/to/foo.php?param=some_data-12)
The updated rules files are in the /experimental_rules directory -
http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/experi
mental_rules/
Look in the /lua folder to find the 2 scripts -
http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/lua/

I encourage people to test out these new rules and to report back their
experiences ? both good and bad.

FYI ? I also wanted to thank Josh Zlatin for assisting with the initial Lua
script creation.

Cheers.

--
Ryan Barnett
OWASP ModSecurity Core Rule Set Project Leader


-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110831/d776cc3b/attachment.html 

From majedb at gmail.com  Wed Aug 31 19:11:54 2011
From: majedb at gmail.com (Majed B.)
Date: Thu, 1 Sep 2011 02:11:54 +0300
Subject: [Owasp-modsecurity-core-rule-set] Lots of false positives with
	wordpress
Message-ID: <CAKA73TDqHAU3w-riA4+dVDXLLrMyzJ+cAFQCi5Nd_cGH=Ah4CQ@mail.gmail.com>

Hello,

I have just configured mod_security (2.6) with rule set 2.2.1. My
website runs wordpress 3.2.1. mod-sec is running in detection only
mode.

As soon as I restarted apache, I saw many warnings in the error log as
visitors come to the site. First, visitors were denied access because
of a false positive on cookie session hijacking, then when I disabled
optional_rules altogether, I started getting warnings about SQLi
attacks when I tried to login to the admin panel of wordpress.

Here's a sample of the error of the SQLi warning:

[Thu Sep 01 01:57:35 2011] [error] [client 98.158.123.158]
ModSecurity: Warning. Operator GE matched 5 at
TX:restricted_sqli_char_count. [file
"/etc/modsecurity/modsecurity-crs/2.2.1/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"]
[line "551"] [id "981173"] [rev "2.2.1"] [msg "Restricted SQL
Character Anomaly Detection Alert - Total # of special characters
exceeded"] [data "9"] [hostname "xyz.com"] [uri "/wp-admin/admin.php"]
[unique_id "Tl68X04vrrwAAEeUFbUAAAAF"]
[Thu Sep 01 01:57:36 2011] [error] [client 98.158.123.158]
ModSecurity: Warning. Operator LT matched 5 at
TX:inbound_anomaly_score. [file
"/etc/modsecurity/modsecurity-crs/2.2.1/base_rules/modsecurity_crs_60_correlation.conf"]
[line "33"] [id "981203"] [msg "Inbound Anomaly Score (Total Inbound
Score: 3, SQLi=10, XSS=): Restricted SQL Character Anomaly Detection
Alert - Total # of special characters exceeded"] [hostname "xyz.com"]
[uri "/wp-admin/admin.php"] [unique_id "Tl68X04vrrwAAEeUFbUAAAAF"]

(Note: I renamed the domain name to xyz.com)

I tried increasing the @ge value from 4 to 5, and it stopped the
warnings from showing when only browsing the login page, but after I
login, the warnings keep pouring. I don't know what is a suitable
value to be put there.

