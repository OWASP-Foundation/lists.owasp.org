<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS/CSP%20brain%20storm&In-Reply-To=%3CBAY169-DS106FFD9E06D0B07601C129A43A0%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001445.html">
   <LINK REL="Next"  HREF="001447.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm</H1>
    <B>Rolling Stone</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS/CSP%20brain%20storm&In-Reply-To=%3CBAY169-DS106FFD9E06D0B07601C129A43A0%40phx.gbl%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm">jzy2000 at hotmail.com
       </A><BR>
    <I>Thu Sep 12 20:47:04 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001445.html">[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
</A></li>
        <LI>Next message: <A HREF="001447.html">[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1446">[ date ]</a>
              <a href="thread.html#1446">[ thread ]</a>
              <a href="subject.html#1446">[ subject ]</a>
              <a href="author.html#1446">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Those are exact help I am looking for from ModSec community... identify limitations, weaknesses and possibly improve comprehension&#8230; 

*	&quot;1'st: how would you deal with JS embeded in JSON, with HTML with events embedded in JS and/or JSON and/or XML?&quot;
First I don't pretend to be Web2.0 expert.
With DOM traversing and static analysis technique like inline-code-finder, detecting JS embedded in events and style should not be too hard. <A HREF="https://chrome.google.com/webstore/detail/inline-code-finder/lfllandeffkmadbndfckhdbkekdfahom#detail/inline-code-finder/lfllandeffkmadbndfckhdbkekdfahom">https://chrome.google.com/webstore/detail/inline-code-finder/lfllandeffkmadbndfckhdbkekdfahom#detail/inline-code-finder/lfllandeffkmadbndfckhdbkekdfahom</A>

If I understood correctly, JS in JSON, XML or custom data format are content cannot not directly be executed by browser without having JS to fetch and call eval(), correct? If so, you are right, I agree that static inline-JS parsing/removing will not detect code loaded at run-time, however...we rely on CSP *unsafe-eval* and *report-uri* directives for browsers to report and submit policy violation to server, in those cases, admin can choose to manually fix or making exemptions manually or automatically.

*	To your 2nd point: &quot;2'nd: if all the learned rules are configured, how do we get rid of old rules?&quot;
Previously stored metadata(configuration) should be *ALWAYS* refreshed only when sees request from trusted source for two reasons: making sure traffic under analyzing are normal traffic; preventing metadata from poisoning by attackers. Note: so called &quot;Learning-mode&quot; is different than conventional one, it can be set to always-On, using it whenever web apps change partially or entirely.

Realistically, Even CSP 1.0 is not silver bullet, it leaves .innerHTML, .outHTML etc. unprotected, where JS can also be loaded at run-time.
If a XSS defense can be *applied generically and safely*, majority use cases say 60% of legacy Webapps regardless of backend technologies are covered, will you agree that is worth of exploring?

Thanks,
R.S

-----Original Message-----
From: Achim [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">achim at owasp.org</A>] 
Sent: September-12-13 3:23 PM
To: Rolling Stone
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: Re: [Owasp-modsecurity-core-rule-set] XSS/CSP brain storm


Am 12.09.2013 16:54, schrieb Rolling Stone:

&gt;<i> In &quot;learning mode&quot;, creating Lua script to:
</I>
Hmm, &quot;learning mode&quot; is WAF sales man's magic pitch. However it would be a good technique if it works.

&gt;<i> 1-     Intercept and scan response data, parses HTML and identify inline JS
</I>&gt;<i> and JS embedded in HTML events. 
</I>
1'st: how would you deal with JS embeded in JSON, with HTML with events embedded in JS and/or JSON and/or XML?
What will be with other formats like DWR, GWT?
And then there are obfuscated scripts, or packed, etc..

2'nd: if all the learned rules are configured, how do we get rid of old rules?
(I guess rapid web developing is faster than &quot;learning mode&quot;:)

These are not ModSecurity or CRS problems, and can be found in any other WAF with &quot;learning mode&quot; too.

Sorry for asking questions instead of providing solutions.
Parsing and detecting JS correctly in modern web apps is an infinite job.

Achim


-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130912/6b1f7c53/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130912/6b1f7c53/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001445.html">[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
</A></li>
	<LI>Next message: <A HREF="001447.html">[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1446">[ date ]</a>
              <a href="thread.html#1446">[ thread ]</a>
              <a href="subject.html#1446">[ subject ]</a>
              <a href="author.html#1446">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
