<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS/CSP%20brain%20storm&In-Reply-To=%3CCE578DEA.B6702%25ryan.barnett%40owasp.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001447.html">
   <LINK REL="Next"  HREF="001449.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS/CSP%20brain%20storm&In-Reply-To=%3CCE578DEA.B6702%25ryan.barnett%40owasp.org%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm">RBarnett at trustwave.com
       </A><BR>
    <I>Fri Sep 13 14:22:52 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001447.html">[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
</A></li>
        <LI>Next message: <A HREF="001449.html">[Owasp-modsecurity-core-rule-set] DoS Protection Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1448">[ date ]</a>
              <a href="thread.html#1448">[ thread ]</a>
              <a href="subject.html#1448">[ subject ]</a>
              <a href="author.html#1448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
From: Rolling Stone &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jzy2000 at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jzy2000 at hotmail.com</A>&gt;&gt;
Date: Thursday, September 12, 2013 10:54 AM
To: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: [Owasp-modsecurity-core-rule-set] XSS/CSP brain storm

Many agree that deploying CSP for Web apps is a hassle, one of which requires externalizing all inline JS.

I would like to discuss about the idea of making this process automated by ModSecurity Core rule set with assistant of Lua script, can anyone help me validate this idea? Here is workflow:

In &#8220;learning mode&#8221;, creating Lua script to:

1-     Intercept and scan response data, parses HTML and identify inline JS and JS embedded in HTML events.

2-     Then, creating a new .js file to include identified JS, store(e.g. FTP) it in one of web location can be accessed by public domain.

3-     Remove inline JS blocks from response.

4-     Replace HTML event with new JS function for event call from response.

5-     Calculate CSP content based on original response as well as adding location for newly generated .js file.

6-     Append generated CSP headers to response.

7-     Save metadata info (i.e. new .js file name, hash of original response, request URL to local data store for caching (performance consideration)
&#8220;Learning mode&#8221; is referring to Core rule set performing above actions ONLY when it sees request from trusted source such as given IP address.
Automated requested can be sent by open sources web crawlers available out there, or web browsers manually.

Thanks,
R.S.


First of all &#8211; I agree with your problem statement.  While CSP has value, orgs have a difficult time retro-fitting their apps to support it.  If you have not see it, please see my recently blog post on how to implement CSP as a part of virtual patching remediation for XSS vulns -
<A HREF="http://blog.spiderlabs.com/2013/07/modsecurity-advanced-topic-of-the-week-mitigating-xss-vulnerabilities-using-targeted-csp-enforcement.html">http://blog.spiderlabs.com/2013/07/modsecurity-advanced-topic-of-the-week-mitigating-xss-vulnerabilities-using-targeted-csp-enforcement.html</A>

I like your idea however it would not be easy&#8230;  As Achim mentioned, doing proper parsing/extraction of JS data, etc&#8230; would be challenging.

Due to the extensive respnose data changes needed here, this would probably best suited for some new additional engine vs. Lua API.

I do think this idea is work exploring however.

-Ryan


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130913/952769f6/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130913/952769f6/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001447.html">[Owasp-modsecurity-core-rule-set] XSS/CSP brain storm
</A></li>
	<LI>Next message: <A HREF="001449.html">[Owasp-modsecurity-core-rule-set] DoS Protection Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1448">[ date ]</a>
              <a href="thread.html#1448">[ thread ]</a>
              <a href="subject.html#1448">[ subject ]</a>
              <a href="author.html#1448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
