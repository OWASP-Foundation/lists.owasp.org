From arthurjohnston at verizon.net  Wed Jul  5 01:25:39 2017
From: arthurjohnston at verizon.net (Arthur E. Johnston)
Date: Tue, 4 Jul 2017 18:25:39 -0700
Subject: [Owasp-modsecurity-core-rule-set]  Whitelist?
Message-ID: <000801d2f52d$9d168d40$d743a7c0$@verizon.net>

Does a method exist to whitelist an IP address?

 

Thank you,

 

Arthur Johnston

Meadowbrook Kennels

Home of Seacrest Cocker Spaniels & Meadowbrook Border Terriers

http://www.seacrestcockers.com

http://www.meadowbrook.co

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170704/e963e14a/attachment.html>

From oelnaggar04 at gmail.com  Wed Jul  5 01:56:17 2017
From: oelnaggar04 at gmail.com (Osama Elnaggar)
Date: Tue, 4 Jul 2017 21:56:17 -0400
Subject: [Owasp-modsecurity-core-rule-set] Whitelist?
In-Reply-To: <000801d2f52d$9d168d40$d743a7c0$@verizon.net>
References: <000801d2f52d$9d168d40$d743a7c0$@verizon.net>
Message-ID: <CACva_gELrMgos88niMMF7MvWQJyvhxHtOJoL7-CiayTQY_NhHg@mail.gmail.com>

If you are using CRS 3, you have your request exclusion rules in the file
REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example Remove the .example and
uncomment the exclusion rules you want.  Here is an example of a commented
rule that will whitelist an IP:

# White-list ASV network block (no blocking or logging of AVS traffic)
Update
# IP network block as appropriate for your AVS traffic
#
# ModSec Rule Exclusion: Disable Rule Engine for known ASV IP
# SecRule REMOTE_ADDR "@ipMatch 192.168.1.100" \
#     "phase:1,id:1000,pass,nolog,ctl:ruleEngine=Off"

Even if you aren't using CRS, you can use the above rule and customize it
with the IP you want to whitelist

-- 
Osama Elnaggar

On July 5, 2017 at 11:27:31 AM, Arthur E. Johnston (
arthurjohnston at verizon.net) wrote:

Does a method exist to whitelist an IP address?



Thank you,



Arthur Johnston

Meadowbrook Kennels

Home of Seacrest Cocker Spaniels & Meadowbrook Border Terriers

http://www.seacrestcockers.com

http://www.meadowbrook.co
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170704/3804794b/attachment.html>

From arthurjohnston at verizon.net  Wed Jul  5 03:10:51 2017
From: arthurjohnston at verizon.net (Arthur E. Johnston)
Date: Tue, 4 Jul 2017 20:10:51 -0700
Subject: [Owasp-modsecurity-core-rule-set] Whitelist?
In-Reply-To: <CACva_gELrMgos88niMMF7MvWQJyvhxHtOJoL7-CiayTQY_NhHg@mail.gmail.com>
References: <000801d2f52d$9d168d40$d743a7c0$@verizon.net>
	<CACva_gELrMgos88niMMF7MvWQJyvhxHtOJoL7-CiayTQY_NhHg@mail.gmail.com>
Message-ID: <000201d2f53c$4f67a0c0$ee36e240$@verizon.net>

Thank you!

 

Arthur Johnston

Meadowbrook Kennels

 

From: Osama Elnaggar [mailto:oelnaggar04 at gmail.com] 
Sent: Tuesday, July 04, 2017 6:56 PM
To: Arthur E. Johnston <arthurjohnston at verizon.net>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Whitelist?

 

If you are using CRS 3, you have your request exclusion rules in the file REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example Remove the .example and uncomment the exclusion rules you want.  Here is an example of a commented rule that will whitelist an IP:

 

# White-list ASV network block (no blocking or logging of AVS traffic) Update

# IP network block as appropriate for your AVS traffic

#

# ModSec Rule Exclusion: Disable Rule Engine for known ASV IP

# SecRule REMOTE_ADDR "@ipMatch 192.168.1.100" \

#     "phase:1,id:1000,pass,nolog,ctl:ruleEngine=Off"

 

Even if you aren't using CRS, you can use the above rule and customize it with the IP you want to whitelist

 

-- 
Osama Elnaggar

 

On July 5, 2017 at 11:27:31 AM, Arthur E. Johnston (arthurjohnston at verizon.net <mailto:arthurjohnston at verizon.net> ) wrote:

Does a method exist to whitelist an IP address?

 

Thank you,

 

Arthur Johnston

Meadowbrook Kennels

Home of Seacrest Cocker Spaniels & Meadowbrook Border Terriers

http://www.seacrestcockers.com

http://www.meadowbrook.co

_______________________________________________ 
Owasp-modsecurity-core-rule-set mailing list 
Owasp-modsecurity-core-rule-set at lists.owasp.org <mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>  
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170704/86c53bd0/attachment.html>

From christian.folini at netnea.com  Fri Jul  7 08:25:35 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 7 Jul 2017 10:25:35 +0200
Subject: [Owasp-modsecurity-core-rule-set] News from the Core Rule Set
	(2017-07-07)
Message-ID: <20170707082535.ughcumlptvkake4j@leander>

Dear all,

This is the CRS newsletter covering the period from June until today.

I was not sure I had the time to compile this message in time as I
am currently attending a medieval reenactment event with the
Company of St. George. But the camp is now set up for the weekend,
all is quite and I sneaked off to write the newsletter. Hope
nobody sees me any my notebook...

What has happened during the last few weeks:

- We held our community chat last Monday. Outside of administrative
  topics, we looked into some of the open issues and talked about
  plans for the 3.1 release.
  The next community chats will be held on the following dates:
  - Aug 7, 2017, 20:30 CEST (14:30 EST, 19:30 GMT)
  - Sep 4, 2017, 20:30 CEST
  - Oct 2, 2017, 20:30 CEST
  - Nov 6, 2017, 20:30 CET
  - Dec 4, 2017, 20:30 CET

- So what are the plans for 3.1?
  - Chaim thinks that the whole SQL rules are hard to overview and even
  chaotic despite a consolidation effort by Ryan Barnett around the
  2.2.4 release. So Chaim wants to review and possibly re-organise
  sqli detection.
  - Walter is sick of not detecting Java exploits and he plans to
  write new rules to stop that attack vector.
  - Franziska volunteered to try and disassemble the roughly three dozens
  of highly optimized regular expressions in CRS. She worked on issue
  811 and thinks that this archaeological work is just her thing. Given 
  my background in history, I appreciate all efforts in rule archaeologicy.
  - And finally, we all agreed that the situation with false positives
  with non-western languages is unbearable. Victor has made some
  very useful observations, we think that some ModSecurity transformations
  might be at fault here too and we want to come up a clean and
  workable solution here. But this is going to be tough.

  Generally, there has to be a balance between closing existing holes with the
  detection and extending the detection capabilities towards new areas. It
  looks as if the scanning of uploaded files with Fuzzy Hashing was not 
  immediately on the table (unless somebody thinks this would be great and 
  takes up the task to implement it).

- When I talked about a couple of weeks until we have the new logo
  I did not define "couple". What I can say now is that a couple of
  weeks is more than 4 and that it's only a matter of a couple of days
  now until the new logo. But the latest drafts are really promising.

- Our twitter account @CoreRuleSet is online, but we did not start tweeting
  yet. We want to wait for the logo, because who want's to tweet from a
  naked account.

- The new project website is being prepared as I write this. Walter 
  settled on a design theme and he is actively looking into creating 
  content together with Chaim. The idea is to use the website actively
  as a site for blogging about the project.
  Walter is aiming for a launch of the site in early August.

- In May, we announced Franziska Buehler (franbuehler) and Christoph
  Hansen (emphazer) had joined the project as developers. In the
  meantime, we also added Victor Hora to the rooster. However, we
  encountered difficulties when granting them commit permission. The
  case with Victor was easy. Given he is a Trustwave employee, he
  is part of Trustwave Spiderlabs and got immediate commit rights
  on our project as our repository is hosted on github under the
  Spiderlabs organisation. Bringing new people into our projects
  means they need to be granted commit rights by the Spiderlabs
  admins. This was never an issue as long as project lead Chaim
  worked for Spiderlabs, but he quit and now we depend on the
  goodwill of Trustwave with this. We could move the repository
  of course, but that is a huge hassle for little gain.
  After lobbying for several weeks, Franziska and Christoph
  finally got the requested permissions on Wednesday and we have
  been promised that granting the permissions to non-Spiderlabs
  developers was now generally resolved and the next
  ones will be easier. Keeping our fingers crossed.
  We thank Franziska and Christoph for their patience. And we
  also thank Trustwave / Spiderlabs for the goodwill they continue
  to show towards our project. Trustwave has been stewarding 
  ModSecurity and CRS for many years and when Chaim quit his job 
  in February, we knew there might be hassles. But we are still in 
  close contact and resolving issues as this helps building the 
  mutual trust.

- The groups of new bypasses reported here last month is still open.
  There is a new ModSecurity release pending that will include an
  updated libinjection with better detection capabilities. But there
  is also going to be a new rule or several rules in CRS. It's just
  not ready yet.

Upcoming stuff

- Having attended my CRS talk at AppSecEU, the OWASP chapter London
  has invited me to present at their regular chapter meeting on
  July 27.
  https://www.eventbrite.co.uk/e/owasp-london-chapter-meeting-thursday-27th-july-2017-630pm-tickets-33237474180
  There is a limited number of seats, so reserve it in time.
  However, they are also planning to a livestream of the event.
  Please check out OWASP London on twitter on infos about this.

- OWASP Switzerland has also invited me to their meeting in Zurich
  in August. This is likey to happen on August 19, but the date
  is not fixed. And there is also a CRS presentation at OWASP Geneva
  planned in September or so.

- Feisty Duck and I announced two two-day courses about ModSecurity
  and CRS. These are the dates:
  - London: 4-5 October 2017
  - Zurich: 11-12 October 2017
  https://www.feistyduck.com/training/modsecurity-training-course
  We have early bird subscriptions open until the end of the month.
  Afterwards, the price will raise by 25%. Obviously, I would be
  very happy if we would have large and diverse classes that
  allow for interesting discussions from people with different
  perspectives (that's the best part of the courses for me :) 

- Next CRS chat: August 7, 2017, 20:30 CEST on Freenode IRC, channel
  #modsecurity (14:30 EST, 19:30 GMT)

So, I hope I did not forget too many things. It's time to walk back
into our medieval camp and I wish you all a lovely July!

Christian

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From airween at gmail.com  Fri Jul  7 12:24:35 2017
From: airween at gmail.com (Ervin =?utf-8?Q?Heged=C3=BCs?=)
Date: Fri, 7 Jul 2017 14:24:35 +0200
Subject: [Owasp-modsecurity-core-rule-set] Woe with 920270 (Null
 Byte...) (was: Re: Matched rule modification)
In-Reply-To: <20170601064903.mwgxlv5dxq6ccrp6@leander>
References: <20170530141946.GA26620@arxnet.hu>
	<CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
	<20170531063203.GB1908@arxnet.hu>
	<20170601064903.mwgxlv5dxq6ccrp6@leander>
Message-ID: <20170707122435.GA16567@arxnet.hu>

Hi Christian and Chaim,
other CRS users,


here is my previous e-mail with an issue (with more issues
exactly, but this one whis is interesting now)

On Thu, Jun 01, 2017 at 08:49:03AM +0200, Christian Folini wrote:
> 
> On Wed, May 31, 2017 at 08:32:03AM +0200, Ervin Heged?s wrote:
> > And there is an another issue with 3.0.2 (but may be that affects
> > another versions too).
> > 
> > The request is similar that I detailed in my first post. The
> > "extraParams" value (JSON field) is this:
...

and you sent me your test:

> I was kind of expecting problems with 920270, but probably not as
> deep rooted ones as this. But first, I need to be able to reproduce
> this, and I can't.
> 
> Here is my curl call taking up your example:
> 
> curl 'localhost/index.html' -d 'extraParams=%7B%22node%22%3A%223%22%2C%22text%22%3A%22v%C3%A9gs%C5%91%20fejezet%22' --trace-ascii -
> == Info:   Trying 127.0.0.1...
> == Info: Connected to localhost (127.0.0.1) port 80 (#0)
> => Send header, 153 bytes (0x99)

...


now the situation is totally same like above, but the server is
another, and the web application is an up-to-date RoundCube
webmail.

The issue is when I'ld like to compose a new mail and I'm using
special hungarian characters, Modsecurity denies the request.

Here is the curl test:

curl "https://roundcube.mydomain.hu/" -d "_token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&_id=1466771890595f68c41f875&_attachments=&_from=5&_to=airween%40gmail.com&_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+0707+1256&editorSelector=plain&_priority=0&_store_target=Sent&_draft_saveid=&_draft=&_is_html=0&_framed=1&_message=Pr%C3%B3ba+%C3%BCzenet." --trace-ascii -
== Info: Hostname was NOT found in DNS cache
== Info:   Trying 1.2.3.4...
== Info: Connected to roundcube.mydomain.hu (1.2.3.4) port 443 (#0)
== Info: successfully set certificate verify locations:
== Info:   CAfile: none
  CApath: /etc/ssl/certs
== Info: SSLv3, TLS handshake, Client hello (1):
=> Send SSL data, 512 bytes (0x200)
0000: ........rJK..M`4Qg9.)..........r7.....v.0.,.(.$.........k.j.9.
...
== Info: 	 SSL certificate verify ok.
=> Send header, 159 bytes (0x9f)
0000: POST / HTTP/1.1
0011: User-Agent: curl/7.38.0
002a: Host: roundcube.mydomain.hu
004a: Accept: */*
0057: Content-Length: 330
006c: Content-Type: application/x-www-form-urlencoded
009d: 
=> Send data, 330 bytes (0x14a)
0000: _token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&
0040: _id=1466771890595f68c41f875&_attachments=&_from=5&_to=airween%40
0080: gmail.com&_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+
00c0: 0707+1256&editorSelector=plain&_priority=0&_store_target=Sent&_d
0100: raft_saveid=&_draft=&_is_html=0&_framed=1&_message=Pr%C3%B3ba+%C
0140: 3%BCzenet.
== Info: upload completely sent off: 330 out of 330 bytes
<= Recv header, 24 bytes (0x18)
0000: HTTP/1.1 403 Forbidden
== Info: Server nginx/1.6.2 is not blacklisted
<= Recv header, 21 bytes (0x15)
0000: Server: nginx/1.6.2
<= Recv header, 37 bytes (0x25)
0000: Date: Fri, 07 Jul 2017 11:57:13 GMT
<= Recv header, 25 bytes (0x19)
0000: Content-Type: text/html
<= Recv header, 21 bytes (0x15)
0000: Content-Length: 168
<= Recv header, 24 bytes (0x18)
0000: Connection: keep-alive
<= Recv header, 2 bytes (0x2)
0000: 
<= Recv data, 168 bytes (0xa8)
0000: <html>
0008: <head><title>403 Forbidden</title></head>
0033: <body bgcolor="white">
004b: <center><h1>403 Forbidden</h1></center>
0074: <hr><center>nginx/1.6.2</center>
0096: </body>
009f: </html>


The audit log contains these lines for that request?

ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter `1-255' against variable `ARGS:_message' (Value: `Pr\xffffffc3\xffffffb3ba \xffffffc3\xffffffbczenet.' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id "920270"] [rev "2"] [msg "Invalid character in request (null character)"] [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o2,1o3,1v333,16t:urlDecodeUnio2,1o3,1o7,1o8,1v459,15t:urlDecodeUni"]
ModSecurity: Warning. Matched "Operator `Ge' with parameter `%{tx.inbound_anomaly_score_threshold}' against variable `TX:ANOMALY_SCORE' (Value: `8' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] [line "36"] [id "949110"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Score: 8)"] [data ""] [severity "2"] [ver ""] [maturity "0"] [accuracy "0"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-generic"] [ref ""]
ModSecurity: Warning. Matched "Operator `Ge' with parameter `%{tx.inbound_anomaly_score_threshold}' against variable `TX:INBOUND_ANOMALY_SCORE' (Value: `8' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf"] [line "61"] [id "980130"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Inbound Score: 8 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): Invalid character in request (null character)'"] [data ""] [severity "0"] [ver ""] [maturity "0"] [accuracy "0"] [tag "event-correlation"] [ref ""]

Note, that when I put the special characters to subject of mail,
and the body contains only ascii chars, the rule doesn't
triggered:

_token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&_id=1061864000595f7c3bc5c2e&_attachments =&_from=5&_to=airween%40gmail.com&_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+mail+0707+1419 &editorSelector=plain&_priority=0&_store_target=Sent&_draft_saveid=&_draft=&_is_html=0&_framed=1&_message=Teszt+uzenet.

but the audit log contains a line:

ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter `1-255' against variable `ARGS:_subject' (Value: `Pr\xffffffc3\xffffffb3ba mail 0707 1419' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id "920270"] [rev "2"] [msg "Invalid character in request (null character)"] [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o2,1o3,1v857,21t:urlDecodeUni"]


What em I missing?


Thanks,


a.



From airween at gmail.com  Fri Jul  7 18:44:10 2017
From: airween at gmail.com (Ervin =?utf-8?Q?Heged=C3=BCs?=)
Date: Fri, 7 Jul 2017 20:44:10 +0200
Subject: [Owasp-modsecurity-core-rule-set] Woe with 920270 (Null
 Byte...) (was: Re: Matched rule modification)
In-Reply-To: <CAE8hE=oPfQgEjOJ4=OtZA0Mjidae09_k8K-p17F-KaAyH96f_w@mail.gmail.com>
References: <20170530141946.GA26620@arxnet.hu>
	<CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
	<20170531063203.GB1908@arxnet.hu>
	<20170601064903.mwgxlv5dxq6ccrp6@leander>
	<20170707122435.GA16567@arxnet.hu>
	<CAE8hE=oPfQgEjOJ4=OtZA0Mjidae09_k8K-p17F-KaAyH96f_w@mail.gmail.com>
Message-ID: <20170707184410.GB24713@arxnet.hu>

Hi Chaim,

On Fri, Jul 07, 2017 at 10:46:22AM -0400, Chaim Sanders wrote:
> Taking a quick look here, it appears that the problem is probably with
> urldecodeuni but it also might not be solvable. Let me explain, If I recall
> correctly the reason that we added request_uri and ARGS as a parameter is
> that they require provided elements to be ASCII. The alternative is that in
> PL1 we thought that only ASCII should be submitted as args, which seems
> wrong.
> However we see that there is the use of urldecodeuni, which will decode
> even unicode chars into the base char points. Stepping aside from the other
> Unicode problems we've been seeing as a result of some ModSec issues
> (purportedly), the use of this transformation will defeat the purpose of
> this rule, as it will fire whenever a unicode element has been received.
> The real question/possible problem, is that as we learned before
> Apache/Nginx will provide us with automatically urldecoded arguments (and
> url's maybe). This in turn might mean that it is never possible to ensure
> that URL's and Args were all ASCII as is required by spec.
> Requires a little bit more testing and verification of the purpose of the
> rule, but i'd guess this is the cause of your issue.
 
thanks for your detailed anwser, I think I understand most of it :).

Probably I can't do anything till you can't find the final
solution.

What can I help you? I mean, may be I can build the old
Modsecurity version with Apache, or Nginx, and can try with old
CRS...


Thanks,


a.

> On Fri, Jul 7, 2017 at 8:24 AM, Ervin Heged?s <airween at gmail.com> wrote:
> 
> > Hi Christian and Chaim,
> > other CRS users,
> >
> >
> > here is my previous e-mail with an issue (with more issues
> > exactly, but this one whis is interesting now)
> >
> > On Thu, Jun 01, 2017 at 08:49:03AM +0200, Christian Folini wrote:
> > >
> > > On Wed, May 31, 2017 at 08:32:03AM +0200, Ervin Heged?s wrote:
> > > > And there is an another issue with 3.0.2 (but may be that affects
> > > > another versions too).
> > > >
> > > > The request is similar that I detailed in my first post. The
> > > > "extraParams" value (JSON field) is this:
> > ...
> >
> > and you sent me your test:
> >
> > > I was kind of expecting problems with 920270, but probably not as
> > > deep rooted ones as this. But first, I need to be able to reproduce
> > > this, and I can't.
> > >
> > > Here is my curl call taking up your example:
> > >
> > > curl 'localhost/index.html' -d 'extraParams=%7B%22node%22%3A%
> > 223%22%2C%22text%22%3A%22v%C3%A9gs%C5%91%20fejezet%22' --trace-ascii -
> > > == Info:   Trying 127.0.0.1...
> > > == Info: Connected to localhost (127.0.0.1) port 80 (#0)
> > > => Send header, 153 bytes (0x99)
> >
> > ...
> >
> >
> > now the situation is totally same like above, but the server is
> > another, and the web application is an up-to-date RoundCube
> > webmail.
> >
> > The issue is when I'ld like to compose a new mail and I'm using
> > special hungarian characters, Modsecurity denies the request.
> >
> > Here is the curl test:
> >
> > curl "https://roundcube.mydomain.hu/" -d "_token=
> > 0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&_
> > id=1466771890595f68c41f875&_attachments=&_from=5&_to=airween%40gmail.com
> > &_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+0707+1256&
> > editorSelector=plain&_priority=0&_store_target=Sent&
> > _draft_saveid=&_draft=&_is_html=0&_framed=1&_message=Pr%C3%B3ba+%C3%BCzenet."
> > --trace-ascii -
> > == Info: Hostname was NOT found in DNS cache
> > == Info:   Trying 1.2.3.4...
> > == Info: Connected to roundcube.mydomain.hu (1.2.3.4) port 443 (#0)
> > == Info: successfully set certificate verify locations:
> > == Info:   CAfile: none
> >   CApath: /etc/ssl/certs
> > == Info: SSLv3, TLS handshake, Client hello (1):
> > => Send SSL data, 512 bytes (0x200)
> > 0000: ........rJK..M`4Qg9.)..........r7.....v.0.,.(.$.........k.j.9.
> > ...
> > == Info:         SSL certificate verify ok.
> > => Send header, 159 bytes (0x9f)
> > 0000: POST / HTTP/1.1
> > 0011: User-Agent: curl/7.38.0
> > 002a: Host: roundcube.mydomain.hu
> > 004a: Accept: */*
> > 0057: Content-Length: 330
> > 006c: Content-Type: application/x-www-form-urlencoded
> > 009d:
> > => Send data, 330 bytes (0x14a)
> > 0000: _token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&
> > 0040: _id=1466771890595f68c41f875&_attachments=&_from=5&_to=airween%40
> > 0080: gmail.com&_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+
> > 00c0: 0707+1256&editorSelector=plain&_priority=0&_store_target=Sent&_d
> > 0100: raft_saveid=&_draft=&_is_html=0&_framed=1&_message=Pr%C3%B3ba+%C
> > 0140: 3%BCzenet.
> > == Info: upload completely sent off: 330 out of 330 bytes
> > <= Recv header, 24 bytes (0x18)
> > 0000: HTTP/1.1 403 Forbidden
> > == Info: Server nginx/1.6.2 is not blacklisted
> > <= Recv header, 21 bytes (0x15)
> > 0000: Server: nginx/1.6.2
> > <= Recv header, 37 bytes (0x25)
> > 0000: Date: Fri, 07 Jul 2017 11:57:13 GMT
> > <= Recv header, 25 bytes (0x19)
> > 0000: Content-Type: text/html
> > <= Recv header, 21 bytes (0x15)
> > 0000: Content-Length: 168
> > <= Recv header, 24 bytes (0x18)
> > 0000: Connection: keep-alive
> > <= Recv header, 2 bytes (0x2)
> > 0000:
> > <= Recv data, 168 bytes (0xa8)
> > 0000: <html>
> > 0008: <head><title>403 Forbidden</title></head>
> > 0033: <body bgcolor="white">
> > 004b: <center><h1>403 Forbidden</h1></center>
> > 0074: <hr><center>nginx/1.6.2</center>
> > 0096: </body>
> > 009f: </html>
> >
> >
> > The audit log contains these lines for that request?
> >
> > ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter
> > `1-255' against variable `ARGS:_message' (Value: `Pr\xffffffc3\xffffffb3ba
> > \xffffffc3\xffffffbczenet.' ) [file "/etc/nginx/owasp-modsecurity-
> > crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id
> > "920270"] [rev "2"] [msg "Invalid character in request (null character)"]
> > [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
> > "9"] [tag "application-multi"] [tag "language-multi"] [tag
> > "platform-multi"] [tag "attack-protocol"] [tag
> > "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o2,1o3,1v333,16t:
> > urlDecodeUnio2,1o3,1o7,1o8,1v459,15t:urlDecodeUni"]
> > ModSecurity: Warning. Matched "Operator `Ge' with parameter
> > `%{tx.inbound_anomaly_score_threshold}' against variable
> > `TX:ANOMALY_SCORE' (Value: `8' ) [file "/etc/nginx/owasp-modsecurity-
> > crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] [line "36"] [id
> > "949110"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Score: 8)"]
> > [data ""] [severity "2"] [ver ""] [maturity "0"] [accuracy "0"] [tag
> > "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> > "attack-generic"] [ref ""]
> > ModSecurity: Warning. Matched "Operator `Ge' with parameter
> > `%{tx.inbound_anomaly_score_threshold}' against variable
> > `TX:INBOUND_ANOMALY_SCORE' (Value: `8' ) [file
> > "/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf"]
> > [line "61"] [id "980130"] [rev ""] [msg "Inbound Anomaly Score Exceeded
> > (Total Inbound Score: 8 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0):
> > Invalid character in request (null character)'"] [data ""] [severity "0"]
> > [ver ""] [maturity "0"] [accuracy "0"] [tag "event-correlation"] [ref ""]
> >
> > Note, that when I put the special characters to subject of mail,
> > and the body contains only ascii chars, the rule doesn't
> > triggered:
> >
> > _token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&_
> > id=1061864000595f7c3bc5c2e&_attachments =&_from=5&_to=airween%40gmail.com
> > &_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+mail+0707+1419
> > &editorSelector=plain&_priority=0&_store_target=Sent&
> > _draft_saveid=&_draft=&_is_html=0&_framed=1&_message=Teszt+uzenet.
> >
> > but the audit log contains a line:
> >
> > ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter
> > `1-255' against variable `ARGS:_subject' (Value: `Pr\xffffffc3\xffffffb3ba
> > mail 0707 1419' ) [file "/etc/nginx/owasp-modsecurity-
> > crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id
> > "920270"] [rev "2"] [msg "Invalid character in request (null character)"]
> > [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
> > "9"] [tag "application-multi"] [tag "language-multi"] [tag
> > "platform-multi"] [tag "attack-protocol"] [tag
> > "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o2,1o3,1v857,21t:
> > urlDecodeUni"]
> >
> >
> > What em I missing?
> >
> >
> > Thanks,
> >
> >
> > a.
> >
> >
> >
> 
> 
> -- 
> -- 
> Chaim Sanders
> http://www.ChaimSanders.com

From christian.folini at netnea.com  Mon Jul 10 05:30:29 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Mon, 10 Jul 2017 07:30:29 +0200
Subject: [Owasp-modsecurity-core-rule-set] Woe with 920270 (Null
 Byte...) (was: Re: Matched rule modification)
In-Reply-To: <20170707184410.GB24713@arxnet.hu>
References: <20170530141946.GA26620@arxnet.hu>
	<CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
	<20170531063203.GB1908@arxnet.hu>
	<20170601064903.mwgxlv5dxq6ccrp6@leander>
	<20170707122435.GA16567@arxnet.hu>
	<CAE8hE=oPfQgEjOJ4=OtZA0Mjidae09_k8K-p17F-KaAyH96f_w@mail.gmail.com>
	<20170707184410.GB24713@arxnet.hu>
Message-ID: <20170710053029.imfvxfmjuuguj4zd@leander>

Hey Ervin,

Like I mentioned last week, we want to come up with a solution to all
this non-ascii problems with CRS for 3.1. Chaim has explained the
problem pretty well and unfortunately, this stretches to more rules.

You manage to run curl and you have servers with non-ascii payloads.
So you will be an excellent partner when we come up with new rules
and approaches to this problem. It is likely to take a while, but 
once we have something to show, testing it on real servers
is very important.

Best,

Christian


On Fri, Jul 07, 2017 at 08:44:10PM +0200, Ervin Heged?s wrote:
> Hi Chaim,
> 
> On Fri, Jul 07, 2017 at 10:46:22AM -0400, Chaim Sanders wrote:
> > Taking a quick look here, it appears that the problem is probably with
> > urldecodeuni but it also might not be solvable. Let me explain, If I recall
> > correctly the reason that we added request_uri and ARGS as a parameter is
> > that they require provided elements to be ASCII. The alternative is that in
> > PL1 we thought that only ASCII should be submitted as args, which seems
> > wrong.
> > However we see that there is the use of urldecodeuni, which will decode
> > even unicode chars into the base char points. Stepping aside from the other
> > Unicode problems we've been seeing as a result of some ModSec issues
> > (purportedly), the use of this transformation will defeat the purpose of
> > this rule, as it will fire whenever a unicode element has been received.
> > The real question/possible problem, is that as we learned before
> > Apache/Nginx will provide us with automatically urldecoded arguments (and
> > url's maybe). This in turn might mean that it is never possible to ensure
> > that URL's and Args were all ASCII as is required by spec.
> > Requires a little bit more testing and verification of the purpose of the
> > rule, but i'd guess this is the cause of your issue.
>  
> thanks for your detailed anwser, I think I understand most of it :).
> 
> Probably I can't do anything till you can't find the final
> solution.
> 
> What can I help you? I mean, may be I can build the old
> Modsecurity version with Apache, or Nginx, and can try with old
> CRS...
> 
> 
> Thanks,
> 
> 
> a.
> 
> > On Fri, Jul 7, 2017 at 8:24 AM, Ervin Heged?s <airween at gmail.com> wrote:
> > 
> > > Hi Christian and Chaim,
> > > other CRS users,
> > >
> > >
> > > here is my previous e-mail with an issue (with more issues
> > > exactly, but this one whis is interesting now)
> > >
> > > On Thu, Jun 01, 2017 at 08:49:03AM +0200, Christian Folini wrote:
> > > >
> > > > On Wed, May 31, 2017 at 08:32:03AM +0200, Ervin Heged?s wrote:
> > > > > And there is an another issue with 3.0.2 (but may be that affects
> > > > > another versions too).
> > > > >
> > > > > The request is similar that I detailed in my first post. The
> > > > > "extraParams" value (JSON field) is this:
> > > ...
> > >
> > > and you sent me your test:
> > >
> > > > I was kind of expecting problems with 920270, but probably not as
> > > > deep rooted ones as this. But first, I need to be able to reproduce
> > > > this, and I can't.
> > > >
> > > > Here is my curl call taking up your example:
> > > >
> > > > curl 'localhost/index.html' -d 'extraParams=%7B%22node%22%3A%
> > > 223%22%2C%22text%22%3A%22v%C3%A9gs%C5%91%20fejezet%22' --trace-ascii -
> > > > == Info:   Trying 127.0.0.1...
> > > > == Info: Connected to localhost (127.0.0.1) port 80 (#0)
> > > > => Send header, 153 bytes (0x99)
> > >
> > > ...
> > >
> > >
> > > now the situation is totally same like above, but the server is
> > > another, and the web application is an up-to-date RoundCube
> > > webmail.
> > >
> > > The issue is when I'ld like to compose a new mail and I'm using
> > > special hungarian characters, Modsecurity denies the request.
> > >
> > > Here is the curl test:
> > >
> > > curl "https://roundcube.mydomain.hu/" -d "_token=
> > > 0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&_
> > > id=1466771890595f68c41f875&_attachments=&_from=5&_to=airween%40gmail.com
> > > &_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+0707+1256&
> > > editorSelector=plain&_priority=0&_store_target=Sent&
> > > _draft_saveid=&_draft=&_is_html=0&_framed=1&_message=Pr%C3%B3ba+%C3%BCzenet."
> > > --trace-ascii -
> > > == Info: Hostname was NOT found in DNS cache
> > > == Info:   Trying 1.2.3.4...
> > > == Info: Connected to roundcube.mydomain.hu (1.2.3.4) port 443 (#0)
> > > == Info: successfully set certificate verify locations:
> > > == Info:   CAfile: none
> > >   CApath: /etc/ssl/certs
> > > == Info: SSLv3, TLS handshake, Client hello (1):
> > > => Send SSL data, 512 bytes (0x200)
> > > 0000: ........rJK..M`4Qg9.)..........r7.....v.0.,.(.$.........k.j.9.
> > > ...
> > > == Info:         SSL certificate verify ok.
> > > => Send header, 159 bytes (0x9f)
> > > 0000: POST / HTTP/1.1
> > > 0011: User-Agent: curl/7.38.0
> > > 002a: Host: roundcube.mydomain.hu
> > > 004a: Accept: */*
> > > 0057: Content-Length: 330
> > > 006c: Content-Type: application/x-www-form-urlencoded
> > > 009d:
> > > => Send data, 330 bytes (0x14a)
> > > 0000: _token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&
> > > 0040: _id=1466771890595f68c41f875&_attachments=&_from=5&_to=airween%40
> > > 0080: gmail.com&_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+
> > > 00c0: 0707+1256&editorSelector=plain&_priority=0&_store_target=Sent&_d
> > > 0100: raft_saveid=&_draft=&_is_html=0&_framed=1&_message=Pr%C3%B3ba+%C
> > > 0140: 3%BCzenet.
> > > == Info: upload completely sent off: 330 out of 330 bytes
> > > <= Recv header, 24 bytes (0x18)
> > > 0000: HTTP/1.1 403 Forbidden
> > > == Info: Server nginx/1.6.2 is not blacklisted
> > > <= Recv header, 21 bytes (0x15)
> > > 0000: Server: nginx/1.6.2
> > > <= Recv header, 37 bytes (0x25)
> > > 0000: Date: Fri, 07 Jul 2017 11:57:13 GMT
> > > <= Recv header, 25 bytes (0x19)
> > > 0000: Content-Type: text/html
> > > <= Recv header, 21 bytes (0x15)
> > > 0000: Content-Length: 168
> > > <= Recv header, 24 bytes (0x18)
> > > 0000: Connection: keep-alive
> > > <= Recv header, 2 bytes (0x2)
> > > 0000:
> > > <= Recv data, 168 bytes (0xa8)
> > > 0000: <html>
> > > 0008: <head><title>403 Forbidden</title></head>
> > > 0033: <body bgcolor="white">
> > > 004b: <center><h1>403 Forbidden</h1></center>
> > > 0074: <hr><center>nginx/1.6.2</center>
> > > 0096: </body>
> > > 009f: </html>
> > >
> > >
> > > The audit log contains these lines for that request?
> > >
> > > ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter
> > > `1-255' against variable `ARGS:_message' (Value: `Pr\xffffffc3\xffffffb3ba
> > > \xffffffc3\xffffffbczenet.' ) [file "/etc/nginx/owasp-modsecurity-
> > > crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id
> > > "920270"] [rev "2"] [msg "Invalid character in request (null character)"]
> > > [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
> > > "9"] [tag "application-multi"] [tag "language-multi"] [tag
> > > "platform-multi"] [tag "attack-protocol"] [tag
> > > "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o2,1o3,1v333,16t:
> > > urlDecodeUnio2,1o3,1o7,1o8,1v459,15t:urlDecodeUni"]
> > > ModSecurity: Warning. Matched "Operator `Ge' with parameter
> > > `%{tx.inbound_anomaly_score_threshold}' against variable
> > > `TX:ANOMALY_SCORE' (Value: `8' ) [file "/etc/nginx/owasp-modsecurity-
> > > crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] [line "36"] [id
> > > "949110"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Score: 8)"]
> > > [data ""] [severity "2"] [ver ""] [maturity "0"] [accuracy "0"] [tag
> > > "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> > > "attack-generic"] [ref ""]
> > > ModSecurity: Warning. Matched "Operator `Ge' with parameter
> > > `%{tx.inbound_anomaly_score_threshold}' against variable
> > > `TX:INBOUND_ANOMALY_SCORE' (Value: `8' ) [file
> > > "/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf"]
> > > [line "61"] [id "980130"] [rev ""] [msg "Inbound Anomaly Score Exceeded
> > > (Total Inbound Score: 8 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0):
> > > Invalid character in request (null character)'"] [data ""] [severity "0"]
> > > [ver ""] [maturity "0"] [accuracy "0"] [tag "event-correlation"] [ref ""]
> > >
> > > Note, that when I put the special characters to subject of mail,
> > > and the body contains only ascii chars, the rule doesn't
> > > triggered:
> > >
> > > _token=0uuYa9sHayQF7AU6s5Kb4XtJeKt6PZak&_task=mail&_action=send&_
> > > id=1061864000595f7c3bc5c2e&_attachments =&_from=5&_to=airween%40gmail.com
> > > &_cc=&_bcc=&_replyto=&_followupto=&_subject=Pr%C3%B3ba+mail+0707+1419
> > > &editorSelector=plain&_priority=0&_store_target=Sent&
> > > _draft_saveid=&_draft=&_is_html=0&_framed=1&_message=Teszt+uzenet.
> > >
> > > but the audit log contains a line:
> > >
> > > ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter
> > > `1-255' against variable `ARGS:_subject' (Value: `Pr\xffffffc3\xffffffb3ba
> > > mail 0707 1419' ) [file "/etc/nginx/owasp-modsecurity-
> > > crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id
> > > "920270"] [rev "2"] [msg "Invalid character in request (null character)"]
> > > [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
> > > "9"] [tag "application-multi"] [tag "language-multi"] [tag
> > > "platform-multi"] [tag "attack-protocol"] [tag
> > > "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o2,1o3,1v857,21t:
> > > urlDecodeUni"]
> > >
> > >
> > > What em I missing?
> > >
> > >
> > > Thanks,
> > >
> > >
> > > a.
> > >
> > >
> > >
> > 
> > 
> > -- 
> > -- 
> > Chaim Sanders
> > http://www.ChaimSanders.com

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From airween at gmail.com  Mon Jul 10 07:59:03 2017
From: airween at gmail.com (Ervin =?utf-8?Q?Heged=C3=BCs?=)
Date: Mon, 10 Jul 2017 09:59:03 +0200
Subject: [Owasp-modsecurity-core-rule-set] Woe with 920270 (Null
 Byte...) (was: Re: Matched rule modification)
In-Reply-To: <20170710053029.imfvxfmjuuguj4zd@leander>
References: <20170530141946.GA26620@arxnet.hu>
	<CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
	<20170531063203.GB1908@arxnet.hu>
	<20170601064903.mwgxlv5dxq6ccrp6@leander>
	<20170707122435.GA16567@arxnet.hu>
	<CAE8hE=oPfQgEjOJ4=OtZA0Mjidae09_k8K-p17F-KaAyH96f_w@mail.gmail.com>
	<20170707184410.GB24713@arxnet.hu>
	<20170710053029.imfvxfmjuuguj4zd@leander>
Message-ID: <20170710075903.GA19459@arxnet.hu>

Hi Christian,

many thanks for your reply,

On Mon, Jul 10, 2017 at 07:30:29AM +0200, Christian Folini wrote:
> Hey Ervin,
> 
> Like I mentioned last week, we want to come up with a solution to all
> this non-ascii problems with CRS for 3.1. Chaim has explained the
> problem pretty well and unfortunately, this stretches to more rules.
> 
> You manage to run curl and you have servers with non-ascii payloads.
> So you will be an excellent partner when we come up with new rules
> and approaches to this problem. It is likely to take a while, but 
> once we have something to show, testing it on real servers
> is very important.

right, I'm waiting for your result.

Till I can build the Modsecurity with Apache too, and can check -
would it be helpful to you, or not?


Thanks again,


a.


From christian.folini at netnea.com  Mon Jul 10 08:08:24 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Mon, 10 Jul 2017 10:08:24 +0200
Subject: [Owasp-modsecurity-core-rule-set] Woe with 920270 (Null
 Byte...) (was: Re: Matched rule modification)
In-Reply-To: <20170710075903.GA19459@arxnet.hu>
References: <20170530141946.GA26620@arxnet.hu>
	<CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
	<20170531063203.GB1908@arxnet.hu>
	<20170601064903.mwgxlv5dxq6ccrp6@leander>
	<20170707122435.GA16567@arxnet.hu>
	<CAE8hE=oPfQgEjOJ4=OtZA0Mjidae09_k8K-p17F-KaAyH96f_w@mail.gmail.com>
	<20170707184410.GB24713@arxnet.hu>
	<20170710053029.imfvxfmjuuguj4zd@leander>
	<20170710075903.GA19459@arxnet.hu>
Message-ID: <20170710080824.m2zvcw4yxsvbwwyl@leander>

Hey Ervin,

It certainly does not hurt to be on the same page.

Cheers,

Christian

On Mon, Jul 10, 2017 at 09:59:03AM +0200, Ervin Heged?s wrote:
> Hi Christian,
> 
> many thanks for your reply,
> 
> On Mon, Jul 10, 2017 at 07:30:29AM +0200, Christian Folini wrote:
> > Hey Ervin,
> > 
> > Like I mentioned last week, we want to come up with a solution to all
> > this non-ascii problems with CRS for 3.1. Chaim has explained the
> > problem pretty well and unfortunately, this stretches to more rules.
> > 
> > You manage to run curl and you have servers with non-ascii payloads.
> > So you will be an excellent partner when we come up with new rules
> > and approaches to this problem. It is likely to take a while, but 
> > once we have something to show, testing it on real servers
> > is very important.
> 
> right, I'm waiting for your result.
> 
> Till I can build the Modsecurity with Apache too, and can check -
> would it be helpful to you, or not?
> 
> 
> Thanks again,
> 
> 
> a.

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From sthayyilekan at BarclaycardUS.com  Thu Jul 13 01:25:11 2017
From: sthayyilekan at BarclaycardUS.com (Thayyile kandy, Subin : CSO GIS)
Date: Thu, 13 Jul 2017 01:25:11 +0000
Subject: [Owasp-modsecurity-core-rule-set]  XSS false negative ?
Message-ID: <C310131DD0004743B2508B65C77B66317CF02CB6@PMEXGMB04.juniper.com>

Shouldn't CRS3.0 be flagging this XSS ? I did check the XSS rules but couldn't figure out if why it wasn't getting flagged.

https://localhost/test.action?testingid=29776%27};alert(1);var%20x={%27myid%27:%2723233

Thanks
Subin
Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.

From chaim at chaimsanders.com  Thu Jul 13 03:09:57 2017
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Wed, 12 Jul 2017 23:09:57 -0400
Subject: [Owasp-modsecurity-core-rule-set] XSS false negative ?
In-Reply-To: <C310131DD0004743B2508B65C77B66317CF02CB6@PMEXGMB04.juniper.com>
References: <C310131DD0004743B2508B65C77B66317CF02CB6@PMEXGMB04.juniper.com>
Message-ID: <CAE8hE=pgKkgKtx5U1HiROxgpnyxLnLivPtLjiYgBSQOGKvzObg@mail.gmail.com>

Hey Subin,
Long time no speak. It does indeed look as if PL1 of CRS 3.0 doesn't catch
that. PL2 catches it with rule 942340, 942370, and 942430. It might be
worth looking into trying to add some logic that isn't false positive prone
to PL1. In this case it'll be tricky as it appears that the XSS triggered
here would be in the javascript context already. Any thoughts?

On Wed, Jul 12, 2017 at 9:25 PM, Thayyile kandy, Subin : CSO GIS <
sthayyilekan at barclaycardus.com> wrote:

> Shouldn't CRS3.0 be flagging this XSS ? I did check the XSS rules but
> couldn't figure out if why it wasn't getting flagged.
>
> https://localhost/test.action?testingid=29776%27};alert(1);
> var%20x={%27myid%27:%2723233
>
> Thanks
> Subin
> Barclaycard
>
> www.barclaycardus.com<http://www.barclaycardus.com>
>
> This email and any files transmitted with it may contain confidential
> and/or proprietary information. It is intended solely for the use of the
> individual or entity who is the intended recipient. Unauthorized use of
> this information is prohibited. If you have received this in error, please
> contact the sender by replying to this message and delete this material
> from any system it may be on.
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170712/4ac1ac2b/attachment.html>

From sthayyilekan at BarclaycardUS.com  Thu Jul 13 03:23:43 2017
From: sthayyilekan at BarclaycardUS.com (Thayyile kandy, Subin : CSO GIS)
Date: Thu, 13 Jul 2017 03:23:43 +0000
Subject: [Owasp-modsecurity-core-rule-set] XSS false negative ?
In-Reply-To: <CAE8hE=pgKkgKtx5U1HiROxgpnyxLnLivPtLjiYgBSQOGKvzObg@mail.gmail.com>
References: <C310131DD0004743B2508B65C77B66317CF02CB6@PMEXGMB04.juniper.com>
	<CAE8hE=pgKkgKtx5U1HiROxgpnyxLnLivPtLjiYgBSQOGKvzObg@mail.gmail.com>
Message-ID: <C310131DD0004743B2508B65C77B66317CF02D22@PMEXGMB04.juniper.com>

Hey Chaim , Hope you are doing great. Yes , The data injected is in the JavaScript content already , have not been very successful trying to match patterns here without false positives.


From: chaim.sanders at gmail.com [mailto:chaim.sanders at gmail.com] On Behalf Of Chaim Sanders
Sent: Wednesday, July 12, 2017 23:10
To: Thayyile kandy, Subin : CSO GIS
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] XSS false negative ?

THIS MAIL ORIGINATED FROM OUTSIDE OUR ORGANIZATION
Hey Subin,
Long time no speak. It does indeed look as if PL1 of CRS 3.0 doesn't catch that. PL2 catches it with rule 942340, 942370, and 942430. It might be worth looking into trying to add some logic that isn't false positive prone to PL1. In this case it'll be tricky as it appears that the XSS triggered here would be in the javascript context already. Any thoughts?

On Wed, Jul 12, 2017 at 9:25 PM, Thayyile kandy, Subin : CSO GIS <sthayyilekan at barclaycardus.com<mailto:sthayyilekan at barclaycardus.com>> wrote:
Shouldn't CRS3.0 be flagging this XSS ? I did check the XSS rules but couldn't figure out if why it wasn't getting flagged.

https://localhost/test.action?testingid=29776%27};alert(1);var%20x={%27myid%27:%2723233<https://localhost/test.action?testingid=29776%27%7d;alert(1);var%20x=%7b%27myid%27:%2723233>

Thanks
Subin
Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com><http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set



--
--
Chaim Sanders
http://www.ChaimSanders.com

Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170713/59f263a8/attachment-0001.html>

From c.mammoli at apra.it  Mon Jul 17 10:29:16 2017
From: c.mammoli at apra.it (Cristian Mammoli)
Date: Mon, 17 Jul 2017 12:29:16 +0200
Subject: [Owasp-modsecurity-core-rule-set] Correct place for custom scoring
	rules
Message-ID: <5c3c83f3-d6f9-23fe-8834-1f3438f08472@apra.it>

Hi, I'm using crs 3 in "anomaly score mode" and I would like to add a 
couple of custom rules to "lower" the anomaly score before the final 
evaliuation

For example I would like to reduce the anomaly score by 2 if the origin 
country is my own (Italy) or if the origin IP is from some ip address block

Actually I'm including the following file in my "master" modsecurity 
config file:

IncludeOptional /etc/httpd/modsecurity.d/*.conf
IncludeOptional /etc/httpd/crs/crs-setup.conf
IncludeOptional /etc/httpd/crs/rules/*.conf

For example I created the following rule:

SecAction \
  "id:10009,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:'tx.low_risk_country_codes=IT'"

SecRule TX:LOW_RISK_COUNTRY_CODES "!^$" \
  "msg:'Client IP is from a LOW Risk Country Location.',\
   id:10010,\
   severity:'INFO',\
   nolog,\
   phase:request,\
   pass,\
   t:none,\
   chain"
   SecRule TX:REAL_IP "@geoLookup" \
    "chain"
     SecRule GEO:COUNTRY_CODE "@within %{tx.low_risk_country_codes}" \
      "setvar:'tx.msg=%{rule.msg}',\
       setvar:tx.anomaly_score=-%{tx.notice_anomaly_score}

But where do I put it to have it processed before the final score is 
analyzed for rejection?

Thanks


-- 
Mammoli Cristian
System administrator
T. +39 0731 22911
Via Brodolini 6 | 60035 Jesi (an)


From christian.folini at netnea.com  Mon Jul 17 10:50:54 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Mon, 17 Jul 2017 12:50:54 +0200
Subject: [Owasp-modsecurity-core-rule-set] Correct place for custom
 scoring rules
In-Reply-To: <5c3c83f3-d6f9-23fe-8834-1f3438f08472@apra.it>
References: <5c3c83f3-d6f9-23fe-8834-1f3438f08472@apra.it>
Message-ID: <20170717105054.jxl2qzobhtrknidc@leander>

Hey Cristian,

On Mon, Jul 17, 2017 at 12:29:16PM +0200, Cristian Mammoli wrote:
> Hi, I'm using crs 3 in "anomaly score mode" and I would like to add a couple
> of custom rules to "lower" the anomaly score before the final evaliuation

Makes sense. I thought about such scenarios as well, but I never really
tried it in practice.

> But where do I put it to have it processed before the final score is
> analyzed for rejection?

So the incoming score is evaluated in rule 949110 towards the end of
phase 2. Squeezing a rule after 948xxx and before 949110 is quite
difficult without changing the rule file(s).

I see two approaches:
- You remove rule 949110 on startup and re-create it yourself at the end
  of phase 2 together with your custom rules.
  Notice that there is report rule in the 98xxxx range that you
  might have to handle as well or it will mess up your log file
  with garbage reports based on the wrong scores.
- You do not lower the score before 949110 hits, but you start with
  -2 instead of 0 in a rule that runs after crs-setup.conf but before
  the rules files. However, I am not really sure ModSec allows for 
  negative numbers.

I am sure other methods are possible that these are the two I would
probably try out.

Cheers,

Christian


-- 
Und es gehen die Menschen zu bestaunen die Gipfel der Berge und die
ungeheuren Fluten des Meeres und die weit dahinfliessenden Str?me 
und den Saum des Ozeans und die Kreisbahnen der Gestirne und haben
nicht acht ihrer selbst.
--- Augustinus (354-430)

From christian.folini at netnea.com  Thu Jul 27 09:05:12 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 27 Jul 2017 11:05:12 +0200
Subject: [Owasp-modsecurity-core-rule-set] Live-Stream of CRS3 presentation
	to night at OWASP Chapter London
Message-ID: <20170727090512.x3ildzxtnlekomte@leander>

Hi there,

OWASP London informed me that my CRS3 presentation will be life-streamed
on Facebook at https://www.facebook.com/OWASPLondon/  

My talk will begin around 8pm UK time.

The presentation will be very similar to the one I held at AppSecEU
in Belfast, but this time, we have a backup plan for the installation
demo which failed due to beamer issues back in May.

A record of the stream will be available on youtube afterwards.
Likely the OWASP London channel.

Please keep your fingers crossed for me.

Cheers,

Christian



-- 
https://www.feistyduck.com/books/modsecurity-handbook/
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From prakash.khadka at nepallink.net  Thu Jul 27 09:32:21 2017
From: prakash.khadka at nepallink.net (Prakash Khadka)
Date: Thu, 27 Jul 2017 15:17:21 +0545
Subject: [Owasp-modsecurity-core-rule-set] Live-Stream of CRS3
 presentation to night at OWASP Chapter London
In-Reply-To: <20170727090512.x3ildzxtnlekomte@leander>
References: <20170727090512.x3ildzxtnlekomte@leander>
Message-ID: <CACpVoZPfrP=XNyvS4VDJ-K+P=AkRwAFChszAU0XjQqidzEyV2w@mail.gmail.com>

Best of luck. :)

[image: photo]
Prakash Khadka
Technical Operations Lead, Nepallink
44260822 || 9841262275 || support at nepallink.net <abuse at nepallink.net>
http://www.nepallink.net || Link Road, Khusibu
<http://www.facebook.com/pages/NepalLink-Network/334213043398796>
<http://twitter.com/nepallink>


On Thu, Jul 27, 2017 at 2:50 PM, Christian Folini <
christian.folini at netnea.com> wrote:

> Hi there,
>
> OWASP London informed me that my CRS3 presentation will be life-streamed
> on Facebook at https://www.facebook.com/OWASPLondon/
>
> My talk will begin around 8pm UK time.
>
> The presentation will be very similar to the one I held at AppSecEU
> in Belfast, but this time, we have a backup plan for the installation
> demo which failed due to beamer issues back in May.
>
> A record of the stream will be available on youtube afterwards.
> Likely the OWASP London channel.
>
> Please keep your fingers crossed for me.
>
> Cheers,
>
> Christian
>
>
>
> --
> https://www.feistyduck.com/books/modsecurity-handbook/
> mailto:christian.folini at netnea.com
> twitter: @ChrFolini
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170727/86bf63aa/attachment.html>

From patsev.anton at gmail.com  Thu Jul 27 11:16:25 2017
From: patsev.anton at gmail.com (=?UTF-8?B?0J/QsNGG0LXQsiDQkNC90YLQvtC9?=)
Date: Thu, 27 Jul 2017 17:16:25 +0600
Subject: [Owasp-modsecurity-core-rule-set] Question about
	REQUEST-920-PROTOCOL-ENFORCEMENT.conf
Message-ID: <CAOx4depWBzJVRW31mm10PBQchjWv525O6qXGx=ta9W7M2LofgA@mail.gmail.com>

Hello!
Can some help about REQUEST-920-PROTOCOL-ENFORCEMENT.conf?
Used: modsecurity v3 from master, nginx 1.10.2, core rules from github

crs-setup.conf:
SecDefaultAction "phase:1,log,auditlog,pass"
SecDefaultAction "phase:2,log,auditlog,pass"
SecAction \
  "id:900000,\
   phase:1,\
   nolog,\
   pass,\
   t:none,\
   setvar:tx.paranoia_level=1"
SecAction \
 "id:900110,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.inbound_anomaly_score_threshold=5,\
  setvar:tx.outbound_anomaly_score_threshold=4"
SecCollectionTimeout 600
SecAction \
 "id:900990,\
  phase:1,\
  nolog,\
  pass,\
  t:none,\
  setvar:tx.crs_setup_version=302"


Log file have:

ModSecurity: Warning. Matched "Operator `Eq' with parameter `0' against
variable `REQUEST_HEADERS:Content-Length' (Value: `0' ) [file
"/etc/nginx/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "258"] [id
"920180"] [rev "1"] [msg "POST request missing Content-Length Header."]
[data "0"] [severity "4"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
"9"] [tag "application-multi"] [tag "language-multi"] [tag
"platform-multi"] [tag "attack-protocol"] [tag
"OWASP_CRS/PROTOCOL_VIOLATION/INVALID_HREQ"] [tag "CAPEC-272"] [ref
"o0,4v0,4"]

ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter
`1-255' against variable `REQUEST_HEADERS:Cookie' (Value:
`JSESSIONID=XXXXXXXXXXXXXX; loggedin=true; hash=yyyyyyy; loggedUser=gggggg
(781 characters omitted)' ) [file
"/etc/nginx/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id
"920270"] [rev "2"] [msg "Invalid character in request (null character)"]
[data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
"9"] [tag "application-multi"] [tag "language-multi"] [tag
"platform-multi"] [tag "attack-protocol"] [tag
"OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref
"o185,1o186,1o187,1o188,1o189,1o190,1o191,1o192,1o193,1o194,1o195,1o196,1o197,1o198,1o199,1o200,1o201,1o202,1o313,1o314,1o315,1o316,1o317,1o318,1o319,1o320,1o321,1o322,1o323,1o324,1o325,1o326,1o327,1o328,1o329,1o330,1o331,1o332,1o333,1o334,1o335,1o336,1o337,1o338,1o408,1o409,1o410,1o411,1o412,1o413,1v479,881t:urlDecodeUni"]

How understend this is log? How Write request to log?



-- 
? ?????????, ????? ?????.
Best regards, Anton Patsev.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170727/febd9a06/attachment.html>

From naudin at supagro.inra.fr  Fri Jul 28 07:30:17 2017
From: naudin at supagro.inra.fr (Philippe Naudin)
Date: Fri, 28 Jul 2017 09:30:17 +0200
Subject: [Owasp-modsecurity-core-rule-set] CRS-3.0.2 : rules 941100 and
	950130
Message-ID: <20170727163127.6e244e0e@uic-hp-phn.supagro.inra.fr>

Hello,

I have a problem with the installation of CRS and I am not able to
understand it. 
On a Debian Jessie, with libapache2-mod-security2-2.9.1-2~bpo8+1 and
owasp-modsecurity-crs from github.com/SpiderLabs, apache2 -t gives the
following error :

AH00526: Syntax error on line 40
of /etc/modsecurity/crs/REQUEST-941-APPLICATION-ATTACK-XSS.conf Error
parsing actions: Unknown action: \\

After commenting out rule 941100, there is another error :

AH00526: Syntax error on line 36
of /etc/modsecurity/crs/RESPONSE-950-DATA-LEAKAGES.conf Error parsing
actions: Unknown action: \\

Once rules 941100 and 950130 have been commented, apache can read its
configuration and work correctly (also tested in paranoia levels 2 
and 3).

Using debian's package modsecurity-crs-3.0.0-3~bpo8+1, there is no
problem at all.

Do you know some test or log or whatever that can help me to find the 
origin of this problem ?

Thanks,

-- 
Philippe Naudin

From chaim at chaimsanders.com  Fri Jul 28 15:52:40 2017
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Fri, 28 Jul 2017 08:52:40 -0700
Subject: [Owasp-modsecurity-core-rule-set] CRS-3.0.2 : rules 941100 and
	950130
In-Reply-To: <20170727163127.6e244e0e@uic-hp-phn.supagro.inra.fr>
References: <20170727163127.6e244e0e@uic-hp-phn.supagro.inra.fr>
Message-ID: <CAE8hE=ppT4mRs_vS5yEzVBdnbex5RRf1HPwgcGDz+59NcT7h9g@mail.gmail.com>

Hey Phillppe,
Sorry for the trouble you've been having. You've stumbled across a known
bug. This is due to a bug in a few older Apache versions (as described here
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/KNOWN_BUGS#L18).
There are two different approaches to fixing it. Either upgrade Apache, or
you can go to the location specified in the error (line 36 of
DATA-LEAKAGES) and add a space before the line continuation ( '\' ). Thank
you for reaching out to us, let me know if this solves the issue!

On Fri, Jul 28, 2017 at 12:30 AM, Philippe Naudin <naudin at supagro.inra.fr>
wrote:

> Hello,
>
> I have a problem with the installation of CRS and I am not able to
> understand it.
> On a Debian Jessie, with libapache2-mod-security2-2.9.1-2~bpo8+1 and
> owasp-modsecurity-crs from github.com/SpiderLabs, apache2 -t gives the
> following error :
>
> AH00526: Syntax error on line 40
> of /etc/modsecurity/crs/REQUEST-941-APPLICATION-ATTACK-XSS.conf Error
> parsing actions: Unknown action: \\
>
> After commenting out rule 941100, there is another error :
>
> AH00526: Syntax error on line 36
> of /etc/modsecurity/crs/RESPONSE-950-DATA-LEAKAGES.conf Error parsing
> actions: Unknown action: \\
>
> Once rules 941100 and 950130 have been commented, apache can read its
> configuration and work correctly (also tested in paranoia levels 2
> and 3).
>
> Using debian's package modsecurity-crs-3.0.0-3~bpo8+1, there is no
> problem at all.
>
> Do you know some test or log or whatever that can help me to find the
> origin of this problem ?
>
> Thanks,
>
> --
> Philippe Naudin
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170728/48cc3926/attachment.html>

From rx3422 at gmail.com  Fri Jul 28 19:32:37 2017
From: rx3422 at gmail.com (ajay)
Date: Fri, 28 Jul 2017 21:32:37 +0200
Subject: [Owasp-modsecurity-core-rule-set]
	Owasp-modsecurity-core-rule-set Digest, Vol 99, Issue 9
In-Reply-To: <mailman.7.1501243207.16708.owasp-modsecurity-core-rule-set@lists.owasp.org>
References: <mailman.7.1501243207.16708.owasp-modsecurity-core-rule-set@lists.owasp.org>
Message-ID: <e283296b-1b0b-eafb-ece5-c8ae808b9828@gmail.com>




Am 28.07.2017 um 14:00 schrieb 
owasp-modsecurity-core-rule-set-request at lists.owasp.org:
> Send Owasp-modsecurity-core-rule-set mailing list submissions to
> 	owasp-modsecurity-core-rule-set at lists.owasp.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 
> or, via email, send a message with subject or body 'help' to
> 	owasp-modsecurity-core-rule-set-request at lists.owasp.org
> 
> You can reach the person managing the list at
> 	owasp-modsecurity-core-rule-set-owner at lists.owasp.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Owasp-modsecurity-core-rule-set digest..."
> 
> 
> Today's Topics:
> 
>     1. CRS-3.0.2 : rules 941100 and	950130 (Philippe Naudin)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Fri, 28 Jul 2017 09:30:17 +0200
> From: Philippe Naudin <naudin at supagro.inra.fr>
> To: <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: [Owasp-modsecurity-core-rule-set] CRS-3.0.2 : rules 941100
> 	and	950130
> Message-ID: <20170727163127.6e244e0e at uic-hp-phn.supagro.inra.fr>
> Content-Type: text/plain; charset=US-ASCII
> 
> Hello,
> 
> I have a problem with the installation of CRS and I am not able to
> understand it.
> On a Debian Jessie, with libapache2-mod-security2-2.9.1-2~bpo8+1 and
> owasp-modsecurity-crs from github.com/SpiderLabs, apache2 -t gives the
> following error :
> 
> AH00526: Syntax error on line 40
> of /etc/modsecurity/crs/REQUEST-941-APPLICATION-ATTACK-XSS.conf Error
> parsing actions: Unknown action: \\
> 
> After commenting out rule 941100, there is another error :
> 
> AH00526: Syntax error on line 36
> of /etc/modsecurity/crs/RESPONSE-950-DATA-LEAKAGES.conf Error parsing
> actions: Unknown action: \\
> 
> Once rules 941100 and 950130 have been commented, apache can read its
> configuration and work correctly (also tested in paranoia levels 2
> and 3).
> 
> Using debian's package modsecurity-crs-3.0.0-3~bpo8+1, there is no
> problem at all.
> 
> Do you know some test or log or whatever that can help me to find the
> origin of this problem ?
> 
> Thanks,
> 
Hi Philippe,

I also faced this issue during several installations. I guess this is 
related to this 
https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/651 and 
adding a space before line continuation will help you.
By the way, the problem passed in debian9.

best
Andreas


From naudin at supagro.inra.fr  Mon Jul 31 06:37:24 2017
From: naudin at supagro.inra.fr (Philippe Naudin)
Date: Mon, 31 Jul 2017 08:37:24 +0200
Subject: [Owasp-modsecurity-core-rule-set] CRS-3.0.2 : rules 941100 and
 950130
In-Reply-To: <CAE8hE=ppT4mRs_vS5yEzVBdnbex5RRf1HPwgcGDz+59NcT7h9g@mail.gmail.com>
References: <20170727163127.6e244e0e@uic-hp-phn.supagro.inra.fr>
	<CAE8hE=ppT4mRs_vS5yEzVBdnbex5RRf1HPwgcGDz+59NcT7h9g@mail.gmail.com>
Message-ID: <20170731082523.481d1d10@uic-hp-phn.supagro.inra.fr>

Le ven. 28 juil. 2017 08:52:40 CEST, Chaim Sanders a ?crit:

> Hey Phillppe,
> Sorry for the trouble you've been having. You've stumbled across a known
> bug. This is due to a bug in a few older Apache versions (as described here
> https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/KNOWN_BUGS#L18).
> There are two different approaches to fixing it. Either upgrade Apache, or
> you can go to the location specified in the error (line 36 of
> DATA-LEAKAGES) and add a space before the line continuation ( '\' ). Thank
> you for reaching out to us, let me know if this solves the issue!

Thanks a lot Chaim (and Ajay, too) : it perfectly solved my problem
(and I'll not forget to search to git repository next time -- oops !)

Thanks again,

-- 
Philippe Naudin

From chaim at chaimsanders.com  Mon Jul 31 14:59:49 2017
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Mon, 31 Jul 2017 10:59:49 -0400
Subject: [Owasp-modsecurity-core-rule-set] Question about
	REQUEST-920-PROTOCOL-ENFORCEMENT.conf
In-Reply-To: <CAOx4depWBzJVRW31mm10PBQchjWv525O6qXGx=ta9W7M2LofgA@mail.gmail.com>
References: <CAOx4depWBzJVRW31mm10PBQchjWv525O6qXGx=ta9W7M2LofgA@mail.gmail.com>
Message-ID: <CAE8hE=okaQU9AJyJw3gYwFhPy9k-=riRoc+E-meTcGZo3-CEdQ@mail.gmail.com>

Hello,
ModSecurity has it's own custom logging format. This can be changed to JSON
in ModSecurity 2.9 and greater. Generally though being able to understand
the log typically involves looking at the message that is generated, and
occasionally looking at the rule in question if this isn't enough. In this
case you have two rules listed.
The first rule, 920180, says that 'POST request missing Content-Length
Header'. Generally this means that the Content-Length header, which
typically specifies how much POST data is present was not provided. This
can be triggered by using non-standard user-agents. All browsers known will
provide this value as it is highly suggested by the RFC. This rule can be
found here:
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/e4e0497be4d598cce0e0a8fef20d1f1e5578c8d0/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf#L292

The next rule you have highlighted is 920270. This indicates that a null
byte was passed to a cookie. Null bytes are used in various attacks but are
almost always avoided by legit applications. This rule can be found here:
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/e4e0497be4d598cce0e0a8fef20d1f1e5578c8d0/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf#L564

To see whole requests when a rule triggers you should enable the audit
logging capability. For more details on this please see the following entry
in the reference manual:
https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecAuditEngine



On Thu, Jul 27, 2017 at 7:16 AM, ????? ????? <patsev.anton at gmail.com> wrote:

> Hello!
> Can some help about REQUEST-920-PROTOCOL-ENFORCEMENT.conf?
> Used: modsecurity v3 from master, nginx 1.10.2, core rules from github
>
> crs-setup.conf:
> SecDefaultAction "phase:1,log,auditlog,pass"
> SecDefaultAction "phase:2,log,auditlog,pass"
> SecAction \
>   "id:900000,\
>    phase:1,\
>    nolog,\
>    pass,\
>    t:none,\
>    setvar:tx.paranoia_level=1"
> SecAction \
>  "id:900110,\
>   phase:1,\
>   nolog,\
>   pass,\
>   t:none,\
>   setvar:tx.inbound_anomaly_score_threshold=5,\
>   setvar:tx.outbound_anomaly_score_threshold=4"
> SecCollectionTimeout 600
> SecAction \
>  "id:900990,\
>   phase:1,\
>   nolog,\
>   pass,\
>   t:none,\
>   setvar:tx.crs_setup_version=302"
>
>
> Log file have:
>
> ModSecurity: Warning. Matched "Operator `Eq' with parameter `0' against
> variable `REQUEST_HEADERS:Content-Length' (Value: `0' ) [file
> "/etc/nginx/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "258"]
> [id "920180"] [rev "1"] [msg "POST request missing Content-Length Header."]
> [data "0"] [severity "4"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy
> "9"] [tag "application-multi"] [tag "language-multi"] [tag
> "platform-multi"] [tag "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/INVALID_HREQ"] [tag "CAPEC-272"] [ref
> "o0,4v0,4"]
>
> ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter
> `1-255' against variable `REQUEST_HEADERS:Cookie' (Value:
> `JSESSIONID=XXXXXXXXXXXXXX; loggedin=true; hash=yyyyyyy; loggedUser=gggggg
> (781 characters omitted)' ) [file "/etc/nginx/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> [line "488"] [id "920270"] [rev "2"] [msg "Invalid character in request
> (null character)"] [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"]
> [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag
> "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref
> "o185,1o186,1o187,1o188,1o189,1o190,1o191,1o192,1o193,1o194,
> 1o195,1o196,1o197,1o198,1o199,1o200,1o201,1o202,1o313,1o314,
> 1o315,1o316,1o317,1o318,1o319,1o320,1o321,1o322,1o323,1o324,
> 1o325,1o326,1o327,1o328,1o329,1o330,1o331,1o332,1o333,1o334,
> 1o335,1o336,1o337,1o338,1o408,1o409,1o410,1o411,1o412,1o413,
> 1v479,881t:urlDecodeUni"]
>
> How understend this is log? How Write request to log?
>
>
>
> --
> ? ?????????, ????? ?????.
> Best regards, Anton Patsev.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>


-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170731/2b9fcf5d/attachment.html>

From edg at greenberg.org  Mon Jul 31 15:58:34 2017
From: edg at greenberg.org (Ed Greenberg)
Date: Mon, 31 Jul 2017 11:58:34 -0400
Subject: [Owasp-modsecurity-core-rule-set] Question about
 REQUEST-920-PROTOCOL-ENFORCEMENT.conf
In-Reply-To: <CAE8hE=okaQU9AJyJw3gYwFhPy9k-=riRoc+E-meTcGZo3-CEdQ@mail.gmail.com>
References: <CAOx4depWBzJVRW31mm10PBQchjWv525O6qXGx=ta9W7M2LofgA@mail.gmail.com>
	<CAE8hE=okaQU9AJyJw3gYwFhPy9k-=riRoc+E-meTcGZo3-CEdQ@mail.gmail.com>
Message-ID: <ab67ad1e-1c29-8fef-829f-a537a06f7739@greenberg.org>

On 07/31/2017 10:59 AM, Chaim Sanders wrote:
>
>
> The next rule you have highlighted is 920270. This indicates that a 
> null byte was passed to a cookie. Null bytes are used in various 
> attacks but are almost always avoided by legit applications. This rule 
> can be found here: 
> https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/e4e0497be4d598cce0e0a8fef20d1f1e5578c8d0/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf#L564
>
>

I would very much  like to see the audit log entry for the 920270 hit.

Ed Greenberg
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170731/c8d3d78a/attachment.html>

