<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20Set%20is%20being%20violated%20on%0A%20modsecurity_crs_41_phpids_converter.conf%20line%2070&In-Reply-To=4ACE4D561D68644483BFF6D8FF278BC90677FE%40EMBX-CHAM4.cdc.gov">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000641.html">
   <LINK REL="Next"  HREF="000643.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70</H1>
    <B>Josh Amishav-Zlatin</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20Set%20is%20being%20violated%20on%0A%20modsecurity_crs_41_phpids_converter.conf%20line%2070&In-Reply-To=4ACE4D561D68644483BFF6D8FF278BC90677FE%40EMBX-CHAM4.cdc.gov"
       TITLE="[Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70">jamuse at gmail.com
       </A><BR>
    <I>Tue Mar  8 15:45:48 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000641.html">[Owasp-modsecurity-core-rule-set] modsecurity logs managment tool
</A></li>
        <LI>Next message: <A HREF="000643.html">[Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#642">[ date ]</a>
              <a href="thread.html#642">[ thread ]</a>
              <a href="subject.html#642">[ subject ]</a>
              <a href="author.html#642">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Mar 8, 2011 at 9:59 PM, Mirabito, Massimo (Max) (CDC/OID/OD)
(CTR) &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mcm8 at cdc.gov</A>&gt; wrote:
&gt;<i> Dear All
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We are having difficulty with one of our applications as it appears that
</I>&gt;<i> mod_security is blocking some of the content thinking that it is a
</I>&gt;<i> vulnerability.
</I>&gt;<i>
</I>&gt;<i> We are running Apache version 2.2 with mod_security version 2.05
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The url that is giving us problems is as follows:
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://myserver.com/MYAPP/nt/chart/run.do?t=tcg&amp;m=cot/trend&amp;f=png&amp;r=3&amp;y=2005+to+2009&amp;d=labels_x:[2005,2006,2007,2008,2009,-8.88888888E8,2015];tlabels_x:[2005,2006,2007,2008,2009];g:[[89.690721649,86.746987952,91.946308725,90,85.135135135,-8.88888888E8,null],[90,85,87,89,90,-8.88888888E8,null],[83.209136562,83.894290701,84.484373669,81.189229619,64.743991641,-8.88888888E8,null],[null,null,null,null,null,-8.88888888E8,93]];t:[[194,166,149,150,148],[184,155,144,141,130],[174,144,137,135,126],[10,11,5,9,18]]&amp;c=0+0+0+0+1&amp;rid=1">https://myserver.com/MYAPP/nt/chart/run.do?t=tcg&amp;m=cot/trend&amp;f=png&amp;r=3&amp;y=2005+to+2009&amp;d=labels_x:[2005,2006,2007,2008,2009,-8.88888888E8,2015];tlabels_x:[2005,2006,2007,2008,2009];g:[[89.690721649,86.746987952,91.946308725,90,85.135135135,-8.88888888E8,null],[90,85,87,89,90,-8.88888888E8,null],[83.209136562,83.894290701,84.484373669,81.189229619,64.743991641,-8.88888888E8,null],[null,null,null,null,null,-8.88888888E8,93]];t:[[194,166,149,150,148],[184,155,144,141,130],[174,144,137,135,126],[10,11,5,9,18]]&amp;c=0+0+0+0+1&amp;rid=1</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The peculiar thing is that a similar url runs properly, see below
</I>&gt;<i>
</I>&gt;<i> https:// myserver.com/MYAPP/nt/chart/run.do?
</I>&gt;<i> t=pct&amp;m=cot/outcomes&amp;f=png&amp;r=3&amp;y=2009&amp;d=p:[[148,100],[126,85.135135135],[4,2.7027027027],[0,0],[2,1.3513513514],[1,0.6756756757],[15,10.135135135]]&amp;&amp;rid=1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The logs show the following rule being violated:
</I>&gt;<i>
</I>&gt;<i> Message: Pattern match &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\* ]+)){4,}&quot; at
</I>&gt;<i> ARGS:d. [file
</I>&gt;<i> &quot;C:/Apache2.2/conf/mod_security/base_rules/modsecurity_crs_41_phpids_converter.conf&quot;]
</I>&gt;<i> [line &quot;70&quot;] [id &quot;973016&quot;] [msg &quot;Basic Charcode Pattern Found&quot;] [data
</I>&gt;<i> &quot;2005,2006,2007,2008,2009,-8.88888888e3&quot;]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The rule in question is located in modsecurity_crs_41_phpids_converter.conf
</I>&gt;<i> &#160;- line 70
</I>&gt;<i>
</I>&gt;<i> SecRule ARGS|ARGS_NAMES|XML:/* &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\*
</I>&gt;<i> ]+)){4,}&quot;
</I>&gt;<i> &quot;skip:1,phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,pass,nolog,auditlog,msg:'Basic
</I>&gt;<i> Charcode Pattern
</I>&gt;<i> Found',id:'973016',tag:'WEB_ATTACK/EVASION',logdata:'%{TX.0}',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}-WEB_ATTACK/EVASION-%{matched_var_name}=%{tx.0}&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> My coworker discovered that if we modify a portion of the rule then we are
</I>&gt;<i> able to run the application properly. In particular if we modify {4} to {10}
</I>&gt;<i> &#160;then things begin working
</I>&gt;<i>
</I>&gt;<i> SecRule ARGS|ARGS_NAMES|XML:/* &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\*
</I>&gt;<i> ]+)){4,}&quot; &#8230;&#8230; TO &#8230;&#8230;. SecRule ARGS|ARGS_NAMES|XML:/* &quot;(?:[\d+-=\/\*
</I>&gt;<i> ]+(?:\s?,\s?[\d+-=\/\* ]+)){10,}&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> We are concerned that by making this change we either inadvertently make our
</I>&gt;<i> security weaker or break other things. So we are wondering if the rule has
</I>&gt;<i> an inherit problem and is there a way to either resolve it or by pass it or
</I>&gt;<i> any other best practice.
</I>
Hi Mirabito,

Earlier versions of the PHP IDS rules were false positive prone. That
ruleset has subsequently been converted to Lua. Consider upgrading the
core rule set or disabling that rule for the effected script.

--
 - Josh
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000641.html">[Owasp-modsecurity-core-rule-set] modsecurity logs managment tool
</A></li>
	<LI>Next message: <A HREF="000643.html">[Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#642">[ date ]</a>
              <a href="thread.html#642">[ thread ]</a>
              <a href="subject.html#642">[ subject ]</a>
              <a href="author.html#642">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
