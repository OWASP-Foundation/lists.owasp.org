<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] CRS 2.1.1 Brute Force rules not	blocking requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20CRS%202.1.1%20Brute%20Force%20rules%20not%0A%09blocking%20requests&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000653.html">
   <LINK REL="Next"  HREF="000656.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] CRS 2.1.1 Brute Force rules not	blocking requests</H1>
    <B>Yonah Russ</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20CRS%202.1.1%20Brute%20Force%20rules%20not%0A%09blocking%20requests&In-Reply-To="
       TITLE="[Owasp-modsecurity-core-rule-set] CRS 2.1.1 Brute Force rules not	blocking requests">owasp at yonahruss.com
       </A><BR>
    <I>Sun Mar 20 05:51:31 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000653.html">[Owasp-modsecurity-core-rule-set] ModSecurity Advanced Topic of the	Week: Malware Link Detection
</A></li>
        <LI>Next message: <A HREF="000656.html">[Owasp-modsecurity-core-rule-set] CRS 2.1.1 Brute Force rules not blocking requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#655">[ date ]</a>
              <a href="thread.html#655">[ thread ]</a>
              <a href="subject.html#655">[ subject ]</a>
              <a href="author.html#655">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm using 2.5.13 with CRS 2.1.1
I've configured the following:

SecAction &quot;phase:1,t:none,nolog,pass, \
setvar:'tx.brute_force_protected_urls=/protected_url /protected_url2', \
setvar:'tx.brute_force_burst_time_slice=60', \
setvar:'tx.brute_force_counter_threshold=5', \
setvar:'tx.brute_force_block_timeout=300'&quot;

When I test, all the requests get through and not even a message in the logs
:<i>(
</I>Here is an excerpt from the debug log:
...
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Setting variable:
tx.brute_force_protected_urls=/protected_url /protected_url2
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Set variable
&quot;tx.brute_force_protected_urls&quot; to &quot;/protected_url /protected_url2&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Setting variable:
tx.brute_force_burst_time_slice=60
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Set variable
&quot;tx.brute_force_burst_time_slice&quot; to &quot;60&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Setting variable:
tx.brute_force_counter_threshold=5
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Set variable
&quot;tx.brute_force_counter_threshold&quot; to &quot;5&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Setting variable:
tx.brute_force_block_timeout=300
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Set variable
&quot;tx.brute_force_block_timeout&quot; to &quot;300&quot;.
...
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Creating
collection (name &quot;global&quot;, key &quot;global&quot;).
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Recorded original
collection variable: global.UPDATE_COUNTER = &quot;0&quot;
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Added collection
&quot;global&quot; to the list.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Resolved macro
%{remote_addr} to: 192.168.1.1
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Resolved macro
%{tx.ua_hash} to: 3dcbbff145dcf13aa6287b931eb296b39b7541ee
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;__expire_KEY&quot;, value &quot;1300615158&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;KEY&quot;, value &quot;192.168.1.1_3dcbbff145dcf13aa6287b931eb296b39b7541ee&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;TIMEOUT&quot;, value &quot;3600&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;__key&quot;, value &quot;192.168.1.1_3dcbbff145dcf13aa6287b931eb296b39b7541ee&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;__name&quot;, value &quot;ip&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;CREATE_TIME&quot;, value &quot;1300607334&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;UPDATE_COUNTER&quot;, value &quot;75&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;dos_counter&quot;, value &quot;75&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Read variable:
name &quot;LAST_UPDATE_TIME&quot;, value &quot;1300611558&quot;.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Retrieved
collection (name &quot;ip&quot;, key
&quot;192.168.1.1_3dcbbff145dcf13aa6287b931eb296b39b7541ee&quot;).
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] Recorded original
collection variable: ip.UPDATE_COUNTER = &quot;75&quot;
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Added collection
&quot;ip&quot; to the list.
...
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][5] Rule 240d78:
SecRule &quot;IP:BRUTE_FORCE_BLOCK&quot; &quot;@eq 1&quot;
&quot;phase:1,log,noauditlog,chain,block,msg:'Brute Force Attack Identified from
%{remote_addr} (%{tx.brute_force_block_counter} hits since last
alert)',setvar:ip.brute_force_block_counter=+1&quot;
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Rule returned 0.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] No match, chained
-&gt; mode NEXT_CHAIN.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Recipe: Invoking
rule 244cd8; [file
&quot;/opt/www/conf/modsecurity_crs/base_rules/modsecurity_crs_11_brute_force.conf&quot;]
[line &quot;27&quot;].
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][5] Rule 244cd8:
SecRule &quot;IP:BRUTE_FORCE_BLOCK&quot; &quot;@eq 1&quot;
&quot;phase:1,noauditlog,block,nolog,setvar:ip.brute_force_block_counter=+1&quot;
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Rule returned 0.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][9] No match, not
chained -&gt; mode NEXT_RULE.
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Recipe: Invoking
rule 250338; [file
&quot;/opt/www/conf/modsecurity_crs/base_rules/modsecurity_crs_11_dos_protection.conf&quot;]
[line &quot;11&quot;].
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][5] Rule 250338:
SecRule &quot;IP:DOS_BLOCK&quot; &quot;@eq 1&quot;
&quot;phase:1,log,noauditlog,chain,drop,msg:'Denial of Service (DoS) Attack
Identified from %{remote_addr} (%{tx.dos_block_counter} hits since last
alert)',setvar:ip.dos_block_counter=+1&quot;
[20/Mar/2011:09:15:56 +0000] [
www.site.com/sid#12b7778][rid#19211a0][/protected_url][4] Rule returned 0.

&gt;<i>From what I can see, the request never hits the section of rules which
</I>should start counting the requests to the protected url. Instead, it skips
to the next ruleset?
Thanks in advance,
Yonah
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110320/a1284287/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110320/a1284287/attachment.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000653.html">[Owasp-modsecurity-core-rule-set] ModSecurity Advanced Topic of the	Week: Malware Link Detection
</A></li>
	<LI>Next message: <A HREF="000656.html">[Owasp-modsecurity-core-rule-set] CRS 2.1.1 Brute Force rules not blocking requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#655">[ date ]</a>
              <a href="thread.html#655">[ thread ]</a>
              <a href="subject.html#655">[ subject ]</a>
              <a href="author.html#655">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
