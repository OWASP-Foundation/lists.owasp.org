<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] modsecurity logs managment tool
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20modsecurity%20logs%20managment%0A%20tool&In-Reply-To=013601cbddce%240f03a650%242d0af2f0%24%40com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000640.html">
   <LINK REL="Next"  HREF="000642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] modsecurity logs managment tool</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20modsecurity%20logs%20managment%0A%20tool&In-Reply-To=013601cbddce%240f03a650%242d0af2f0%24%40com"
       TITLE="[Owasp-modsecurity-core-rule-set] modsecurity logs managment tool">RBarnett at trustwave.com
       </A><BR>
    <I>Tue Mar  8 15:38:14 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000640.html">[Owasp-modsecurity-core-rule-set] modsecurity logs managment tool
</A></li>
        <LI>Next message: <A HREF="000642.html">[Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#641">[ date ]</a>
              <a href="thread.html#641">[ thread ]</a>
              <a href="subject.html#641">[ subject ]</a>
              <a href="author.html#641">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The mod-security-users list would be the best place for this question -

<A HREF="http://lists.sourceforge.net/lists/listinfo/mod-security-users">http://lists.sourceforge.net/lists/listinfo/mod-security-users</A>

That being said - Chris Bockermann's AuditConsole is probably the best free tool out there right now - &lt;<A HREF="http://jwall.org/web/audit/console/index.jsp">http://jwall.org/web/audit/console/index.jsp</A>&gt; <A HREF="http://jwall.org/web/audit/console/index.jsp">http://jwall.org/web/audit/console/index.jsp</A>


On Mar 8, 2011, at 12:18 PM, &quot;Abdellah Tantan&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">adtantan at paydq.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">adtantan at paydq.com</A>&gt;&gt; wrote:

I am not sure if this is the right mailing list for these questions.

What&#8217;s the best tool to manage modsecurity logs? Keeping in mind that performance is a concern.

Is there any good article of how to configure  modsecurity for better performance?

Thanks

Abdellah


From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&gt; [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf Of Mirabito, Massimo (Max) (CDC/OID/OD) (CTR)
Sent: Tuesday, March 08, 2011 1:59 PM
To: '<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;'
Cc: Wang, Silver (CDC/OID/OD) (CTR)
Subject: [Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70

Dear All

We are having difficulty with one of our applications as it appears that mod_security is blocking some of the content thinking that it is a vulnerability.
We are running Apache version 2.2 with mod_security version 2.05


The url that is giving us problems is as follows:
&lt;<A HREF="https://myserver.com/MYAPP/nt/chart/run.do?t=tcg&amp;m=cot/trend&amp;f=png&amp;r=3&amp;y=2005+to+2009&amp;d=labels_x:%5b2005,2006,2007,2008,2009,-8.88888888E8,2015%5d;tlabels_x:%5b2005,2006,2007,2008,2009%5d;g:%5b%5b89.690721649,86.746987952,91.946308725,90,85.135135135,-8.88888888E8,null%5d,%5b90,85,87,89,90,-8.88888888E8,null%5d,%5b83.209136562,83.894290701,84.484373669,81.189229619,64.743991641,-8.88888888E8,null%5d,%5bnull,null,null,null,null,-8.88888888E8,93%5d%5d;t:%5b%5b194,166,149,150,148%5d,%5b184,155,144,141,130%5d,%5b174,144,137,135,126%5d,%5b10,11,5,9,18%5d%5d&amp;c=0+0+0+0+1&amp;rid=1">https://myserver.com/MYAPP/nt/chart/run.do?t=tcg&amp;m=cot/trend&amp;f=png&amp;r=3&amp;y=2005+to+2009&amp;d=labels_x:%5b2005,2006,2007,2008,2009,-8.88888888E8,2015%5d;tlabels_x:%5b2005,2006,2007,2008,2009%5d;g:%5b%5b89.690721649,86.746987952,91.946308725,90,85.135135135,-8.88888888E8,null%5d,%5b90,85,87,89,90,-8.88888888E8,null%5d,%5b83.209136562,83.894290701,84.484373669,81.189229619,64.743991641,-8.88888888E8,null%5d,%5bnull,null,null,null,null,-8.88888888E8,93%5d%5d;t:%5b%5b194,166,149,150,148%5d,%5b184,155,144,141,130%5d,%5b174,144,137,135,126%5d,%5b10,11,5,9,18%5d%5d&amp;c=0+0+0+0+1&amp;rid=1</A>&gt;<A HREF="https://myserver.com/MYAPP/nt/chart/run.do?t=tcg&amp;m=cot/trend&amp;f=png&amp;r=3&amp;y=2005+to+2009&amp;d=labels_x:[2005,2006,2007,2008,2009,-8.88888888E8,2015];tlabels_x:[2005,2006,2007,2008,2009];g:[[89.690721649,86.746987952,91.946308725,90,85.135135135,-8.88888888E8,null],[90,85,87,89,90,-8.88888888E8,null],[83.209136562,83.894290701,84.484373669,81.189229619,64.743991641,-8.88888888E8,null],[null,null,null,null,null,-8.88888888E8,93]];t:[[194,166,149,150,148],[184,155,144,141,130],[174,144,137,135,126],[10,11,5,9,18]]&amp;c=0+0+0+0+1&amp;rid=1">https://myserver.com/MYAPP/nt/chart/run.do?t=tcg&amp;m=cot/trend&amp;f=png&amp;r=3&amp;y=2005+to+2009&amp;d=labels_x:[2005,2006,2007,2008,2009,-8.88888888E8,2015];tlabels_x:[2005,2006,2007,2008,2009];g:[[89.690721649,86.746987952,91.946308725,90,85.135135135,-8.88888888E8,null],[90,85,87,89,90,-8.88888888E8,null],[83.209136562,83.894290701,84.484373669,81.189229619,64.743991641,-8.88888888E8,null],[null,null,null,null,null,-8.88888888E8,93]];t:[[194,166,149,150,148],[184,155,144,141,130],[174,144,137,135,126],[10,11,5,9,18]]&amp;c=0+0+0+0+1&amp;rid=1</A>

The peculiar thing is that a similar url runs properly, see below
https:// myserver.com/MYAPP/nt/chart/run.do?&lt;<A HREF="http://myserver.com/MYAPP/nt/chart/run.do?">http://myserver.com/MYAPP/nt/chart/run.do?</A>&gt; t=pct&amp;m=cot/outcomes&amp;f=png&amp;r=3&amp;y=2009&amp;d=p:[[148,100],[126,85.135135135],[4,2.7027027027],[0,0],[2,1.3513513514],[1,0.6756756757],[15,10.135135135]]&amp;&amp;rid=1

The logs show the following rule being violated:
Message: Pattern match &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\* ]+)){4,}&quot; at ARGS:d. [file &quot;C:/Apache2.2/conf/mod_security/base_rules/modsecurity_crs_41_phpids_converter.conf&quot;] [line &quot;70&quot;] [id &quot;973016&quot;] [msg &quot;Basic Charcode Pattern Found&quot;] [data &quot;2005,2006,2007,2008,2009,-8.88888888e3&quot;]

The rule in question is located in modsecurity_crs_41_phpids_converter.conf  - line 70
SecRule ARGS|ARGS_NAMES|XML:/* &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\* ]+)){4,}&quot; &quot;skip:1,phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:compressWhiteSpace,t:lowercase,ctl:auditLogParts=+E,pass,nolog,auditlog,msg:'Basic Charcode Pattern Found',id:'973016',tag:'WEB_ATTACK/EVASION',logdata:'%{TX.0}',severity:'4',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}-WEB_ATTACK/EVASION-%{matched_var_name}=%{tx.0}&quot;

My coworker discovered that if we modify a portion of the rule then we are able to run the application properly. In particular if we modify {4} to {10}  then things begin working
SecRule ARGS|ARGS_NAMES|XML:/* &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\* ]+)){4,}&quot; &#8230;&#8230; TO &#8230;&#8230;. SecRule ARGS|ARGS_NAMES|XML:/* &quot;(?:[\d+-=\/\* ]+(?:\s?,\s?[\d+-=\/\* ]+)){10,}&quot;

We are concerned that by making this change we either inadvertently make our security weaker or break other things. So we are wondering if the rule has an inherit problem and is there a way to either resolve it or by pass it or any other best practice.


Any feedback is greatly appreciated

Thanks,

Max







_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000640.html">[Owasp-modsecurity-core-rule-set] modsecurity logs managment tool
</A></li>
	<LI>Next message: <A HREF="000642.html">[Owasp-modsecurity-core-rule-set] Rule Set is being violated on modsecurity_crs_41_phpids_converter.conf line 70
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#641">[ date ]</a>
              <a href="thread.html#641">[ thread ]</a>
              <a href="subject.html#641">[ subject ]</a>
              <a href="author.html#641">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
