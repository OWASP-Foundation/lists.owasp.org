<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Announcing: Real-time Application Profiling Ruleset
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Announcing%3A%20Real-time%0A%20Application%20Profiling%20Ruleset&In-Reply-To=C983F4AE.1A245%25rbarnett%40trustwave.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000647.html">
   <LINK REL="Next"  HREF="000654.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Announcing: Real-time Application Profiling Ruleset</H1>
    <B>Colin Watson</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Announcing%3A%20Real-time%0A%20Application%20Profiling%20Ruleset&In-Reply-To=C983F4AE.1A245%25rbarnett%40trustwave.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Announcing: Real-time Application Profiling Ruleset">colin.watson at owasp.org
       </A><BR>
    <I>Wed Mar 16 05:21:00 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000647.html">[Owasp-modsecurity-core-rule-set] Announcing ModSecurity	Documentation Wiki
</A></li>
        <LI>Next message: <A HREF="000654.html">[Owasp-modsecurity-core-rule-set] Announcing: Real-time Application Profiling Ruleset
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#650">[ date ]</a>
              <a href="thread.html#650">[ thread ]</a>
              <a href="subject.html#650">[ subject ]</a>
              <a href="author.html#650">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Ryan

I have implemented the experimental rules on a couple of servers, one
in a production environment.  Having read the blog post at:

  <A HREF="http://blog.spiderlabs.com/2011/02/modsecurity-advanced-topic-of-the-week-real-time-application-profiling.html">http://blog.spiderlabs.com/2011/02/modsecurity-advanced-topic-of-the-week-real-time-application-profiling.html</A>

and your reply to Lucas in this thread, I have some additional
comments.  None of these are meant to criticise the excellent work so
far, and may well reflect ideas the team already has, or are just
restating concepts in related work from Ivan Ristic, Ofer Shezaf and
Christian Bockermann.  Some of these are of course just a dream wish
list.  Anyway here goes...

Configuration
---------------

C1: I had to create an empty &quot;modsecurity_40_profiler_ignore.data&quot; for
the rules to work &quot;as is&quot; i.e. this file is not in the CRS 2.1.2
distribution.  Is the syntax of this file one URL per line?

C2: Apart from ignoring certain URLs, could we specify some parameters
to ignore (on some URLs) and on some HTTP methods?  i.e. ignore params
if GET, but enforce if POST.

C3: Could the thresholds (50 and 100) be set near the top of the rule
file, instead of within the SecAction of Step 1?

C4: Thresholds per host/site?

C5: Some application owners may know all the allowable entry
points.... it would be fantastic to have a way of defining that
profile (in XML?) which the CRS profiler could
   i) use as a base starting point, or
   ii) use as a mandatory profile, or
   iii) use to compare against when reporting discrepancies.
  This would also help to group similar URLs (e.g. paths when URL
rewriting is in use).

C6: Ability to modify model in C5 in real time (e.g. as URLs are added
created when writing a new blog post, or pages are added in a CMS)

C7: Ability for model in C5 to have the idea of &quot;strict&quot; and
&quot;allowable&quot; parameter value definitions.  Example 1: we might want a
phone number to be all numbers and spaces, but let's not get too upset
with hyphens and parentheses.  Example 2: A trailing line break on a
password could just be from copy &amp; paste, not an attack.  So the
profiler would then need to report whether a parameter value just met
the allowable format, or failed that too.

Method
----------

M1: Accessing the same URL on multiple virtual hosts, using the same
instance of ModSecurity (and with the same web browser) seems to
create an aggregated profile rather than a profile per host (but I may
be wrong):

  <A HREF="http://www.example1.com/profiler.txt?site=2">http://www.example1.com/profiler.txt?site=2</A>
  <A HREF="http://www.example2com/profiler.txt?site=1&amp;day=wednesday">http://www.example2com/profiler.txt?site=1&amp;day=wednesday</A>

  Is there a way to profile each host separately?

M2: Could (or Is?) the HTTP method be part of the profile so there
could be different parameters for GET and POST for example.

M3: Further data types (bit, SQL types, UUID, lists of integers, etc),
and perhaps user-definable data types - both of these would be of more
use if C5 is implemented.

M4: Ability to allow null values for parameters e.g. normally 0 or 1
but could be NULL

M5: Build result into anomaly scoring.

Data Storage
-------------------

D1: Do you have any references for the format of this file, and of the
profiler key records, so we can try to extract data and convert it
into other formats?

Syndication of result
------------------------------

S1: Could the &quot;result&quot; be added as another X-WAF-... header

S2: This one isn't Profiling-specific, but currently the X-WAF-
headers are added to the request... could there be a method to pass
data on by URL (e.g. like CSP reporting mechanism), so that say even
if something is blocked it is possible to inform other devices of the
event?  The data sent could be configurable, but might include what's
currently in the X-WAF- headers, plus the original header content.


Colin



On 18 February 2011 15:11, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On 2/18/11 9:52 AM, &quot;Lucas Ferreira&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">listas at sapao.net</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>Hello Ryan,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>after reading your blog post, I still have some doubts:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>How does the profiling work with regard to restarting the web server?
</I>&gt;&gt;<i>Are the collections saved to disk?
</I>&gt;<i>
</I>&gt;<i> Yes - the data is saved to persistent storage files on disk. &#160;This would
</I>&gt;<i> keep the data across Apache restarts.
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>How can the administrator restart the profiling process? Is it
</I>&gt;&gt;<i>possible to selectively restart profiling based on host, URL or other
</I>&gt;&gt;<i>application identifier?
</I>&gt;<i>
</I>&gt;<i> Great question. &#160;We actually were talking a bit about some options for
</I>&gt;<i> profile management. &#160;One option that we are thinking of would be to use
</I>&gt;<i> dynamic updates based on access requests from &quot;trusted&quot; clients. &#160;Take a
</I>&gt;<i> look at the previous blog post on GeoIP data where we talk about dynamic
</I>&gt;<i> updates -
</I>&gt;<i> <A HREF="http://blog.spiderlabs.com/2010/10/detecting-malice-with-modsecurity-geoloc">http://blog.spiderlabs.com/2010/10/detecting-malice-with-modsecurity-geoloc</A>
</I>&gt;<i> ation-data.html
</I>&gt;<i>
</I>&gt;<i> The idea would be that if you wanted to remove/relearn a profile for a
</I>&gt;<i> URL, you could have an authorized client send a specific request to that
</I>&gt;<i> URL. &#160;Based on the source IP, UA + Parameter (maybe
</I>&gt;<i> ?relearn_profile=true), then the saved resource collection data for that
</I>&gt;<i> URL would be removed and the relearning would commence. &#160;There are some
</I>&gt;<i> other ideas that we we need to test which could possibly include tracking
</I>&gt;<i> an increase in alerts across multiple clients as this might indicate an
</I>&gt;<i> application change and could initiate an auto-relearn.
</I>&gt;<i>
</I>&gt;<i> This is something that we are planning to add in future versions.
</I>&gt;<i>
</I>&gt;<i> Please keep the comments coming! &#160;We want people to test so that we can
</I>&gt;<i> improve the capabilities.
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Ryan
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Thanks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Lucas
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>On Thu, Feb 17, 2011 at 16:27, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt;
</I>&gt;&gt;<i>wrote:
</I>&gt;&gt;&gt;<i> Hello everyone,
</I>&gt;&gt;&gt;<i> This email will most likely come as very welcomed news to most of you.
</I>&gt;&gt;&gt;<i>We have just released a ruleset to the OWASP CRS that implements a basic
</I>&gt;&gt;&gt;<i>framework for real-time application profiling -
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i><A HREF="http://blog.spiderlabs.com/2011/02/modsecurity-advanced-topic-of-the-week">http://blog.spiderlabs.com/2011/02/modsecurity-advanced-topic-of-the-week</A>
</I>&gt;&gt;&gt;<i>-real-time-application-profiling.html
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> This initial version of the rules has the ability to profile and
</I>&gt;&gt;&gt;<i>enforce the following on a per-resource basis:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &#160;* &#160; Request Method(s)
</I>&gt;&gt;&gt;<i> &#160;* &#160; Number of Parameters
</I>&gt;&gt;&gt;<i> &#160;* &#160; Parameter Names
</I>&gt;&gt;&gt;<i> &#160;* &#160; Parameter Length Ranges
</I>&gt;&gt;&gt;<i> &#160;* &#160; Parameter Types - numeric or alpha
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Please test out this ruleset and provide feedback on the OWASP CRS
</I>&gt;&gt;&gt;<i>mail-list.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Cheers,
</I>&gt;&gt;&gt;<i> Ryan
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ________________________________
</I>&gt;&gt;&gt;<i> This transmission may contain information that is privileged,
</I>&gt;&gt;&gt;<i>confidential, and/or exempt from disclosure under applicable law. If you
</I>&gt;&gt;&gt;<i>are not the intended recipient, you are hereby notified that any
</I>&gt;&gt;&gt;<i>disclosure, copying, distribution, or use of the information contained
</I>&gt;&gt;&gt;<i>herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
</I>&gt;&gt;&gt;<i>received this transmission in error, please immediately contact the
</I>&gt;&gt;&gt;<i>sender and destroy the material in its entirety, whether in electronic
</I>&gt;&gt;&gt;<i>or hard copy format.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>--
</I>&gt;&gt;<i>Homo sapiens non urinat in ventum.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000647.html">[Owasp-modsecurity-core-rule-set] Announcing ModSecurity	Documentation Wiki
</A></li>
	<LI>Next message: <A HREF="000654.html">[Owasp-modsecurity-core-rule-set] Announcing: Real-time Application Profiling Ruleset
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#650">[ date ]</a>
              <a href="thread.html#650">[ thread ]</a>
              <a href="subject.html#650">[ subject ]</a>
              <a href="author.html#650">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
