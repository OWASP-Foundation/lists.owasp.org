From Gary.Mansell at ricardo.com  Mon Apr  4 14:28:26 2016
From: Gary.Mansell at ricardo.com (Mansell, Gary)
Date: Mon, 4 Apr 2016 14:28:26 +0000
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
Message-ID: <HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>

I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?

I have just the one rule in my config now:

SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"

I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.

As far as I can see, it does not seem to run the rule in the REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what is the problem - ie it is checking for the admin string in the REQUEST_BODY rather than the REQUEST_HEADER

I would gladly appreciate some help on this, as I am rather stuck.

Rgds

Gary


[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
[04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
[04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.











-----Original Message-----
From: Chaim Sanders [mailto:CSanders at trustwave.com]
Sent: 31 March 2016 17:33
To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

Hey Gary,
While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.

-----Original Message-----
From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
Sent: Thursday, March 31, 2016 12:31 PM
To: Chaim Sanders <CSanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?

All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?

It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.

The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"

SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"

Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?

Rgds

Gary




I have had a good crack at trying to get this to work, but to no avail, unfortunately.

SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"

I tried changing the contains string to various things that may be relevant, but still no joy.

Is it perhaps because both the reverse proxy and the internal apache server are configured for https?

How do I tell whether my system is using base64 to encode the username in the header?

I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?

Any ideas anyone?

Rgds

Gary


-----Original Message-----
From: Chaim Sanders [mailto:CSanders at trustwave.com]
Sent: 14 March 2016 15:58
To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

Hey Gary,
This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'

-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Mansell, Gary
Sent: Monday, March 14, 2016 11:13 AM
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

Hi,

I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.

I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.

It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?

If so, please can someone point me in the direction of how I might achieve this?

Thanks

Gary



--------------------------------------------------------------------------------------------------------------------------------------------------------------
This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
"Ricardo" means Ricardo plc and its subsidiary companies.
Ricardo plc is a public limited company registered in England with registered number 00222915.
The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

--------------------------------------------------------------------------------------------------------------------------------------------------------------
This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
"Ricardo" means Ricardo plc and its subsidiary companies.
Ricardo plc is a public limited company registered in England with registered number 00222915.
The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set

--------------------------------------------------------------------------------------------------------------------------------------------------------------
This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
"Ricardo" means Ricardo plc and its subsidiary companies.
Ricardo plc is a public limited company registered in England with registered number 00222915.
The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
--------------------------------------------------------------------------------------------------------------------------------------------------------------

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

--------------------------------------------------------------------------------------------------------------------------------------------------------------
This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
"Ricardo" means Ricardo plc and its subsidiary companies.
Ricardo plc is a public limited company registered in England with registered number 00222915.
The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
--------------------------------------------------------------------------------------------------------------------------------------------------------------

From christovamps at gmail.com  Mon Apr  4 14:53:58 2016
From: christovamps at gmail.com (Christovam Paynes Silva)
Date: Mon, 4 Apr 2016 11:53:58 -0300
Subject: [Owasp-modsecurity-core-rule-set] How to generate graphs of
	modsecurity?
Message-ID: <CAFJPc5xrmhph88tXygcXwNkdWqX0ny-=QwLRkJ+abwcSLM2F-A@mail.gmail.com>

Hello guys.

Does anyone know any tool to generate graphs of ModSecurity?
He used the http://waf-fle.org but was discontinued.

Thank you.

Saturday at 10:37
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160404/49f952b7/attachment.html>

From christian.folini at netnea.com  Tue Apr  5 04:57:55 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 5 Apr 2016 06:57:55 +0200
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
Message-ID: <20160405045755.GA16512@elias>

Any luck, Gary?

Suggestions: 
- Try the debug log
- do this step by step. Step #1: Try the match the encoded Header value
  (the one with the username:password in base64)

Ahoj,

Christian


On Thu, Mar 31, 2016 at 04:33:09PM +0000, Chaim Sanders wrote:
> Hey Gary,
> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.




> 
> -----Original Message-----
> From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
> Sent: Thursday, March 31, 2016 12:31 PM
> To: Chaim Sanders <CSanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> 
> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
> 
> All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
> 
> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
> 
> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
> 
> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
> 
> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
> 
> Rgds
> 
> Gary
> 
> 
> 
> 
> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
> 
> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
> 
> I tried changing the contains string to various things that may be relevant, but still no joy.
> 
> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
> 
> How do I tell whether my system is using base64 to encode the username in the header?
> 
> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
> 
> Any ideas anyone?
> 
> Rgds
> 
> Gary
> 
> 
> -----Original Message-----
> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> Sent: 14 March 2016 15:58
> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> 
> Hey Gary,
> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
> 
> -----Original Message-----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Mansell, Gary
> Sent: Monday, March 14, 2016 11:13 AM
> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> 
> Hi,
> 
> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
> 
> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
> 
> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
> 
> If so, please can someone point me in the direction of how I might achieve this?
> 
> Thanks
> 
> Gary
> 
> 
> 
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
> 
> ________________________________
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
> 
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> 
> ________________________________
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-- 
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini

From barry_pollard at hotmail.com  Tue Apr  5 08:46:58 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 5 Apr 2016 09:46:58 +0100
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>
Message-ID: <DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>

Christian not sure if you missed this as Gary had replied?

Gary, the key issue is this:

> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
<snip>
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.

So your rule is not matching for some reason. I would suggest you turn the audit engine on to capture all request:

SecAuditEngine On

And then see if this Authorization header is included, with a value containing admin, by looking in the audit log.

Alternatively write another rule that matches always:

?SecRule "REQUEST_URI" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow"

And again check audit log to see if the Authorization header is included, with a value containing admin.

By the way phase 2 (REQUEST_BODY) also includes phase 1 (REQUEST_HEADER) details. You could move your rule to phase 1 and it will execute earlier which might save you needlessly attempting other phase 2 rules if it fails, but this is not the reason for your failure here.

Hope that helps.

Thanks,
Barry




----------------------------------------
> From: Gary.Mansell at ricardo.com
> To: CSanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> Date: Mon, 4 Apr 2016 14:28:26 +0000
> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?
>
> I have just the one rule in my config now:
>
> SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>
> I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.
>
> As far as I can see, it does not seem to run the rule in the REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what is the problem - ie it is checking for the admin string in the REQUEST_BODY rather than the REQUEST_HEADER
>
> I would gladly appreciate some help on this, as I am rather stuck.
>
> Rgds
>
> Gary
>
>
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.
>
>
>
>
>
>
>
>
>
>
>
> -----Original Message-----
> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> Sent: 31 March 2016 17:33
> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hey Gary,
> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
>
> -----Original Message-----
> From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
> Sent: Thursday, March 31, 2016 12:31 PM
> To: Chaim Sanders <CSanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
>
> All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
>
> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
>
> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
>
> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>
> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
>
> Rgds
>
> Gary
>
>
>
>
> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
>
> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>
> I tried changing the contains string to various things that may be relevant, but still no joy.
>
> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
>
> How do I tell whether my system is using base64 to encode the username in the header?
>
> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
>
> Any ideas anyone?
>
> Rgds
>
> Gary
>
>
> -----Original Message-----
> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> Sent: 14 March 2016 15:58
> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hey Gary,
> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
>
> -----Original Message-----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Mansell, Gary
> Sent: Monday, March 14, 2016 11:13 AM
> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hi,
>
> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
>
> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
>
> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
>
> If so, please can someone point me in the direction of how I might achieve this?
>
> Thanks
>
> Gary
>
>
>
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
>
> ________________________________
>
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
>
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>
> ________________________________
>
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
> addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
> of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
> are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
> other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
> any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
 		 	   		  

From christian.folini at netnea.com  Tue Apr  5 09:13:42 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 5 Apr 2016 11:13:42 +0200
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>
Message-ID: <20160405091342.GA23913@elias>

Indeed, I missed this. Probably clicked it away.

Thank you Barry.

Ahoj,

Christian

On Tue, Apr 05, 2016 at 09:46:58AM +0100, Barry Pollard wrote:
> Christian not sure if you missed this as Gary had replied?
> 
> Gary, the key issue is this:
> 
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> <snip>
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
> 
> So your rule is not matching for some reason. I would suggest you turn the audit engine on to capture all request:
> 
> SecAuditEngine On
> 
> And then see if this Authorization header is included, with a value containing admin, by looking in the audit log.
> 
> Alternatively write another rule that matches always:
> 
> ?SecRule "REQUEST_URI" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow"
> 
> And again check audit log to see if the Authorization header is included, with a value containing admin.
> 
> By the way phase 2 (REQUEST_BODY) also includes phase 1 (REQUEST_HEADER) details. You could move your rule to phase 1 and it will execute earlier which might save you needlessly attempting other phase 2 rules if it fails, but this is not the reason for your failure here.
> 
> Hope that helps.
> 
> Thanks,
> Barry
> 
> 
> 
> 
> ----------------------------------------
> > From: Gary.Mansell at ricardo.com
> > To: CSanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> > Date: Mon, 4 Apr 2016 14:28:26 +0000
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >
> > I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?
> >
> > I have just the one rule in my config now:
> >
> > SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> >
> > I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.
> >
> > As far as I can see, it does not seem to run the rule in the REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what is the problem - ie it is checking for the admin string in the REQUEST_BODY rather than the REQUEST_HEADER
> >
> > I would gladly appreciate some help on this, as I am rather stuck.
> >
> > Rgds
> >
> > Gary
> >
> >
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> > [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> > [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> >
> > -----Original Message-----
> > From: Chaim Sanders [mailto:CSanders at trustwave.com]
> > Sent: 31 March 2016 17:33
> > To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> > Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >
> > Hey Gary,
> > While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
> >
> > -----Original Message-----
> > From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
> > Sent: Thursday, March 31, 2016 12:31 PM
> > To: Chaim Sanders <CSanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >
> > Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
> >
> > All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
> >
> > It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
> >
> > The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
> >
> > SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
> >
> > Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
> >
> > Rgds
> >
> > Gary
> >
> >
> >
> >
> > I have had a good crack at trying to get this to work, but to no avail, unfortunately.
> >
> > SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
> >
> > I tried changing the contains string to various things that may be relevant, but still no joy.
> >
> > Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
> >
> > How do I tell whether my system is using base64 to encode the username in the header?
> >
> > I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
> >
> > Any ideas anyone?
> >
> > Rgds
> >
> > Gary
> >
> >
> > -----Original Message-----
> > From: Chaim Sanders [mailto:CSanders at trustwave.com]
> > Sent: 14 March 2016 15:58
> > To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> > Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >
> > Hey Gary,
> > This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
> >
> > -----Original Message-----
> > From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Mansell, Gary
> > Sent: Monday, March 14, 2016 11:13 AM
> > To: owasp-modsecurity-core-rule-set at lists.owasp.org
> > Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >
> > Hi,
> >
> > I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
> >
> > I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
> >
> > It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
> >
> > If so, please can someone point me in the direction of how I might achieve this?
> >
> > Thanks
> >
> > Gary
> >
> >
> >
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> > Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> > "Ricardo" means Ricardo plc and its subsidiary companies.
> > Ricardo plc is a public limited company registered in England with registered number 00222915.
> > The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> > http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
> >
> > ________________________________
> >
> > This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> >
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> > Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> > "Ricardo" means Ricardo plc and its subsidiary companies.
> > Ricardo plc is a public limited company registered in England with registered number 00222915.
> > The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> > http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
> >
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> > Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> > "Ricardo" means Ricardo plc and its subsidiary companies.
> > Ricardo plc is a public limited company registered in England with registered number 00222915.
> > The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >
> > ________________________________
> >
> > This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> >
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
> > addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> > Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
> > of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
> > are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
> > other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
> > any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> > "Ricardo" means Ricardo plc and its subsidiary companies.
> > Ricardo plc is a public limited company registered in England with registered number 00222915.
> > The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> > --------------------------------------------------------------------------------------------------------------------------------------------------------------
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>  		 	   		  
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-- 
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini

From barry_pollard at hotmail.com  Tue Apr  5 10:29:13 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 5 Apr 2016 11:29:13 +0100
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <20160405091342.GA23913@elias>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>,
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>,
	<20160405091342.GA23913@elias>
Message-ID: <DUB116-W7052501381697F87F83269829E0@phx.gbl>

One other thing I've just spotted:

? ? I entered the username grmawcadmin

? ??Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.

The username does not contain "admin:" with a colon.
Do you need to remove the colon from your rule?

Thanks,
Barry


----------------------------------------
> Date: Tue, 5 Apr 2016 11:13:42 +0200
> From: christian.folini at netnea.com
> To: barry_pollard at hotmail.com
> CC: gary.mansell at ricardo.com; csanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Indeed, I missed this. Probably clicked it away.
>
> Thank you Barry.
>
> Ahoj,
>
> Christian
>
> On Tue, Apr 05, 2016 at 09:46:58AM +0100, Barry Pollard wrote:
>> Christian not sure if you missed this as Gary had replied?
>>
>> Gary, the key issue is this:
>>
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
>> <snip>
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
>>
>> So your rule is not matching for some reason. I would suggest you turn the audit engine on to capture all request:
>>
>> SecAuditEngine On
>>
>> And then see if this Authorization header is included, with a value containing admin, by looking in the audit log.
>>
>> Alternatively write another rule that matches always:
>>
>> SecRule "REQUEST_URI" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow"
>>
>> And again check audit log to see if the Authorization header is included, with a value containing admin.
>>
>> By the way phase 2 (REQUEST_BODY) also includes phase 1 (REQUEST_HEADER) details. You could move your rule to phase 1 and it will execute earlier which might save you needlessly attempting other phase 2 rules if it fails, but this is not the reason for your failure here.
>>
>> Hope that helps.
>>
>> Thanks,
>> Barry
>>
>>
>>
>>
>> ----------------------------------------
>>> From: Gary.Mansell at ricardo.com
>>> To: CSanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Date: Mon, 4 Apr 2016 14:28:26 +0000
>>> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>>
>>> I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?
>>>
>>> I have just the one rule in my config now:
>>>
>>> SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>>>
>>> I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.
>>>
>>> As far as I can see, it does not seem to run the rule in the REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what is the problem - ie it is checking for the admin string in the REQUEST_BODY rather than the REQUEST_HEADER
>>>
>>> I would gladly appreciate some help on this, as I am rather stuck.
>>>
>>> Rgds
>>>
>>> Gary
>>>
>>>
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
>>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
>>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>>
>>> -----Original Message-----
>>> From: Chaim Sanders [mailto:CSanders at trustwave.com]
>>> Sent: 31 March 2016 17:33
>>> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>>
>>> Hey Gary,
>>> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
>>>
>>> -----Original Message-----
>>> From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
>>> Sent: Thursday, March 31, 2016 12:31 PM
>>> To: Chaim Sanders <CSanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>>
>>> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
>>>
>>> All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
>>>
>>> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
>>>
>>> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
>>>
>>> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>>>
>>> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
>>>
>>> Rgds
>>>
>>> Gary
>>>
>>>
>>>
>>>
>>> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
>>>
>>> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>>>
>>> I tried changing the contains string to various things that may be relevant, but still no joy.
>>>
>>> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
>>>
>>> How do I tell whether my system is using base64 to encode the username in the header?
>>>
>>> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
>>>
>>> Any ideas anyone?
>>>
>>> Rgds
>>>
>>> Gary
>>>
>>>
>>> -----Original Message-----
>>> From: Chaim Sanders [mailto:CSanders at trustwave.com]
>>> Sent: 14 March 2016 15:58
>>> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>>
>>> Hey Gary,
>>> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
>>>
>>> -----Original Message-----
>>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Mansell, Gary
>>> Sent: Monday, March 14, 2016 11:13 AM
>>> To: owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>>
>>> Hi,
>>>
>>> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
>>>
>>> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
>>>
>>> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
>>>
>>> If so, please can someone point me in the direction of how I might achieve this?
>>>
>>> Thanks
>>>
>>> Gary
>>>
>>>
>>>
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>>> "Ricardo" means Ricardo plc and its subsidiary companies.
>>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
>>>
>>> ________________________________
>>>
>>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>>>
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>>> "Ricardo" means Ricardo plc and its subsidiary companies.
>>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
>>>
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>>> "Ricardo" means Ricardo plc and its subsidiary companies.
>>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>>
>>> ________________________________
>>>
>>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>>>
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
>>> addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
>>> of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
>>> are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
>>> other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
>>> any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>>> "Ricardo" means Ricardo plc and its subsidiary companies.
>>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> --
> mailto:christian.folini at netnea.com
> http://www.christian-folini.ch
> twitter: @ChrFolini
 		 	   		  

From christian.folini at netnea.com  Tue Apr  5 11:20:09 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 5 Apr 2016 13:20:09 +0200
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DUB116-W7052501381697F87F83269829E0@phx.gbl>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>
	<20160405091342.GA23913@elias>
	<DUB116-W7052501381697F87F83269829E0@phx.gbl>
Message-ID: <20160405112009.GB25795@elias>

Hi,

On Tue, Apr 05, 2016 at 11:29:13AM +0100, Barry Pollard wrote:
> ? ??Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> 
> The username does not contain "admin:" with a colon.
> Do you need to remove the colon from your rule?

No, Basic Auth header is defined as username colon password.

https://en.wikipedia.org/wiki/Basic_access_authentication#Client_side

So I think it looks a bit odd with the colon, but it is a means
to anchor the end of the username.

This should not be an issue.

Ahoj,

Christian


> 
> Thanks,
> Barry
> 
> 
> ----------------------------------------
> > Date: Tue, 5 Apr 2016 11:13:42 +0200
> > From: christian.folini at netnea.com
> > To: barry_pollard at hotmail.com
> > CC: gary.mansell at ricardo.com; csanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >
> > Indeed, I missed this. Probably clicked it away.
> >
> > Thank you Barry.
> >
> > Ahoj,
> >
> > Christian
> >
> > On Tue, Apr 05, 2016 at 09:46:58AM +0100, Barry Pollard wrote:
> >> Christian not sure if you missed this as Gary had replied?
> >>
> >> Gary, the key issue is this:
> >>
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> >> <snip>
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
> >>
> >> So your rule is not matching for some reason. I would suggest you turn the audit engine on to capture all request:
> >>
> >> SecAuditEngine On
> >>
> >> And then see if this Authorization header is included, with a value containing admin, by looking in the audit log.
> >>
> >> Alternatively write another rule that matches always:
> >>
> >> SecRule "REQUEST_URI" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow"
> >>
> >> And again check audit log to see if the Authorization header is included, with a value containing admin.
> >>
> >> By the way phase 2 (REQUEST_BODY) also includes phase 1 (REQUEST_HEADER) details. You could move your rule to phase 1 and it will execute earlier which might save you needlessly attempting other phase 2 rules if it fails, but this is not the reason for your failure here.
> >>
> >> Hope that helps.
> >>
> >> Thanks,
> >> Barry
> >>
> >>
> >>
> >>
> >> ----------------------------------------
> >>> From: Gary.Mansell at ricardo.com
> >>> To: CSanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> Date: Mon, 4 Apr 2016 14:28:26 +0000
> >>> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >>>
> >>> I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?
> >>>
> >>> I have just the one rule in my config now:
> >>>
> >>> SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> >>>
> >>> I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.
> >>>
> >>> As far as I can see, it does not seem to run the rule in the REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what is the problem - ie it is checking for the admin string in the REQUEST_BODY rather than the REQUEST_HEADER
> >>>
> >>> I would gladly appreciate some help on this, as I am rather stuck.
> >>>
> >>> Rgds
> >>>
> >>> Gary
> >>>
> >>>
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> >>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> >>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>>
> >>> -----Original Message-----
> >>> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> >>> Sent: 31 March 2016 17:33
> >>> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >>>
> >>> Hey Gary,
> >>> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
> >>>
> >>> -----Original Message-----
> >>> From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
> >>> Sent: Thursday, March 31, 2016 12:31 PM
> >>> To: Chaim Sanders <CSanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >>>
> >>> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
> >>>
> >>> All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
> >>>
> >>> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
> >>>
> >>> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
> >>>
> >>> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
> >>>
> >>> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
> >>>
> >>> Rgds
> >>>
> >>> Gary
> >>>
> >>>
> >>>
> >>>
> >>> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
> >>>
> >>> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
> >>>
> >>> I tried changing the contains string to various things that may be relevant, but still no joy.
> >>>
> >>> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
> >>>
> >>> How do I tell whether my system is using base64 to encode the username in the header?
> >>>
> >>> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
> >>>
> >>> Any ideas anyone?
> >>>
> >>> Rgds
> >>>
> >>> Gary
> >>>
> >>>
> >>> -----Original Message-----
> >>> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> >>> Sent: 14 March 2016 15:58
> >>> To: Mansell, Gary <Gary.Mansell at ricardo.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >>>
> >>> Hey Gary,
> >>> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
> >>>
> >>> -----Original Message-----
> >>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Mansell, Gary
> >>> Sent: Monday, March 14, 2016 11:13 AM
> >>> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> >>>
> >>> Hi,
> >>>
> >>> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
> >>>
> >>> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
> >>>
> >>> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
> >>>
> >>> If so, please can someone point me in the direction of how I might achieve this?
> >>>
> >>> Thanks
> >>>
> >>> Gary
> >>>
> >>>
> >>>
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> >>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> >>> "Ricardo" means Ricardo plc and its subsidiary companies.
> >>> Ricardo plc is a public limited company registered in England with registered number 00222915.
> >>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> _______________________________________________
> >>> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
> >>>
> >>> ________________________________
> >>>
> >>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> >>>
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> >>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> >>> "Ricardo" means Ricardo plc and its subsidiary companies.
> >>> Ricardo plc is a public limited company registered in England with registered number 00222915.
> >>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> _______________________________________________
> >>> Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set
> >>>
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> >>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> >>> "Ricardo" means Ricardo plc and its subsidiary companies.
> >>> Ricardo plc is a public limited company registered in England with registered number 00222915.
> >>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>>
> >>> ________________________________
> >>>
> >>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> >>>
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
> >>> addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> >>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
> >>> of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
> >>> are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
> >>> other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
> >>> any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> >>> "Ricardo" means Ricardo plc and its subsidiary companies.
> >>> Ricardo plc is a public limited company registered in England with registered number 00222915.
> >>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> >>> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> >>> _______________________________________________
> >>> Owasp-modsecurity-core-rule-set mailing list
> >>> Owasp-modsecurity-core-rule-set at lists.owasp.org
> >>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >>
> >> _______________________________________________
> >> Owasp-modsecurity-core-rule-set mailing list
> >> Owasp-modsecurity-core-rule-set at lists.owasp.org
> >> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >
> > --
> > mailto:christian.folini at netnea.com
> > http://www.christian-folini.ch
> > twitter: @ChrFolini
>  		 	   		  
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From christian.folini at netnea.com  Tue Apr 12 06:01:08 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 12 Apr 2016 08:01:08 +0200
Subject: [Owasp-modsecurity-core-rule-set] XSS payload from Reddit used
	against OWASP ModSecurity Core Rules
Message-ID: <20160412060108.GA22390@elias>

Hi there,

Chaim posted a link on github to a batch of XSS payloads published
on reddit.

I could not resist to let it loose against my server.

Here are the results:
https://www.netnea.com/cms/2016/04/12/xss-payload-from-reddit-used-against-owasp-modsecurity-core-rules/

Cheers,

Christian



-- 
If you want to go quickly, go alone. If you want to go far, go together.
-- African Proverb

From Gary.Mansell at ricardo.com  Tue Apr 12 07:25:22 2016
From: Gary.Mansell at ricardo.com (Mansell, Gary)
Date: Tue, 12 Apr 2016 07:25:22 +0000
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DB5PR07MB148078AB09BA34955691D230829F0@DB5PR07MB1480.eurprd07.prod.outlook.com>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>
	<DB5PR07MB148078AB09BA34955691D230829F0@DB5PR07MB1480.eurprd07.prod.outlook.com>
Message-ID: <DB5PR07MB14804282C7642F9AC198233182950@DB5PR07MB1480.eurprd07.prod.outlook.com>

Guys, were you able to see why the admin filter was not working from the logs?

-----Original Message-----
From: Mansell, Gary
Sent: 06 April 2016 15:18
To: 'Barry Pollard' <barry_pollard at hotmail.com>; Chaim Sanders <csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

Hi,

Apologies but I was out the office yesterday and will be out again tomorrow, but here goes.

I have turned on audit logging as suggested - and made a simple page request from the application again supplying the grmawcadmin username with the password test.

I have to say, the audit log does not really make much sense to me, but I can see this line in many places which must be my basic auth:

Authorization: Basic Z3JtYXdjYWRtaW46dGVzdA==


"Z3JtYXdjYWRtaW46dGVzdA==" is base64encoded from the string "grmawcadmin:test" so this looks as expected.

The question is why does modsecurity not decode and detect this authorisation header using the rule Chaim kindly suggested?

Can anyone advise what is wrong - I attach the debug and audit logs

Note: the Web Application is behind an IP whitelist filter and I have since changed the account password...

Rgds

Gary

-----Original Message-----
From: Barry Pollard [mailto:barry_pollard at hotmail.com]
Sent: 05 April 2016 09:47
To: Mansell, Gary <Gary.Mansell at ricardo.com>; Chaim Sanders <csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

Christian not sure if you missed this as Gary had replied?

Gary, the key issue is this:

> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
<snip>
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.

So your rule is not matching for some reason. I would suggest you turn the audit engine on to capture all request:

SecAuditEngine On

And then see if this Authorization header is included, with a value containing admin, by looking in the audit log.

Alternatively write another rule that matches always:

 SecRule "REQUEST_URI" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow"

And again check audit log to see if the Authorization header is included, with a value containing admin.

By the way phase 2 (REQUEST_BODY) also includes phase 1 (REQUEST_HEADER) details. You could move your rule to phase 1 and it will execute earlier which might save you needlessly attempting other phase 2 rules if it fails, but this is not the reason for your failure here.

Hope that helps.

Thanks,
Barry




----------------------------------------
> From: Gary.Mansell at ricardo.com
> To: CSanders at trustwave.com;
> owasp-modsecurity-core-rule-set at lists.owasp.org
> Date: Mon, 4 Apr 2016 14:28:26 +0000
> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?
>
> I have just the one rule in my config now:
>
> SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>
> I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.
>
> As far as I can see, it does not seem to run the rule in the
> REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what
> is the problem - ie it is checking for the admin string in the
> REQUEST_BODY rather than the REQUEST_HEADER
>
> I would gladly appreciate some help on this, as I am rather stuck.
>
> Rgds
>
> Gary
>
>
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.
>
>
>
>
>
>
>
>
>
>
>
> -----Original Message-----
> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> Sent: 31 March 2016 17:33
> To: Mansell, Gary <Gary.Mansell at ricardo.com>;
> owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hey Gary,
> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
>
> -----Original Message-----
> From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
> Sent: Thursday, March 31, 2016 12:31 PM
> To: Chaim Sanders <CSanders at trustwave.com>;
> owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
>
> All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
>
> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
>
> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
>
> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>
> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
>
> Rgds
>
> Gary
>
>
>
>
> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
>
> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>
> I tried changing the contains string to various things that may be relevant, but still no joy.
>
> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
>
> How do I tell whether my system is using base64 to encode the username in the header?
>
> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
>
> Any ideas anyone?
>
> Rgds
>
> Gary
>
>
> -----Original Message-----
> From: Chaim Sanders [mailto:CSanders at trustwave.com]
> Sent: 14 March 2016 15:58
> To: Mansell, Gary <Gary.Mansell at ricardo.com>;
> owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hey Gary,
> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
>
> -----Original Message-----
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
> Behalf Of Mansell, Gary
> Sent: Monday, March 14, 2016 11:13 AM
> To: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hi,
>
> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
>
> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
>
> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
>
> If so, please can someone point me in the direction of how I might achieve this?
>
> Thanks
>
> Gary
>
>
>
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ This e-mail and any files transmitted with it are
> confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-
> IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flisti
> nfo%2fowasp-modsecurity-core-rule-set
>
> ________________________________
>
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ This e-mail and any files transmitted with it are
> confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-
> IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flisti
> nfo%2fowasp-modsecurity-core-rule-set
>
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ This e-mail and any files transmitted with it are
> confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------
>
> ________________________________
>
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ This e-mail and any files transmitted with it are
> confidential and intended solely for the use of the individual or
> entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are
> solely those of the author and do not necessarily represent those of
> Ricardo (save for reports and other documentation formally approved
> and signed for release to the intended recipient). Only Directors are
> authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> ----------------------------------------------------------------------
> ----------------------------------------------------------------------
> ------------------ _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-s
> et


--------------------------------------------------------------------------------------------------------------------------------------------------------------
This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
"Ricardo" means Ricardo plc and its subsidiary companies.
Ricardo plc is a public limited company registered in England with registered number 00222915.
The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
--------------------------------------------------------------------------------------------------------------------------------------------------------------

From barry_pollard at hotmail.com  Tue Apr 12 14:18:04 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 12 Apr 2016 15:18:04 +0100
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DB5PR07MB14804282C7642F9AC198233182950@DB5PR07MB1480.eurprd07.prod.outlook.com>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>,
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>,
	<DB5PR07MB148078AB09BA34955691D230829F0@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DB5PR07MB14804282C7642F9AC198233182950@DB5PR07MB1480.eurprd07.prod.outlook.com>
Message-ID: <DUB116-W3475A6599F7B9174075B3382950@phx.gbl>

The audit log and the debug log don't seem to help much as they show the sent data (i.e. the pretransformed data which has not been base64 Decoded yet).

Can you write a rule to log the post-transform data which might give further clues as to why it's not matching?

For example a rule like this would log any request with the?REQUEST_HEADERS:Authorization and detail the post transform data (TX.0)

SecRule "REQUEST_HEADERS:Authorization" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow,capture,logdata:'Matched Data: %{TX.0} found within %{MATCHED_VAR_NAME}'"

Thanks,
Barry

----------------------------------------
> From: Gary.Mansell at ricardo.com
> To: barry_pollard at hotmail.com; csanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> Date: Tue, 12 Apr 2016 07:25:22 +0000
>
> Guys, were you able to see why the admin filter was not working from the logs?
>
> -----Original Message-----
> From: Mansell, Gary
> Sent: 06 April 2016 15:18
> To: 'Barry Pollard' <barry_pollard at hotmail.com>; Chaim Sanders <csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Hi,
>
> Apologies but I was out the office yesterday and will be out again tomorrow, but here goes.
>
> I have turned on audit logging as suggested - and made a simple page request from the application again supplying the grmawcadmin username with the password test.
>
> I have to say, the audit log does not really make much sense to me, but I can see this line in many places which must be my basic auth:
>
> Authorization: Basic Z3JtYXdjYWRtaW46dGVzdA==
>
>
> "Z3JtYXdjYWRtaW46dGVzdA==" is base64encoded from the string "grmawcadmin:test" so this looks as expected.
>
> The question is why does modsecurity not decode and detect this authorisation header using the rule Chaim kindly suggested?
>
> Can anyone advise what is wrong - I attach the debug and audit logs
>
> Note: the Web Application is behind an IP whitelist filter and I have since changed the account password...
>
> Rgds
>
> Gary
>
> -----Original Message-----
> From: Barry Pollard [mailto:barry_pollard at hotmail.com]
> Sent: 05 April 2016 09:47
> To: Mansell, Gary <Gary.Mansell at ricardo.com>; Chaim Sanders <csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>
> Christian not sure if you missed this as Gary had replied?
>
> Gary, the key issue is this:
>
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
> <snip>
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
>
> So your rule is not matching for some reason. I would suggest you turn the audit engine on to capture all request:
>
> SecAuditEngine On
>
> And then see if this Authorization header is included, with a value containing admin, by looking in the audit log.
>
> Alternatively write another rule that matches always:
>
> SecRule "REQUEST_URI" "." "phase:2,id:2,t:base64Decode,log,auditlog,allow"
>
> And again check audit log to see if the Authorization header is included, with a value containing admin.
>
> By the way phase 2 (REQUEST_BODY) also includes phase 1 (REQUEST_HEADER) details. You could move your rule to phase 1 and it will execute earlier which might save you needlessly attempting other phase 2 rules if it fails, but this is not the reason for your failure here.
>
> Hope that helps.
>
> Thanks,
> Barry
>
>
>
>
> ----------------------------------------
>> From: Gary.Mansell at ricardo.com
>> To: CSanders at trustwave.com;
>> owasp-modsecurity-core-rule-set at lists.owasp.org
>> Date: Mon, 4 Apr 2016 14:28:26 +0000
>> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>
>> I have got some debug logs, but am not certain how what they are telling me - I wonder if anyone can advise me on this?
>>
>> I have just the one rule in my config now:
>>
>> SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>>
>> I started a fresh apache session with empty debug log, and accessed the web application from a fresh browser session (15:18:06) and was prompted to enter username and password. I entered the username grmawcadmin and the password and this shows at 15:18:07 in the log below.
>>
>> As far as I can see, it does not seem to run the rule in the
>> REQUEST_HEADERS section, but rather at the REQUEST_BODY - is this what
>> is the problem - ie it is checking for the admin string in the
>> REQUEST_BODY rather than the REQUEST_HEADER
>>
>> I would gladly appreciate some help on this, as I am rather stuck.
>>
>> Rgds
>>
>> Gary
>>
>>
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising transaction (txid VwJ3nsCoAUcAABgZAbQAAACX).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Input filter: This request does not have a body.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase REQUEST_BODY.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 1 rule(s).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Rule returned 0.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0098b0).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Content Injection: Not enabled.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 10 bytes.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 624 bytes.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0098b0).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8 bytes.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 642 bytes).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Output filter: Output forwarding complete.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Initialising logging.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Starting phase LOGGING.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
>> [04/Apr/2016:15:18:06 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0098b0][/Windchill/app/][4] Audit log: Not configured to run for this request.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising transaction (txid VwJ3qcCoAUcAABgZAbUAAACX).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utma", value "1.1672802757.1445242759.1445242759.1456313530.2"
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Adding request cookie: name "__utmz", value "1.1445242759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)"
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transaction context created (dcfg 1039140).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_HEADERS.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Second phase starting (dcfg 1039140).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Input filter: This request does not have a body.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase REQUEST_BODY.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 1 rule(s).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recipe: Invoking rule 109b5e8; [file "/opt/ptc/HTTPServer/conf/crs/ricardo.conf"] [line "11"] [id "1"].
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][5] Rule 109b5e8: SecRule "REQUEST_HEADERS:Authorization" "@contains admin:" "phase:2,log,auditlog,id:1,t:base64Decode,deny,status:403"
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] T (0) base64Decode: "\x05\xab""
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Transformation completed in 24 usec.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Executing operator "contains" with param "admin:" against REQUEST_HEADERS:Authorization.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Target value: "\x05\xab""
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Operator completed in 7 usec.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Rule returned 0.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] No match, not chained -> mode NEXT_RULE.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Hook insert_filter: Adding output filter (r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_HEADERS.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Content Injection: Not enabled.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1591 bytes.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 1295 bytes.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type FLUSH contains 0 bytes.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 8184 bytes.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type TRANSIENT contains 129 bytes.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Receiving output (f 7fc1ec01d9e8, r 7fc1ec0340f0).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] Output filter: Bucket type EOS contains 0 bytes.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Completed receiving response body (buffered full - 11199 bytes).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase RESPONSE_BODY.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Output filter: Output forwarding complete.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Initialising logging.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Starting phase LOGGING.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][9] This phase consists of 0 rule(s).
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Recording persistent data took 0 microseconds.
>> [04/Apr/2016:15:18:17 +0100] [windchill-test.ricardo.com/sid#10af9e8][rid#7fc1ec0340f0][/Windchill/app/][4] Audit log: Not configured to run for this request.
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>>
>> -----Original Message-----
>> From: Chaim Sanders [mailto:CSanders at trustwave.com]
>> Sent: 31 March 2016 17:33
>> To: Mansell, Gary <Gary.Mansell at ricardo.com>;
>> owasp-modsecurity-core-rule-set at lists.owasp.org
>> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>
>> Hey Gary,
>> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
>>
>> -----Original Message-----
>> From: Mansell, Gary [mailto:Gary.Mansell at ricardo.com]
>> Sent: Thursday, March 31, 2016 12:31 PM
>> To: Chaim Sanders <CSanders at trustwave.com>;
>> owasp-modsecurity-core-rule-set at lists.owasp.org
>> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>
>> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
>>
>> All of my Web Application admin accounts end in the string "admin", and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
>>
>> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
>>
>> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string "admin:"
>>
>> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>>
>> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
>>
>> Rgds
>>
>> Gary
>>
>>
>>
>>
>> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
>>
>> SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1,t:base64Decode,deny,status:403"
>>
>> I tried changing the contains string to various things that may be relevant, but still no joy.
>>
>> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
>>
>> How do I tell whether my system is using base64 to encode the username in the header?
>>
>> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
>>
>> Any ideas anyone?
>>
>> Rgds
>>
>> Gary
>>
>>
>> -----Original Message-----
>> From: Chaim Sanders [mailto:CSanders at trustwave.com]
>> Sent: 14 March 2016 15:58
>> To: Mansell, Gary <Gary.Mansell at ricardo.com>;
>> owasp-modsecurity-core-rule-set at lists.owasp.org
>> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>
>> Hey Gary,
>> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization "@contains admin:" "id:1, t:base64Decode,deny,status:403'
>>
>> -----Original Message-----
>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
>> Behalf Of Mansell, Gary
>> Sent: Monday, March 14, 2016 11:13 AM
>> To: owasp-modsecurity-core-rule-set at lists.owasp.org
>> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
>>
>> Hi,
>>
>> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
>>
>> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
>>
>> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
>>
>> If so, please can someone point me in the direction of how I might achieve this?
>>
>> Thanks
>>
>> Gary
>>
>>
>>
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ This e-mail and any files transmitted with it are
>> confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>> "Ricardo" means Ricardo plc and its subsidiary companies.
>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-
>> IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flisti
>> nfo%2fowasp-modsecurity-core-rule-set
>>
>> ________________________________
>>
>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>>
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ This e-mail and any files transmitted with it are
>> confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>> "Ricardo" means Ricardo plc and its subsidiary companies.
>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> http://scanmail.trustwave.com/?c=4062&d=wND91tX1TZq0UB15loWcH4RfFlxJe-
>> IvfXYgFS8s2g&s=5&u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flisti
>> nfo%2fowasp-modsecurity-core-rule-set
>>
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ This e-mail and any files transmitted with it are
>> confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>> "Ricardo" means Ricardo plc and its subsidiary companies.
>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------
>>
>> ________________________________
>>
>> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
>>
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ This e-mail and any files transmitted with it are
>> confidential and intended solely for the use of the individual or
>> entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
>> Please note that any views or opinions presented in this e-mail are
>> solely those of the author and do not necessarily represent those of
>> Ricardo (save for reports and other documentation formally approved
>> and signed for release to the intended recipient). Only Directors are
>> authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
>> "Ricardo" means Ricardo plc and its subsidiary companies.
>> Ricardo plc is a public limited company registered in England with registered number 00222915.
>> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
>> ----------------------------------------------------------------------
>> ----------------------------------------------------------------------
>> ------------------ _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-s
>> et
>
>
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
> addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
> of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
> are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
> other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
> any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
> "Ricardo" means Ricardo plc and its subsidiary companies.
> Ricardo plc is a public limited company registered in England with registered number 00222915.
> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
> --------------------------------------------------------------------------------------------------------------------------------------------------------------
 		 	   		  

From barry_pollard at hotmail.com  Fri Apr 15 12:29:18 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Fri, 15 Apr 2016 13:29:18 +0100
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DB5PR07MB1480788861263292C40E44AC82680@DB5PR07MB1480.eurprd07.prod.outlook.com>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>,
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>,
	<DB5PR07MB148078AB09BA34955691D230829F0@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DB5PR07MB14804282C7642F9AC198233182950@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DUB116-W3475A6599F7B9174075B3382950@phx.gbl>,
	<DB5PR07MB1480788861263292C40E44AC82680@DB5PR07MB1480.eurprd07.prod.outlook.com>
Message-ID: <DUB116-W35824C56D759EAFB647E6282680@phx.gbl>




OK so the audit log shows shows this in your header:
   Authorization: Basic Z3JtYXdjYWRtaW46dGVzdA==
The value of the Authorization header is therefore "Basic Z3JtYXdjYWRtaW46dGVzdA==" which cannot be base64 decoded due to that initial "Basic " part which is not Base 64 encoded. This is what you are supposed to send so nothing wrong with your header, but it explains why your rule is not working as ModSecurity does not know you only want to base64 decode part of the header.
So you need to write a chained rule to capture the actual base64 encoded part using backets and "capture" and then base 64 decode the TX:1 variable which is captured:
SecRule "REQUEST_HEADERS:Authorization" "^Basic (.*)$" "phase:1,id:1003,log,capture,chain,deny,status:403"        SecRule TX:1 "@contains admin" "t:base64Decode"
I've tested this and it seems to work.
Thanks,Barry

> From: Gary.Mansell at ricardo.com
> To: barry_pollard at hotmail.com; csanders at trustwave.com; owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> Date: Fri, 15 Apr 2016 10:37:16 +0000
> 
> I added the rule, cleared the logs and logged in again with the grmawcadmin user
> 
> Here are the updated logs as requested.
> 


 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160415/8e751938/attachment.html>

From CSanders at trustwave.com  Fri Apr 15 12:31:53 2016
From: CSanders at trustwave.com (Chaim Sanders)
Date: Fri, 15 Apr 2016 12:31:53 +0000
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DUB116-W35824C56D759EAFB647E6282680@phx.gbl>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>
	<DB5PR07MB148078AB09BA34955691D230829F0@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DB5PR07MB14804282C7642F9AC198233182950@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DUB116-W3475A6599F7B9174075B3382950@phx.gbl>
	<DB5PR07MB1480788861263292C40E44AC82680@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DUB116-W35824C56D759EAFB647E6282680@phx.gbl>
Message-ID: <D336571E.1C592%csanders@trustwave.com>

You know, I should have thought about this to begin with but that makes perfect sense - Barry, good eye! There is an open ticket right now for indicating when there is a base64 decoding issue, this will be included within ModSecurityv3. Generally spaces are not valid Base64 chars and would have resulted in such a fix firing and saved us all a little bit of headache.
--
Chaim Sanders
Security Researcher

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>


From: Barry Pollard <barry_pollard at hotmail.com<mailto:barry_pollard at hotmail.com>>
Date: Friday, April 15, 2016 at 8:29 AM
To: "Mansell, Gary" <gary.mansell at ricardo.com<mailto:gary.mansell at ricardo.com>>, Chaim Sanders <csanders at trustwave.com<mailto:csanders at trustwave.com>>, "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

OK so the audit log shows shows this in your header:

   Authorization: Basic Z3JtYXdjYWRtaW46dGVzdA==

The value of the Authorization header is therefore "Basic Z3JtYXdjYWRtaW46dGVzdA==" which cannot be base64 decoded due to that initial "Basic " part which is not Base 64 encoded. This is what you are supposed to send so nothing wrong with your header, but it explains why your rule is not working as ModSecurity does not know you only want to base64 decode part of the header.

So you need to write a chained rule to capture the actual base64 encoded part using backets and "capture" and then base 64 decode the TX:1 variable which is captured:

SecRule "REQUEST_HEADERS:Authorization" "^Basic (.*)$" "phase:1,id:1003,log,capture,chain,deny,status:403"
        SecRule TX:1 "@contains admin" "t:base64Decode"

I've tested this and it seems to work.

Thanks,
Barry


> From: Gary.Mansell at ricardo.com<mailto:Gary.Mansell at ricardo.com>
> To: barry_pollard at hotmail.com<mailto:barry_pollard at hotmail.com>; csanders at trustwave.com<mailto:csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> Date: Fri, 15 Apr 2016 10:37:16 +0000
>
> I added the rule, cleared the logs and logged in again with the grmawcadmin user
>
> Here are the updated logs as requested.
>


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160415/43cdb50f/attachment.html>

From Gary.Mansell at ricardo.com  Fri Apr 15 12:42:34 2016
From: Gary.Mansell at ricardo.com (Mansell, Gary)
Date: Fri, 15 Apr 2016 12:42:34 +0000
Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use
 modsecurity rules to prevent logins by specific user accounts?
In-Reply-To: <DUB116-W35824C56D759EAFB647E6282680@phx.gbl>
References: <DB5PR07MB1480D6DC98C02CC87A9464A082880@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB129566E2071CC1A39C5C45C8DB880@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<DB5PR07MB1480BEA498284204D84E855F82990@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DM2PR0701MB12958A3D09F6CD8DC5D06497DB990@DM2PR0701MB1295.namprd07.prod.outlook.com>,
	<HE1PR07MB1481C6FCA7F05C744EA8384E829D0@HE1PR07MB1481.eurprd07.prod.outlook.com>,
	<DUB116-W52A7D58032D5B6A84A9D9B829E0@phx.gbl>,
	<DB5PR07MB148078AB09BA34955691D230829F0@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DB5PR07MB14804282C7642F9AC198233182950@DB5PR07MB1480.eurprd07.prod.outlook.com>,
	<DUB116-W3475A6599F7B9174075B3382950@phx.gbl>,
	<DB5PR07MB1480788861263292C40E44AC82680@DB5PR07MB1480.eurprd07.prod.outlook.com>
	<DUB116-W35824C56D759EAFB647E6282680@phx.gbl>
Message-ID: <DB5PR07MB1480C0F0B543EDF554754AB582680@DB5PR07MB1480.eurprd07.prod.outlook.com>

Absolutely spot on thank you so much for the solution, it works exactly as I originally hoped it would. Normal users can login fine via the external reverse proxy server, but admin users get denied access by the modsecurity rule.

Barry and Chaim - I really appreciate you both taking the time to help me with this because I was completely stumped and yet felt it should be something well within the capabilities of modsecurity.

I only hope that this information in the mailing list is of help to others that may want to do a similar thing.

Great Stuff !!

From: Barry Pollard [mailto:barry_pollard at hotmail.com]
Sent: 15 April 2016 13:29
To: Mansell, Gary <Gary.Mansell at ricardo.com>; Chaim Sanders <csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

OK so the audit log shows shows this in your header:

   Authorization: Basic Z3JtYXdjYWRtaW46dGVzdA==

The value of the Authorization header is therefore "Basic Z3JtYXdjYWRtaW46dGVzdA==" which cannot be base64 decoded due to that initial "Basic " part which is not Base 64 encoded. This is what you are supposed to send so nothing wrong with your header, but it explains why your rule is not working as ModSecurity does not know you only want to base64 decode part of the header.

So you need to write a chained rule to capture the actual base64 encoded part using backets and "capture" and then base 64 decode the TX:1 variable which is captured:

SecRule "REQUEST_HEADERS:Authorization" "^Basic (.*)$" "phase:1,id:1003,log,capture,chain,deny,status:403"
        SecRule TX:1 "@contains admin" "t:base64Decode"

I've tested this and it seems to work.

Thanks,
Barry

> From: Gary.Mansell at ricardo.com<mailto:Gary.Mansell at ricardo.com>
> To: barry_pollard at hotmail.com<mailto:barry_pollard at hotmail.com>; csanders at trustwave.com<mailto:csanders at trustwave.com>; owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
> Date: Fri, 15 Apr 2016 10:37:16 +0000
>
> I added the rule, cleared the logs and logged in again with the grmawcadmin user
>
> Here are the updated logs as requested.
>

--------------------------------------------------------------------------------------------------------------------------------------------------------------
This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are
addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those
of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors
are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and
other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and
any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
"Ricardo" means Ricardo plc and its subsidiary companies.
Ricardo plc is a public limited company registered in England with registered number 00222915.
The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
--------------------------------------------------------------------------------------------------------------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160415/2c2e7a8a/attachment-0001.html>

From chris at jwall.org  Fri Apr 22 09:03:40 2016
From: chris at jwall.org (Christian Bockermann)
Date: Fri, 22 Apr 2016 11:03:40 +0200
Subject: [Owasp-modsecurity-core-rule-set] How to generate graphs of
	modsecurity?
In-Reply-To: <CAFJPc5xrmhph88tXygcXwNkdWqX0ny-=QwLRkJ+abwcSLM2F-A@mail.gmail.com>
References: <CAFJPc5xrmhph88tXygcXwNkdWqX0ny-=QwLRkJ+abwcSLM2F-A@mail.gmail.com>
Message-ID: <EAEC9807-CD55-4370-998D-AACC2D0E0EB7@jwall.org>

Hi,

what kind of graphs do you want to generate? I once wrote a report-generator,
which takes an XML specification of a report and a serial-modsec-audit file to
generate a reports including some graphs.

Are you interested in anything particular?

Regards,
   Chris


> Am 04.04.2016 um 16:53 schrieb Christovam Paynes Silva <christovamps at gmail.com>:
> 
> Hello guys.
> 
> Does anyone know any tool to generate graphs of ModSecurity?
> He used the http://waf-fle.org but was discontinued.
> 
> Thank you.
> 
> Saturday at 10:37
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From christian.folini at netnea.com  Tue Apr 26 11:58:48 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 26 Apr 2016 13:58:48 +0200
Subject: [Owasp-modsecurity-core-rule-set] Enabling the core rules for only
	a certain pecentarge of requests
Message-ID: <20160426115848.GB2394@elias>

Hi there,

A customer of mine wants to start using the core rules on a busy server.
A few hours and the audit-log amounted to several gigs of storage.

I thought about ways to help him. Here is what I came up with:

https://www.netnea.com/cms/2016/04/26/easing-in-conditional-modsecurity-rule-execution-based-on-pseudo-random-numbers/

Feedback welcome!

Christian


-- 
There are two primary choices in life: (1) To accept conditions as they
exist, or (2) accept responsibility for changing them.
-- Denis Waitley

From cmacallister at probono.net  Tue Apr 26 18:34:33 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Tue, 26 Apr 2016 18:34:33 +0000
Subject: [Owasp-modsecurity-core-rule-set] rules match despite updated
	target list
Message-ID: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>

I have a cookie by the name of CFAUTHORIZATION_cfadmin which is triggering a sql injection OWASP base rule. I have in the past successfully circumvented it with

                SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"

I have this rule in a file called whitelist.conf, and this is being included in my modsecurity_iis.conf file:

Include modsecurity.conf
Include modsecurity_crs_10_setup.conf
Include whitelist.conf
Include owasp_crs\base_rules\*.conf
#Include pbncustom.conf

Modsecurity_iis.conf is being referred to as the base config file in the IIS directive in the application host file like this:

                <ModSecurity enabled="true" configFile="C:\Program Files\ModSecurity IIS\modsecurity_iis.conf" />

But when I make a request, each of the http gets in a request triggers the warning about the CFAUTHORIZATION_cfadmin cookie. (The problem is that the value for the cookie has double quotes around it, which is as far as I know not changeable.)

                [client 127.0.0.1:51619] ModSecurity: Access denied with code 403 (phase 2). Pattern match
                "(^[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+$)" at
                REQUEST_COOKIES:CFAUTHORIZATION_cfadmin.

Does anyone know what might be going on here? I had some confusion about the SecRuleUpdateTargetByID directive, since some sources made Target plural, and some had it in singular ? even in the same resource.

Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160426/370a097d/attachment.html>

From barry_pollard at hotmail.com  Tue Apr 26 19:10:32 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 26 Apr 2016 20:10:32 +0100
Subject: [Owasp-modsecurity-core-rule-set] rules match despite
	updated	target list
In-Reply-To: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <DUB406-EAS3287E1F5854267C11BC610282630@phx.gbl>

You are whitelisting the cookie name and not its value.

Try this:

    SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"

Thanks,
Barry

> On 26 Apr 2016, at 19:47, Colin MacAllister <cmacallister at probono.net> wrote:
> 
> SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"

From christian.folini at netnea.com  Tue Apr 26 19:25:39 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 26 Apr 2016 21:25:39 +0200
Subject: [Owasp-modsecurity-core-rule-set] rules match despite updated
 target list
In-Reply-To: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160426192539.GA481@elias>

Colin,

Please try and include your whitelist.conf _after_ the owasp_crs.

Ahoj,

Christian

On Tue, Apr 26, 2016 at 06:34:33PM +0000, Colin MacAllister wrote:
> I have a cookie by the name of CFAUTHORIZATION_cfadmin which is triggering a sql injection OWASP base rule. I have in the past successfully circumvented it with
> 
>                 SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
> 
> I have this rule in a file called whitelist.conf, and this is being included in my modsecurity_iis.conf file:
> 
> Include modsecurity.conf
> Include modsecurity_crs_10_setup.conf
> Include whitelist.conf
> Include owasp_crs\base_rules\*.conf
> #Include pbncustom.conf
> 
> Modsecurity_iis.conf is being referred to as the base config file in the IIS directive in the application host file like this:
> 
>                 <ModSecurity enabled="true" configFile="C:\Program Files\ModSecurity IIS\modsecurity_iis.conf" />
> 
> But when I make a request, each of the http gets in a request triggers the warning about the CFAUTHORIZATION_cfadmin cookie. (The problem is that the value for the cookie has double quotes around it, which is as far as I know not changeable.)
> 
>                 [client 127.0.0.1:51619] ModSecurity: Access denied with code 403 (phase 2). Pattern match
>                 "(^[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+$)" at
>                 REQUEST_COOKIES:CFAUTHORIZATION_cfadmin.
> 
> Does anyone know what might be going on here? I had some confusion about the SecRuleUpdateTargetByID directive, since some sources made Target plural, and some had it in singular ? even in the same resource.
> 
> Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10
> 

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


-- 
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini

From cmacallister at probono.net  Tue Apr 26 19:38:05 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Tue, 26 Apr 2016 19:38:05 +0000
Subject: [Owasp-modsecurity-core-rule-set] rules match despite
	updated	target list
Message-ID: <CO2PR18MB00124BA620521FF098A0D88FDE630@CO2PR18MB0012.namprd18.prod.outlook.com>

I'm trying to remove the rule when the cookie *name* is that CFAUTH... The cookie value changes with each session. What the have in common are enclosing double quotes, but I only wish to whitelist them when the cookie name is as above.

from my phone

On Apr 26, 2016 3:10 PM, Barry Pollard <barry_pollard at hotmail.com> wrote:
You are whitelisting the cookie name and not its value.

Try this:

    SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"

Thanks,
Barry

> On 26 Apr 2016, at 19:47, Colin MacAllister <cmacallister at probono.net> wrote:
>
> SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160426/8da0b952/attachment-0001.html>

From christian.folini at netnea.com  Tue Apr 26 19:39:31 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 26 Apr 2016 21:39:31 +0200
Subject: [Owasp-modsecurity-core-rule-set] rules match despite
	updated	target list
In-Reply-To: <DUB406-EAS3287E1F5854267C11BC610282630@phx.gbl>
References: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DUB406-EAS3287E1F5854267C11BC610282630@phx.gbl>
Message-ID: <20160426193931.GA893@elias>

On Tue, Apr 26, 2016 at 08:10:32PM +0100, Barry Pollard wrote:
> You are whitelisting the cookie name and not its value.

Argh! Overlooked this. Nice one Barry.

Christian


-- 
If a man be gracious and courteous to strangers, it shows he is a
citizen of the world, and that his heart is no island cut off from
other lands, but a continent that joins to them.
-- Francis Bacon

From barry_pollard at hotmail.com  Tue Apr 26 19:51:38 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 26 Apr 2016 20:51:38 +0100
Subject: [Owasp-modsecurity-core-rule-set] rules match despite
	updated	target list
In-Reply-To: <CO2PR18MB00124BA620521FF098A0D88FDE630@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB00124BA620521FF098A0D88FDE630@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <DUB406-EAS344A4FCB031027B8034A74782630@phx.gbl>

Understand that.

My version of the exception means "exclude rule 981318 from checking the value of the cookie which has the name CFAUTH..."

You're version of the rule means  "exclude rule 981318 from checking the name of the cookie which has the name CFAUTH..."

Both versions of the exclude config are specific to that cookie name.

The log you've shown suggests it's the cookie value (for cookie CFAUTH..) which is triggering the rule not the cookie NAME itself. This makes sense if the cookie value contains double quotes as that is basically what rule 981318 checks for.

There's rarely a need to check the cookie name, so mostly you want to check the value. However if your cookie name included an SQL word (e.g. if your cookie was called abcTRUNCATE123 for example) then you might want to exclude the cookie name from SQL injection rules.

Thanks,
Barry

> On 26 Apr 2016, at 20:38, Colin MacAllister <cmacallister at probono.net> wrote:
> 
> I'm trying to remove the rule when the cookie *name* is that CFAUTH... The cookie value changes with each session. What the have in common are enclosing double quotes, but I only wish to whitelist them when the cookie name is as above.
> 
> from my phone
> 
> On Apr 26, 2016 3:10 PM, Barry Pollard <barry_pollard at hotmail.com> wrote:
> You are whitelisting the cookie name and not its value.
> 
> Try this:
> 
>     SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"
> 
> Thanks,
> Barry
> 
> > On 26 Apr 2016, at 19:47, Colin MacAllister <cmacallister at probono.net> wrote:
> > 
> > SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160426/f81f4700/attachment.html>

From cmacallister at probono.net  Tue Apr 26 20:28:38 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Tue, 26 Apr 2016 20:28:38 +0000
Subject: [Owasp-modsecurity-core-rule-set] rules match despite
	updated	target list
In-Reply-To: <DUB406-EAS344A4FCB031027B8034A74782630@phx.gbl>
References: <CO2PR18MB00124BA620521FF098A0D88FDE630@CO2PR18MB0012.namprd18.prod.outlook.com>,
	<DUB406-EAS344A4FCB031027B8034A74782630@phx.gbl>
Message-ID: <CO2PR18MB0012F3E077C7E2E21C2CE311DE630@CO2PR18MB0012.namprd18.prod.outlook.com>

Thanks for the explanation. So it?s always assumed you are talking about the REQUEST_COOKIE_NAME, and the REQUEST_COOKIES part just tells you what to ignore. Cool.

However, it?s still not working. Now I have

                SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"

The logs show everything starting up fine, and only one block ? the first time it runs into that cookie.

Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10

From: Barry Pollard<mailto:barry_pollard at hotmail.com>
Sent: Tuesday, April 26, 2016 3:51 PM
To: Colin MacAllister<mailto:cmacallister at probono.net>
Cc: OWASP CRS Mailing List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] rules match despite updated target list

Understand that.

My version of the exception means "exclude rule 981318 from checking the value of the cookie which has the name CFAUTH..."

You're version of the rule means  "exclude rule 981318 from checking the name of the cookie which has the name CFAUTH..."

Both versions of the exclude config are specific to that cookie name.

The log you've shown suggests it's the cookie value (for cookie CFAUTH..) which is triggering the rule not the cookie NAME itself. This makes sense if the cookie value contains double quotes as that is basically what rule 981318 checks for.

There's rarely a need to check the cookie name, so mostly you want to check the value. However if your cookie name included an SQL word (e.g. if your cookie was called abcTRUNCATE123 for example) then you might want to exclude the cookie name from SQL injection rules.

Thanks,
Barry

On 26 Apr 2016, at 20:38, Colin MacAllister <cmacallister at probono.net<mailto:cmacallister at probono.net>> wrote:


I'm trying to remove the rule when the cookie *name* is that CFAUTH... The cookie value changes with each session. What the have in common are enclosing double quotes, but I only wish to whitelist them when the cookie name is as above.

from my phone

On Apr 26, 2016 3:10 PM, Barry Pollard <barry_pollard at hotmail.com<mailto:barry_pollard at hotmail.com>> wrote:
You are whitelisting the cookie name and not its value.

Try this:

    SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"

Thanks,
Barry

> On 26 Apr 2016, at 19:47, Colin MacAllister <cmacallister at probono.net<mailto:cmacallister at probono.net>> wrote:
>
> SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160426/d0dce566/attachment.html>

From barry_pollard at hotmail.com  Tue Apr 26 20:42:07 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 26 Apr 2016 21:42:07 +0100
Subject: [Owasp-modsecurity-core-rule-set] rules match despite
	updated	target list
In-Reply-To: <CO2PR18MB0012F3E077C7E2E21C2CE311DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB00124BA620521FF098A0D88FDE630@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DUB406-EAS344A4FCB031027B8034A74782630@phx.gbl>
	<CO2PR18MB0012F3E077C7E2E21C2CE311DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <DUB406-EAS518BF223BF3B6788EBE0BC82630@phx.gbl>

Ok well then to Christian's point: Are you specifying this exception AFTER the rule itself is defined? At the moment it looks like your whitelist.conf file is loaded BEFORE the rules themselves. Annoyingly some exceptions (using ctl) do need specified before but this one needs specified after so it's a little confusing. I usually have the following:

Include modsecurity.conf
Include modsecurity_crs_10_setup.conf
Include whitelist_before.conf
Include owasp_crs\base_rules\*.conf
Include whitelist_after.conf

And in this case the exception needs to be in whitelist_after.conf file.

Also are you sure that it's still blocking on rule 981318 and not another rule? Can you include the full log line?

You can also turn on debug logging and you'll find a detailed log in there which might help you figure it out.

I also presume you did restart your webserver to pick up the new config?

Thanks,
Barry

> On 26 Apr 2016, at 21:28, Colin MacAllister <cmacallister at probono.net> wrote:
> 
> Thanks for the explanation. So it?s always assumed you are talking about the REQUEST_COOKIE_NAME, and the REQUEST_COOKIES part just tells you what to ignore. Cool.
>  
> However, it?s still not working. Now I have
>  
>                 SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"
>  
> The logs show everything starting up fine, and only one block ? the first time it runs into that cookie.
>  
> Sent from Mail for Windows 10
>  
> From: Barry Pollard
> Sent: Tuesday, April 26, 2016 3:51 PM
> To: Colin MacAllister
> Cc: OWASP CRS Mailing List
> Subject: Re: [Owasp-modsecurity-core-rule-set] rules match despite updated target list
>  
> Understand that.
> 
> My version of the exception means "exclude rule 981318 from checking the value of the cookie which has the name CFAUTH..."
> 
> You're version of the rule means  "exclude rule 981318 from checking the name of the cookie which has the name CFAUTH..."
> 
> Both versions of the exclude config are specific to that cookie name.
> 
> The log you've shown suggests it's the cookie value (for cookie CFAUTH..) which is triggering the rule not the cookie NAME itself. This makes sense if the cookie value contains double quotes as that is basically what rule 981318 checks for.
> 
> There's rarely a need to check the cookie name, so mostly you want to check the value. However if your cookie name included an SQL word (e.g. if your cookie was called abcTRUNCATE123 for example) then you might want to exclude the cookie name from SQL injection rules.
> 
> Thanks,
> Barry
> 
> On 26 Apr 2016, at 20:38, Colin MacAllister <cmacallister at probono.net> wrote:
> 
>> I'm trying to remove the rule when the cookie *name* is that CFAUTH... The cookie value changes with each session. What the have in common are enclosing double quotes, but I only wish to whitelist them when the cookie name is as above.
>> 
>> from my phone
>> 
>> On Apr 26, 2016 3:10 PM, Barry Pollard <barry_pollard at hotmail.com> wrote:
>> You are whitelisting the cookie name and not its value.
>> 
>> Try this:
>> 
>>     SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES:CFAUTHORIZATION_cfadmin"
>> 
>> Thanks,
>> Barry
>> 
>> > On 26 Apr 2016, at 19:47, Colin MacAllister <cmacallister at probono.net> wrote:
>> > 
>> > SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160426/70effb3a/attachment-0001.html>

From cmacallister at probono.net  Tue Apr 26 21:06:44 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Tue, 26 Apr 2016 21:06:44 +0000
Subject: [Owasp-modsecurity-core-rule-set] rules match despite updated
 target list
In-Reply-To: <20160426192539.GA481@elias>
References: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>,
	<20160426192539.GA481@elias>
Message-ID: <CO2PR18MB0012227A32EDE0071B2CA040DE630@CO2PR18MB0012.namprd18.prod.outlook.com>

That did it. I was thinking that the whitelist needed to be loaded first so that the rule would be appropriately skipped, but of course that wouldn?t matter if they were all loaded into memory first.



Thanks, and thanks, Barry for your suggestions.



Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10



From: Christian Folini<mailto:christian.folini at netnea.com>
Sent: Tuesday, April 26, 2016 3:25 PM
To: Colin MacAllister<mailto:cmacallister at probono.net>
Cc: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] rules match despite updated target list



Colin,

Please try and include your whitelist.conf _after_ the owasp_crs.

Ahoj,

Christian

On Tue, Apr 26, 2016 at 06:34:33PM +0000, Colin MacAllister wrote:
> I have a cookie by the name of CFAUTHORIZATION_cfadmin which is triggering a sql injection OWASP base rule. I have in the past successfully circumvented it with
>
>                 SecRuleUpdateTargetById 981318 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
>
> I have this rule in a file called whitelist.conf, and this is being included in my modsecurity_iis.conf file:
>
> Include modsecurity.conf
> Include modsecurity_crs_10_setup.conf
> Include whitelist.conf
> Include owasp_crs\base_rules\*.conf
> #Include pbncustom.conf
>
> Modsecurity_iis.conf is being referred to as the base config file in the IIS directive in the application host file like this:
>
>                 <ModSecurity enabled="true" configFile="C:\Program Files\ModSecurity IIS\modsecurity_iis.conf" />
>
> But when I make a request, each of the http gets in a request triggers the warning about the CFAUTHORIZATION_cfadmin cookie. (The problem is that the value for the cookie has double quotes around it, which is as far as I know not changeable.)
>
>                 [client 127.0.0.1:51619] ModSecurity: Access denied with code 403 (phase 2). Pattern match
>                 "(^[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+$)" at
>                 REQUEST_COOKIES:CFAUTHORIZATION_cfadmin.
>
> Does anyone know what might be going on here? I had some confusion about the SecRuleUpdateTargetByID directive, since some sources made Target plural, and some had it in singular ? even in the same resource.
>
> Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10
>

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


--
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160426/d3155d0d/attachment.html>

From christian.folini at netnea.com  Wed Apr 27 03:17:45 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Wed, 27 Apr 2016 05:17:45 +0200
Subject: [Owasp-modsecurity-core-rule-set] rules match despite updated
 target list
In-Reply-To: <CO2PR18MB0012227A32EDE0071B2CA040DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB00126CE44A105C6CEB6774B2DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160426192539.GA481@elias>
	<CO2PR18MB0012227A32EDE0071B2CA040DE630@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160427031745.GA10972@elias>

On Tue, Apr 26, 2016 at 09:06:44PM +0000, Colin MacAllister wrote:
> That did it. I was thinking that the whitelist needed to be loaded
> first so that the rule would be appropriately skipped, but of course
> that wouldn?t matter if they were all loaded into memory first.

Yes, it's a nuisance. In fact most tuning works better when
done _after_ the CRS are loaded. Not without exceptions, of course. :)

Ahoj,

Christian

> 
> 
> 
> Thanks, and thanks, Barry for your suggestions.
> 
> 
> 
> Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for
> Windows 10
> 
> 
> 
> From: Christian Folini<mailto:christian.folini at netnea.com> Sent:
> Tuesday, April 26, 2016 3:25 PM To: Colin
> MacAllister<mailto:cmacallister at probono.net> Cc: OWASP
> List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org> Subject:
> Re: [Owasp-modsecurity-core-rule-set] rules match despite updated
> target list
> 
> 
> 
> Colin,
> 
> Please try and include your whitelist.conf _after_ the owasp_crs.
> 
> Ahoj,
> 
> Christian
> 
> On Tue, Apr 26, 2016 at 06:34:33PM +0000, Colin MacAllister wrote:
> > I have a cookie by the name of CFAUTHORIZATION_cfadmin which is
> > triggering a sql injection OWASP base rule. I have in the past
> > successfully circumvented it with
> >
> >                 SecRuleUpdateTargetById 981318
> >                 "!REQUEST_COOKIES_NAMES:CFAUTHORIZATION_cfadmin"
> >
> > I have this rule in a file called whitelist.conf, and this is being
> > included in my modsecurity_iis.conf file:
> >
> > Include modsecurity.conf Include modsecurity_crs_10_setup.conf
> > Include whitelist.conf Include owasp_crs\base_rules\*.conf #Include
> > pbncustom.conf
> >
> > Modsecurity_iis.conf is being referred to as the base config file in
> > the IIS directive in the application host file like this:
> >
> >                 <ModSecurity enabled="true" configFile="C:\Program
> >                 Files\ModSecurity IIS\modsecurity_iis.conf" />
> >
> > But when I make a request, each of the http gets in a request
> > triggers the warning about the CFAUTHORIZATION_cfadmin cookie. (The
> > problem is that the value for the cookie has double quotes around
> > it, which is as far as I know not changeable.)
> >
> >                 [client 127.0.0.1:51619] ModSecurity: Access denied
> >                 with code 403 (phase 2). Pattern match
> >                 "(^[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+|[\"'`\xc2\xb4\xe2\x80\x99\xe2\x80\x98;]+$)"
> >                 at REQUEST_COOKIES:CFAUTHORIZATION_cfadmin.
> >
> > Does anyone know what might be going on here? I had some confusion
> > about the SecRuleUpdateTargetByID directive, since some sources made
> > Target plural, and some had it in singular ? even in the same
> > resource.
> >
> > Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for
> > Windows 10
> >
> 
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 
> 
> -- mailto:christian.folini at netnea.com http://www.christian-folini.ch
> twitter: @ChrFolini

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From cmacallister at probono.net  Wed Apr 27 16:43:41 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Wed, 27 Apr 2016 16:43:41 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits
	exceeded (-8)
Message-ID: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>

I?ve found references to this via Google searches, and the accepted answer seems to be to increase the PCRE limits to 150000. This seems unwise, since the limits must be there for a reason. Still, I tried it, but it didn?t help. I?m receiving 19 errors of this type, all either concerning XSS or SQL injection, for one URI. The URI in question is in this form: /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962 (which has been heavily edited so as to not give away the farm.)

Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160427/a1590815/attachment.html>

From cmacallister at probono.net  Wed Apr 27 16:49:22 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Wed, 27 Apr 2016 16:49:22 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits
	exceeded (-8)
In-Reply-To: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>

It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?

Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10

From: Colin MacAllister<mailto:cmacallister at probono.net>
Sent: Wednesday, April 27, 2016 12:43 PM
To: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Execution error - PCRE limits exceeded (-8)

I've found references to this via Google searches, and the accepted answer seems to be to increase the PCRE limits to 150000. This seems unwise, since the limits must be there for a reason. Still, I tried it, but it didn't help. I'm receiving 19 errors of this type, all either concerning XSS or SQL injection, for one URI. The URI in question is in this form: /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962 (which has been heavily edited so as to not give away the farm.)

Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160427/949e6427/attachment.html>

From CSanders at trustwave.com  Wed Apr 27 18:14:19 2016
From: CSanders at trustwave.com (Chaim Sanders)
Date: Wed, 27 Apr 2016 18:14:19 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE
	limits	exceeded (-8)
In-Reply-To: <CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>

That isn't a bad idea - Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?

Chaim Sanders
Security Researcher
Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Colin MacAllister
Sent: Wednesday, April 27, 2016 12:49 PM
To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?

Sent from Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2RvmdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f%3fLinkId%3d550986> for Windows 10

From: Colin MacAllister<mailto:cmacallister at probono.net>
Sent: Wednesday, April 27, 2016 12:43 PM
To: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Execution error - PCRE limits exceeded (-8)

I've found references to this via Google searches, and the accepted answer seems to be to increase the PCRE limits to 150000. This seems unwise, since the limits must be there for a reason. Still, I tried it, but it didn't help. I'm receiving 19 errors of this type, all either concerning XSS or SQL injection, for one URI. The URI in question is in this form: /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962 (which has been heavily edited so as to not give away the farm.)

Sent from Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2RvmdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f%3fLinkId%3d550986> for Windows 10


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160427/4cd32d35/attachment-0001.html>

From cmacallister at probono.net  Wed Apr 27 19:32:08 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Wed, 27 Apr 2016 19:32:08 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE
	limits	exceeded (-8)
In-Reply-To: <DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>,
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
Message-ID: <CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>

>From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?

Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10

From: Chaim Sanders<mailto:CSanders at trustwave.com>
Sent: Wednesday, April 27, 2016 2:14 PM
To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?

Chaim Sanders
Security Researcher
Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com<http://www.trustwave.com/>

From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Colin MacAllister
Sent: Wednesday, April 27, 2016 12:49 PM
To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?

Sent from Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2RvmdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f%3fLinkId%3d550986> for Windows 10

From: Colin MacAllister<mailto:cmacallister at probono.net>
Sent: Wednesday, April 27, 2016 12:43 PM
To: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Execution error - PCRE limits exceeded (-8)

I?ve found references to this via Google searches, and the accepted answer seems to be to increase the PCRE limits to 150000. This seems unwise, since the limits must be there for a reason. Still, I tried it, but it didn?t help. I?m receiving 19 errors of this type, all either concerning XSS or SQL injection, for one URI. The URI in question is in this form: /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962 (which has been heavily edited so as to not give away the farm.)

Sent from Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2RvmdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f%3fLinkId%3d550986> for Windows 10


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160427/3cc32ce9/attachment.html>

From christian.folini at netnea.com  Thu Apr 28 03:46:59 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 28 Apr 2016 05:46:59 +0200
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE
	limits	exceeded (-8)
In-Reply-To: <CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160428034659.GA13489@elias>

Hi Colin,

Yes, that was when the move from sourceforge to github was done. When
I asked Ryan for the old history files, I never got a reply.

Ahoj,

Christian

On Wed, Apr 27, 2016 at 07:32:08PM +0000, Colin MacAllister wrote:
> >From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?
> 
> Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10
> 
> From: Chaim Sanders<mailto:CSanders at trustwave.com>
> Sent: Wednesday, April 27, 2016 2:14 PM
> To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)
> 
> That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?
> 
> Chaim Sanders
> Security Researcher
> Trustwave | SMART SECURITY ON DEMAND
> www.trustwave.com<http://www.trustwave.com/>
> 
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Colin MacAllister
> Sent: Wednesday, April 27, 2016 12:49 PM
> To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)
> 
> It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?
> 
> Sent from Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2RvmdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f%3fLinkId%3d550986> for Windows 10
> 
> From: Colin MacAllister<mailto:cmacallister at probono.net>
> Sent: Wednesday, April 27, 2016 12:43 PM
> To: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Execution error - PCRE limits exceeded (-8)
> 
> I?ve found references to this via Google searches, and the accepted answer seems to be to increase the PCRE limits to 150000. This seems unwise, since the limits must be there for a reason. Still, I tried it, but it didn?t help. I?m receiving 19 errors of this type, all either concerning XSS or SQL injection, for one URI. The URI in question is in this form: /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962 (which has been heavily edited so as to not give away the farm.)
> 
> Sent from Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2RvmdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f%3fLinkId%3d550986> for Windows 10
> 
> 
> ________________________________
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


-- 
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini

From christian.folini at netnea.com  Thu Apr 28 03:50:04 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 28 Apr 2016 05:50:04 +0200
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits
 exceeded (-8)
In-Reply-To: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160428035004.GB13489@elias>

On Wed, Apr 27, 2016 at 04:43:41PM +0000, Colin MacAllister wrote:
> I?ve found references to this via Google searches, and the accepted
> answer seems to be to increase the PCRE limits to 150000. This seems
> unwise, since the limits must be there for a reason. Still, I tried
> it, but it didn?t help. I?m receiving 19 errors of this type, all
> either concerning XSS or SQL injection, for one URI. The URI in
> question is in this form:
> /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962
> (which has been heavily edited so as to not give away the farm.)


There are production services where we had to push the limit to
500K (and it still happens occasionally). I ran some performance tests
last year and I really could not see any significant difference
in the behaviour. So I assumed it is safe to push this really high.

Ahoj,

Christian



-- 
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini

From barry_pollard at hotmail.com  Thu Apr 28 05:53:08 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Thu, 28 Apr 2016 06:53:08 +0100
Subject: [Owasp-modsecurity-core-rule-set] Why are rules 960034,
	960035 and 960038 phase 2?
Message-ID: <DUB116-W103A81393E1749C2F96000C82650@phx.gbl>

Any reasons these rules are phase 2 rules?
960034 checks http protocol version (available in phase 1)960035 checks requested filename (available in phase 1)960038 checks http headers (available in phase 1)
Surely we should check all rules are earliest possible phase as a matter or principal and can't see any reason to delay these until phase 2.
Reason I'm asking is that I have a rule that white lists GET requests for static resources after phase 1 to improve performance and so rules like these will not run when ideally they should do.
Thanks,Barry 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160428/63762e19/attachment-0001.html>

From christian.folini at netnea.com  Thu Apr 28 06:34:07 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 28 Apr 2016 08:34:07 +0200
Subject: [Owasp-modsecurity-core-rule-set] Why are rules 960034,
 960035 and 960038 phase 2?
In-Reply-To: <DUB116-W103A81393E1749C2F96000C82650@phx.gbl>
References: <DUB116-W103A81393E1749C2F96000C82650@phx.gbl>
Message-ID: <20160428063406.GA20119@elias>

Hi Barry,

The distinction between phase:1 and phase:2 was blurred with the moving
of the phase:1 onto the same apache hook a few years back (in order to
make SecRule phase:1 work in Location blocks).

But for people compiling with --enable-request-early and thus having a
real phase:1 before the request body is received, for these people
moving rules into phase:1 when possible makes a lot of sense.

I support your request and suggest you open a github issue. A direct
pull request for the 3.0.0rc1 branch would be equally welcome.

In case: Did you check all the rules for phase:1 candidates or these
just the ones that jumped on you?

Ahoj,

Christian

-- 
Do not pray for an easy life.
Pray for the strength to endure a difficult one.
-- Bruce Lee

From barry_pollard at hotmail.com  Thu Apr 28 07:19:33 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Thu, 28 Apr 2016 08:19:33 +0100
Subject: [Owasp-modsecurity-core-rule-set] Why are rules 960034,
 960035 and 960038 phase 2?
In-Reply-To: <20160428063406.GA20119@elias>
References: <DUB116-W103A81393E1749C2F96000C82650@phx.gbl>,
	<20160428063406.GA20119@elias>
Message-ID: <DUB116-W31B7AA27BDAFBAC952E9D282650@phx.gbl>

Hi Christian,
Thanks for your reply.
While I agree the distinction at an Apache level is now meaningless (without changing compile options), there is still a usefulness at a ModSecurity level for ordering of rules (e.g. I want to whitelist after phase1 for example, primarily to reduce setting up of collections in phase 2 as much as possible as collections struggle with volume).
Will open the request on github and guess I should finally make the effort to stop living in the past and bring myself up to speed on git and pull requests, so I can actually contribute rather than just observing :-)
Not done a full review. These just jumped out at me due to a weird issue I noticed.
To save anyone else repeating my struggles, the latest version of mod_http2 (1.5.1) changes the protocol logged from HTTP/2 to HTTP/2.0 so if you only have HTTP/2 allowed in modsecurity_crs_10_setup.conf then requests that reach phase 2 will start blocking and if, like me, you whitelist "most" requests after phase 1 this might confuse you for a bit as to why only some are blocked!
Thanks,Barry

> Date: Thu, 28 Apr 2016 08:34:07 +0200
> From: christian.folini at netnea.com
> To: barry_pollard at hotmail.com
> CC: owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Why are rules 960034, 960035 and 960038 phase 2?
> 
> Hi Barry,
> 
> The distinction between phase:1 and phase:2 was blurred with the moving
> of the phase:1 onto the same apache hook a few years back (in order to
> make SecRule phase:1 work in Location blocks).
> 
> But for people compiling with --enable-request-early and thus having a
> real phase:1 before the request body is received, for these people
> moving rules into phase:1 when possible makes a lot of sense.
> 
> I support your request and suggest you open a github issue. A direct
> pull request for the 3.0.0rc1 branch would be equally welcome.
> 
> In case: Did you check all the rules for phase:1 candidates or these
> just the ones that jumped on you?
> 
> Ahoj,
> 
> Christian
> 
> -- 
> Do not pray for an easy life.
> Pray for the strength to endure a difficult one.
> -- Bruce Lee
 		 	   		  
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160428/671c99ee/attachment.html>

From christian.folini at netnea.com  Thu Apr 28 07:31:26 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 28 Apr 2016 09:31:26 +0200
Subject: [Owasp-modsecurity-core-rule-set] Why are rules 960034,
 960035 and 960038 phase 2?
In-Reply-To: <DUB116-W31B7AA27BDAFBAC952E9D282650@phx.gbl>
References: <DUB116-W103A81393E1749C2F96000C82650@phx.gbl>
	<20160428063406.GA20119@elias>
	<DUB116-W31B7AA27BDAFBAC952E9D282650@phx.gbl>
Message-ID: <20160428073126.GA2808@elias>

Barry,

On Thu, Apr 28, 2016 at 08:19:33AM +0100, Barry Pollard wrote:
> While I agree the distinction at an Apache level is now meaningless
> (without changing compile options), there is still a usefulness at a
> ModSecurity level for ordering of rules (e.g. I want to whitelist
> after phase1 for example, primarily to reduce setting up of
> collections in phase 2 as much as possible as collections struggle
> with volume).

I agree, it still has it's uses and there is the option for
--enable-request-early, which works nicely.

> Will open the request on github and guess I should
> finally make the effort to stop living in the past and bring myself up
> to speed on git and pull requests, so I can actually contribute rather
> than just observing :-) 

We will welcome you as a contributor with open arms.

> at me due to a weird issue I noticed.  To save anyone else repeating
> my struggles, the latest version of mod_http2 (1.5.1) changes the
> protocol logged from HTTP/2 to HTTP/2.0 so if you only have HTTP/2
> allowed in modsecurity_crs_10_setup.conf then requests that reach
> phase 2 will start blocking and if, like me, you whitelist "most"
> requests after phase 1 this might confuse you for a bit as to why only
> some are blocked!  Thanks,Barry

Thanks for pointing this out.

So the corrext entry would be:

setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1 HTTP/2.0', \

and the robust one:

setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0', \

Is that correct?

Ahoj,

Christian
> 
> > Date: Thu, 28 Apr 2016 08:34:07 +0200 From:
> > christian.folini at netnea.com To: barry_pollard at hotmail.com CC:
> > owasp-modsecurity-core-rule-set at lists.owasp.org Subject: Re:
> > [Owasp-modsecurity-core-rule-set] Why are rules 960034, 960035 and
> > 960038 phase 2?
> > 
> > Hi Barry,
> > 
> > The distinction between phase:1 and phase:2 was blurred with the
> > moving of the phase:1 onto the same apache hook a few years back (in
> > order to make SecRule phase:1 work in Location blocks).
> > 
> > But for people compiling with --enable-request-early and thus having
> > a real phase:1 before the request body is received, for these people
> > moving rules into phase:1 when possible makes a lot of sense.
> > 
> > I support your request and suggest you open a github issue. A direct
> > pull request for the 3.0.0rc1 branch would be equally welcome.
> > 
> > In case: Did you check all the rules for phase:1 candidates or these
> > just the ones that jumped on you?
> > 
> > Ahoj,
> > 
> > Christian
> > 
> > -- Do not pray for an easy life.  Pray for the strength to endure a
> > difficult one.  -- Bruce Lee
>  		 	   		  

From barry_pollard at hotmail.com  Thu Apr 28 07:33:02 2016
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Thu, 28 Apr 2016 08:33:02 +0100
Subject: [Owasp-modsecurity-core-rule-set] Why are rules 960034,
	960035 and 960038 phase 2?
In-Reply-To: <20160428073126.GA2808@elias>
References: <DUB116-W103A81393E1749C2F96000C82650@phx.gbl>
	<20160428063406.GA20119@elias>
	<DUB116-W31B7AA27BDAFBAC952E9D282650@phx.gbl>
	<20160428073126.GA2808@elias>
Message-ID: <DUB406-EAS286D8B37DFBEDFDF041C8CB82650@phx.gbl>

Correct.

Thanks,
Barry

> On 28 Apr 2016, at 08:31, Christian Folini <christian.folini at netnea.com> wrote:
> 
> Barry,
> 
>> On Thu, Apr 28, 2016 at 08:19:33AM +0100, Barry Pollard wrote:
>> While I agree the distinction at an Apache level is now meaningless
>> (without changing compile options), there is still a usefulness at a
>> ModSecurity level for ordering of rules (e.g. I want to whitelist
>> after phase1 for example, primarily to reduce setting up of
>> collections in phase 2 as much as possible as collections struggle
>> with volume).
> 
> I agree, it still has it's uses and there is the option for
> --enable-request-early, which works nicely.
> 
>> Will open the request on github and guess I should
>> finally make the effort to stop living in the past and bring myself up
>> to speed on git and pull requests, so I can actually contribute rather
>> than just observing :-)
> 
> We will welcome you as a contributor with open arms.
> 
>> at me due to a weird issue I noticed.  To save anyone else repeating
>> my struggles, the latest version of mod_http2 (1.5.1) changes the
>> protocol logged from HTTP/2 to HTTP/2.0 so if you only have HTTP/2
>> allowed in modsecurity_crs_10_setup.conf then requests that reach
>> phase 2 will start blocking and if, like me, you whitelist "most"
>> requests after phase 1 this might confuse you for a bit as to why only
>> some are blocked!  Thanks,Barry
> 
> Thanks for pointing this out.
> 
> So the corrext entry would be:
> 
> setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1 HTTP/2.0', \
> 
> and the robust one:
> 
> setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0', \
> 
> Is that correct?
> 
> Ahoj,
> 
> Christian
>> 
>>> Date: Thu, 28 Apr 2016 08:34:07 +0200 From:
>>> christian.folini at netnea.com To: barry_pollard at hotmail.com CC:
>>> owasp-modsecurity-core-rule-set at lists.owasp.org Subject: Re:
>>> [Owasp-modsecurity-core-rule-set] Why are rules 960034, 960035 and
>>> 960038 phase 2?
>>> 
>>> Hi Barry,
>>> 
>>> The distinction between phase:1 and phase:2 was blurred with the
>>> moving of the phase:1 onto the same apache hook a few years back (in
>>> order to make SecRule phase:1 work in Location blocks).
>>> 
>>> But for people compiling with --enable-request-early and thus having
>>> a real phase:1 before the request body is received, for these people
>>> moving rules into phase:1 when possible makes a lot of sense.
>>> 
>>> I support your request and suggest you open a github issue. A direct
>>> pull request for the 3.0.0rc1 branch would be equally welcome.
>>> 
>>> In case: Did you check all the rules for phase:1 candidates or these
>>> just the ones that jumped on you?
>>> 
>>> Ahoj,
>>> 
>>> Christian
>>> 
>>> -- Do not pray for an easy life.  Pray for the strength to endure a
>>> difficult one.  -- Bruce Lee
>>                         

From christian.folini at netnea.com  Thu Apr 28 20:08:09 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 28 Apr 2016 22:08:09 +0200
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits
 exceeded (-8)
In-Reply-To: <CO2PR18MB00124E7D569253D15CBC4A01DE650@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160428035004.GB13489@elias>
	<CO2PR18MB00124E7D569253D15CBC4A01DE650@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160428200809.GA18361@elias>

Don't think I ever saw that error.

Christian

On Thu, Apr 28, 2016 at 08:07:08PM +0000, Colin MacAllister wrote:
> Ah. I read in the ModSecurity Handbook that I needed to add the PCRE limit lines, while they were actually already included farther down in the document all along, and set to 1000. But when I made that higher (according to the PCRE documentation the internal limit is 1 mil), I got another error (not the PCRE limit error) that I cannot find documented: ?GUID_0.00?. Does anyone know what that means? Could it be an out of memory error or something?
> 
> 
> 
> Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10
> 
> 
> 
> From: Christian Folini<mailto:christian.folini at netnea.com>
> Sent: Wednesday, April 27, 2016 11:50 PM
> To: Colin MacAllister<mailto:cmacallister at probono.net>
> Cc: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)
> 
> 
> 
> On Wed, Apr 27, 2016 at 04:43:41PM +0000, Colin MacAllister wrote:
> > I?ve found references to this via Google searches, and the accepted
> > answer seems to be to increase the PCRE limits to 150000. This seems
> > unwise, since the limits must be there for a reason. Still, I tried
> > it, but it didn?t help. I?m receiving 19 errors of this type, all
> > either concerning XSS or SQL injection, for one URI. The URI in
> > question is in this form:
> > /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962
> > (which has been heavily edited so as to not give away the farm.)
> 
> 
> There are production services where we had to push the limit to
> 500K (and it still happens occasionally). I ran some performance tests
> last year and I really could not see any significant difference
> in the behaviour. So I assumed it is safe to push this really high.
> 
> Ahoj,
> 
> Christian
> 
> 
> 
> --
> mailto:christian.folini at netnea.com
> http://www.christian-folini.ch
> twitter: @ChrFolini

From cmacallister at probono.net  Thu Apr 28 20:07:08 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Thu, 28 Apr 2016 20:07:08 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits
 exceeded (-8)
In-Reply-To: <20160428035004.GB13489@elias>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>,
	<20160428035004.GB13489@elias>
Message-ID: <CO2PR18MB00124E7D569253D15CBC4A01DE650@CO2PR18MB0012.namprd18.prod.outlook.com>

Ah. I read in the ModSecurity Handbook that I needed to add the PCRE limit lines, while they were actually already included farther down in the document all along, and set to 1000. But when I made that higher (according to the PCRE documentation the internal limit is 1 mil), I got another error (not the PCRE limit error) that I cannot find documented: ?GUID_0.00?. Does anyone know what that means? Could it be an out of memory error or something?



Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for Windows 10



From: Christian Folini<mailto:christian.folini at netnea.com>
Sent: Wednesday, April 27, 2016 11:50 PM
To: Colin MacAllister<mailto:cmacallister at probono.net>
Cc: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)



On Wed, Apr 27, 2016 at 04:43:41PM +0000, Colin MacAllister wrote:
> I?ve found references to this via Google searches, and the accepted
> answer seems to be to increase the PCRE limits to 150000. This seems
> unwise, since the limits must be there for a reason. Still, I tried
> it, but it didn?t help. I?m receiving 19 errors of this type, all
> either concerning XSS or SQL injection, for one URI. The URI in
> question is in this form:
> /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-78593415F962
> (which has been heavily edited so as to not give away the farm.)


There are production services where we had to push the limit to
500K (and it still happens occasionally). I ran some performance tests
last year and I really could not see any significant difference
in the behaviour. So I assumed it is safe to push this really high.

Ahoj,

Christian



--
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160428/538d9fb5/attachment.html>

From cmacallister at probono.net  Fri Apr 29 16:13:38 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Fri, 29 Apr 2016 16:13:38 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE
	limits	exceeded (-8)
In-Reply-To: <20160428034659.GA13489@elias>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160428034659.GA13489@elias>
Message-ID: <CO2PR18MB0012F4EAED9F1875A6532F31DE660@CO2PR18MB0012.namprd18.prod.outlook.com>

I played around some more with it and was able to get it to the point where it was no longer giving me GUID_0.00 errors. I weeded out all rules on that XML carrying field to avoid the PCRE limit problem (as well as obvious XSS rules). And now everything is working, and I'm able to keep my recursion limits to 1000. In this case it's okay, I believe, because the XML field is only viewable by admins. So the problem wasn't really solved, but I can proceed.

-----Original Message-----
From: Christian Folini [mailto:christian.folini at netnea.com] 
Sent: Wednesday, April 27, 2016 11:47 PM
To: Colin MacAllister <cmacallister at probono.net>
Cc: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

Hi Colin,

Yes, that was when the move from sourceforge to github was done. When I asked Ryan for the old history files, I never got a reply.

Ahoj,

Christian

On Wed, Apr 27, 2016 at 07:32:08PM +0000, Colin MacAllister wrote:
> >From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?
> 
> Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for 
> Windows 10
> 
> From: Chaim Sanders<mailto:CSanders at trustwave.com>
> Sent: Wednesday, April 27, 2016 2:14 PM
> To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP 
> List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> limits exceeded (-8)
> 
> That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?
> 
> Chaim Sanders
> Security Researcher
> Trustwave | SMART SECURITY ON DEMAND
> www.trustwave.com<http://www.trustwave.com/>
> 
> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org 
> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
> Behalf Of Colin MacAllister
> Sent: Wednesday, April 27, 2016 12:49 PM
> To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> limits exceeded (-8)
> 
> It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?
> 
> Sent from 
> Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2Rv
> mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f
> %3fLinkId%3d550986> for Windows 10
> 
> From: Colin MacAllister<mailto:cmacallister at probono.net>
> Sent: Wednesday, April 27, 2016 12:43 PM
> To: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Execution error - PCRE limits exceeded (-8)
> 
> I?ve found references to this via Google searches, and the accepted 
> answer seems to be to increase the PCRE limits to 150000. This seems 
> unwise, since the limits must be there for a reason. Still, I tried 
> it, but it didn?t help. I?m receiving 19 errors of this type, all 
> either concerning XSS or SQL injection, for one URI. The URI in 
> question is in this form: 
> /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-7
> 8593415F962 (which has been heavily edited so as to not give away the 
> farm.)
> 
> Sent from 
> Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2Rv
> mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f
> %3fLinkId%3d550986> for Windows 10
> 
> 
> ________________________________
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list 
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-s
> et


--
mailto:christian.folini at netnea.com
http://www.christian-folini.ch
twitter: @ChrFolini

From christian.folini at netnea.com  Fri Apr 29 18:27:43 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 29 Apr 2016 20:27:43 +0200
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE
	limits	exceeded (-8)
In-Reply-To: <CO2PR18MB0012F4EAED9F1875A6532F31DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160428034659.GA13489@elias>
	<CO2PR18MB0012F4EAED9F1875A6532F31DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160429182743.GA16735@elias>

Colin,

Would you mind sharing your complete ModSec configuration and
ruleset with us? Together with some payloads. This could be very
interesting for testing purposes. And debugging that annoying
limit problem.

Ahoj,

Christian

On Fri, Apr 29, 2016 at 04:13:38PM +0000, Colin MacAllister wrote:
> I played around some more with it and was able to get it to the point where it was no longer giving me GUID_0.00 errors. I weeded out all rules on that XML carrying field to avoid the PCRE limit problem (as well as obvious XSS rules). And now everything is working, and I'm able to keep my recursion limits to 1000. In this case it's okay, I believe, because the XML field is only viewable by admins. So the problem wasn't really solved, but I can proceed.
> 
> -----Original Message-----
> From: Christian Folini [mailto:christian.folini at netnea.com] 
> Sent: Wednesday, April 27, 2016 11:47 PM
> To: Colin MacAllister <cmacallister at probono.net>
> Cc: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)
> 
> Hi Colin,
> 
> Yes, that was when the move from sourceforge to github was done. When I asked Ryan for the old history files, I never got a reply.
> 
> Ahoj,
> 
> Christian
> 
> On Wed, Apr 27, 2016 at 07:32:08PM +0000, Colin MacAllister wrote:
> > >From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?
> > 
> > Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for 
> > Windows 10
> > 
> > From: Chaim Sanders<mailto:CSanders at trustwave.com>
> > Sent: Wednesday, April 27, 2016 2:14 PM
> > To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP 
> > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> > limits exceeded (-8)
> > 
> > That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?
> > 
> > Chaim Sanders
> > Security Researcher
> > Trustwave | SMART SECURITY ON DEMAND
> > www.trustwave.com<http://www.trustwave.com/>
> > 
> > From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org 
> > [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
> > Behalf Of Colin MacAllister
> > Sent: Wednesday, April 27, 2016 12:49 PM
> > To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> > limits exceeded (-8)
> > 
> > It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?
> > 
> > Sent from 
> > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2Rv
> > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f
> > %3fLinkId%3d550986> for Windows 10
> > 
> > From: Colin MacAllister<mailto:cmacallister at probono.net>
> > Sent: Wednesday, April 27, 2016 12:43 PM
> > To: OWASP List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Execution error - PCRE limits exceeded (-8)
> > 
> > I?ve found references to this via Google searches, and the accepted 
> > answer seems to be to increase the PCRE limits to 150000. This seems 
> > unwise, since the limits must be there for a reason. Still, I tried 
> > it, but it didn?t help. I?m receiving 19 errors of this type, all 
> > either concerning XSS or SQL injection, for one URI. The URI in 
> > question is in this form: 
> > /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3-7
> > 8593415F962 (which has been heavily edited so as to not give away the 
> > farm.)
> > 
> > Sent from 
> > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2Rv
> > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%2f
> > %3fLinkId%3d550986> for Windows 10
> > 
> > 
> > ________________________________
> > 
> > This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list 
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-s
> > et
> 
> 
> --
> mailto:christian.folini at netnea.com
> http://www.christian-folini.ch
> twitter: @ChrFolini
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From christian.folini at netnea.com  Fri Apr 29 19:09:21 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 29 Apr 2016 21:09:21 +0200
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits
 exceeded (-8)
In-Reply-To: <CO2PR18MB0012F548CA561836FE58C1D0DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160428034659.GA13489@elias>
	<CO2PR18MB0012F4EAED9F1875A6532F31DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160429182743.GA16735@elias>
	<CO2PR18MB0012F548CA561836FE58C1D0DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <20160429190921.GA18148@elias>

Came through just fine. Thank you very much.

Christian

On Fri, Apr 29, 2016 at 06:53:58PM +0000, Colin MacAllister wrote:
> I cleaned 'em up a little so as not to give away the farm.
> 
> Testing to see if these text conf files come through the listserv as attachments.
> 
> -----Original Message-----
> From: Christian Folini [mailto:christian.folini at netnea.com] 
> Sent: Friday, April 29, 2016 2:28 PM
> To: Colin MacAllister <cmacallister at probono.net>
> Cc: Christian Folini <christian.folini at netnea.com>; OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)
> 
> Colin,
> 
> Would you mind sharing your complete ModSec configuration and ruleset with us? Together with some payloads. This could be very interesting for testing purposes. And debugging that annoying limit problem.
> 
> Ahoj,
> 
> Christian
> 
> On Fri, Apr 29, 2016 at 04:13:38PM +0000, Colin MacAllister wrote:
> > I played around some more with it and was able to get it to the point where it was no longer giving me GUID_0.00 errors. I weeded out all rules on that XML carrying field to avoid the PCRE limit problem (as well as obvious XSS rules). And now everything is working, and I'm able to keep my recursion limits to 1000. In this case it's okay, I believe, because the XML field is only viewable by admins. So the problem wasn't really solved, but I can proceed.
> > 
> > -----Original Message-----
> > From: Christian Folini [mailto:christian.folini at netnea.com]
> > Sent: Wednesday, April 27, 2016 11:47 PM
> > To: Colin MacAllister <cmacallister at probono.net>
> > Cc: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> > limits exceeded (-8)
> > 
> > Hi Colin,
> > 
> > Yes, that was when the move from sourceforge to github was done. When I asked Ryan for the old history files, I never got a reply.
> > 
> > Ahoj,
> > 
> > Christian
> > 
> > On Wed, Apr 27, 2016 at 07:32:08PM +0000, Colin MacAllister wrote:
> > > >From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?
> > > 
> > > Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for 
> > > Windows 10
> > > 
> > > From: Chaim Sanders<mailto:CSanders at trustwave.com>
> > > Sent: Wednesday, April 27, 2016 2:14 PM
> > > To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP 
> > > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > > Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - 
> > > PCRE limits exceeded (-8)
> > > 
> > > That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?
> > > 
> > > Chaim Sanders
> > > Security Researcher
> > > Trustwave | SMART SECURITY ON DEMAND 
> > > www.trustwave.com<http://www.trustwave.com/>
> > > 
> > > From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> > > [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
> > > Behalf Of Colin MacAllister
> > > Sent: Wednesday, April 27, 2016 12:49 PM
> > > To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> > > Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - 
> > > PCRE limits exceeded (-8)
> > > 
> > > It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?
> > > 
> > > Sent from
> > > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2
> > > Rv 
> > > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%
> > > 2f
> > > %3fLinkId%3d550986> for Windows 10
> > > 
> > > From: Colin MacAllister<mailto:cmacallister at probono.net>
> > > Sent: Wednesday, April 27, 2016 12:43 PM
> > > To: OWASP 
> > > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > > Subject: Execution error - PCRE limits exceeded (-8)
> > > 
> > > I?ve found references to this via Google searches, and the accepted 
> > > answer seems to be to increase the PCRE limits to 150000. This seems 
> > > unwise, since the limits must be there for a reason. Still, I tried 
> > > it, but it didn?t help. I?m receiving 19 errors of this type, all 
> > > either concerning XSS or SQL injection, for one URI. The URI in 
> > > question is in this form:
> > > /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3
> > > -7
> > > 8593415F962 (which has been heavily edited so as to not give away 
> > > the
> > > farm.)
> > > 
> > > Sent from
> > > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2
> > > Rv 
> > > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%
> > > 2f
> > > %3fLinkId%3d550986> for Windows 10
> > > 
> > > 
> > > ________________________________
> > > 
> > > This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> > 
> > > _______________________________________________
> > > Owasp-modsecurity-core-rule-set mailing list 
> > > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule
> > > -s
> > > et
> > 
> > 
> > --
> > mailto:christian.folini at netnea.com
> > http://www.christian-folini.ch
> > twitter: @ChrFolini
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list 
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set






From cmacallister at probono.net  Fri Apr 29 18:53:58 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Fri, 29 Apr 2016 18:53:58 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error - PCRE
	limits	exceeded (-8)
In-Reply-To: <20160429182743.GA16735@elias>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160428034659.GA13489@elias>
	<CO2PR18MB0012F4EAED9F1875A6532F31DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160429182743.GA16735@elias>
Message-ID: <CO2PR18MB0012F548CA561836FE58C1D0DE660@CO2PR18MB0012.namprd18.prod.outlook.com>

I cleaned 'em up a little so as not to give away the farm.

Testing to see if these text conf files come through the listserv as attachments.

-----Original Message-----
From: Christian Folini [mailto:christian.folini at netnea.com] 
Sent: Friday, April 29, 2016 2:28 PM
To: Colin MacAllister <cmacallister at probono.net>
Cc: Christian Folini <christian.folini at netnea.com>; OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

Colin,

Would you mind sharing your complete ModSec configuration and ruleset with us? Together with some payloads. This could be very interesting for testing purposes. And debugging that annoying limit problem.

Ahoj,

Christian

On Fri, Apr 29, 2016 at 04:13:38PM +0000, Colin MacAllister wrote:
> I played around some more with it and was able to get it to the point where it was no longer giving me GUID_0.00 errors. I weeded out all rules on that XML carrying field to avoid the PCRE limit problem (as well as obvious XSS rules). And now everything is working, and I'm able to keep my recursion limits to 1000. In this case it's okay, I believe, because the XML field is only viewable by admins. So the problem wasn't really solved, but I can proceed.
> 
> -----Original Message-----
> From: Christian Folini [mailto:christian.folini at netnea.com]
> Sent: Wednesday, April 27, 2016 11:47 PM
> To: Colin MacAllister <cmacallister at probono.net>
> Cc: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> limits exceeded (-8)
> 
> Hi Colin,
> 
> Yes, that was when the move from sourceforge to github was done. When I asked Ryan for the old history files, I never got a reply.
> 
> Ahoj,
> 
> Christian
> 
> On Wed, Apr 27, 2016 at 07:32:08PM +0000, Colin MacAllister wrote:
> > >From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?
> > 
> > Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for 
> > Windows 10
> > 
> > From: Chaim Sanders<mailto:CSanders at trustwave.com>
> > Sent: Wednesday, April 27, 2016 2:14 PM
> > To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP 
> > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - 
> > PCRE limits exceeded (-8)
> > 
> > That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?
> > 
> > Chaim Sanders
> > Security Researcher
> > Trustwave | SMART SECURITY ON DEMAND 
> > www.trustwave.com<http://www.trustwave.com/>
> > 
> > From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> > [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
> > Behalf Of Colin MacAllister
> > Sent: Wednesday, April 27, 2016 12:49 PM
> > To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - 
> > PCRE limits exceeded (-8)
> > 
> > It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?
> > 
> > Sent from
> > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2
> > Rv 
> > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%
> > 2f
> > %3fLinkId%3d550986> for Windows 10
> > 
> > From: Colin MacAllister<mailto:cmacallister at probono.net>
> > Sent: Wednesday, April 27, 2016 12:43 PM
> > To: OWASP 
> > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Execution error - PCRE limits exceeded (-8)
> > 
> > I?ve found references to this via Google searches, and the accepted 
> > answer seems to be to increase the PCRE limits to 150000. This seems 
> > unwise, since the limits must be there for a reason. Still, I tried 
> > it, but it didn?t help. I?m receiving 19 errors of this type, all 
> > either concerning XSS or SQL injection, for one URI. The URI in 
> > question is in this form:
> > /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3
> > -7
> > 8593415F962 (which has been heavily edited so as to not give away 
> > the
> > farm.)
> > 
> > Sent from
> > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2
> > Rv 
> > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%
> > 2f
> > %3fLinkId%3d550986> for Windows 10
> > 
> > 
> > ________________________________
> > 
> > This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list 
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule
> > -s
> > et
> 
> 
> --
> mailto:christian.folini at netnea.com
> http://www.christian-folini.ch
> twitter: @ChrFolini
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list 
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
A non-text attachment was scrubbed...
Name: whitelist.conf
Type: application/octet-stream
Size: 2380 bytes
Desc: whitelist.conf
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160429/3d98d28f/attachment-0004.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: whitelist_pre.conf
Type: application/octet-stream
Size: 643 bytes
Desc: whitelist_pre.conf
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160429/3d98d28f/attachment-0005.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: modsecurity_iis.conf
Type: application/octet-stream
Size: 179 bytes
Desc: modsecurity_iis.conf
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160429/3d98d28f/attachment-0006.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: modsecurity.conf
Type: application/octet-stream
Size: 8772 bytes
Desc: modsecurity.conf
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160429/3d98d28f/attachment-0007.obj>

From cmacallister at probono.net  Fri Apr 29 19:35:28 2016
From: cmacallister at probono.net (Colin MacAllister)
Date: Fri, 29 Apr 2016 19:35:28 +0000
Subject: [Owasp-modsecurity-core-rule-set] Execution error -
	PCRE	limits	exceeded (-8)
In-Reply-To: <CO2PR18MB0012F548CA561836FE58C1D0DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
References: <CO2PR18MB001213775EFEBE6F658F331BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<CO2PR18MB00122EFFC64EFD6F20560B37DE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<DM2PR0701MB12953B97CBE42569CA93536FDB640@DM2PR0701MB1295.namprd07.prod.outlook.com>
	<CO2PR18MB0012584FB6BAB978D8B0762BDE640@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160428034659.GA13489@elias>
	<CO2PR18MB0012F4EAED9F1875A6532F31DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
	<20160429182743.GA16735@elias>
	<CO2PR18MB0012F548CA561836FE58C1D0DE660@CO2PR18MB0012.namprd18.prod.outlook.com>
Message-ID: <CO2PR18MB00129FF1504D31C1D201701EDE660@CO2PR18MB0012.namprd18.prod.outlook.com>

Here's a payload, from my audit log.

--c3380000-A--
[29/Apr/2016:13:36:28 --0400] 17942340921886507828 127.0.0.1:58845 80 127.0.0.1 80
--c3380000-B--
POST /admin/framework.com.page/form.7A98CCAE-B555-C988-EC86-48ACD3660229 HTTP/1.1
Connection: keep-alive
Content-Length: 25974
Content-Type: multipart/form-data; boundary=---------------------------27360156319619
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.5
Authorization: Basic Y21hY2FsbGlzdGVyQHByb2Jvbm8ubmV0OmhpY29kcm9zbHU=
Cookie: __utma=220594061.1909069084.1460669097.1461592725.1461852817.5; __utmz=220594061.1460669097.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); JSESSIONID=22E2CB8BB392D3639F56B7E9D6B7661D; EDITORAREAID=31; __utmc=220594061; Host: host.net
Referer: http://host.net/admin/framework.com.page/form.7A98CCAE-B555-C988-EC86-48ACD3660229
User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:45.0) Gecko/20100101 Firefox/45.0

--c3380000-I--
designid=7A6F08BA%2dF62B%2d8430%2d57E0%2d0594D18B61FA&layout=default%2dlayout&localeid=en&title=Administrative+Relief&name=Administrative+Relief+Resource+Center&longareatitle=&tagline=&Host=dev%2eprobono%2enet&Template=adminrelief&grouping=&grouping=hidden&primarystateid=33&HomepageNavBarLabel=Home&myxmlfield=%3ctopicmap%3e%0d%0a%09%3ctopic+pcid%3d%221513%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eAbused+Spouses+and+Children%2fVAWA%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%224025%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eAdministrative+Relief%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%223757%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eAdvocacy%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223760%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eAppeals%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%222906%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eAttorneys+fees+and+EAJA%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221492%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eBorder+Searches%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222907%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eCitizenship%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222916%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAcquisition+at+Birth%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222917%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDerivative%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222918%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFalse+Claim%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222919%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eNationality%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222920%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Citizenship%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222180%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eConvention+Against+Torture+%28CAT%29%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221493%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eDeferred+Action%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221494%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eDeportation%2fRemoval%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%221495%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConsequence+of+Criminal+Conviction%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%221496%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eHIV+Waiver+of+Inadmissibility%2fDeportation%2fRemoval%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%221497%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eWaiver+of+Inadmissibility%2fDeportation%2fRemoval%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%221498%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Deportation%2fRemoval%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221499%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eDetention%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222169%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eBond+Hearings%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222170%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eParole+Requests%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222921%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Detention%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222909%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eEmployment%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222926%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDiscrimination%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222927%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Employment%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%223758%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eEnforcement%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%222910%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eFamily%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222928%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAccompanying%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222929%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAdjustment+of+Status%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222930%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAffidavits+of+Support%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222931%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAppeal%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222932%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eChild+Defined%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222933%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eChild+Status+Protection+Act%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222934%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConditional+Residency%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222935%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConsular+Review%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222936%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDerivative+Status%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222937%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDeath+of+Spouse%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222938%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDivorce%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222939%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEntry%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222940%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEWI%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222941%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFirst+Preference%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222942%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFollowing+to+Join%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222943%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eImmediate+Relatives%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222944%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eMarriage+Fraud%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222945%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eNon%2dimmigrant+Visa%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222946%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePriority+Dates%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222947%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eRevocation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222948%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSecond+Preference%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222949%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSiblings%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222950%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eValidity+of+Marriage%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222951%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eWidow%28er%29%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222952%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Family%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223682%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eForms%2fFees%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%223683%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eGood+Moral+Character%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a++++%3ctopic+pcid%3d%222924%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eIdentification+Issues%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222684%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDriver%27s+Licenses%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222922%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eLegislation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222923%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eREAL+ID%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222925%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Driver%27s+Licenses%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%222679%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eImmigration+and+Crimes%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222817%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAggravated+Felonies%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222818%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCategorical+Analysis%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222819%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConviction%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222837%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCrime+of+Violence%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222820%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCrimes+Involving+Moral+Turpitude%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222821%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDefense+Strategies%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222822%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDeportability%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222823%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDetention+and+Bond%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222824%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDivisible+Statutes%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222825%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDomestic+Violence%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222826%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDrug+Offenses%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222953%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDUI%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222827%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFirearms%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223005%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFirst+Offender+Statutes%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223006%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eForeign+Convictions%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222828%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eImmigration+Status%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222829%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eInadmissibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222954%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eJuvenile+Crimes%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222955%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eMurder%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222830%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eNonsubstantive+Offenses%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222956%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePolitical+Offense%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222831%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePractitioner+Resources%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222832%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eProperty+Offenses%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222833%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eRecord+of+Conviction%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222834%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSentencing%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222835%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSex+Offenses%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222957%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSmuggling%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222836%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eState+Specific+Charts%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222958%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eTrafficking+in+Persons%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222959%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Immigration+and+Crimes%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%223781%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eImmigrant+Children%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%223686%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eImmigration+Court%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%223447%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eImmigration+Fraud%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%223685%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eImmigration+Legislation%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223117%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eImmigration+Policy%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%223118%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAssimilation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223119%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eBorder+Issues%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223120%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCrime%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223121%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEconomics%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223122%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEducation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223123%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEmployment%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223124%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eGender%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223125%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eGlobalization%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223126%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eHealth%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223127%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eImmigration+Reform%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223128%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eLegal%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223129%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eNational+Security%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223130%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eRace%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223131%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%09%09%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222911%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eIneffective+Assistance+of+Counsel%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223684%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eInspection%2fAdmission+Issues%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%222912%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eJudicial+Review%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%3ctopic+pcid%3d%223759%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eLawful+Permanent+Residency%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223756%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eLegal+Motions%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%221503%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eLegalization%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223782%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eLGBT+Issues%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221505%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eNaturalization%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222960%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAdopted+Children%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222961%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAggravated+Felony+Bar%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222962%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConditional+Residents%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222963%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCriminal+Issues%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222964%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCriteria%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222965%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDisabled+Persons%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222966%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eDual+Citizenship%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222967%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEnglish+Requirement%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222968%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eGood+Moral+Character%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222969%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eLoss+of+Citizenship%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222970%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eMilitary+Service%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222971%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOath+of+Allegiance%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222972%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOrphans%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222973%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePhysical+Presence%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222974%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eVeterans%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222975%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eVoting%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222976%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Naturalization%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221506%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3ePolitical+asylum%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222147%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eAsylum+Procedure%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222977%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCredibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222978%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eGender%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222153%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSocial+Group%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222159%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eRace%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222160%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eReligion%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222161%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eNationality%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222162%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePolitical+Opinion%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222163%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOne%2dYear+Filing+Deadline%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222164%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConfidentiality%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222167%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eChildren%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222168%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePsychological+Issues%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222979%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Political+Asylum%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222182%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3ePost+9%2f11+Issues%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222176%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3ePost%2dAsylum+Issues%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222177%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eLawful+Permanent+Residence%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222178%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eTravel%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222179%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePublic+Benefits+%2f+Welfare%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221880%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eProgram+Assistance%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a++++%3ctopic+pcid%3d%223703%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eProsecutions%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%222913%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eProsecutorial+Discretion%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222997%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3ePublic+Benefits+%2f+Welfare%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222998%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFederal+Housing+Eligibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222999%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFood+Stamp+Eligibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223000%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eMedicaid+Eligibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223001%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSSI+Eligibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223002%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eTANF+Eligibility%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%223003%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Public+Benefits+%2f+Welfare%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222914%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eRaids%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222980%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eI%2d213%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222981%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eConstitutional+Right%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222982%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEvidence%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222983%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eExclusionary+Rule%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222984%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eInterrogation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222985%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eMotions+to+Suppress%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222986%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eSeizure%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222987%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Raids%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%221507%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eRefugees%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223513%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eReligious+Immigration%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223687%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eRescission%2fTermination+of+Status%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223514%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eSpecial+Immigrant+Juvenile+Status%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%3ctopic+pcid%3d%223238%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eState+and+Local+Enforcement%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%221510%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eStatus%2fClassification%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223446%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eT+Visas%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%221511%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eTemporary+Foreign+Worker+Programs%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222181%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eTemporary+Protected+Status+%28TPS%29%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222171%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eTranslation+%26amp%3b+Interpretation%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222174%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eInterpretation+at+the+Asylum+Interview%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222175%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eInterpretation+in+Immigration+Court%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222173%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eTranslation+of+Documents%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222172%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eWorking+with+Interpreters%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223688%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eTravel%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%223761%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eTRIG%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%223445%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eU+Visas%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%221512%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eUndocumented+Workers%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%221514%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eVISA+processing%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%221515%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEmployment+Petitions%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%221516%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eFamily+Petitions%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%221517%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+VISA+Processing%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%223689%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eVoluntary+Departure%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%0d%0a%09%3ctopic+pcid%3d%222915%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eWaivers%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%09%3ctopic+pcid%3d%222988%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3e212%28c%29%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222989%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3e212%28h%29%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222990%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eCancellation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222991%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eEmployment+Authorization%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222992%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eHardship%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222993%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eHealth+Waivers%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222994%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eMaterial+Misrepresentation%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222995%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3ePublic+Charge%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%09%3ctopic+pcid%3d%222996%22%3e%0d%0a%09%09%09%3clabels%3e%0d%0a%09%09%09%09%3clabel+lid%3d%221%22%3eOther+Waivers%3c%2flabel%3e%0d%0a%09%09%09%3c%2flabels%3e%0d%0a%09%09%3c%2ftopic%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%0d%0a%09%3ctopic+pcid%3d%222183%22%3e%0d%0a%09%09%3clabels%3e%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eWithholding+of+Removal%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%09%3ctopic+pcid%3d%221519%22%3e%0d%0a%09%09%3clabels%3e+%0d%0a%09%09%09%3clabel+lid%3d%221%22%3eOther+Immigration%3c%2flabel%3e%0d%0a%09%09%3c%2flabels%3e%0d%0a%09%3c%2ftopic%3e%0d%0a%3c%2ftopicmap%3e%0d%0a&locationname=&linktext=&linkurl=&Priority=0&autogeneratereports=1&defaultlocationview=city&browsertitle=&LogoImage=%2fstyles%2fimages%2fadministrative%2drelief%2flogo%2epng&LogoBGImage=&logobgcolor=%23fff&PhotoBarImage=%2fimages%2fimage%2dstrip%2dbkgd%2ejpg&metakeywords=&metacopyright=&metadescription=&includeinsharedsearch=1&control=Save
--c3380000-F--
HTTP/1.1 500 Internal Server Error

--c3380000-H--
Message: Rule 9fd9c4de08 [id "950001"][file "D:\/Program Files/ModSecurity IIS/owasp_crs/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "125"] - Execution error - PCRE limits exceeded (-8): (null).
Message: Rule 9fd9c94ef8 [id "959073"][file "D:\/Program Files/ModSecurity IIS/owasp_crs/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"][line "143"] - Execution error - PCRE limits exceeded (-8): (null).
Apache-Handler: IIS
Stopwatch: 1461951380399730 7923614 (- - -)
Stopwatch2: 1461951380399730 7923614; combined=483830, p1=0, p2=483830, p3=0, p4=0, p5=0, sr=0, sw=0, l=0, gc=0
Producer: ModSecurity for IIS (STABLE)/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/2.2.9.
Server: ModSecurity Standalone
Engine-Mode: "DETECTION_ONLY"

--c3380000-J--
23,0,"","<Unknown ContentType>"
25,0,"","<Unknown ContentType>"
28,0,"","<Unknown ContentType>"
Total,0

--c3380000-Z--


-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Colin MacAllister
Sent: Friday, April 29, 2016 2:54 PM
To: Christian Folini <christian.folini at netnea.com>
Cc: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

I cleaned 'em up a little so as not to give away the farm.

Testing to see if these text conf files come through the listserv as attachments.

-----Original Message-----
From: Christian Folini [mailto:christian.folini at netnea.com]
Sent: Friday, April 29, 2016 2:28 PM
To: Colin MacAllister <cmacallister at probono.net>
Cc: Christian Folini <christian.folini at netnea.com>; OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE limits exceeded (-8)

Colin,

Would you mind sharing your complete ModSec configuration and ruleset with us? Together with some payloads. This could be very interesting for testing purposes. And debugging that annoying limit problem.

Ahoj,

Christian

On Fri, Apr 29, 2016 at 04:13:38PM +0000, Colin MacAllister wrote:
> I played around some more with it and was able to get it to the point where it was no longer giving me GUID_0.00 errors. I weeded out all rules on that XML carrying field to avoid the PCRE limit problem (as well as obvious XSS rules). And now everything is working, and I'm able to keep my recursion limits to 1000. In this case it's okay, I believe, because the XML field is only viewable by admins. So the problem wasn't really solved, but I can proceed.
> 
> -----Original Message-----
> From: Christian Folini [mailto:christian.folini at netnea.com]
> Sent: Wednesday, April 27, 2016 11:47 PM
> To: Colin MacAllister <cmacallister at probono.net>
> Cc: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - PCRE 
> limits exceeded (-8)
> 
> Hi Colin,
> 
> Yes, that was when the move from sourceforge to github was done. When I asked Ryan for the old history files, I never got a reply.
> 
> Ahoj,
> 
> Christian
> 
> On Wed, Apr 27, 2016 at 07:32:08PM +0000, Colin MacAllister wrote:
> > >From the Changelog it looks like this kind of work was done for version 2.2.4. However, I don?t see that tag in Git ? did this use to be in SourceForge or someplace?
> > 
> > Sent from Mail<https://go.microsoft.com/fwlink/?LinkId=550986> for 
> > Windows 10
> > 
> > From: Chaim Sanders<mailto:CSanders at trustwave.com>
> > Sent: Wednesday, April 27, 2016 2:14 PM
> > To: Colin MacAllister<mailto:cmacallister at probono.net>; OWASP 
> > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: RE: [Owasp-modsecurity-core-rule-set] Execution error - 
> > PCRE limits exceeded (-8)
> > 
> > That isn?t a bad idea ? Do you have a link to the old ticket/work? Additionally, we should very much consider this maybe for 3.1?
> > 
> > Chaim Sanders
> > Security Researcher
> > Trustwave | SMART SECURITY ON DEMAND 
> > www.trustwave.com<http://www.trustwave.com/>
> > 
> > From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
> > [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On 
> > Behalf Of Colin MacAllister
> > Sent: Wednesday, April 27, 2016 12:49 PM
> > To: OWASP List <owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Re: [Owasp-modsecurity-core-rule-set] Execution error - 
> > PCRE limits exceeded (-8)
> > 
> > It looks like at one point in the past the regular expressions in the ruleset were edited to reduce their greed, which resulted in fewer recursive passes over the input. Might something like this be needed here, given recently added rules?
> > 
> > Sent from
> > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2
> > Rv
> > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%
> > 2f
> > %3fLinkId%3d550986> for Windows 10
> > 
> > From: Colin MacAllister<mailto:cmacallister at probono.net>
> > Sent: Wednesday, April 27, 2016 12:43 PM
> > To: OWASP
> > List<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
> > Subject: Execution error - PCRE limits exceeded (-8)
> > 
> > I?ve found references to this via Google searches, and the accepted 
> > answer seems to be to increase the PCRE limits to 150000. This seems 
> > unwise, since the limits must be there for a reason. Still, I tried 
> > it, but it didn?t help. I?m receiving 19 errors of this type, all 
> > either concerning XSS or SQL injection, for one URI. The URI in 
> > question is in this form:
> > /base.cfm?404;/admin/framework.com.page/area.27D92FDF-4048-6285-EDC3
> > -7
> > 8593415F962 (which has been heavily edited so as to not give away 
> > the
> > farm.)
> > 
> > Sent from
> > Mail<http://scanmail.trustwave.com/?c=4062&d=k_qg14s7bHUZdVlLt3BdEb2
> > Rv
> > mdZQNJ64vk1i3wVAA&s=5&u=https%3a%2f%2fgo%2emicrosoft%2ecom%2ffwlink%
> > 2f
> > %3fLinkId%3d550986> for Windows 10
> > 
> > 
> > ________________________________
> > 
> > This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list 
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule
> > -s
> > et
> 
> 
> --
> mailto:christian.folini at netnea.com
> http://www.christian-folini.ch
> twitter: @ChrFolini
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list 
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-s
> et

