<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] ip collection does not exist
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20ip%20collection%20does%20not%20exist&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000613.html">
   <LINK REL="Next"  HREF="000615.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] ip collection does not exist</H1>
    <B>Yonah Russ</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20ip%20collection%20does%20not%20exist&In-Reply-To="
       TITLE="[Owasp-modsecurity-core-rule-set] ip collection does not exist">owasp at yonahruss.com
       </A><BR>
    <I>Wed Jan 26 03:27:12 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000613.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] mod_security - how to use for master thesis?
</A></li>
        <LI>Next message: <A HREF="000615.html">[Owasp-modsecurity-core-rule-set] Modsecurity crs 2.1.1	41_advanced_filters &amp; Lua issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#614">[ date ]</a>
              <a href="thread.html#614">[ thread ]</a>
              <a href="subject.html#614">[ subject ]</a>
              <a href="author.html#614">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm running Mod_Security 2.5.13 with CRS 2.1.1
I have copied the following rules into the base_rules directory:
modsecurity_crs_11_dos_protection.conf
modsecurity_crs_11_slow_dos_protection.conf

I've uncommented the following section in  modsecurity_crs_10_config.conf
SecAction &quot;phase:1,t:none,nolog,pass, \
setvar:'tx.dos_burst_time_slice=60', \
setvar:'tx.dos_counter_threshold=100', \
setvar:'tx.dos_block_timeout=600'&quot;

In the debug log I get the error: Could not set variable &quot;ip.dos_counter&quot; as
the collection does not exist.

Here is the level 9 debug up to that point (some details obfuscated)

[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Initialising transaction (txid TT-YxKwVByQAAC6ZJSEAAAAC).
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Transaction context created (dcfg de7f0).
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Processing disabled, skipping (hook request_early).
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
PdfProtect: Not enabled here.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Processing disabled, skipping (hook request_late).
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Hook insert_filter: Adding PDF XSS protection output filter (r 1630cf0).
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Hook insert_filter: Processing disabled, skipping.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Initialising logging.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Starting phase LOGGING.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9</A>&gt;]
This phase consists of 40 rule(s).
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Recipe: Invoking rule 256478; [file
&quot;/var/www/conf/modsecurity_crs/base_rules/modsecurity_crs_11_dos_protection.conf&quot;]
[line &quot;24&quot;].
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][5&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B5">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B5</A>&gt;]
Rule 256478: SecRule &quot;IP:DOS_BLOCK&quot; &quot;@eq 1&quot;
&quot;phase:5,noauditlog,t:none,nolog,skipAfter:END_DOS_PROTECTION_CHECKS&quot;
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Rule returned 0.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9</A>&gt;]
No match, not chained -&gt; mode NEXT_RULE.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Recipe: Invoking rule 256c28; [file
&quot;/var/www/conf/modsecurity_crs/base_rules/modsecurity_crs_11_dos_protection.conf&quot;]
[line &quot;30&quot;].
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][5&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B5">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B5</A>&gt;]
Rule 256c28: SecRule &quot;REQUEST_BASENAME&quot; &quot;!@rx
\\.(jpe?g|png|gif|js|css|ico)$&quot;
&quot;phase:5,noauditlog,t:none,nolog,pass,setvar:ip.dos_counter=+1&quot;
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Transformation completed in 7 usec.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Executing operator &quot;!rx&quot; with param &quot;\\.(jpe?g|png|gif|js|css|ico)$&quot; against
REQUEST_BASENAME.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9</A>&gt;]
Target value: &quot;index.php&quot;
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][6&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B6">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B6</A>&gt;]
Ignoring regex captures since &quot;capture&quot; action is not enabled.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4</A>&gt;]
Operator completed in 189 usec.
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9</A>&gt;]
Setting variable: ip.dos_counter=+1
[26/Jan/2011:08:18:13 +0000] [
192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][3&lt;<A HREF="http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B3">http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B3</A>&gt;]
Could not set variable &quot;ip.dos_counter&quot; as the collection does not exist.

Any ideas?
Thanks,
Yonah
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110126/9f8601e9/attachment-0001.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20110126/9f8601e9/attachment-0001.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000613.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] mod_security - how to use for master thesis?
</A></li>
	<LI>Next message: <A HREF="000615.html">[Owasp-modsecurity-core-rule-set] Modsecurity crs 2.1.1	41_advanced_filters &amp; Lua issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#614">[ date ]</a>
              <a href="thread.html#614">[ thread ]</a>
              <a href="subject.html#614">[ subject ]</a>
              <a href="author.html#614">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
