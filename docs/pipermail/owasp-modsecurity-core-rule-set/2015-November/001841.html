<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rules%20981172%20and%20981173%20in%0A%203.0.0&In-Reply-To=%3CDM2PR07MB416AD2197BCC27AA8DFF3C2DB1B0%40DM2PR07MB416.namprd07.prod.outlook.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001840.html">
   <LINK REL="Next"  HREF="001842.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rules%20981172%20and%20981173%20in%0A%203.0.0&In-Reply-To=%3CDM2PR07MB416AD2197BCC27AA8DFF3C2DB1B0%40DM2PR07MB416.namprd07.prod.outlook.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0">CSanders at trustwave.com
       </A><BR>
    <I>Thu Nov 19 19:50:33 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001840.html">[Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0
</A></li>
        <LI>Next message: <A HREF="001842.html">[Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1841">[ date ]</a>
              <a href="thread.html#1841">[ thread ]</a>
              <a href="subject.html#1841">[ subject ]</a>
              <a href="author.html#1841">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey Christian,
You hit the nail RIGHT on the head when you described why I allowed that previous pull to go through, it was because we don't see them in the 3.x ruleset so it seemed a minor fix to appease the given issue. Your fix is certainly more elegant.
I am more than willing to accept a pull request for these in 3.x however I would say that we would probably surround them with option var checks that would by default be disabled such as (EnableStricterSQLChecks). If we do this we get the best of both worlds in terms of security minded folks like yourself who don't mind customizing rules and people just running the rules. We see this approach taken elsewhere in CRS (see the database specific rules) and it puts more emphasis on configuration, which I think is nice for newer folks. What do you think about that?

I will say that when we push these rules historically to new clients (who aren't willing to change their code) these rules VERY VERY frequently required changing and this is why we chose to remove them from 3.x thinking that @detectXSS would pick up some of the slack.

I do appreciate that you kept track of this :)

-----Original Message-----
From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf Of Christian Folini
Sent: Thursday, November 19, 2015 5:13 AM
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: [Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0

Hi there,

The rule 981173 was recently updated in the 2.9 core rule branch to reduce the uuid induced false positives for the rule.

Uuids are indeed a major source of false positives on this rule, also in installations I know.

The said update pulled in a request which raised the limit of acceptable number of special characters from 3 to 4. This is the rule as it stands now with &quot;{5,}&quot; meaning an alert is triggered when
5 special chars are detected.

<A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=habN1ipw_me0uz_Jn7rWtjU8vrdSXYQXySS7s9Jh8Q&amp;s=5&amp;u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fowasp-modsecurity-crs%2fpull%2f263">http://scanmail.trustwave.com/?c=4062&amp;d=habN1ipw_me0uz_Jn7rWtjU8vrdSXYQXySS7s9Jh8Q&amp;s=5&amp;u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fowasp-modsecurity-crs%2fpull%2f263</A>

SecRule ARGS_NAMES|ARGS|XML:/* &quot;([\~\!\@\#\$\%\^\&amp;\*\(\)\-\+\=\{\}\[\]\|\:\;\&quot;\'\&#180;\&#8217;\&#8216;\`\&lt;\&gt;].*?){5,}&quot; &quot;phase:2,t:none,t:urlDecodeUni,block,id:'981173',rev:'2',ver:'OWASP_CRS/2.2.9',maturity:'9',accuracy:'8',msg:'Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded',capture,logdata:'Matched Data: %{TX.1} found within %{MATCHED_VAR_NAME}: %{MATCHED_VAR}',tag:'OWASP_CRS/WEB_ATTACK/SQL_INJECTION',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.sql_injection_score=+1,setvar:'tx.msg=%{rule.msg}',setvar:tx.%{rule.id}-OWASP_CRS/WEB_ATTACK/RESTRICTED_SQLI_CHARS-%{matched_var_name}=%{tx.0}&quot;

I think coping with the uuid problem is a good idea. But raising the limit seems a poor handling of the false positives, when a whitelisting of the uuid pattern like

[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}
or simpler
^[0-9a-f-]{36}$

would have been enough.

It's true, that 981173 and it's ally 981172 are gone with the upcoming
3.0.0 release. So maybe this little update is not very significant.
But I think it is.

And I think 981173 and 981172 should stay. Not only because of SQLi, But because they are the guardsmen doing a lot of dirty work for many installations beyond SQLi. In many, many occasions, when there is something amiss with a request, 981172 and 73 will issue an alert.
The false positive rate is high, I admit. But in my experience, many attackers managed to evade most other rules, but these two guardsmen still alerted. Remember 981173 used to alert on the occurrence of 4 special characters in a parameter. So I would argue, that the false negative rate of 981172 and 981173 is lower than with other rules.

The two rules come with an anomaly score of &quot;warning&quot;. That's fair given the high false positive rate and still enough to examine their alarms.

So I propose to include them into 3.0.0 as well. I think there is still some room in REQUEST-42-APPLICATION-ATTACK-SQLI.conf for these two guys. I plan to issue a pull request to accomplish this.

It will take some feedback for this proposal to go through. So please give me some. Maybe we can improve the rules before the said pull request.

Best,

Christian Folini


--
The most dangerous thought that you can have as a creative person is to think that you know what you're doing. Because once you think you know what you're doing you stop looking around for other ways of doing things and you stop being able to see other ways of doing things.
You become blind.
-- Bret Victor
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
<A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=habN1ipw_me0uz_Jn7rWtjU8vrdSXYQXySa869E7_w&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set">http://scanmail.trustwave.com/?c=4062&amp;d=habN1ipw_me0uz_Jn7rWtjU8vrdSXYQXySa869E7_w&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set</A>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001840.html">[Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0
</A></li>
	<LI>Next message: <A HREF="001842.html">[Owasp-modsecurity-core-rule-set] Rules 981172 and 981173 in 3.0.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1841">[ date ]</a>
              <a href="thread.html#1841">[ thread ]</a>
              <a href="subject.html#1841">[ subject ]</a>
              <a href="author.html#1841">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
