From mike at gotroot.com  Thu Oct  1 16:55:28 2009
From: mike at gotroot.com (Michael Shinn)
Date: Thu, 01 Oct 2009 16:55:28 -0400
Subject: [Owasp-modsecurity-core-rule-set] What mod_security rules could
 I for apache1?
In-Reply-To: <a257a4bc0909291424y1de3e757na94f097cd8203c2e@mail.gmail.com>
References: <a257a4bc0909231226o189f2de8qccdf166277102cab@mail.gmail.com>
	<21612433-043B-45A6-8A91-FEEA12D6CE59@jwall.org>
	<a257a4bc0909280858o38c9276j8144cf2e27d5a311@mail.gmail.com>
	<C93F3112-349A-4B9E-8129-D1B3F9378F96@jwall.org>
	<a257a4bc0909291424y1de3e757na94f097cd8203c2e@mail.gmail.com>
Message-ID: <1254430528.4537.333.camel@shrike2.gotroot.com>

On Tue, 2009-09-29 at 16:24 -0500, Matthew Young wrote: 
> Thank you Christian .... However as the gotroot.com website says...
> they do not update anymore the Apache1 rules.

They are still there to download, we just don't update the 1.9.x rules
anymore.  

> As a apache1 user... what would be the best approach to this... are
> these updates crucial for security (just confirming)?
> 
> 
> -Matt
> 
> On Mon, Sep 28, 2009 at 2:03 PM, Christian Bockermann <chris at jwall.org> wrote:
> > Hi Matt,
> >
> > the "core rules" are a set of rules (or "bundled rules" :-) if you like)
> > which are provided
> > and maintained by Breach Security. These used to be distributed along with
> > the ModSecurity
> > module and have lately been split into a separate project.
> > (As far as I know, the ModSecurity distribution does include them as well.)
> >
> > With "bundled rules" I was just referring to someone/some institution which
> > is providing a
> > "set of rules" [1] for protection with ModSecurity and is maintaining them
> > continuously (updates,
> > etc.)
> > Michael Shinn et.al. provide rules at their gotroot.com site for quite a
> > long time, now.
> > From what you can see on their website they still have supported/updates
> > rules for ModSecurity 1.9.
> >
> > [1] 'set of rules' == 'bundle of rules' == 'rules package' :-)
> >
> > Best regards,
> >   Chris
> >
> > Am 28.09.2009 um 17:58 schrieb Matthew Young:
> >
> >> What is the differance bewteen "bundled rules" and the current rule set?
> >>
> >> Thanks
> >>
> >> On Mon, Sep 28, 2009 at 3:37 AM, Christian Bockermann <chris at jwall.org>
> >> wrote:
> >> Hi Matt,
> >>
> >> the core-rules have been designed for ModSecurity 2.x right from the
> >> begining (IIRC).
> >> The only "bundled-rules" for 1.3, which I am aware of, can be found at
> >> www.gotroot.com
> >>
> >> Best regards,
> >>
> >>  Chris
> >>
> >>
> >> Am 23.09.2009 um 21:26 schrieb Matthew Young:
> >>
> >> Hello,
> >>
> >> We use apache1 with modsecurity-apache-1.9.3 included by OpenBSD. It is my
> >> understanding the newest version of the core rules are only compatible with
> >> apache2? if not.. is there any ruleset (supported or not) that I could use?
> >>
> >> Thank you
> >>
> >> -Matt
> >> _______________________________________________
> >> Owasp-modsecurity-core-rule-set mailing list
> >> Owasp-modsecurity-core-rule-set at lists.owasp.org
> >> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >>
> >>
> >
> >
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From unni at mutexes.org  Tue Oct 13 10:02:16 2009
From: unni at mutexes.org (unni krishnan)
Date: Tue, 13 Oct 2009 19:32:16 +0530
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
Message-ID: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>

Hi,

I was going through the security rules in the server and found this :

---------------------------------
SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
brother|autohttp|netants|eCatch)" \
        "chain,log,auditlog,msg:'Request Indicates an automated
program explored the site',id:'990011',severity:'5'"
SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
---------------------------------

As per my knowledge, it just logs the message "Request Indicates an
automated program explored the site". But actually it blocks access,
when accessing the URL using Curl.

----------------------------------
ModSecurity: Access denied with code 406 (phase 2). Match of "rx
^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
"/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
[msg "Request Indicates an automated program explored the site"]
[severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
----------------------------------

What is the logic behind that ?

-- 
Regards,
Unni
http://mutexes.org/

From ryan.barnett at breach.com  Tue Oct 13 10:37:01 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Tue, 13 Oct 2009 10:37:01 -0400
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
In-Reply-To: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>
References: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>
Message-ID: <200910131037.01631.ryan.barnett@breach.com>

On Tuesday 13 October 2009 10:02:16 am unni krishnan wrote:
> Hi,
>
> I was going through the security rules in the server and found this :
>
> ---------------------------------
> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
> brother|autohttp|netants|eCatch)" \
>         "chain,log,auditlog,msg:'Request Indicates an automated
> program explored the site',id:'990011',severity:'5'"
> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
> ---------------------------------
>
> As per my knowledge, it just logs the message "Request Indicates an
> automated program explored the site". But actually it blocks access,
> when accessing the URL using Curl.
>
> ----------------------------------
> ModSecurity: Access denied with code 406 (phase 2). Match of "rx
> ^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
> "/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
> [msg "Request Indicates an automated program explored the site"]
> [severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
> ----------------------------------
>
> What is the logic behind that ?

These are the older CRS.  I suggest that you update to the newer v2 CRS as 
they using anomaly scoring and it is quite easy to then allow these rules to 
slightly increase an anomaly score but to not cause a denial on their own.

-Ryan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091013/e47ef131/attachment.html 

From unni at mutexes.org  Tue Oct 13 13:27:35 2009
From: unni at mutexes.org (unni krishnan)
Date: Tue, 13 Oct 2009 22:57:35 +0530
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
In-Reply-To: <200910131037.01631.ryan.barnett@breach.com>
References: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>
	<200910131037.01631.ryan.barnett@breach.com>
Message-ID: <35dfe7b70910131027w6e668920q5f796d6d99fea5a1@mail.gmail.com>

Hi Ryan,

Thanks, I am just curious to know. What is the reason that the Curl
access is denied even though there is no deny rule specified in that
rule set.

On Tue, Oct 13, 2009 at 8:07 PM, Ryan Barnett <ryan.barnett at breach.com> wrote:
> On Tuesday 13 October 2009 10:02:16 am unni krishnan wrote:
>> Hi,
>>
>> I was going through the security rules in the server and found this :
>>
>> ---------------------------------
>> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
>> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
>> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
>> brother|autohttp|netants|eCatch)" \
>> "chain,log,auditlog,msg:'Request Indicates an automated
>> program explored the site',id:'990011',severity:'5'"
>> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
>> ---------------------------------
>>
>> As per my knowledge, it just logs the message "Request Indicates an
>> automated program explored the site". But actually it blocks access,
>> when accessing the URL using Curl.
>>
>> ----------------------------------
>> ModSecurity: Access denied with code 406 (phase 2). Match of "rx
>> ^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
>> "/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
>> [msg "Request Indicates an automated program explored the site"]
>> [severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
>> ----------------------------------
>>
>> What is the logic behind that ?
>
> These are the older CRS. I suggest that you update to the newer v2 CRS as
> they using anomaly scoring and it is quite easy to then allow these rules to
> slightly increase an anomaly score but to not cause a denial on their own.
>
> -Ryan
>
>



-- 
Regards,
Unni
http://mutexes.org/

From Brian.Rectanus at breach.com  Tue Oct 13 14:57:05 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Tue, 13 Oct 2009 11:57:05 -0700
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
In-Reply-To: <35dfe7b70910131027w6e668920q5f796d6d99fea5a1@mail.gmail.com>
References: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>	<200910131037.01631.ryan.barnett@breach.com>
	<35dfe7b70910131027w6e668920q5f796d6d99fea5a1@mail.gmail.com>
Message-ID: <4AD4CD81.1030804@breach.com>

The string "perl" is denied.

p(?:avuk|erl)

-B

unni krishnan wrote:
> Hi Ryan,
>
> Thanks, I am just curious to know. What is the reason that the Curl
> access is denied even though there is no deny rule specified in that
> rule set.
>
> On Tue, Oct 13, 2009 at 8:07 PM, Ryan Barnett<ryan.barnett at breach.com>  wrote:
>> On Tuesday 13 October 2009 10:02:16 am unni krishnan wrote:
>>> Hi,
>>>
>>> I was going through the security rules in the server and found this :
>>>
>>> ---------------------------------
>>> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
>>> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
>>> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
>>> brother|autohttp|netants|eCatch)" \
>>> "chain,log,auditlog,msg:'Request Indicates an automated
>>> program explored the site',id:'990011',severity:'5'"
>>> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
>>> ---------------------------------
>>>
>>> As per my knowledge, it just logs the message "Request Indicates an
>>> automated program explored the site". But actually it blocks access,
>>> when accessing the URL using Curl.
>>>
>>> ----------------------------------
>>> ModSecurity: Access denied with code 406 (phase 2). Match of "rx
>>> ^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
>>> "/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
>>> [msg "Request Indicates an automated program explored the site"]
>>> [severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
>>> ----------------------------------
>>>
>>> What is the logic behind that ?
>> These are the older CRS. I suggest that you update to the newer v2 CRS as
>> they using anomaly scoring and it is quite easy to then allow these rules to
>> slightly increase an anomaly score but to not cause a denial on their own.
>>
>> -Ryan
>>
>>
>
>
>

-- 
Brian Rectanus
Breach Security

From Brian.Rectanus at breach.com  Tue Oct 13 15:00:56 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Tue, 13 Oct 2009 12:00:56 -0700
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
In-Reply-To: <4AD4CD81.1030804@breach.com>
References: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>	<200910131037.01631.ryan.barnett@breach.com>
	<35dfe7b70910131027w6e668920q5f796d6d99fea5a1@mail.gmail.com>
	<4AD4CD81.1030804@breach.com>
Message-ID: <4AD4CE68.6010103@breach.com>

And of course by "perl" I meant "curl"

cu(?:sto|rl)

But maybe you meant why is it denied vs just logged?

Look at the debug log (I think level 4 or higher, maybe 5) and it will 
show you the resolved rule that is being executed.  There may be a value 
inherited from the default.

-B

Brian Rectanus wrote:
> The string "perl" is denied.
>
> p(?:avuk|erl)
>
> -B
>
> unni krishnan wrote:
>> Hi Ryan,
>>
>> Thanks, I am just curious to know. What is the reason that the Curl
>> access is denied even though there is no deny rule specified in that
>> rule set.
>>
>> On Tue, Oct 13, 2009 at 8:07 PM, Ryan Barnett<ryan.barnett at breach.com>   wrote:
>>> On Tuesday 13 October 2009 10:02:16 am unni krishnan wrote:
>>>> Hi,
>>>>
>>>> I was going through the security rules in the server and found this :
>>>>
>>>> ---------------------------------
>>>> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
>>>> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
>>>> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
>>>> brother|autohttp|netants|eCatch)" \
>>>> "chain,log,auditlog,msg:'Request Indicates an automated
>>>> program explored the site',id:'990011',severity:'5'"
>>>> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
>>>> ---------------------------------
>>>>
>>>> As per my knowledge, it just logs the message "Request Indicates an
>>>> automated program explored the site". But actually it blocks access,
>>>> when accessing the URL using Curl.
>>>>
>>>> ----------------------------------
>>>> ModSecurity: Access denied with code 406 (phase 2). Match of "rx
>>>> ^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
>>>> "/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
>>>> [msg "Request Indicates an automated program explored the site"]
>>>> [severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
>>>> ----------------------------------
>>>>
>>>> What is the logic behind that ?
>>> These are the older CRS. I suggest that you update to the newer v2 CRS as
>>> they using anomaly scoring and it is quite easy to then allow these rules to
>>> slightly increase an anomaly score but to not cause a denial on their own.
>>>
>>> -Ryan
>>>
>>>
>>
>>
>

-- 
Brian Rectanus
Breach Security

From chris.datfung at gmail.com  Tue Oct 13 18:03:33 2009
From: chris.datfung at gmail.com (Chris Datfung)
Date: Wed, 14 Oct 2009 00:03:33 +0200
Subject: [Owasp-modsecurity-core-rule-set] Variable to detect HTTPS
Message-ID: <4c9cc6790910131503i150ff1e1o6e6b46f8865c5d55@mail.gmail.com>

I want to write a rule to redirect requests for a certain directory that
arrive via HTTP to HTTPS. Is there a variable that stores whether an
incoming request arrived via HTTP or HTTPS?

Thanks,
Chris
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091014/374f4a11/attachment.html 

From Ryan.Barnett at breach.com  Tue Oct 13 18:09:01 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Tue, 13 Oct 2009 18:09:01 -0400
Subject: [Owasp-modsecurity-core-rule-set] Variable to detect HTTPS
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298E83@MONET.utopiasystems.net>

Not specifically for ssl but you can use the PORT variable to veify if it is 443 and if not then redirect it.


Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com
www.Breach.com

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Sent: Tue Oct 13 18:03:33 2009
Subject: [Owasp-modsecurity-core-rule-set] Variable to detect HTTPS

I want to write a rule to redirect requests for a certain directory that arrive via HTTP to HTTPS. Is there a variable that stores whether an incoming request arrived via HTTP or HTTPS?

Thanks,
Chris
-------------- next part --------------
A non-text attachment was scrubbed...
Name: winmail.dat
Type: application/ms-tnef
Size: 3627 bytes
Desc: not available
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091013/f3d42314/attachment.bin 

From Brian.Rectanus at breach.com  Tue Oct 13 18:23:42 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Tue, 13 Oct 2009 15:23:42 -0700
Subject: [Owasp-modsecurity-core-rule-set] Variable to detect HTTPS
In-Reply-To: <4c9cc6790910131503i150ff1e1o6e6b46f8865c5d55@mail.gmail.com>
References: <4c9cc6790910131503i150ff1e1o6e6b46f8865c5d55@mail.gmail.com>
Message-ID: <4AD4FDEE.2070405@breach.com>

Chris Datfung wrote:
> I want to write a rule to redirect requests for a certain directory that
> arrive via HTTP to HTTPS. Is there a variable that stores whether an
> incoming request arrived via HTTP or HTTPS?
>
> Thanks,
> Chris

You may be able to check the apache environment var via ENV:HTTPS.

You can also look for the port (SERVER_PORT).

But if you just want to redirect non-ssl to ssl something like this...

RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^/+(.*) https://your.host/$1 [R,L]

-B

-- 
Brian Rectanus
Breach Security

From unni at mutexes.org  Wed Oct 14 06:15:11 2009
From: unni at mutexes.org (unni krishnan)
Date: Wed, 14 Oct 2009 15:45:11 +0530
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
In-Reply-To: <4AD4CE68.6010103@breach.com>
References: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>
	<200910131037.01631.ryan.barnett@breach.com>
	<35dfe7b70910131027w6e668920q5f796d6d99fea5a1@mail.gmail.com>
	<4AD4CD81.1030804@breach.com> <4AD4CE68.6010103@breach.com>
Message-ID: <35dfe7b70910140315v68aee59p5ca2380a7556af6b@mail.gmail.com>

I know that the rule is to log when user agent is curl. Here is the debug log


------------------------------------------------------------------
sid#9abafc8][rid#9d8b688][/][4] Executing operator "rx" with param
"(?:\\b(?:(?:indy librar|snoop)y|microsoft url
control|lynx)\\b|d(?:ownload
demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
brother|autohttp|netants|eCatch)" against REQUEST_HEADERS:User-Agent.
sid#9abafc8][rid#9d8b688][/][4] Operator completed in 5 usec.
sid#9abafc8][rid#9d8b688][/][4] Rule returned 1.
sid#9abafc8][rid#9d8b688][/][4] Recipe: Invoking rule 9a165f8; [file
"/usr/local/apache/conf/modsec2.user.conf"] [line "59"].
sid#9abafc8][rid#9d8b688][/][5] Rule 9a165f8: SecRule
"REQUEST_HEADERS:User-Agent" "!@rx ^apache.*perl"
"phase:2,deny,log,status:406"
sid#9abafc8][rid#9d8b688][/][4] Transformation completed in 1 usec.
sid#9abafc8][rid#9d8b688][/][4] Executing operator "!rx" with param
"^apache.*perl" against REQUEST_HEADERS:User-Agent.
sid#9abafc8][rid#9d8b688][/][4] Operator completed in 1 usec.
sid#9abafc8][rid#9d8b688][/][4] Rule returned 1.
sid#9abafc8][rid#9d8b688][/][1] Access denied with code 406 (phase 2).
Match of "rx ^apache.*perl" against "REQUEST_HEADERS:User-Agent"
required. [file "/usr/local/apache/conf/modsec2.user.conf"] [line
"58"] [id "990011"] [msg "Request Indicates an automated program
explored the site"] [severity "NOTICE"]
------------------------------------------------------------------

The rule number 59 in the file /usr/local/apache/conf/modsec2.user.conf is :

-------------------------------------------------------------------
SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
brother|autohttp|netants|eCatch)" \
        "chain,log,auditlog,msg:'Request Indicates an automated
program explored the site',id:'990011',severity:'5'"
SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
-------------------------------------------------------------------

As you can see there is no deny rule. But the log says that :

--------------------------------------------------------------------
sid#9abafc8][rid#9d8b688][/][5] Rule 9a165f8: SecRule
"REQUEST_HEADERS:User-Agent" "!@rx ^apache.*perl"
"phase:2,deny,log,status:406"
--------------------------------------------------------------------

I am not able to find the deny line in the rule file. Why is it like
that. Is there any built-in rule in mod sec ?

On Wed, Oct 14, 2009 at 12:30 AM, Brian Rectanus
<Brian.Rectanus at breach.com> wrote:
> And of course by "perl" I meant "curl"
>
> cu(?:sto|rl)
>
> But maybe you meant why is it denied vs just logged?
>
> Look at the debug log (I think level 4 or higher, maybe 5) and it will show
> you the resolved rule that is being executed.  There may be a value
> inherited from the default.
>
> -B
>
> Brian Rectanus wrote:
>>
>> The string "perl" is denied.
>>
>> p(?:avuk|erl)
>>
>> -B
>>
>> unni krishnan wrote:
>>>
>>> Hi Ryan,
>>>
>>> Thanks, I am just curious to know. What is the reason that the Curl
>>> access is denied even though there is no deny rule specified in that
>>> rule set.
>>>
>>> On Tue, Oct 13, 2009 at 8:07 PM, Ryan Barnett<ryan.barnett at breach.com>
>>> wrote:
>>>>
>>>> On Tuesday 13 October 2009 10:02:16 am unni krishnan wrote:
>>>>>
>>>>> Hi,
>>>>>
>>>>> I was going through the security rules in the server and found this :
>>>>>
>>>>> ---------------------------------
>>>>> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
>>>>> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
>>>>>
>>>>> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
>>>>> brother|autohttp|netants|eCatch)" \
>>>>> "chain,log,auditlog,msg:'Request Indicates an automated
>>>>> program explored the site',id:'990011',severity:'5'"
>>>>> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
>>>>> ---------------------------------
>>>>>
>>>>> As per my knowledge, it just logs the message "Request Indicates an
>>>>> automated program explored the site". But actually it blocks access,
>>>>> when accessing the URL using Curl.
>>>>>
>>>>> ----------------------------------
>>>>> ModSecurity: Access denied with code 406 (phase 2). Match of "rx
>>>>> ^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
>>>>> "/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
>>>>> [msg "Request Indicates an automated program explored the site"]
>>>>> [severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
>>>>> ----------------------------------
>>>>>
>>>>> What is the logic behind that ?
>>>>
>>>> These are the older CRS. I suggest that you update to the newer v2 CRS
>>>> as
>>>> they using anomaly scoring and it is quite easy to then allow these
>>>> rules to
>>>> slightly increase an anomaly score but to not cause a denial on their
>>>> own.
>>>>
>>>> -Ryan
>>>>
>>>>
>>>
>>>
>>
>
> --
> Brian Rectanus
> Breach Security
>



-- 
Regards,
Unni
http://mutexes.org/

From ryan.barnett at breach.com  Wed Oct 14 09:46:29 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Wed, 14 Oct 2009 09:46:29 -0400
Subject: [Owasp-modsecurity-core-rule-set] Need a help with sec rule
In-Reply-To: <35dfe7b70910140315v68aee59p5ca2380a7556af6b@mail.gmail.com>
References: <35dfe7b70910130702k55dd1d0alb543cdc5d12eb43e@mail.gmail.com>
	<4AD4CE68.6010103@breach.com>
	<35dfe7b70910140315v68aee59p5ca2380a7556af6b@mail.gmail.com>
Message-ID: <200910140946.29893.ryan.barnett@breach.com>

On Wednesday 14 October 2009 06:15:11 am unni krishnan wrote:
> I know that the rule is to log when user agent is curl. Here is the debug
> log
>
>
> ------------------------------------------------------------------
> sid#9abafc8][rid#9d8b688][/][4] Executing operator "rx" with param
> "(?:\\b(?:(?:indy librar|snoop)y|microsoft url
> control|lynx)\\b|d(?:ownload
> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
> brother|autohttp|netants|eCatch)" against REQUEST_HEADERS:User-Agent.
> sid#9abafc8][rid#9d8b688][/][4] Operator completed in 5 usec.
> sid#9abafc8][rid#9d8b688][/][4] Rule returned 1.
> sid#9abafc8][rid#9d8b688][/][4] Recipe: Invoking rule 9a165f8; [file
> "/usr/local/apache/conf/modsec2.user.conf"] [line "59"].
> sid#9abafc8][rid#9d8b688][/][5] Rule 9a165f8: SecRule
> "REQUEST_HEADERS:User-Agent" "!@rx ^apache.*perl"
> "phase:2,deny,log,status:406"
> sid#9abafc8][rid#9d8b688][/][4] Transformation completed in 1 usec.
> sid#9abafc8][rid#9d8b688][/][4] Executing operator "!rx" with param
> "^apache.*perl" against REQUEST_HEADERS:User-Agent.
> sid#9abafc8][rid#9d8b688][/][4] Operator completed in 1 usec.
> sid#9abafc8][rid#9d8b688][/][4] Rule returned 1.
> sid#9abafc8][rid#9d8b688][/][1] Access denied with code 406 (phase 2).
> Match of "rx ^apache.*perl" against "REQUEST_HEADERS:User-Agent"
> required. [file "/usr/local/apache/conf/modsec2.user.conf"] [line
> "58"] [id "990011"] [msg "Request Indicates an automated program
> explored the site"] [severity "NOTICE"]
> ------------------------------------------------------------------
>
> The rule number 59 in the file /usr/local/apache/conf/modsec2.user.conf is
> :
>
> -------------------------------------------------------------------
> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)|big
> brother|autohttp|netants|eCatch)" \
>         "chain,log,auditlog,msg:'Request Indicates an automated
> program explored the site',id:'990011',severity:'5'"
> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
> -------------------------------------------------------------------
>
> As you can see there is no deny rule. But the log says that :
>
> --------------------------------------------------------------------
> sid#9abafc8][rid#9d8b688][/][5] Rule 9a165f8: SecRule
> "REQUEST_HEADERS:User-Agent" "!@rx ^apache.*perl"
> "phase:2,deny,log,status:406"
> --------------------------------------------------------------------
>
> I am not able to find the deny line in the rule file. Why is it like
> that. Is there any built-in rule in mod sec ?
>

Search your rulesets for the SecDefaultAction directive.  It seems as though 
the deny and status code of 403 is being set somewhere else and is inherited 
by this rule as it isn't specifying any disruptive action itself.

> On Wed, Oct 14, 2009 at 12:30 AM, Brian Rectanus
>
> <Brian.Rectanus at breach.com> wrote:
> > And of course by "perl" I meant "curl"
> >
> > cu(?:sto|rl)
> >
> > But maybe you meant why is it denied vs just logged?
> >
> > Look at the debug log (I think level 4 or higher, maybe 5) and it will
> > show you the resolved rule that is being executed.  There may be a value
> > inherited from the default.
> >
> > -B
> >
> > Brian Rectanus wrote:
> >> The string "perl" is denied.
> >>
> >> p(?:avuk|erl)
> >>
> >> -B
> >>
> >> unni krishnan wrote:
> >>> Hi Ryan,
> >>>
> >>> Thanks, I am just curious to know. What is the reason that the Curl
> >>> access is denied even though there is no deny rule specified in that
> >>> rule set.
> >>>
> >>> On Tue, Oct 13, 2009 at 8:07 PM, Ryan Barnett<ryan.barnett at breach.com>
> >>>
> >>> wrote:
> >>>> On Tuesday 13 October 2009 10:02:16 am unni krishnan wrote:
> >>>>> Hi,
> >>>>>
> >>>>> I was going through the security rules in the server and found this :
> >>>>>
> >>>>> ---------------------------------
> >>>>> SecRule REQUEST_HEADERS:User-Agent "(?:\b(?:(?:indy
> >>>>> librar|snoop)y|microsoft url control|lynx)\b|d(?:ownload
> >>>>>
> >>>>> demon|isco)|w(?:3mirror|get)|l(?:ibwww|wp)|p(?:avuk|erl)|cu(?:sto|rl)
> >>>>>|big brother|autohttp|netants|eCatch)" \
> >>>>> "chain,log,auditlog,msg:'Request Indicates an automated
> >>>>> program explored the site',id:'990011',severity:'5'"
> >>>>> SecRule REQUEST_HEADERS:User-Agent "!^apache.*perl"
> >>>>> ---------------------------------
> >>>>>
> >>>>> As per my knowledge, it just logs the message "Request Indicates an
> >>>>> automated program explored the site". But actually it blocks access,
> >>>>> when accessing the URL using Curl.
> >>>>>
> >>>>> ----------------------------------
> >>>>> ModSecurity: Access denied with code 406 (phase 2). Match of "rx
> >>>>> ^apache.*perl" against "REQUEST_HEADERS:User-Agent" required. [file
> >>>>> "/usr/local/apache/conf/modsec2.user.conf"] [line "58"] [id "990011"]
> >>>>> [msg "Request Indicates an automated program explored the site"]
> >>>>> [severity "NOTICE"] [uri "/"] [unique_id "StSH9EPeHm4AAB3fCZgAAAAE"]
> >>>>> ----------------------------------
> >>>>>
> >>>>> What is the logic behind that ?
> >>>>
> >>>> These are the older CRS. I suggest that you update to the newer v2 CRS
> >>>> as
> >>>> they using anomaly scoring and it is quite easy to then allow these
> >>>> rules to
> >>>> slightly increase an anomaly score but to not cause a denial on their
> >>>> own.
> >>>>
> >>>> -Ryan
> >
> > --
> > Brian Rectanus
> > Breach Security

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091014/15f4d7cf/attachment.html 

From listas at sapao.net  Mon Oct 19 13:09:28 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Mon, 19 Oct 2009 15:09:28 -0200
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy conections
Message-ID: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com>

Hello,

I am using CRS 2.0.1 and am getting messagens like these in error_log
several times a day:

Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Request Missing a Host Header"] [severity
"WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code
400 (phase 2). Operator EQ matched 0 at REQUEST_HEADERS. [hostname "server"]
[uri "*"] [unique_id "v9KnRH8AAAEAAEtS7SUAAACo"]
Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing a
Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score. [hostname
"server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
"v9KnRH8AAAEAAEtS7SUAAACo"]
Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Request Missing a Host Header"] [severity
"WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code
400 (phase 2). Operator EQ matched 0 at REQUEST_HEADERS. [hostname "server"]
[uri "*"] [unique_id "v at HpNH8AAAEAAEpCcrMAAAAe"]
Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing a
Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score. [hostname
"server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
"v at HpNH8AAAEAAEpCcrMAAAAe"]
Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Request Missing a Host Header"] [severity
"WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code
400 (phase 2). Operator EQ matched 0 at REQUEST_HEADERS. [hostname "server"]
[uri "*"] [unique_id "v-ErhX8AAAEAAEqfn2kAAACn"]
Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing a
Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score. [hostname
"server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
"v-ErhX8AAAEAAEqfn2kAAACn"]

In older rule sets, I made some rules to ruleRemoveById in requests from
localhost with the dummy user agent. Is this the best way to go or is there
a more elegant solution?

Thanks,

Lucas

-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/6344af6d/attachment.html 

From listas at sapao.net  Mon Oct 19 13:41:49 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Mon, 19 Oct 2009 15:41:49 -0200
Subject: [Owasp-modsecurity-core-rule-set] How to disable rule
Message-ID: <245770850910191041t1df31279g7ee357184301567d@mail.gmail.com>

Hello,

I am getting some false positives on the rules:

SecRule ARGS_NAMES ".*" \

"chain,phase:2,t:none,nolog,auditlog,pass,capture,setvar:'tx.arg_name_%{tx.0}=+1',msg:'Possible
HTTP Parameter Pollution Attack: Multiple Parameters with the same Name.'"
        SecRule TX:/ARG_NAME_*/ "@gt 1"
"t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.web_attack_score=+1,setvar:tx.%{
rule.id}-WEB_ATTACK/COMMAND_INJECTION-%{matched_var_name}=%{matched_var}"

The error logged is:
--83105014-H--
Message:  [file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score
 (score 20): Possible HTTP Parameter Pollution Attack: Multiple Parameters
with the same Name."] Warning. Operator GE matched 5 at TX:an
omaly_score.
Action: Intercepted (phase 2)
Apache-Handler: type-map
Stopwatch: 1255961504085232 72304 (15501* 70314 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
ruleset/2.0.1; core ruleset/2.0.1.
Server: Apache/2.2.3 (Red Hat)

The problem is that this application uses multiple parameters with the same
name, so this behaviour must be allowed. I am using CRS 2.0.1.

As the rules have no IDs, I cannot use a SecRuleRemoveById to remove it. I
can comment them, but I would rather not make changes on the original files,
keeping my changes in separate files. Is there any other way to disable
these rules?

Thanks,

Lucas

-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/a926c59f/attachment.html 

From Brian.Rectanus at breach.com  Mon Oct 19 14:22:56 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Mon, 19 Oct 2009 11:22:56 -0700
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com>
Message-ID: <4ADCAE80.4070402@breach.com>

Lucas Ferreira wrote:
> Hello,
>
> I am using CRS 2.0.1 and am getting messagens like these in error_log
> several times a day:
>
> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
> [file
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
> denied with code 400 (phase 2). Operator EQ matched 0 at
> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
> "v9KnRH8AAAEAAEtS7SUAAACo"]
> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
> [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
> "v9KnRH8AAAEAAEtS7SUAAACo"]
> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
> [file
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
> denied with code 400 (phase 2). Operator EQ matched 0 at
> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
> "v at HpNH8AAAEAAEpCcrMAAAAe"]
> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
> [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
> "v at HpNH8AAAEAAEpCcrMAAAAe"]
> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
> [file
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
> denied with code 400 (phase 2). Operator EQ matched 0 at
> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
> "v-ErhX8AAAEAAEqfn2kAAACn"]
> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
> [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
> "v-ErhX8AAAEAAEqfn2kAAACn"]
>
> In older rule sets, I made some rules to ruleRemoveById in requests from
> localhost with the dummy user agent. Is this the best way to go or is
> there a more elegant solution?
>

make sure you have enabled this file which has the exceptions for the 
dummy connection in it:

base_rules/modsecurity_crs_47_common_exceptions.conf

-B

-- 
Brian Rectanus
Breach Security

From Brian.Rectanus at breach.com  Mon Oct 19 14:28:55 2009
From: Brian.Rectanus at breach.com (Brian Rectanus)
Date: Mon, 19 Oct 2009 11:28:55 -0700
Subject: [Owasp-modsecurity-core-rule-set] How to disable rule
In-Reply-To: <245770850910191041t1df31279g7ee357184301567d@mail.gmail.com>
References: <245770850910191041t1df31279g7ee357184301567d@mail.gmail.com>
Message-ID: <4ADCAFE7.8070504@breach.com>

Lucas Ferreira wrote:
> Hello,
>
> I am getting some false positives on the rules:
>
> SecRule ARGS_NAMES ".*" \
> "chain,phase:2,t:none,nolog,auditlog,pass,capture,setvar:'tx.arg_name_%{tx.0}=+1',msg:'Possible
> HTTP Parameter Pollution Attack: Multiple Parameters with the same Name.'"
>          SecRule TX:/ARG_NAME_*/ "@gt 1"
> "t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.web_attack_score=+1,setvar:tx.%{rule.id
> <http://rule.id>}-WEB_ATTACK/COMMAND_INJECTION-%{matched_var_name}=%{matched_var}"
>
> The error logged is:
> --83105014-H--
> Message:  [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score
>   (score 20): Possible HTTP Parameter Pollution Attack: Multiple
> Parameters with the same Name."] Warning. Operator GE matched 5 at TX:an
> omaly_score.
> Action: Intercepted (phase 2)
> Apache-Handler: type-map
> Stopwatch: 1255961504085232 72304 (15501* 70314 -)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
> core ruleset/2.0.1; core ruleset/2.0.1. <http://2.0.1.>
> Server: Apache/2.2.3 (Red Hat)
>
> The problem is that this application uses multiple parameters with the
> same name, so this behaviour must be allowed. I am using CRS 2.0.1.
>
> As the rules have no IDs, I cannot use a SecRuleRemoveById to remove it.
> I can comment them, but I would rather not make changes on the original
> files, keeping my changes in separate files. Is there any other way to
> disable these rules?

Take a look at the examples of how to make exceptions to anomaly scoring 
rules in:

base_rules/modsecurity_crs_48_local_exceptions.conf

-B

-- 
Brian Rectanus
Breach Security

From listas at sapao.net  Mon Oct 19 16:33:26 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Mon, 19 Oct 2009 18:33:26 -0200
Subject: [Owasp-modsecurity-core-rule-set] How to disable rule
In-Reply-To: <4ADCAFE7.8070504@breach.com>
References: <245770850910191041t1df31279g7ee357184301567d@mail.gmail.com> 
	<4ADCAFE7.8070504@breach.com>
Message-ID: <245770850910191333v68497338w63ce8e6a0b5753e2@mail.gmail.com>

Hello Brian,

I've seen the examples, but I could not find an ID for the rule. I do not
want to remove the COMMAND_INJECTION category. Is it normal to have a rule
with no ID?

Thanks,

Lucas

On Mon, Oct 19, 2009 at 16:28, Brian Rectanus <Brian.Rectanus at breach.com>wrote:

> Lucas Ferreira wrote:
>
>> Hello,
>>
>> I am getting some false positives on the rules:
>>
>> SecRule ARGS_NAMES ".*" \
>>
>> "chain,phase:2,t:none,nolog,auditlog,pass,capture,setvar:'tx.arg_name_%{tx.0}=+1',msg:'Possible
>> HTTP Parameter Pollution Attack: Multiple Parameters with the same Name.'"
>>         SecRule TX:/ARG_NAME_*/ "@gt 1"
>>
>> "t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.web_attack_score=+1,setvar:tx.%{
>> rule.id
>> <http://rule.id
>> >}-WEB_ATTACK/COMMAND_INJECTION-%{matched_var_name}=%{matched_var}"
>>
>> The error logged is:
>> --83105014-H--
>> Message:  [file
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> [line "41"] [msg "Transactional Anomaly Score
>>  (score 20): Possible HTTP Parameter Pollution Attack: Multiple
>> Parameters with the same Name."] Warning. Operator GE matched 5 at TX:an
>> omaly_score.
>> Action: Intercepted (phase 2)
>> Apache-Handler: type-map
>> Stopwatch: 1255961504085232 72304 (15501* 70314 -)
>> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
>> core ruleset/2.0.1; core ruleset/2.0.1. <http://2.0.1.>
>> Server: Apache/2.2.3 (Red Hat)
>>
>> The problem is that this application uses multiple parameters with the
>> same name, so this behaviour must be allowed. I am using CRS 2.0.1.
>>
>> As the rules have no IDs, I cannot use a SecRuleRemoveById to remove it.
>> I can comment them, but I would rather not make changes on the original
>> files, keeping my changes in separate files. Is there any other way to
>> disable these rules?
>>
>
> Take a look at the examples of how to make exceptions to anomaly scoring
> rules in:
>
> base_rules/modsecurity_crs_48_local_exceptions.conf
>
> -B
>
> --
> Brian Rectanus
> Breach Security
>



-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/a3da5d6b/attachment-0001.html 

From listas at sapao.net  Mon Oct 19 16:41:05 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Mon, 19 Oct 2009 18:41:05 -0200
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <4ADCAE80.4070402@breach.com>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com> 
	<4ADCAE80.4070402@breach.com>
Message-ID: <245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com>

Hello Brian,

this file is anebled, but I still get errors like this in the audit log:

--650c7926-A--
[19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
--650c7926-B--
OPTIONS * HTTP/1.0
User-Agent: mysite (internal dummy connection)

--650c7926-F--
HTTP/1.1 400 Bad Request
Vary: accept-language,accept-charset
Accept-Ranges: bytes
Connection: close
Content-Type: text/html; charset=iso-8859-1
Content-Language: en
Expires: Mon, 19 Oct 2009 17:05:16 GMT

--650c7926-H--
Message:  [file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Re
quest Missing a Host Header"] [severity "WARNING"] [tag
"PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase 2).
Oper
ator EQ matched 0 at REQUEST_HEADERS.
Message:  [file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score
 (score 5): Request Missing a Host Header"] Warning. Operator GE matched 5
at TX:anomaly_score.
Action: Intercepted (phase 2)
Apache-Handler: type-map
Stopwatch: 1255971916688261 2329 (568 1401 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
ruleset/2.0.1; core ruleset/2.0.1.
Server: Apache/2.2.3 (Red Hat)

--650c7926-Z--

Thanks,

Lucas

On Mon, Oct 19, 2009 at 16:22, Brian Rectanus <Brian.Rectanus at breach.com>wrote:

> Lucas Ferreira wrote:
>
>> Hello,
>>
>> I am using CRS 2.0.1 and am getting messagens like these in error_log
>> several times a day:
>>
>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>> [file
>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>> [file
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>> [file
>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>> [file
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>> [file
>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>> [file
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>
>> In older rule sets, I made some rules to ruleRemoveById in requests from
>> localhost with the dummy user agent. Is this the best way to go or is
>> there a more elegant solution?
>>
>>
> make sure you have enabled this file which has the exceptions for the dummy
> connection in it:
>
> base_rules/modsecurity_crs_47_common_exceptions.conf
>
> -B
>
> --
> Brian Rectanus
> Breach Security
>



-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/e6bab74c/attachment.html 

From Ryan.Barnett at breach.com  Mon Oct 19 16:46:46 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Mon, 19 Oct 2009 16:46:46 -0400
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache
	dummy	conections
In-Reply-To: <245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com>
	<4ADCAE80.4070402@breach.com>,
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net>

The issue seems to be that you have updated the SecDefaultAction to deny and issue a 400 status code.  If you set the SecDefaultAction to block instead of the default of pass, then the rules are essentially working the way they did > v2.  That is if a rule matches it will block.  You need to have the SecDefaultAction set to pass so the block action in each rule will inherit this setting.

In this case, that protocol anomaly rule is triggering and then denying and therefore the other rules (including the local exceptions file) does not get a chance to run.  Try setting the SecDefaultAction back to the default.  You can then control blocking in the 49 enforcement file - based on the anomaly score.

-Ryan
________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Lucas Ferreira [listas at sapao.net]
Sent: Monday, October 19, 2009 4:41 PM
To: Brian Rectanus
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy conections

Hello Brian,

this file is anebled, but I still get errors like this in the audit log:

--650c7926-A--
[19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
--650c7926-B--
OPTIONS * HTTP/1.0
User-Agent: mysite (internal dummy connection)

--650c7926-F--
HTTP/1.1 400 Bad Request
Vary: accept-language,accept-charset
Accept-Ranges: bytes
Connection: close
Content-Type: text/html; charset=iso-8859-1
Content-Language: en
Expires: Mon, 19 Oct 2009 17:05:16 GMT

--650c7926-H--
Message:  [file "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"] [line "35"] [id "960008"] [msg "Re
quest Missing a Host Header"] [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase 2). Oper
ator EQ matched 0 at REQUEST_HEADERS.
Message:  [file "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"] [line "41"] [msg "Transactional Anomaly Score
 (score 5): Request Missing a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
Action: Intercepted (phase 2)
Apache-Handler: type-map
Stopwatch: 1255971916688261 2329 (568 1401 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core ruleset/2.0.1; core ruleset/2.0.1.<http://2.0.1.>
Server: Apache/2.2.3 (Red Hat)

--650c7926-Z--

Thanks,

Lucas

On Mon, Oct 19, 2009 at 16:22, Brian Rectanus <Brian.Rectanus at breach.com<mailto:Brian.Rectanus at breach.com>> wrote:
Lucas Ferreira wrote:
Hello,

I am using CRS 2.0.1 and am getting messagens like these in error_log
several times a day:

Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Request Missing a Host Header"]
[severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
denied with code 400 (phase 2). Operator EQ matched 0 at
REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
"v9KnRH8AAAEAAEtS7SUAAACo"]
Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
[hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
"v9KnRH8AAAEAAEtS7SUAAACo"]
Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Request Missing a Host Header"]
[severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
denied with code 400 (phase 2). Operator EQ matched 0 at
REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
"v at HpNH8AAAEAAEpCcrMAAAAe"]
Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
[hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
"v at HpNH8AAAEAAEpCcrMAAAAe"]
Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
[line "35"] [id "960008"] [msg "Request Missing a Host Header"]
[severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
denied with code 400 (phase 2). Operator EQ matched 0 at
REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
"v-ErhX8AAAEAAEqfn2kAAACn"]
Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
[hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
"v-ErhX8AAAEAAEqfn2kAAACn"]

In older rule sets, I made some rules to ruleRemoveById in requests from
localhost with the dummy user agent. Is this the best way to go or is
there a more elegant solution?


make sure you have enabled this file which has the exceptions for the dummy connection in it:

base_rules/modsecurity_crs_47_common_exceptions.conf

-B

--
Brian Rectanus
Breach Security



--
If a tree falls in the forest and no one is around to see it, do the other trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/c85da6cd/attachment-0001.html 

From Ryan.Barnett at breach.com  Mon Oct 19 16:55:48 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Mon, 19 Oct 2009 16:55:48 -0400
Subject: [Owasp-modsecurity-core-rule-set] How to disable rule
In-Reply-To: <245770850910191333v68497338w63ce8e6a0b5753e2@mail.gmail.com>
References: <245770850910191041t1df31279g7ee357184301567d@mail.gmail.com>
	<4ADCAFE7.8070504@breach.com>,
	<245770850910191333v68497338w63ce8e6a0b5753e2@mail.gmail.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AC6@MONET.utopiasystems.net>

You don't have to have a rule id in order to do an exception in that file.  What you do need to know is how to properly identify the TX variable and then adjust the anomaly score back down.

Look either in the audit or debug log to find out what the setvar TX variable (specifically what is the parameter name it is flagging) is and then you can create a rule.

-Ryan

________________________________
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of Lucas Ferreira [listas at sapao.net]
Sent: Monday, October 19, 2009 4:33 PM
To: Brian Rectanus
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] How to disable rule

Hello Brian,

I've seen the examples, but I could not find an ID for the rule. I do not want to remove the COMMAND_INJECTION category. Is it normal to have a rule with no ID?

Thanks,

Lucas

On Mon, Oct 19, 2009 at 16:28, Brian Rectanus <Brian.Rectanus at breach.com<mailto:Brian.Rectanus at breach.com>> wrote:
Lucas Ferreira wrote:
Hello,

I am getting some false positives on the rules:

SecRule ARGS_NAMES ".*" \
"chain,phase:2,t:none,nolog,auditlog,pass,capture,setvar:'tx.arg_name_%{tx.0}=+1',msg:'Possible
HTTP Parameter Pollution Attack: Multiple Parameters with the same Name.'"
        SecRule TX:/ARG_NAME_*/ "@gt 1"
"t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+20,setvar:tx.web_attack_score=+1,setvar:tx.%{rule.id<http://rule.id>
<http://rule.id>}-WEB_ATTACK/COMMAND_INJECTION-%{matched_var_name}=%{matched_var}"


The error logged is:
--83105014-H--
Message:  [file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "41"] [msg "Transactional Anomaly Score
 (score 20): Possible HTTP Parameter Pollution Attack: Multiple
Parameters with the same Name."] Warning. Operator GE matched 5 at TX:an
omaly_score.
Action: Intercepted (phase 2)
Apache-Handler: type-map
Stopwatch: 1255961504085232 72304 (15501* 70314 -)
Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
core ruleset/2.0.1; core ruleset/2.0.1.<http://2.0.1.> <http://2.0.1.>

Server: Apache/2.2.3 (Red Hat)

The problem is that this application uses multiple parameters with the
same name, so this behaviour must be allowed. I am using CRS 2.0.1.

As the rules have no IDs, I cannot use a SecRuleRemoveById to remove it.
I can comment them, but I would rather not make changes on the original
files, keeping my changes in separate files. Is there any other way to
disable these rules?

Take a look at the examples of how to make exceptions to anomaly scoring rules in:

base_rules/modsecurity_crs_48_local_exceptions.conf

-B

--
Brian Rectanus
Breach Security



--
If a tree falls in the forest and no one is around to see it, do the other trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/7ebf1d38/attachment.html 

From listas at sapao.net  Mon Oct 19 17:13:41 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Mon, 19 Oct 2009 19:13:41 -0200
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com> 
	<4ADCAE80.4070402@breach.com>
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com> 
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net>
Message-ID: <245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com>

Hello Ryan,

my SecDefaultAction is:

SecDefaultAction "phase:2,pass"

Regards,

Lucas

On Mon, Oct 19, 2009 at 18:46, Ryan Barnett <Ryan.Barnett at breach.com> wrote:

>  The issue seems to be that you have updated the SecDefaultAction to deny
> and issue a 400 status code.  If you set the SecDefaultAction to block
> instead of the default of pass, then the rules are essentially working the
> way they did > v2.  That is if a rule matches it will block.  You need to
> have the SecDefaultAction set to pass so the block action in each rule will
> inherit this setting.
>
> In this case, that protocol anomaly rule is triggering and then denying and
> therefore the other rules (including the local exceptions file) does not get
> a chance to run.  Try setting the SecDefaultAction back to the default.  You
> can then control blocking in the 49 enforcement file - based on the anomaly
> score.
>
> -Ryan
>  ------------------------------
> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [
> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of
> Lucas Ferreira [listas at sapao.net]
> *Sent:* Monday, October 19, 2009 4:41 PM
> *To:* Brian Rectanus
> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
> conections
>
>  Hello Brian,
>
> this file is anebled, but I still get errors like this in the audit log:
>
> --650c7926-A--
> [19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
> --650c7926-B--
> OPTIONS * HTTP/1.0
> User-Agent: mysite (internal dummy connection)
>
> --650c7926-F--
> HTTP/1.1 400 Bad Request
> Vary: accept-language,accept-charset
> Accept-Ranges: bytes
> Connection: close
> Content-Type: text/html; charset=iso-8859-1
> Content-Language: en
> Expires: Mon, 19 Oct 2009 17:05:16 GMT
>
> --650c7926-H--
> Message:  [file
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> [line "35"] [id "960008"] [msg "Re
> quest Missing a Host Header"] [severity "WARNING"] [tag
> "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase 2).
> Oper
> ator EQ matched 0 at REQUEST_HEADERS.
> Message:  [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "41"] [msg "Transactional Anomaly Score
>  (score 5): Request Missing a Host Header"] Warning. Operator GE matched 5
> at TX:anomaly_score.
> Action: Intercepted (phase 2)
> Apache-Handler: type-map
> Stopwatch: 1255971916688261 2329 (568 1401 -)
> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
> ruleset/2.0.1; core ruleset/2.0.1.
> Server: Apache/2.2.3 (Red Hat)
>
> --650c7926-Z--
>
> Thanks,
>
> Lucas
>
> On Mon, Oct 19, 2009 at 16:22, Brian Rectanus <Brian.Rectanus at breach.com>wrote:
>
>>  Lucas Ferreira wrote:
>>
>>> Hello,
>>>
>>> I am using CRS 2.0.1 and am getting messagens like these in error_log
>>> several times a day:
>>>
>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>>> [file
>>>
>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>>> [file
>>>
>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>>> [file
>>>
>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>>> [file
>>>
>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>>> [file
>>>
>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>>> [file
>>>
>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>>
>>> In older rule sets, I made some rules to ruleRemoveById in requests from
>>> localhost with the dummy user agent. Is this the best way to go or is
>>> there a more elegant solution?
>>>
>>>
>>  make sure you have enabled this file which has the exceptions for the
>> dummy connection in it:
>>
>> base_rules/modsecurity_crs_47_common_exceptions.conf
>>
>> -B
>>
>> --
>> Brian Rectanus
>> Breach Security
>>
>
>
>
> --
> If a tree falls in the forest and no one is around to see it, do the other
> trees make fun of it?
>



-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091019/27f6c588/attachment.html 

From rcbarnett at gmail.com  Mon Oct 19 20:03:56 2009
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Mon, 19 Oct 2009 20:03:56 -0400
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com>
	<4ADCAE80.4070402@breach.com>
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com>
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net>
	<245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com>
Message-ID: <cba0286a0910191703i263f1b25j9c1dcb980ea3a507@mail.gmail.com>

Hmm... Can you paste in that specific protocol anomaly rule that
triggered?  There should be a block action.



On 10/19/09, Lucas Ferreira <listas at sapao.net> wrote:
> Hello Ryan,
>
> my SecDefaultAction is:
>
> SecDefaultAction "phase:2,pass"
>
> Regards,
>
> Lucas
>
> On Mon, Oct 19, 2009 at 18:46, Ryan Barnett <Ryan.Barnett at breach.com> wrote:
>
>>  The issue seems to be that you have updated the SecDefaultAction to deny
>> and issue a 400 status code.  If you set the SecDefaultAction to block
>> instead of the default of pass, then the rules are essentially working the
>> way they did > v2.  That is if a rule matches it will block.  You need to
>> have the SecDefaultAction set to pass so the block action in each rule
>> will
>> inherit this setting.
>>
>> In this case, that protocol anomaly rule is triggering and then denying
>> and
>> therefore the other rules (including the local exceptions file) does not
>> get
>> a chance to run.  Try setting the SecDefaultAction back to the default.
>> You
>> can then control blocking in the 49 enforcement file - based on the
>> anomaly
>> score.
>>
>> -Ryan
>>  ------------------------------
>> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [
>> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of
>> Lucas Ferreira [listas at sapao.net]
>> *Sent:* Monday, October 19, 2009 4:41 PM
>> *To:* Brian Rectanus
>> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
>> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
>> conections
>>
>>  Hello Brian,
>>
>> this file is anebled, but I still get errors like this in the audit log:
>>
>> --650c7926-A--
>> [19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
>> --650c7926-B--
>> OPTIONS * HTTP/1.0
>> User-Agent: mysite (internal dummy connection)
>>
>> --650c7926-F--
>> HTTP/1.1 400 Bad Request
>> Vary: accept-language,accept-charset
>> Accept-Ranges: bytes
>> Connection: close
>> Content-Type: text/html; charset=iso-8859-1
>> Content-Language: en
>> Expires: Mon, 19 Oct 2009 17:05:16 GMT
>>
>> --650c7926-H--
>> Message:  [file
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> [line "35"] [id "960008"] [msg "Re
>> quest Missing a Host Header"] [severity "WARNING"] [tag
>> "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase
>> 2).
>> Oper
>> ator EQ matched 0 at REQUEST_HEADERS.
>> Message:  [file
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> [line "41"] [msg "Transactional Anomaly Score
>>  (score 5): Request Missing a Host Header"] Warning. Operator GE matched 5
>> at TX:anomaly_score.
>> Action: Intercepted (phase 2)
>> Apache-Handler: type-map
>> Stopwatch: 1255971916688261 2329 (568 1401 -)
>> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
>> ruleset/2.0.1; core ruleset/2.0.1.
>> Server: Apache/2.2.3 (Red Hat)
>>
>> --650c7926-Z--
>>
>> Thanks,
>>
>> Lucas
>>
>> On Mon, Oct 19, 2009 at 16:22, Brian Rectanus
>> <Brian.Rectanus at breach.com>wrote:
>>
>>>  Lucas Ferreira wrote:
>>>
>>>> Hello,
>>>>
>>>> I am using CRS 2.0.1 and am getting messagens like these in error_log
>>>> several times a day:
>>>>
>>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>>>
>>>> In older rule sets, I made some rules to ruleRemoveById in requests from
>>>> localhost with the dummy user agent. Is this the best way to go or is
>>>> there a more elegant solution?
>>>>
>>>>
>>>  make sure you have enabled this file which has the exceptions for the
>>> dummy connection in it:
>>>
>>> base_rules/modsecurity_crs_47_common_exceptions.conf
>>>
>>> -B
>>>
>>> --
>>> Brian Rectanus
>>> Breach Security
>>>
>>
>>
>>
>> --
>> If a tree falls in the forest and no one is around to see it, do the other
>> trees make fun of it?
>>
>
>
>
> --
> If a tree falls in the forest and no one is around to see it, do the other
> trees make fun of it?
>

-- 
Sent from my mobile device

Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com/

From listas at sapao.net  Tue Oct 20 11:02:13 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Tue, 20 Oct 2009 13:02:13 -0200
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <cba0286a0910191703i263f1b25j9c1dcb980ea3a507@mail.gmail.com>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com> 
	<4ADCAE80.4070402@breach.com>
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com> 
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net> 
	<245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com> 
	<cba0286a0910191703i263f1b25j9c1dcb980ea3a507@mail.gmail.com>
Message-ID: <245770850910200802t130f796ao18470a8a9e2c6223@mail.gmail.com>

Hello Ryan,

these are the rules, from file modsecurity_crs_21_protocol_anomalies.conf

SecMarker BEGIN_HOST_CHECK

        SecRule &REQUEST_HEADERS:Host "@eq 0" \

"skipAfter:END_HOST_CHECK,phase:2,t:none,nolog,auditlog,msg:'Request Missing
a Host Header',id:'960008',tag:'PROTOCOL_VI
OLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
:tx.%{rule.id
}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
        SecRule REQUEST_HEADERS:Host "^$" \
                "phase:2,t:none,nolog,auditlog,msg:'Request Missing a Host
Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{
rule.id}-PROTOCOL_V
IOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"

SecMarker END_HOST_CHECK

Regards,

Lucas

On Mon, Oct 19, 2009 at 22:03, Ryan Barnett <rcbarnett at gmail.com> wrote:

> Hmm... Can you paste in that specific protocol anomaly rule that
> triggered?  There should be a block action.
>
>
>
> On 10/19/09, Lucas Ferreira <listas at sapao.net> wrote:
> > Hello Ryan,
> >
> > my SecDefaultAction is:
> >
> > SecDefaultAction "phase:2,pass"
> >
> > Regards,
> >
> > Lucas
> >
> > On Mon, Oct 19, 2009 at 18:46, Ryan Barnett <Ryan.Barnett at breach.com>
> wrote:
> >
> >>  The issue seems to be that you have updated the SecDefaultAction to
> deny
> >> and issue a 400 status code.  If you set the SecDefaultAction to block
> >> instead of the default of pass, then the rules are essentially working
> the
> >> way they did > v2.  That is if a rule matches it will block.  You need
> to
> >> have the SecDefaultAction set to pass so the block action in each rule
> >> will
> >> inherit this setting.
> >>
> >> In this case, that protocol anomaly rule is triggering and then denying
> >> and
> >> therefore the other rules (including the local exceptions file) does not
> >> get
> >> a chance to run.  Try setting the SecDefaultAction back to the default.
> >> You
> >> can then control blocking in the 49 enforcement file - based on the
> >> anomaly
> >> score.
> >>
> >> -Ryan
> >>  ------------------------------
> >> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [
> >> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of
> >> Lucas Ferreira [listas at sapao.net]
> >> *Sent:* Monday, October 19, 2009 4:41 PM
> >> *To:* Brian Rectanus
> >> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
> >> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
> >> conections
> >>
> >>  Hello Brian,
> >>
> >> this file is anebled, but I still get errors like this in the audit log:
> >>
> >> --650c7926-A--
> >> [19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
> >> --650c7926-B--
> >> OPTIONS * HTTP/1.0
> >> User-Agent: mysite (internal dummy connection)
> >>
> >> --650c7926-F--
> >> HTTP/1.1 400 Bad Request
> >> Vary: accept-language,accept-charset
> >> Accept-Ranges: bytes
> >> Connection: close
> >> Content-Type: text/html; charset=iso-8859-1
> >> Content-Language: en
> >> Expires: Mon, 19 Oct 2009 17:05:16 GMT
> >>
> >> --650c7926-H--
> >> Message:  [file
> >>
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> >> [line "35"] [id "960008"] [msg "Re
> >> quest Missing a Host Header"] [severity "WARNING"] [tag
> >> "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase
> >> 2).
> >> Oper
> >> ator EQ matched 0 at REQUEST_HEADERS.
> >> Message:  [file
> >>
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> >> [line "41"] [msg "Transactional Anomaly Score
> >>  (score 5): Request Missing a Host Header"] Warning. Operator GE matched
> 5
> >> at TX:anomaly_score.
> >> Action: Intercepted (phase 2)
> >> Apache-Handler: type-map
> >> Stopwatch: 1255971916688261 2329 (568 1401 -)
> >> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
> core
> >> ruleset/2.0.1; core ruleset/2.0.1.
> >> Server: Apache/2.2.3 (Red Hat)
> >>
> >> --650c7926-Z--
> >>
> >> Thanks,
> >>
> >> Lucas
> >>
> >> On Mon, Oct 19, 2009 at 16:22, Brian Rectanus
> >> <Brian.Rectanus at breach.com>wrote:
> >>
> >>>  Lucas Ferreira wrote:
> >>>
> >>>> Hello,
> >>>>
> >>>> I am using CRS 2.0.1 and am getting messagens like these in error_log
> >>>> several times a day:
> >>>>
> >>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
> >>>> [file
> >>>>
> >>>>
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
> >>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
> >>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
> >>>> [file
> >>>>
> >>>>
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
> Missing
> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
> [unique_id
> >>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
> >>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
> >>>> [file
> >>>>
> >>>>
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
> >>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
> >>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
> >>>> [file
> >>>>
> >>>>
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
> Missing
> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
> [unique_id
> >>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
> >>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
> >>>> [file
> >>>>
> >>>>
> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
> >>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
> >>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
> >>>> [file
> >>>>
> >>>>
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
> Missing
> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
> [unique_id
> >>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
> >>>>
> >>>> In older rule sets, I made some rules to ruleRemoveById in requests
> from
> >>>> localhost with the dummy user agent. Is this the best way to go or is
> >>>> there a more elegant solution?
> >>>>
> >>>>
> >>>  make sure you have enabled this file which has the exceptions for the
> >>> dummy connection in it:
> >>>
> >>> base_rules/modsecurity_crs_47_common_exceptions.conf
> >>>
> >>> -B
> >>>
> >>> --
> >>> Brian Rectanus
> >>> Breach Security
> >>>
> >>
> >>
> >>
> >> --
> >> If a tree falls in the forest and no one is around to see it, do the
> other
> >> trees make fun of it?
> >>
> >
> >
> >
> > --
> > If a tree falls in the forest and no one is around to see it, do the
> other
> > trees make fun of it?
> >
>
> --
> Sent from my mobile device
>
> Ryan C. Barnett
> WASC Distributed Open Proxy Honeypot Project Leader
> OWASP ModSecurity Core Rule Set Project Leader
> Tactical Web Application Security
> http://tacticalwebappsec.blogspot.com/
>



-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091020/9adf0af2/attachment.html 

From Ryan.Barnett at breach.com  Tue Oct 20 11:30:14 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Tue, 20 Oct 2009 11:30:14 -0400
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
 conections
In-Reply-To: <245770850910200802t130f796ao18470a8a9e2c6223@mail.gmail.com>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com>
	<4ADCAE80.4070402@breach.com>
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com>
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net>
	<245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com>
	<cba0286a0910191703i263f1b25j9c1dcb980ea3a507@mail.gmail.com>,
	<245770850910200802t130f796ao18470a8a9e2c6223@mail.gmail.com>
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7294ACE@MONET.utopiasystems.net>

Looks like the "block" action is missing.  We will update this in our rules and it will be fixed in the next release.

Please update your rules like this -

SecMarker BEGIN_HOST_CHECK

        SecRule &REQUEST_HEADERS:Host "@eq 0" \
                "skipAfter:END_HOST_CHECK,phase:2,t:none,block,nolog,auditlog,msg:'Request Missing a Host Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
:tx.%{rule.id<http://rule.id>}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
        SecRule REQUEST_HEADERS:Host "^$" \
                "phase:2,t:none,block,nolog,auditlog,msg:'Request Missing a Host Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{rule.id<http://rule.id>}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"

SecMarker END_HOST_CHECK

________________________________
From: lucas.ferreira at gmail.com [lucas.ferreira at gmail.com] On Behalf Of Lucas Ferreira [listas at sapao.net]
Sent: Tuesday, October 20, 2009 11:02 AM
To: Ryan Barnett
Cc: Ryan Barnett; Brian Rectanus; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy conections

Hello Ryan,

these are the rules, from file modsecurity_crs_21_protocol_anomalies.conf

SecMarker BEGIN_HOST_CHECK

        SecRule &REQUEST_HEADERS:Host "@eq 0" \
                "skipAfter:END_HOST_CHECK,phase:2,t:none,nolog,auditlog,msg:'Request Missing a Host Header',id:'960008',tag:'PROTOCOL_VI
OLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
:tx.%{rule.id<http://rule.id>}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
        SecRule REQUEST_HEADERS:Host "^$" \
                "phase:2,t:none,nolog,auditlog,msg:'Request Missing a Host Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{rule.id<http://rule.id>}-PROTOCOL_V
IOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"

SecMarker END_HOST_CHECK

Regards,

Lucas

On Mon, Oct 19, 2009 at 22:03, Ryan Barnett <rcbarnett at gmail.com<mailto:rcbarnett at gmail.com>> wrote:
Hmm... Can you paste in that specific protocol anomaly rule that
triggered?  There should be a block action.



On 10/19/09, Lucas Ferreira <listas at sapao.net<mailto:listas at sapao.net>> wrote:
> Hello Ryan,
>
> my SecDefaultAction is:
>
> SecDefaultAction "phase:2,pass"
>
> Regards,
>
> Lucas
>
> On Mon, Oct 19, 2009 at 18:46, Ryan Barnett <Ryan.Barnett at breach.com<mailto:Ryan.Barnett at breach.com>> wrote:
>
>>  The issue seems to be that you have updated the SecDefaultAction to deny
>> and issue a 400 status code.  If you set the SecDefaultAction to block
>> instead of the default of pass, then the rules are essentially working the
>> way they did > v2.  That is if a rule matches it will block.  You need to
>> have the SecDefaultAction set to pass so the block action in each rule
>> will
>> inherit this setting.
>>
>> In this case, that protocol anomaly rule is triggering and then denying
>> and
>> therefore the other rules (including the local exceptions file) does not
>> get
>> a chance to run.  Try setting the SecDefaultAction back to the default.
>> You
>> can then control blocking in the 49 enforcement file - based on the
>> anomaly
>> score.
>>
>> -Ryan
>>  ------------------------------
>> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org> [
>> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>] On Behalf Of
>> Lucas Ferreira [listas at sapao.net<mailto:listas at sapao.net>]
>> *Sent:* Monday, October 19, 2009 4:41 PM
>> *To:* Brian Rectanus
>> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
>> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
>> conections
>>
>>  Hello Brian,
>>
>> this file is anebled, but I still get errors like this in the audit log:
>>
>> --650c7926-A--
>> [19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
>> --650c7926-B--
>> OPTIONS * HTTP/1.0
>> User-Agent: mysite (internal dummy connection)
>>
>> --650c7926-F--
>> HTTP/1.1 400 Bad Request
>> Vary: accept-language,accept-charset
>> Accept-Ranges: bytes
>> Connection: close
>> Content-Type: text/html; charset=iso-8859-1
>> Content-Language: en
>> Expires: Mon, 19 Oct 2009 17:05:16 GMT
>>
>> --650c7926-H--
>> Message:  [file
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> [line "35"] [id "960008"] [msg "Re
>> quest Missing a Host Header"] [severity "WARNING"] [tag
>> "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase
>> 2).
>> Oper
>> ator EQ matched 0 at REQUEST_HEADERS.
>> Message:  [file
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> [line "41"] [msg "Transactional Anomaly Score
>>  (score 5): Request Missing a Host Header"] Warning. Operator GE matched 5
>> at TX:anomaly_score.
>> Action: Intercepted (phase 2)
>> Apache-Handler: type-map
>> Stopwatch: 1255971916688261 2329 (568 1401 -)
>> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/); core
>> ruleset/2.0.1; core ruleset/2.0.1.<http://2.0.1.>
>> Server: Apache/2.2.3 (Red Hat)
>>
>> --650c7926-Z--
>>
>> Thanks,
>>
>> Lucas
>>
>> On Mon, Oct 19, 2009 at 16:22, Brian Rectanus
>> <Brian.Rectanus at breach.com<mailto:Brian.Rectanus at breach.com>>wrote:
>>
>>>  Lucas Ferreira wrote:
>>>
>>>> Hello,
>>>>
>>>> I am using CRS 2.0.1 and am getting messagens like these in error_log
>>>> several times a day:
>>>>
>>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1] ModSecurity:
>>>> [file
>>>>
>>>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request Missing
>>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"] [unique_id
>>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>>>>
>>>> In older rule sets, I made some rules to ruleRemoveById in requests from
>>>> localhost with the dummy user agent. Is this the best way to go or is
>>>> there a more elegant solution?
>>>>
>>>>
>>>  make sure you have enabled this file which has the exceptions for the
>>> dummy connection in it:
>>>
>>> base_rules/modsecurity_crs_47_common_exceptions.conf
>>>
>>> -B
>>>
>>> --
>>> Brian Rectanus
>>> Breach Security
>>>
>>
>>
>>
>> --
>> If a tree falls in the forest and no one is around to see it, do the other
>> trees make fun of it?
>>
>
>
>
> --
> If a tree falls in the forest and no one is around to see it, do the other
> trees make fun of it?
>

--
Sent from my mobile device

Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com/



--
If a tree falls in the forest and no one is around to see it, do the other trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091020/dfac67d9/attachment-0001.html 

From listas at sapao.net  Tue Oct 20 11:37:06 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Tue, 20 Oct 2009 13:37:06 -0200
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7294ACE@MONET.utopiasystems.net>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com> 
	<4ADCAE80.4070402@breach.com>
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com> 
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net> 
	<245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com> 
	<cba0286a0910191703i263f1b25j9c1dcb980ea3a507@mail.gmail.com> 
	<245770850910200802t130f796ao18470a8a9e2c6223@mail.gmail.com> 
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294ACE@MONET.utopiasystems.net>
Message-ID: <245770850910200837q69502cf2vdcc06e3a3d2ccb1b@mail.gmail.com>

Ok. Thanks for your help.

Lucas

On Tue, Oct 20, 2009 at 13:30, Ryan Barnett <Ryan.Barnett at breach.com> wrote:

>  Looks like the "block" action is missing.  We will update this in our
> rules and it will be fixed in the next release.
>
> Please update your rules like this -
>
> SecMarker BEGIN_HOST_CHECK
>
>         SecRule &REQUEST_HEADERS:Host "@eq 0" \
>                 "skipAfter:END_HOST_CHECK,phase:2,t:none,*block*,nolog,auditlog,msg:'Request
> Missing a Host
> Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
> :tx.%{rule.id
> }-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>         SecRule REQUEST_HEADERS:Host "^$" \
>                 "phase:2,t:none,*block*,nolog,auditlog,msg:'Request
> Missing a Host Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
>
> everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{
> rule.id
> }-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>
> SecMarker END_HOST_CHECK
>
>  ------------------------------
> *From:* lucas.ferreira at gmail.com [lucas.ferreira at gmail.com] On Behalf Of
> Lucas Ferreira [listas at sapao.net]
> *Sent:* Tuesday, October 20, 2009 11:02 AM
> *To:* Ryan Barnett
> *Cc:* Ryan Barnett; Brian Rectanus;
> owasp-modsecurity-core-rule-set at lists.owasp.org
>
> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
> conections
>
>  Hello Ryan,
>
> these are the rules, from file modsecurity_crs_21_protocol_anomalies.conf
>
> SecMarker BEGIN_HOST_CHECK
>
>         SecRule &REQUEST_HEADERS:Host "@eq 0" \
>
> "skipAfter:END_HOST_CHECK,phase:2,t:none,nolog,auditlog,msg:'Request Missing
> a Host Header',id:'960008',tag:'PROTOCOL_VI
>
> OLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
> :tx.%{rule.id
> }-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>         SecRule REQUEST_HEADERS:Host "^$" \
>                 "phase:2,t:none,nolog,auditlog,msg:'Request Missing a Host
> Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
>
> everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{
> rule.id}-PROTOCOL_V
> IOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>
> SecMarker END_HOST_CHECK
>
> Regards,
>
> Lucas
>
> On Mon, Oct 19, 2009 at 22:03, Ryan Barnett <rcbarnett at gmail.com> wrote:
>
>> Hmm... Can you paste in that specific protocol anomaly rule that
>> triggered?  There should be a block action.
>>
>>
>>
>> On 10/19/09, Lucas Ferreira <listas at sapao.net> wrote:
>> > Hello Ryan,
>> >
>> > my SecDefaultAction is:
>> >
>> > SecDefaultAction "phase:2,pass"
>> >
>> > Regards,
>> >
>> > Lucas
>> >
>> > On Mon, Oct 19, 2009 at 18:46, Ryan Barnett <Ryan.Barnett at breach.com>
>> wrote:
>> >
>> >>  The issue seems to be that you have updated the SecDefaultAction to
>> deny
>> >> and issue a 400 status code.  If you set the SecDefaultAction to block
>> >> instead of the default of pass, then the rules are essentially working
>> the
>> >> way they did > v2.  That is if a rule matches it will block.  You need
>> to
>> >> have the SecDefaultAction set to pass so the block action in each rule
>> >> will
>> >> inherit this setting.
>> >>
>> >> In this case, that protocol anomaly rule is triggering and then denying
>> >> and
>> >> therefore the other rules (including the local exceptions file) does
>> not
>> >> get
>> >> a chance to run.  Try setting the SecDefaultAction back to the default.
>> >> You
>> >> can then control blocking in the 49 enforcement file - based on the
>> >> anomaly
>> >> score.
>> >>
>> >> -Ryan
>> >>  ------------------------------
>> >> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [
>> >> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of
>> >> Lucas Ferreira [listas at sapao.net]
>> >> *Sent:* Monday, October 19, 2009 4:41 PM
>> >> *To:* Brian Rectanus
>> >> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
>> >> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
>> >> conections
>> >>
>> >>  Hello Brian,
>> >>
>> >> this file is anebled, but I still get errors like this in the audit
>> log:
>> >>
>> >> --650c7926-A--
>> >> [19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
>> >> --650c7926-B--
>> >> OPTIONS * HTTP/1.0
>> >> User-Agent: mysite (internal dummy connection)
>> >>
>> >> --650c7926-F--
>> >> HTTP/1.1 400 Bad Request
>> >> Vary: accept-language,accept-charset
>> >> Accept-Ranges: bytes
>> >> Connection: close
>> >> Content-Type: text/html; charset=iso-8859-1
>> >> Content-Language: en
>> >> Expires: Mon, 19 Oct 2009 17:05:16 GMT
>> >>
>> >> --650c7926-H--
>> >> Message:  [file
>> >>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >> [line "35"] [id "960008"] [msg "Re
>> >> quest Missing a Host Header"] [severity "WARNING"] [tag
>> >> "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase
>> >> 2).
>> >> Oper
>> >> ator EQ matched 0 at REQUEST_HEADERS.
>> >> Message:  [file
>> >>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >> [line "41"] [msg "Transactional Anomaly Score
>> >>  (score 5): Request Missing a Host Header"] Warning. Operator GE
>> matched 5
>> >> at TX:anomaly_score.
>> >> Action: Intercepted (phase 2)
>> >> Apache-Handler: type-map
>> >> Stopwatch: 1255971916688261 2329 (568 1401 -)
>> >> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
>> core
>> >> ruleset/2.0.1; core ruleset/2.0.1.
>> >> Server: Apache/2.2.3 (Red Hat)
>> >>
>> >> --650c7926-Z--
>> >>
>> >> Thanks,
>> >>
>> >> Lucas
>> >>
>> >> On Mon, Oct 19, 2009 at 16:22, Brian Rectanus
>> >> <Brian.Rectanus at breach.com>wrote:
>> >>
>> >>>  Lucas Ferreira wrote:
>> >>>
>> >>>> Hello,
>> >>>>
>> >>>> I am using CRS 2.0.1 and am getting messagens like these in error_log
>> >>>> several times a day:
>> >>>>
>> >>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> >>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>> >>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
>> Missing
>> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
>> [unique_id
>> >>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>> >>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> >>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>> >>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
>> Missing
>> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
>> [unique_id
>> >>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>> >>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> >>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>> >>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
>> Missing
>> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
>> [unique_id
>> >>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>> >>>>
>> >>>> In older rule sets, I made some rules to ruleRemoveById in requests
>> from
>> >>>> localhost with the dummy user agent. Is this the best way to go or is
>> >>>> there a more elegant solution?
>> >>>>
>> >>>>
>> >>>  make sure you have enabled this file which has the exceptions for the
>> >>> dummy connection in it:
>> >>>
>> >>> base_rules/modsecurity_crs_47_common_exceptions.conf
>> >>>
>> >>> -B
>> >>>
>> >>> --
>> >>> Brian Rectanus
>> >>> Breach Security
>> >>>
>> >>
>> >>
>> >>
>> >> --
>> >> If a tree falls in the forest and no one is around to see it, do the
>> other
>> >> trees make fun of it?
>> >>
>> >
>> >
>> >
>> > --
>> > If a tree falls in the forest and no one is around to see it, do the
>> other
>> > trees make fun of it?
>> >
>>
>>  --
>> Sent from my mobile device
>>
>> Ryan C. Barnett
>> WASC Distributed Open Proxy Honeypot Project Leader
>> OWASP ModSecurity Core Rule Set Project Leader
>> Tactical Web Application Security
>> http://tacticalwebappsec.blogspot.com/
>>
>
>
>
> --
> If a tree falls in the forest and no one is around to see it, do the other
> trees make fun of it?
>



-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091020/c5af153e/attachment.html 

From listas at sapao.net  Tue Oct 20 11:50:50 2009
From: listas at sapao.net (Lucas Ferreira)
Date: Tue, 20 Oct 2009 13:50:50 -0200
Subject: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
	conections
In-Reply-To: <8A1B4B015C52A54886DF15E9A97C7FB9F7294ACE@MONET.utopiasystems.net>
References: <245770850910191009t1a4bf03cg37e1deac6b65a065@mail.gmail.com> 
	<4ADCAE80.4070402@breach.com>
	<245770850910191341t3b142848md21dda0d79f81e7a@mail.gmail.com> 
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294AC7@MONET.utopiasystems.net> 
	<245770850910191413x6c458ea2n9ffcf75451b473f3@mail.gmail.com> 
	<cba0286a0910191703i263f1b25j9c1dcb980ea3a507@mail.gmail.com> 
	<245770850910200802t130f796ao18470a8a9e2c6223@mail.gmail.com> 
	<8A1B4B015C52A54886DF15E9A97C7FB9F7294ACE@MONET.utopiasystems.net>
Message-ID: <245770850910200850nf69a732i50a3d9bf89ec23af@mail.gmail.com>

Hello Ryan,

it did not stop with this change. It only stopped when I added the following
rule before these rules:

#Local exception for Apache Dummy ConnectionSecRule REQUEST_LINE "^OPTIONS
\* HTTP/1.0$"
"chain,phase:2,t:none,pass,nolog,ctl:ruleRemoveById=960019,ctl:ruleRemoveById=960008,ctl:ru
leRemoveById=960015,ctl:ruleRemoveById=960009,id:'999211',severity:'5'"
SecRule REMOTE_ADDR "^127\.0\.0\.1$|^::1$" "chain,t:none"
SecRule REQUEST_HEADERS:User-Agent ".*\(internal dummy connection\)$"
"t:none"

This is probably not the best solution, but it works for me.

Regards,

Lucas

On Tue, Oct 20, 2009 at 13:30, Ryan Barnett <Ryan.Barnett at breach.com> wrote:

>  Looks like the "block" action is missing.  We will update this in our
> rules and it will be fixed in the next release.
>
> Please update your rules like this -
>
> SecMarker BEGIN_HOST_CHECK
>
>         SecRule &REQUEST_HEADERS:Host "@eq 0" \
>                 "skipAfter:END_HOST_CHECK,phase:2,t:none,*block*,nolog,auditlog,msg:'Request
> Missing a Host
> Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
> :tx.%{rule.id
> }-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>         SecRule REQUEST_HEADERS:Host "^$" \
>                 "phase:2,t:none,*block*,nolog,auditlog,msg:'Request
> Missing a Host Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
>
> everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{
> rule.id
> }-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>
> SecMarker END_HOST_CHECK
>
>  ------------------------------
> *From:* lucas.ferreira at gmail.com [lucas.ferreira at gmail.com] On Behalf Of
> Lucas Ferreira [listas at sapao.net]
> *Sent:* Tuesday, October 20, 2009 11:02 AM
> *To:* Ryan Barnett
> *Cc:* Ryan Barnett; Brian Rectanus;
> owasp-modsecurity-core-rule-set at lists.owasp.org
>
> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
> conections
>
>  Hello Ryan,
>
> these are the rules, from file modsecurity_crs_21_protocol_anomalies.conf
>
> SecMarker BEGIN_HOST_CHECK
>
>         SecRule &REQUEST_HEADERS:Host "@eq 0" \
>
> "skipAfter:END_HOST_CHECK,phase:2,t:none,nolog,auditlog,msg:'Request Missing
> a Host Header',id:'960008',tag:'PROTOCOL_VI
>
> OLATION/MISSING_HEADER',severity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar
> :tx.%{rule.id
> }-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>         SecRule REQUEST_HEADERS:Host "^$" \
>                 "phase:2,t:none,nolog,auditlog,msg:'Request Missing a Host
> Header',id:'960008',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',s
>
> everity:'5',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+5,setvar:tx.protocol_violation_score=+1,setvar:tx.%{
> rule.id}-PROTOCOL_V
> IOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}"
>
> SecMarker END_HOST_CHECK
>
> Regards,
>
> Lucas
>
> On Mon, Oct 19, 2009 at 22:03, Ryan Barnett <rcbarnett at gmail.com> wrote:
>
>> Hmm... Can you paste in that specific protocol anomaly rule that
>> triggered?  There should be a block action.
>>
>>
>>
>> On 10/19/09, Lucas Ferreira <listas at sapao.net> wrote:
>> > Hello Ryan,
>> >
>> > my SecDefaultAction is:
>> >
>> > SecDefaultAction "phase:2,pass"
>> >
>> > Regards,
>> >
>> > Lucas
>> >
>> > On Mon, Oct 19, 2009 at 18:46, Ryan Barnett <Ryan.Barnett at breach.com>
>> wrote:
>> >
>> >>  The issue seems to be that you have updated the SecDefaultAction to
>> deny
>> >> and issue a 400 status code.  If you set the SecDefaultAction to block
>> >> instead of the default of pass, then the rules are essentially working
>> the
>> >> way they did > v2.  That is if a rule matches it will block.  You need
>> to
>> >> have the SecDefaultAction set to pass so the block action in each rule
>> >> will
>> >> inherit this setting.
>> >>
>> >> In this case, that protocol anomaly rule is triggering and then denying
>> >> and
>> >> therefore the other rules (including the local exceptions file) does
>> not
>> >> get
>> >> a chance to run.  Try setting the SecDefaultAction back to the default.
>> >> You
>> >> can then control blocking in the 49 enforcement file - based on the
>> >> anomaly
>> >> score.
>> >>
>> >> -Ryan
>> >>  ------------------------------
>> >> *From:* owasp-modsecurity-core-rule-set-bounces at lists.owasp.org [
>> >> owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On Behalf Of
>> >> Lucas Ferreira [listas at sapao.net]
>> >> *Sent:* Monday, October 19, 2009 4:41 PM
>> >> *To:* Brian Rectanus
>> >> *Cc:* owasp-modsecurity-core-rule-set at lists.owasp.org
>> >> *Subject:* Re: [Owasp-modsecurity-core-rule-set] Blocking Apache dummy
>> >> conections
>> >>
>> >>  Hello Brian,
>> >>
>> >> this file is anebled, but I still get errors like this in the audit
>> log:
>> >>
>> >> --650c7926-A--
>> >> [19/Oct/2009:15:05:16 --0200] v-ErhX8AAAEAAEqfn2kAAACn ::1 53272 ::1 80
>> >> --650c7926-B--
>> >> OPTIONS * HTTP/1.0
>> >> User-Agent: mysite (internal dummy connection)
>> >>
>> >> --650c7926-F--
>> >> HTTP/1.1 400 Bad Request
>> >> Vary: accept-language,accept-charset
>> >> Accept-Ranges: bytes
>> >> Connection: close
>> >> Content-Type: text/html; charset=iso-8859-1
>> >> Content-Language: en
>> >> Expires: Mon, 19 Oct 2009 17:05:16 GMT
>> >>
>> >> --650c7926-H--
>> >> Message:  [file
>> >>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >> [line "35"] [id "960008"] [msg "Re
>> >> quest Missing a Host Header"] [severity "WARNING"] [tag
>> >> "PROTOCOL_VIOLATION/MISSING_HEADER"] Access denied with code 400 (phase
>> >> 2).
>> >> Oper
>> >> ator EQ matched 0 at REQUEST_HEADERS.
>> >> Message:  [file
>> >>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >> [line "41"] [msg "Transactional Anomaly Score
>> >>  (score 5): Request Missing a Host Header"] Warning. Operator GE
>> matched 5
>> >> at TX:anomaly_score.
>> >> Action: Intercepted (phase 2)
>> >> Apache-Handler: type-map
>> >> Stopwatch: 1255971916688261 2329 (568 1401 -)
>> >> Producer: ModSecurity for Apache/2.5.9 (http://www.modsecurity.org/);
>> core
>> >> ruleset/2.0.1; core ruleset/2.0.1.
>> >> Server: Apache/2.2.3 (Red Hat)
>> >>
>> >> --650c7926-Z--
>> >>
>> >> Thanks,
>> >>
>> >> Lucas
>> >>
>> >> On Mon, Oct 19, 2009 at 16:22, Brian Rectanus
>> >> <Brian.Rectanus at breach.com>wrote:
>> >>
>> >>>  Lucas Ferreira wrote:
>> >>>
>> >>>> Hello,
>> >>>>
>> >>>> I am using CRS 2.0.1 and am getting messagens like these in error_log
>> >>>> several times a day:
>> >>>>
>> >>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> >>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>> >>>> Oct 19 15:05:14 server httpd[19282]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
>> Missing
>> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
>> [unique_id
>> >>>> "v9KnRH8AAAEAAEtS7SUAAACo"]
>> >>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> >>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>> >>>> Oct 19 15:05:15 server httpd[19010]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
>> Missing
>> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
>> [unique_id
>> >>>> "v at HpNH8AAAEAAEpCcrMAAAAe"]
>> >>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/optional_rules/modsecurity_crs_21_protocol_anomalies.conf"]
>> >>>> [line "35"] [id "960008"] [msg "Request Missing a Host Header"]
>> >>>> [severity "WARNING"] [tag "PROTOCOL_VIOLATION/MISSING_HEADER"] Access
>> >>>> denied with code 400 (phase 2). Operator EQ matched 0 at
>> >>>> REQUEST_HEADERS. [hostname "server"] [uri "*"] [unique_id
>> >>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>> >>>> Oct 19 15:05:16 server httpd[19103]: [error] [client ::1]
>> ModSecurity:
>> >>>> [file
>> >>>>
>> >>>>
>> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
>> >>>> [line "41"] [msg "Transactional Anomaly Score (score 5): Request
>> Missing
>> >>>> a Host Header"] Warning. Operator GE matched 5 at TX:anomaly_score.
>> >>>> [hostname "server"] [uri "/error/HTTP_BAD_REQUEST.html.var"]
>> [unique_id
>> >>>> "v-ErhX8AAAEAAEqfn2kAAACn"]
>> >>>>
>> >>>> In older rule sets, I made some rules to ruleRemoveById in requests
>> from
>> >>>> localhost with the dummy user agent. Is this the best way to go or is
>> >>>> there a more elegant solution?
>> >>>>
>> >>>>
>> >>>  make sure you have enabled this file which has the exceptions for the
>> >>> dummy connection in it:
>> >>>
>> >>> base_rules/modsecurity_crs_47_common_exceptions.conf
>> >>>
>> >>> -B
>> >>>
>> >>> --
>> >>> Brian Rectanus
>> >>> Breach Security
>> >>>
>> >>
>> >>
>> >>
>> >> --
>> >> If a tree falls in the forest and no one is around to see it, do the
>> other
>> >> trees make fun of it?
>> >>
>> >
>> >
>> >
>> > --
>> > If a tree falls in the forest and no one is around to see it, do the
>> other
>> > trees make fun of it?
>> >
>>
>>  --
>> Sent from my mobile device
>>
>> Ryan C. Barnett
>> WASC Distributed Open Proxy Honeypot Project Leader
>> OWASP ModSecurity Core Rule Set Project Leader
>> Tactical Web Application Security
>> http://tacticalwebappsec.blogspot.com/
>>
>
>
>
> --
> If a tree falls in the forest and no one is around to see it, do the other
> trees make fun of it?
>



-- 
If a tree falls in the forest and no one is around to see it, do the other
trees make fun of it?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091020/78a9d936/attachment-0001.html 

From mesch.t at gmail.com  Wed Oct 28 06:56:37 2009
From: mesch.t at gmail.com (martin kapeundl)
Date: Wed, 28 Oct 2009 11:56:37 +0100
Subject: [Owasp-modsecurity-core-rule-set] Typo in
	modsecurity_crs_41_xss_attacks.conf (modsecurity-apache_2.5.10)
Message-ID: <4AE82365.4050609@gmail.com>

Hello!

I have sent this previously to security at modsecurity.org because I did 
not want to register - but I got no reply.

I think I may have found a typo in the 
modsecurity_crs_41_xss_attacks.conf file (modsecurity-apache_2.5.10)

modsecurity_crs_41_xss_attacks.conf: line 296:
SecRule REQUEST_URI_RAW|REQUEST_BODY 
"\bon(abort|blur|change|click|dblclick|dragdrop|error|\
focus|keydown|keypress|keyup|load|mousedown|mousemove|mouseout\
mouseover|mouseup|move|readystatechange|reset|resize|select|submit|unload)\b\W*?=" 
\

There should be a '|' operator between mouseout\mouseover, right?
I searched the bugtracker/mailinglist but did not find anything useful.

I hope this is of any use,
martin kapeundl

From Ryan.Barnett at breach.com  Wed Oct 28 08:35:29 2009
From: Ryan.Barnett at breach.com (Ryan Barnett)
Date: Wed, 28 Oct 2009 08:35:29 -0400
Subject: [Owasp-modsecurity-core-rule-set] Typo
	in	modsecurity_crs_41_xss_attacks.conf (modsecurity-apache_2.5.10)
Message-ID: <8A1B4B015C52A54886DF15E9A97C7FB9F7298EBC@MONET.utopiasystems.net>

Thanks for sending this along Martin and you are right.  We will get this fixed asap.

Bt the way - users can report these types of issues by creating proper Jira tickets in our tracker system -

https://www.modsecurity.org/tracker/

thanks.

Ryan C. Barnett
Director of Application Security Research
Breach Security, Inc.
Ryan.Barnett at Breach.com 
www.Breach.com 


----- Original Message -----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org <owasp-modsecurity-core-rule-set-bounces at lists.owasp.org>
To: owasp-modsecurity-core-rule-set at lists.owasp.org <owasp-modsecurity-core-rule-set at lists.owasp.org>
Sent: Wed Oct 28 06:56:37 2009
Subject: [Owasp-modsecurity-core-rule-set] Typo in	modsecurity_crs_41_xss_attacks.conf (modsecurity-apache_2.5.10)

Hello!

I have sent this previously to security at modsecurity.org because I did 
not want to register - but I got no reply.

I think I may have found a typo in the 
modsecurity_crs_41_xss_attacks.conf file (modsecurity-apache_2.5.10)

modsecurity_crs_41_xss_attacks.conf: line 296:
SecRule REQUEST_URI_RAW|REQUEST_BODY 
"\bon(abort|blur|change|click|dblclick|dragdrop|error|\
focus|keydown|keypress|keyup|load|mousedown|mousemove|mouseout\
mouseover|mouseup|move|readystatechange|reset|resize|select|submit|unload)\b\W*?=" 
\

There should be a '|' operator between mouseout\mouseover, right?
I searched the bugtracker/mailinglist but did not find anything useful.

I hope this is of any use,
martin kapeundl
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From Ryan.Barnett at breach.com  Fri Oct 30 12:47:42 2009
From: Ryan.Barnett at breach.com (Ryan Barnett (JIRA))
Date: Fri, 30 Oct 2009 09:47:42 -0700
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-16)
 rule 300016 incorrectly matches "selection" word
Message-ID: <16875175.1256921262824.JavaMail.tomcat@modsec-apps.colo.breach.com>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-16?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-16.
-----------------------------------

    Resolution: Won't Fix

This is not a CRS rule.  Based on the rule ID it appears to be a rule from GotRoot.  Please notify them here - mailman-owner at gotroot.com

> rule 300016 incorrectly matches "selection" word
> ------------------------------------------------
>
>                 Key: CORERULES-16
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-16
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>            Reporter: Mike Botsko
>            Assignee: Ryan Barnett
>
> Rule 300016, which was reporting in the apache error log as:
> (insert[[:space:]]+into.+values|select.*from.+[a-z|A-Z|0-9]|select.+from|bulk[[:space:]]+insert|union.+select|convert.+\(.*from)
> Was incorrectly matching this block of text:
> selection of side dishes made from seasonal greenmarket produce. Several ages and cuts of beef are on the menu at all times. Place also has a raw bar of the freshest oysters, raw fish preparations as well as marinated and chilled seafood.
> The combination of "selection" followed by "from" was causing the core of the issue. The regex should most likely only match the word "select" followed by a space, and then wildcard chars.

-- 
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira

        

