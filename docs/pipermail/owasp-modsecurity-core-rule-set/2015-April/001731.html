<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] False positives Web services
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20positives%20Web%20services&In-Reply-To=%3CDUB129-W44D474B97084E161D7D26882F00%40phx.gbl%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001730.html">
   <LINK REL="Next"  HREF="001732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] False positives Web services</H1>
    <B>Barry Pollard</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20positives%20Web%20services&In-Reply-To=%3CDUB129-W44D474B97084E161D7D26882F00%40phx.gbl%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] False positives Web services">barry_pollard at hotmail.com
       </A><BR>
    <I>Sat Apr  4 21:13:02 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001730.html">[Owasp-modsecurity-core-rule-set] False positives Web services
</A></li>
        <LI>Next message: <A HREF="001732.html">[Owasp-modsecurity-core-rule-set] False positives Web services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1731">[ date ]</a>
              <a href="thread.html#1731">[ thread ]</a>
              <a href="subject.html#1731">[ subject ]</a>
              <a href="author.html#1731">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I agree with Joshua that it's better to do this from within ModSecurity. This is because LocationMatch runs AFTER the phase 1 ModSecurity rules so that's the only option for adjusting phase 1 rules. Now this particular example is a phase 2 rule, however so LocationMatch should work but nice to be consistent so you don't have to worry about which phase the rule is for.

Joshua's suggestion is also better, as it only removes the request argument from the rule checking rather than turning it off completely for all arguments, cookies...etc.

Anyway, as it's a phase 2 rule, what you did should work if you wanted to do it that way. I suspect the reason it is not working in LocationMatch, is that you are removing the rule BEFORE it's been defined in the config:
<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRemoveById">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleRemoveById</A>
&quot;Note : This directive must be specified after the rule in which it is disabling. This should be used within local custom rule files that are processed after third party rule sets. Example file - modsecurity_crs_60_customrules.conf.&quot;
If you load the ModSecurity rules, and then do the LocationMatch it should work so check that. Still advise you do it Joshua's way though for the reasons given.&#160;

Thanks,
Barry

________________________________
&gt;<i> From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jroback at gmail.com</A> 
</I>&gt;<i> Date: Sat, 4 Apr 2015 20:49:44 +0000 
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A> 
</I>&gt;<i> Subject: Re: [Owasp-modsecurity-core-rule-set] False positives Web services 
</I>&gt;<i> 
</I>&gt;<i> This may be an older way to get the job done, but I typically would 
</I>&gt;<i> whitelist that specific Argument in a rule. 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> SecRule REQUEST_URI &quot;@beginsWith /webservice&quot; &quot;phase:1,t:none,t:lowercase,pass,nolog,ctl:ruleRemoveTargetById=950901;ARGS:request&quot; 
</I>&gt;<i> 
</I>&gt;<i> On Sat, Apr 4, 2015 at 1:49 AM Ilyass Kaouam 
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&gt;&gt; wrote: 
</I>&gt;<i> Hi, 
</I>&gt;<i> 
</I>&gt;<i> Wa have this request for a web service : 
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.mywebsite.com/webservice?request=%3Cxmlrequest%3E%3Cheader%3E%3Cutilisateur%3Exxx%3C/utilisateur%3E%3Cmotdepasse%3Exxx%3C/motdepasse%3E%3Crequete%3Esearch%3C/requete%3E%3Clangage%3EFR%3C/langage%3E%3Cpays%3Exx%3C/pays%3E%3C/header%3E%3Cbody%3E%3Cnbrparpage%3Exx%3C/nbrparpage%3E%3Cpage%3E2%3C/page%3E%3Ctyperecherche%3Exx%3C/typerecherche%3E%3C/body%3E%3C/xmlrequest%3E&lt;http://www.mywebsite.com/webservice?request=%3cxmlrequest%3e%3cheader%3e%3cutilisateur%3exxx%3c/utilisateur%3e%3cmotdepasse%3exxx%3c/motdepasse%3e%3crequete%3esearch%3c/requete%3e%3clangage%3eFR%3c/langage%3e%3cpays%3exx%3c/pays%3e%3c/header%3e%3cbody%3e%3cnbrparpage%3exx%3c/nbrparpage%3e%3cpage%3e2%3c/page%3e%3ctyperecherche%3exx%3c/typerecherche%3e%3c/body%3e%3c/xmlrequest%3e">http://www.mywebsite.com/webservice?request=%3Cxmlrequest%3E%3Cheader%3E%3Cutilisateur%3Exxx%3C/utilisateur%3E%3Cmotdepasse%3Exxx%3C/motdepasse%3E%3Crequete%3Esearch%3C/requete%3E%3Clangage%3EFR%3C/langage%3E%3Cpays%3Exx%3C/pays%3E%3C/header%3E%3Cbody%3E%3Cnbrparpage%3Exx%3C/nbrparpage%3E%3Cpage%3E2%3C/page%3E%3Ctyperecherche%3Exx%3C/typerecherche%3E%3C/body%3E%3C/xmlrequest%3E&lt;http://www.mywebsite.com/webservice?request=%3cxmlrequest%3e%3cheader%3e%3cutilisateur%3exxx%3c/utilisateur%3e%3cmotdepasse%3exxx%3c/motdepasse%3e%3crequete%3esearch%3c/requete%3e%3clangage%3eFR%3c/langage%3e%3cpays%3exx%3c/pays%3e%3c/header%3e%3cbody%3e%3cnbrparpage%3exx%3c/nbrparpage%3e%3cpage%3e2%3c/page%3e%3ctyperecherche%3exx%3c/typerecherche%3e%3c/body%3e%3c/xmlrequest%3e</A>&gt; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &#8203;mod_security forbidden this request log : 
</I>&gt;<i> 
</I>&gt;<i> &#8203; 
</I>&gt;<i> 
</I>&gt;<i> Message: Access denied with code 403 (phase 2). Pattern match 
</I>&gt;<i> &quot;(?i:([\\s'\&quot;`\xc2\xb4\xe2\x80\x99\xe2\x80\x98\\(\\)]*?)\\b([\\d\\w]++)([\\s'\&quot;`\xc2\xb4\xe2\x80\x99\xe2\x80\x98\\(\\)]*?)(?:(?:=|&lt;=&gt;|r?like|sounds\\s+like|regexp)([\\s'\&quot;`\xc2\xb4\xe2\x80\x99\xe2\x80\x98\\(\\)]*?)\\2\\b|(?:!=|&lt;=|&gt;=|&lt;&gt;|&lt;|&gt;|\\^|is\\s+not 
</I>&gt;<i> ...&quot; at ARGS:request. [file 
</I>&gt;<i> &quot;/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;] 
</I>&gt;<i> [line &quot;77&quot;] [id &quot;950901&quot;] [rev &quot;2&quot;] [msg &quot;SQL Injection Attack: SQL 
</I>&gt;<i> Tautology Detected.&quot;] [data &quot;Matched Data: utilisateur&gt; 
</I>&gt;<i> 
</I>&gt;<i> &#8203;xxxx 
</I>&gt;<i> found within ARGS:request: &lt;xmlrequest&gt;&lt;header&gt;&lt;utilisateur&gt; 
</I>&gt;<i> &#8203;xxxx 
</I>&gt;<i> &lt;/utilisateur&gt;&lt;motdepasse&gt; 
</I>&gt;<i> &#8203;xxxx 
</I>&gt;<i> &lt;/motdepasse&gt;&lt;requete&gt;search&lt;/requete&gt;&lt;langage&gt; 
</I>&gt;<i> &#8203;xx 
</I>&gt;<i> &lt;/langage&gt;&lt;pays&gt; 
</I>&gt;<i> &#8203;xxx 
</I>&gt;<i> &lt;/pays&gt;&lt;/header&gt;&lt;body&gt;&lt;nbrparpage&gt;10&lt;/nbrparpage&gt;&lt;page&gt;2&lt;/page&gt;&lt;typerecherche&gt; 
</I>&gt;<i> 
</I>&gt;<i> Action: Intercepted (phase 2) 
</I>&gt;<i> 
</I>&gt;<i> Apache-Handler: proxy-server 
</I>&gt;<i> 
</I>&gt;<i> Stopwatch: 1427968010902873 5141 (- - -) 
</I>&gt;<i> 
</I>&gt;<i> Stopwatch2: 1427968010902873 5141; combined=1880, p1=97, p2=1759, p3=0, 
</I>&gt;<i> p4=0, p5=24, sr=26, sw=0, l=0, gc=0 
</I>&gt;<i> 
</I>&gt;<i> Response-Body-Transformed: Dechunked 
</I>&gt;<i> 
</I>&gt;<i> Producer: ModSecurity for Apache/2.7.3 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); 
</I>&gt;<i> OWASP_CRS/2.2.9.&lt;<A HREF="http://2.2.9.">http://2.2.9.</A>&gt; 
</I>&gt;<i> 
</I>&gt;<i> Server: Apache 
</I>&gt;<i> 
</I>&gt;<i> Engine-Mode: &quot;ENABLED&quot; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &#8203;I tired : 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &lt;LocationMatch /webservice&gt; 
</I>&gt;<i> 
</I>&gt;<i> SecRuleRemoveByID 950901 
</I>&gt;<i> 
</I>&gt;<i> &lt;/LocationMatch&gt; &#8203; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &#8203;But I 
</I>&gt;<i> 'm afraid&#8203; 
</I>&gt;<i> &#8203; its not &#8203; 
</I>&gt;<i> Safely 
</I>&gt;<i> 
</I>&gt;<i> How I can allow my web services Safely 
</I>&gt;<i> 
</I>&gt;<i> &#8203; ? 
</I>&gt;<i> 
</I>&gt;<i> Thank you.&#8203; 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________ 
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt; 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________ 
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A> 
</I> 		 	   		  
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001730.html">[Owasp-modsecurity-core-rule-set] False positives Web services
</A></li>
	<LI>Next message: <A HREF="001732.html">[Owasp-modsecurity-core-rule-set] False positives Web services
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1731">[ date ]</a>
              <a href="thread.html#1731">[ thread ]</a>
              <a href="subject.html#1731">[ subject ]</a>
              <a href="author.html#1731">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
