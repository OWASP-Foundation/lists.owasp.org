From ryan.barnett at owasp.org  Tue Jul  2 15:52:32 2013
From: ryan.barnett at owasp.org (Ryan Barnett)
Date: Tue, 02 Jul 2013 11:52:32 -0400
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of OWASP
	ModSecurity CRS v2.2.8
Message-ID: <CDF86F80.AC12D%ryan.barnett@owasp.org>

CHANGES
========

== Version 2.2.8 - 06/30/2013 ==

Security Fixes:

Improvements:
* Updatd the /util directory structure
* Added scripts to check Rule ID duplicates
* Added script to remove v2.7 actions so older ModSecurity rules will work
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/43
* Added new PHP rule (958977) to detect PHP exploits (Plesk 0-day from king
cope)
  - http://seclists.org/fulldisclosure/2013/Jun/21
  - 
http://blog.spiderlabs.com/2013/06/honeypot-alert-active-exploits-attempts-f
or-plesk-vulnerability-.html


Bug Fixes:
* fix 950901 - word boundary added
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/48
* fix regex error
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/44
* Updated the Regex in 981244 to include word boundaries
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/36
* Problem with Regression Test (Invalid use of backslash) - Rule 960911 -
Test2
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/34
* ModSecurity: No action id present within the rule - ignore_static.conf
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/17
* "Bad robots" rule blocks all Java applets on Windows XP machines
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/16
* duplicated rules id 981173
  - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/18

Download links -
https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/master
https://github.com/SpiderLabs/owasp-modsecurity-crs/zipball/master

Release History -
https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Pro
ject#Release_History

-- 
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130702/73452995/attachment.html>

From sujan.one at gmail.com  Mon Jul  8 19:00:49 2013
From: sujan.one at gmail.com (sujan)
Date: Mon, 8 Jul 2013 15:00:49 -0400
Subject: [Owasp-modsecurity-core-rule-set] Regarding CORERULES-30
In-Reply-To: <CAPx69aWhFjXHRk7xLMykjQ_4c7xttO_TpLXj5cVFd7m43+9tpw@mail.gmail.com>
References: <CAPx69aWhFjXHRk7xLMykjQ_4c7xttO_TpLXj5cVFd7m43+9tpw@mail.gmail.com>
Message-ID: <CAPx69aUFsuyt7bP5QSzZP6M-XEqcMu32xM2ceAz0OQt4apLuSA@mail.gmail.com>

Resending, since the first email was sent before I subscribed to the list.

Thanks.


On Mon, Jul 8, 2013 at 2:58 PM, sujan <sujan.one at gmail.com> wrote:

> Hello,
>
> I was searching for a solution for the issue I am facing and came across
> this CORERULES-30<https://www.modsecurity.org/tracker/browse/CORERULES-30>(same
> issue I am facing)
> on https://www.modsecurity.org/tracker/browse/CORERULES-30
>
> I see the below comment by Ryan, but I am not sure where to add that and
> how.
>
> Can someone please answer my question?
>
>
> Ryan Barnett<https://www.modsecurity.org/tracker/secure/ViewProfile.jspa?name=rbarnett> added
> a comment - 25/Jan/10 6:34 AM
> Added the "application/xml" Content-Type to allowed list.Wil be fixed in
> next CRS rev.
>
>
>
>
> Thanks.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130708/5be35150/attachment.html>

From ryan.barnett at owasp.org  Mon Jul  8 19:11:19 2013
From: ryan.barnett at owasp.org (Ryan Barnett)
Date: Mon, 08 Jul 2013 15:11:19 -0400
Subject: [Owasp-modsecurity-core-rule-set] Regarding CORERULES-30
In-Reply-To: <CAPx69aUFsuyt7bP5QSzZP6M-XEqcMu32xM2ceAz0OQt4apLuSA@mail.gmail.com>
Message-ID: <CE00863D.AC9D2%ryan.barnett@owasp.org>

This has already been fixed in the OWASP CRS by updating the allowed
content-types in the 10 setup conf file -
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/modsecurity_
crs_10_setup.conf.example

#
# Set the following policy settings here and they will be propagated to the
30 rules
# file (modsecurity_crs_30_http_policy.conf) by using macro expansion.
# If you run into false positves, you can adjust the settings here.
#
SecAction \
  "id:'900012', \
  phase:1, \
  t:none, \
  setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \
  
setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded|mu
ltipart/form-data|text/xml|application/xml|application/x-amf|application/jso
n', \
  setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \
  setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/ .backup/ .bak/
.bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/
.dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/
.licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/
.resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/
.xsx/', \
  setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
/Content-Range/ /Translate/ /via/ /if/', \
  nolog, \
  pass"

This TX data is then used later in the 30 HTTP Policy file -
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules/m
odsecurity_crs_30_http_policy.conf ? using regular expression macro
expansion -

SecRule REQUEST_METHOD "!^(?:GET|HEAD|PROPFIND|OPTIONS)$"
"phase:1,chain,t:none,block,msg:'Request content type is not allowed by
policy',rev:'2',ver:'OWASP_CRS/2.2.8',maturity:'9',accuracy:'9',id:'960010',
tag:'OWASP_CRS/POLICY/ENCODING_NOT_ALLOWED',tag:'WASCTC/WASC-20',tag:'OWASP_
TOP_10/A1',tag:'OWASP_AppSensor/EE2',tag:'PCI/12.1',severity:'2',logdata:'%{
matched_var}'" 
	SecRule REQUEST_HEADERS:Content-Type "^([^;\s]+)" "chain,capture"
		SecRule TX:0 "!^%{tx.allowed_request_content_type}$"
"t:none,ctl:forceRequestBodyVariable=On,setvar:'tx.msg=%{rule.msg}',setvar:t
x.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-OWASP_CRS
/POLICY/CONTENT_TYPE_NOT_ALLOWED-%{matched_var_name}=%{matched_var}"

-Ryan


From:  sujan <sujan.one at gmail.com>
Date:  Monday, July 8, 2013 3:00 PM
To:  <owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject:  Re: [Owasp-modsecurity-core-rule-set] Regarding CORERULES-30

> Resending, since the first email was sent before I subscribed to the list.
> 
> Thanks.
> 
> 
> On Mon, Jul 8, 2013 at 2:58 PM, sujan <sujan.one at gmail.com> wrote:
>> Hello,
>> 
>> I was searching for a solution for the issue I am facing and came across this
>> CORERULES-30 <https://www.modsecurity.org/tracker/browse/CORERULES-30> (same
>> issue I am facing)
>> on https://www.modsecurity.org/tracker/browse/CORERULES-30
>> 
>> I see the below comment by Ryan, but I am not sure where to add that and how.
>> 
>> Can someone please answer my question?
>> 
>> 
>> Ryan Barnett 
>> <https://www.modsecurity.org/tracker/secure/ViewProfile.jspa?name=rbarnett>
>> added a comment - 25/Jan/10 6:34 AM
>> Added the "application/xml" Content-Type to allowed list.Wil be fixed in next
>> CRS rev.
>> 
>> 
>> 
>> 
>> Thanks.
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130708/f3384a5d/attachment.html>

From RBarnett at trustwave.com  Tue Jul  9 17:00:40 2013
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 9 Jul 2013 17:00:40 +0000
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Advanced Topic of the
 Week: Detecting Banking Trojan Page Modifications
Message-ID: <CE01B9F5.ACE8F%rbarnett@trustwave.com>

For those of you on these lists from the Finance sector who have to deal with banking trojans?.

http://blog.spiderlabs.com/2013/07/modsecurity-advanced-topic-of-the-week-detecting-banking-trojan-page-modifications.html

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130709/00e209f1/attachment.html>

From rp-modsec-crs-list at bev.net  Tue Jul 23 15:48:17 2013
From: rp-modsec-crs-list at bev.net (rp-modsec-crs-list at bev.net)
Date: Tue, 23 Jul 2013 11:48:17 -0400 (EDT)
Subject: [Owasp-modsecurity-core-rule-set] Anomaly scoring mode no longer
 blocks only on anomaly_score in CRS 2.2.8 ?
Message-ID: <Pine.LNX.4.64.1307231142310.27115@calloway>


In anomaly scoring mode, CRS 2.2.8 no longer blocks based only on tx.anomaly_score
exceeding the tx.inbound_anomaly_score_level.

Example:

- This rule worked on some previous CRS version. But, in 2.2.8, it does not block based on tx.anomaly_score:
SecRule REQUEST_URI "^/local/modsec/test$" "id:'10999',auditlog,block,msg:'LOCAL: modsec test',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.critical_anomaly_score}"

- Appending setvar:'tx.%{rule.id}-local-modsec-test=bad' to the above rule "fixes" that:
SecRule REQUEST_URI "^/local/modsec/test$" "id:'10999',auditlog,block,msg:'LOCAL: modsec test',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:'tx.%{rule.id}-local-modsec-test=bad'"


Here was the mod that changed the behavior to base_rules/modsecurity_crs_49_inbound_blocking.conf:
https://github.com/SpiderLabs/owasp-modsecurity-crs/commit/b054a4d92a00812b031facb3f81dd70e728ae8b3

So, is the fact that CRS 2.2.8 now longer really blocks based only on 
tx.anomaly_score an unintended consequence ?

-RP

