<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Restricted%20SQL%20Character%0A%20Anomaly%20Detection%20Alert%20and%20Roundcube%20mail&In-Reply-To=4E60E7E7.7060100%40domingo.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000860.html">
   <LINK REL="Next"  HREF="000868.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Restricted%20SQL%20Character%0A%20Anomaly%20Detection%20Alert%20and%20Roundcube%20mail&In-Reply-To=4E60E7E7.7060100%40domingo.dk"
       TITLE="[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail">RBarnett at trustwave.com
       </A><BR>
    <I>Fri Sep  2 12:48:39 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000860.html">[Owasp-modsecurity-core-rule-set] Restricted SQL Character	Anomaly	Detection Alert and Roundcube mail
</A></li>
        <LI>Next message: <A HREF="000868.html">[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#861">[ date ]</a>
              <a href="thread.html#861">[ thread ]</a>
              <a href="subject.html#861">[ subject ]</a>
              <a href="author.html#861">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can you try the SVN trunk version (v2.2.2)?

<A HREF="http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_">http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_</A>
rules/modsecurity_crs_41_sql_injection_attacks.conf

I tried your complete transaction and the same category of check triggered
for a Cookie value -

[Fri Sep 02 12:41:07 2011] [error] [client 127.0.0.1] ModSecurity:
Warning. Pattern match
&quot;([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&amp;\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\
\\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\&quot;\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\
\\\\\xe2\\x80\\x98\\\\`\\\\&lt;\\\\&gt;].*){6,}&quot; at
REQUEST_COOKIES:wp-settings-1. [file
&quot;/usr/local/apache/conf/crs/activated_rules/modsecurity_crs_41_sql_injectio
n_attacks.conf&quot;] [line &quot;521&quot;] [id &quot;981172&quot;] [rev &quot;2.2.2&quot;] [msg &quot;Restricted
SQL Character Anomaly Detection Alert - Total # of special characters
exceeded&quot;] [data &quot;=1&quot;] [hostname &quot;example.com&quot;] [uri &quot;/&quot;] [unique_id
&quot;TmEHIcCoqAEAALzcEnkAAAAI&quot;



That wp-settings-1 cookie payload decodes to -

wp-settings-1=editor=tinymce&amp;m4=o&amp;m0=o&amp;uploader=1

And the rule triggered on having a bunck of = and &amp; chars in it.

-Ryan


On 9/2/11 10:27 AM, &quot;Thomas D. Dahlmann&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">domingo at domingo.dk</A>&gt; wrote:

&gt;<i>Hi
</I>&gt;<i>
</I>&gt;<i>I've got the bellow shown exception when I try to hit my webmail site.
</I>&gt;<i>
</I>&gt;<i>What kind of &quot;bad&quot; characters is the rule complaining about in this
</I>&gt;<i>request?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--63235740-A--
</I>&gt;<i>[02/Sep/2011:15:59:55 +0200] TmDhWX8AAQEAAClL2qkAAAAJ x.x.x.x 28681
</I>&gt;<i>2.2.2.2 443
</I>&gt;<i>--63235740-B--
</I>&gt;<i>GET
</I>&gt;<i>/?_task=mail&amp;_remote=1&amp;_action=list&amp;_mbox=RoundCube&amp;_page=1&amp;_refresh=1&amp;_=1
</I>&gt;<i>314971993364&amp;_unlock=loading1314971993363
</I>&gt;<i>HTTP/1.1
</I>&gt;<i>Host: example.com
</I>&gt;<i>Connection: keep-alive
</I>&gt;<i>Referer: <A HREF="https://example.com/">https://example.com/</A>
</I>&gt;<i>X-Requested-With: XMLHttpRequest
</I>&gt;<i>User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.1 (KHTML,
</I>&gt;<i>like Gecko) Chrome/13.0.782.215 Safari/535.1
</I>&gt;<i>Accept: application/json, text/javascript, */*; q=0.01
</I>&gt;<i>X-Roundcube-Request: b7aa8fc451317a76730a72f69fbb3e9e
</I>&gt;<i>Accept-Encoding: gzip,deflate,sdch
</I>&gt;<i>Accept-Language: en-US,en;q=0.8
</I>&gt;<i>Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
</I>&gt;<i>Cookie: addressviewsplitter=250; prefsviewsplitter=195;
</I>&gt;<i>identviewsplitter=300; mailviewsplitter=291; sieverulesviewsplitter=245;
</I>&gt;<i>wp-settings-1=editor%3Dtinymce%26m4%3Do%26m0%3Do%26uploader%3D1;
</I>&gt;<i>wp-settings-time-1=1308940613; mailviewsplitterv=165;
</I>&gt;<i>roundcube_sessid=27cd4d0e05639619d9fa8684a6401300
</I>&gt;<i>
</I>&gt;<i>--63235740-F--
</I>&gt;<i>HTTP/1.1 200 OK
</I>&gt;<i>Expires: Fri, 02 Sep 2011 13:59:55 GMT
</I>&gt;<i>Cache-Control: private, no-cache, must-revalidate, post-check=0,
</I>&gt;<i>pre-check=0
</I>&gt;<i>Pragma: no-cache
</I>&gt;<i>Last-Modified: Fri, 02 Sep 2011 13:59:55 GMT
</I>&gt;<i>X-DNS-Prefetch-Control: off
</I>&gt;<i>Vary: Accept-Encoding
</I>&gt;<i>Content-Encoding: gzip
</I>&gt;<i>Content-Length: 1983
</I>&gt;<i>Keep-Alive: timeout=15, max=91
</I>&gt;<i>Connection: Keep-Alive
</I>&gt;<i>Content-Type: text/plain; charset=UTF-8
</I>&gt;<i>
</I>&gt;<i>--63235740-H--
</I>&gt;<i>Message: Operator GE matched 4 at TX:restricted_sqli_char_count. [file
</I>&gt;<i>&quot;/etc/apache2/modsecurity_crs/activated_rules/modsecurity_crs_41_sql_injec
</I>&gt;<i>tion_attacks.conf&quot;]
</I>&gt;<i>[line &quot;551&quot;] [id &quot;981173&quot;] [rev &quot;2.2.1&quot;] [msg &quot;Restricted SQL Character
</I>&gt;<i>Anomaly Detection Alert - Total # of special characters exceeded&quot;] [data
</I>&gt;<i>&quot;4&quot;]
</I>&gt;<i>Message: Warning. Operator LT matched 5 at TX:inbound_anomaly_score.
</I>&gt;<i>[file
</I>&gt;<i>&quot;/etc/apache2/modsecurity_crs/activated_rules/modsecurity_crs_60_correlati
</I>&gt;<i>on.conf&quot;]
</I>&gt;<i>[line &quot;33&quot;] [id &quot;981203&quot;] [msg &quot;Inbound Anomaly Score (Total Inbound
</I>&gt;<i>Score: 3, SQLi=5, XSS=): Restricted SQL Character Anomaly Detection
</I>&gt;<i>Alert - Total # of special characters exceeded&quot;]
</I>&gt;<i>Stopwatch: 1314971993379011 2207359 (- - -)
</I>&gt;<i>Stopwatch2: 1314971993379011 2207359; combined=125219, p1=1234,
</I>&gt;<i>p2=123185, p3=109, p4=385, p5=303, sr=387, sw=3, l=0, gc=0
</I>&gt;<i>Producer: ModSecurity for Apache/2.6.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;<i>core ruleset/2.2.1.
</I>&gt;<i>Server: Apache/2.2.14 (Ubuntu)
</I>&gt;<i>
</I>&gt;<i>--63235740-Z--
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>/Thomas
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000860.html">[Owasp-modsecurity-core-rule-set] Restricted SQL Character	Anomaly	Detection Alert and Roundcube mail
</A></li>
	<LI>Next message: <A HREF="000868.html">[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#861">[ date ]</a>
              <a href="thread.html#861">[ thread ]</a>
              <a href="subject.html#861">[ subject ]</a>
              <a href="author.html#861">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
