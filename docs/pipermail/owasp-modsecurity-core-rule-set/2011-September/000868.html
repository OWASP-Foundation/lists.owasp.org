<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Restricted%20SQL%20Character%0A%20Anomaly%20Detection%20Alert%20and%20Roundcube%20mail&In-Reply-To=CA868029.31680%25rbarnett%40trustwave.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000861.html">
   <LINK REL="Next"  HREF="000862.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail</H1>
    <B>Thomas D. Dahlmann</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Restricted%20SQL%20Character%0A%20Anomaly%20Detection%20Alert%20and%20Roundcube%20mail&In-Reply-To=CA868029.31680%25rbarnett%40trustwave.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail">domingo at domingo.dk
       </A><BR>
    <I>Mon Sep 12 16:25:45 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000861.html">[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail
</A></li>
        <LI>Next message: <A HREF="000862.html">[Owasp-modsecurity-core-rule-set] Bug in CRS 2.2.2 rule 960335?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#868">[ date ]</a>
              <a href="thread.html#868">[ thread ]</a>
              <a href="subject.html#868">[ subject ]</a>
              <a href="author.html#868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Just tried 2.2.2, still complaining:

--6e29976e-A--
[12/Sep/2011:22:20:57 +0200] Tm5pqH8AAQEAAD7NK34AAAAL 192.168.255.126 
39065 x.x.x.x 443
--6e29976e-B--
GET 
/?_task=mail&amp;_remote=1&amp;_action=check-recent&amp;_t=1315858856789&amp;_mbox=INBOX&amp;_list=1&amp;_=1315858856790&amp;_unlock=0 
HTTP/1.1
Host: example.com
Connection: keep-alive
Referer: <A HREF="https://example.com/?_task=mail">https://example.com/?_task=mail</A>
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/535.1 (KHTML, like 
Gecko) Chrome/13.0.782.220 Safari/535.1
Accept: application/json, text/javascript, */*; q=0.01
X-Roundcube-Request: 0f3bcbcd36d0e4e2c4eab5f23ccfc971
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: mailviewsplitterv=165; 
wp-settings-1=editor%3Dtinymce%26m4%3Do%26m0%3Do%26uploader%3D1; 
wp-settings-time-1=1314128296; 
roundcube_sessid=1b7ae7d350aca9dcc89493a63a2dbd24

--6e29976e-F--
HTTP/1.1 200 OK
Expires: Mon, 12 Sep 2011 20:20:57 GMT
Cache-Control: private, no-cache, must-revalidate, post-check=0, pre-check=0
Pragma: no-cache
Last-Modified: Mon, 12 Sep 2011 20:20:57 GMT
X-DNS-Prefetch-Control: off
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 96
Keep-Alive: timeout=15, max=100
Connection: Keep-Alive
Content-Type: text/plain; charset=UTF-8

--6e29976e-H--
Message: Pattern match 
&quot;([\\~\\!\\@\\#\\$\\%\\^\\&amp;\\*\\(\\)\\-\\+\\=\\{\\}\\[\\]\\|\\:\\;\&quot;\\'\\\xc2\xb4\\\xe2\x80\x99\\\xe2\x80\x98\\`\\&lt;\\&gt;].*){6,}&quot; 
at REQUEST_COOKIES:wp-settings-1. [file 
&quot;/etc/apache2/modsecurity_crs/activated_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;] 
[line &quot;521&quot;] [id &quot;981172&quot;] [rev &quot;2.2.2&quot;] [msg &quot;Restricted SQL Character 
Anomaly Detection Alert - Total # of special characters exceeded&quot;] [data 
&quot;=1&quot;]
Message: Warning. Operator LT matched 5 at TX:inbound_anomaly_score. 
[file 
&quot;/etc/apache2/modsecurity_crs/activated_rules/modsecurity_crs_60_correlation.conf&quot;] 
[line &quot;33&quot;] [id &quot;981203&quot;] [msg &quot;Inbound Anomaly Score (Total Inbound 
Score: 3, SQLi=1, XSS=): Restricted SQL Character Anomaly Detection 
Alert - Total # of special characters exceeded&quot;]
Stopwatch: 1315858856891692 385196 (- - -)
Stopwatch2: 1315858856891692 385196; combined=80816, p1=844, p2=79444, 
p3=11, p4=197, p5=317, sr=305, sw=3, l=0, gc=0
Producer: ModSecurity for Apache/2.6.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); 
core ruleset/2.2.2.
Server: Apache/2.2.14 (Ubuntu)

--6e29976e-Z--

/Thomas

On 2011-09-02 18:48, Ryan Barnett wrote:
&gt;<i> Can you try the SVN trunk version (v2.2.2)?
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_">http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_</A>
</I>&gt;<i> rules/modsecurity_crs_41_sql_injection_attacks.conf
</I>&gt;<i>
</I>&gt;<i> I tried your complete transaction and the same category of check triggered
</I>&gt;<i> for a Cookie value -
</I>&gt;<i>
</I>&gt;<i> [Fri Sep 02 12:41:07 2011] [error] [client 127.0.0.1] ModSecurity:
</I>&gt;<i> Warning. Pattern match
</I>&gt;<i> &quot;([\\\\~\\\\!\\\\@\\\\#\\\\$\\\\%\\\\^\\\\&amp;\\\\*\\\\(\\\\)\\\\-\\\\+\\\\=\\
</I>&gt;<i> \\{\\\\}\\\\[\\\\]\\\\|\\\\:\\\\;\\&quot;\\\\'\\\\\\xc2\\xb4\\\\\\xe2\\x80\\x99\
</I>&gt;<i> \\\\\xe2\\x80\\x98\\\\`\\\\&lt;\\\\&gt;].*){6,}&quot; at
</I>&gt;<i> REQUEST_COOKIES:wp-settings-1. [file
</I>&gt;<i> &quot;/usr/local/apache/conf/crs/activated_rules/modsecurity_crs_41_sql_injectio
</I>&gt;<i> n_attacks.conf&quot;] [line &quot;521&quot;] [id &quot;981172&quot;] [rev &quot;2.2.2&quot;] [msg &quot;Restricted
</I>&gt;<i> SQL Character Anomaly Detection Alert - Total # of special characters
</I>&gt;<i> exceeded&quot;] [data &quot;=1&quot;] [hostname &quot;example.com&quot;] [uri &quot;/&quot;] [unique_id
</I>&gt;<i> &quot;TmEHIcCoqAEAALzcEnkAAAAI&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> That wp-settings-1 cookie payload decodes to -
</I>&gt;<i>
</I>&gt;<i> wp-settings-1=editor=tinymce&amp;m4=o&amp;m0=o&amp;uploader=1
</I>&gt;<i>
</I>&gt;<i> And the rule triggered on having a bunck of = and&amp;  chars in it.
</I>&gt;<i>
</I>&gt;<i> -Ryan
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 9/2/11 10:27 AM, &quot;Thomas D. Dahlmann&quot;&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">domingo at domingo.dk</A>&gt;  wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I've got the bellow shown exception when I try to hit my webmail site.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What kind of &quot;bad&quot; characters is the rule complaining about in this
</I>&gt;&gt;<i> request?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --63235740-A--
</I>&gt;&gt;<i> [02/Sep/2011:15:59:55 +0200] TmDhWX8AAQEAAClL2qkAAAAJ x.x.x.x 28681
</I>&gt;&gt;<i> 2.2.2.2 443
</I>&gt;&gt;<i> --63235740-B--
</I>&gt;&gt;<i> GET
</I>&gt;&gt;<i> /?_task=mail&amp;_remote=1&amp;_action=list&amp;_mbox=RoundCube&amp;_page=1&amp;_refresh=1&amp;_=1
</I>&gt;&gt;<i> 314971993364&amp;_unlock=loading1314971993363
</I>&gt;&gt;<i> HTTP/1.1
</I>&gt;&gt;<i> Host: example.com
</I>&gt;&gt;<i> Connection: keep-alive
</I>&gt;&gt;<i> Referer: <A HREF="https://example.com/">https://example.com/</A>
</I>&gt;&gt;<i> X-Requested-With: XMLHttpRequest
</I>&gt;&gt;<i> User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.1 (KHTML,
</I>&gt;&gt;<i> like Gecko) Chrome/13.0.782.215 Safari/535.1
</I>&gt;&gt;<i> Accept: application/json, text/javascript, */*; q=0.01
</I>&gt;&gt;<i> X-Roundcube-Request: b7aa8fc451317a76730a72f69fbb3e9e
</I>&gt;&gt;<i> Accept-Encoding: gzip,deflate,sdch
</I>&gt;&gt;<i> Accept-Language: en-US,en;q=0.8
</I>&gt;&gt;<i> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
</I>&gt;&gt;<i> Cookie: addressviewsplitter=250; prefsviewsplitter=195;
</I>&gt;&gt;<i> identviewsplitter=300; mailviewsplitter=291; sieverulesviewsplitter=245;
</I>&gt;&gt;<i> wp-settings-1=editor%3Dtinymce%26m4%3Do%26m0%3Do%26uploader%3D1;
</I>&gt;&gt;<i> wp-settings-time-1=1308940613; mailviewsplitterv=165;
</I>&gt;&gt;<i> roundcube_sessid=27cd4d0e05639619d9fa8684a6401300
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --63235740-F--
</I>&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;<i> Expires: Fri, 02 Sep 2011 13:59:55 GMT
</I>&gt;&gt;<i> Cache-Control: private, no-cache, must-revalidate, post-check=0,
</I>&gt;&gt;<i> pre-check=0
</I>&gt;&gt;<i> Pragma: no-cache
</I>&gt;&gt;<i> Last-Modified: Fri, 02 Sep 2011 13:59:55 GMT
</I>&gt;&gt;<i> X-DNS-Prefetch-Control: off
</I>&gt;&gt;<i> Vary: Accept-Encoding
</I>&gt;&gt;<i> Content-Encoding: gzip
</I>&gt;&gt;<i> Content-Length: 1983
</I>&gt;&gt;<i> Keep-Alive: timeout=15, max=91
</I>&gt;&gt;<i> Connection: Keep-Alive
</I>&gt;&gt;<i> Content-Type: text/plain; charset=UTF-8
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --63235740-H--
</I>&gt;&gt;<i> Message: Operator GE matched 4 at TX:restricted_sqli_char_count. [file
</I>&gt;&gt;<i> &quot;/etc/apache2/modsecurity_crs/activated_rules/modsecurity_crs_41_sql_injec
</I>&gt;&gt;<i> tion_attacks.conf&quot;]
</I>&gt;&gt;<i> [line &quot;551&quot;] [id &quot;981173&quot;] [rev &quot;2.2.1&quot;] [msg &quot;Restricted SQL Character
</I>&gt;&gt;<i> Anomaly Detection Alert - Total # of special characters exceeded&quot;] [data
</I>&gt;&gt;<i> &quot;4&quot;]
</I>&gt;&gt;<i> Message: Warning. Operator LT matched 5 at TX:inbound_anomaly_score.
</I>&gt;&gt;<i> [file
</I>&gt;&gt;<i> &quot;/etc/apache2/modsecurity_crs/activated_rules/modsecurity_crs_60_correlati
</I>&gt;&gt;<i> on.conf&quot;]
</I>&gt;&gt;<i> [line &quot;33&quot;] [id &quot;981203&quot;] [msg &quot;Inbound Anomaly Score (Total Inbound
</I>&gt;&gt;<i> Score: 3, SQLi=5, XSS=): Restricted SQL Character Anomaly Detection
</I>&gt;&gt;<i> Alert - Total # of special characters exceeded&quot;]
</I>&gt;&gt;<i> Stopwatch: 1314971993379011 2207359 (- - -)
</I>&gt;&gt;<i> Stopwatch2: 1314971993379011 2207359; combined=125219, p1=1234,
</I>&gt;&gt;<i> p2=123185, p3=109, p4=385, p5=303, sr=387, sw=3, l=0, gc=0
</I>&gt;&gt;<i> Producer: ModSecurity for Apache/2.6.1 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;&gt;<i> core ruleset/2.2.1.
</I>&gt;&gt;<i> Server: Apache/2.2.14 (Ubuntu)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --63235740-Z--
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> /Thomas
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</I>&gt;<i>
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000861.html">[Owasp-modsecurity-core-rule-set] Restricted SQL Character Anomaly Detection Alert and Roundcube mail
</A></li>
	<LI>Next message: <A HREF="000862.html">[Owasp-modsecurity-core-rule-set] Bug in CRS 2.2.2 rule 960335?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#868">[ date ]</a>
              <a href="thread.html#868">[ thread ]</a>
              <a href="subject.html#868">[ subject ]</a>
              <a href="author.html#868">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
