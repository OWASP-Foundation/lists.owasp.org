<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20ipMatch%20and%20X-Forwarded-For&In-Reply-To=%3CD2FE88CD.22D7C%25bridavis%40cisco.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002032.html">
   <LINK REL="Next"  HREF="002034.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For</H1>
    <B>Brian Davis (bridavis)</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20ipMatch%20and%20X-Forwarded-For&In-Reply-To=%3CD2FE88CD.22D7C%25bridavis%40cisco.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For">bridavis at cisco.com
       </A><BR>
    <I>Fri Mar  4 08:36:30 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002032.html">[Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For
</A></li>
        <LI>Next message: <A HREF="002034.html">[Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2033">[ date ]</a>
              <a href="thread.html#2033">[ thread ]</a>
              <a href="subject.html#2033">[ subject ]</a>
              <a href="author.html#2033">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can I use &quot;@ipMatchFromFile &lt;file&gt;&quot; against REQUEST_HEADER:X-Forwarded-For? I didn't think this was possible.

From: Leos Rivas Manuel &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Manuel.LeosRivas at gemalto.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Manuel.LeosRivas at gemalto.com</A>&gt;&gt;
Date: Friday, March 4, 2016 at 12:33 AM
To: &quot;Brian A. Davis&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">bridavis at cisco.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">bridavis at cisco.com</A>&gt;&gt;, &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: RE: ipMatch and X-Forwarded-For

You don't need to modify the remote_address, simply use header:x-forwarded-for instead and deny if it matches.

From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&gt; [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf Of Brian Davis (bridavis)
Sent: vendredi 4 mars 2016 08:55
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: [Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For

Hello,

I have ModSecurity running as a reverse proxy behind an haproxy LB. Because we're behind HAProxy, we're getting LB IP addresses for REMOTE_ADDR.

I have a large number of IPs that I have to whitelist, and would therefore really take advantage of the ipMatch and ipMatchFromFile functions. However, those can only be used on REMOTE_ADDR.

Does anyone have a creative way of taking the X-Forwarded-For value and somehow setting REMOTE_ADDR to that, and then using ipMatch on the result?

Thanks,
Brian

________________________________
This message and any attachments are intended solely for the addressees and may contain confidential information. Any unauthorized use or disclosure, either whole or partial, is prohibited.
E-mails are susceptible to alteration. Our company shall not be liable for the message if altered, changed or falsified. If you are not the intended recipient of this message, please delete it and notify the sender.
Although all reasonable efforts have been made to keep this transmission free from viruses, the sender will not be liable for damages caused by a transmitted virus.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160304/f4a5bcbf/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160304/f4a5bcbf/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002032.html">[Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For
</A></li>
	<LI>Next message: <A HREF="002034.html">[Owasp-modsecurity-core-rule-set] ipMatch and X-Forwarded-For
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2033">[ date ]</a>
              <a href="thread.html#2033">[ thread ]</a>
              <a href="subject.html#2033">[ subject ]</a>
              <a href="author.html#2033">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
