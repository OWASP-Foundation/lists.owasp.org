<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Help debugging a false	positive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Help%20debugging%20a%20false%0A%09positive&In-Reply-To=4c9cc6791003151603o2e76aec5nc66ff4d9a688a0c2%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000334.html">
   <LINK REL="Next"  HREF="000336.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Help debugging a false	positive</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Help%20debugging%20a%20false%0A%09positive&In-Reply-To=4c9cc6791003151603o2e76aec5nc66ff4d9a688a0c2%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] Help debugging a false	positive">ryan.barnett at breach.com
       </A><BR>
    <I>Tue Mar 16 09:43:44 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000334.html">[Owasp-modsecurity-core-rule-set] Help debugging a false positive
</A></li>
        <LI>Next message: <A HREF="000336.html">[Owasp-modsecurity-core-rule-set] id &quot;970903&quot;] [msg &quot;ASP/JSP source	code leakage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#335">[ date ]</a>
              <a href="thread.html#335">[ thread ]</a>
              <a href="subject.html#335">[ subject ]</a>
              <a href="author.html#335">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Monday 15 March 2010 19:03:38 Chris Datfung wrote:
&gt;<i> I'm running the latest 2.0.6 CRS and every time I put the ruleset in
</I>&gt;<i> prevention mode various parts of my app stop working, but I can't seem to
</I>&gt;<i> debug exactly what's wrong. 
</I>
When you say &quot;put the ruleset in prevent mode&quot; you mean that you changed the disruptive 
action in the SecDefaultAction directive n the modsecurity_crs_10_config.conf file from pass 
to drop, correct?  This setting will be inherited by the anomaly scoring rules in the 
49/59 files that use the block action and by any rules that do not explicitly specify an 
action.  The last part is what is causing you problems, see below.

&gt;<i> For example, when I try to download an .iso
</I>&gt;<i> image the request is stopped. Below are sections B, H and K from the
</I>&gt;<i> generated event.
</I>&gt;<i> 
</I>&gt;<i> --c6541f33-B--
</I>&gt;<i> GET /image-1.6.iso HTTP/1.0
</I>&gt;<i> User-Agent: Opera/9.80 (X11; Linux i686; U; en) Presto/2.2.15 Version/10.10
</I>&gt;<i> Host: host.com
</I>&gt;<i> Accept: text/html, application/xml;q=0.9, application/xhtml+xml, image/png,
</I>&gt;<i> image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1
</I>&gt;<i> Accept-Language: en-US,en;q=0.9
</I>&gt;<i> Accept-Charset: iso-8859-1, utf-8, utf-16, *;q=0.1
</I>&gt;<i> Accept-Encoding: deflate, gzip, x-gzip, identity, *;q=0
</I>&gt;<i> Proxy-Connection: Keep-Alive
</I>&gt;<i> 
</I>&gt;<i> --c6541f33-H--
</I>&gt;<i> Message: Access denied with connection close (phase 1). String match
</I>&gt;<i> &quot;xxx.xxx.xxx.xxx&quot; at REMOTE_ADDR. [file &quot;/opt/modsecurity/etc/
</I>&gt;<i> www.host.com/rules.conf&quot;] [line &quot;5&quot;]
</I>&gt;<i> Action: Intercepted (phase 1)
</I>&gt;<i> Stopwatch: 1268690880578066 1617 (- - -)
</I>&gt;<i> Producer: ModSecurity for Apache/2.5.12 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); core
</I>&gt;<i> ruleset/2.0.6.
</I>&gt;<i> Server: Apache/2.2.9 mod_ssl/2.2.9 OpenSSL/0.9.8g
</I>&gt;<i> WebApp-Info: &quot;host&quot; &quot;-&quot; &quot;-&quot;
</I>&gt;<i> 
</I>&gt;<i> --c6541f33-K--
</I>&gt;<i> SecAction
</I>&gt;<i> &quot;phase:1,auditlog,t:none,pass,nolog,initcol:global=global,initcol:ip=%{remo
</I>&gt;<i> te_addr}&quot; SecAction
</I>&gt;<i> &quot;phase:1,auditlog,t:none,nolog,pass,setvar:tx.paranoid_mode=0&quot; SecAction
</I>&gt;<i> &quot;phase:1,auditlog,t:none,nolog,pass,setvar:tx.inbound_anomaly_score_level=2
</I>&gt;<i> 00&quot; SecAction
</I>&gt;<i> &quot;phase:1,auditlog,t:none,nolog,pass,setvar:tx.outbound_anomaly_score_level=
</I>&gt;<i> 200&quot; SecAction
</I>&gt;<i> &quot;phase:1,auditlog,t:none,nolog,pass,setvar:tx.critical_anomaly_score=20,set
</I>&gt;<i> var:tx.error_anomaly_score=15,setvar:tx.warning_anomaly_score=10,setvar:tx.
</I>&gt;<i> notice_anomaly_score=5&quot; SecAction
</I>&gt;<i> &quot;phase:1,auditlog,t:none,nolog,pass,setvar:tx.max_num_args=255&quot;
</I>&gt;<i> 
</I>&gt;<i> The rule at /opt/modsecurity/etc/www.host.com/rules.conf is:
</I>&gt;<i> 
</I>&gt;<i> SecRule REMOTE_ADDR &quot;@streq xxx.xxx.xxx.xxx&quot;
</I>&gt;<i> phase:1,ctl:ruleEngine=On,ctl:auditEngine=On,ctl:debugLogLevel=9
</I>&gt;<i> 
</I>
This looks like a custom rule that is not part of the CRS and it appears as though you 
intend to generate some debug logging based on the traffic of a specific client.  In this 
case, you want to make sure to always specify the proper action so that it does not 
inherit the SecDefaultAction (in this case of drop).  Update your SecRule above and 
include &quot;pass&quot; on it.

&gt;<i> finally the SecDefaultAction is set to: &quot;phase:2,drop&quot;
</I>&gt;<i> 
</I>&gt;<i> Any ideas what might be wrong?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i>  Chris
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000334.html">[Owasp-modsecurity-core-rule-set] Help debugging a false positive
</A></li>
	<LI>Next message: <A HREF="000336.html">[Owasp-modsecurity-core-rule-set] id &quot;970903&quot;] [msg &quot;ASP/JSP source	code leakage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#335">[ date ]</a>
              <a href="thread.html#335">[ thread ]</a>
              <a href="subject.html#335">[ subject ]</a>
              <a href="author.html#335">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
