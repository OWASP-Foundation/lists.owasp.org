<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Ha%3A%20%20Unknown%20blockage&In-Reply-To=OFF58571F7.B9392A85-ONC32576F1.006D0CEB-C32576F1.006EDC9F%40100.pfr.ru">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000347.html">
   <LINK REL="Next"  HREF="000349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Ha%3A%20%20Unknown%20blockage&In-Reply-To=OFF58571F7.B9392A85-ONC32576F1.006D0CEB-C32576F1.006EDC9F%40100.pfr.ru"
       TITLE="[Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage">ryan.barnett at breach.com
       </A><BR>
    <I>Thu Mar 25 16:27:52 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000347.html">[Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage
</A></li>
        <LI>Next message: <A HREF="000349.html">[Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#348">[ date ]</a>
              <a href="thread.html#348">[ thread ]</a>
              <a href="subject.html#348">[ subject ]</a>
              <a href="author.html#348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday 25 March 2010 16:10:53 Artyom Davidov wrote:
&gt;<i> &gt; Hi -
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'm upgrading from Core Rules 1.x to 2.0.6, and for the life of me I
</I>&gt;<i> &gt; can't figure out whats blocking a bunch of requests going to images,
</I>&gt;<i> &gt; css and auxilary files after I set my secdefaultaction from pass --&gt;
</I>&gt;<i> &gt; fail.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'm running modsec 2.5.12 on httpd 2.2.14 on redhat 4 in a proxy
</I>&gt;<i> &gt; situation.  Below is the audit log of a failed transaction.  I've
</I>&gt;<i> &gt; scrubbed some cookies, IPs and such.  Many of the rules that it
</I>&gt;<i> &gt; matched on don't make sense - for instance two seem to reference
</I>&gt;<i> &gt; content in my GET, but as you can see from the audit log - that is not
</I>&gt;<i> &gt; true.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; basically, I switch from SecDefaultAction &quot;phase:2,pass&quot; to
</I>&gt;<i> &gt; SecDefaultAction &quot;phase:2,deny&quot; and things blow up.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Thanks in advance.
</I>&gt;<i> 
</I>&gt;<i> [...skipped...]
</I>&gt;<i> 
</I>&gt;<i> &gt; SecRule &quot;RESPONSE_BODY&quot; &quot;!@pmFromFile modsecurity_50_outbound.data&quot;
</I>&gt;<i> &gt; &quot;phase:4,rev:2.0.6,t:none,capture,t:urlDecodeUni,t:htmlEntityDecode,
</I>&gt;<i> &gt; nolog,skipAfter:END_OUTBOUND_CHECK&quot;
</I>&gt;<i> 
</I>&gt;<i> Hmmm... Strange.
</I>&gt;<i> It seems that a part of the bug with id &quot;CORERULES-36&quot; is still in place.
</I>&gt;<i> Just checked modsecurity_crs_50_outbound.conf and it looks like it's still
</I>&gt;<i> missing default action in this rule. We've got the same behaviour with
</I>&gt;<i> 2.0.5 rules until we've added a &quot;pass&quot; default action to this rule. So the
</I>&gt;<i> corrected rule should look like the following:
</I>&gt;<i> 
</I>&gt;<i> SecRule RESPONSE_BODY &quot;!@pmFromFile modsecurity_50_outbound.data&quot; \
</I>&gt;<i>        
</I>&gt;<i> &quot;phase:4,rev:'2.0.6',t:none,capture,t:urlDecodeUni,t:htmlEntityDecode,pass
</I>&gt;<i> ,nolog,skipAfter:END_OUTBOUND_CHECK&quot;
</I>&gt;<i> 
</I>&gt;<i> Strange though. Maybe Ryan can comment on this.
</I>&gt;<i> 
</I>
Your comments are correct in that those @pmFromFile prequalifier check rules were missing a 
disruptive action specification (in this case - pass) and they therefore inherited the 
default one set in SecDefaultAction.  I did fix these missing ones in the 50 outbound file 
in the source however they are not in CRS 2.0.6.  They will be in v2.0.7.  In the 
meantime, just manually add the &quot;pass&quot; action to those rules in the 50 file that have a 
ctl:skipAfter action.

-Ryan

-Ryan
&gt;<i> wbr
</I>&gt;<i> Artyom
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000347.html">[Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage
</A></li>
	<LI>Next message: <A HREF="000349.html">[Owasp-modsecurity-core-rule-set] Ha:  Unknown blockage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#348">[ date ]</a>
              <a href="thread.html#348">[ thread ]</a>
              <a href="subject.html#348">[ subject ]</a>
              <a href="author.html#348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
