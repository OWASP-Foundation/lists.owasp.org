<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [mod-security-users] CSRF	Protection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5Bmod-security-users%5D%20CSRF%0A%09Protection&In-Reply-To=4c9cc6791003230816n17aa99d3xc7a3ec440e873ca9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000337.html">
   <LINK REL="Next"  HREF="000340.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [mod-security-users] CSRF	Protection</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5Bmod-security-users%5D%20CSRF%0A%09Protection&In-Reply-To=4c9cc6791003230816n17aa99d3xc7a3ec440e873ca9%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] [mod-security-users] CSRF	Protection">ryan.barnett at breach.com
       </A><BR>
    <I>Tue Mar 23 11:24:14 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000337.html">[Owasp-modsecurity-core-rule-set] id &quot;970903&quot;] [msg &quot;ASP/JSP	source code leakage
</A></li>
        <LI>Next message: <A HREF="000340.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] CSRF	Protection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#338">[ date ]</a>
              <a href="thread.html#338">[ thread ]</a>
              <a href="subject.html#338">[ subject ]</a>
              <a href="author.html#338">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tuesday 23 March 2010 11:16:03 Chris Datfung wrote:
&gt;<i> I'm trying to implement CSRF protection in an app based on Ryan's example
</I>&gt;<i> from the WAF Patching Challenge Whitepaper. My app uses a dynamic session
</I>&gt;<i> token name where only the first four characters (SESS) are static. An
</I>&gt;<i> example cookie name is:
</I>&gt;<i> 
</I>&gt;<i> SESSbe7bfb0d134fa57e567359f4e62cf41d
</I>&gt;<i> 
</I>&gt;<i> The problem I have is how to implement this rule:
</I>&gt;<i> 
</I>&gt;<i> SecRule &amp;ARGS &quot;@ge 1&quot; &quot;chain,phase:2,t:none,deny,log,msg:'CSRF Attack
</I>&gt;<i> Detected - Invalid Token.'&quot;
</I>&gt;<i>  SecRule ARGS:MODSEC_CSRF_TOKEN &quot;!@streq %{request_cookies.jsessionid}&quot;
</I>&gt;<i> 
</I>&gt;<i> How do I compare MODSEC_CSRF_TOKEN to a cookie name where I only know the
</I>&gt;<i> the first four characters. I tried:
</I>&gt;<i> 
</I>&gt;<i> SecRule ARGS:MODSEC_CSRF_TOKEN &quot;!@streq %{request_cookies./^SESS/}
</I>&gt;<i> 
</I>&gt;<i> but that obviously didn't work. Any ideas how I can do this?
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i>   Chris
</I>
How appropriate as I was getting ready to send out some announcements soon that we will be 
migrating some of the commercial Enhanced Rule Set (ERS) items to the CRS and CSRF 
protection rules are one of them :)

Once I add these rules to the CRS, I will send a note to the OWASP CRS mail-list with 
usage info.

-Ryan
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000337.html">[Owasp-modsecurity-core-rule-set] id &quot;970903&quot;] [msg &quot;ASP/JSP	source code leakage
</A></li>
	<LI>Next message: <A HREF="000340.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] CSRF	Protection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#338">[ date ]</a>
              <a href="thread.html#338">[ thread ]</a>
              <a href="subject.html#338">[ subject ]</a>
              <a href="author.html#338">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
