<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;13,&nbsp;2013&nbsp;at&nbsp;3:37&nbsp;AM,&nbsp;conn.zhang&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:conn.zhang@dbappsecurity.com.cn&quot;&nbsp;target=&quot;_blank&quot;&gt;conn.zhang@dbappsecurity.com.cn&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;u&gt;&lt;/u&gt;<br>
<br>
<br>
<br>
<br>
<br>
&lt;div&nbsp;style=&quot;margin:10px&quot;&gt;<br>
&lt;div&gt;Hello,all!&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;Now,&nbsp;I&#39;m&nbsp;using&nbsp;SecHashKey&nbsp;SecParam&nbsp;and&nbsp;<br>
SecHashMethodRx&nbsp;variables&nbsp;set&nbsp;the&nbsp;cookies&nbsp;token.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;My&nbsp;rule&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt; &lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashEngine&nbsp;On&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashParam&nbsp;cookie_token&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashKey&nbsp;Rand&nbsp;SessionID&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashMethodRx&nbsp;HashLocation&nbsp;&quot;Set-Cookie2?&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecRule&nbsp;REQUEST_HEADERS&nbsp;&quot;@validate&nbsp;Hash&nbsp;Cookie&quot;&nbsp;<br>
\&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;&quot;phase:2,capture,t:none,block,ctl:HashEnforcement=On,log,auitlog,status:403,id:&#39;999900&#39;&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt; &lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;I&nbsp;don&#39;t&nbsp;see&nbsp;the&nbsp;token&nbsp;was&nbsp;set&nbsp;in&nbsp;cookie&nbsp;<br>
header.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Hi,&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;While&nbsp;this&nbsp;question&nbsp;isn&#39;t&nbsp;related&nbsp;to&nbsp;the&nbsp;core&nbsp;rule&nbsp;set,&nbsp;the&nbsp;HashLocation SecHashMethodRx&nbsp;type&nbsp;can&nbsp;only&nbsp;be&nbsp;used&nbsp;to&nbsp;sign&nbsp;the&nbsp;Location&nbsp;header&nbsp;in&nbsp;the&nbsp;response&nbsp;(not&nbsp;the&nbsp;Set-Cookie&nbsp;header).&nbsp;One&nbsp;way&nbsp;to&nbsp;sign&nbsp;the&nbsp;cookie&nbsp;would&nbsp;be&nbsp;to&nbsp;send&nbsp;the&nbsp;cookie&nbsp;value&nbsp;you&nbsp;want&nbsp;to&nbsp;sign&nbsp;to&nbsp;a&nbsp;Lua&nbsp;script&nbsp;that&nbsp;creates&nbsp;the&nbsp;hash,&nbsp;then&nbsp;use&nbsp;mod_headers&nbsp;to&nbsp;inject&nbsp;the&nbsp;hash&nbsp;back&nbsp;into&nbsp;the&nbsp;Set-Cookie&nbsp;header.&nbsp;You&nbsp;could&nbsp;then&nbsp;use&nbsp;a&nbsp;similar&nbsp;process&nbsp;to&nbsp;validate&nbsp;the&nbsp;hash&nbsp;value&nbsp;when&nbsp;the&nbsp;cookie&nbsp;is&nbsp;submitted&nbsp;by&nbsp;the&nbsp;client.&nbsp;For&nbsp;a&nbsp;somewhat&nbsp;similar&nbsp;example&nbsp;used&nbsp;to&nbsp;protect&nbsp;hidden&nbsp;input&nbsp;fields&nbsp;see:&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://blog.spiderlabs.com/2012/07/reducing-web-apps-attack-surface.html&quot;&gt;http://blog.spiderlabs.com/2012/07/reducing-web-apps-attack-surface.html&lt;/a&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;--&lt;/div&gt;&lt;div&nbsp;style&gt; -&nbsp;Josh&lt;/div&gt;<br>
&lt;div&gt; &lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;&lt;div&nbsp;style=&quot;margin:10px&quot;&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt; &lt;/div&gt;<br>
&lt;hr&nbsp;style=&quot;width:210px;min-height:1px&quot;&nbsp;align=&quot;left&quot;&nbsp;color=&quot;#b5c4df&quot;&nbsp;size=&quot;1&quot;&gt;<br>
<br>
&lt;div&gt;&lt;span&gt;DBAppSecurity&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;br&gt;_______________________________________________&lt;br&gt;<br>
Owasp-modsecurity-core-rule-set&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;Owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
