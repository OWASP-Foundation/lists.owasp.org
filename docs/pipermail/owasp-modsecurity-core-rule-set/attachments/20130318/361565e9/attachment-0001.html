<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=Windows-1252&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;word-wrap:break-word;&nbsp;color:rgb(0,0,0);&nbsp;font-size:14px;&nbsp;font-family:Calibri,sans-serif&quot;&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;span&nbsp;id=&quot;OLK_SRC_BODY_SECTION&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri;&nbsp;font-size:11pt;&nbsp;text-align:left;&nbsp;color:black;&nbsp;border-bottom:medium&nbsp;none;&nbsp;border-left:medium&nbsp;none;&nbsp;padding-bottom:0in;&nbsp;padding-left:0in;&nbsp;padding-right:0in;&nbsp;border-top:#b5c4df&nbsp;1pt&nbsp;solid;&nbsp;border-right:medium&nbsp;none;&nbsp;padding-top:3pt&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;From:&nbsp;&lt;/span&gt;&quot;conn.zhang&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:conn.zhang@dbappsecurity.com.cn&quot;&gt;conn.zhang@dbappsecurity.com.cn&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Reply-To:&nbsp;&lt;/span&gt;&quot;conn.zhang&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:conn.zhang@dbappsecurity.com.cn&quot;&gt;conn.zhang@dbappsecurity.com.cn&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Date:&nbsp;&lt;/span&gt;Tuesday,&nbsp;March&nbsp;12,&nbsp;2013&nbsp;9:37&nbsp;PM&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;To:&nbsp;&lt;/span&gt;owasp-modsecurity-core-rule-set&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;,&nbsp;owasp-modsecurity-core-rule-set&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;,<br>
&nbsp;owasp-modsecurity-core-rule-set&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;,&nbsp;owasp-modsecurity-core-rule-set&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;,<br>
&nbsp;owasp-modsecurity-core-rule-set&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;,&nbsp;owasp-modsecurity-core-rule-set&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Subject:&nbsp;&lt;/span&gt;[Owasp-modsecurity-core-rule-set]&nbsp;Using&nbsp;SecHashKey,&nbsp;SecParam,&nbsp;SecHashMethodRx&nbsp;set&nbsp;cookie&nbsp;token&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;blockquote&nbsp;id=&quot;MAC_OUTLOOK_ATTRIBUTION_BLOCKQUOTE&quot;&nbsp;style=&quot;border-left:#b5c4df&nbsp;5&nbsp;solid;&nbsp;padding:0&nbsp;0&nbsp;0&nbsp;5;&nbsp;margin:0&nbsp;0&nbsp;0&nbsp;5&quot;&gt;<br>
&lt;div&gt;&lt;style&gt;<br>
&lt;!--<br>
blockquote<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin-top:0px;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:0px;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-left:2em}<br>
ol<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin-top:0px;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:0px}<br>
ul<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin-top:0px;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:0px}<br>
p<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{margin-top:0px;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;margin-bottom:0px}<br>
--&gt;<br>
&lt;/style&gt;<br>
&lt;div&nbsp;style=&quot;margin:10px&quot;&gt;<br>
&lt;div&gt;Hello,all!&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;Now,&nbsp;I'm&nbsp;using&nbsp;SecHashKey&nbsp;SecParam&nbsp;and&nbsp;SecHashMethodRx&nbsp;variables&nbsp;set&nbsp;the&nbsp;cookies&nbsp;token.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;My&nbsp;rule&nbsp;looks&nbsp;like&nbsp;this:&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashEngine&nbsp;On&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashParam&nbsp;cookie_token&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashKey&nbsp;Rand&nbsp;SessionID&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecHashMethodRx&nbsp;HashLocation&nbsp;&quot;Set-Cookie2?&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;SecRule&nbsp;REQUEST_HEADERS&nbsp;&quot;@validate&nbsp;Hash&nbsp;Cookie&quot;&nbsp;\&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;&quot;phase:2,capture,t:none,block,ctl:HashEnforcement=On,log,auitlog,status:403,id:'999900'&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:2em&quot;&gt;I&nbsp;don't&nbsp;see&nbsp;the&nbsp;token&nbsp;was&nbsp;set&nbsp;in&nbsp;cookie&nbsp;header.&lt;/div&gt;<br>
&lt;div&nbsp;style=&quot;text-indent:4em&quot;&gt;&nbsp;&lt;/div&gt;<br>
&lt;hr&nbsp;align=&quot;left&quot;&nbsp;color=&quot;#b5c4df&quot;&nbsp;size=&quot;1&quot;&nbsp;style=&quot;width:210px;&nbsp;height:1px&quot;&gt;<br>
&lt;div&gt;&lt;span&gt;DBAppSecurity&lt;/span&gt;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/span&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;The&nbsp;SecHashEngine&nbsp;does&nbsp;not&nbsp;protect&nbsp;Cookies&nbsp;at&nbsp;this&nbsp;point.&nbsp;&nbsp;We&nbsp;have&nbsp;plans&nbsp;to&nbsp;add&nbsp;this&nbsp;capability.&nbsp;&nbsp;In&nbsp;the&nbsp;meantime,&nbsp;there&nbsp;are&nbsp;some&nbsp;options&nbsp;using&nbsp;SecRules.&nbsp;&nbsp;In&nbsp;&quot;Chapter&nbsp;8:&nbsp;Defending&nbsp;Session&nbsp;State:&nbsp;of&nbsp;my&nbsp;book&nbsp;-&nbsp;&lt;a&nbsp;href=&quot;http://www.wiley.com/WileyCDA/WileyTitle/productCd-1118362187.html&quot;&gt;http://www.wiley.com/WileyCDA/WileyTitle/productCd-1118362187.html&lt;/a&gt;&nbsp;–<br>
&nbsp;I&nbsp;cover&nbsp;this&nbsp;in&nbsp;Recipe&nbsp;82-:&nbsp;Detecting&nbsp;Cookie&nbsp;Tampering.&nbsp;&nbsp;&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;If&nbsp;you&nbsp;have&nbsp;already&nbsp;activated&nbsp;the&nbsp;OWASP&nbsp;CRS&nbsp;rules&nbsp;to&nbsp;create&nbsp;the&nbsp;Session&nbsp;Collection,&nbsp;you&nbsp;can&nbsp;use&nbsp;this&nbsp;rule&nbsp;to&nbsp;save&nbsp;the&nbsp;Set-Cookie&nbsp;data&nbsp;to&nbsp;the&nbsp;Session&nbsp;Collection&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;#&nbsp;-=[&nbsp;Save&nbsp;Set-Cookie&nbsp;Name/Value&nbsp;Pairs&nbsp;]=-&lt;/div&gt;<br>
&lt;div&gt;#&lt;/div&gt;<br>
&lt;div&gt;SecRule&nbsp;RESPONSE_HEADERS:/Set-Cookie2?/&nbsp;&quot;^(.*?)=(.*?);&quot;&nbsp;&quot;chain,phase:3,id:'981063',t:none,nolog,pass,capture,setvar:tx.cookie_name_counter=&#43;1,setvar:tx.cookie_name_%{tx.cookie_name_counter}=/%{tx.1}/,setvar:'session.cookie_list=%{session.cookie_list}&nbsp;%{tx.0}'&quot;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;/span&gt;SecRule&nbsp;SESSION:COOKIE_LIST&nbsp;&quot;.*&quot;&nbsp;&quot;t:trimLeft,setvar:session.cookie_list=%{matched_var}&quot;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;You&nbsp;can&nbsp;then&nbsp;validate&nbsp;Request&nbsp;Cookies&nbsp;with&nbsp;this&nbsp;rule&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;SecRule&nbsp;REQUEST_COOKIES&nbsp;&quot;.*&quot;&nbsp;&quot;chain,phase:1,id:'958233',t:none,block,msg:'Invalid&nbsp;Cookie&nbsp;Data&nbsp;Submitted.',logdata:'Cookie&nbsp;Data:&nbsp;%{matched_var}',tag:'OWASP_AppSensor/SE1',setvar:'tx.req_cookie_%{matched_var_name}=%{matched_var};'&quot;&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&lt;/span&gt;SecRule&nbsp;TX:/REQ_COOKIE_/&nbsp;&quot;!@within&nbsp;%{session.cookie_list}&quot;&nbsp;&quot;setvar:tx.cookie_name=%{tx.1},setvar:tx.anomaly_score=&#43;%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-WEB_ATTACK/INVALID_SESSIONID-%{matched_var_name}=%{tx.0}&quot;&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;Keep&nbsp;in&nbsp;mind&nbsp;that&nbsp;you&nbsp;may&nbsp;run&nbsp;into&nbsp;false&nbsp;positives&nbsp;if&nbsp;you&nbsp;site&nbsp;uses&nbsp;JS&nbsp;to&nbsp;create/modify&nbsp;Cookies.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;-Ryan&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;hr&gt;<br>
&lt;font&nbsp;face=&quot;Arial&quot;&nbsp;color=&quot;Gray&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;<br>
This&nbsp;transmission&nbsp;may&nbsp;contain&nbsp;information&nbsp;that&nbsp;is&nbsp;privileged,&nbsp;confidential,&nbsp;and/or&nbsp;exempt&nbsp;from&nbsp;disclosure&nbsp;under&nbsp;applicable&nbsp;law.&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;you&nbsp;are&nbsp;hereby&nbsp;notified&nbsp;that&nbsp;any&nbsp;disclosure,&nbsp;copying,&nbsp;distribution,&nbsp;or&nbsp;use&nbsp;of&nbsp;the&nbsp;information<br>
&nbsp;contained&nbsp;herein&nbsp;(including&nbsp;any&nbsp;reliance&nbsp;thereon)&nbsp;is&nbsp;STRICTLY&nbsp;PROHIBITED.&nbsp;If&nbsp;you&nbsp;received&nbsp;this&nbsp;transmission&nbsp;in&nbsp;error,&nbsp;please&nbsp;immediately&nbsp;contact&nbsp;the&nbsp;sender&nbsp;and&nbsp;destroy&nbsp;the&nbsp;material&nbsp;in&nbsp;its&nbsp;entirety,&nbsp;whether&nbsp;in&nbsp;electronic&nbsp;or&nbsp;hard&nbsp;copy&nbsp;format.&lt;br&gt;<br>
&lt;/font&gt;<br>
&lt;/body&gt;<br>
&lt;/HTML&gt;<br>
<br>

</tt>
