<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;3.2//EN&quot;&gt;<br>
&lt;HTML&gt;<br>
&lt;HEAD&gt;<br>
&lt;META&nbsp;HTTP-EQUIV=&quot;Content-Type&quot;&nbsp;CONTENT=&quot;text/html;&nbsp;charset=iso-8859-1&quot;&gt;<br>
&lt;META&nbsp;NAME=&quot;Generator&quot;&nbsp;CONTENT=&quot;MS&nbsp;Exchange&nbsp;Server&nbsp;version&nbsp;6.5.7651.59&quot;&gt;<br>
&lt;TITLE&gt;FW:&nbsp;[Owasp-modsecurity-core-rule-set]&nbsp;WHY&nbsp;Rule&nbsp;&amp;quot;950109&amp;quot;&nbsp;matches&nbsp;for&nbsp;ARG&amp;quot;passed_id=81&amp;quot;&nbsp;?&lt;/TITLE&gt;<br>
&lt;/HEAD&gt;<br>
&lt;BODY&gt;<br>
&lt;!--&nbsp;Converted&nbsp;from&nbsp;text/plain&nbsp;format&nbsp;--&gt;<br>
<br>
&lt;P&gt;&lt;FONT&nbsp;SIZE=2&gt;I&nbsp;believe&nbsp;the&nbsp;problem&nbsp;is&nbsp;the&nbsp;way&nbsp;the&nbsp;matching&nbsp;regex&nbsp;is&nbsp;written:&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;think&nbsp;the&nbsp;intent&nbsp;of&nbsp;the&nbsp;original&nbsp;regex&nbsp;is&nbsp;to&nbsp;match&nbsp;any&nbsp;instance&nbsp;of&nbsp;a&nbsp;URL-encoded&nbsp;ASCII&nbsp;or&nbsp;Unicode&nbsp;character;&nbsp;the&nbsp;(?!$|\W)&nbsp;construct&nbsp;checks&nbsp;if&nbsp;the&nbsp;1st&nbsp;character&nbsp;after&nbsp;the&nbsp;'%'&nbsp;is&nbsp;NOT&nbsp;an&nbsp;end-of-line&nbsp;or&nbsp;a&nbsp;non-word&nbsp;character,&nbsp;as&nbsp;a&nbsp;way&nbsp;to&nbsp;avoid&nbsp;an&nbsp;unnessary&nbsp;scan;&nbsp;but&nbsp;the&nbsp;way&nbsp;it's&nbsp;written,&nbsp;it&nbsp;matches&nbsp;any&nbsp;string&nbsp;consisting&nbsp;of&nbsp;a&nbsp;'%'&nbsp;sign&nbsp;that's&nbsp;not&nbsp;followed&nbsp;by&nbsp;end-of-line&nbsp;or&nbsp;a&nbsp;non-word&nbsp;character,&nbsp;OR&nbsp;any&nbsp;string&nbsp;of&nbsp;2&nbsp;alphabetic&nbsp;characters,&nbsp;OR&nbsp;any&nbsp;string&nbsp;of&nbsp;a&nbsp;'u'&nbsp;followed&nbsp;by&nbsp;4&nbsp;alphabetic&nbsp;characters&nbsp;i.e.&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;\%(?!$|\W)&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;--or--&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;[0-9a-fA-F]{2}&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;--or--&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;u[0-9a-fA-F]{4}&lt;BR&gt;<br>
&lt;BR&gt;<br>
I&nbsp;think&nbsp;what&nbsp;was&nbsp;intended&nbsp;was&nbsp;to&nbsp;match&nbsp;any&nbsp;strings&nbsp;of&nbsp;the&nbsp;forms&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;\%(?!$|\W)[0-9a-fA-F]{2}&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;--or--&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;\%(?!$|\W)u[0-9a-fA-F]{4}&lt;BR&gt;<br>
&lt;BR&gt;<br>
If&nbsp;so,&nbsp;the&nbsp;regex&nbsp;could&nbsp;be&nbsp;written&nbsp;as&lt;BR&gt;<br>
&lt;BR&gt;<br>
&amp;nbsp;&amp;nbsp;&nbsp;\%(?!$|\W)([0-9a-fA-F]{2}|u[0-9a-fA-F]{4})&lt;BR&gt;<br>
&lt;BR&gt;<br>
i.e.&nbsp;removing&nbsp;the&nbsp;'|'&nbsp;after&nbsp;the&nbsp;negative-lookahead&nbsp;group,&nbsp;and&nbsp;grouping&nbsp;the&nbsp;following&nbsp;aternatives.&lt;BR&gt;<br>
&lt;BR&gt;<br>
--Mike&nbsp;Owens&nbsp;&amp;lt;mike.owens@state.nm.us&amp;gt;&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
-----Original&nbsp;Message-----&lt;BR&gt;<br>
From:&nbsp;owasp-modsecurity-core-rule-set-bounces@lists.owasp.org&nbsp;on&nbsp;behalf&nbsp;of&nbsp;Dirk&nbsp;Caspari&lt;BR&gt;<br>
Sent:&nbsp;Wed&nbsp;9/8/10&nbsp;08:44&lt;BR&gt;<br>
To:&nbsp;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;BR&gt;<br>
Subject:&nbsp;[Owasp-modsecurity-core-rule-set]&nbsp;WHY&nbsp;Rule&nbsp;&amp;quot;950109&amp;quot;&nbsp;matches&nbsp;for&nbsp;ARG&amp;quot;passed_id=81&amp;quot;&nbsp;?&lt;BR&gt;<br>
&lt;BR&gt;<br>
--411a3f76-B--&lt;BR&gt;<br>
GET&nbsp;/src/read_body.php?mailbox=INBOX&amp;amp;passed_id=81&amp;amp;startMessage=1&nbsp;HTTP/1.1&lt;BR&gt;<br>
Host:&nbsp;xxx.xxxxxxxx.de&lt;BR&gt;<br>
User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;i686;&nbsp;de-DE;&nbsp;rv:1.9.2.3)&lt;BR&gt;<br>
Gecko/20100423&nbsp;Ubuntu/10.04&nbsp;(lucid)&nbsp;Firefox/3.6.3&lt;BR&gt;<br>
Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;BR&gt;<br>
Accept-Language:&nbsp;de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2&lt;BR&gt;<br>
Accept-Encoding:&nbsp;gzip,deflate&lt;BR&gt;<br>
Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.7&lt;BR&gt;<br>
Keep-Alive:&nbsp;115&lt;BR&gt;<br>
Connection:&nbsp;keep-alive&lt;BR&gt;<br>
Referer:&lt;BR&gt;<br>
&lt;A&nbsp;HREF=&quot;https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&amp;sort=0&amp;startMessage=1&amp;mailbox=INBOX&quot;&gt;https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&amp;sort=0&amp;startMessage=1&amp;mailbox=INBOX&lt;/A&gt;&lt;BR&gt;<br>
Cookie:&nbsp;xxxxx&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
--411a3f76-H--&lt;BR&gt;<br>
Message:&nbsp;Pattern&nbsp;match&nbsp;&amp;quot;\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}&amp;quot;&nbsp;at&lt;BR&gt;<br>
ARGS:passed_id.&nbsp;[file&lt;BR&gt;<br>
&amp;quot;/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations.conf&amp;quot;]&lt;BR&gt;<br>
[line&nbsp;&amp;quot;185&amp;quot;]&nbsp;[id&nbsp;&amp;quot;950109&amp;quot;]&nbsp;[rev&nbsp;&amp;quot;2.0.8&amp;quot;]&nbsp;[msg&nbsp;&amp;quot;Multiple&nbsp;URL&nbsp;Encoding&lt;BR&gt;<br>
Detected&amp;quot;]&nbsp;[severity&nbsp;&amp;quot;NOTICE&amp;quot;]&nbsp;[tag&nbsp;&amp;quot;PROTOCOL_VIOLATION/EVASION&amp;quot;]&lt;BR&gt;<br>
Message:&nbsp;Warning.&nbsp;Operator&nbsp;LT&nbsp;matched&nbsp;20&nbsp;at&nbsp;TX:inbound_anomaly_score.&lt;BR&gt;<br>
[file&lt;BR&gt;<br>
&amp;quot;/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf&amp;quot;]&lt;BR&gt;<br>
[line&nbsp;&amp;quot;31&amp;quot;]&nbsp;[msg&nbsp;&amp;quot;Inbound&nbsp;Anomaly&nbsp;Score&nbsp;(Total&nbsp;Inbound&nbsp;Score:&nbsp;5,&nbsp;SQLi=,&lt;BR&gt;<br>
XSS=):&nbsp;Multiple&nbsp;URL&nbsp;Encoding&nbsp;Detected&nbsp;!&lt;BR&gt;<br>
%{matched_var_name}=%{matched_var}&nbsp;!&amp;quot;]&lt;BR&gt;<br>
&lt;BR&gt;<br>
Thanks.&lt;BR&gt;<br>
&amp;nbsp;&nbsp;D&nbsp;I&nbsp;R&nbsp;K&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;BR&gt;<br>
&lt;/FONT&gt;<br>
&lt;/P&gt;<br>
<br>
&lt;DIV&gt;&amp;nbsp;&lt;/DIV&gt;&lt;br&gt;&lt;br&gt;Confidentiality&nbsp;Notice:&nbsp;This&nbsp;e-mail,&nbsp;including&nbsp;all&nbsp;attachments&nbsp;is&nbsp;for&nbsp;the&nbsp;sole&nbsp;use&nbsp;of&nbsp;the&nbsp;intended&nbsp;recipient(s)&nbsp;and&nbsp;may&nbsp;contain&nbsp;confidential&nbsp;and&nbsp;privileged&nbsp;information.&nbsp;Any&nbsp;unauthorized&nbsp;review,&nbsp;use,&nbsp;disclosure&nbsp;or&nbsp;distribution&nbsp;is&nbsp;prohibited&nbsp;unless&nbsp;specifically&nbsp;provided&nbsp;under&nbsp;the&nbsp;New&nbsp;Mexico&nbsp;Inspection&nbsp;of&nbsp;Public&nbsp;Records&nbsp;Act.&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;please&nbsp;contact&nbsp;the&nbsp;sender&nbsp;and&nbsp;destroy&nbsp;all&nbsp;copies&nbsp;of&nbsp;this&nbsp;message.&nbsp;--&nbsp;This&nbsp;email&nbsp;has&nbsp;been&nbsp;scanned&nbsp;by&nbsp;the&nbsp;Sybari&nbsp;-&nbsp;Antigen&nbsp;Email&nbsp;System.&nbsp;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;/BODY&gt;<br>
&lt;/HTML&gt;<br>

</tt>
