<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0//EN&quot;&nbsp;&quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;name=&quot;qrichtext&quot;&nbsp;content=&quot;1&quot;&nbsp;/&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;p,&nbsp;li&nbsp;{&nbsp;white-space:&nbsp;pre-wrap;&nbsp;}&lt;/style&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;&nbsp;font-family:'DejaVu&nbsp;Sans';&nbsp;font-size:9pt;&nbsp;font-weight:400;&nbsp;font-style:normal;&quot;&gt;Please&nbsp;excuse&nbsp;the&nbsp;cross-postings&nbsp;but&nbsp;I&nbsp;want&nbsp;to&nbsp;jumpstart&nbsp;moving&nbsp;these&nbsp;types&nbsp;of&nbsp;Mod&nbsp;rules&nbsp;discussions&nbsp;over&nbsp;to&nbsp;the&nbsp;OWASP&nbsp;list.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;Just&nbsp;a&nbsp;follow-up&nbsp;-&nbsp;the&nbsp;new&nbsp;CRS&nbsp;2.0.0&nbsp;has&nbsp;significant&nbsp;updates&nbsp;for&nbsp;XSS&nbsp;protections.&nbsp;&nbsp;Specifically,&nbsp;the&nbsp;Ha.ckers&nbsp;XSS&nbsp;Cheatsheet&nbsp;(http://ha.ckers.org/xss.html)&nbsp;was&nbsp;reviewed&nbsp;and&nbsp;rules&nbsp;were&nbsp;updated&nbsp;to&nbsp;reflect&nbsp;the&nbsp;different&nbsp;vectors.&nbsp;&nbsp;Additionally,&nbsp;the&nbsp;WASC&nbsp;Script&nbsp;Mapping&nbsp;Project&nbsp;(http://projects.webappsec.org/Script-Mapping)&nbsp;was&nbsp;reviewed&nbsp;and&nbsp;all&nbsp;html&nbsp;event&nbsp;handlers&nbsp;were&nbsp;included.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;As&nbsp;a&nbsp;side&nbsp;note&nbsp;-&nbsp;at&nbsp;the&nbsp;Blac&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;--&nbsp;&lt;br&gt;<br>
Ryan&nbsp;C.&nbsp;Barnett&lt;br&gt;<br>
WASC&nbsp;Distributed&nbsp;Open&nbsp;Proxy&nbsp;Honeypot&nbsp;Project&nbsp;Leader&lt;br&gt;<br>
OWASP&nbsp;ModSecurity&nbsp;Core&nbsp;Rule&nbsp;Set&nbsp;Project&nbsp;Leader&lt;br&gt;<br>
Tactical&nbsp;Web&nbsp;Application&nbsp;Security&lt;br&gt;<br>
http://tacticalwebappsec.blogspot.com&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;br&nbsp;/&gt;On&nbsp;Tuesday&nbsp;21&nbsp;July&nbsp;2009&nbsp;08:41:24&nbsp;am&nbsp;Ryan&nbsp;Barnett&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;On&nbsp;Tuesday&nbsp;21&nbsp;July&nbsp;2009&nbsp;12:20:34&nbsp;am&nbsp;Bill&nbsp;Bradley&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Bill&nbsp;Bradley&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&nbsp;to&nbsp;mod-security-u.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;show&nbsp;details&nbsp;11:24&nbsp;AM&nbsp;(11&nbsp;hours&nbsp;ago)&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Reply&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Follow&nbsp;up&nbsp;message&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Hey&nbsp;All,&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;I&nbsp;am&nbsp;new&nbsp;to&nbsp;modsecurity&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Hey&nbsp;Bill,&nbsp;welcome&nbsp;aboard!&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;but&nbsp;have&nbsp;implemented&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;modsecurity_crs_40_generic_attacks.conf&nbsp;from&nbsp;the&nbsp;optional_rules&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;directory&nbsp;to&nbsp;block&nbsp;and&nbsp;log&nbsp;XSS&nbsp;scripting.&nbsp;&nbsp;So&nbsp;far&nbsp;it&nbsp;is&nbsp;working&nbsp;great.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;The&nbsp;current&nbsp;Core&nbsp;Rule&nbsp;Set&nbsp;(CRS)&nbsp;does&nbsp;a&nbsp;decent&nbsp;job&nbsp;against&nbsp;most&nbsp;attack&lt;br&gt;<br>
&amp;gt;&nbsp;payload&nbsp;classes&nbsp;(including&nbsp;XSS)&nbsp;but&nbsp;as&nbsp;you&nbsp;found&nbsp;out,&nbsp;they&nbsp;are&nbsp;not&nbsp;perfect.&lt;br&gt;<br>
&amp;gt;&nbsp;&nbsp;The&nbsp;only&nbsp;way&nbsp;that&nbsp;they&nbsp;will&nbsp;get&nbsp;better&nbsp;is&nbsp;if&nbsp;users&nbsp;report&nbsp;these&lt;br&gt;<br>
&amp;gt;&nbsp;bypass/evasion&nbsp;issues.&nbsp;So&nbsp;thank&nbsp;you&nbsp;for&nbsp;reporting&nbsp;this&nbsp;issue.&nbsp;&nbsp;By&nbsp;the&nbsp;way&nbsp;-&lt;br&gt;<br>
&amp;gt;&nbsp;we&nbsp;have&nbsp;an&nbsp;official&nbsp;JIRA&nbsp;ticketing&nbsp;system&nbsp;so&nbsp;you&nbsp;can&nbsp;report&nbsp;issues&nbsp;there&lt;br&gt;<br>
&amp;gt;&nbsp;and&nbsp;it&nbsp;will&nbsp;be&nbsp;properly&nbsp;tracked&nbsp;to&nbsp;resolution&nbsp;-&lt;br&gt;<br>
&amp;gt;&nbsp;https://www.modsecurity.org/tracker/&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Also&nbsp;of&nbsp;note&nbsp;-&nbsp;we&nbsp;will&nbsp;be&nbsp;releasing&nbsp;CRS&nbsp;version&nbsp;2.0&nbsp;within&nbsp;the&nbsp;week&nbsp;which&lt;br&gt;<br>
&amp;gt;&nbsp;will&nbsp;include&nbsp;significant&nbsp;updates&nbsp;to&nbsp;the&nbsp;rules&nbsp;including&nbsp;a&nbsp;separate&nbsp;rule&nbsp;set&lt;br&gt;<br>
&amp;gt;&nbsp;just&nbsp;for&nbsp;XSS.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;The&nbsp;app&nbsp;is&nbsp;being&nbsp;tested&nbsp;by&nbsp;penetration&nbsp;folks&nbsp;and&nbsp;they&nbsp;are&nbsp;still&nbsp;able&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;to&nbsp;pass&nbsp;on&nbsp;XSS&nbsp;attack:&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;XSS&nbsp;vulnerability&nbsp;found&nbsp;in&nbsp;backend&nbsp;parameter.&nbsp;The&nbsp;following&nbsp;attack&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;targets&nbsp;all&nbsp;browser(s)&nbsp;and&nbsp;was&nbsp;successful&nbsp;using&nbsp;plain&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;encoding:&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&quot;&amp;gt;&amp;lt;iMg&nbsp;SrC=x&nbsp;OnErRoR=window.location=42114&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;If&nbsp;you&nbsp;look&nbsp;in&nbsp;the&nbsp;modsecurity_crs_40_generic_attacks.conf&nbsp;file,&nbsp;you&nbsp;will&lt;br&gt;<br>
&amp;gt;&nbsp;see&nbsp;the&nbsp;XSS&nbsp;section.&nbsp;&nbsp;It&nbsp;starts&nbsp;off&nbsp;with&nbsp;the&nbsp;set-based&nbsp;pattern&nbsp;matching&lt;br&gt;<br>
&amp;gt;&nbsp;pre-&nbsp;qualifiers&nbsp;where&nbsp;it&nbsp;is&nbsp;looking&nbsp;for&nbsp;any&nbsp;core&nbsp;keywords&nbsp;for&nbsp;the&nbsp;attack&lt;br&gt;<br>
&amp;gt;&nbsp;class&nbsp;-&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;SecRule&nbsp;REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|&lt;br&gt;<br>
&amp;gt;&nbsp;XML:/*|!REQUEST_HEADERS:Referer&nbsp;&quot;@pm&nbsp;jscript&nbsp;onsubmit&nbsp;copyparentfolder&lt;br&gt;<br>
&amp;gt;&nbsp;javas&nbsp;cript&nbsp;meta&nbsp;onchange&nbsp;onmove&nbsp;onkeydown&nbsp;onkeyup&nbsp;activexobject&nbsp;onmouseup&lt;br&gt;<br>
&amp;gt;&nbsp;ecmascript&nbsp;bexpression&nbsp;onmouseover&nbsp;vbscript:&nbsp;&amp;lt;![cdata[&nbsp;http:&nbsp;.innerhtml&lt;br&gt;<br>
&amp;gt;&nbsp;settimeout&nbsp;shell:&nbsp;onabort&nbsp;asfunction:&nbsp;onkeypress&nbsp;onmousedown&nbsp;onclick&lt;br&gt;<br>
&amp;gt;&nbsp;.fromcharcode&nbsp;background-image:&nbsp;.cookie&nbsp;ondragdrop&nbsp;onblur&nbsp;x-javascript&lt;br&gt;<br>
&amp;gt;&nbsp;mocha:&nbsp;javascript:&nbsp;onfocus&nbsp;lowsrc&nbsp;getparentfolder&nbsp;onresize&nbsp;@import&nbsp;alert&lt;br&gt;<br>
&amp;gt;&nbsp;script&nbsp;onselect&nbsp;onmouseout&nbsp;application&nbsp;onmousemove&nbsp;background&nbsp;.execscript&lt;br&gt;<br>
&amp;gt;&nbsp;livescript:&nbsp;vbscript&nbsp;getspecialfolder&nbsp;.addimport&nbsp;iframe&nbsp;onunload&lt;br&gt;<br>
&amp;gt;&nbsp;createtextrange&nbsp;&amp;lt;input&nbsp;onload&quot;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;In&nbsp;looking&nbsp;at&nbsp;these&nbsp;keywords,&nbsp;there&nbsp;are&nbsp;other&nbsp;browser/DOM&nbsp;actions&nbsp;such&nbsp;as&lt;br&gt;<br>
&amp;gt;&nbsp;onblur,&nbsp;onfocus,&nbsp;onmousemove,&nbsp;etc...&nbsp;&nbsp;but&nbsp;it&nbsp;doesn't&nbsp;appear&nbsp;that&nbsp;we&nbsp;have&lt;br&gt;<br>
&amp;gt;&nbsp;one&nbsp;for&nbsp;your&nbsp;example&nbsp;payload&nbsp;-&nbsp;onerror.&nbsp;&nbsp;So,&nbsp;I&nbsp;would&nbsp;go&nbsp;ahead&nbsp;and&nbsp;add&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;following&nbsp;rule&nbsp;to&nbsp;a&nbsp;modsecurity_crs_15_customrules.conf&nbsp;file&nbsp;-&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;SecRule&nbsp;REQUEST_FILENAME|ARGS|ARGS_NAMES&nbsp;&quot;\bonerror\b\W*?\=&quot;&nbsp;\&lt;br&gt;<br>
&amp;gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&quot;phase:2,deny,capture,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe&lt;br&gt;<br>
&amp;gt;rcase,ctl:auditLogParts=+E,log,auditlog,msg:'Cross-&nbsp;site&nbsp;Scripting&nbsp;(XSS)&lt;br&gt;<br>
&amp;gt;&nbsp;Attack',id:'1',tag:'WEB_ATTACK/XSS',logdata:'%{TX.0}',severity:'2'&quot;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;tested&nbsp;this&nbsp;new&nbsp;rule&nbsp;against&nbsp;the&nbsp;following&nbsp;example&nbsp;request&nbsp;-&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;http://www.example.com/cgi-bin/test-cgi?foo=&quot;&amp;gt;&amp;lt;iMg&nbsp;SrC=x&lt;br&gt;<br>
&amp;gt;&nbsp;OnErRoR=window.location=42114&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;The&nbsp;rule&nbsp;triggered&nbsp;appropriately&nbsp;and&nbsp;generated&nbsp;the&nbsp;following&nbsp;alert&nbsp;in&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;Apache&nbsp;error_log&nbsp;file&nbsp;-&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;[Sun&nbsp;May&nbsp;31&nbsp;02:25:14&nbsp;2009]&nbsp;[error]&nbsp;[client&nbsp;192.168.1.103]&nbsp;ModSecurity:&lt;br&gt;<br>
&amp;gt;&nbsp;Access&nbsp;denied&nbsp;with&nbsp;code&nbsp;403&nbsp;(phase&nbsp;2).&nbsp;Pattern&nbsp;match&lt;br&gt;<br>
&amp;gt;&nbsp;&quot;\\bonerror\\b\\W*?\\=&quot;&nbsp;at&nbsp;ARGS:foo.&nbsp;[file&lt;br&gt;<br>
&amp;gt;&nbsp;&quot;/usr/local/apache/conf/enhanced_rule_set-1.7.0/base_rules/modsecurity_ers_&lt;br&gt;<br>
&amp;gt;15_customrules.conf&quot;]&nbsp;[line&nbsp;&quot;2&quot;]&nbsp;[id&nbsp;&quot;958409&quot;]&nbsp;[msg&nbsp;&quot;Cross-site&nbsp;Scripting&lt;br&gt;<br>
&amp;gt;&nbsp;(XSS)&nbsp;Attack&quot;]&nbsp;[data&nbsp;&quot;onerror=&quot;]&nbsp;[severity&nbsp;&quot;CRITICAL&quot;]&nbsp;[tag&lt;br&gt;<br>
&amp;gt;&nbsp;&quot;WEB_ATTACK/XSS&quot;]&nbsp;[hostname&nbsp;&quot;www.example.com&quot;]&nbsp;[uri&nbsp;&quot;/cgi-bin/test-cgi&quot;]&lt;br&gt;<br>
&amp;gt;&nbsp;[unique_id&nbsp;&quot;SiIiyn8AAQEAABGXB-&nbsp;QAAAAA&quot;]&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Hope&nbsp;this&nbsp;info&nbsp;helps,&lt;br&gt;<br>
&amp;gt;&nbsp;Ryan&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
