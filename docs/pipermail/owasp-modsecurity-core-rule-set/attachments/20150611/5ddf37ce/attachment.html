<tt>
&lt;html&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=utf-8&quot;&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;text=&quot;#000000&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;forum,&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Relatively&nbsp;new&nbsp;to&nbsp;mod-security&nbsp;but&nbsp;I've&nbsp;got&nbsp;it&nbsp;running&nbsp;on&nbsp;a&nbsp;Ubuntu<br>
&nbsp;&nbsp;&nbsp;&nbsp;14.04,&nbsp;Apache&nbsp;2.4.7&nbsp;reverse&nbsp;proxy,&nbsp;mainly&nbsp;serving&nbsp;Exchange&nbsp;2003<br>
&nbsp;&nbsp;&nbsp;&nbsp;Outlook&nbsp;Web&nbsp;Access&nbsp;(OWA).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Everything&nbsp;is&nbsp;working&nbsp;fine&nbsp;except&nbsp;for&nbsp;Active-Sync.&nbsp;The&nbsp;specific<br>
&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;I&nbsp;receive&nbsp;is:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[Thu&nbsp;Jun&nbsp;11&nbsp;22:22:40.491232&nbsp;2015]&nbsp;[:error]&nbsp;[pid&nbsp;28480:tid<br>
&nbsp;&nbsp;&nbsp;&nbsp;139919860156160]&nbsp;[client&nbsp;22.79.19.67]&nbsp;ModSecurity:&nbsp;Access&nbsp;denied<br>
&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;code&nbsp;403&nbsp;(phase&nbsp;1).&nbsp;Match&nbsp;of&nbsp;&quot;rx<br>
&nbsp;&nbsp;&nbsp;&nbsp;^%{tx.allowed_request_content_type}$&quot;&nbsp;against&nbsp;&quot;TX:0&quot;&nbsp;required.&nbsp;[file<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;/usr/share/modsecurity-crs/activated_rules/modsecurity_crs_30_http_policy.conf&quot;]<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;[line&nbsp;&quot;64&quot;]&nbsp;[id&nbsp;&quot;960010&quot;]&nbsp;[rev&nbsp;&quot;2&quot;]&nbsp;[msg&nbsp;&quot;Request&nbsp;content&nbsp;type&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;allowed&nbsp;by&nbsp;policy&quot;]&nbsp;[data&nbsp;&quot;application/vnd.ms-sync.wbxml&quot;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[severity&nbsp;&quot;CRITICAL&quot;]&nbsp;[ver&nbsp;&quot;OWASP_CRS/2.2.9&quot;]&nbsp;[maturity&nbsp;&quot;9&quot;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[accuracy&nbsp;&quot;9&quot;]&nbsp;[tag&nbsp;&quot;OWASP_CRS/POLICY/ENCODING_NOT_ALLOWED&quot;]&nbsp;[tag<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;WASCTC/WASC-20&quot;]&nbsp;[tag&nbsp;&quot;OWASP_TOP_10/A1&quot;]&nbsp;[tag<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;OWASP_AppSensor/EE2&quot;]&nbsp;[tag&nbsp;&quot;PCI/12.1&quot;]&nbsp;[hostname&nbsp;&quot;myserver.com.au&quot;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;[uri&nbsp;&quot;/Microsoft-Server-ActiveSync&quot;]&nbsp;[unique_id<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;VXl9kH8AAQEAAG9A8nQAAABB&quot;]&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;virtual&nbsp;host&nbsp;file&nbsp;for&nbsp;ActiveSync&nbsp;contains:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;Location&nbsp;/Microsoft-Server-ActiveSync&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;#       &nbsp;SecRuleRemoveById&nbsp;960010&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;SecRuleEngine&nbsp;Off&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;ProxyPass&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://eemail/Microsoft-Server-ActiveSync&quot;&gt;https://eemail/Microsoft-Server-ActiveSync&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;       &nbsp;ProxyPassReverse&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;https://eemail/Microsoft-Server-ActiveSync&quot;&gt;https://eemail/Microsoft-Server-ActiveSync&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/Location&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Both&nbsp;&quot;SecRuleRemoveById&nbsp;960010&quot;&nbsp;and&nbsp;&quot;SecRuleEngine&nbsp;Off&quot;&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;/Microsoft-Server-ActiveSync&nbsp;fail&nbsp;to&nbsp;prevent&nbsp;the&nbsp;error&nbsp;and&nbsp;allow<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActiveSync.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;From&nbsp;this&nbsp;post&nbsp;&lt;a<br>
href=&quot;https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-November/000546.html&quot;&gt;https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/2010-November/000546.html&lt;/a&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;am&nbsp;able&nbsp;to&nbsp;permit&nbsp;ActiveSync&nbsp;by&nbsp;adding&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;application/vnd.ms-sync.wbxml&quot;&nbsp;content&nbsp;type&nbsp;to&nbsp;line&nbsp;279&nbsp;of&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;/usr/share/modsecurity-crs/activated_rules/modescurity_crs_10_setup.conf<br>
&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;like&nbsp;so:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;SecAction&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&quot;id:'900012',&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;phase:1,&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;t:none,&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;setvar:'tx.allowed_methods=GET&nbsp;HEAD&nbsp;POST&nbsp;OPTIONS',&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   <br>
setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json|&lt;u&gt;&lt;b&gt;&lt;font<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color=&quot;#ff0000&quot;&gt;application/vnd.ms-sync.wbxml&lt;/font&gt;&lt;/b&gt;&lt;/u&gt;',<br>
&nbsp;&nbsp;&nbsp;&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;   &nbsp;setvar:'tx.allowed_http_versions=HTTP/0.9&nbsp;HTTP/1.0&nbsp;HTTP/1.1',&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;setvar:'tx.restricted_extensions=.asa/&nbsp;.asax/&nbsp;.ascx/&nbsp;.axd/<br>
&nbsp;&nbsp;&nbsp;&nbsp;.backup/&nbsp;.bak/&nbsp;.bat/&nbsp;.cdx/&nbsp;.cer/&nbsp;.cfg/&nbsp;.cmd/&nbsp;.com/&nbsp;.config/&nbsp;.conf/<br>
&nbsp;&nbsp;&nbsp;&nbsp;.cs/&nbsp;.csproj/&nbsp;.csr/&nbsp;.dat/&nbsp;.db/&nbsp;.dbf/&nbsp;.dll/&nbsp;.dos/&nbsp;.htr/&nbsp;.   &nbsp;htw/<br>
&nbsp;&nbsp;&nbsp;&nbsp;.ida/&nbsp;.idc/&nbsp;.idq/&nbsp;.inc/&nbsp;.ini/&nbsp;.key/&nbsp;.licx/&nbsp;.lnk/&nbsp;.log/&nbsp;.mdb/&nbsp;.old/<br>
&nbsp;&nbsp;&nbsp;&nbsp;.pass/&nbsp;.pdb/&nbsp;.pol/&nbsp;.printer/&nbsp;.pwd/&nbsp;.resources/&nbsp;.resx/&nbsp;.sql/&nbsp;.sys/<br>
&nbsp;&nbsp;&nbsp;&nbsp;.vb/&nbsp;.vbs/&nbsp;.vbproj/&nbsp;.vsdisco/&nbsp;.webinfo/&nbsp;.xsd/    &nbsp;.xsx/',&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;setvar:'tx.restricted_headers=/Proxy-Connection/&nbsp;/Lock-Token/<br>
&nbsp;&nbsp;&nbsp;&nbsp;/Content-Range/&nbsp;/Translate/&nbsp;/via/&nbsp;/if/',&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;nolog,&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;pass&quot;&lt;i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/i&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;if&nbsp;I&nbsp;upgrade&nbsp;the&nbsp;core&nbsp;rules&nbsp;(which&nbsp;I'm&nbsp;intending&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;automate&nbsp;with&nbsp;a&nbsp;script)&nbsp;I'll&nbsp;have&nbsp;to&nbsp;remember&nbsp;to&nbsp;re-append&nbsp;the<br>
&nbsp;&nbsp;&nbsp;&nbsp;content&nbsp;type&nbsp;to&nbsp;the&nbsp;file.&nbsp;So&nbsp;my&nbsp;question&nbsp;is&nbsp;where&nbsp;and&nbsp;how&nbsp;can&nbsp;I<br>
&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;the&nbsp;new&nbsp;content&nbsp;type&nbsp;(eg&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;/etc/mod-security/mod-security.conf&nbsp;or&nbsp;the&nbsp;virtual&nbsp;host&nbsp;config)&nbsp;so<br>
&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;it&nbsp;won't&nbsp;be&nbsp;over-written&nbsp;if&nbsp;a&nbsp;new&nbsp;version&nbsp;of&nbsp;the&nbsp;core&nbsp;rules&nbsp;is<br>
&nbsp;&nbsp;&nbsp;&nbsp;installed&nbsp;in&nbsp;/usr/share/modsecurity-crs?&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Any&nbsp;help&nbsp;or&nbsp;alternative&nbsp;suggestions&nbsp;for&nbsp;allowing&nbsp;ActiveSync&nbsp;will&nbsp;be<br>
&nbsp;&nbsp;&nbsp;&nbsp;much&nbsp;appreciated.<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
