<tt>
&lt;html&nbsp;style=&quot;direction:&nbsp;ltr;&quot;&gt;<br>
&nbsp;&nbsp;&lt;head&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&nbsp;type=&quot;text/css&quot;&gt;body&nbsp;p&nbsp;{&nbsp;margin-bottom:&nbsp;0cm;&nbsp;margin-top:&nbsp;0pt;&nbsp;}&nbsp;&lt;/style&gt;<br>
&nbsp;&nbsp;&lt;/head&gt;<br>
&nbsp;&nbsp;&lt;body&nbsp;style=&quot;direction:&nbsp;ltr;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;bidimailui-detected-decoding-type=&quot;latin-charset&quot;&nbsp;bgcolor=&quot;#FFFFFF&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;text=&quot;#000000&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Hi&nbsp;everyone!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;I'm&nbsp;trying&nbsp;to&nbsp;fit&nbsp;the&nbsp;Session&nbsp;Highjacking&nbsp;rules<br>
&nbsp;&nbsp;&nbsp;&nbsp;(modsecurity_crs_16_session_hijacking.conf)&nbsp;to&nbsp;my&nbsp;web&nbsp;app.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;problem&nbsp;was&nbsp;described&nbsp;by&nbsp;someone&nbsp;else&nbsp;(but&nbsp;apparently&nbsp;never<br>
&nbsp;&nbsp;&nbsp;&nbsp;solved)&nbsp;on&nbsp;that&nbsp;older&nbsp;post&nbsp;on&nbsp;the&nbsp;modsecurity-users&nbsp;list:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://sourceforge.net/p/mod-security/mailman/message/30069414/&quot;&gt;http://sourceforge.net/p/mod-security/mailman/message/30069414/&lt;/a&gt;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;Session&nbsp;Highjacking&nbsp;rules&nbsp;look&nbsp;at&nbsp;request&nbsp;and&nbsp;response&nbsp;cookies<br>
&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;find&nbsp;or&nbsp;create&nbsp;a&nbsp;new&nbsp;sessions.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;That&nbsp;works&nbsp;perfectly.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;However,&nbsp;the&nbsp;two&nbsp;rules&nbsp;after&nbsp;it&nbsp;will&nbsp;run&nbsp;in&nbsp;ANY&nbsp;case,&nbsp;even&nbsp;when&nbsp;no<br>
&nbsp;&nbsp;&nbsp;&nbsp;sessions&nbsp;has&nbsp;been&nbsp;initialized:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;SecRule&nbsp;REMOTE_ADDR<br>
&quot;^(\d{1,3}\.\d{1,3}\.\d{1,3}\.)&quot;&quot;chain,phase:3,id:'981063',capture,t:none,nolog,pass&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecRule&nbsp;TX:1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;.*&quot;&quot;t:sha1,t:hexEncode,setvar:session.ip_hash=%{matched_var}&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;SecRule&nbsp;REQUEST_HEADERS:User-Agent<br>
&quot;.*&quot;&quot;phase:3,id:'981064',t:none,t:sha1,t:hexEncode,nolog,pass,setvar:session.ua_hash=%{matched_var}&quot;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Because&nbsp;the&nbsp;session&nbsp;collection&nbsp;wasn't&nbsp;initialized&nbsp;(e.g.&nbsp;for<br>
&nbsp;&nbsp;&nbsp;&nbsp;anonymous&nbsp;users&nbsp;or&nbsp;bots),&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;setvars&nbsp;fail&nbsp;and&nbsp;the&nbsp;log&nbsp;is&nbsp;filled&nbsp;with&nbsp;errors&nbsp;like:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[example.com/sid#7fc5067fe380][rid#7fc4f43380a0][/path/to/file][3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;Could&nbsp;not&nbsp;set&nbsp;variable&nbsp;&quot;session.ip_hash&quot;&nbsp;as&nbsp;the&nbsp;collection&nbsp;does&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;exist.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;[example.com/sid#7fc5067fe380][rid#7fc4f43380a0][/path/to/file][3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;Could&nbsp;not&nbsp;set&nbsp;variable&nbsp;&quot;session.ua_hash&quot;&nbsp;as&nbsp;the&nbsp;collection&nbsp;does&nbsp;not<br>
&nbsp;&nbsp;&nbsp;&nbsp;exist.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;avoid&nbsp;this&nbsp;problem,&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;chain&nbsp;these&nbsp;rules&nbsp;with&nbsp;a<br>
&nbsp;&nbsp;&nbsp;&nbsp;Collection&nbsp;Existence&nbsp;check,&nbsp;to&nbsp;avoid&nbsp;non-existence&nbsp;errors.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;My&nbsp;two&nbsp;questions:&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1/&nbsp;I&nbsp;don't&nbsp;know&nbsp;how&nbsp;to&nbsp;test&nbsp;for&nbsp;the&nbsp;existence&nbsp;of&nbsp;the&nbsp;session<br>
&nbsp;&nbsp;&nbsp;&nbsp;collection.&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;I&nbsp;don't&nbsp;know&nbsp;if&nbsp;it&nbsp;makes&nbsp;a&nbsp;difference&nbsp;that&nbsp;the&nbsp;rule&nbsp;is&nbsp;parsed<br>
&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;phase&nbsp;3&nbsp;(response&nbsp;headers).&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2/&nbsp;More&nbsp;importantly,&nbsp;it&nbsp;seems&nbsp;like&nbsp;&nbsp;even&nbsp;chaining&nbsp;it&nbsp;to&nbsp;an<br>
&nbsp;&nbsp;&nbsp;&nbsp;impossible&nbsp;rule&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(e.g.&nbsp;SecRule&nbsp;&amp;ARGS:x58t4z5&nbsp;&quot;@gt&nbsp;128&quot;)&nbsp;will&nbsp;not&nbsp;stop&nbsp;it<br>
&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;logging&nbsp;these&nbsp;errors!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Maybe&nbsp;I&nbsp;misunderstood&nbsp;chaining&nbsp;or&nbsp;variable&nbsp;collections,&nbsp;but&nbsp;I<br>
&nbsp;&nbsp;&nbsp;&nbsp;can't&nbsp;seem&nbsp;to&nbsp;comprehend&nbsp;this&nbsp;issue!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;anyone&nbsp;can&nbsp;enlighten&nbsp;me&nbsp;on&nbsp;either&nbsp;or&nbsp;both,&nbsp;I'd&nbsp;be&nbsp;delighted&nbsp;to<br>
&nbsp;&nbsp;&nbsp;&nbsp;hear&nbsp;your&nbsp;advice.&nbsp;Thanks!&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;Ramy&lt;br&gt;<br>
&nbsp;&nbsp;&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
