<tt>
<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&gt;&lt;tt&gt;Ryan&nbsp;Barnett&nbsp;&amp;lt;ryan.barnett@breach.com&amp;gt;&nbsp;wrote<br>
25.03.2010&nbsp;23:27:52:&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;gt;&nbsp;On&nbsp;Thursday&nbsp;25&nbsp;March&nbsp;2010&nbsp;16:10:53&nbsp;Artyom&nbsp;Davidov&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;Hi&nbsp;-&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;I'm&nbsp;upgrading&nbsp;from&nbsp;Core&nbsp;Rules&nbsp;1.x&nbsp;to&nbsp;2.0.6,&nbsp;and&nbsp;for&nbsp;the<br>
life&nbsp;of&nbsp;me&nbsp;I&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;can't&nbsp;figure&nbsp;out&nbsp;whats&nbsp;blocking&nbsp;a&nbsp;bunch&nbsp;of&nbsp;requests&nbsp;going<br>
to&nbsp;images,&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;css&nbsp;and&nbsp;auxilary&nbsp;files&nbsp;after&nbsp;I&nbsp;set&nbsp;my&nbsp;secdefaultaction&nbsp;from<br>
pass&nbsp;--&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;fail.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;I'm&nbsp;running&nbsp;modsec&nbsp;2.5.12&nbsp;on&nbsp;httpd&nbsp;2.2.14&nbsp;on&nbsp;redhat&nbsp;4&nbsp;in<br>
a&nbsp;proxy&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;situation.&nbsp;&amp;nbsp;Below&nbsp;is&nbsp;the&nbsp;audit&nbsp;log&nbsp;of&nbsp;a&nbsp;failed&nbsp;transaction.<br>
&amp;nbsp;I've&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;scrubbed&nbsp;some&nbsp;cookies,&nbsp;IPs&nbsp;and&nbsp;such.&nbsp;&amp;nbsp;Many&nbsp;of&nbsp;the&nbsp;rules<br>
that&nbsp;it&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;matched&nbsp;on&nbsp;don't&nbsp;make&nbsp;sense&nbsp;-&nbsp;for&nbsp;instance&nbsp;two&nbsp;seem&nbsp;to&nbsp;reference&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;content&nbsp;in&nbsp;my&nbsp;GET,&nbsp;but&nbsp;as&nbsp;you&nbsp;can&nbsp;see&nbsp;from&nbsp;the&nbsp;audit&nbsp;log<br>
-&nbsp;that&nbsp;is&nbsp;not&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;true.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;basically,&nbsp;I&nbsp;switch&nbsp;from&nbsp;SecDefaultAction&nbsp;&amp;quot;phase:2,pass&amp;quot;<br>
to&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;SecDefaultAction&nbsp;&amp;quot;phase:2,deny&amp;quot;&nbsp;and&nbsp;things&nbsp;blow<br>
up.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;Thanks&nbsp;in&nbsp;advance.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;[...skipped...]&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;SecRule&nbsp;&amp;quot;RESPONSE_BODY&amp;quot;&nbsp;&amp;quot;!@pmFromFile&nbsp;modsecurity_50_outbound.data&amp;quot;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;quot;phase:4,rev:2.0.6,t:none,capture,t:urlDecodeUni,t:htmlEntityDecode,&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;gt;&nbsp;nolog,skipAfter:END_OUTBOUND_CHECK&amp;quot;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Hmmm...&nbsp;Strange.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;It&nbsp;seems&nbsp;that&nbsp;a&nbsp;part&nbsp;of&nbsp;the&nbsp;bug&nbsp;with&nbsp;id&nbsp;&amp;quot;CORERULES-36&amp;quot;<br>
is&nbsp;still&nbsp;in&nbsp;place.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Just&nbsp;checked&nbsp;modsecurity_crs_50_outbound.conf&nbsp;and&nbsp;it&nbsp;looks&nbsp;like<br>
it's&nbsp;still&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;missing&nbsp;default&nbsp;action&nbsp;in&nbsp;this&nbsp;rule.&nbsp;We've&nbsp;got&nbsp;the&nbsp;same&nbsp;behaviour<br>
with&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;2.0.5&nbsp;rules&nbsp;until&nbsp;we've&nbsp;added&nbsp;a&nbsp;&amp;quot;pass&amp;quot;&nbsp;default&nbsp;action<br>
to&nbsp;this&nbsp;rule.&nbsp;So&nbsp;the&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;corrected&nbsp;rule&nbsp;should&nbsp;look&nbsp;like&nbsp;the&nbsp;following:&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;SecRule&nbsp;RESPONSE_BODY&nbsp;&amp;quot;!@pmFromFile&nbsp;modsecurity_50_outbound.data&amp;quot;<br>
\&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&amp;quot;phase:4,rev:'2.0.6',t:none,capture,t:urlDecodeUni,t:htmlEntityDecode,pass&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;,nolog,skipAfter:END_OUTBOUND_CHECK&amp;quot;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;Strange&nbsp;though.&nbsp;Maybe&nbsp;Ryan&nbsp;can&nbsp;comment&nbsp;on&nbsp;this.&lt;br&gt;<br>
&amp;gt;&nbsp;&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;Your&nbsp;comments&nbsp;are&nbsp;correct&nbsp;in&nbsp;that&nbsp;those&nbsp;@pmFromFile&nbsp;prequalifier&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;check&nbsp;rules&nbsp;were&nbsp;missing&nbsp;a&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;disruptive&nbsp;action&nbsp;specification&nbsp;(in&nbsp;this&nbsp;case&nbsp;-&nbsp;pass)&nbsp;and&nbsp;they&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;therefore&nbsp;inherited&nbsp;the&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;default&nbsp;one&nbsp;set&nbsp;in&nbsp;SecDefaultAction.&nbsp;&amp;nbsp;I&nbsp;did&nbsp;fix&nbsp;these&nbsp;missing<br>
ones&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;in&nbsp;the&nbsp;50&nbsp;outbound&nbsp;file&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;in&nbsp;the&nbsp;source&nbsp;however&nbsp;they&nbsp;are&nbsp;not&nbsp;in&nbsp;CRS&nbsp;2.0.6.&nbsp;&amp;nbsp;They&nbsp;will&nbsp;be<br>
in&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;v2.0.7.&nbsp;&amp;nbsp;In&nbsp;the&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;meantime,&nbsp;just&nbsp;manually&nbsp;add&nbsp;the&nbsp;&amp;quot;pass&amp;quot;&nbsp;action&nbsp;to&nbsp;those&nbsp;rules<br>
in&nbsp;the&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;50&nbsp;file&nbsp;that&nbsp;have&nbsp;a&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;ctl:skipAfter&nbsp;action.&lt;br&gt;<br>
&amp;gt;&nbsp;&lt;br&gt;<br>
&amp;gt;&nbsp;-Ryan&lt;br&gt;<br>
&lt;br&gt;<br>
Now&nbsp;it&nbsp;is&nbsp;clear.&nbsp;Thank&nbsp;you&nbsp;Ryan.&lt;/tt&gt;&lt;/font&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;&lt;font&nbsp;size=2&gt;&lt;tt&gt;wbr&lt;br&gt;<br>
Artyom&lt;br&gt;<br>
&lt;/tt&gt;&lt;/font&gt;
</tt>
