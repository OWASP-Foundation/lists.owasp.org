<tt>
&lt;div&gt;I&nbsp;have&nbsp;three&nbsp;questions&nbsp;concerning&nbsp;the&nbsp;changes&nbsp;that&nbsp;have&nbsp;been&nbsp;applied&nbsp;to&nbsp;the&nbsp;rule&nbsp;981176&nbsp;in&nbsp;order&nbsp;to&nbsp;add&nbsp;the&nbsp;last&nbsp;matched&nbsp;data&nbsp;in&nbsp;the&nbsp;log&nbsp;line.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;First,&nbsp;when&nbsp;ModSecurity&nbsp;is&nbsp;in&nbsp;&amp;quot;DetectionOnly&amp;quot;&nbsp;mode,&nbsp;the&nbsp;chained&nbsp;rule ( SecRule&nbsp;TX:/^\d/&nbsp;&amp;quot;(.*)&amp;quot;&nbsp;)&nbsp;that&nbsp;has&nbsp;been&nbsp;added is&nbsp;triggered&nbsp;as&nbsp;many&nbsp;times&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;variable&nbsp;names&nbsp;in&nbsp;the&nbsp;transaction&nbsp;collection&nbsp;that&nbsp;match&nbsp;the&nbsp;&amp;quot;^\d&amp;quot;&nbsp;regular&nbsp;expression.&nbsp;This&nbsp;makes&nbsp;ModSecurity&nbsp;log&nbsp;only&nbsp;one&nbsp;entry&nbsp;when&nbsp;it&amp;#39;s&nbsp;in&nbsp;the&nbsp;&amp;quot;Blocking&amp;quot;&nbsp;mode&nbsp;and&nbsp;lots&nbsp;of&nbsp;entries&nbsp;when&nbsp;in&nbsp;&amp;quot;DetectionOnly&amp;quot;&nbsp;mode.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;second&nbsp;issue&nbsp;with&nbsp;this&nbsp;chained&nbsp;rule&nbsp;is&nbsp;that&nbsp;the&nbsp;&amp;quot;^\d&amp;quot;&nbsp;regular&nbsp;expression&nbsp;is&nbsp;not&nbsp;discriminant&nbsp;enough&nbsp;as&nbsp;it&nbsp;matches&nbsp;the&nbsp;&amp;quot;capture&amp;quot;&nbsp;action&nbsp;variables&nbsp;&amp;quot;TX:0&amp;quot;,&nbsp;&amp;quot;TX:1&amp;quot;,&nbsp;...&nbsp;and&nbsp;&amp;quot;TX:9&amp;quot;&nbsp;when&nbsp;in&nbsp;&amp;quot;DetectionOnly&amp;quot;&nbsp;mod.&nbsp;A&nbsp;quick&nbsp;fix&nbsp;to&nbsp;avoid&nbsp;that&nbsp;would&nbsp;be&nbsp;replacing&nbsp;the&nbsp;regular&nbsp;expression&nbsp;by&nbsp;&amp;quot;^/d{2}&amp;quot;.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;last&nbsp;issue&nbsp;(still&nbsp;related&nbsp;to&nbsp;this&nbsp;chained&nbsp;rule;&nbsp;I&nbsp;think&nbsp;that&nbsp;I&nbsp;don&amp;#39;t&nbsp;like&nbsp;it&nbsp;much&nbsp;;-)&nbsp;)&nbsp;is&nbsp;that&nbsp;the&nbsp;&amp;quot;matched_var&amp;quot;&nbsp;variable&nbsp;does&nbsp;not&nbsp;really&nbsp;contain&nbsp;the&nbsp;&amp;quot;Last&nbsp;Matched&nbsp;Data&amp;quot;.&nbsp;In&nbsp;&amp;quot;DetectionOnly&amp;quot;&nbsp;mode,&nbsp;it&nbsp;will&nbsp;only&nbsp;be&nbsp;valid&nbsp;for&nbsp;the&nbsp;last&nbsp;logged&nbsp;line&nbsp;as&nbsp;it&nbsp;corresponds&nbsp;to&nbsp;the&nbsp;last&nbsp;matched&nbsp;rule&nbsp;and erroneous for&nbsp;all&nbsp;the&nbsp;other&nbsp;lines&nbsp;(Cf.&nbsp;first&nbsp;issue). In&nbsp;&amp;quot;Blocking&amp;quot;&nbsp;mode&nbsp;(as&nbsp;we&nbsp;log&nbsp;only&nbsp;once&nbsp;then&nbsp;the&nbsp;request&nbsp;is&nbsp;rejected&nbsp;if&nbsp;the&nbsp;score&nbsp;has&nbsp;exceeded)&nbsp;it&nbsp;will&nbsp;contain&nbsp;the&nbsp;matched&nbsp;data&nbsp;of&nbsp;the&nbsp;first&nbsp;rule&nbsp;that&nbsp;matched&nbsp;and&nbsp;the&nbsp;message&nbsp;(tx.msg)&nbsp;of&nbsp;the&nbsp;last&nbsp;one.&lt;/div&gt;<br>
&lt;div&gt;This&nbsp;produces&nbsp;misleading&nbsp;logs&nbsp;as&nbsp;the&nbsp;one&nbsp;below:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;[Wed&nbsp;Sep&nbsp;28&nbsp;18:44:53&nbsp;2011]&nbsp;[error]&nbsp;[client&nbsp;::1]&nbsp;ModSecurity:&nbsp;Warning.&nbsp;Pattern&nbsp;match&nbsp;&amp;quot;(.*)&amp;quot;&nbsp;at&nbsp;TX:959073-WEB_ATTACK/SQL_INJECTION-ARGS:test.&nbsp;[file&nbsp;&amp;quot;/etc/modsecurity/activated_rules/modsecurity_crs_49_inbound_blocking.conf&amp;quot;]&nbsp;[line&nbsp;&amp;quot;26&amp;quot;]&nbsp;[id&nbsp;&amp;quot;981176&amp;quot;]&nbsp;[msg&nbsp;&amp;quot;Inbound&nbsp;Anomaly&nbsp;Score&nbsp;Exceeded&nbsp;(Total&nbsp;Score:&nbsp;44,&nbsp;SQLi=15,&nbsp;XSS=30):&nbsp;&lt;b&gt;Last&nbsp;Matched&nbsp;Message:&nbsp;IE&nbsp;XSS&nbsp;Filters&nbsp;-&nbsp;Attack&nbsp;Detected&amp;quot;]&lt;/b&gt;&nbsp;&lt;b&gt;[data&nbsp;&amp;quot;Last&nbsp;Matched&nbsp;Data:&nbsp;benchmark(&amp;quot;]&lt;/b&gt;&nbsp;[hostname&nbsp;&amp;quot;localhost&amp;quot;]&nbsp;[uri&nbsp;&amp;quot;/&amp;quot;]&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;most&nbsp;rules&nbsp;use&nbsp;the&nbsp;&amp;quot;capture&amp;quot;&nbsp;action,&nbsp;why&nbsp;don&amp;#39;t&nbsp;we&nbsp;replace&nbsp;the&nbsp;chained&nbsp;rule&nbsp;&amp;quot;hack?&amp;quot;&nbsp;with&nbsp;a&nbsp;simple&nbsp;&amp;quot;logdata:&amp;#39;Last&nbsp;Matched&nbsp;Data:&nbsp;%{tx.0}&amp;quot;.&nbsp;This&nbsp;still&nbsp;would&nbsp;be&nbsp;better&nbsp;but&nbsp;still&nbsp;not&nbsp;perfect&nbsp;as&nbsp;the&nbsp;content&nbsp;will&nbsp;sometimes&nbsp;be&nbsp;erronuous&nbsp;because&nbsp;some&nbsp;rules&nbsp;can&amp;#39;t&nbsp;capture.&nbsp;Or,&nbsp;even&nbsp;cleaner,&nbsp;why&nbsp;don&amp;#39;t&nbsp;we&nbsp;add&nbsp;a&nbsp;&amp;quot;setvar:&amp;#39;tx.last_matched_data=...&amp;quot;&nbsp;in&nbsp;every&nbsp;rule?&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cheers,&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Rm4dillo&lt;/div&gt;<br>

</tt>
