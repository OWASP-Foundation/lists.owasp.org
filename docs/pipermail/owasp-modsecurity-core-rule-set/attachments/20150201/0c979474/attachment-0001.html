<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;Hi&nbsp;Ilyass,&lt;br&gt;&lt;/div&gt;the&nbsp;rule&nbsp;960035&nbsp;in&nbsp;the&nbsp;file&nbsp;modsecurity_crs_30_http_policy.conf,&nbsp;which&nbsp;is&nbsp;the&nbsp;one&nbsp;that&nbsp;uses&nbsp;the&nbsp;restricted_extensions&nbsp;variable,&nbsp;bases&nbsp;its&nbsp;match&nbsp;on&nbsp;the&nbsp;REQUEST_BASENAME,&nbsp;that&nbsp;is&nbsp;&quot;the&nbsp;filename&nbsp;part&nbsp;of&nbsp;REQUEST_FILENAME&quot;&nbsp;(&lt;a&nbsp;href=&quot;https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BASENAME&quot;&gt;https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BASENAME&lt;/a&gt;).&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;File&nbsp;uploads&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;POST&nbsp;request,&nbsp;and&nbsp;then&nbsp;the&nbsp;basename&nbsp;is&nbsp;that&nbsp;of&nbsp;the&nbsp;script&nbsp;which&nbsp;orchestrates&nbsp;the&nbsp;upload.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;/div&gt;I&nbsp;would&nbsp;suggest&nbsp;you&nbsp;to&nbsp;intercept&nbsp;your&nbsp;upload&nbsp;request&nbsp;with&nbsp;a&nbsp;tool&nbsp;such&nbsp;as&nbsp;ZAP&nbsp;by&nbsp;OWASP,&nbsp;and&nbsp;identify&nbsp;the&nbsp;process&nbsp;of&nbsp;the&nbsp;uploads&nbsp;in&nbsp;your&nbsp;application.&lt;br&gt;&lt;br&gt;&lt;/div&gt;For&nbsp;example,&nbsp;you&nbsp;may&nbsp;find&nbsp;a&nbsp;request&nbsp;like&nbsp;this:&lt;br&gt;&lt;br&gt;POST&nbsp;&lt;a&nbsp;href=&quot;http://mysite/upload.php&quot;&gt;http://mysite/upload.php&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64;&nbsp;rv:34.0)&nbsp;Gecko/20100101&nbsp;Firefox/34.0&lt;br&gt;Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;br&gt;Accept-Language:&nbsp;en-US,en;q=0.5&lt;br&gt;Referer:&nbsp;&lt;a&nbsp;href=&quot;http://mysite/contentadmin.php&quot;&gt;http://mysite/contentadmin.php&lt;/a&gt;&lt;br&gt;Content-Length:&nbsp;15748&lt;br&gt;Content-Type:&nbsp;multipart/form-data;&nbsp;boundary=---------------------------100259790820425171131264960&lt;br&gt;&lt;/div&gt;Host:&nbsp;mysite&lt;br&gt;&lt;br&gt;&lt;/div&gt;The&nbsp;content-type&nbsp;is&nbsp;multipart&nbsp;so,&nbsp;in&nbsp;the&nbsp;body,&nbsp;there&nbsp;will&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;separated&nbsp;by&nbsp;the&nbsp;boundary&nbsp;identifier.&nbsp;Among&nbsp;these,&nbsp;there&nbsp;is&nbsp;the&nbsp;one&nbsp;referred&nbsp;to&nbsp;a&nbsp;png&nbsp;image:&lt;br&gt;&lt;br&gt;-----------------------------100259790820425171131264960<br>
&lt;br&gt;Content-Disposition:&nbsp;form-data;&nbsp;name=&quot;upload&quot;;&nbsp;filename=&quot;waf.png&quot;<br>
&lt;br&gt;Content-Type:&nbsp;image/png<br>
&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;In&nbsp;this&nbsp;case&nbsp;you&nbsp;should&nbsp;have&nbsp;to&nbsp;write&nbsp;rules&nbsp;acting&nbsp;on&nbsp;phase&nbsp;2&nbsp;body&nbsp;content,&nbsp;checking&nbsp;the&nbsp;filename&nbsp;and&nbsp;content-type&nbsp;headers.&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Hope&nbsp;this&nbsp;could&nbsp;be&nbsp;of&nbsp;any&nbsp;help&nbsp;for&nbsp;you&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Paolo&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left:1px&nbsp;solid&nbsp;rgb(204,204,204);padding-left:1ex&quot;&gt;<br>
Hi&nbsp;,&lt;br&gt;<br>
&lt;br&gt;<br>
How&nbsp;can&nbsp;I&nbsp;block&nbsp;upload&nbsp;a&nbsp;specific&nbsp;file&nbsp;such&nbsp;as&nbsp;(.jsp/.php)&lt;br&gt;<br>
I&nbsp;configured&nbsp;this&nbsp;rule&nbsp;:&lt;br&gt;<br>
/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_30_http_policy.conf&lt;br&gt;<br>
&lt;br&gt;<br>
with&nbsp;this&nbsp;:&lt;br&gt;<br>
&lt;br&gt;<br>
SecAction&nbsp;\&lt;br&gt;<br>
 &nbsp;&quot;id:&#39;900012&#39;,&nbsp;\&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;phase:1,&lt;br&gt;<br>
\&lt;br&gt;<br>
 &nbsp;t:none,&nbsp;\&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;setvar:&#39;tx.allowed_methods=GET&nbsp;HEAD&nbsp;POST&nbsp;OPTIONS&#39;,&nbsp;\&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
setvar:&#39;tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json&#39;,&lt;br&gt;<br>
\&lt;br&gt;<br>
 &nbsp;setvar:&#39;tx.allowed_http_versions=HTTP/0.9&nbsp;HTTP/1.0&nbsp;HTTP/1.1&#39;,&nbsp;\&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;setvar:&#39;tx.restricted_extensions=.asa/&nbsp;.jsp/&nbsp;.asax/&nbsp;.ascx/&nbsp;.axd/&nbsp;.backup/&lt;br&gt;<br>
.bak/&nbsp;.bat/&nbsp;.cdx/&nbsp;.cer/&nbsp;.cfg/&nbsp;.cmd/&nbsp;.com/&nbsp;.config/&nbsp;.conf/&nbsp;.cs/&nbsp;.csproj/&lt;br&gt;<br>
.csr/&nbsp;.dat/&nbsp;.db/&nbsp;.dbf/&nbsp;.dll/&nbsp;.dos/&nbsp;.htr/&nbsp;.htw/&nbsp;.ida/&nbsp;\&lt;br&gt;<br>
.idc/&nbsp;.idq/&nbsp;.inc/&nbsp;.ini/&nbsp;.key/&nbsp;.licx/&nbsp;.lnk/&nbsp;.log/&nbsp;.mdb/&nbsp;.old/&nbsp;.pass/&nbsp;.pdb/&lt;br&gt;<br>
.pol/&nbsp;.printer/&nbsp;.pwd/&nbsp;.resources/&nbsp;.resx/&nbsp;.sql/&nbsp;.sys/&nbsp;.vb/&nbsp;.vbs/&nbsp;.vbproj/&lt;br&gt;<br>
.vsdisco/&nbsp;.webinfo/&nbsp;.xsd/&nbsp;.xsx/&#39;,&nbsp;\&lt;br&gt;<br>
 &nbsp;setvar:&#39;tx.restricted_headers=/Proxy-Connection/&nbsp;/Lock-Token/&lt;br&gt;<br>
/Content-Range/&nbsp;/Translate/&nbsp;/via/&nbsp;/if/&#39;,&nbsp;\&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;nolog,&nbsp;\&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp;pass&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
?But&nbsp;it&#39;s&nbsp;don&#39;t&nbsp;stop&nbsp;upload&nbsp;.jsp&nbsp;file.&lt;br&gt;<br>
&lt;br&gt;<br>
Have&nbsp;you&nbsp;any&nbsp;idea&nbsp;?&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you?&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
