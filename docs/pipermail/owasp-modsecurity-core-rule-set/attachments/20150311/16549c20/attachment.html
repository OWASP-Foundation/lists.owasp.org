<tt>
&lt;html&gt;<br>
&lt;head&gt;<br>
&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=us-ascii&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&nbsp;color:&nbsp;rgb(0,&nbsp;0,&nbsp;0);&nbsp;font-size:&nbsp;14px;&nbsp;font-family:&nbsp;Calibri,&nbsp;sans-serif;&quot;&gt;<br>
&lt;div&gt;It&nbsp;should&nbsp;be&nbsp;noted&nbsp;for&nbsp;the&nbsp;purposes&nbsp;of&nbsp;this&nbsp;discussion&nbsp;that&nbsp;there&nbsp;is&nbsp;an&nbsp;experimental&nbsp;build&nbsp;of&nbsp;mod&nbsp;security&nbsp;with&nbsp;memcache&nbsp;support&nbsp;(&lt;a&nbsp;href=&quot;https://github.com/SpiderLabs/ModSecurity/tree/memcache_collections&quot;&gt;https://github.com/SpiderLabs/ModSecurity/tree/memcache_collections&lt;/a&gt;).&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;span&nbsp;id=&quot;OLK_SRC_BODY_SECTION&quot;&gt;<br>
&lt;div&nbsp;style=&quot;font-family:Calibri;&nbsp;font-size:11pt;&nbsp;text-align:left;&nbsp;color:black;&nbsp;BORDER-BOTTOM:&nbsp;medium&nbsp;none;&nbsp;BORDER-LEFT:&nbsp;medium&nbsp;none;&nbsp;PADDING-BOTTOM:&nbsp;0in;&nbsp;PADDING-LEFT:&nbsp;0in;&nbsp;PADDING-RIGHT:&nbsp;0in;&nbsp;BORDER-TOP:&nbsp;#b5c4df&nbsp;1pt&nbsp;solid;&nbsp;BORDER-RIGHT:&nbsp;medium&nbsp;none;&nbsp;PADDING-TOP:&nbsp;3pt&quot;&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;From:&nbsp;&lt;/span&gt;Josh&nbsp;Amishav-Zlatin&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:jamuse@owasp.org&quot;&gt;jamuse@owasp.org&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Date:&nbsp;&lt;/span&gt;Wednesday,&nbsp;March&nbsp;11,&nbsp;2015&nbsp;at&nbsp;4:37&nbsp;AM&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;To:&nbsp;&lt;/span&gt;Barry&nbsp;Pollard&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:barry_pollard@hotmail.com&quot;&gt;barry_pollard@hotmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Cc:&nbsp;&lt;/span&gt;Chaim&nbsp;Sanders&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:csanders@trustwave.com&quot;&gt;csanders@trustwave.com&lt;/a&gt;&gt;,&nbsp;&quot;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&quot;&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;span&nbsp;style=&quot;font-weight:bold&quot;&gt;Subject:&nbsp;&lt;/span&gt;Re:&nbsp;[Owasp-modsecurity-core-rule-set]&nbsp;Questions&nbsp;about&nbsp;modsecurity_crs_11_dos_protection.conf&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&gt;<br>
&lt;div&gt;<br>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;Hi&nbsp;Barry,&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;FWIW,&nbsp;we've&nbsp;run&nbsp;into&nbsp;similar&nbsp;issues&nbsp;and&nbsp;re-implemented&nbsp;some&nbsp;rules&nbsp;to&nbsp;use&nbsp;Redis&nbsp;for&nbsp;storage&nbsp;instead.&nbsp;This&nbsp;had&nbsp;to&nbsp;be&nbsp;implemented&nbsp;via&nbsp;Lua&nbsp;scripting&nbsp;though,&nbsp;which&nbsp;takes&nbsp;a&nbsp;slight&nbsp;performance&nbsp;hit.&nbsp;Having&nbsp;said&nbsp;that,&nbsp;there&nbsp;is&nbsp;an&nbsp;open&nbsp;ticket<br>
&nbsp;to&nbsp;implement&nbsp;an&nbsp;alternative&nbsp;shared&nbsp;persistent&nbsp;storage&nbsp;mechanism:&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;a&nbsp;href=&quot;http://scanmail.trustwave.com/?c=4062&amp;d=zP7_1EIfkGQmqzNdTgH9sZIg1Bsu-kZ-wPR_Yvt2BA&amp;s=5&amp;u=https%3a%2f%2fgithub%2ecom%2fSpiderLabs%2fModSecurity%2fissues%2f378&quot;&gt;https://github.com/SpiderLabs/ModSecurity/issues/378&lt;/a&gt;&nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;--&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&nbsp;-&nbsp;Josh&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Wed,&nbsp;Mar&nbsp;11,&nbsp;2015&nbsp;at&nbsp;9:49&nbsp;AM,&nbsp;Barry&nbsp;Pollard&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;<br>
&lt;&lt;a&nbsp;href=&quot;mailto:barry_pollard@hotmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;barry_pollard@hotmail.com&lt;/a&gt;&gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;border-left-width:1px;border-left-color:rgb(204,204,204);border-left-style:solid;padding-left:1ex&quot;&gt;<br>
Thanks&nbsp;for&nbsp;those&nbsp;answers&nbsp;Chaim.&nbsp;Make&nbsp;sense&nbsp;to&nbsp;me.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;do&nbsp;think&nbsp;the&nbsp;use&nbsp;of&nbsp;SDBM&nbsp;for&nbsp;storage&nbsp;for&nbsp;large&nbsp;scale&nbsp;tracking&nbsp;like&nbsp;for&nbsp;IP&nbsp;addresses&nbsp;is&nbsp;a&nbsp;problem&nbsp;(with&nbsp;ModSecurity&nbsp;rather&nbsp;than&nbsp;with&nbsp;the&nbsp;core&nbsp;rule&nbsp;set&nbsp;but&nbsp;not&nbsp;that&nbsp;that&nbsp;matters).&nbsp;Unfortunately&nbsp;it&nbsp;just&nbsp;doesn't&nbsp;work&nbsp;for&nbsp;even&nbsp;relatively&nbsp;small&nbsp;amounts&nbsp;of&nbsp;traffic.&lt;br&gt;<br>
&lt;br&gt;<br>
Not&nbsp;sure&nbsp;how&nbsp;you&nbsp;could&nbsp;resolve&nbsp;it&nbsp;and&nbsp;I&nbsp;know&nbsp;nothing&nbsp;about&nbsp;ModSecurity&nbsp;is&nbsp;written,&nbsp;or&nbsp;about&nbsp;writing&nbsp;really&nbsp;high&nbsp;performing&nbsp;systems&nbsp;like&nbsp;this,&nbsp;but&nbsp;came&nbsp;up&nbsp;with&nbsp;below&nbsp;suggestions&nbsp;after&nbsp;a&nbsp;bit&nbsp;of&nbsp;a&nbsp;think.&nbsp;Not&nbsp;sure&nbsp;how&nbsp;feasible&nbsp;any&nbsp;of&nbsp;these&nbsp;are.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Split&nbsp;out&nbsp;IP.pag&nbsp;into&nbsp;several&nbsp;files&nbsp;based&nbsp;on&nbsp;hashed&nbsp;IP&nbsp;address&nbsp;so&nbsp;bottle&nbsp;neck&nbsp;is&nbsp;not&nbsp;on&nbsp;one&nbsp;file.&nbsp;Would&nbsp;need&nbsp;to&nbsp;be&nbsp;hashed&nbsp;IP&nbsp;address&nbsp;in&nbsp;case&nbsp;your&nbsp;customer&nbsp;based&nbsp;is&nbsp;skewed&nbsp;towards&nbsp;certain&nbsp;IP&nbsp;ranges.&nbsp;Could&nbsp;also&nbsp;configure&nbsp;number&nbsp;of&nbsp;files&nbsp;to&nbsp;split&nbsp;across,&nbsp;so<br>
&nbsp;busier&nbsp;sites&nbsp;have&nbsp;larger&nbsp;number&nbsp;of&nbsp;IP.pag&nbsp;files,&nbsp;if&nbsp;the&nbsp;hashing&nbsp;algorithm&nbsp;could&nbsp;take&nbsp;that&nbsp;config&nbsp;number&nbsp;into&nbsp;account.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Have&nbsp;a&nbsp;minimum&nbsp;update&nbsp;time&nbsp;e.g.&nbsp;If&nbsp;hit&nbsp;from&nbsp;IP&nbsp;in&nbsp;last&nbsp;1&nbsp;second&nbsp;then&nbsp;don't&nbsp;bother&nbsp;saving&nbsp;another&nbsp;hit&nbsp;as&nbsp;record&nbsp;is&nbsp;reasonably&nbsp;up&nbsp;to&nbsp;date.&nbsp;Again&nbsp;time&nbsp;could&nbsp;be&nbsp;configurable.&nbsp;Would&nbsp;obviously&nbsp;impact&nbsp;any&nbsp;DoS/Brute&nbsp;force&nbsp;rules&nbsp;since&nbsp;we'd&nbsp;be&nbsp;filtering&nbsp;out&nbsp;hits&nbsp;here.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Make&nbsp;it&nbsp;easier&nbsp;to&nbsp;ignore&nbsp;the&nbsp;problem&nbsp;by&nbsp;ignoring&nbsp;certain&nbsp;alerts&nbsp;(e.g.&nbsp;deleting&nbsp;stale&nbsp;collections&nbsp;fails...&nbsp;etc.)&nbsp;unless&nbsp;in&nbsp;high&nbsp;log&nbsp;level,&nbsp;and&nbsp;add&nbsp;a&nbsp;safe&nbsp;way&nbsp;of&nbsp;ModSecurity&nbsp;clearing&nbsp;down&nbsp;the&nbsp;file&nbsp;and&nbsp;starting&nbsp;again&nbsp;at&nbsp;certain&nbsp;times&nbsp;(e.g.&nbsp;daily/weekly)&nbsp;or&nbsp;after<br>
&nbsp;it&nbsp;reaches&nbsp;a&nbsp;certain&nbsp;size.&nbsp;Massive&nbsp;fudge&nbsp;but&nbsp;could&nbsp;be&nbsp;short&nbsp;term&nbsp;solution.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Use&nbsp;some&nbsp;other&nbsp;persistent&nbsp;storage.&nbsp;Though&nbsp;I'd&nbsp;imagine,&nbsp;given&nbsp;the&nbsp;potential&nbsp;rate&nbsp;of&nbsp;data&nbsp;updates&nbsp;for&nbsp;a&nbsp;busy&nbsp;site,&nbsp;this&nbsp;would&nbsp;also&nbsp;be&nbsp;a&nbsp;problem&nbsp;in&nbsp;whatever&nbsp;we&nbsp;move&nbsp;to.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Use&nbsp;in-memory&nbsp;storage&nbsp;-&nbsp;though&nbsp;guess&nbsp;that&nbsp;would&nbsp;raise&nbsp;questions&nbsp;on&nbsp;memory&nbsp;requirements&nbsp;and&nbsp;how&nbsp;to&nbsp;share&nbsp;between&nbsp;different&nbsp;threads/processes.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Have&nbsp;dedicated&nbsp;process/program&nbsp;to&nbsp;manage&nbsp;collections&nbsp;that&nbsp;all&nbsp;other&nbsp;threads/processes&nbsp;talk&nbsp;via.&nbsp;Could&nbsp;address&nbsp;some&nbsp;of&nbsp;the&nbsp;issues&nbsp;with&nbsp;in&nbsp;using&nbsp;in-memory&nbsp;storage&nbsp;raised&nbsp;above.&nbsp;Then&nbsp;again&nbsp;could&nbsp;bring&nbsp;in&nbsp;whole&nbsp;raft&nbsp;of&nbsp;other&nbsp;problems&nbsp;:-)&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Store&nbsp;less.&nbsp;Collections&nbsp;do&nbsp;seem&nbsp;to&nbsp;be&nbsp;quite&nbsp;large.&nbsp;Could&nbsp;you&nbsp;have&nbsp;a&nbsp;minimal&nbsp;set&nbsp;for&nbsp;things&nbsp;like&nbsp;IP&nbsp;address&nbsp;with&nbsp;just&nbsp;last&nbsp;access&nbsp;time/num&nbsp;hits?&nbsp;For&nbsp;rules&nbsp;that&nbsp;require&nbsp;more&nbsp;things&nbsp;tracked&nbsp;(e.g.&nbsp;Brute&nbsp;force&nbsp;attempts&nbsp;on&nbsp;a&nbsp;specific&nbsp;URL)&nbsp;they&nbsp;could&nbsp;be&nbsp;tracked<br>
&nbsp;in&nbsp;a&nbsp;separate&nbsp;&quot;full&quot;&nbsp;collection&nbsp;which&nbsp;would&nbsp;have&nbsp;a&nbsp;larger&nbsp;record&nbsp;set,&nbsp;but&nbsp;with&nbsp;less&nbsp;entries.&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Reduce&nbsp;blocking&nbsp;time&nbsp;in&nbsp;code&nbsp;making&nbsp;the&nbsp;SDBM&nbsp;update.&nbsp;Imagine&nbsp;the&nbsp;code&nbsp;is&nbsp;probably&nbsp;pretty&nbsp;tight&nbsp;here&nbsp;already&nbsp;but&nbsp;obviously&nbsp;any&nbsp;reduction&nbsp;here&nbsp;would&nbsp;have&nbsp;benefit.&nbsp;Had&nbsp;a&nbsp;quick&nbsp;look&nbsp;myself&nbsp;(more&nbsp;out&nbsp;of&nbsp;nosiness)&nbsp;but&nbsp;the&nbsp;C&nbsp;code&nbsp;scared&nbsp;me&nbsp;too&nbsp;much&nbsp;(been&nbsp;a&nbsp;while!).&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;Look&nbsp;into&nbsp;how&nbsp;other&nbsp;modules&nbsp;(e.g.&nbsp;mod_evasive)&nbsp;handle&nbsp;this&nbsp;problem&nbsp;to&nbsp;see&nbsp;if&nbsp;can&nbsp;learn&nbsp;anything&nbsp;from&nbsp;them.&lt;br&gt;<br>
&lt;br&gt;<br>
Am&nbsp;sure&nbsp;you've&nbsp;probably&nbsp;already&nbsp;considered&nbsp;these&nbsp;and&nbsp;better&nbsp;solutions&nbsp;but&nbsp;thought&nbsp;I'd&nbsp;suggest&nbsp;them&nbsp;anyway.&lt;br&gt;<br>
&lt;br&gt;<br>
Thanks,&lt;br&gt;<br>
Barry&lt;br&gt;<br>
&lt;br&gt;<br>
&gt;&nbsp;On&nbsp;11&nbsp;Mar&nbsp;2015,&nbsp;at&nbsp;03:54,&nbsp;Chaim&nbsp;Sanders&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:CSanders@trustwave.com&quot;&gt;CSanders@trustwave.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;we&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;&quot;&gt;<br>
&lt;div&nbsp;class=&quot;h5&quot;&gt;_______________________________________________&lt;br&gt;<br>
Owasp-modsecurity-core-rule-set&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;Owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://scanmail.trustwave.com/?c=4062&amp;d=zP7_1EIfkGQmqzNdTgH9sZIg1Bsu-kZ-wKcqY65yWQ&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;/a&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/div&gt;<br>
&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/div&gt;<br>
&lt;/span&gt;&lt;br&gt;<br>
&lt;hr&gt;<br>
&lt;font&nbsp;face=&quot;Arial&quot;&nbsp;color=&quot;Gray&quot;&nbsp;size=&quot;1&quot;&gt;&lt;br&gt;<br>
This&nbsp;transmission&nbsp;may&nbsp;contain&nbsp;information&nbsp;that&nbsp;is&nbsp;privileged,&nbsp;confidential,&nbsp;and/or&nbsp;exempt&nbsp;from&nbsp;disclosure&nbsp;under&nbsp;applicable&nbsp;law.&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;the&nbsp;intended&nbsp;recipient,&nbsp;you&nbsp;are&nbsp;hereby&nbsp;notified&nbsp;that&nbsp;any&nbsp;disclosure,&nbsp;copying,&nbsp;distribution,&nbsp;or&nbsp;use&nbsp;of&nbsp;the&nbsp;information<br>
&nbsp;contained&nbsp;herein&nbsp;(including&nbsp;any&nbsp;reliance&nbsp;thereon)&nbsp;is&nbsp;strictly&nbsp;prohibited.&nbsp;If&nbsp;you&nbsp;received&nbsp;this&nbsp;transmission&nbsp;in&nbsp;error,&nbsp;please&nbsp;immediately&nbsp;contact&nbsp;the&nbsp;sender&nbsp;and&nbsp;destroy&nbsp;the&nbsp;material&nbsp;in&nbsp;its&nbsp;entirety,&nbsp;whether&nbsp;in&nbsp;electronic&nbsp;or&nbsp;hard&nbsp;copy&nbsp;format.&lt;br&gt;<br>
&lt;/font&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
