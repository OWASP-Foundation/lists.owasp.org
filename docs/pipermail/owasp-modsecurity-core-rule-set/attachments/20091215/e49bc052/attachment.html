<tt>
&lt;!DOCTYPE&nbsp;html&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
&nbsp;&nbsp;&lt;meta&nbsp;content=&quot;text/html;charset=UTF-8&quot;&nbsp;http-equiv=&quot;Content-Type&quot;&gt;<br>
&nbsp;&nbsp;&lt;title&gt;&lt;/title&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
thank&nbsp;you&nbsp;so&nbsp;much.&nbsp;it's&nbsp;work&nbsp;now&nbsp;.according&nbsp;the&nbsp;example,&nbsp;I&nbsp;have&nbsp;more<br>
clean&nbsp;understand&nbsp;about&nbsp;the&nbsp;48_local_exceptions.conf.&lt;br&gt;<br>
BTW,&nbsp;according &nbsp;to&nbsp;this&nbsp;way&nbsp;to&nbsp;reduce&nbsp;the&nbsp;FALSE&nbsp;positive.I&nbsp;doubt&nbsp;it&nbsp;in<br>
this&nbsp;situation&nbsp;.the&nbsp;modsecurity&nbsp;protect&nbsp;multiple&nbsp;website&nbsp;.In&nbsp;the&nbsp;A<br>
website&nbsp;,the&nbsp;website&nbsp;structure &nbsp;have&nbsp;some&nbsp;keyword&nbsp;which&nbsp;course&nbsp;the<br>
FALSE&nbsp;positive&nbsp;easy&nbsp;.but&nbsp;the&nbsp;B&nbsp;website&nbsp;is&nbsp;not.&nbsp;when&nbsp;I&nbsp;want&nbsp;to&nbsp;reduce<br>
the&nbsp;FALSE&nbsp;positive&nbsp;based&nbsp;the&nbsp;website&nbsp;.how&nbsp;to&nbsp;do&nbsp;in&nbsp;this&nbsp;situation&nbsp;.&lt;br&gt;<br>
&lt;br&gt;<br>
于&nbsp;2009-12-11&nbsp;22:09,&nbsp;Ryan&nbsp;Barnett&nbsp;写道:<br>
&lt;blockquote&nbsp;cite=&quot;mid:200912110909.02392.ryan.barnett@breach.com&quot;<br>
&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;On&nbsp;Thursday&nbsp;10&nbsp;December&nbsp;2009&nbsp;08:35:21&nbsp;pm&nbsp;ll&nbsp;wrote:<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;Yes&nbsp;,I'm&nbsp;reading&nbsp;the&nbsp;48&nbsp;local&nbsp;excetions.but&nbsp;still&nbsp;confuse.here&nbsp;is&nbsp;my<br>
&nbsp;auditlog,&nbsp;thanks&nbsp;your&nbsp;help.I&nbsp;just&nbsp;want&nbsp;to&nbsp;disable&nbsp;this&nbsp;rule&nbsp;for&nbsp;this&nbsp;url<br>
&nbsp;(/news/abc.swf?id=20091211&amp;amp;style=3)&nbsp;,other&nbsp;website&nbsp;still&nbsp;need&nbsp;to&nbsp;be<br>
&nbsp;inspect<br>
--cecdfa17-A--<br>
[10/Dec/2009:16:22:14&nbsp;+0800]&nbsp;SyCvtdJMQTgAABXDVjcAAAAC&nbsp;127.0.0.1&nbsp;60252<br>
&nbsp;127.0.0.1&nbsp;8000&nbsp;--cecdfa17-B--<br>
GET&nbsp;/news/abc.swf?id=20091211&amp;amp;style=3&nbsp;HTTP/1.1<br>
Accept:&nbsp;*/*<br>
Referer:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-freetext&quot;&nbsp;href=&quot;http://www.abc.com/news/index.html&quot;&gt;http://www.abc.com/news/index.html&lt;/a&gt;<br>
Accept-Language:&nbsp;zh-cn<br>
UA-CPU:&nbsp;x86<br>
Accept-Encoding:&nbsp;gzip,&nbsp;deflate<br>
User-Agent:&nbsp;Mozilla/4.0&nbsp;()<br>
Host:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;http://www.abc.com&quot;&gt;www.abc.com&lt;/a&gt;&lt;a&nbsp;class=&quot;moz-txt-link-rfc2396E&quot;&nbsp;href=&quot;http://www.abc.com&quot;&gt;&amp;lt;http://www.abc.com&amp;gt;&lt;/a&gt;<br>
Cookie:&nbsp;JSESSIONID=869946B0D9D6C75C3600E22E54A2C172<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&lt;/pre&gt;<br>
&nbsp;&nbsp;&lt;/blockquote&gt;<br>
&nbsp;&nbsp;&lt;pre&nbsp;wrap=&quot;&quot;&gt;&lt;!----&gt;<br>
If&nbsp;you&nbsp;look&nbsp;in&nbsp;your&nbsp;debug&nbsp;log&nbsp;when&nbsp;this&nbsp;match&nbsp;occurs,&nbsp;you&nbsp;will&nbsp;see&nbsp;a&nbsp;line&nbsp;like&nbsp;<br>
this&nbsp;where&nbsp;it&nbsp;is&nbsp;setting&nbsp;the&nbsp;TX&nbsp;variable&nbsp;-<br>
<br>
[9]&nbsp;Set&nbsp;variable&nbsp;&quot;tx.-WEB_ATTACK/XSS-REQUEST_URI_RAW&quot;&nbsp;to&nbsp;<br>
&quot;/news/abc.swf?id=20091211&amp;amp;style=3&quot;.<br>
<br>
You&nbsp;can&nbsp;now&nbsp;use&nbsp;this&nbsp;TX&nbsp;data&nbsp;to&nbsp;create&nbsp;the&nbsp;following&nbsp;exception&nbsp;rule&nbsp;in&nbsp;the&nbsp;<br>
modsecurity_crs_48_local_exceptions.conf&nbsp;file&nbsp;(keep&nbsp;in&nbsp;mind&nbsp;that&nbsp;this&nbsp;is&nbsp;a&nbsp;<br>
chained&nbsp;rule&nbsp;with&nbsp;2&nbsp;SecRules&nbsp;and&nbsp;they&nbsp;should&nbsp;be&nbsp;on&nbsp;two&nbsp;lines&nbsp;so&nbsp;make&nbsp;sure&nbsp;to&nbsp;<br>
correct&nbsp;this&nbsp;if&nbsp;copy/pasting&nbsp;from&nbsp;email)&nbsp;-<br>
<br>
SecRule&nbsp;TX:-WEB_ATTACK/XSS-REQUEST_URI_RAW&nbsp;<br>
&quot;^\/news\/abc\.swf\?id=\d+&amp;amp;style=\d+$&quot;&nbsp;&quot;chain,phase:2,t:none,nolog,pass&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SecRule&nbsp;MATCHED_VAR_NAME&nbsp;&quot;TX\:(.*)&quot;&nbsp;&quot;capture,t:none,setvar:!tx.<br>
%{tx.1},setvar:tx.anomaly_score=-20&quot;<br>
<br>
This&nbsp;will&nbsp;look&nbsp;for&nbsp;this&nbsp;exact&nbsp;TX&nbsp;variable&nbsp;name&nbsp;with&nbsp;a&nbsp;regex&nbsp;for&nbsp;the&nbsp;URI&nbsp;<br>
payload&nbsp;(which&nbsp;allows&nbsp;for&nbsp;digit&nbsp;payloads&nbsp;both&nbsp;the&nbsp;id&nbsp;and&nbsp;style&nbsp;parameters).&nbsp;&nbsp;<br>
If&nbsp;there&nbsp;is&nbsp;a&nbsp;match,&nbsp;it&nbsp;will&nbsp;remove&nbsp;this&nbsp;TX&nbsp;variable&nbsp;and&nbsp;decrease&nbsp;the&nbsp;anomaly&nbsp;<br>
score&nbsp;by&nbsp;20.&nbsp;&nbsp;Here&nbsp;is&nbsp;the&nbsp;debug&nbsp;log&nbsp;show&nbsp;the&nbsp;exception&nbsp;in&nbsp;action&nbsp;-<br>
<br>
<br>
[4]&nbsp;Recipe:&nbsp;Invoking&nbsp;rule&nbsp;b8a6248;&nbsp;[file&nbsp;<br>
&quot;/usr/local/apache/conf/modsecurity_crs-2.0.4/base_rules/modsecurity_crs_48_local_exceptions.conf&quot;]&nbsp;<br>
[line&nbsp;&quot;44&quot;].<br>
[5]&nbsp;Rule&nbsp;b8a6248:&nbsp;SecRule&nbsp;&quot;TX:-WEB_ATTACK/XSS-REQUEST_URI_RAW&quot;&nbsp;&quot;@rx&nbsp;<br>
^\\/news\\/abc\\.swf\\?id=\\d+&amp;amp;style=\\d+$&quot;&nbsp;&quot;phase:2,chain,t:none,nolog,pass&quot;<br>
[4]&nbsp;Transformation&nbsp;completed&nbsp;in&nbsp;2&nbsp;usec.<br>
[4]&nbsp;Executing&nbsp;operator&nbsp;&quot;rx&quot;&nbsp;with&nbsp;param&nbsp;<br>
&quot;^\\/news\\/abc\\.swf\\?id=\\d+&amp;amp;style=\\d+$&quot;&nbsp;against&nbsp;TX:-WEB_ATTACK/XSS-<br>
REQUEST_URI_RAW.<br>
[9]&nbsp;Target&nbsp;value:&nbsp;&quot;/news/abc.swf?id=20091211&amp;amp;style=3&quot;<br>
[4]&nbsp;Operator&nbsp;completed&nbsp;in&nbsp;6&nbsp;usec.<br>
[4]&nbsp;Rule&nbsp;returned&nbsp;1.<br>
[9]&nbsp;Match&nbsp;-&amp;gt;&nbsp;mode&nbsp;NEXT_RULE.<br>
[4]&nbsp;Recipe:&nbsp;Invoking&nbsp;rule&nbsp;b8a6b10;&nbsp;[file&nbsp;<br>
&quot;/usr/local/apache/conf/modsecurity_crs-2.0.4/base_rules/modsecurity_crs_48_local_exceptions.conf&quot;]&nbsp;<br>
[line&nbsp;&quot;45&quot;].<br>
[5]&nbsp;Rule&nbsp;b8a6b10:&nbsp;SecRule&nbsp;&quot;MATCHED_VAR_NAME&quot;&nbsp;&quot;@rx&nbsp;TX\\:(.*)&quot;&nbsp;<br>
&quot;capture,t:none,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-20&quot;<br>
[4]&nbsp;Transformation&nbsp;completed&nbsp;in&nbsp;2&nbsp;usec.<br>
[4]&nbsp;Executing&nbsp;operator&nbsp;&quot;rx&quot;&nbsp;with&nbsp;param&nbsp;&quot;TX\\:(.*)&quot;&nbsp;against&nbsp;MATCHED_VAR_NAME.<br>
[9]&nbsp;Target&nbsp;value:&nbsp;&quot;TX:-WEB_ATTACK/XSS-REQUEST_URI_RAW&quot;<br>
[9]&nbsp;Added&nbsp;regex&nbsp;subexpression&nbsp;to&nbsp;TX.0:&nbsp;TX:-WEB_ATTACK/XSS-REQUEST_URI_RAW<br>
[9]&nbsp;Added&nbsp;regex&nbsp;subexpression&nbsp;to&nbsp;TX.1:&nbsp;-WEB_ATTACK/XSS-REQUEST_URI_RAW<br>
[4]&nbsp;Operator&nbsp;completed&nbsp;in&nbsp;36&nbsp;usec.<br>
[9]&nbsp;Setting&nbsp;variable:&nbsp;!tx.%{tx.1}=1<br>
[9]&nbsp;Resolved&nbsp;macro&nbsp;%{tx.1}&nbsp;to&nbsp;&quot;-WEB_ATTACK/XSS-REQUEST_URI_RAW&quot;<br>
[9]&nbsp;Unset&nbsp;variable&nbsp;&quot;tx.-WEB_ATTACK/XSS-REQUEST_URI_RAW&quot;.<br>
[9]&nbsp;Setting&nbsp;variable:&nbsp;tx.anomaly_score=-20<br>
[9]&nbsp;Original&nbsp;collection&nbsp;variable:&nbsp;tx.anomaly_score&nbsp;=&nbsp;&quot;20&quot;<br>
[9]&nbsp;Relative&nbsp;change:&nbsp;anomaly_score=20-20<br>
[9]&nbsp;Set&nbsp;variable&nbsp;&quot;tx.anomaly_score&quot;&nbsp;to&nbsp;&quot;0&quot;.<br>
[4]&nbsp;Warning.&nbsp;Pattern&nbsp;match&nbsp;&quot;TX\:(.*)&quot;&nbsp;at&nbsp;MATCHED_VAR_NAME.&nbsp;[file&nbsp;<br>
&quot;/usr/local/apache/conf/modsecurity_crs-2.0.4/base_rules/modsecurity_crs_48_local_exceptions.conf&quot;]&nbsp;<br>
[line&nbsp;&quot;44&quot;]<br>
[4]&nbsp;Rule&nbsp;returned&nbsp;1.<br>
[9]&nbsp;Match&nbsp;-&amp;gt;&nbsp;mode&nbsp;NEXT_RULE.<br>
<br>
Hope&nbsp;this&nbsp;helps,<br>
Ryan<br>
<br>
&nbsp;&nbsp;&lt;/pre&gt;<br>
&lt;/blockquote&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
