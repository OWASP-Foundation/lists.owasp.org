<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.0//EN&quot;&nbsp;&quot;http://www.w3.org/TR/REC-html40/strict.dtd&quot;&gt;&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;name=&quot;qrichtext&quot;&nbsp;content=&quot;1&quot;&nbsp;/&gt;&lt;style&nbsp;type=&quot;text/css&quot;&gt;p,&nbsp;li&nbsp;{&nbsp;white-space:&nbsp;pre-wrap;&nbsp;}&lt;/style&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;&nbsp;font-family:'DejaVu&nbsp;Sans';&nbsp;font-size:9pt;&nbsp;font-weight:400;&nbsp;font-style:normal;&quot;&gt;On&nbsp;Tuesday&nbsp;11&nbsp;August&nbsp;2009&nbsp;03:38:03&nbsp;pm&nbsp;bad_brain&nbsp;//&nbsp;suck-o.com&nbsp;wrote:&lt;br&gt;<br>
&amp;gt;&nbsp;hey&nbsp;there...;)&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;Hey,&nbsp;welcome&nbsp;:)&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;&amp;gt;&nbsp;when&nbsp;using&nbsp;the&nbsp;2.0.1&nbsp;crs&nbsp;users&nbsp;can't&nbsp;login&nbsp;anymore&nbsp;to&nbsp;phpbb/phpnuke,&nbsp;and&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;am&nbsp;a&nbsp;little&nbsp;confused&nbsp;by&nbsp;the&nbsp;triggered&nbsp;rule&nbsp;because&nbsp;I&nbsp;can't&nbsp;find&nbsp;the&nbsp;ID&lt;br&gt;<br>
&amp;gt;&nbsp;to&nbsp;set&nbsp;an&nbsp;exception&nbsp;like&nbsp;I&nbsp;did&nbsp;it&nbsp;in&nbsp;1.6.1.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;The&nbsp;event&nbsp;logging&nbsp;has&nbsp;changed&nbsp;in&nbsp;v2.0.x&nbsp;so&nbsp;that&nbsp;*only*&nbsp;correlated&nbsp;events&nbsp;will&nbsp;show&nbsp;up&nbsp;within&nbsp;the&nbsp;Apache&nbsp;error_log&nbsp;file.&nbsp;&nbsp;This&nbsp;was&nbsp;designed&nbsp;to&nbsp;help&nbsp;error_log&nbsp;event&nbsp;monitoring.&nbsp;&nbsp;All&nbsp;of&nbsp;the&nbsp;rules&nbsp;are&nbsp;configured&nbsp;to&nbsp;log&nbsp;an&nbsp;event&nbsp;to&nbsp;the&nbsp;audit&nbsp;log&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;error_log&nbsp;(using&nbsp;nolog,auditlog&nbsp;setting).&nbsp;&nbsp;By&nbsp;a&nbsp;correlated&nbsp;event,&nbsp;I&nbsp;mean&nbsp;that&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;the&nbsp;anomaly&nbsp;score&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;phase:2.&nbsp;&nbsp;As&nbsp;the&nbsp;individual&nbsp;rules&nbsp;are&nbsp;setting&nbsp;TX&nbsp;variables&nbsp;when&nbsp;the&nbsp;rules&nbsp;match,&nbsp;it&nbsp;is&nbsp;also&nbsp;setting&nbsp;tx.msg&nbsp;data&nbsp;that&nbsp;is&nbsp;displayed&nbsp;in&nbsp;correlated&nbsp;event.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;&amp;gt;&nbsp;here&nbsp;is&nbsp;the&nbsp;log&nbsp;entry:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Message:&nbsp;Warning.&nbsp;Operator&nbsp;GE&nbsp;matched&nbsp;5&nbsp;at&nbsp;TX:anomaly_score.&nbsp;[file&lt;br&gt;<br>
&amp;gt;&nbsp;&quot;/etc/modsecurity2/base_rules/modsecurity_crs_60_correlation.conf&quot;]&lt;br&gt;<br>
&amp;gt;&nbsp;[line&nbsp;&quot;41&quot;]&nbsp;[msg&nbsp;&quot;Transactional&nbsp;Anomaly&nbsp;Score&nbsp;(score&nbsp;20):&nbsp;Blind&nbsp;SQL&lt;br&gt;<br>
&amp;gt;&nbsp;Injection&nbsp;Attack&quot;]&lt;br&gt;<br>
&amp;gt;&nbsp;Action:&nbsp;Intercepted&nbsp;(phase&nbsp;2)&lt;br&gt;<br>
&amp;gt;&nbsp;Stopwatch:&nbsp;1250012515250667&nbsp;12627&nbsp;(2426*&nbsp;10440&nbsp;-)&lt;br&gt;<br>
&amp;gt;&nbsp;Producer:&nbsp;ModSecurity&nbsp;for&nbsp;Apache/2.5.9&nbsp;(http://www.modsecurity.org/);&lt;br&gt;<br>
&amp;gt;&nbsp;core&nbsp;ruleset/2.0.1.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;This&nbsp;correlated&nbsp;event&nbsp;tells&nbsp;you&nbsp;that&nbsp;the&nbsp;anomaly&nbsp;score&nbsp;is&nbsp;20&nbsp;and&nbsp;that&nbsp;the&nbsp;rule&nbsp;that&nbsp;matched&nbsp;was&nbsp;in&nbsp;the&nbsp;Blind&nbsp;SQ&nbsp;Injection&nbsp;category.&nbsp;&nbsp;In&nbsp;order&nbsp;to&nbsp;identify&nbsp;the&nbsp;actual,&nbsp;individual&nbsp;rule&nbsp;that&nbsp;matched,&nbsp;you&nbsp;will&nbsp;need&nbsp;to&nbsp;review&nbsp;the&nbsp;audit&nbsp;log&nbsp;entry&nbsp;for&nbsp;this&nbsp;transaction&nbsp;and&nbsp;the&nbsp;normal&nbsp;Message&nbsp;event&nbsp;details&nbsp;will&nbsp;be&nbsp;there&nbsp;for&nbsp;you&nbsp;(as&nbsp;it&nbsp;was&nbsp;in&nbsp;older&nbsp;CRS)&nbsp;that&nbsp;will&nbsp;include&nbsp;the&nbsp;rule&nbsp;ID&nbsp;data.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;&amp;gt;&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;I&nbsp;have&nbsp;commented&nbsp;the&nbsp;rule&nbsp;out&nbsp;to&nbsp;test&nbsp;it,&nbsp;but&nbsp;the&nbsp;request&nbsp;is&nbsp;still&lt;br&gt;<br>
&amp;gt;&nbsp;blocked,&nbsp;this&nbsp;time&nbsp;even&nbsp;without&nbsp;naming&nbsp;any&nbsp;explicit&nbsp;rule&nbsp;being&nbsp;triggered:&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&amp;gt;&nbsp;Action:&nbsp;Intercepted&nbsp;(phase&nbsp;2)&lt;br&gt;<br>
&amp;gt;&nbsp;Stopwatch:&nbsp;1250012698532648&nbsp;23056&nbsp;(6157*&nbsp;15148&nbsp;-)&lt;br&gt;<br>
&amp;gt;&nbsp;Producer:&nbsp;ModSecurity&nbsp;for&nbsp;Apache/2.5.9&nbsp;(http://www.modsecurity.org/);&lt;br&gt;<br>
&amp;gt;&nbsp;core&nbsp;ruleset/2.0.1.&lt;br&gt;<br>
&amp;gt;&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;If&nbsp;you&nbsp;identify&nbsp;a&nbsp;false&nbsp;positive&nbsp;issue,&nbsp;you&nbsp;can&nbsp;implement&nbsp;a&nbsp;custom&nbsp;exception&nbsp;by&nbsp;adding&nbsp;a&nbsp;rule&nbsp;to&nbsp;the&nbsp;modsecurity_crs_48_local_exceptions.conf&nbsp;file.&nbsp;&nbsp;The&nbsp;file&nbsp;provides&nbsp;some&nbsp;exception&nbsp;examples&nbsp;and&nbsp;you&nbsp;can&nbsp;also&nbsp;review&nbsp;an&nbsp;example&nbsp;in&nbsp;this&nbsp;recent&nbsp;JIRA&nbsp;ticket&nbsp;-&nbsp;https://www.modsecurity.org/tracker/browse/CORERULES-2&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;The&nbsp;idea&nbsp;is&nbsp;that&nbsp;you&nbsp;need&nbsp;to&nbsp;know&nbsp;what&nbsp;the&nbsp;TX&nbsp;variable&nbsp;data&nbsp;looks&nbsp;like&nbsp;for&nbsp;the&nbsp;false&nbsp;positive&nbsp;and&nbsp;then&nbsp;you&nbsp;create&nbsp;an&nbsp;exception&nbsp;that&nbsp;looks&nbsp;for&nbsp;that&nbsp;*exact*&nbsp;data&nbsp;and&nbsp;then&nbsp;it&nbsp;corrects&nbsp;that&nbsp;anomaly&nbsp;score&nbsp;be&nbsp;decrementing&nbsp;it&nbsp;by&nbsp;20&nbsp;points.&lt;br&gt;<br>
&nbsp;&nbsp;&lt;br&gt;<br>
One&nbsp;other&nbsp;item&nbsp;that&nbsp;I&nbsp;would&nbsp;recommend&nbsp;is&nbsp;to&nbsp;change&nbsp;the&nbsp;&quot;deny&quot;&nbsp;action&nbsp;in&nbsp;the&nbsp;modsecurity_crs_49_enforcement.conf&nbsp;file&nbsp;to&nbsp;&quot;pass&quot;&nbsp;if&nbsp;you&nbsp;want&nbsp;to&nbsp;run&nbsp;in&nbsp;a&nbsp;simulation/detection-only&nbsp;mode&nbsp;while&nbsp;testing&nbsp;the&nbsp;new&nbsp;CRS.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;#&nbsp;Alert&nbsp;and&nbsp;Deny&nbsp;on&nbsp;High&nbsp;Anomaly&nbsp;Scores&lt;br&gt;<br>
#&lt;br&gt;<br>
SecRule&nbsp;TX:ANOMALY_SCORE&nbsp;&quot;@ge&nbsp;20&quot;&nbsp;\&lt;br&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&quot;phase:2,t:none,nolog,auditlog,pass,msg:'Anomaly&nbsp;Score&nbsp;Exceeded&nbsp;(score&nbsp;%{TX.ANOMALY_SCORE}):&nbsp;%{tx.msg}',setvar:tx.inbound_tx_msg=%{tx.msg}&quot;&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;Let&nbsp;me&nbsp;know&nbsp;if&nbsp;you&nbsp;need&nbsp;any&nbsp;more&nbsp;help.&lt;br&gt;<br>
&lt;p&nbsp;style=&quot;-qt-paragraph-type:empty;&nbsp;margin-top:0px;&nbsp;margin-bottom:0px;&nbsp;margin-left:0px;&nbsp;margin-right:0px;&nbsp;-qt-block-indent:0;&nbsp;text-indent:0px;&nbsp;-qt-user-state:0;&quot;&gt;&lt;br&gt;&lt;/p&gt;--&nbsp;&lt;br&gt;<br>
Ryan&nbsp;C.&nbsp;Barnett&lt;br&gt;<br>
WASC&nbsp;Distributed&nbsp;Open&nbsp;Proxy&nbsp;Honeypot&nbsp;Project&nbsp;Leader&lt;br&gt;<br>
OWASP&nbsp;ModSecurity&nbsp;Core&nbsp;Rule&nbsp;Set&nbsp;Project&nbsp;Leader&lt;br&gt;<br>
Tactical&nbsp;Web&nbsp;Application&nbsp;Security&lt;br&gt;<br>
http://tacticalwebappsec.blogspot.com&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
