<tt>
Hi&nbsp;all,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;are&nbsp;trying&nbsp;to&nbsp;setup&nbsp;the&nbsp;OWASP&nbsp;Core&nbsp;Rule&nbsp;Set&nbsp;to&nbsp;protect&nbsp;our&nbsp;application&nbsp;from&nbsp;Slow&nbsp;HTTP&nbsp;DOS&nbsp;attacks.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;We&nbsp;have&nbsp;setup&nbsp;ModSecurity&nbsp;2.5.13&nbsp;on&nbsp;our&nbsp;Apache&nbsp;2.2.17&nbsp;instance,&nbsp;loaded&nbsp;the&nbsp;module,&nbsp;and&nbsp;included&nbsp;all&nbsp;CRS&nbsp;base&nbsp;rules&nbsp;plus&nbsp;modsecurity_crs_11_slow_dos_protection.conf.&nbsp; We&nbsp;didn&amp;#39;t&nbsp;change&nbsp;the&nbsp;settings&nbsp;defined&nbsp;in&nbsp;the&nbsp;conf&nbsp;file,&nbsp;so&nbsp;SecReadStateLimit&nbsp;is&nbsp;set&nbsp;to&nbsp;5&nbsp;and&nbsp;RequestReadTimeout&nbsp;is&nbsp;set&nbsp;to&nbsp;body=30.&nbsp; We&nbsp;are&nbsp;using&nbsp;the&nbsp;http_dos_cli&nbsp;command&nbsp;line&nbsp;tool&nbsp;to&nbsp;do&nbsp;our&nbsp;tests,&nbsp;with&nbsp;the&nbsp;connection&nbsp;parameter&nbsp;set&nbsp;to&nbsp;500.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;When&nbsp;running&nbsp;the&nbsp;slow-headers&nbsp;test,&nbsp;ModSecurity&nbsp;seems&nbsp;to&nbsp;be&nbsp;protecting&nbsp;the&nbsp;application&nbsp;correctly,&nbsp;dropping&nbsp;most&nbsp;(all?)&nbsp;requests&nbsp;from&nbsp;the&nbsp;tester&amp;#39;s&nbsp;IP&nbsp;and&nbsp;allowing&nbsp;requests&nbsp;from&nbsp;a&nbsp;different&nbsp;IP&nbsp;to&nbsp;be&nbsp;served.&nbsp; However,&nbsp;when&nbsp;running&nbsp;the&nbsp;slow-post&nbsp;test,&nbsp;ModSecurity&nbsp;doesn&amp;#39;t&nbsp;seem&nbsp;to&nbsp;be&nbsp;doing&nbsp;anything.&nbsp; From&nbsp;what&nbsp;I&nbsp;understand,&nbsp;the&nbsp;test&nbsp;successfully&nbsp;creates&nbsp;the&nbsp;500&nbsp;connections&nbsp;and&nbsp;keeps&nbsp;them&nbsp;open;&nbsp;none&nbsp;of&nbsp;them&nbsp;are&nbsp;dropped.&nbsp; Requests&nbsp;coming&nbsp;from&nbsp;a&nbsp;different&nbsp;IP&nbsp;are&nbsp;not&nbsp;served&nbsp;and&nbsp;eventually&nbsp;time&nbsp;out.&nbsp; A&nbsp;tail&nbsp;-f&nbsp;error_log&nbsp;shows&nbsp;nothing&nbsp;except&nbsp;the&nbsp;eventual&nbsp;message&nbsp;on&nbsp;MaxClients&nbsp;(set&nbsp;to&nbsp;300&nbsp;now)&nbsp;being&nbsp;reached.&nbsp; Interestingly,&nbsp;when&nbsp;we&nbsp;kill&nbsp;the&nbsp;http_dos_cli&nbsp;process,&nbsp;the&nbsp;error_log&nbsp;is&nbsp;then&nbsp;flooded&nbsp;with&nbsp;hundreds&nbsp;of&nbsp;entries&nbsp;such&nbsp;as&nbsp;this:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-style-span&quot;&nbsp;style=&quot;color:&nbsp;rgb(51,&nbsp;51,&nbsp;51);&nbsp;font-family:&nbsp;Helvetica,&nbsp;Verdana,&nbsp;&amp;#39;Arial&nbsp;sans-serif&amp;#39;;&nbsp;font-size:&nbsp;15px;&nbsp;line-height:&nbsp;18px;&nbsp;&quot;&gt;&lt;pre&nbsp;style=&quot;margin-top:&nbsp;10px;&nbsp;margin-bottom:&nbsp;10px;&nbsp;background-color:&nbsp;rgb(249,&nbsp;249,&nbsp;249);&nbsp;color:&nbsp;rgb(0,&nbsp;51,&nbsp;102);&nbsp;font-family:&nbsp;&amp;#39;Courier&nbsp;New&amp;#39;,&nbsp;Courier,&nbsp;monospaced;&nbsp;font-size:&nbsp;14px;&nbsp;line-height:&nbsp;19px;&nbsp;margin-right:&nbsp;0px;&nbsp;overflow-x:&nbsp;auto;&nbsp;overflow-y:&nbsp;hidden;&nbsp;padding-top:&nbsp;5px;&nbsp;padding-right:&nbsp;0px;&nbsp;padding-bottom:&nbsp;20px;&nbsp;padding-left:&nbsp;5px;&nbsp;width:&nbsp;600px;&nbsp;&quot;&gt;<br>
[Mon&nbsp;Nov&nbsp;22&nbsp;17:44:46&nbsp;2010]&nbsp;[warn]&nbsp;ModSecurity:&nbsp;Access&nbsp;denied&nbsp;with&nbsp;code&nbsp;400.&nbsp;&lt;br&gt;Too&nbsp;many&nbsp;connections&nbsp;[6]&nbsp;of&nbsp;5&nbsp;allowed&nbsp;in&nbsp;READ&nbsp;state&nbsp;from&nbsp;211.144.112.20&nbsp;-&nbsp;&lt;br&gt;Possible&nbsp;DoS&nbsp;Consumption&nbsp;Attack&nbsp;[Rejected]&lt;/pre&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;<br>
(this&nbsp;has&nbsp;been&nbsp;taken&nbsp;from&nbsp;the&nbsp;SpiderLabs&nbsp;blog&nbsp;entry,&nbsp;dates&nbsp;and&nbsp;IPs&nbsp;are&nbsp;obviously&nbsp;different)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;idea&nbsp;on&nbsp;why&nbsp;this&nbsp;isn&amp;#39;t&nbsp;behaving&nbsp;like&nbsp;we&amp;#39;re&nbsp;expecting&nbsp;it&nbsp;to&nbsp;be?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thanks!&lt;/div&gt;<br>
&lt;div&gt;GB&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
