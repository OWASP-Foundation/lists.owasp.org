<tt>
&lt;!DOCTYPE&nbsp;HTML&nbsp;PUBLIC&nbsp;&quot;-//W3C//DTD&nbsp;HTML&nbsp;4.01&nbsp;Transitional//EN&quot;&gt;<br>
&lt;html&gt;<br>
&lt;head&gt;<br>
<br>
&lt;meta&nbsp;http-equiv=&quot;content-type&quot;&nbsp;content=&quot;text/html;&nbsp;charset=ISO-8859-1&quot;&gt;<br>
&lt;/head&gt;<br>
&lt;body&nbsp;bgcolor=&quot;#ffffff&quot;&nbsp;text=&quot;#000000&quot;&gt;<br>
I&nbsp;can't&nbsp;seem&nbsp;to&nbsp;understand&nbsp;how,&nbsp;the<br>
modsecurity_crs_21_protocol_anomalies.conf&nbsp;seems&nbsp;to&nbsp;reply&nbsp;403&nbsp;Forbidden<br>
if&nbsp;the&nbsp;Accept&nbsp;Header&nbsp;is&nbsp;missing.&amp;nbsp;&nbsp;The&nbsp;rule&nbsp;that&nbsp;matches&nbsp;falls&nbsp;well<br>
below&nbsp;the&nbsp;anomaly&nbsp;threshold,&nbsp;and&nbsp;yet&nbsp;the&nbsp;403&nbsp;error&nbsp;is&nbsp;returned&nbsp;anyway.&amp;nbsp;<br>
I've&nbsp;enabled&nbsp;the&nbsp;AuditLog,&nbsp;searched&nbsp;the&nbsp;CRS,&nbsp;and&nbsp;I&nbsp;just&nbsp;can't&nbsp;figure<br>
out&nbsp;how&nbsp;this&nbsp;happens.&amp;nbsp;&nbsp;&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;strangest&nbsp;thing&nbsp;is&nbsp;that&nbsp;my&nbsp;DefaultAction&nbsp;for&nbsp;phase:2&nbsp;is&nbsp;to&nbsp;set<br>
status&nbsp;to&nbsp;509,&nbsp;not&nbsp;403,&nbsp;so&nbsp;I'm&nbsp;really&nbsp;confused&nbsp;as&nbsp;to&nbsp;how&nbsp;this&nbsp;behaviour<br>
is&nbsp;happening.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;only&nbsp;discovered&nbsp;this&nbsp;when&nbsp;my&nbsp;podcasts&nbsp;broke.&amp;nbsp;&nbsp;iTunes&nbsp;(and&nbsp;many&nbsp;other<br>
aggregators)&nbsp;don't&nbsp;send&nbsp;proper&nbsp;Accept&nbsp;Headers,&nbsp;and&nbsp;this&nbsp;rule&nbsp;was<br>
silently&nbsp;throwing&nbsp;them&nbsp;away.&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;only&nbsp;thing&nbsp;odd&nbsp;I&nbsp;found&nbsp;about&nbsp;these&nbsp;rules&nbsp;is&nbsp;that&nbsp;they&nbsp;don't&nbsp;have&nbsp;a<br>
pass&nbsp;directive.&amp;nbsp;&nbsp;Adding&nbsp;this&nbsp;directive&nbsp;seems&nbsp;to&nbsp;make&nbsp;the&nbsp;rule&nbsp;behave&nbsp;as<br>
designed&nbsp;(incrementing&nbsp;the&nbsp;anomaly&nbsp;score,&nbsp;but&nbsp;and&nbsp;allowing&nbsp;the<br>
correlation&nbsp;to&nbsp;the&nbsp;blocking.&amp;nbsp;&nbsp;Is&nbsp;this&nbsp;the&nbsp;correct&nbsp;fix?&lt;br&gt;<br>
&lt;br&gt;<br>
Josh&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Here're&nbsp;the&nbsp;relevant&nbsp;rules&nbsp;(as&nbsp;I&nbsp;modified&nbsp;them):&lt;br&gt;<br>
&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;SecRule&nbsp;&amp;amp;REQUEST_HEADERS:Accept&nbsp;&quot;@eq&nbsp;0&quot;&nbsp;\&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&quot;chain,phase:2,rev:'2.0.7',t:none,pass,nolog,auditlog,msg:'Request<br>
Missing&nbsp;an&nbsp;Accept&nbsp;Header',<br>
severity:'2',id:'960015',tag:'PROTOCOL_VIOLATION/MISSING_HEADER',tag:'WASCTC/WASC-21',tag:'OWASP_TOP_10/A7',tag:'PCI/6.5.10'&quot;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;SecRule&nbsp;REQUEST_METHOD&nbsp;&quot;!^OPTIONS$&quot;<br>
&quot;skipAfter:END_ACCEPT_CHECK,t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}&quot;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;SecRule&nbsp;REQUEST_HEADERS:Accept&nbsp;&quot;^$&quot;&nbsp;\&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<br>
&quot;chain,phase:2,rev:'2.0.7',t:none,pass,nolog,auditlog,msg:'Request&nbsp;Has<br>
an&nbsp;Empty&nbsp;Accept&nbsp;Header',<br>
severity:'2',id:'960021',tag:'PROTOCOL_VIOLATION/MISSING_HEADER'&quot;&lt;br&gt;<br>
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;SecRule&nbsp;REQUEST_METHOD&nbsp;&quot;!^OPTIONS$&quot;<br>
&quot;t:none,setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},setvar:tx.protocol_violation_score=+%{tx.notice_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/MISSING_HEADER-%{matched_var_name}=%{matched_var}&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;moz-signature&quot;&gt;--&nbsp;&lt;br&gt;<br>
&lt;font&nbsp;face=&quot;Arial&quot;&gt;Joshua&nbsp;Gee&lt;br&gt;<br>
Director&nbsp;of&nbsp;Information&nbsp;Security&lt;/font&gt;&lt;br&gt;<br>
&lt;hr&nbsp;width=&quot;450&quot;&nbsp;align=&quot;left&quot;&nbsp;size=&quot;2&quot;&gt;<br>
&lt;img&nbsp;alt=&quot;HCJB&nbsp;Global&nbsp;-&nbsp;PO&nbsp;Box&nbsp;39800&nbsp;Colorado&nbsp;Springs,&nbsp;CO&nbsp;80949-9800&quot;<br>
&nbsp;src=&quot;cid:part1.06090807.09020300@hcjb.org&quot;&nbsp;width=&quot;450&quot;&nbsp;height=&quot;116&quot;&gt;&nbsp;&lt;br&gt;<br>
&lt;font&nbsp;face=&quot;Arial&quot;&gt;Account&nbsp;110504&nbsp;&lt;/font&gt;<br>
&lt;hr&nbsp;width=&quot;300&quot;&nbsp;align=&quot;left&quot;&nbsp;size=&quot;2&quot;&gt;&lt;font&nbsp;face=&quot;Arial&quot;&gt;&lt;br&gt;<br>
Email:&nbsp;&lt;a&nbsp;class=&quot;moz-txt-link-abbreviated&quot;&nbsp;href=&quot;mailto:jgee@hcjbtech.org&quot;&gt;jgee@hcjbtech.org&lt;/a&gt;&lt;br&gt;<br>
Phone:&nbsp;UK&nbsp;1274&nbsp;721&nbsp;810&lt;br&gt;<br>
Skype:&nbsp;Gander78&lt;br&gt;<br>
&lt;/font&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>
&lt;/body&gt;<br>
&lt;/html&gt;<br>

</tt>
