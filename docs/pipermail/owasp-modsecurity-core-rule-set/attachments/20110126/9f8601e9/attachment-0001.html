<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hi,&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;running&nbsp;Mod_Security&nbsp;2.5.13&nbsp;with&nbsp;CRS&nbsp;2.1.1&lt;br&gt;I&nbsp;have&nbsp;copied&nbsp;the&nbsp;following&nbsp;rules&nbsp;into&nbsp;the&nbsp;base_rules&nbsp;directory:&lt;br&gt;modsecurity_crs_11_dos_protection.conf&lt;br&gt;modsecurity_crs_11_slow_dos_protection.conf&lt;br&gt;<br>
<br>
&lt;br&gt;I&amp;#39;ve&nbsp;uncommented&nbsp;the&nbsp;following&nbsp;section&nbsp;in &nbsp;modsecurity_crs_10_config.conf&lt;br&gt;SecAction&nbsp;&amp;quot;phase:1,t:none,nolog,pass,&nbsp;\&lt;br&gt;setvar:&amp;#39;tx.dos_burst_time_slice=60&amp;#39;,&nbsp;\&lt;br&gt;setvar:&amp;#39;tx.dos_counter_threshold=100&amp;#39;,&nbsp;\&lt;br&gt;<br>
<br>
setvar:&amp;#39;tx.dos_block_timeout=600&amp;#39;&amp;quot;&lt;br&gt;&lt;br&gt;In&nbsp;the&nbsp;debug&nbsp;log&nbsp;I&nbsp;get&nbsp;the&nbsp;error:&nbsp;Could&nbsp;not&nbsp;set&nbsp;variable&nbsp;&amp;quot;ip.dos_counter&amp;quot;&nbsp;as&nbsp;the&nbsp;collection&nbsp;does&nbsp;not&nbsp;exist.&lt;br&gt;&lt;br&gt;Here&nbsp;is&nbsp;the&nbsp;level&nbsp;9&nbsp;debug&nbsp;up&nbsp;to&nbsp;that&nbsp;point&nbsp;(some&nbsp;details&nbsp;obfuscated)&lt;br&gt;<br>
<br>
&lt;br&gt;[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Initialising&nbsp;transaction&nbsp;(txid&nbsp;TT-YxKwVByQAAC6ZJSEAAAAC).&lt;br&gt;<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Transaction&nbsp;context&nbsp;created&nbsp;(dcfg&nbsp;de7f0).&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Processing&nbsp;disabled,&nbsp;skipping&nbsp;(hook&nbsp;request_early).&lt;br&gt;<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;PdfProtect:&nbsp;Not&nbsp;enabled&nbsp;here.&lt;br&gt;<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Processing&nbsp;disabled,&nbsp;skipping&nbsp;(hook&nbsp;request_late).&lt;br&gt;<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Hook&nbsp;insert_filter:&nbsp;Adding&nbsp;PDF&nbsp;XSS&nbsp;protection&nbsp;output&nbsp;filter&nbsp;(r&nbsp;1630cf0).&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Hook&nbsp;insert_filter:&nbsp;Processing&nbsp;disabled,&nbsp;skipping.&lt;br&gt;<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Initialising&nbsp;logging.&lt;br&gt;<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Starting&nbsp;phase&nbsp;LOGGING.&lt;br&gt;[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;/a&gt;]&nbsp;This&nbsp;phase&nbsp;consists&nbsp;of&nbsp;40&nbsp;rule(s).&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Recipe:&nbsp;Invoking&nbsp;rule&nbsp;256478;&nbsp;[file&nbsp;&amp;quot;/var/www/conf/modsecurity_crs/base_rules/modsecurity_crs_11_dos_protection.conf&amp;quot;]&nbsp;[line&nbsp;&amp;quot;24&amp;quot;].&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B5&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][5&lt;/a&gt;]&nbsp;Rule&nbsp;256478:&nbsp;SecRule&nbsp;&amp;quot;IP:DOS_BLOCK&amp;quot;&nbsp;&amp;quot;@eq&nbsp;1&amp;quot;&nbsp;&amp;quot;phase:5,noauditlog,t:none,nolog,skipAfter:END_DOS_PROTECTION_CHECKS&amp;quot;&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Rule&nbsp;returned&nbsp;0.&lt;br&gt;[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;/a&gt;]&nbsp;No&nbsp;match,&nbsp;not&nbsp;chained&nbsp;-&amp;gt;&nbsp;mode&nbsp;NEXT_RULE.&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Recipe:&nbsp;Invoking&nbsp;rule&nbsp;256c28;&nbsp;[file&nbsp;&amp;quot;/var/www/conf/modsecurity_crs/base_rules/modsecurity_crs_11_dos_protection.conf&amp;quot;]&nbsp;[line&nbsp;&amp;quot;30&amp;quot;].&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B5&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][5&lt;/a&gt;]&nbsp;Rule&nbsp;256c28:&nbsp;SecRule&nbsp;&amp;quot;REQUEST_BASENAME&amp;quot;&nbsp;&amp;quot;!@rx&nbsp;\\.(jpe?g|png|gif|js|css|ico)$&amp;quot;&nbsp;&amp;quot;phase:5,noauditlog,t:none,nolog,pass,setvar:ip.dos_counter=+1&amp;quot;&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Transformation&nbsp;completed&nbsp;in&nbsp;7&nbsp;usec.&lt;br&gt;[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Executing&nbsp;operator&nbsp;&amp;quot;!rx&amp;quot;&nbsp;with&nbsp;param&nbsp;&amp;quot;\\.(jpe?g|png|gif|js|css|ico)$&amp;quot;&nbsp;against&nbsp;REQUEST_BASENAME.&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;/a&gt;]&nbsp;Target&nbsp;value:&nbsp;&amp;quot;index.php&amp;quot;&lt;br&gt;[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B6&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][6&lt;/a&gt;]&nbsp;Ignoring&nbsp;regex&nbsp;captures&nbsp;since&nbsp;&amp;quot;capture&amp;quot;&nbsp;action&nbsp;is&nbsp;not&nbsp;enabled.&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B4&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][4&lt;/a&gt;]&nbsp;Operator&nbsp;completed&nbsp;in&nbsp;189&nbsp;usec.&lt;br&gt;[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B9&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][9&lt;/a&gt;]&nbsp;Setting&nbsp;variable:&nbsp;ip.dos_counter=+1&lt;br&gt;<br>
<br>
[26/Jan/2011:08:18:13&nbsp;+0000]&nbsp;[&lt;a&nbsp;href=&quot;http://192.168.1.1/sid#9caf8][rid%231630cf0%5D%5B/index.php%5D%5B3&quot;&nbsp;target=&quot;_blank&quot;&gt;192.168.1.1/sid#9caf8][rid#1630cf0][/index.php][3&lt;/a&gt;]&nbsp;Could&nbsp;not&nbsp;set&nbsp;variable&nbsp;&amp;quot;ip.dos_counter&amp;quot;&nbsp;as&nbsp;the&nbsp;collection&nbsp;does&nbsp;not&nbsp;exist.&lt;br&gt;<br>
<br>
&lt;br&gt;Any&nbsp;ideas?&lt;br&gt;Thanks,&lt;br&gt;Yonah&lt;br&gt;&lt;/div&gt;<br>

</tt>
