<tt>
&lt;div&nbsp;style&gt;Hello,&nbsp;everyone&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt; &nbsp; &nbsp;I&nbsp;use&nbsp;modsecurity&nbsp;2.6&nbsp;protect&nbsp;against&nbsp;dos&nbsp;attack&nbsp;for&nbsp;some&nbsp;specific&nbsp;pages.&lt;/div&gt;&lt;div&nbsp;style&gt;This&nbsp;is&nbsp;the&nbsp; rule.&nbsp;I&nbsp;test&nbsp;it&nbsp;in&nbsp;my&nbsp;box,&nbsp;it&nbsp;works.&nbsp;But&nbsp;when&nbsp;in&nbsp;some&nbsp;product &lt;em&nbsp;style=&quot;font-style:normal&quot;&gt;environment(large&nbsp;number&nbsp;of&nbsp; &lt;/em&gt;concurrent&nbsp;connections&nbsp;in&nbsp;worker&nbsp;MPM)&lt;em&nbsp;style=&quot;font-style:normal&quot;&gt;,&nbsp;it&nbsp;failed.&lt;/em&gt;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;em&nbsp;style=&quot;font-style:normal&quot;&gt;In&nbsp;the&nbsp;early&nbsp;time&nbsp;I&nbsp;use&nbsp;expiredvar:dos_block&nbsp;every&nbsp;1800&nbsp;seconds,&nbsp;as&nbsp;the&nbsp;modsecurity&nbsp;docs&nbsp;suggests.&nbsp;I&nbsp;found&nbsp;the&nbsp;var&nbsp;&quot;dos_block&quot;&nbsp;expired&nbsp;within&nbsp;1-10&nbsp;second(&lt;/em&gt;&lt;em&nbsp;style=&quot;font-style:normal&quot;&gt;I&nbsp;dump&nbsp;the&nbsp;resource&nbsp;db),n&lt;/em&gt;&lt;em&nbsp;style=&quot;font-style:normal&quot;&gt;ot&nbsp;1800.&nbsp;So&nbsp;I&nbsp;changed&nbsp;it&nbsp;with &lt;/em&gt;deprecatevar. But&nbsp;it&nbsp;does&nbsp;not&nbsp;works&nbsp;too.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;Does&nbsp;it&nbsp;because&nbsp;of&nbsp;the&nbsp;concurrent&nbsp;problem? &lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thanks.&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;----------------------------------------------------------------&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;SecRule&nbsp;REQUEST_URI&nbsp;&quot;^/login.php&quot;&nbsp;\&lt;/div&gt;&lt;div&nbsp;style&gt; &nbsp; &nbsp; &nbsp; &nbsp;&quot;phase:1,capture,t:lowercase,t:urlDecodeUni,pass,nolog,setvar:tx.dos_uri=%{TX.1},skip:1&quot;&lt;/div&gt;&lt;div&nbsp;style&gt;SecAction&nbsp;&quot;phase:1,pass,nolog,skipAfter:Dos_Marker&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;SecAction&nbsp;&quot;phase:1,pass,nolog,t:none,setvar:tx.real_ip=%{REMOTE_ADDR}&quot;&lt;/div&gt;&lt;div&nbsp;style&gt;SecAction&nbsp;&quot;phase:1,nolog,initcol:resource=&#39;%{tx.real_ip}/&#39;&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;SecRule&nbsp;RESOURCE:SHOULD_LOG&nbsp;&quot;@eq&nbsp;1&quot;&nbsp;&quot;phase:1,pass,nolog,setvar:resource.should_log=0,skip:2&quot;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;<br>
#already&nbsp;blocked,&nbsp;nolog&nbsp;here&lt;/div&gt;&lt;div&nbsp;style&gt;SecRule&nbsp;RESOURCE:DOS_BLOCKED&nbsp;&quot;@eq&nbsp;1&quot;&nbsp;\&lt;/div&gt;&lt;div&nbsp;style&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;phase:1,deny,nolog,severity:&#39;2&#39;,status:403,deprecatevar:resource.dos_blocked=1/1800,skipAfter:Dos_Marker&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;SecAction&nbsp;&quot;phase:1,pass,nolog,skip:1&quot;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;#log&nbsp;version,&nbsp;logdata&nbsp;is&nbsp;real&nbsp;client&nbsp;ip&lt;/div&gt;&lt;div&nbsp;style&gt;SecRule&nbsp;RESOURCE:DOS_BLOCKED&nbsp;&quot;@eq&nbsp;1&quot;&nbsp;\&lt;/div&gt;<br>
&lt;div&nbsp;style&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;phase:1,deny,log,auditlog,severity:&#39;2&#39;,msg:&#39;99010&#39;,id:&#39;99010001&#39;,tag:&#39;9901&#39;,status:403,deprecatevar:resource.dos_blocked=1/1800,logdata:%{tx.real_ip},skipAfter:Dos_Marker&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;#counter++&lt;/div&gt;&lt;div&nbsp;style&gt;SecAction&nbsp;&quot;phase:1,nolog,setvar:resource.dos_request_counter=+1,deprecatevar:resource.dos_request_counter=10/60&quot;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;style&gt;#&nbsp;if&nbsp;counter&nbsp;==&nbsp;max&nbsp;then&nbsp;block&lt;/div&gt;&lt;div&nbsp;style&gt;SecRule&nbsp;RESOURCE:DOS_REQUEST_COUNTER&nbsp;&quot;@ge&nbsp;10&quot;&nbsp;\&lt;/div&gt;&lt;div&nbsp;style&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;phase:5,nolog,setvar:resource.dos_request_counter=0,setvar:resource.dos_blocked=1,setvar:resource.should_log=1&quot;&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;SecMarker&nbsp;Dos_Marker&lt;/div&gt;<br>

</tt>
