<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:georgia,serif;color:rgb(7,55,99)&quot;&gt;Thak&nbsp;you &lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-size:12.8000001907349px;font-family:arial,sans-serif&quot;&gt;Paolo&nbsp;:)&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&gt;&lt;font&nbsp;color=&quot;#000000&quot;&gt;&lt;span&nbsp;style=&quot;font-size:12.8000001907349px&quot;&gt;I&#39;ll&nbsp;tried&nbsp;this&nbsp;(y)&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_default&quot;&nbsp;style=&quot;font-family:georgia,serif;color:rgb(7,55,99)&quot;&gt;&lt;span&nbsp;style=&quot;color:rgb(0,0,0);font-size:12.8000001907349px;font-family:arial,sans-serif&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;gmail_extra&quot;&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;2015-02-01&nbsp;12:00&nbsp;GMT+00:00&nbsp;&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&lt;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set-request@lists.owasp.org&quot;&nbsp;target=&quot;_blank&quot;&gt;owasp-modsecurity-core-rule-set-request@lists.owasp.org&lt;/a&gt;&gt;&lt;/span&gt;:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;margin:0&nbsp;0&nbsp;0&nbsp;.8ex;border-left:1px&nbsp;#ccc&nbsp;solid;padding-left:1ex&quot;&gt;Send&nbsp;Owasp-modsecurity-core-rule-set&nbsp;mailing&nbsp;list&nbsp;submissions&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
To&nbsp;subscribe&nbsp;or&nbsp;unsubscribe&nbsp;via&nbsp;the&nbsp;World&nbsp;Wide&nbsp;Web,&nbsp;visit&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
or,&nbsp;via&nbsp;email,&nbsp;send&nbsp;a&nbsp;message&nbsp;with&nbsp;subject&nbsp;or&nbsp;body&nbsp;&#39;help&#39;&nbsp;to&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set-request@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set-request@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
You&nbsp;can&nbsp;reach&nbsp;the&nbsp;person&nbsp;managing&nbsp;the&nbsp;list&nbsp;at&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set-owner@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set-owner@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
When&nbsp;replying,&nbsp;please&nbsp;edit&nbsp;your&nbsp;Subject&nbsp;line&nbsp;so&nbsp;it&nbsp;is&nbsp;more&nbsp;specific&lt;br&gt;<br>
than&nbsp;&quot;Re:&nbsp;Contents&nbsp;of&nbsp;Owasp-modsecurity-core-rule-set&nbsp;digest...&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Today&#39;s&nbsp;Topics:&lt;br&gt;<br>
&lt;br&gt;<br>
 &nbsp; 1.&nbsp;Re:&nbsp;Block&nbsp;upload&nbsp;file&nbsp;(jsp,php)&nbsp;(Paolo&nbsp;Luise)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
----------------------------------------------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
Message:&nbsp;1&lt;br&gt;<br>
Date:&nbsp;Sun,&nbsp;1&nbsp;Feb&nbsp;2015&nbsp;11:39:47&nbsp;+0100&lt;br&gt;<br>
From:&nbsp;Paolo&nbsp;Luise&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:paolo.luiseit@gmail.com&quot;&gt;paolo.luiseit@gmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
To:&nbsp;&lt;a&nbsp;href=&quot;mailto:owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
Subject:&nbsp;Re:&nbsp;[Owasp-modsecurity-core-rule-set]&nbsp;Block&nbsp;upload&nbsp;file&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;(jsp,php)&lt;br&gt;<br>
Message-ID:&lt;br&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:CAPF6YCk6gf4AeDzHvmLBveZiaQKMpTjXJHaCJ1h2C7s5MSTz2Q@mail.gmail.com&quot;&gt;CAPF6YCk6gf4AeDzHvmLBveZiaQKMpTjXJHaCJ1h2C7s5MSTz2Q@mail.gmail.com&lt;/a&gt;&gt;&lt;br&gt;<br>
Content-Type:&nbsp;text/plain;&nbsp;charset=&quot;utf-8&quot;&lt;br&gt;<br>
&lt;br&gt;<br>
Hi&nbsp;Ilyass,&lt;br&gt;<br>
the&nbsp;rule&nbsp;960035&nbsp;in&nbsp;the&nbsp;file&nbsp;modsecurity_crs_30_http_policy.conf,&nbsp;which&nbsp;is&lt;br&gt;<br>
the&nbsp;one&nbsp;that&nbsp;uses&nbsp;the&nbsp;restricted_extensions&nbsp;variable,&nbsp;bases&nbsp;its&nbsp;match&nbsp;on&lt;br&gt;<br>
the&nbsp;REQUEST_BASENAME,&nbsp;that&nbsp;is&nbsp;&quot;the&nbsp;filename&nbsp;part&nbsp;of&nbsp;REQUEST_FILENAME&quot;&nbsp;(&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BASENAME&quot;&nbsp;target=&quot;_blank&quot;&gt;https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#REQUEST_BASENAME&lt;/a&gt;&lt;br&gt;<br>
).&lt;br&gt;<br>
&lt;br&gt;<br>
File&nbsp;uploads&nbsp;are&nbsp;handled&nbsp;in&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;POST&nbsp;request,&nbsp;and&nbsp;then&nbsp;the&lt;br&gt;<br>
basename&nbsp;is&nbsp;that&nbsp;of&nbsp;the&nbsp;script&nbsp;which&nbsp;orchestrates&nbsp;the&nbsp;upload.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;would&nbsp;suggest&nbsp;you&nbsp;to&nbsp;intercept&nbsp;your&nbsp;upload&nbsp;request&nbsp;with&nbsp;a&nbsp;tool&nbsp;such&nbsp;as&lt;br&gt;<br>
ZAP&nbsp;by&nbsp;OWASP,&nbsp;and&nbsp;identify&nbsp;the&nbsp;process&nbsp;of&nbsp;the&nbsp;uploads&nbsp;in&nbsp;your&nbsp;application.&lt;br&gt;<br>
&lt;br&gt;<br>
For&nbsp;example,&nbsp;you&nbsp;may&nbsp;find&nbsp;a&nbsp;request&nbsp;like&nbsp;this:&lt;br&gt;<br>
&lt;br&gt;<br>
POST&nbsp;&lt;a&nbsp;href=&quot;http://mysite/upload.php&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mysite/upload.php&lt;/a&gt;&nbsp;HTTP/1.1&lt;br&gt;<br>
User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;Linux&nbsp;x86_64;&nbsp;rv:34.0)&nbsp;Gecko/20100101&lt;br&gt;<br>
Firefox/34.0&lt;br&gt;<br>
Accept:&nbsp;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&lt;br&gt;<br>
Accept-Language:&nbsp;en-US,en;q=0.5&lt;br&gt;<br>
Referer:&nbsp;&lt;a&nbsp;href=&quot;http://mysite/contentadmin.php&quot;&nbsp;target=&quot;_blank&quot;&gt;http://mysite/contentadmin.php&lt;/a&gt;&lt;br&gt;<br>
Content-Length:&nbsp;15748&lt;br&gt;<br>
Content-Type:&nbsp;multipart/form-data;&lt;br&gt;<br>
boundary=---------------------------100259790820425171131264960&lt;br&gt;<br>
Host:&nbsp;mysite&lt;br&gt;<br>
&lt;br&gt;<br>
The&nbsp;content-type&nbsp;is&nbsp;multipart&nbsp;so,&nbsp;in&nbsp;the&nbsp;body,&nbsp;there&nbsp;will&nbsp;be&nbsp;more&nbsp;than&nbsp;one&lt;br&gt;<br>
separated&nbsp;by&nbsp;the&nbsp;boundary&nbsp;identifier.&nbsp;Among&nbsp;these,&nbsp;there&nbsp;is&nbsp;the&nbsp;one&lt;br&gt;<br>
referred&nbsp;to&nbsp;a&nbsp;png&nbsp;image:&lt;br&gt;<br>
&lt;br&gt;<br>
-----------------------------100259790820425171131264960&lt;br&gt;<br>
Content-Disposition:&nbsp;form-data;&nbsp;name=&quot;upload&quot;;&nbsp;filename=&quot;waf.png&quot;&lt;br&gt;<br>
Content-Type:&nbsp;image/png&lt;br&gt;<br>
&lt;br&gt;<br>
In&nbsp;this&nbsp;case&nbsp;you&nbsp;should&nbsp;have&nbsp;to&nbsp;write&nbsp;rules&nbsp;acting&nbsp;on&nbsp;phase&nbsp;2&nbsp;body&nbsp;content,&lt;br&gt;<br>
checking&nbsp;the&nbsp;filename&nbsp;and&nbsp;content-type&nbsp;headers.&lt;br&gt;<br>
&lt;br&gt;<br>
Hope&nbsp;this&nbsp;could&nbsp;be&nbsp;of&nbsp;any&nbsp;help&nbsp;for&nbsp;you&lt;br&gt;<br>
&lt;br&gt;<br>
Paolo&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
Hi&nbsp;,&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;How&nbsp;can&nbsp;I&nbsp;block&nbsp;upload&nbsp;a&nbsp;specific&nbsp;file&nbsp;such&nbsp;as&nbsp;(.jsp/.php)&lt;br&gt;<br>
&gt;&nbsp;I&nbsp;configured&nbsp;this&nbsp;rule&nbsp;:&lt;br&gt;<br>
&gt;&nbsp;/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_30_http_policy.conf&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;with&nbsp;this&nbsp;:&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;SecAction&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; &quot;id:&#39;900012&#39;,&nbsp;\&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;phase:1,&lt;br&gt;<br>
&gt;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; t:none,&nbsp;\&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; setvar:&#39;tx.allowed_methods=GET&nbsp;HEAD&nbsp;POST&nbsp;OPTIONS&#39;,&nbsp;\&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;setvar:&#39;tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json&#39;,&lt;br&gt;<br>
&gt;&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; setvar:&#39;tx.allowed_http_versions=HTTP/0.9&nbsp;HTTP/1.0&nbsp;HTTP/1.1&#39;,&nbsp;\&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; setvar:&#39;tx.restricted_extensions=.asa/&nbsp;.jsp/&nbsp;.asax/&nbsp;.ascx/&nbsp;.axd/&nbsp;.backup/&lt;br&gt;<br>
&gt;&nbsp;.bak/&nbsp;.bat/&nbsp;.cdx/&nbsp;.cer/&nbsp;.cfg/&nbsp;.cmd/&nbsp;.com/&nbsp;.config/&nbsp;.conf/&nbsp;.cs/&nbsp;.csproj/&lt;br&gt;<br>
&gt;&nbsp;.csr/&nbsp;.dat/&nbsp;.db/&nbsp;.dbf/&nbsp;.dll/&nbsp;.dos/&nbsp;.htr/&nbsp;.htw/&nbsp;.ida/&nbsp;\&lt;br&gt;<br>
&gt;&nbsp;.idc/&nbsp;.idq/&nbsp;.inc/&nbsp;.ini/&nbsp;.key/&nbsp;.licx/&nbsp;.lnk/&nbsp;.log/&nbsp;.mdb/&nbsp;.old/&nbsp;.pass/&nbsp;.pdb/&lt;br&gt;<br>
&gt;&nbsp;.pol/&nbsp;.printer/&nbsp;.pwd/&nbsp;.resources/&nbsp;.resx/&nbsp;.sql/&nbsp;.sys/&nbsp;.vb/&nbsp;.vbs/&nbsp;.vbproj/&lt;br&gt;<br>
&gt;&nbsp;.vsdisco/&nbsp;.webinfo/&nbsp;.xsd/&nbsp;.xsx/&#39;,&nbsp;\&lt;br&gt;<br>
&gt; &nbsp; setvar:&#39;tx.restricted_headers=/Proxy-Connection/&nbsp;/Lock-Token/&lt;br&gt;<br>
&gt;&nbsp;/Content-Range/&nbsp;/Translate/&nbsp;/via/&nbsp;/if/&#39;,&nbsp;\&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; nolog,&nbsp;\&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt; &nbsp; pass&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;?But&nbsp;it&#39;s&nbsp;don&#39;t&nbsp;stop&nbsp;upload&nbsp;.jsp&nbsp;file.&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Have&nbsp;you&nbsp;any&nbsp;idea&nbsp;?&lt;br&gt;<br>
&gt;&lt;br&gt;<br>
&gt;&nbsp;Thank&nbsp;you?&lt;br&gt;<br>
--------------&nbsp;next&nbsp;part&nbsp;--------------&lt;br&gt;<br>
An&nbsp;HTML&nbsp;attachment&nbsp;was&nbsp;scrubbed...&lt;br&gt;<br>
URL:&nbsp;&lt;&lt;a&nbsp;href=&quot;http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150201/0c979474/attachment-0001.html&quot;&nbsp;target=&quot;_blank&quot;&gt;http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150201/0c979474/attachment-0001.html&lt;/a&gt;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
------------------------------&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Owasp-modsecurity-core-rule-set&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Owasp-modsecurity-core-rule-set@lists.owasp.org&quot;&gt;Owasp-modsecurity-core-rule-set@lists.owasp.org&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&quot;&nbsp;target=&quot;_blank&quot;&gt;https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set&lt;/a&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
End&nbsp;of&nbsp;Owasp-modsecurity-core-rule-set&nbsp;Digest,&nbsp;Vol&nbsp;70,&nbsp;Issue&nbsp;1&lt;br&gt;<br>
**************************************************************&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_signature&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;span&gt;&lt;font&nbsp;color=&quot;#999999&quot;&gt;&lt;b&gt;&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;<br>
&lt;/div&gt;&lt;/div&gt;<br>

</tt>
