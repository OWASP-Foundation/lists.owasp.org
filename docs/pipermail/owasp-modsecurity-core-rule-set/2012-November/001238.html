<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] patch for 2.2.5 CRS	modsecurity_crs_16_session_hijacking.conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20patch%20for%202.2.5%20CRS%0A%09modsecurity_crs_16_session_hijacking.conf&In-Reply-To=%3CCANfYGQ%3DPvudhhp0aO7P7H%2B8w5MZ%3D0yR4H9i1ibrTD7D9wsyf6A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001237.html">
   <LINK REL="Next"  HREF="001239.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] patch for 2.2.5 CRS	modsecurity_crs_16_session_hijacking.conf</H1>
    <B>Ben WIlliams</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20patch%20for%202.2.5%20CRS%0A%09modsecurity_crs_16_session_hijacking.conf&In-Reply-To=%3CCANfYGQ%3DPvudhhp0aO7P7H%2B8w5MZ%3D0yR4H9i1ibrTD7D9wsyf6A%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] patch for 2.2.5 CRS	modsecurity_crs_16_session_hijacking.conf">benwilliams+owasp at joobworld.com
       </A><BR>
    <I>Sun Nov 11 21:15:43 UTC 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="001237.html">[Owasp-modsecurity-core-rule-set] [BUGFIX] &quot;modsecurity_crs_41_xss_attacks.conf&quot; performance optimization test not working
</A></li>
        <LI>Next message: <A HREF="001239.html">[Owasp-modsecurity-core-rule-set] patch for 2.2.5 CRS	modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1238">[ date ]</a>
              <a href="thread.html#1238">[ thread ]</a>
              <a href="subject.html#1238">[ subject ]</a>
              <a href="author.html#1238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here are a couple of fixes I've made to the session hijacking CRS
2.2.5 rules in use with modsecurity 2.6.8.
Some of our cookie names have been changed, so ASPSESSIONIDXXX did not
match in RESPONSE_HEADERS:/Set-Cookie2?/ but did match in
REQUEST_COOKIES.

Also there is a bug related to comparisons on collection keys that do
not exist. When a request contains a cookie that has not been saved to
the SESSION collection before, the intention is for tx.anomaly_score
to be incremented by 5 (critical) and the rest of the checks skipped,
but this does not happen. Any test on a collection key that does not
exist always returns false. This means the test on SESSION:VALID &quot;!@eq
1&quot; returns false, when the intention is for it to return true if the
session cookie has not been seen before.  And the following rules in
the block are run which triggers 981059,981060,981061 to return true
since it is a new session collection withou ip_hash or ua_hash keys.

--
Ben
-------------- next part --------------
A non-text attachment was scrubbed...
Name: modsecurity_crs_16_session_hijacking.conf.patch
Type: application/octet-stream
Size: 2187 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20121112/7c94fbc7/attachment.obj">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20121112/7c94fbc7/attachment.obj</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001237.html">[Owasp-modsecurity-core-rule-set] [BUGFIX] &quot;modsecurity_crs_41_xss_attacks.conf&quot; performance optimization test not working
</A></li>
	<LI>Next message: <A HREF="001239.html">[Owasp-modsecurity-core-rule-set] patch for 2.2.5 CRS	modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1238">[ date ]</a>
              <a href="thread.html#1238">[ thread ]</a>
              <a href="subject.html#1238">[ subject ]</a>
              <a href="author.html#1238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
