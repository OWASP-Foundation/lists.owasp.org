From corovin at starnet.md  Thu Dec  4 02:52:11 2014
From: corovin at starnet.md (Andrei)
Date: Thu, 04 Dec 2014 04:52:11 +0200
Subject: [Owasp-modsecurity-core-rule-set] Http Flood Attack from list of
	WordPress vulnerabilities
Message-ID: <da317b9e3f4066f06041d7855c3c2557@starnet.md>

Hello,

How can I drop on ModSecurity for IIS any request from user-agent 
WordPress/?

IIS 8.0 access log:
------------
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 184.154.226.5 HTTP/1.0 
WordPress/4.0.1;+http://www.nonohitters.com;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 199 9422
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 77.68.54.144 HTTP/1.0 WordPress/3.4;+http://appyhour.co - - 
example.com 200 0 0 26063 157 8484
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 194.145.201.141 HTTP/1.0 
WordPress/4.0.1;+http://microdermal-piercing.nl;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 203 9843
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 213.5.176.14 HTTP/1.0 
WordPress/3.8.5;+http://www.uvac.ac.uk;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 194 8468
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 84.200.79.196 HTTP/1.0 
WordPress/4.0;+http://milla.smyck.org;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 193 8453
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 188.93.144.146 HTTP/1.0 
WordPress/3.5.1;+http://www.bastiaanfranken.nl/blog - - example.com 200 
0 0 26063 175 9828
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 213.171.218.216 HTTP/1.0 
WordPress/4.0.1;+http://www.wordpress.michaelgrange.co.uk;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 213 8468
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 174.139.169.10 HTTP/1.0 
WordPress/4.0.1;+http://www.zahnarzt-koeln.org;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 202 9734
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 185.38.251.154 HTTP/1.0 
WordPress/4.0.1;+http://www.zac-efron.us;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 196 9047
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 69.27.40.40 HTTP/1.0 
WordPress/2.8.5;+http://funktion.catalystexhibit.com - - example.com 200 
0 0 26063 213 9953
2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 
- 85.13.143.156 HTTP/1.0 
WordPress/4.0.1;+http://www.matchanglershop.de/blog;+verifying+pingback+from+89.248.174.78 
- - example.com 200 0 0 26063 207 9922
------------

But need to allow this:

[client 192.168.1.100:13015] ModSecurity: Access denied with code 403 
(phase 1). Pattern match "WordPress/" at REQUEST_HEADERS:User-Agent. 
[file "C:\/Program Files/ModSecurity 
IIS/owasp_crs/custom/modscurity_crs_15_custom.conf"] [line "13"] [id 
"8"] [msg "Prevent DDos from WordPress CMS"] [hostname "WebServer"] [uri 
"/wp-cron.php?doing_wp_cron=1417660712.6131439208984375000000"] 
[unique_id "17654110601569370214"]

From jamuse at owasp.org  Thu Dec  4 10:39:14 2014
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Thu, 4 Dec 2014 12:39:14 +0200
Subject: [Owasp-modsecurity-core-rule-set] Http Flood Attack from list
 of WordPress vulnerabilities
In-Reply-To: <da317b9e3f4066f06041d7855c3c2557@starnet.md>
References: <da317b9e3f4066f06041d7855c3c2557@starnet.md>
Message-ID: <CAC+O4mHPPprJDyaP=qTggo6cf6AH-Hv6Nz-f6CgW6zzgOMim1g@mail.gmail.com>

Hi Andrei,

Based on your question, are you asking how to stop all external requests
that contain the string WordPress in the UA string, but allow the local
Wordpress instance to send requests? You can do that by chaining your rule
with logic that checks the REMOTE_ADDR variable does not equal
192.168.1.100.

- Josh

On Thu, Dec 4, 2014 at 4:52 AM, Andrei <corovin at starnet.md> wrote:

> Hello,
>
> How can I drop on ModSecurity for IIS any request from user-agent
> WordPress/?
>
> IIS 8.0 access log:
> ------------
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 184.154.226.5 HTTP/1.0 WordPress/4.0.1;+http://www.nonohitters.com
> ;+verifying+pingback+from+89.248.174.78 - - example.com 200 0 0 26063 199
> 9422
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 77.68.54.144 HTTP/1.0 WordPress/3.4;+http://appyhour.co - - example.com
> 200 0 0 26063 157 8484
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 194.145.201.141 HTTP/1.0 WordPress/4.0.1;+http://microdermal-piercing.nl;+
> verifying+pingback+from+89.248.174.78 - - example.com 200 0 0 26063 203
> 9843
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 213.5.176.14 HTTP/1.0 WordPress/3.8.5;+http://www.uvac.ac.uk;+verifying+pingback+from+89.248.174.78
> - - example.com 200 0 0 26063 194 8468
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 84.200.79.196 HTTP/1.0 WordPress/4.0;+http://milla.smyck.org
> ;+verifying+pingback+from+89.248.174.78 - - example.com 200 0 0 26063 193
> 8453
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 188.93.144.146 HTTP/1.0 WordPress/3.5.1;+http://www.
> bastiaanfranken.nl/blog - - example.com 200 0 0 26063 175 9828
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 213.171.218.216 HTTP/1.0 WordPress/4.0.1;+http://www.
> wordpress.michaelgrange.co.uk;+verifying+pingback+from+89.248.174.78 - -
> example.com 200 0 0 26063 213 8468
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 174.139.169.10 HTTP/1.0 WordPress/4.0.1;+http://www.zahnarzt-koeln.org
> ;+verifying+pingback+from+89.248.174.78 - - example.com 200 0 0 26063 202
> 9734
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 185.38.251.154 HTTP/1.0 WordPress/4.0.1;+http://www.zac-efron.us
> ;+verifying+pingback+from+89.248.174.78 - - example.com 200 0 0 26063 196
> 9047
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 69.27.40.40 HTTP/1.0 WordPress/2.8.5;+http://funktion.catalystexhibit.com
> - - example.com 200 0 0 26063 213 9953
> 2014-12-03 16:30:08 W3SVC1 WebServer 192.168.1.100 GET /Index.aspx - 80 -
> 85.13.143.156 HTTP/1.0 WordPress/4.0.1;+http://www.
> matchanglershop.de/blog;+verifying+pingback+from+89.248.174.78 - -
> example.com 200 0 0 26063 207 9922
> ------------
>
> But need to allow this:
>
> [client 192.168.1.100:13015] ModSecurity: Access denied with code 403
> (phase 1). Pattern match "WordPress/" at REQUEST_HEADERS:User-Agent. [file
> "C:\/Program Files/ModSecurity IIS/owasp_crs/custom/
> modscurity_crs_15_custom.conf"] [line "13"] [id "8"] [msg "Prevent DDos
> from WordPress CMS"] [hostname "WebServer"] [uri
> "/wp-cron.php?doing_wp_cron=1417660712.6131439208984375000000"]
> [unique_id "17654110601569370214"]
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141204/088bca11/attachment.html>

From think.sabin at gmail.com  Mon Dec  8 09:59:11 2014
From: think.sabin at gmail.com (Sabin Ranjit)
Date: Mon, 8 Dec 2014 15:44:11 +0545
Subject: [Owasp-modsecurity-core-rule-set] malicious file not getting
	blocked while uploading
Message-ID: <CAE9Kp-bofUaXr4kaqQS9YBG1UYhhM4b6qv1Jh5d4RkmYU32eEg@mail.gmail.com>

hi,
I'm using modsecurity_crs_46_av_scanning to scan a file with clamAV when
user uploads a file. When i tested i did get the log regarding the
modsecurity telling its malicious but did not block it from uploading into
the server. The modsecurity was running in active mode.
How can it be that configured to block malicious file uploads? I got follow
log:

Message: Warning. File
"/tmp//20141208-005725-VIVn9H8AAQEAADlz2AAAAAAG-file-pDG9cN" rejected by
the approver script "/usr/share/modsecurity-crs/util/av-scanning/runav.pl":
0 clamscan: Suspect.PDF.EmbeddedExecutable-2 [file
"/usr/share/modsecurity-crs/activated_rules/modsecurity_crs_46_av_scanning.conf"]
[line "17"] [id "950115"] [msg "Virus found in uploaded file"] [severity
"CRITICAL"] [tag "MALICIOUS_SOFTWARE/VIRUS"] [tag "PCI/5.1"]
Apache-Handler: application/x-httpd-php
Stopwatch: 1418029044999223 91983157 (- - -)
Stopwatch2: 1418029044999223 91983157; combined=90317213, p1=68,
p2=90317138, p3=3, p4=0, p5=4, sr=0, sw=0, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for Apache/2.7.7 (http://www.modsecurity.org/).
Server: Apache/2.4.7 (Ubuntu)
Engine-Mode: "ENABLED"

--87cb1800-J--
3,755390,"evil.pdf","<Unknown ContentType>"
Total,755390


thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141208/a8af211f/attachment.html>

From ilyassikai at gmail.com  Mon Dec 22 09:46:39 2014
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Mon, 22 Dec 2014 09:46:39 +0000
Subject: [Owasp-modsecurity-core-rule-set] Don't filter requests to a
	subdomain
Message-ID: <CAMmziWfg0x35y2sDvu_E7bVaXaJ0-kHYHW0nN1RoU-wpssdS-A@mail.gmail.com>

Hi

We have a sub-site www.abcdef.com/Bilbo

We want disable WAF for   this subdomain /BilBO   only

(this website is made by java)

How I can do that?

 thank you

-- 
*Ilyass kaouam*
*Systems administrator*
* at Inforisk Group Finaccess *
*European Masters in Information Technology*
*Portable : (212) *
*6 34 57 14 36**http://www.inforisk.ma <http://www.inforisk.ma>*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141222/b78e5d9d/attachment.html>

From jamuse at owasp.org  Mon Dec 22 11:32:00 2014
From: jamuse at owasp.org (Josh Amishav-Zlatin)
Date: Mon, 22 Dec 2014 13:32:00 +0200
Subject: [Owasp-modsecurity-core-rule-set] Don't filter requests to a
	subdomain
In-Reply-To: <CAMmziWfg0x35y2sDvu_E7bVaXaJ0-kHYHW0nN1RoU-wpssdS-A@mail.gmail.com>
References: <CAMmziWfg0x35y2sDvu_E7bVaXaJ0-kHYHW0nN1RoU-wpssdS-A@mail.gmail.com>
Message-ID: <CAC+O4mELWwk+x=NLsH0BqEBzFXtW9NRtxF7MR04YJTfJayXG0w@mail.gmail.com>

On Mon, Dec 22, 2014 at 11:46 AM, Ilyass Kaouam <ilyassikai at gmail.com>
wrote:

> Hi
>
> We have a sub-site www.abcdef.com/Bilbo
>
> We want disable WAF for   this subdomain /BilBO   only
>

Hi Ilyass,

One way to do this is via a rule like:

SecRule REQUEST_URI "^/bilbo"
id:1,t:none,t:lowercase,nolog,phase:1,allow,ctl:ruleEngine=Off,ctl:auditEngine=Off"

Note you mention both /Bilbo and /BilBo above so I'm assuming the server is
case-insensitive and used bilbo in the rule and the lowercase
transformation.

- Josh


>
> (this website is made by java)
>
> How I can do that?
>
>  thank you
>
> --
> *Ilyass kaouam*
> *Systems administrator*
> * at Inforisk Group Finaccess *
> *European Masters in Information Technology*
> *Portable : (212) *
> *6 34 57 14 36**http://www.inforisk.ma <http://www.inforisk.ma>*
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141222/4d30d3dd/attachment.html>

From ilyassikai at gmail.com  Mon Dec 22 11:56:28 2014
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Mon, 22 Dec 2014 11:56:28 +0000
Subject: [Owasp-modsecurity-core-rule-set] Don't filter requests to a
	subdomain
In-Reply-To: <CAC+O4mELWwk+x=NLsH0BqEBzFXtW9NRtxF7MR04YJTfJayXG0w@mail.gmail.com>
References: <CAMmziWfg0x35y2sDvu_E7bVaXaJ0-kHYHW0nN1RoU-wpssdS-A@mail.gmail.com>
	<CAC+O4mELWwk+x=NLsH0BqEBzFXtW9NRtxF7MR04YJTfJayXG0w@mail.gmail.com>
Message-ID: <CAMmziWfb7UaKCVyKXXcKhmsqUbi2pbE9MwLkfyxpSG5k5LmAUg@mail.gmail.com>

Hi Josh,

Thank you for your replay :)

in which file I can  insert this rule ?

Thank you.

2014-12-22 11:32 GMT+00:00 Josh Amishav-Zlatin <jamuse at owasp.org>:

> On Mon, Dec 22, 2014 at 11:46 AM, Ilyass Kaouam <ilyassikai at gmail.com>
> wrote:
>
>> Hi
>>
>> We have a sub-site www.abcdef.com/Bilbo
>>
>> We want disable WAF for   this subdomain /BilBO   only
>>
>
> Hi Ilyass,
>
> One way to do this is via a rule like:
>
> SecRule REQUEST_URI "^/bilbo"
> id:1,t:none,t:lowercase,nolog,phase:1,allow,ctl:ruleEngine=Off,ctl:auditEngine=Off"
>
> Note you mention both /Bilbo and /BilBo above so I'm assuming the server
> is case-insensitive and used bilbo in the rule and the lowercase
> transformation.
>
> - Josh
>
>
>>
>> (this website is made by java)
>>
>> How I can do that?
>>
>>  thank you
>>
>> --
>> *Ilyass kaouam*
>> *Systems administrator*
>> * at Inforisk Group Finaccess *
>> *European Masters in Information Technology*
>> *Portable : (212) *
>> *6 34 57 14 36**http://www.inforisk.ma <http://www.inforisk.ma>*
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>>
>


-- 
*Ilyass kaouam*
*Systems administrator*
* at Inforisk Group Finaccess *
*European Masters in Information Technology*
*Portable : (212) *
*6 34 57 14 36**http://www.inforisk.ma <http://www.inforisk.ma>*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141222/dfeaf01b/attachment.html>

From ilyassikai at gmail.com  Thu Dec 25 13:03:11 2014
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Thu, 25 Dec 2014 13:03:11 +0000
Subject: [Owasp-modsecurity-core-rule-set] error in
	/var/log/httpd/modsec_audit.log
Message-ID: <CAMmziWczzW3iDeM_sAXP5ZSJ1irJRbUMcyGoWj0khg_43x7_eQ@mail.gmail.com>

Hi,

What this message mean :

*Message: collections_remove_stale: Failed to access DBM file
"/var/lib/mod_security/global": Permission denied*

*Message: collections_remove_stale: Failed to access DBM file
"/var/lib/mod_security/ip": Permission denied*

How can I fix it ?
Thank you.
-- 
*Ilyass kaouam*
*Systems administrator*
* at Inforisk Group Finaccess *
*European Masters in Information Technology*
*Portable : (212) *
*6 34 57 14 36**http://www.inforisk.ma <http://www.inforisk.ma>*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141225/8a245014/attachment.html>

From ross at ti.com  Thu Dec 25 14:49:51 2014
From: ross at ti.com (Ross, Justin)
Date: Thu, 25 Dec 2014 14:49:51 +0000
Subject: [Owasp-modsecurity-core-rule-set] error
	in	/var/log/httpd/modsec_audit.log
In-Reply-To: <CAMmziWczzW3iDeM_sAXP5ZSJ1irJRbUMcyGoWj0khg_43x7_eQ@mail.gmail.com>
References: <CAMmziWczzW3iDeM_sAXP5ZSJ1irJRbUMcyGoWj0khg_43x7_eQ@mail.gmail.com>
Message-ID: <A35E8187-177D-48A3-A773-20599AE0B63B@ti.com>

Make sure the files are owned by the apache or web or whatever user you have running apache.

Justin

On Dec 25, 2014, at 7:24 AM, "Ilyass Kaouam" <ilyassikai at gmail.com<mailto:ilyassikai at gmail.com>> wrote:

Hi,

What this message mean :

Message: collections_remove_stale: Failed to access DBM file "/var/lib/mod_security/global": Permission denied

Message: collections_remove_stale: Failed to access DBM file "/var/lib/mod_security/ip": Permission denied

How can I fix it ?
Thank you.
--
Ilyass kaouam
Systems administrator at Inforisk Group Finaccess
European Masters in Information Technology
Portable : (212) 6 34 57 14 36
http://www.inforisk.ma
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141225/ccdbaa52/attachment.html>

From ilyassikai at gmail.com  Thu Dec 25 15:09:32 2014
From: ilyassikai at gmail.com (Ilyass Kaouam)
Date: Thu, 25 Dec 2014 15:09:32 +0000
Subject: [Owasp-modsecurity-core-rule-set] error in
	/var/log/httpd/modsec_audit.log
In-Reply-To: <A35E8187-177D-48A3-A773-20599AE0B63B@ti.com>
References: <CAMmziWczzW3iDeM_sAXP5ZSJ1irJRbUMcyGoWj0khg_43x7_eQ@mail.gmail.com>
	<A35E8187-177D-48A3-A773-20599AE0B63B@ti.com>
Message-ID: <CAMmziWe0a9OsgnZG6F=z0hG4B20xVwBNR3ETnzMGxjFiiE-7qg@mail.gmail.com>

Thank you :)

2014-12-25 14:49 GMT+00:00 Ross, Justin <ross at ti.com>:

>  Make sure the files are owned by the apache or web or whatever user you
> have running apache.
>
>  Justin
>
> On Dec 25, 2014, at 7:24 AM, "Ilyass Kaouam" <ilyassikai at gmail.com> wrote:
>
>   Hi,
>
>  What this message mean :
>
>  *Message: collections_remove_stale: Failed to access DBM file
> "/var/lib/mod_security/global": Permission denied*
>
> *Message: collections_remove_stale: Failed to access DBM file
> "/var/lib/mod_security/ip": Permission denied*
>
>  How can I fix it ?
> Thank you.
>  --
>  *Ilyass kaouam*
> *Systems administrator*
> * at Inforisk Group Finaccess  *
> *European Masters in Information Technology *
> *Portable : (212) *
> *6 34 57 14 36 **http://www.inforisk.ma <http://www.inforisk.ma>*
>
>  _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>


-- 
*Ilyass kaouam*
*Systems administrator*
* at Inforisk Group Finaccess *
*European Masters in Information Technology*
*Portable : (212) *
*6 34 57 14 36**http://www.inforisk.ma <http://www.inforisk.ma>*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20141225/76a98f59/attachment.html>

