<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Problems with Brute Force rules
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Problems%20with%20Brute%20Force%0A%20rules&In-Reply-To=%3CCB0FB0CB.3DF14%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000942.html">
   <LINK REL="Next"  HREF="000944.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Problems with Brute Force rules</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Problems%20with%20Brute%20Force%0A%20rules&In-Reply-To=%3CCB0FB0CB.3DF14%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Problems with Brute Force rules">RBarnett at trustwave.com
       </A><BR>
    <I>Thu Dec 15 19:16:30 UTC 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000942.html">[Owasp-modsecurity-core-rule-set] Problems with Brute Force rules
</A></li>
        <LI>Next message: <A HREF="000944.html">[Owasp-modsecurity-core-rule-set] Problems with Brute Forcerules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#943">[ date ]</a>
              <a href="thread.html#943">[ thread ]</a>
              <a href="subject.html#943">[ subject ]</a>
              <a href="author.html#943">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 12/15/11 1:52 PM, &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">danil at whiterose.org</A>&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">danil at whiterose.org</A>&gt; wrote:

&gt;<i>
</I>&gt;<i>My test team is reporting unfortunate results with the brute force rules.
</I>&gt;<i>
</I>&gt;<i>CentOS release 5.7 (Final)
</I>&gt;<i>
</I>&gt;<i>Server version: Apache/2.2.21 (Unix)
</I>&gt;<i>Server built:   Sep 22 2011 17:34:16
</I>&gt;<i>
</I>&gt;<i>ModSecurity 2.5.9
</I>&gt;<i>SecComponentSignature &quot;core ruleset/2.2.2&quot;
</I>&gt;<i>
</I>&gt;<i>The symptom that we are seeing is that 981042 doesn't seem to be picking
</I>&gt;<i>up
</I>&gt;<i>the
</I>&gt;<i>value of tx.brute_force_counter_threshold.  If I enable logging on that
</I>&gt;<i>rule,
</I>&gt;<i>the entry in the mod security log reads
</I>&gt;<i>
</I>&gt;<i>Message: Warning. Operator GT matched 0 at IP:brute_force_counter. [file
</I>&gt;<i>&quot;/etc/httpd/conf.d/modsecurity_crs/experimental_rules/modsecurity_crs_11_b
</I>&gt;<i>ru
</I>&gt;<i>te_f
</I>&gt;<i>orce.conf&quot;] [line &quot;53&quot;] [id &quot;981042&quot;]
</I>&gt;<i>
</I>&gt;<i>Our configuration of rule 981214 is almost right out of the box
</I>&gt;<i>
</I>&gt;<i>SecAction &quot;phase:1,id:'981214',t:none,nolog,pass, \
</I>&gt;<i>setvar:'tx.brute_force_protected_urls=/protectThisUrl', \
</I>&gt;<i>setvar:'tx.brute_force_burst_time_slice=60', \
</I>&gt;<i>setvar:'tx.brute_force_counter_threshold=10', \
</I>&gt;<i>setvar:'tx.brute_force_block_timeout=60'&quot;
</I>&gt;<i>
</I>&gt;<i>My development sandbox behaves as I would expect:
</I>&gt;<i>
</I>&gt;<i>Message: Warning. Operator GT matched 10 at IP:brute_force_counter. [file
</I>&gt;<i>&quot;C:/Program Files (x86)/Apache Software
</I>&gt;<i>Foundation/Apache2.2/conf/modsecurity_crs/experimental_rules/modsecurity_c
</I>&gt;<i>rs
</I>&gt;<i>_11_
</I>&gt;<i>brute_force.conf&quot;] [line &quot;53&quot;] [id &quot;981042&quot;]
</I>&gt;<i>
</I>&gt;<i>However, the development sandbox is running windows, and is using the
</I>&gt;<i>binaries I
</I>&gt;<i>downloaded for ModSecurity 2.6.2
</I>&gt;<i>
</I>&gt;<i>Have I simply loaded the experimental rules into a version of modsecurity
</I>&gt;<i>that
</I>&gt;<i>doesn't support them, or is something more sinister going on?  I'm running
</I>&gt;<i>out
</I>&gt;<i>of ideas on how to trouble shoot this.
</I>&gt;<i>
</I>&gt;<i>Thanks,
</I>&gt;<i>Danil
</I>
Those rules are tracking and inspecting data in the IP persistent
collection data.  Do you have the IP collection initiation rules activated
at the end of the modsecurity_crs_10_config.conf file?

#
# -=[ Global and IP Collections ]=-
#
# Create both Global and IP collections for rules to use
# There are some CRS rules that assume that these two collections
# have already been initiated.
#
SecRule REQUEST_HEADERS:User-Agent &quot;^(.*)$&quot;
&quot;phase:1,id:'981217',t:none,pass,nolog,t:sha1,t:hexEncode,setvar:tx.ua_hash
=%{matched_var}&quot;
SecRule REQUEST_HEADERS:x-forwarded-for
&quot;^\b(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})\b&quot;
&quot;phase:1,id:'981225',t:none,pass,nolog,capture,setvar:tx.real_ip=%{tx.1}&quot;
SecRule &amp;TX:REAL_IP &quot;!@eq 0&quot;
&quot;phase:1,id:'981226',t:none,pass,nolog,initcol:global=global,initcol:ip=%{t
x.real_ip}_%{tx.ua_hash}&quot;
SecRule &amp;TX:REAL_IP &quot;@eq 0&quot;
&quot;phase:1,id:'981218',t:none,pass,nolog,initcol:global=global,initcol:ip=%{r
emote_addr}_%{tx.ua_hash}&quot;


-Ryan



This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000942.html">[Owasp-modsecurity-core-rule-set] Problems with Brute Force rules
</A></li>
	<LI>Next message: <A HREF="000944.html">[Owasp-modsecurity-core-rule-set] Problems with Brute Forcerules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#943">[ date ]</a>
              <a href="thread.html#943">[ thread ]</a>
              <a href="subject.html#943">[ subject ]</a>
              <a href="author.html#943">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
