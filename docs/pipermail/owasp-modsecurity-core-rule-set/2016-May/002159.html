<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Facebook scrape problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Facebook%20scrape%20problem&In-Reply-To=%3C20160517061508.GA12216%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002158.html">
   <LINK REL="Next"  HREF="002160.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Facebook scrape problem</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Facebook%20scrape%20problem&In-Reply-To=%3C20160517061508.GA12216%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Facebook scrape problem">christian.folini at netnea.com
       </A><BR>
    <I>Tue May 17 06:15:08 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002158.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
        <LI>Next message: <A HREF="002160.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2159">[ date ]</a>
              <a href="thread.html#2159">[ thread ]</a>
              <a href="subject.html#2159">[ subject ]</a>
              <a href="author.html#2159">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kenneth,

You are running in blocking mode with anomaly scoring off.

This is the hardest mode to tune and it will block immediately
if something is amiss.

I suggest you run in blocking mode with anomaly scoring on and
a high anomaly limit (-&gt; 1K or more).

The rule which blocked your request is 958291. It is known for
a lot of false positives and it is not one of my favorite rules.

You can switch it off completely with 
SecRuleRemoveByID 958291

But be assured given your config, the next rule will bite immediately.

We are sorry, getting starting with the CRS is so hard. We are working
on a new release and new documentation which will make things easier.

Best,

Christian




On Tue, May 17, 2016 at 01:07:13PM +0800, T. Kenneth Lojo (IRRI) wrote:
&gt;<i> I get this on my log:
</I>&gt;<i> 
</I>&gt;<i> --5d2d5838-A--
</I>&gt;<i> 
</I>&gt;<i> [17/May/2016:13:03:18 +0800] VzqmFgqA0uwAAA7nNtkAAAAW 66.220.158.117 29357
</I>&gt;<i> 10.144.68.249 80
</I>&gt;<i> 
</I>&gt;<i> --5d2d5838-B--
</I>&gt;<i> 
</I>&gt;<i> GET
</I>&gt;<i> /our-impact/protecting-the-environment/increasing-soil-health-and-productivity-of-rice-crops
</I>&gt;<i> HTTP/1.1
</I>&gt;<i> 
</I>&gt;<i> User-Agent: facebookexternalhit/1.1 (+
</I>&gt;<i> <A HREF="http://www.facebook.com/externalhit_uatext.php">http://www.facebook.com/externalhit_uatext.php</A>)
</I>&gt;<i> 
</I>&gt;<i> Accept: */*
</I>&gt;<i> 
</I>&gt;<i> Accept-Encoding: deflate, gzip
</I>&gt;<i> 
</I>&gt;<i> Range: bytes=0-524287
</I>&gt;<i> 
</I>&gt;<i> Host: irri.org
</I>&gt;<i> 
</I>&gt;<i> Connection: close
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --5d2d5838-F--
</I>&gt;<i> 
</I>&gt;<i> HTTP/1.1 403 Forbidden
</I>&gt;<i> 
</I>&gt;<i> Content-Length: 293
</I>&gt;<i> 
</I>&gt;<i> Connection: close
</I>&gt;<i> 
</I>&gt;<i> Content-Type: text/html; charset=iso-8859-1
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --5d2d5838-E--
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --5d2d5838-H--
</I>&gt;<i> 
</I>&gt;<i> Message: Access denied with code 403 (phase 2). String match &quot;bytes=0-&quot; at
</I>&gt;<i> REQUEST_HEADERS:Range. [file
</I>&gt;<i> &quot;/etc/httpd/crs/owasp-modsecurity-crs/base_rules/modsecurity_crs_20_protocol_violations.conf&quot;]
</I>&gt;<i> [line &quot;428&quot;] [id &quot;958291&quot;] [rev &quot;2&quot;] [msg &quot;Range: field exists and begins
</I>&gt;<i> with 0.&quot;] [data &quot;bytes=0-524287&quot;] [severity &quot;WARNING&quot;] [ver
</I>&gt;<i> &quot;OWASP_CRS/2.2.9&quot;] [maturity &quot;6&quot;] [accuracy &quot;8&quot;] [tag
</I>&gt;<i> &quot;OWASP_CRS/PROTOCOL_VIOLATION/INVALID_HREQ&quot;]
</I>&gt;<i> 
</I>&gt;<i> Action: Intercepted (phase 2)
</I>&gt;<i> 
</I>&gt;<i> Stopwatch: 1463461398712034 9447 (- - -)
</I>&gt;<i> 
</I>&gt;<i> Stopwatch2: 1463461398712034 9447; combined=438, p1=345, p2=53, p3=0, p4=0,
</I>&gt;<i> p5=38, sr=183, sw=2, l=0, gc=0
</I>&gt;<i> 
</I>&gt;<i> Response-Body-Transformed: Dechunked
</I>&gt;<i> 
</I>&gt;<i> Producer: ModSecurity for Apache/2.7.3 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;<i> OWASP_CRS/2.2.9. &lt;<A HREF="http://2.2.0.9/">http://2.2.0.9/</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> Server: Apache
</I>&gt;<i> 
</I>&gt;<i> Engine-Mode: &quot;ENABLED&quot;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --5d2d5838-Z--
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Tue, May 17, 2016 at 1:00 PM, T. Kenneth Lojo (IRRI) &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">t.lojo at irri.org</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Can you point me to the right direction in correcting? It seems to be
</I>&gt;<i> &gt; blocking all links that we post on Facebook other than the homepage. Which
</I>&gt;<i> &gt; logs do I need to analyze? How do I circumvent?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Tue, May 17, 2016 at 12:57 PM, Christian Folini &lt;
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Kenneth,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Tue, May 17, 2016 at 12:28:54PM +0800, T. Kenneth Lojo (IRRI) wrote:
</I>&gt;<i> &gt;&gt; &gt; Our company has started using mod security as a web application firewall
</I>&gt;<i> &gt;&gt; &gt; and we used the OWASP core rule set. When we apply the CRS Facebook
</I>&gt;<i> &gt;&gt; cannot
</I>&gt;<i> &gt;&gt; &gt; scrape our site and gives a 403 forbidden message. Can you provide
</I>&gt;<i> &gt;&gt; &gt; directions on how to correct this? Our website is <A HREF="http://irri.org">http://irri.org</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; This is typical behaviour for a new CRS install, which blocks
</I>&gt;<i> &gt;&gt; what seem to be legitimate requests as false positives.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; If you want to continue in blocking mode, you need to tune the system.
</I>&gt;<i> &gt;&gt; Which means you need to get rid of the false positives, by
</I>&gt;<i> &gt;&gt; writing ModSec rules telling the engine to circumvent the said
</I>&gt;<i> &gt;&gt; offending rules.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Google for ModSecurity tuning and false positives.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; And good luck!
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Christian
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; --
</I>&gt;<i> &gt;&gt; First you make it, then it works, then you invite people to
</I>&gt;<i> &gt;&gt; make it better.
</I>&gt;<i> &gt;&gt; -- Eben Moglen, Free Software Foundation
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; --
</I>&gt;<i> &gt; *T. Kenneth S. Lojo*
</I>&gt;<i> &gt; Specialist-Online Media Design
</I>&gt;<i> &gt; [image: IRRI] &lt;<A HREF="http://irri.org/">http://irri.org/</A>&gt; +63 2 580 5600 ext. 2703/2744
</I>&gt;<i> &gt; +63 928 209 1191 (mobile)
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">t.lojo at irri.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">g.lavina at irri.org</A>&gt;
</I>&gt;<i> &gt; www.irri.org
</I>&gt;<i> &gt; [image: Facebook] &lt;<A HREF="http://www.facebook.com/IRRI.ricenews">http://www.facebook.com/IRRI.ricenews</A>&gt; [image: Twitter]
</I>&gt;<i> &gt; &lt;<A HREF="http://twitter.com/RiceResearch">http://twitter.com/RiceResearch</A>&gt; [image: Flickr]
</I>&gt;<i> &gt; &lt;<A HREF="http://www.flickr.com/photos/ricephotos/collections/">http://www.flickr.com/photos/ricephotos/collections/</A>&gt; [image: Youtube]
</I>&gt;<i> &gt; &lt;<A HREF="http://www.youtube.com/user/irrivideo/featured">http://www.youtube.com/user/irrivideo/featured</A>&gt; [image: Scribd]
</I>&gt;<i> &gt; &lt;<A HREF="http://www.scribd.com/IRRI_resources">http://www.scribd.com/IRRI_resources</A>&gt; [image: Linkedin]
</I>&gt;<i> &gt; &lt;<A HREF="http://www.linkedin.com/company/international-rice-research-institute">http://www.linkedin.com/company/international-rice-research-institute</A>&gt; [image:
</I>&gt;<i> &gt; Soundcloud] &lt;<A HREF="https://soundcloud.com/irri-radio">https://soundcloud.com/irri-radio</A>&gt; [image: Google+]
</I>&gt;<i> &gt; &lt;<A HREF="https://plus.google.com/103972671963502739315">https://plus.google.com/103972671963502739315</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The International Rice Research Institute &lt;<A HREF="http://irri.org">http://irri.org</A>&gt; is a member
</I>&gt;<i> &gt; of the CGIAR &lt;<A HREF="http://www.cgiar.org/">http://www.cgiar.org/</A>&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> *T. Kenneth S. Lojo*
</I>&gt;<i> Specialist-Online Media Design
</I>&gt;<i> [image: IRRI] &lt;<A HREF="http://irri.org/">http://irri.org/</A>&gt; +63 2 580 5600 ext. 2703/2744
</I>&gt;<i> +63 928 209 1191 (mobile)
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">t.lojo at irri.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">g.lavina at irri.org</A>&gt;
</I>&gt;<i> www.irri.org
</I>&gt;<i> [image: Facebook] &lt;<A HREF="http://www.facebook.com/IRRI.ricenews">http://www.facebook.com/IRRI.ricenews</A>&gt; [image: Twitter]
</I>&gt;<i> &lt;<A HREF="http://twitter.com/RiceResearch">http://twitter.com/RiceResearch</A>&gt; [image: Flickr]
</I>&gt;<i> &lt;<A HREF="http://www.flickr.com/photos/ricephotos/collections/">http://www.flickr.com/photos/ricephotos/collections/</A>&gt; [image: Youtube]
</I>&gt;<i> &lt;<A HREF="http://www.youtube.com/user/irrivideo/featured">http://www.youtube.com/user/irrivideo/featured</A>&gt; [image: Scribd]
</I>&gt;<i> &lt;<A HREF="http://www.scribd.com/IRRI_resources">http://www.scribd.com/IRRI_resources</A>&gt; [image: Linkedin]
</I>&gt;<i> &lt;<A HREF="http://www.linkedin.com/company/international-rice-research-institute">http://www.linkedin.com/company/international-rice-research-institute</A>&gt; [image:
</I>&gt;<i> Soundcloud] &lt;<A HREF="https://soundcloud.com/irri-radio">https://soundcloud.com/irri-radio</A>&gt; [image: Google+]
</I>&gt;<i> &lt;<A HREF="https://plus.google.com/103972671963502739315">https://plus.google.com/103972671963502739315</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> The International Rice Research Institute &lt;<A HREF="http://irri.org">http://irri.org</A>&gt; is a member of
</I>&gt;<i> the CGIAR &lt;<A HREF="http://www.cgiar.org/">http://www.cgiar.org/</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> -- 
</I>&gt;<i> The International Rice Research Institute &lt;<A HREF="http://irri.org">http://irri.org</A>&gt; is a member of 
</I>&gt;<i> the CGIAR &lt;<A HREF="http://cgiar.org">http://cgiar.org</A>&gt; consortium
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002158.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
	<LI>Next message: <A HREF="002160.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2159">[ date ]</a>
              <a href="thread.html#2159">[ thread ]</a>
              <a href="subject.html#2159">[ subject ]</a>
              <a href="author.html#2159">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
