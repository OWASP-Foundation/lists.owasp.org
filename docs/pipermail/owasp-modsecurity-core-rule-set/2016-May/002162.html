<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Facebook scrape problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Facebook%20scrape%20problem&In-Reply-To=%3CCAH0WUhGFrHLNFFxGYZDFWBewsjAoZfZ946gNm5_943oyQ_VWww%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002161.html">
   <LINK REL="Next"  HREF="002163.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Facebook scrape problem</H1>
    <B>T. Kenneth Lojo (IRRI)</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Facebook%20scrape%20problem&In-Reply-To=%3CCAH0WUhGFrHLNFFxGYZDFWBewsjAoZfZ946gNm5_943oyQ_VWww%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Facebook scrape problem">t.lojo at irri.org
       </A><BR>
    <I>Tue May 17 07:51:04 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002161.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
        <LI>Next message: <A HREF="002163.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2162">[ date ]</a>
              <a href="thread.html#2162">[ thread ]</a>
              <a href="subject.html#2162">[ subject ]</a>
              <a href="author.html#2162">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you for this Barry. We actually have attacks going on on the server
and so far mod_sec has blocked it with the CRS. Our server with wordpress
is being brute forced by a xmlrpc.php attack and our joomla server is being
flooded by a torrent request when we don't have any torrents running. I may
need to do both in parallel. Do the anomaly scoring to allow facebook
scraping the content and probably setup another server and do your
recommendation to better tweak the WAF and then apply to the production.

On Tue, May 17, 2016 at 3:05 PM, Barry Pollard &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">barry_pollard at hotmail.com</A>&gt;
wrote:

&gt;<i> I would say first thing is to turn blocking off and run in DetectionOnly
</I>&gt;<i> mode to help you fine tune your rules. To do that update your SecRuleEngine
</I>&gt;<i> config like so:
</I>&gt;<i>
</I>&gt;<i> SecRuleEngine DetectionOnly
</I>&gt;<i>
</I>&gt;<i> This will of course mean you are not protected but us a necessary step to
</I>&gt;<i> getting your set up right. Now leave it run for a while and then check the
</I>&gt;<i> logs for every rule that fired (but did not block this time) and categories
</I>&gt;<i> them into:
</I>&gt;<i>
</I>&gt;<i> 1) False positive - this request looks to be the sort of request our
</I>&gt;<i> application expects and ModSecurity should not be alerting on it.
</I>&gt;<i> 2) Bad request - this request shouldn't be made and ModSecurity was right
</I>&gt;<i> to block it. This will include bots and scripts that scan websites even if
</I>&gt;<i> they don't cause any trouble.
</I>&gt;<i>
</I>&gt;<i> For all the 1s (and there will be a lot at the beginning) you need to
</I>&gt;<i> decide how to tweak the rules to not alert for False positives. This
</I>&gt;<i> involves either turning the rule off completely (using the likes of
</I>&gt;<i> SecRuleRemoveById), turning it off for particular parameters (using the
</I>&gt;<i> likes of SecRuleUpdateActionById) or turning it off for particular URLs
</I>&gt;<i> (this is more complicated aged and can require building a new rule to do
</I>&gt;<i> this).
</I>&gt;<i>
</I>&gt;<i> Tuning rules is necessary and, as long as you have a good understanding of
</I>&gt;<i> what the rules intention is, why it blocked, why that was incorrect thing
</I>&gt;<i> for it to do then you should tweak and turn them off for certain scenarios.
</I>&gt;<i> Does that reduce the effectiveness of ModSecurity? Potentially but then if
</I>&gt;<i> it blocks all sorts of real visitors incorrectly then that's not much use
</I>&gt;<i> is it! The OWASP CRS is very generic and all the rules will not be
</I>&gt;<i> appropriate for all websites. By default it blocks too much. There is some
</I>&gt;<i> work going on to make the default more lenient so you can start off with
</I>&gt;<i> some protection and ramp up as you see fit rather than current situation
</I>&gt;<i> where you start with too much protection and have to ramp down.
</I>&gt;<i>
</I>&gt;<i> Anyway after you see no more false positives for a while you can turn SecRuleEngine
</I>&gt;<i> back to on.
</I>&gt;<i>
</I>&gt;<i> This can take some time. See my story here to prepare you:
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/35149264/how-long-do-you-fine-tune-false-positives-with-mod-security-and-owasp-rules/35162976#35162976.">http://stackoverflow.com/questions/35149264/how-long-do-you-fine-tune-false-positives-with-mod-security-and-owasp-rules/35162976#35162976.</A>
</I>&gt;<i> A WAF like ModSecurity is, unfortunately, not just a turn it on and it
</I>&gt;<i> works and you can forget about it solution. It takes a lot of set up to be
</I>&gt;<i> useful, and then a bit if minding afterwards. Personally I think it's worth
</I>&gt;<i> it but you also see people online saying WAFs are too much effort for this
</I>&gt;<i> reason.
</I>&gt;<i>
</I>&gt;<i> Anomaly scoring mode is an interesting one. It basically let's all the
</I>&gt;<i> rules run and then only blocks if a certain threshold applies. This means a
</I>&gt;<i> number of unimportant rules can fire. e.g. most browsers send a user agent
</I>&gt;<i> so no user agent, while it likely won't cause a problem is a flag that this
</I>&gt;<i> is probably a bad request. If a few of these flags fire on same request
</I>&gt;<i> then this is highly likely to be a bad request and should be blocked. Some
</I>&gt;<i> rules (like missing user agent) might have low threshold and so won't block
</I>&gt;<i> on their own and some will block with just one rule firing if it's obvious
</I>&gt;<i> this request should not processed.
</I>&gt;<i>
</I>&gt;<i> While anomaly scoring is undoubtedly helpful to reduce the number of
</I>&gt;<i> incorrect blocks, and lots of people use it and recommend it, I'm not a
</I>&gt;<i> particular fan. I find it makes the log files noisy and confusing to see
</I>&gt;<i> rules firing and not know if they caused a block or not. I prefer to turn
</I>&gt;<i> off the low value rules completely and using the original block at first
</I>&gt;<i> bad attempt mode despite the fact this takes extra work to set up initially
</I>&gt;<i> and can allow more spam and bad bots through. But each to their own. Will
</I>&gt;<i> leave Christian to explain how best to set it up if that's the way you want
</I>&gt;<i> to go.
</I>&gt;<i>
</I>&gt;<i> Here's some other posts that might help:
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/33676348/extra-sensitive-mod-security-rules-giving-403-forbidden-error">http://stackoverflow.com/questions/33676348/extra-sensitive-mod-security-rules-giving-403-forbidden-error</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/34478019/keep-modsecurity-enabled-with-symfony-installation-w-cpanel-whm/34484463#34484463">http://stackoverflow.com/questions/34478019/keep-modsecurity-enabled-with-symfony-installation-w-cpanel-whm/34484463#34484463</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/33989273/modsecurity-excessive-false-positives/34027786#34027786">http://stackoverflow.com/questions/33989273/modsecurity-excessive-false-positives/34027786#34027786</A>
</I>&gt;<i> Note this mailing list is awesome and you will get help here but I have
</I>&gt;<i> also been answering ModSecurity questions on StackOverflow/ServerFault as
</I>&gt;<i> feel they are better to reference again for common questions like yours.
</I>&gt;<i> Been meaning to write a friendly, short, beginners containing a lot of the
</I>&gt;<i> detail here but have a problem keeping my posts short :-)
</I>&gt;<i>
</I>&gt;<i> Hope that helps and feel free to ask any questions here. We're a friendly
</I>&gt;<i> bunch.
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Barry
</I>&gt;<i>
</I>


-- 
*T. Kenneth S. Lojo*
Specialist-Online Media Design
[image: IRRI] &lt;<A HREF="http://irri.org/">http://irri.org/</A>&gt; +63 2 580 5600 ext. 2703/2744
+63 928 209 1191 (mobile)
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">t.lojo at irri.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">g.lavina at irri.org</A>&gt;
www.irri.org
[image: Facebook] &lt;<A HREF="http://www.facebook.com/IRRI.ricenews">http://www.facebook.com/IRRI.ricenews</A>&gt; [image: Twitter]
&lt;<A HREF="http://twitter.com/RiceResearch">http://twitter.com/RiceResearch</A>&gt; [image: Flickr]
&lt;<A HREF="http://www.flickr.com/photos/ricephotos/collections/">http://www.flickr.com/photos/ricephotos/collections/</A>&gt; [image: Youtube]
&lt;<A HREF="http://www.youtube.com/user/irrivideo/featured">http://www.youtube.com/user/irrivideo/featured</A>&gt; [image: Scribd]
&lt;<A HREF="http://www.scribd.com/IRRI_resources">http://www.scribd.com/IRRI_resources</A>&gt; [image: Linkedin]
&lt;<A HREF="http://www.linkedin.com/company/international-rice-research-institute">http://www.linkedin.com/company/international-rice-research-institute</A>&gt; [image:
Soundcloud] &lt;<A HREF="https://soundcloud.com/irri-radio">https://soundcloud.com/irri-radio</A>&gt; [image: Google+]
&lt;<A HREF="https://plus.google.com/103972671963502739315">https://plus.google.com/103972671963502739315</A>&gt;

The International Rice Research Institute &lt;<A HREF="http://irri.org">http://irri.org</A>&gt; is a member of
the CGIAR &lt;<A HREF="http://www.cgiar.org/">http://www.cgiar.org/</A>&gt;

-- 
The International Rice Research Institute &lt;<A HREF="http://irri.org">http://irri.org</A>&gt; is a member of 
the CGIAR &lt;<A HREF="http://cgiar.org">http://cgiar.org</A>&gt; consortium
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160517/ce0afc41/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160517/ce0afc41/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002161.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
	<LI>Next message: <A HREF="002163.html">[Owasp-modsecurity-core-rule-set] Facebook scrape problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2162">[ date ]</a>
              <a href="thread.html#2162">[ thread ]</a>
              <a href="subject.html#2162">[ subject ]</a>
              <a href="author.html#2162">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
