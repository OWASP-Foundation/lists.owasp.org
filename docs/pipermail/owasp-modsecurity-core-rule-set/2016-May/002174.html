<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Possible bug in ModSec (was: Re: Error with CRS 3.0.0-rc1 &quot;error parsing actions unknown action \\&quot;)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Possible%20bug%20in%20ModSec%20%28was%3A%20Re%3A%0A%20Error%20with%20CRS%203.0.0-rc1%20%22error%20parsing%20actions%20unknown%20action%20%5C%5C%22%29&In-Reply-To=%3C20160530203425.GD3226%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002173.html">
   <LINK REL="Next"  HREF="002175.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Possible bug in ModSec (was: Re: Error with CRS 3.0.0-rc1 &quot;error parsing actions unknown action \\&quot;)</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Possible%20bug%20in%20ModSec%20%28was%3A%20Re%3A%0A%20Error%20with%20CRS%203.0.0-rc1%20%22error%20parsing%20actions%20unknown%20action%20%5C%5C%22%29&In-Reply-To=%3C20160530203425.GD3226%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Possible bug in ModSec (was: Re: Error with CRS 3.0.0-rc1 &quot;error parsing actions unknown action \\&quot;)">christian.folini at netnea.com
       </A><BR>
    <I>Mon May 30 20:34:25 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002173.html">[Owasp-modsecurity-core-rule-set] Error with CRS 3.0.0-rc1 &quot;error	parsing actions unknown action \\&quot;
</A></li>
        <LI>Next message: <A HREF="002175.html">[Owasp-modsecurity-core-rule-set] [Mod-security-developers] Possible bug in ModSec (was: Re: Error with CRS 3.0.0-rc1 &quot;error parsing actions unknown action \\&quot;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2174">[ date ]</a>
              <a href="thread.html#2174">[ thread ]</a>
              <a href="subject.html#2174">[ subject ]</a>
              <a href="author.html#2174">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David,

Thanks for writing in. I am X-posting this to modsec-dev as well.

Yours is a very strange problem indeed. I am running the 3.0rc1
ruleset in production and have been running dozens of tests without
any issue.

Here is the minimal configuration, which triggered the bug in my
environment (Ubunt 14.04, apache 2.4.7, modsec 2.9.1)

ServerName              localhost
ServerAdmin             <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">root at localhost</A>
ServerRoot              /opt/apache-2.4.18
User                    www-data
Group                   www-data
PidFile			logs/httpd.pid

ServerTokens            Prod
UseCanonicalName        On
TraceEnable             Off

Timeout                 300
MaxClients              100

KeepAlive               On
KeepAliveTimeout        100ms

Listen                  127.0.0.1:80

LoadModule              mpm_prefork_module      modules/mod_mpm_prefork.so
LoadModule              unixd_module            modules/mod_unixd.so
LoadModule              authz_host_module       modules/mod_authz_host.so
LoadModule              log_config_module       modules/mod_log_config.so
LoadModule              logio_module            modules/mod_logio.so

LoadModule              headers_module          modules/mod_headers.so
LoadModule              unique_id_module        modules/mod_unique_id.so
LoadModule              security2_module        modules/mod_security2.so

LoadModule              mime_module             modules/mod_mime.so
LoadModule              status_module           modules/mod_status.so

LoadModule              lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so

LogLevel                        debug core:notice

ErrorLogFormat &quot;[%{cu}t] [%-m:%-l] %-a %-L %M&quot;


ErrorLog                logs/error.log

DocumentRoot            /apache/htdocs

# === Start ModSec Configuration

SecRuleEngine                 On

SecRequestBodyAccess          On
SecRequestBodyLimit           10000000
SecRequestBodyNoFilesLimit    64000

SecResponseBodyAccess         On
SecResponseBodyLimit          10000000

SecTmpDir                     /tmp/
SecDataDir                    /tmp/
SecUploadDir                  /tmp/

SecDebugLog                   /apache/logs/modsec_debug.log
SecDebugLogLevel              9

SecAuditEngine                RelevantOnly
SecAuditLogRelevantStatus     &quot;^(?:5|4(?!04))&quot;
SecAuditLogParts              ABEFHIJZ

SecAuditLogType               Concurrent
SecAuditLog                   /apache/logs/modsec_audit.log
SecAuditLogStorageDir         /apache/logs/audit/

SecPcreMatchLimit             500000
SecPcreMatchLimitRecursion    500000

SecDefaultAction              &quot;phase:2,pass,log&quot;


SecRule RESPONSE_BODY &quot;(?:&lt;(?:TITLE&gt;Index of.*?&lt;H|title&gt;Index of.*?&lt;h)1&gt;Index of|&gt;\[To Parent Directory\]&lt;\/[Aa]&gt;&lt;br&gt;)&quot; \
	&quot;phase:response,\
	rev:'2',\
	ver:'OWASP_CRS/3.0.0',\
	maturity:'9',\
	accuracy:'9',\
	t:none,\
	block,\
	id:'950110'&quot;


&lt;Directory /&gt;
        Options SymLinksIfOwnerMatch
        AllowOverride None
&lt;/Directory&gt;

&lt;VirtualHost *:80&gt;
        ServerName localhost

        &lt;Directory /apache/htdocs&gt;

        &lt;/Directory&gt;

&lt;/VirtualHost&gt;


$&gt; ./bin/httpd -X -f conf/httpd.conf_problem_of_the_day
AH00526: Syntax error on line 82 of /opt/apache-2.4.18/conf/httpd.conf_problem_of_the_day
Error parsing actions: Unknown action: \\

I tried this with 2.4.7 as well.

If I take a single character out of the regex or out of the version
string (OWASP_CRS...), then the bug disappears.

If I add a space in front of the backslash: bug disappears.

Given the config above, I am quite sure there is a bug hidden somewhere.
Maybe I am overlooking something and somebody can point me to an
error. If that is not the case, then I think it is a bug.

David: I suggest you open a bug report. Please open it against
ModSecurity and not against the Core Rules.

Ahoj,

Christian





On Fri, May 27, 2016 at 08:48:31PM -0500, David Angel wrote:
&gt;<i> Good evening,
</I>&gt;<i> 
</I>&gt;<i> I originally posted this at
</I>&gt;<i> <A HREF="http://stackoverflow.com/questions/37369990/modsecurity-error-parsing-actions-unknown-action">http://stackoverflow.com/questions/37369990/modsecurity-error-parsing-actions-unknown-action</A>
</I>&gt;<i> and it was suggested to send to this listserv as well.
</I>&gt;<i> 
</I>&gt;<i> I'm trying to get CRS 3.0.0.-rc1 working with ModSecurity 2.9.1 and Apache
</I>&gt;<i> 2.4.7 on an Ubuntu 14.04 machine.
</I>&gt;<i> 
</I>&gt;<i> I'm using all the rules in the /rules directory, and when trying to start
</I>&gt;<i> Apache I receive the following error. (Note: There is no entry in the
</I>&gt;<i> Apache error.log file for this.)
</I>&gt;<i> 
</I>&gt;<i> AH00526: Syntax error on line 35 of
</I>&gt;<i> /etc/apache2/conf/crs/rules/RESPONSE-50-DATA-LEAKAGES-PHP.conf:
</I>&gt;<i> Error parsing actions: Unknown action: \\
</I>&gt;<i> Action 'configtest' failed.
</I>&gt;<i> 
</I>&gt;<i> In my troubleshooting of the *RESPONSE-50-DATA-LEAKAGES-PHP.conf
</I>&gt;<i> *file, I combined line 35 with 34
</I>&gt;<i> 
</I>&gt;<i> capture,ctl:auditLogParts=+E,\
</I>&gt;<i> 
</I>&gt;<i> just to see if the line error would change (and make sure I was indeed
</I>&gt;<i> troubleshooting the correct file) and suddenly this error is gone, and
</I>&gt;<i> is replaced with another.
</I>&gt;<i> 
</I>&gt;<i> AH00526: Syntax error on line 31 of
</I>&gt;<i> /etc/apache2/conf/crs/rules/RESPONSE-50-DATA-LEAKAGES.conf:
</I>&gt;<i> Error parsing actions: Unknown action: \\
</I>&gt;<i> 
</I>&gt;<i> which again is solved by combining with the line above it.
</I>&gt;<i> 
</I>&gt;<i> accuracy:'9',t:none,\
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Now it starts correctly with no error.  Needless to say I'm pretty
</I>&gt;<i> confused about this error, and more confused about the &quot;fix&quot; since I
</I>&gt;<i> don't understand why removing a single line continuation would matter.
</I>&gt;<i> 
</I>&gt;<i> Any thoughts on this?  Or any suggestions to increase debug\troubleshooting?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> David Angel
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

-- 
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
<A HREF="http://www.christian-folini.ch">http://www.christian-folini.ch</A>
twitter: @ChrFolini
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002173.html">[Owasp-modsecurity-core-rule-set] Error with CRS 3.0.0-rc1 &quot;error	parsing actions unknown action \\&quot;
</A></li>
	<LI>Next message: <A HREF="002175.html">[Owasp-modsecurity-core-rule-set] [Mod-security-developers] Possible bug in ModSec (was: Re: Error with CRS 3.0.0-rc1 &quot;error parsing actions unknown action \\&quot;)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2174">[ date ]</a>
              <a href="thread.html#2174">[ thread ]</a>
              <a href="subject.html#2174">[ subject ]</a>
              <a href="author.html#2174">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
