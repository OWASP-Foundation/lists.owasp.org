<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] arg name not resolving for large	post value
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20arg%20name%20not%20resolving%20for%0A%20large%09post%20value&In-Reply-To=%3C20160513181436.GA32246%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002141.html">
   <LINK REL="Next"  HREF="002142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] arg name not resolving for large	post value</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20arg%20name%20not%20resolving%20for%0A%20large%09post%20value&In-Reply-To=%3C20160513181436.GA32246%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] arg name not resolving for large	post value">christian.folini at netnea.com
       </A><BR>
    <I>Fri May 13 18:14:36 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002141.html">[Owasp-modsecurity-core-rule-set] arg name not resolving for large	post value
</A></li>
        <LI>Next message: <A HREF="002142.html">[Owasp-modsecurity-core-rule-set] CSRF Attack Detected - Invalid	Token
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2148">[ date ]</a>
              <a href="thread.html#2148">[ thread ]</a>
              <a href="subject.html#2148">[ subject ]</a>
              <a href="author.html#2148">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Colin,

I thought I would give this a try.

Not sure, I understand you correctly though. I think your original 
payload is:
Blurb=rc+is+knowledgeable%2C+experienced%2C+empathetic%2C+and+kind...

And then ModSec seems to strip Blurb in the request body and you
end up with a very long variable name starting with rc... and no value.

Then a 2nd variable named Control from the end of your payload.

Whatever happens with the payload, the CRS don't like it. The
score is between 45 and 53 depending of the version and the
variable name Blurb being present or not.

But in fact, I get the variable name and all is just fine
(Apache 2.4.18, ModSec 2.9.1 on Ubuntu 14.04)

SecRule &amp;ARGS:Blurb &quot;.*&quot;	&quot;id:1001,phase:2,pass,log,capture,msg:'# of variables named Blurb: %{MATCHED_VAR}'&quot;
SecRule ARGS:Blurb &quot;.*&quot;		&quot;id:1002,phase:2,pass,log,capture,msg:'Variable Blurb: %{MATCHED_VAR}'&quot;

$&gt; curl &quot;$(cat payload)&quot; localhost/index.html

-&gt; results in
  1001 ARGS          # of variables named Blurb: 1
  1002 ARGS:Blurb    Variable Blurb: rc is knowledgeable, experienced...

Please confirm the payload is correct or submit the correct payload.

If you have a different behaviour on Windows/ModSec, then yes, this is
probably a bug.

Ahoj,

Christian





On Tue, May 10, 2016 at 05:37:51PM +0000, Colin MacAllister wrote:
&gt;<i> Resurrecting this. I&#8217;m sure the arg value is being passed from the browser intact, because it show up in the database in one piece, and because Firefox reports that it is being sent in the Developer/Network view.
</I>&gt;<i> 
</I>&gt;<i> I&#8217;ve attempted switching back from anomaly scoring mode to one-strike-you&#8217;re-out, and am still getting the problem. Should I being having this conversation with whoever puts out the Windows port of modsecurity?
</I>&gt;<i> 
</I>&gt;<i> Sent from Mail&lt;<A HREF="https://go.microsoft.com/fwlink/?LinkId=550986">https://go.microsoft.com/fwlink/?LinkId=550986</A>&gt; for Windows 10
</I>&gt;<i> 
</I>&gt;<i> From: Colin MacAllister&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">cmacallister at probono.net</A>&gt;
</I>&gt;<i> Sent: Thursday, May 5, 2016 2:39 PM
</I>&gt;<i> To: OWASP List&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;<i> Subject: [Owasp-modsecurity-core-rule-set] arg name not resolving for large post value
</I>&gt;<i> 
</I>&gt;<i> Hi, all,
</I>&gt;<i> 
</I>&gt;<i> As I fine-tune my CMS not to bark at me for valid traffic, I&#8217;ve come upon the following problem. When a rule matches (in anomaly scoring mode, haven&#8217;t tested the other way) sometimes part of the value of the argument the will come through as the argument name, not the name itself, in this case, &#8220;Blurb.&#8221;
</I>&gt;<i> 
</I>&gt;<i> ARGS_NAMES:rc is knowledgeable, experienced, empathetic, and kind&#8230; [followed by a chunk of the rest of the arg value]
</I>&gt;<i> 
</I>&gt;<i> I checked it in the inspector, and indeed the ARG_NAME should be &#8220;Blurb&#8221;. As it is coming through, of course, it is impossible to check for, as it is variable. It might be possible to whitelist the last part of the URL path, but I&#8217;d rather not.
</I>&gt;<i> 
</I>&gt;<i> Have I found a bug? See the snippet from the audit log I attached to this email.
</I>&gt;<i> 
</I>
&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

-- 
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
<A HREF="http://www.christian-folini.ch">http://www.christian-folini.ch</A>
twitter: @ChrFolini
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002141.html">[Owasp-modsecurity-core-rule-set] arg name not resolving for large	post value
</A></li>
	<LI>Next message: <A HREF="002142.html">[Owasp-modsecurity-core-rule-set] CSRF Attack Detected - Invalid	Token
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2148">[ date ]</a>
              <a href="thread.html#2148">[ thread ]</a>
              <a href="subject.html#2148">[ subject ]</a>
              <a href="author.html#2148">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
