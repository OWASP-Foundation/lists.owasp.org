<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Modsecurity block JSON
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Modsecurity%20block%20JSON&In-Reply-To=%3CCAFDTedpfDm94ixkmn6iUX4TXr75ab-n3-pCvkx5dkQ_Xpe72Kw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001811.html">
   <LINK REL="Next"  HREF="001813.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Modsecurity block JSON</H1>
    <B>Adri&#225;n</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Modsecurity%20block%20JSON&In-Reply-To=%3CCAFDTedpfDm94ixkmn6iUX4TXr75ab-n3-pCvkx5dkQ_Xpe72Kw%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Modsecurity block JSON">adrianbn at gmail.com
       </A><BR>
    <I>Thu Sep 10 09:01:24 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001811.html">[Owasp-modsecurity-core-rule-set] Modsecurity block JSON
</A></li>
        <LI>Next message: <A HREF="001813.html">[Owasp-modsecurity-core-rule-set] Modsecurity block JSON
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1812">[ date ]</a>
              <a href="thread.html#1812">[ thread ]</a>
              <a href="subject.html#1812">[ subject ]</a>
              <a href="author.html#1812">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Unfortunately, you are hitting an unsolved issue in ModSecurity: requests
which have content type other than application/json but include json in
some of the parameters. ModSecurity doesn't know how to handle this and
treats the whole argument as one single variable, thus triggering multiple
rules that shouldn't be triggered if the json object was parsed
appropriately. There is an issue open in GitHub to support something like
t:jsonDecode to aid with these situations, but it hasn't been actioned yet.

What you could do is, for those arguments you know are json format, create
a rule that reduces the score of the anomaly detection rules. That may do
the trick for many cases.


On Wed 9 Sep 2015 at 17:38 Ilyass Kaouam &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ilyassikai at gmail.com</A>&gt; wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I have this request :
</I>&gt;<i> POST /beta/servlet/EspaceClientServlet?Action=Ajax$SaveWidgetConfig
</I>&gt;<i>
</I>&gt;<i> with this parameters :
</I>&gt;<i> left={ mod : 'mod-historique', hidden : 0, collapsed : 0 }, { mod :
</I>&gt;<i> 'mod-cercle-inforisk', hidden : 0, collapsed : 0 }, { mod : 'mod-graph',
</I>&gt;<i> hidden : 0, collapsed : 0 }&amp;right={ mod : 'mod-surveillance-implicit',
</I>&gt;<i> hidden :  0, collapsed : 0 }, { mod : 'mod-dernieres-creations', hidden :
</I>&gt;<i> 0, collapsed : 0 }, { mod : 'mod-service', hidden :  0, collapsed : 1 },
</I>&gt;<i> { mod : 'mod-recherche', hidden :  0, collapsed : 0 }
</I>&gt;<i>
</I>&gt;<i> When I execute this request modsecurity block my request.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Log :
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --1354a526-A--
</I>&gt;<i>
</I>&gt;<i> [09/Sep/2015:17:48:39 +0200] VfBU138AAAEAAFm8PlQAAAAk
</I>&gt;<i> &#8203;XXX.XXX.XXX
</I>&gt;<i>  53935
</I>&gt;<i> &#8203;XXX.XXX.XXX
</I>&gt;<i>  80
</I>&gt;<i>
</I>&gt;<i> --1354a526-B--
</I>&gt;<i>
</I>&gt;<i> POST /beta/servlet/EspaceClientServlet?Action=Ajax$SaveWidgetConfig
</I>&gt;<i> HTTP/1.1
</I>&gt;<i>
</I>&gt;<i> Host: www.
</I>&gt;<i> &#8203;abc
</I>&gt;<i> .
</I>&gt;<i> &#8203;com&#8203;
</I>&gt;<i>
</I>&gt;<i> User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:40.0)
</I>&gt;<i> Gecko/20100101 Firefox/40.0
</I>&gt;<i>
</I>&gt;<i> Accept: */*
</I>&gt;<i>
</I>&gt;<i> Accept-Language: fr,fr-FR;q=0.8,en-US;q=0.5,en;q=0.3
</I>&gt;<i>
</I>&gt;<i> Accept-Encoding: gzip, deflate
</I>&gt;<i>
</I>&gt;<i> Content-Type: application/x-www-form-urlencoded; charset=UTF-8
</I>&gt;<i>
</I>&gt;<i> X-Requested-With: XMLHttpRequest
</I>&gt;<i>
</I>&gt;<i> Referer: <A HREF="http://www.">http://www.</A>
</I>&gt;<i> &#8203;abc
</I>&gt;<i> .
</I>&gt;<i> &#8203;com
</I>&gt;<i> /beta/servlet/EspaceClientServlet?plateform=new
</I>&gt;<i>
</I>&gt;<i> Content-Length: 413
</I>&gt;<i>
</I>&gt;<i> Cookie: JSESSIONID=6B370AFFEA03BE2B80F916C5755EEEC5;
</I>&gt;<i> __utma=37027576.1259853019.1435675370.1441795926.1441813263.22;
</I>&gt;<i> __utmz=37027576.1435675370.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none);
</I>&gt;<i> style=null; JSESSIONID=DACE18AC3CBA86CAF59264F47E99B028; __utmc=37027576;
</I>&gt;<i> __utmb=37027576.3.10.1441813263
</I>&gt;<i>
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i>
</I>&gt;<i> Pragma: no-cache
</I>&gt;<i>
</I>&gt;<i> Cache-Control: no-cache
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --1354a526-C--
</I>&gt;<i>
</I>&gt;<i> left={ mod : 'mod-historique', hidden : 0, collapsed : 0 }, { mod :
</I>&gt;<i> 'mod-cercle-inforisk', hidden : 0, collapsed : 0 }, { mod : 'mod-graph',
</I>&gt;<i> hidden : 0, collapsed : 0 }&amp;right={ mod : 'mod-surveillance-implicit',
</I>&gt;<i> hidden :  0, collapsed : 0 }, { mod : 'mod-dernieres-creations', hidden :
</I>&gt;<i> 0, collapsed : 0 }, { mod : 'mod-service', hidden :  0, collapsed : 1 }, {
</I>&gt;<i> mod : 'mod-recherche', hidden :  0, collapsed : 0 }
</I>&gt;<i>
</I>&gt;<i> --1354a526-F--
</I>&gt;<i>
</I>&gt;<i> HTTP/1.1 403 Forbidden
</I>&gt;<i>
</I>&gt;<i> Content-Length: 296
</I>&gt;<i>
</I>&gt;<i> Connection: close
</I>&gt;<i>
</I>&gt;<i> Content-Type: text/html; charset=iso-8859-1
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --1354a526-E--
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --1354a526-H--
</I>&gt;<i>
</I>&gt;<i> Message: Access denied with code 403 (phase 2). Pattern match
</I>&gt;<i> &quot;([\\~\\!\\@\\#\\$\\%\\^\\&amp;\\*\\(\\)\\-\\+\\=\\{\\}\\[\\]\\|\\:\\;\&quot;\\'\\\xc2\xb4\\\xe2\x80\x99\\\xe2\x80\x98\\`\\&lt;\\&gt;].*?){4,}&quot;
</I>&gt;<i> at ARGS:left. [file
</I>&gt;<i> &quot;/etc/httpd/modsecurity-crs/base_rules/modsecurity_crs_41_sql_injection_attacks.conf&quot;]
</I>&gt;<i> [line &quot;159&quot;] [id &quot;981173&quot;] [rev &quot;2&quot;] [msg &quot;Restricted SQL Character Anomaly
</I>&gt;<i> Detection Alert - Total # of special characters exceeded&quot;] [data &quot;Matched
</I>&gt;<i> Data: - found within ARGS:left: { mod : 'mod-historique', hidden : 0,
</I>&gt;<i> collapsed : 0 }, { mod : 'mod-cercle-inforisk', hidden : 0, collapsed : 0
</I>&gt;<i> }, { mod : 'mod-graph', hidden : 0, collapsed : 0 }&quot;] [ver
</I>&gt;<i> &quot;OWASP_CRS/2.2.9&quot;] [maturity &quot;9&quot;] [accuracy &quot;8&quot;] [tag
</I>&gt;<i> &quot;OWASP_CRS/WEB_ATTACK/SQL_INJECTION&quot;]
</I>&gt;<i>
</I>&gt;<i> Action: Intercepted (phase 2)
</I>&gt;<i>
</I>&gt;<i> Apache-Handler: proxy-server
</I>&gt;<i>
</I>&gt;<i> Stopwatch: 1441813719351394 3237 (- - -)
</I>&gt;<i>
</I>&gt;<i> Stopwatch2: 1441813719351394 3237; combined=2824, p1=202, p2=2592, p3=0,
</I>&gt;<i> p4=0, p5=30, sr=26, sw=0, l=0, gc=0
</I>&gt;<i>
</I>&gt;<i> Response-Body-Transformed: Dechunked
</I>&gt;<i>
</I>&gt;<i> Producer: ModSecurity for Apache/2.7.3 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;<i> OWASP_CRS/2.2.9.
</I>&gt;<i>
</I>&gt;<i> Server: Apache/2.2.15 (CentOS) DAV/2
</I>&gt;<i>
</I>&gt;<i> Engine-Mode: &quot;ENABLED&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --1354a526-Z--
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Who can I allow like this request safety
</I>&gt;<i> &#8203; ?&#8203;
</I>&gt;<i>
</I>&gt;<i> Thank's  &#8203;
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150910/5af7bd05/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20150910/5af7bd05/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001811.html">[Owasp-modsecurity-core-rule-set] Modsecurity block JSON
</A></li>
	<LI>Next message: <A HREF="001813.html">[Owasp-modsecurity-core-rule-set] Modsecurity block JSON
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1812">[ date ]</a>
              <a href="thread.html#1812">[ thread ]</a>
              <a href="subject.html#1812">[ subject ]</a>
              <a href="author.html#1812">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
