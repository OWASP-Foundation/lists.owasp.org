<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] XSS Filters from IE (modsecurity_crs_41_xss_attacks.conf)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS%20Filters%20from%20IE%0A%20%28modsecurity_crs_41_xss_attacks.conf%29&In-Reply-To=%3CCDF1BBCF.AB818%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001422.html">
   <LINK REL="Next"  HREF="001424.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] XSS Filters from IE (modsecurity_crs_41_xss_attacks.conf)</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS%20Filters%20from%20IE%0A%20%28modsecurity_crs_41_xss_attacks.conf%29&In-Reply-To=%3CCDF1BBCF.AB818%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] XSS Filters from IE (modsecurity_crs_41_xss_attacks.conf)">RBarnett at trustwave.com
       </A><BR>
    <I>Thu Jun 27 13:57:15 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001422.html">[Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)
</A></li>
        <LI>Next message: <A HREF="001424.html">[Owasp-modsecurity-core-rule-set] modsecurity-core-rule-set problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1423">[ date ]</a>
              <a href="thread.html#1423">[ thread ]</a>
              <a href="subject.html#1423">[ subject ]</a>
              <a href="author.html#1423">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 6/27/13 7:31 AM, &quot;Bremgartner, Lucas&quot;
&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Lucas.Bremgartner at united-security-providers.ch</A>&gt; wrote:

&gt;<i>Hi all,
</I>&gt;<i>
</I>&gt;<i>I am currently looking at the performance of some rules in the OWASP CRS,
</I>&gt;<i>especially the block &quot;XSS Filters form IE&quot;
</I>&gt;<i>(modsecurity_crs_41_xss_attacks.conf), and I would like to have your
</I>&gt;<i>opinion to the following two proposals:
</I>&gt;<i>
</I>&gt;<i>1. Remove rules with ID 973345 and 973346
</I>&gt;<i>The two rules 973345 and 973346 are matching html-encoding-variants of
</I>&gt;<i>&quot;vbscript:&quot; and &quot;javascript:&quot;. Both rules are using the transformation
</I>&gt;<i>functions t:htmlEntityDecode and t:compressWhiteSpace. If I understand
</I>&gt;<i>these transformation functions correctly, then they are redundant to the
</I>&gt;<i>regular expression (e.g. transformation from &quot;&amp; #x06A;&quot; to &quot;j&quot; is already
</I>&gt;<i>done by t:htmlEntityDecode). If this is correct, then these rules are not
</I>&gt;<i>needed because they are already covered by the block beginning with rule
</I>&gt;<i>981136. These rules are operating in the same phase and on the same
</I>&gt;<i>targets.
</I>&gt;<i>Did I miss something?
</I>&gt;<i>
</I>&gt;<i>2. Rule Pre-Filtering
</I>&gt;<i>Most of the remaining rules (except the last 3 rules: 973316, 973325,
</I>&gt;<i>973319 and of course rules from proposal 1) are beginning with one of the
</I>&gt;<i>following characters: &lt; &quot; '
</I>&gt;<i>Therefore I propose to pre-filter the whole &quot;XSS Filters from IE&quot; rule
</I>&gt;<i>block (except the last 3 rules: 973316, 973325, 973319) with a rule like:
</I>&gt;<i>
</I>&gt;<i>SecRule
</I>&gt;<i>REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|ARGS_NAMES|
</I>&gt;<i>ARGS|XML:/* &quot;&lt;|\&quot;|\'&quot; \
</I>&gt;<i>&quot;phase:2,id:'10000',rev:'2',ver:'OWASP_CRS/2.2.7',maturity:'8',accuracy:'8
</I>&gt;<i>',t:none,t:htmlEntityDecode,t:compressWhiteSpace,pass,nolog,setvar:tx.pm_x
</I>&gt;<i>ss_filter_score=+%{tx.critical_anomaly_score}&quot;
</I>&gt;<i>SecRule &amp;TX:PM_XSS_FILTER_SCORE &quot;@eq 0&quot;
</I>&gt;<i>&quot;phase:2,id:'10001',t:none,pass,skipAfter:END_XSS_FILTER_CHECK,nolog&quot;
</I>&gt;<i>...
</I>&gt;<i>SecMarker END_XSS_FILTER_CHECK
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>With these two changes I measured a noticeable performance improvement of
</I>&gt;<i>15 - 25% (depending on parameter size and parameter count) in my test
</I>&gt;<i>setup with the whole CRS (base rules) activated.
</I>&gt;<i>
</I>&gt;<i>Feedbacks and suggestions are welcome.
</I>&gt;<i>
</I>&gt;<i>Regards,
</I>&gt;<i>Lucas Bremgartner
</I>
Lucas,
You bring up a good point - rule detection overlap.  The XSS rules have
not been properly vetted and maintained over the years and instead have
simply had new rules thrown on top.  We are in the process of working on
the new CRS v3.0.0 and one of the key items is to review/update all rule
groups including XSS.  We will take a more systematic approach to our
rules for coverage and performance.

It is worth noting that I will be giving a joint talk with Greg Wroblewski
of Microsoft Security Research and Defense team at Blackhat USA talking
about real-world XSS attacks and defense -
<A HREF="http://www.blackhat.com/us-13/briefings.html#Wroblewski.">http://www.blackhat.com/us-13/briefings.html#Wroblewski.</A>  As part of this
research - Greg is developing an XSS detection module.  We will be
including this with ModSecurity as a new operator @detectXSS to help with
both detection and performance.

Thanks,
Ryan


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001422.html">[Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)
</A></li>
	<LI>Next message: <A HREF="001424.html">[Owasp-modsecurity-core-rule-set] modsecurity-core-rule-set problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1423">[ date ]</a>
              <a href="thread.html#1423">[ thread ]</a>
              <a href="subject.html#1423">[ subject ]</a>
              <a href="author.html#1423">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
