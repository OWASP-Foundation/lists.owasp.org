<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [Mod-security-emerging-attacks] Fwd: IRC BOTNET LEVERAGING UNPATCHED PLESK VULNERABILITY
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%0A%20%5BMod-security-emerging-attacks%5D%20Fwd%3A%20IRC%20BOTNET%20LEVERAGING%20UNPATCHED%20PLESK%0A%20VULNERABILITY&In-Reply-To=%3CCDE74D33.A9A35%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001416.html">
   <LINK REL="Next"  HREF="001418.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [Mod-security-emerging-attacks] Fwd: IRC BOTNET LEVERAGING UNPATCHED PLESK VULNERABILITY</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%0A%20%5BMod-security-emerging-attacks%5D%20Fwd%3A%20IRC%20BOTNET%20LEVERAGING%20UNPATCHED%20PLESK%0A%20VULNERABILITY&In-Reply-To=%3CCDE74D33.A9A35%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] [Mod-security-emerging-attacks] Fwd: IRC BOTNET LEVERAGING UNPATCHED PLESK VULNERABILITY">RBarnett at trustwave.com
       </A><BR>
    <I>Wed Jun 19 16:01:37 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001416.html">[Owasp-modsecurity-core-rule-set] two questions about custom rules
</A></li>
        <LI>Next message: <A HREF="001418.html">[Owasp-modsecurity-core-rule-set] 950901 - false positive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1417">[ date ]</a>
              <a href="thread.html#1417">[ thread ]</a>
              <a href="subject.html#1417">[ subject ]</a>
              <a href="author.html#1417">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Our web honeypots picked up more exploit attempts today -

5.9.16.104 - - [19/Jun/2013:00:47:05 +0200] &quot;POST /phppath/php?-d+allow_url_include%3d1+-d+safe_mode%3d0+-d+suhosin.simulation%3d1+-d+disable_functions%3d''+-d+open_basedir%3dnone+-d+auto_prepend_file%3<A HREF="dphp://input+-n">dphp://input+-n</A> HTTP/1.1&quot; 404 314 &quot;-&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_1) AppleWebKit/535.1 (KHTML, like Gecko) Safari/535.1&quot;

While the OWASP ModSecurity CRS does pick up the POST payload PHP code, it does not trigger on the various PHP configuration directives -
<A HREF="http://www.modsecurity.org/demo/demo-deny.html?test=-d+allow_url_include%3d1+-d+safe_mode%3d0+-d+suhosin.simulation%3d1+-d+disable_functions%3d%27%27+-d+open_basedir%3dnone+-d+auto_prepend_file%3dphp://input+-n">http://www.modsecurity.org/demo/demo-deny.html?test=-d+allow_url_include%3d1+-d+safe_mode%3d0+-d+suhosin.simulation%3d1+-d+disable_functions%3d%27%27+-d+open_basedir%3dnone+-d+auto_prepend_file%3dphp://input+-n</A>

We should modify the CRS rules to include these PHP config directives in the PHP code injection rules and also to make sure that these are inspecting ARGS_NAMES.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

From: Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&gt;&gt;
Date: Monday, June 10, 2013 6:53 PM
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-emerging-attacks at lists.sourceforge.net</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-emerging-attacks at lists.sourceforge.net</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-emerging-attacks at lists.sourceforge.net</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-emerging-attacks at lists.sourceforge.net</A>&gt;&gt;
Subject: [Mod-security-emerging-attacks] Fwd: IRC BOTNET LEVERAGING UNPATCHED PLESK VULNERABILITY


Begin forwarded message:

From: Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">rbarnett at trustwave.com</A>&gt;&gt;
Date: June 10, 2013, 4:59:55 PM EDT
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-users at lists.sourceforge.net</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-users at lists.sourceforge.net</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-users at lists.sourceforge.net</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-users at lists.sourceforge.net</A>&gt;&gt;, &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: IRC BOTNET LEVERAGING UNPATCHED PLESK VULNERABILITY

I wanted to reach out to the community on this issue and ask for some help.

An exploit for Plesk was released last week - <A HREF="http://seclists.org/fulldisclosure/2013/Jun/21">http://seclists.org/fulldisclosure/2013/Jun/21</A> and now there are reports of mass exploits from IRC botnets.  Reference this link - <A HREF="http://threatpost.com/irc-botnet-leveraging-unpatched-plesk-vulnerability/">http://threatpost.com/irc-botnet-leveraging-unpatched-plesk-vulnerability/</A>

Here is an example ModSecurity audit log of running the plesk-simple.pl script against a host -

--c0538227-A--
[10/Jun/2013:16:33:13 --0400] UbY4B8CoAWQAAP3TbGsAAAAC 127.0.0.1 56954 127.0.0.1 80
--c0538227-B--
POST /%70%68%70%70%61%74%68/%70%68%70?%2D%64+%61%6C%6C%6F%77%5F%75%72%6C%5F%69%6E%63%6C%75%64%65%3D%6F%6E+%2D%64+%73%61%66%65%5F%6D%6F%64%65%3D%6F%66%66+%2D%64+%73%75%68%6F%73%69%6E%2E%73%69%6D%75%6C%61%74%69%6F%6E%3D%6F%6E+%2D%64+%64%69%73%61%62%6C%65%5F%66%75%6E%63%74%69%6F%6E%73%3D%22%22+%2D%64+%6F%70%65%6E%5F%62%61%73%65%64%69%72%3D%6E%6F%6E%65+%2D%64+%61%75%74%6F%5F%70%72%65%70%65%6E%64%5F%66%69%6C%65%3D%70%68%70%3A%2F%2F%69%6E%70%75%74+%2D%6E HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (compatible; Googlebot/2.1; +<A HREF="http://www.google.com/bot.html">http://www.google.com/bot.html</A>)
Content-Type: application/x-www-form-urlencoded
Content-Length: 82

--c0538227-C--
&lt;?php echo &quot;Content-Type:text/html\r\n\r\n&quot;;echo &quot;OK\n&quot;;system(&quot;uname -a;id;&quot;); ?&gt;

For those of you running the OWASP ModSecurity CRS &#8211; this attac would already be picked up by a number of rules/signatures.  For example -

Message: Warning. Pattern match &quot;&lt;\\?(?!xml)&quot; at ARGS_NAMES:&lt;?php echo &quot;Content-Type:text/html\\r\\n\\r\\n&quot;;echo &quot;OK\\n&quot;;system(&quot;uname -a;id;&quot;); ?&gt;. [file &quot;/usr/local/apache/conf/crs/base_rules/modsecurity_crs_40_generic_attacks.conf&quot;] [line &quot;230&quot;] [id &quot;959151&quot;] [rev &quot;2&quot;] [msg &quot;PHP Injection Attack&quot;] [severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/2.2.7&quot;] [maturity &quot;9&quot;] [accuracy &quot;9&quot;] [tag &quot;OWASP_CRS/WEB_ATTACK/PHP_INJECTION&quot;] [tag &quot;WASCTC/WASC-15&quot;] [tag &quot;OWASP_TOP_10/A6&quot;] [tag &quot;PCI/6.5.2&quot;] [tag &quot;WASCTC/WASC-25&quot;] [tag &quot;OWASP_TOP_10/A1&quot;] [tag &quot;OWASP_AppSensor/CIE4&quot;] [tag &quot;PCI/6.5.2&quot;]

I am working on a blog post to highlight this vulnerability and the ModSecurity protections.  It would be useful if anyone who has seen these attacks hit their server to send me some example audit log entries as I want to show real-world instances vs only running the PoC.

Thanks.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130619/502b2b4c/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130619/502b2b4c/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001416.html">[Owasp-modsecurity-core-rule-set] two questions about custom rules
</A></li>
	<LI>Next message: <A HREF="001418.html">[Owasp-modsecurity-core-rule-set] 950901 - false positive
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1417">[ date ]</a>
              <a href="thread.html#1417">[ thread ]</a>
              <a href="subject.html#1417">[ subject ]</a>
              <a href="author.html#1417">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
