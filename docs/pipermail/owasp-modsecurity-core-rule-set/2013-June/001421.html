<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS%20Filters%20from%20IE%0A%09%28modsecurity_crs_41_xss_attacks.conf%29&In-Reply-To=%3CFCFBEC6FEC5C0F419C8864147BF6426F2439F7%40uspexch01.tetrade.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001420.html">
   <LINK REL="Next"  HREF="001422.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)</H1>
    <B>Bremgartner, Lucas</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20XSS%20Filters%20from%20IE%0A%09%28modsecurity_crs_41_xss_attacks.conf%29&In-Reply-To=%3CFCFBEC6FEC5C0F419C8864147BF6426F2439F7%40uspexch01.tetrade.ch%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)">Lucas.Bremgartner at united-security-providers.ch
       </A><BR>
    <I>Thu Jun 27 11:31:29 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001420.html">[Owasp-modsecurity-core-rule-set] About modsecurity for nginx	version
</A></li>
        <LI>Next message: <A HREF="001422.html">[Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1421">[ date ]</a>
              <a href="thread.html#1421">[ thread ]</a>
              <a href="subject.html#1421">[ subject ]</a>
              <a href="author.html#1421">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I am currently looking at the performance of some rules in the OWASP CRS, especially the block &quot;XSS Filters form IE&quot; (modsecurity_crs_41_xss_attacks.conf), and I would like to have your opinion to the following two proposals:

1. Remove rules with ID 973345 and 973346
The two rules 973345 and 973346 are matching html-encoding-variants of &quot;vbscript:&quot; and &quot;javascript:&quot;. Both rules are using the transformation functions t:htmlEntityDecode and t:compressWhiteSpace. If I understand these transformation functions correctly, then they are redundant to the regular expression (e.g. transformation from &quot;&amp; #x06A;&quot; to &quot;j&quot; is already done by t:htmlEntityDecode). If this is correct, then these rules are not needed because they are already covered by the block beginning with rule 981136. These rules are operating in the same phase and on the same targets.
Did I miss something? 

2. Rule Pre-Filtering
Most of the remaining rules (except the last 3 rules: 973316, 973325, 973319 and of course rules from proposal 1) are beginning with one of the following characters: &lt; &quot; '
Therefore I propose to pre-filter the whole &quot;XSS Filters from IE&quot; rule block (except the last 3 rules: 973316, 973325, 973319) with a rule like:

SecRule REQUEST_COOKIES|!REQUEST_COOKIES:/__utm/|REQUEST_COOKIES_NAMES|ARGS_NAMES|ARGS|XML:/* &quot;&lt;|\&quot;|\'&quot; \
&quot;phase:2,id:'10000',rev:'2',ver:'OWASP_CRS/2.2.7',maturity:'8',accuracy:'8',t:none,t:htmlEntityDecode,t:compressWhiteSpace,pass,nolog,setvar:tx.pm_xss_filter_score=+%{tx.critical_anomaly_score}&quot;
SecRule &amp;TX:PM_XSS_FILTER_SCORE &quot;@eq 0&quot; &quot;phase:2,id:'10001',t:none,pass,skipAfter:END_XSS_FILTER_CHECK,nolog&quot;
...
SecMarker END_XSS_FILTER_CHECK


With these two changes I measured a noticeable performance improvement of 15 - 25% (depending on parameter size and parameter count) in my test setup with the whole CRS (base rules) activated.

Feedbacks and suggestions are welcome.

Regards,
Lucas Bremgartner

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 5387 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130627/64470c50/attachment.bin">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130627/64470c50/attachment.bin</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001420.html">[Owasp-modsecurity-core-rule-set] About modsecurity for nginx	version
</A></li>
	<LI>Next message: <A HREF="001422.html">[Owasp-modsecurity-core-rule-set] XSS Filters from IE	(modsecurity_crs_41_xss_attacks.conf)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1421">[ date ]</a>
              <a href="thread.html#1421">[ thread ]</a>
              <a href="subject.html#1421">[ subject ]</a>
              <a href="author.html#1421">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
