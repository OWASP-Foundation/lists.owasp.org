<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Problem with 960032
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Problem%20with%20960032&In-Reply-To=%3CCAG6aRdXcEyvXG94WT%3Dyng%2Bvaotdee_X7ntKBBEz4WLUeV4D_ug%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001400.html">
   <LINK REL="Next"  HREF="001407.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Problem with 960032</H1>
    <B>chris derham</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Problem%20with%20960032&In-Reply-To=%3CCAG6aRdXcEyvXG94WT%3Dyng%2Bvaotdee_X7ntKBBEz4WLUeV4D_ug%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Problem with 960032">chris at derham.me.uk
       </A><BR>
    <I>Wed Jun  5 16:40:54 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001400.html">[Owasp-modsecurity-core-rule-set] experimental brute_force protection rule
</A></li>
        <LI>Next message: <A HREF="001407.html">[Owasp-modsecurity-core-rule-set] Problem with 960032
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1401">[ date ]</a>
              <a href="thread.html#1401">[ thread ]</a>
              <a href="subject.html#1401">[ subject ]</a>
              <a href="author.html#1401">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>So we are trying to upgrade from apache 2.2 to 2.4, and bring
mod_security up from an earlier version to the latest. We are running
on Windows, but we took a stock installation of everything, and it
works. However 960032 keeps nagging that the request method is not
valid. The specific error entry is

[Wed Jun 05 17:19:47.207015 2013] [:error] [pid 1972:tid 1232] [client
81.143.18.217] ModSecurity: Warning. Match of &quot;within
%{tx.allowed_methods}&quot; against &quot;REQUEST_METHOD&quot; required. [file
&quot;D:/apps/apacheHttpd/Apache24/conf/mod_security_crs/activated_rules/modsecurity_crs_30_http_policy.conf&quot;]
[line &quot;31&quot;] [id &quot;960032&quot;] [rev &quot;2&quot;] [msg &quot;Method is not allowed by
policy&quot;] [data &quot;GET&quot;] [severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/2.2.7&quot;]
[maturity &quot;9&quot;] [accuracy &quot;9&quot;] [tag
&quot;OWASP_CRS/POLICY/METHOD_NOT_ALLOWED&quot;] [tag &quot;WASCTC/WASC-15&quot;] [tag
&quot;OWASP_TOP_10/A6&quot;] [tag &quot;OWASP_AppSensor/RE1&quot;] [tag &quot;PCI/12.1&quot;]
[hostname &quot;athena.atomus.com&quot;] [uri &quot;/qns/gwtMember/loading.gif&quot;]
[unique_id &quot;Ua9lI8CoADIAAAe0NnoAAAA-&quot;]

If we update the rule from

SecRule REQUEST_METHOD &quot;!@within %{tx.allowed_methods}&quot;

to

SecRule REQUEST_METHOD &quot;!@within GET HEAD POST&quot;

then it works correctly. My conclusion is that somehow the
tx.allowed_methods isn't been passed correctly. The relevant contents
of modsecurity_crs_10_config.conf file that sets this are

SecAction \
 &quot;id:'900012',\
  phase:request,\
  nolog,\
  pass,\
  t:none,\
  setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \
  setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded|multipart/form-data|text/xml|application/xml|application/x-amf|application/json|text/x-gwt-rpc|text/plain',
\
  setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \
  setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/ .backup/
.bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/
.csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/
.idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/
.pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/
.vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/', \
  setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/
/Content-Range/ /Translate/ /via/ /if/'&quot;

We updated the tx.allowed_request_content_type, but tx.allowed_methods
is as was.

Any ideas as to how to proceed debugging this?

Thanks

Chris

P.S. version numbers apache 2.4.4 win64, poenssl/1.01e windows web
server 2008 r2

[Wed Jun 05 17:19:41.005660 2013] [:notice] [pid 1972:tid 456]
ModSecurity for Apache/2.7.4 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>) configured.
[Wed Jun 05 17:19:41.005660 2013] [:notice] [pid 1972:tid 456]
ModSecurity: APR compiled version=&quot;1.4.6&quot;; loaded version=&quot;1.4.6&quot;
[Wed Jun 05 17:19:41.005660 2013] [:notice] [pid 1972:tid 456]
ModSecurity: PCRE compiled version=&quot;8.32 &quot;; loaded version=&quot;8.32
2012-11-30&quot;
[Wed Jun 05 17:19:41.005660 2013] [:notice] [pid 1972:tid 456]
ModSecurity: LUA compiled version=&quot;Lua 5.1&quot;
[Wed Jun 05 17:19:41.005660 2013] [:notice] [pid 1972:tid 456]
ModSecurity: LIBXML compiled version=&quot;2.9.1&quot;
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001400.html">[Owasp-modsecurity-core-rule-set] experimental brute_force protection rule
</A></li>
	<LI>Next message: <A HREF="001407.html">[Owasp-modsecurity-core-rule-set] Problem with 960032
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1401">[ date ]</a>
              <a href="thread.html#1401">[ thread ]</a>
              <a href="subject.html#1401">[ subject ]</a>
              <a href="author.html#1401">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
