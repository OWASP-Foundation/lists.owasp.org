<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Secrule not capturing alert
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Secrule%20not%20capturing%20alert&In-Reply-To=%3CCAPF6YCnmciugXCQZChY06En5JUcCYB18T61bYp2FN2R28jLDZw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002598.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Secrule not capturing alert</H1>
    <B>Paolo Luise</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Secrule%20not%20capturing%20alert&In-Reply-To=%3CCAPF6YCnmciugXCQZChY06En5JUcCYB18T61bYp2FN2R28jLDZw%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Secrule not capturing alert">paolo.luiseit at gmail.com
       </A><BR>
    <I>Wed Oct 31 21:38:29 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="002598.html">[Owasp-modsecurity-core-rule-set] Secrule not capturing alert
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2599">[ date ]</a>
              <a href="thread.html#2599">[ thread ]</a>
              <a href="subject.html#2599">[ subject ]</a>
              <a href="author.html#2599">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Venki,
first of all it should be helpful to know about the version of modsecurity,
OS and web server you are using for your tests. Then, I would suggest you
to use OWASP CRS v3, that should block you request out-of-the-shelf with at
least a couple of rules already in paranoia level 1.

Assuming that you are using modsec version 2 not 3, if you can't adopt CRS,
please try enabling the K section in your audit log:
&quot;K: This part contains a full list of every rule that matched (one per
line) in the order they were matched. The rules are fully qualified and
will thus show inherited actions and default operators.&quot; Rif.
<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#SecAuditLogParts">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#SecAuditLogParts</A>

Also, if this won't help you, the final and always helpful action to do is
tracing modsec activities using its debug feature with directives
SecDebugLog and SecDebugLogLevel (Rif.
<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#SecDebugLog">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#SecDebugLog</A>).
You can enable it also on specific requests using &quot;ctl&quot; action in a
matching rule (Rif.
<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#ctl">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual-%28v2.x%29#ctl</A>
).
Once you have debug enabled and configured, repeat your curl request and
locate your rule number in the debug log; there you will find all you need
for understanding what's going wrong with your rule.

Just for information, with your rule and passing the request you pointed,
in main environment it is blocked.

Regards
Paolo


Hi,
&gt;<i> We have a secrule like this :
</I>&gt;<i> 'SecRule REQUEST_FILENAME|ARGS_NAMES|ARGS|XML:/*
</I>&gt;<i> &quot;(fromcharcode|alert|eval)\s*\(&quot; \
</I>&gt;<i>
</I>&gt;<i>  &quot;phase:2,rev:'2.0.10',id:'973307',capture,t:none,t:htmlEntityDecode,t:jsDecode,t:lowercase,pass,nolog,auditlog,msg:'XSS
</I>&gt;<i> Attack
</I>&gt;<i>
</I>&gt;<i> Detected',logdata:'%{TX.0}',setvar:'tx.msg=%{rule.msg}',setvar:tx.xss_score=+%{tx.critical_anomaly_score},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{
</I>&gt;<i> rule.id}-WEB_ATTACK/XSS-%{matched_var_name}=%{tx.0}&quot;'
</I>&gt;<i>
</I>&gt;<i> When user supplies url like this :
</I>&gt;<i>
</I>&gt;<i>  &lt;hostname&gt;?param1=test%27,alert(document.cookie),%27test&amp;param2
</I>&gt;<i>
</I>&gt;<i> Its not being blocked. Please suggest
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Thanks,
</I>&gt;<i> Venki
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20181031/b43867b1/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20181031/b43867b1/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002598.html">[Owasp-modsecurity-core-rule-set] Secrule not capturing alert
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2599">[ date ]</a>
              <a href="thread.html#2599">[ thread ]</a>
              <a href="subject.html#2599">[ subject ]</a>
              <a href="author.html#2599">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
