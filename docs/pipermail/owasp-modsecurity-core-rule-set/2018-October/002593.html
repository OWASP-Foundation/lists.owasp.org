<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] False positives triggered only by	anomaly score
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20positives%20triggered%20only%20by%0A%09anomaly%20score&In-Reply-To=%3CCACzVMcNL06uNte1cX-%3DUJCZwXXUyLQh3NVyJ7dwy1_nFhtUX-Q%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002592.html">
   <LINK REL="Next"  HREF="002594.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] False positives triggered only by	anomaly score</H1>
    <B>Jonah Potter</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20positives%20triggered%20only%20by%0A%09anomaly%20score&In-Reply-To=%3CCACzVMcNL06uNte1cX-%3DUJCZwXXUyLQh3NVyJ7dwy1_nFhtUX-Q%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] False positives triggered only by	anomaly score">jonah at datacompusa.com
       </A><BR>
    <I>Wed Oct 17 17:46:42 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="002592.html">[Owasp-modsecurity-core-rule-set] CRS 3.0 and trojan detection
</A></li>
        <LI>Next message: <A HREF="002594.html">[Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2593">[ date ]</a>
              <a href="thread.html#2593">[ thread ]</a>
              <a href="subject.html#2593">[ subject ]</a>
              <a href="author.html#2593">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey guys, hoping you can help me out with a issue I'm having. I'm running
OWASP v3 with libmodsecurity 3.0 on top of nginx-1.15.3 via
Modsecurity-nginx. I'm experiencing false positives of this variety with
some regularity. A given request will be 403'd, but when I check
modsec_audit.log, the only rule violations logged are the two &quot;inbound
anomaly score exceeded&quot; codes. The rule that was presumably violated
leading to the anomaly score being incremented is not logged at all. Here's
an example:

---S4x9aI9l---A--
&gt;<i> [17/Oct/2018:11:41:19 -0400] 153979087991.549389 [ip] 61929 [ip] 443
</I>&gt;<i> ---S4x9aI9l---B--
</I>&gt;<i> POST /path/file.php?args=args HTTP/2.0
</I>&gt;<i> accept-encoding: gzip, deflate, br
</I>&gt;<i> cookie: PHPSESSID=xyz; notBot=notBot; _ga=xyz;
</I>&gt;<i> 73d45a3f924337c011d46201c4a77d88c8b17afce961417c3e4fb7bbce09a31a=0thocmt2erfgbcpmrts35lqgh1;
</I>&gt;<i> SideMenu=0; SearchLocation=49316; _gid=GA1.2.1268970541.1539790780; Me=xyz;
</I>&gt;<i> _gat_UA-1302423-1=1
</I>&gt;<i> accept:
</I>&gt;<i> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
</I>&gt;<i> cache-control: max-age=0
</I>&gt;<i> user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6)
</I>&gt;<i> AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36
</I>&gt;<i> content-type: multipart/form-data;
</I>&gt;<i> boundary=----WebKitFormBoundaryCoCuOxmv7pZRNW9G
</I>&gt;<i> upgrade-insecure-requests: 1
</I>&gt;<i> referer: <A HREF="https://www.mydomain.com/path/file.php?args=args">https://www.mydomain.com/path/file.php?args=args</A>
</I>&gt;<i> origin: <A HREF="https://www.mydomain.com">https://www.mydomain.com</A>
</I>&gt;<i> content-length: 1033
</I>&gt;<i> host: www.mydomain.com
</I>&gt;<i> accept-language: en-US,en;q=0.9
</I>&gt;<i> ---S4x9aI9l---D--
</I>&gt;<i> ---S4x9aI9l---E--
</I>&gt;<i> &lt;html&gt;\x0d\x0a&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;\x0d\x0a&lt;body
</I>&gt;<i> bgcolor=&quot;white&quot;&gt;\x0d\x0a&lt;center&gt;&lt;h1&gt;403
</I>&gt;<i> Forbidden&lt;/h1&gt;&lt;/center&gt;\x0d\x0a&lt;hr&gt;&lt;center&gt;nginx/1.15.3&lt;/center&gt;\x0d\x0a&lt;/body&gt;\x0d\x0a&lt;/html&gt;\x0d\x0a&lt;!--
</I>&gt;<i> a padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a&lt;!-- a
</I>&gt;<i> padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a&lt;!-- a
</I>&gt;<i> padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a&lt;!-- a
</I>&gt;<i> padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a&lt;!-- a
</I>&gt;<i> padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a&lt;!-- a
</I>&gt;<i> padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a
</I>&gt;<i> ---S4x9aI9l---F--
</I>&gt;<i> HTTP/2.0 403
</I>&gt;<i> Server: nginx/1.15.3
</I>&gt;<i> Date: Wed, 17 Oct 2018 15:41:19 GMT
</I>&gt;<i> Content-Length: 571
</I>&gt;<i> Content-Type: text/html
</I>&gt;<i> Connection: close
</I>&gt;<i> ---S4x9aI9l---H--
</I>&gt;<i> ModSecurity: Access denied with code 403 (phase 2). Matched &quot;Operator `Ge'
</I>&gt;<i> with parameter `5' against variable `TX:ANOMALY_SCORE' (Value: `5' ) [file
</I>&gt;<i> &quot;/usr/local/owasp-modsecurity-crs-3.0.0/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;]
</I>&gt;<i> [line &quot;36&quot;] [id &quot;949110&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score Exceeded
</I>&gt;<i> (Total Score: 5)&quot;] [data &quot;&quot;] [severity &quot;2&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;]
</I>&gt;<i> [accuracy &quot;0&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag
</I>&gt;<i> &quot;platform-multi&quot;] [tag &quot;attack-generic&quot;] [hostname &quot;173.167.228.139&quot;] [uri
</I>&gt;<i> &quot;/path/file.php&quot;] [unique_id &quot;153979087991.549389&quot;] [ref &quot;&quot;]
</I>&gt;<i> ModSecurity: Warning. Matched &quot;Operator `Ge' with parameter `5' against
</I>&gt;<i> variable `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file
</I>&gt;<i> &quot;/usr/local/owasp-modsecurity-crs-3.0.0/rules/RESPONSE-980-CORRELATION.conf&quot;]
</I>&gt;<i> [line &quot;61&quot;] [id &quot;980130&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score Exceeded
</I>&gt;<i> (Total Inbound Score: 5 -
</I>&gt;<i> SQLI=0,XSS=5,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): XSS Filter - Category
</I>&gt;<i> 5: Disallowed HTML Attributes&quot;] [data &quot;&quot;] [severity &quot;0&quot;] [ver &quot;&quot;] [maturity
</I>&gt;<i> &quot;0&quot;] [accuracy &quot;0&quot;] [tag &quot;event-correlation&quot;] [hostname &quot;173.167.228.139&quot;]
</I>&gt;<i> [uri &quot;/path/file.php&quot;] [unique_id &quot;153979087991.549389&quot;] [ref &quot;&quot;]
</I>&gt;<i> ---S4x9aI9l---I--
</I>&gt;<i> ---S4x9aI9l---J--
</I>&gt;<i> ---S4x9aI9l---Z--
</I>

I know what the issue is - the user is submitting a text field containing
HTML tags - but I'm not sure precisely which rule is being triggered, so I
can't figure out how to write a custom rule that disables it for that
particular argument. Any help in either determining which rule was
triggered or ensuring the rule is logged would be much appreciated. If more
information would be helpful, just ask, I'm happy to provide whatever I can.

Thanks,
Jonah
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20181017/d7caafa2/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20181017/d7caafa2/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002592.html">[Owasp-modsecurity-core-rule-set] CRS 3.0 and trojan detection
</A></li>
	<LI>Next message: <A HREF="002594.html">[Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2593">[ date ]</a>
              <a href="thread.html#2593">[ thread ]</a>
              <a href="subject.html#2593">[ subject ]</a>
              <a href="author.html#2593">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
