<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20positives%20triggered%0A%20only%20by%20anomaly%20score&In-Reply-To=%3C20181018192654.GA32564%40leander%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002596.html">
   <LINK REL="Next"  HREF="002598.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20False%20positives%20triggered%0A%20only%20by%20anomaly%20score&In-Reply-To=%3C20181018192654.GA32564%40leander%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score">christian.folini at netnea.com
       </A><BR>
    <I>Thu Oct 18 19:26:54 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="002596.html">[Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score
</A></li>
        <LI>Next message: <A HREF="002598.html">[Owasp-modsecurity-core-rule-set] Secrule not capturing alert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2597">[ date ]</a>
              <a href="thread.html#2597">[ thread ]</a>
              <a href="subject.html#2597">[ subject ]</a>
              <a href="author.html#2597">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Cool. Glad that solved this issue.

If you have additional FPs at paranoia level 1, please do report them.
We want to weed out all FPs in the default installation.

Best,

Christian

On Thu, Oct 18, 2018 at 03:20:25PM -0400, Jonah Potter wrote:
&gt;<i> The upgrade from CRS 3.0.0 to 3.0.2 resolved the false positive - the
</I>&gt;<i> request no longer returns a 403. I have yet to see any more lonely anomaly
</I>&gt;<i> score errors in the logs, and hopefully that trend will continue. Thanks
</I>&gt;<i> again for the assistance.
</I>&gt;<i> - Jonah
</I>&gt;<i> 
</I>&gt;<i> On Thu, Oct 18, 2018 at 1:55 PM Christian Folini &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; Hey Jonah,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Good luck and please report back with the results.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Christian
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Thu, Oct 18, 2018 at 10:48:40AM -0400, Jonah Potter wrote:
</I>&gt;<i> &gt; &gt; Gregory - good idea. Unfortunately, after adding part K to
</I>&gt;<i> &gt; SecAuditLogParts
</I>&gt;<i> &gt; &gt; and reproducing the issue, I didn't get any output in part K. Oddly
</I>&gt;<i> &gt; enough,
</I>&gt;<i> &gt; &gt; no logged requests are outputting anything under the part K heading, even
</I>&gt;<i> &gt; &gt; when they have warnings listed in part H.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Christian - My mistake - I meant CRS 3.0.0. I'll update to 3.0.2, and if
</I>&gt;<i> &gt; &gt; that doesn't take care of it, I'll give 3.1-RC1 a shot, and let you know
</I>&gt;<i> &gt; &gt; what happens.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Thanks again,
</I>&gt;<i> &gt; &gt; Jonah
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On Wed, Oct 17, 2018 at 2:57 PM Christian Folini &lt;
</I>&gt;<i> &gt; &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Hey Jonah,
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I suppose you mean CRS 3.0.2 when you say OWASP v3.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I think there is a silent rule in 3.0.x that raises the anomaly score
</I>&gt;<i> &gt; &gt; &gt; without
</I>&gt;<i> &gt; &gt; &gt; issuing an alert message. But I can't remember if we fixed that for
</I>&gt;<i> &gt; 3.0.2
</I>&gt;<i> &gt; &gt; &gt; or
</I>&gt;<i> &gt; &gt; &gt; only for the upcoming 3.1. Could you try with 3.1-RC1 and reproduce it?
</I>&gt;<i> &gt; &gt; &gt; Alternatively, you could raise the debug log level and follow the
</I>&gt;<i> &gt; &gt; &gt; execution of
</I>&gt;<i> &gt; &gt; &gt; the rules.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Best,
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Christian
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; On Wed, Oct 17, 2018 at 01:46:42PM -0400, Jonah Potter wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Hey guys, hoping you can help me out with a issue I'm having. I'm
</I>&gt;<i> &gt; running
</I>&gt;<i> &gt; &gt; &gt; &gt; OWASP v3 with libmodsecurity 3.0 on top of nginx-1.15.3 via
</I>&gt;<i> &gt; &gt; &gt; &gt; Modsecurity-nginx. I'm experiencing false positives of this variety
</I>&gt;<i> &gt; with
</I>&gt;<i> &gt; &gt; &gt; &gt; some regularity. A given request will be 403'd, but when I check
</I>&gt;<i> &gt; &gt; &gt; &gt; modsec_audit.log, the only rule violations logged are the two
</I>&gt;<i> &gt; &quot;inbound
</I>&gt;<i> &gt; &gt; &gt; &gt; anomaly score exceeded&quot; codes. The rule that was presumably violated
</I>&gt;<i> &gt; &gt; &gt; &gt; leading to the anomaly score being incremented is not logged at all.
</I>&gt;<i> &gt; &gt; &gt; Here's
</I>&gt;<i> &gt; &gt; &gt; &gt; an example:
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; ---S4x9aI9l---A--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [17/Oct/2018:11:41:19 -0400] 153979087991.549389 [ip] 61929 [ip]
</I>&gt;<i> &gt; 443
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---B--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; POST /path/file.php?args=args HTTP/2.0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; accept-encoding: gzip, deflate, br
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; cookie: PHPSESSID=xyz; notBot=notBot; _ga=xyz;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; 73d45a3f924337c011d46201c4a77d88c8b17afce961417c3e4fb7bbce09a31a=0thocmt2erfgbcpmrts35lqgh1;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; SideMenu=0; SearchLocation=49316; _gid=GA1.2.1268970541.1539790780;
</I>&gt;<i> &gt; &gt; &gt; Me=xyz;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; _gat_UA-1302423-1=1
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; accept:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; cache-control: max-age=0
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100
</I>&gt;<i> &gt; &gt; &gt; Safari/537.36
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; content-type: multipart/form-data;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; boundary=----WebKitFormBoundaryCoCuOxmv7pZRNW9G
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; upgrade-insecure-requests: 1
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; referer: <A HREF="https://www.mydomain.com/path/file.php?args=args">https://www.mydomain.com/path/file.php?args=args</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; origin: <A HREF="https://www.mydomain.com">https://www.mydomain.com</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; content-length: 1033
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; host: www.mydomain.com
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; accept-language: en-US,en;q=0.9
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---D--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---E--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &lt;html&gt;\x0d\x0a&lt;head&gt;&lt;title&gt;403
</I>&gt;<i> &gt; Forbidden&lt;/title&gt;&lt;/head&gt;\x0d\x0a&lt;body
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; bgcolor=&quot;white&quot;&gt;\x0d\x0a&lt;center&gt;&lt;h1&gt;403
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; Forbidden&lt;/h1&gt;&lt;/center&gt;\x0d\x0a&lt;hr&gt;&lt;center&gt;nginx/1.15.3&lt;/center&gt;\x0d\x0a&lt;/body&gt;\x0d\x0a&lt;/html&gt;\x0d\x0a&lt;!--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; a padding to disable MSIE and Chrome friendly error page
</I>&gt;<i> &gt; &gt; &gt; --&gt;\x0d\x0a&lt;!-- a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; padding to disable MSIE and Chrome friendly error page
</I>&gt;<i> &gt; --&gt;\x0d\x0a&lt;!--
</I>&gt;<i> &gt; &gt; &gt; a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; padding to disable MSIE and Chrome friendly error page
</I>&gt;<i> &gt; --&gt;\x0d\x0a&lt;!--
</I>&gt;<i> &gt; &gt; &gt; a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; padding to disable MSIE and Chrome friendly error page
</I>&gt;<i> &gt; --&gt;\x0d\x0a&lt;!--
</I>&gt;<i> &gt; &gt; &gt; a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; padding to disable MSIE and Chrome friendly error page
</I>&gt;<i> &gt; --&gt;\x0d\x0a&lt;!--
</I>&gt;<i> &gt; &gt; &gt; a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; padding to disable MSIE and Chrome friendly error page --&gt;\x0d\x0a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---F--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; HTTP/2.0 403
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Server: nginx/1.15.3
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Date: Wed, 17 Oct 2018 15:41:19 GMT
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Content-Length: 571
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Content-Type: text/html
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Connection: close
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---H--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ModSecurity: Access denied with code 403 (phase 2). Matched
</I>&gt;<i> &gt; &quot;Operator
</I>&gt;<i> &gt; &gt; &gt; `Ge'
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; with parameter `5' against variable `TX:ANOMALY_SCORE' (Value: `5'
</I>&gt;<i> &gt; )
</I>&gt;<i> &gt; &gt; &gt; [file
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &quot;/usr/local/owasp-modsecurity-crs-3.0.0/rules/REQUEST-949-BLOCKING-EVALUATION.conf&quot;]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [line &quot;36&quot;] [id &quot;949110&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score
</I>&gt;<i> &gt; Exceeded
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; (Total Score: 5)&quot;] [data &quot;&quot;] [severity &quot;2&quot;] [ver &quot;&quot;] [maturity &quot;0&quot;]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [accuracy &quot;0&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;]
</I>&gt;<i> &gt; [tag
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &quot;platform-multi&quot;] [tag &quot;attack-generic&quot;] [hostname
</I>&gt;<i> &gt; &quot;173.167.228.139&quot;]
</I>&gt;<i> &gt; &gt; &gt; [uri
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &quot;/path/file.php&quot;] [unique_id &quot;153979087991.549389&quot;] [ref &quot;&quot;]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ModSecurity: Warning. Matched &quot;Operator `Ge' with parameter `5'
</I>&gt;<i> &gt; against
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; variable `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &quot;/usr/local/owasp-modsecurity-crs-3.0.0/rules/RESPONSE-980-CORRELATION.conf&quot;]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [line &quot;61&quot;] [id &quot;980130&quot;] [rev &quot;&quot;] [msg &quot;Inbound Anomaly Score
</I>&gt;<i> &gt; Exceeded
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; (Total Inbound Score: 5 -
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; SQLI=0,XSS=5,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): XSS Filter -
</I>&gt;<i> &gt; &gt; &gt; Category
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; 5: Disallowed HTML Attributes&quot;] [data &quot;&quot;] [severity &quot;0&quot;] [ver &quot;&quot;]
</I>&gt;<i> &gt; &gt; &gt; [maturity
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &quot;0&quot;] [accuracy &quot;0&quot;] [tag &quot;event-correlation&quot;] [hostname
</I>&gt;<i> &gt; &gt; &gt; &quot;173.167.228.139&quot;]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; [uri &quot;/path/file.php&quot;] [unique_id &quot;153979087991.549389&quot;] [ref &quot;&quot;]
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---I--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---J--
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; ---S4x9aI9l---Z--
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; I know what the issue is - the user is submitting a text field
</I>&gt;<i> &gt; containing
</I>&gt;<i> &gt; &gt; &gt; &gt; HTML tags - but I'm not sure precisely which rule is being
</I>&gt;<i> &gt; triggered, so
</I>&gt;<i> &gt; &gt; &gt; I
</I>&gt;<i> &gt; &gt; &gt; &gt; can't figure out how to write a custom rule that disables it for that
</I>&gt;<i> &gt; &gt; &gt; &gt; particular argument. Any help in either determining which rule was
</I>&gt;<i> &gt; &gt; &gt; &gt; triggered or ensuring the rule is logged would be much appreciated.
</I>&gt;<i> &gt; If
</I>&gt;<i> &gt; &gt; &gt; more
</I>&gt;<i> &gt; &gt; &gt; &gt; information would be helpful, just ask, I'm happy to provide
</I>&gt;<i> &gt; whatever I
</I>&gt;<i> &gt; &gt; &gt; can.
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; &gt; &gt; Jonah
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; &gt; Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> &gt; &gt; &gt; &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt;
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002596.html">[Owasp-modsecurity-core-rule-set] False positives triggered only by anomaly score
</A></li>
	<LI>Next message: <A HREF="002598.html">[Owasp-modsecurity-core-rule-set] Secrule not capturing alert
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2597">[ date ]</a>
              <a href="thread.html#2597">[ thread ]</a>
              <a href="subject.html#2597">[ subject ]</a>
              <a href="author.html#2597">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
