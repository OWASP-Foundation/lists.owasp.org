<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [PATCH]	modsecurity_crs_47_common_exceptions.conf: drop apache	User-Agent signature for dummy connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%5BPATCH%5D%0A%09modsecurity_crs_47_common_exceptions.conf%3A%20drop%20apache%0A%09User-Agent%20signature%20for%20dummy%20connection&In-Reply-To=%3C1359543455-17923-1-git-send-email-yersinia.spiros%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001289.html">
   <LINK REL="Next"  HREF="001295.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [PATCH]	modsecurity_crs_47_common_exceptions.conf: drop apache	User-Agent signature for dummy connection</H1>
    <B>Elia Pinto</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%5BPATCH%5D%0A%09modsecurity_crs_47_common_exceptions.conf%3A%20drop%20apache%0A%09User-Agent%20signature%20for%20dummy%20connection&In-Reply-To=%3C1359543455-17923-1-git-send-email-yersinia.spiros%40gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] [PATCH]	modsecurity_crs_47_common_exceptions.conf: drop apache	User-Agent signature for dummy connection">yersinia.spiros at gmail.com
       </A><BR>
    <I>Wed Jan 30 10:57:35 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001289.html">[Owasp-modsecurity-core-rule-set]  Reg sanitiseArg
</A></li>
        <LI>Next message: <A HREF="001295.html">[Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1290">[ date ]</a>
              <a href="thread.html#1290">[ thread ]</a>
              <a href="subject.html#1290">[ subject ]</a>
              <a href="author.html#1290">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>When the apache HTTP Server manages its child processes, it sends a simple HTTP request back to itself.
This request will appear in the access_log file with the remote address set to the loop-back interface
and if you log the User-Agent string you will see the server signature followed by &quot;(internal dummy connection)&quot;
on non-SSL servers. modsecurity_crs_47_common_exceptions already contain a chained rule for skipping
the apache internal dummy connection if the connection is from the lookback address.

But if the administrator has set the directive SecServerSignature
to one of the ./modsecurity_35_bad_robots.data, for example chinaclaw, the skip rule for the internal dummy connection is not used,
because in that case the User-Agent is defined by the valued of the SecServerSignature, and
not contain the value Apache: in this case the rule 990012 will fire wrongly.
Therefore, because the skip rule it is applied already to connection from 127.0.0.1,
so it is sufficently safe, don't cause any problem to eliminate the &quot;Apache&quot; control also on the User-Agent variables.
It is very similar to a standard iptables setup in which it is common to put a catchall ACCEPT rule
on the loopback interface.
---
 .../modsecurity_crs_47_common_exceptions.conf      |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/base_rules/modsecurity_crs_47_common_exceptions.conf b/base_rules/modsecurity_crs_47_common_exceptions.conf
index c63cabd..eda515b 100644
--- a/base_rules/modsecurity_crs_47_common_exceptions.conf
+++ b/base_rules/modsecurity_crs_47_common_exceptions.conf
@@ -23,7 +23,7 @@ SecRule REQUEST_LINE &quot;^GET /$&quot; &quot;chain,phase:2,id:'981020',t:none,pass,nolog&quot;
 #
 SecRule REQUEST_LINE &quot;^(GET /|OPTIONS \*) HTTP/1.0$&quot; &quot;chain,phase:2,id:'981021',t:none,pass,nolog&quot;
 	SecRule REMOTE_ADDR &quot;^(127\.0\.0\.|\:\:)1$&quot; &quot;chain,t:none&quot;
-		SecRule REQUEST_HEADERS:User-Agent &quot;^Apache.*\(internal dummy connection\)$&quot; &quot;t:none,t:none,chain&quot;
+		SecRule REQUEST_HEADERS:User-Agent &quot;^.*\(internal dummy connection\)$&quot; &quot;t:none,t:none,chain&quot;
                 	SecRule TX:'/PROTOCOL_VIOLATION\\\/MISSING_HEADER/' &quot;.*&quot; &quot;chain,setvar:tx.missing_header=+1,setvar:tx.missing_header_%{tx.missing_header}=%{matched_var_name}&quot;
                         	SecRule TX:'/MISSING_HEADER_/' &quot;TX\:(.*)&quot; &quot;capture,t:none,setvar:!tx.%{tx.1}&quot;
 
-- 
1.7.1

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001289.html">[Owasp-modsecurity-core-rule-set]  Reg sanitiseArg
</A></li>
	<LI>Next message: <A HREF="001295.html">[Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1290">[ date ]</a>
              <a href="thread.html#1290">[ thread ]</a>
              <a href="subject.html#1290">[ subject ]</a>
              <a href="author.html#1290">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
