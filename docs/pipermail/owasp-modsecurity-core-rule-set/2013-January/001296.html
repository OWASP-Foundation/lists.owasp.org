<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%5BPATCH%5D%0A%20modsecurity_crs_47_common_exceptions.conf%3A%20drop%20apache%20User-Agent%20signature%0A%20for%20dummy%20connection&In-Reply-To=%3C01987910BF74B341B5890120BCCE77DF0D4EFC%40SKYMB1.trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001295.html">
   <LINK REL="Next"  HREF="001291.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%5BPATCH%5D%0A%20modsecurity_crs_47_common_exceptions.conf%3A%20drop%20apache%20User-Agent%20signature%0A%20for%20dummy%20connection&In-Reply-To=%3C01987910BF74B341B5890120BCCE77DF0D4EFC%40SKYMB1.trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection">RBarnett at trustwave.com
       </A><BR>
    <I>Thu Jan 31 22:15:04 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001295.html">[Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection
</A></li>
        <LI>Next message: <A HREF="001291.html">[Owasp-modsecurity-core-rule-set] Auto-Updating for the OWASP	ModSecurity CRS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1296">[ date ]</a>
              <a href="thread.html#1296">[ thread ]</a>
              <a href="subject.html#1296">[ subject ]</a>
              <a href="author.html#1296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please use GitHub and issue a Pull request.

Thanks.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

From: yersinia &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">yersinia.spiros at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">yersinia.spiros at gmail.com</A>&gt;&gt;
Date: Thursday, January 31, 2013 12:33 PM
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection

Patch not useful or wrong way to post it ? Just for info.

Best

On Wed, Jan 30, 2013 at 11:57 AM, Elia Pinto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">yersinia.spiros at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">yersinia.spiros at gmail.com</A>&gt;&gt; wrote:
When the apache HTTP Server manages its child processes, it sends a simple HTTP request back to itself.
This request will appear in the access_log file with the remote address set to the loop-back interface
and if you log the User-Agent string you will see the server signature followed by &quot;(internal dummy connection)&quot;
on non-SSL servers. modsecurity_crs_47_common_exceptions already contain a chained rule for skipping
the apache internal dummy connection if the connection is from the lookback address.

But if the administrator has set the directive SecServerSignature
to one of the ./modsecurity_35_bad_robots.data, for example chinaclaw, the skip rule for the internal dummy connection is not used,
because in that case the User-Agent is defined by the valued of the SecServerSignature, and
not contain the value Apache: in this case the rule 990012 will fire wrongly.
Therefore, because the skip rule it is applied already to connection from 127.0.0.1,
so it is sufficently safe, don't cause any problem to eliminate the &quot;Apache&quot; control also on the User-Agent variables.
It is very similar to a standard iptables setup in which it is common to put a catchall ACCEPT rule
on the loopback interface.
---
 .../modsecurity_crs_47_common_exceptions.conf      |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/base_rules/modsecurity_crs_47_common_exceptions.conf b/base_rules/modsecurity_crs_47_common_exceptions.conf
index c63cabd..eda515b 100644
--- a/base_rules/modsecurity_crs_47_common_exceptions.conf
+++ b/base_rules/modsecurity_crs_47_common_exceptions.conf
@@ -23,7 +23,7 @@ SecRule REQUEST_LINE &quot;^GET /$&quot; &quot;chain,phase:2,id:'981020',t:none,pass,nolog&quot;
 #
 SecRule REQUEST_LINE &quot;^(GET /|OPTIONS \*) HTTP/1.0$&quot; &quot;chain,phase:2,id:'981021',t:none,pass,nolog&quot;
        SecRule REMOTE_ADDR &quot;^(127\.0\.0\.|\:\:)1$&quot; &quot;chain,t:none&quot;
-               SecRule REQUEST_HEADERS:User-Agent &quot;^Apache.*\(internal dummy connection\)$&quot; &quot;t:none,t:none,chain&quot;
+               SecRule REQUEST_HEADERS:User-Agent &quot;^.*\(internal dummy connection\)$&quot; &quot;t:none,t:none,chain&quot;
                        SecRule TX:'/PROTOCOL_VIOLATION\\\/MISSING_HEADER/' &quot;.*&quot; &quot;chain,setvar:tx.missing_header=+1,setvar:tx.missing_header_%{tx.missing_header}=%{matched_var_name}&quot;
                                SecRule TX:'/MISSING_HEADER_/' &quot;TX\:(.*)&quot; &quot;capture,t:none,setvar:!tx.%{tx.1}&quot;

--
1.7.1



________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130131/eaeb598e/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130131/eaeb598e/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001295.html">[Owasp-modsecurity-core-rule-set] [PATCH] modsecurity_crs_47_common_exceptions.conf: drop apache User-Agent signature for dummy connection
</A></li>
	<LI>Next message: <A HREF="001291.html">[Owasp-modsecurity-core-rule-set] Auto-Updating for the OWASP	ModSecurity CRS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1296">[ date ]</a>
              <a href="thread.html#1296">[ thread ]</a>
              <a href="subject.html#1296">[ subject ]</a>
              <a href="author.html#1296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
