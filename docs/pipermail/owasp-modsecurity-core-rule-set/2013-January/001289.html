<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set]  Reg sanitiseArg
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%20Reg%20sanitiseArg&In-Reply-To=%3CC310131DD0004743B2508B65C77B663121E795AF%40PMEXGMB04.juniper.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001287.html">
   <LINK REL="Next"  HREF="001290.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set]  Reg sanitiseArg</H1>
    <B>Thayyilekandy, Subin : Barclaycard US</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20%20Reg%20sanitiseArg&In-Reply-To=%3CC310131DD0004743B2508B65C77B663121E795AF%40PMEXGMB04.juniper.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set]  Reg sanitiseArg">sthayyilekan at BarclaycardUS.com
       </A><BR>
    <I>Mon Jan 28 21:21:35 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001287.html">[Owasp-modsecurity-core-rule-set] CRS for mod_security v1.9.5?
</A></li>
        <LI>Next message: <A HREF="001290.html">[Owasp-modsecurity-core-rule-set] [PATCH]	modsecurity_crs_47_common_exceptions.conf: drop apache	User-Agent signature for dummy connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1289">[ date ]</a>
              <a href="thread.html#1289">[ thread ]</a>
              <a href="subject.html#1289">[ subject ]</a>
              <a href="author.html#1289">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We have the below rule in for sanitizing user passwords , looks like it is not working all the time .

      SecAction &quot;phase:5,nolog,pass,sanitiseArg:password,sanitiseArg:newPassword&quot;

What I noticed is if we request with a single XSS, SQLi request it will be sanitized , suppose if we remove the referrer/accept header then the rules of modsecurity_crs_21_protocol_anomalies will be hit and it will not be sanitized, irrespective of whether there were other pattern matches as well.

This only happens for protocol anomaly issues, if there was a pattern match for file 21 , the password in the post body is not being sanitized ,has anybody come across such issues ? any clue on what could be wrong ? We use Apache/2.6.8 with ruleset/2.2.5


--c0462570-A--
[28/Jan/2013:15:48:41 +0000] UQad0gr-ihYAAGfqXUgAAADT 63.78.242.16 56811 10.255.138.22 4499
--c0462570-B--
POST /mobileservice/authenticate HTTP/1.1
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US; rv:1.9.2.8) Gecko/20100722 Firefox/3.6.8
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 115
Connection: keep-alive
X-Scan-Memo: Category=&quot;Audit&quot;; Function=&quot;createStateRequestFromAttackDefinition&quot;; SID=&quot;ACB328923297B9BDE3F8200E483A3D05&quot;; PSID=&quot;23B3A87EEBF8C7453E112BF4E4A43265&quot;; SessionType=&quot;AuditAttack&quot;; CrawlType=&quot;None&quot;; AttackType=&quot;Search&quot;; OriginatingEngineID=&quot;63a283c6-6b75-41e3-b0c2-d7b0821c2902&quot;; AttackSequence=&quot;0&quot;; AttackParamDesc=&quot;&quot;; AttackParamIndex=&quot;0&quot;; AttackParamSubIndex=&quot;0&quot;; CheckId=&quot;4897&quot;; Engine=&quot;Fixed&quot;; Retry=&quot;False&quot;; SmartMode=&quot;NonServerSpecificOnly&quot;; ThreadId=&quot;270&quot;; ThreadType=&quot;AuditDBReaderSessionDrivenAudit&quot;;
X-StateRequest-Memo: StateID=&quot;9734&quot;;
X-WIPP: AscVersion=&quot;9.20.247.0&quot;
X-Request-Memo: ID=&quot;1ee130af-7317-47a3-bb1d-3c85537ce63c&quot;; Sequence=&quot;0&quot;; ThreadId=&quot;59&quot;;
Content-Length: 44

--c0462570-C--
userID=user123&amp;password=Happy123&amp;version=2.0

--c0462570-H--
Message: Warning. Match of &quot;rx ^0$&quot; against &quot;REQUEST_HEADERS:Content-Length&quot; required. [file &quot;/cust/docs/config/qa01/mobile/crs/base_rules/modsecurity_crs_21_protocol_anomalies.conf&quot;] [line &quot;84&quot;] [id &quot;960904&quot;] [rev &quot;2.2.5&quot;] [msg &quot;Request Containing Content, but Missing Content-Type header&quot;] [severity &quot;NOTICE&quot;]
Message: Warning. Pattern match &quot;^(?i:0|allow)$&quot; at RESPONSE_HEADERS. [file &quot;/cust/docs/config/qa01/mobile/crs/base_rules/modsecurity_crs_55_application_defects.conf&quot;] [line &quot;151&quot;] [id &quot;981405&quot;] [msg &quot;AppDefect: X-FRAME-OPTIONS Response Header is Missing or not set to Deny.&quot;] [data &quot;X-FRAME-OPTIONS: &quot;] [tag &quot;WASCTC/WASC-15&quot;] [tag &quot;MISCONFIGURATION&quot;] [tag &quot;<A HREF="http://websecuritytool.codeplex.com/wikipage?title=Checks#http-header-x-frame-options">http://websecuritytool.codeplex.com/wikipage?title=Checks#http-header-x-frame-options</A>&quot;]
Message: Warning. Operator LT matched 5 at TX:inbound_anomaly_score. [file &quot;/cust/docs/config/qa01/mobile/crs/base_rules/modsecurity_crs_60_correlation.conf&quot;] [line &quot;33&quot;] [id &quot;981203&quot;] [msg &quot;Inbound Anomaly Score (Total Inbound Score: 2, SQLi=, XSS=): Request Containing Content, but Missing Content-Type header&quot;]
Apache-Handler: proxy-server
Stopwatch: 1359388114515371 6931912 (- - -)
Stopwatch2: 1359388114515371 6931912; combined=2977, p1=303, p2=2010, p3=34, p4=82, p5=461, sr=98, sw=87, l=0, gc=0
Producer: ModSecurity for Apache/2.6.8 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>); core ruleset/2.2.5.
Server: Apache

--c0462570-Z--


Thanks
Subin



Barclaycard
www.barclaycardus.com 

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130128/a466bc0b/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20130128/a466bc0b/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001287.html">[Owasp-modsecurity-core-rule-set] CRS for mod_security v1.9.5?
</A></li>
	<LI>Next message: <A HREF="001290.html">[Owasp-modsecurity-core-rule-set] [PATCH]	modsecurity_crs_47_common_exceptions.conf: drop apache	User-Agent signature for dummy connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1289">[ date ]</a>
              <a href="thread.html#1289">[ thread ]</a>
              <a href="subject.html#1289">[ subject ]</a>
              <a href="author.html#1289">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
