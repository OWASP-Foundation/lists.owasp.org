<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [mod-security-users] Posting	HTML contents
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5Bmod-security-users%5D%20Posting%0A%09HTML%20contents&In-Reply-To=200911051123.08936.assistenza%40alfait.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000146.html">
   <LINK REL="Next"  HREF="000142.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [mod-security-users] Posting	HTML contents</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5Bmod-security-users%5D%20Posting%0A%09HTML%20contents&In-Reply-To=200911051123.08936.assistenza%40alfait.org"
       TITLE="[Owasp-modsecurity-core-rule-set] [mod-security-users] Posting	HTML contents">ryan.barnett at breach.com
       </A><BR>
    <I>Thu Nov  5 08:42:46 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000146.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] Posting	HTML contents
</A></li>
        <LI>Next message: <A HREF="000142.html">[Owasp-modsecurity-core-rule-set] Excessive logging in audit.log	and debug.log for modsecurity. How to deal?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#147">[ date ]</a>
              <a href="thread.html#147">[ thread ]</a>
              <a href="subject.html#147">[ subject ]</a>
              <a href="author.html#147">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thursday 05 November 2009 05:23:07 am Fabian Martintoni wrote:
&gt;<i> First of all thanks for the answer.
</I>&gt;<i>
</I>&gt;<i> I'm using Gentoo, and upgrading from mod_security vesrion 2.5.9 to
</I>&gt;<i> 2.5.10-r1 fired the hell. I didnt notice anything before. Probably this was
</I>&gt;<i> caused by mod_deflate [msg &quot;ModSecurity does not support content
</I>&gt;<i> encodings&quot;]
</I>&gt;<i>
</I>No I don't think it was a mod_deflate issue but rather improved security 
coverage for CRS v2.  We improved the XSS identification considerably in the 
newer version.  In the previous versions, XSS detection was pretty poor and 
had some serious false negative/bypass issues.  Check out this blackhat XSS 
bypass preso in which they highlight older CRS issues - 
<A HREF="http://www.blackhat.com/presentations/bh-usa-09/VELANAVA/BHUSA09-VelaNava-">http://www.blackhat.com/presentations/bh-usa-09/VELANAVA/BHUSA09-VelaNava-</A>
FavoriteXSS-SLIDES.pdf

&gt;<i> Now there are a whole lot of webapps who stopped working. I've just found
</I>&gt;<i> another one: impossible to login in dev-db/phppgadmin-4.2.2.
</I>&gt;<i>
</I>Are you using the default anomaly scoring approach?  What scoring threshold do 
you have set?  You can easily add exception rules to increase the score or 
only inspect certain categories of issues for certain locations as well - say 
for your phppgadmin login.

&gt;<i> I confess, ther first thought was about removing mod_security.
</I>&gt;<i>
</I>Please don't go that route!  We went to great lengths with CRSv2 so that it 
will be easier for user to do exceptions.  You can either raise the overall 
anomaly scoring threshold or you can get granular and handle false positives 
in the exception file.  Take a look at some of the examples in the 48 local 
exceptions file for help.

&gt;<i> There are many strong restrictions even in the naming of the form fields. I
</I>&gt;<i> know, security is expensive, I can live with that but I need to allow
</I>&gt;<i> thrusted users to send html content through forms.
</I>&gt;<i>
</I>How are these *trusted* users identified?  By source IP or username or 
something?  Whatever it is, you can configure the rules to be more lenient for 
them or to let them bypass the rules altogether.

&gt;<i> I write in PHP and JSP so I'm looking for an all-inclusive solution (but I
</I>&gt;<i> gived a short look at HTMLpurifier and it seems to me an interesting
</I>&gt;<i> product).
</I>&gt;<i>
</I>&gt;<i> AntiSamy Project is very interesting too! And i will surely take a serious
</I>&gt;<i> look in the future, but right now I need a more immediate solution.
</I>&gt;<i>
</I>&gt;<i> To disable a whole vhost is possible to add SecRuleEngine Off in &lt;Directory
</I>&gt;<i> &gt; but I wont go that far. Is there any whitelist? a list of files who would
</I>&gt;<i> skipped by the security engine ?
</I>&gt;<i>
</I>You can always add whitelist directives to a new 
modsecurity_crs_15_local_exceptions.conf file.  The rules in this file would 
execute before all of the other rules and would allow you to use either the 
ctl:ruleEngine=Off or allow:request actions.  I prefer the latter as it would 
still allow outbound inspection.

Hope this helps.

&gt;<i> Many thanks,
</I>&gt;<i> Fabian
</I>&gt;<i>
</I>&gt;<i> In data marted&#236; 3 novembre 2009 15:41:30, hai scritto:
</I>&gt;<i> &gt; Fabian,
</I>&gt;<i> &gt; This is a CRS issue so for future issues please use the OWASP CRS
</I>&gt;<i> &gt; mail-list
</I>&gt;<i> &gt; (<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i> &gt;) .  I am cross-posting this to both lists.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You bring up an important and challenging issue related to detecting XSS
</I>&gt;<i> &gt;  attacks and that is how to identify malicious payloads while still
</I>&gt;<i> &gt;  allowing benign html conent.  Here are a few items to consider -
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 1) For the CRS v2 - you can add some exception rules to the 48 local
</I>&gt;<i> &gt;  exceptions file so that you can adjust the anomaly score based on the
</I>&gt;<i> &gt;  authorized page/parameter you have for the FCKeditor app, etc...).  If
</I>&gt;<i> &gt; you send some audit log data related to these html posts, I could show
</I>&gt;<i> &gt; you a more specific exception example.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2) What language is your app written in?  If it is php - then you could
</I>&gt;<i> &gt;  look at installing something like htmlpurifier to help weed out bad html
</I>&gt;<i> &gt;  from good html - <A HREF="http://htmlpurifier.org/">http://htmlpurifier.org/</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 3) On a similar front - look at something like the OWASP Anti-Sammy app.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hope this helps,
</I>&gt;<i> &gt; Ryan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ________________________________________
</I>&gt;<i> &gt; From: Fabian Martintoni [<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">assistenza at alfait.org</A>]
</I>&gt;<i> &gt; Sent: Tuesday, November 03, 2009 8:29 AM
</I>&gt;<i> &gt; To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-users at lists.sourceforge.net</A>
</I>&gt;<i> &gt; Subject: [mod-security-users] Posting HTML contents
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Hi all,
</I>&gt;<i> &gt; today I've upgraded modsecurity to 2.5.10-r1 and more than half of my web
</I>&gt;<i> &gt; applications are giving me headache.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The more troublesome issue is (at least for now) that I cannot understand
</I>&gt;<i> &gt;  how I can send HTML contents with a form...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; For example... I have a form with an wysiwyg editor (FCKeditor, TinyMce
</I>&gt;<i> &gt;  etc) how can I allow him to send his data? Every try is blocked by
</I>&gt;<i> &gt;  modsecurity:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; [msg &quot;Detects obfuscated script tags and XML wrapped HTML&quot;]
</I>&gt;<i> &gt; [msg &quot;Detects basic directory traversal&quot;]
</I>&gt;<i> &gt; [msg &quot;finds attribute breaking injections including obfuscated
</I>&gt;<i> &gt; attributes&quot;] [msg &quot;finds html breaking injections including whitespace
</I>&gt;<i> &gt; attacks&quot;] [msg &quot;Detects possibly malicious html elements including some
</I>&gt;<i> &gt; attributes&quot;]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I really need help on this thing, please.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Fabian
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -------------------------------------------------------------------------
</I>&gt;<i> &gt;-- --- Come build with us! The BlackBerry(R) Developer Conference in SF,
</I>&gt;<i> &gt; CA is the only developer event you need to attend this year. Jumpstart
</I>&gt;<i> &gt; your developing skills, take BlackBerry mobile applications to market and
</I>&gt;<i> &gt; stay ahead of the curve. Join us from November 9 - 12, 2009. Register
</I>&gt;<i> &gt; now! <A HREF="http://p.sf.net/sfu/devconference">http://p.sf.net/sfu/devconference</A>
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; mod-security-users mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mod-security-users at lists.sourceforge.net</A>
</I>&gt;<i> &gt; <A HREF="https://lists.sourceforge.net/lists/listinfo/mod-security-users">https://lists.sourceforge.net/lists/listinfo/mod-security-users</A>
</I>&gt;<i> &gt; Commercial ModSecurity Appliances, Rule Sets and Support:
</I>&gt;<i> &gt; <A HREF="http://www.modsecurity.org/breach/index.html">http://www.modsecurity.org/breach/index.html</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091105/8689a43f/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20091105/8689a43f/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000146.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] Posting	HTML contents
</A></li>
	<LI>Next message: <A HREF="000142.html">[Owasp-modsecurity-core-rule-set] Excessive logging in audit.log	and debug.log for modsecurity. How to deal?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#147">[ date ]</a>
              <a href="thread.html#147">[ thread ]</a>
              <a href="subject.html#147">[ subject ]</a>
              <a href="author.html#147">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
