<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] False positive
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20False%20positive&In-Reply-To=5fa90a5a0911250031r64831002he6366608d4e62b9c%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000161.html">
   <LINK REL="Next"  HREF="000162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] False positive</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20False%20positive&In-Reply-To=5fa90a5a0911250031r64831002he6366608d4e62b9c%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] False positive">rcbarnett at gmail.com
       </A><BR>
    <I>Mon Nov 30 16:19:17 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000161.html">[Owasp-modsecurity-core-rule-set] False positive
</A></li>
        <LI>Next message: <A HREF="000162.html">[Owasp-modsecurity-core-rule-set] rule bypass question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#166">[ date ]</a>
              <a href="thread.html#166">[ thread ]</a>
              <a href="subject.html#166">[ subject ]</a>
              <a href="author.html#166">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Per my other email that I just sent out, download CRS v2.0.4 and then add the 
following exception rule to your 48 local exceptions file.

SecRule TX:/^PHPIDS-CONVERTER-COMMENT-EVASION.*ARGS:PASSWD/ &quot;.&quot; 
&quot;chain,phase:2,t:none,nolog,pass,setvar:tx.phpids-comment-evasion-
counter=+1,setvar:tx.phpids-comment-evasion-%{tx.phpids-comment-evasion-
counter}=%{matched_var_name}&quot;
        SecRule TX:'/^PHPIDS-COMMENT-EVASION/' &quot;^TX:(phpids-.*ARGS:PASSWD)$&quot; 
&quot;capture,setvar:!tx.%{tx.1},setvar:tx.anomaly_score=-20&quot;


Basically, the new CRS rules are setting TX variables that hold the important 
meta-data about rule matches (rather then simply directly logging them to the 
error/audit log files).  The exception above will look to see if there are any 
matches for the PHPIDS Comment Evasion rules in the parameter called &quot;PASSWD&quot;.  
If so, it will capture each TX variable data and then expire them in the 2nd 
part of the rule.  It will then correct the anomaly score.  

Let me know if you need any more help.

--
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
<A HREF="http://tacticalwebappsec.blogspot.com">http://tacticalwebappsec.blogspot.com</A>

On Wednesday 25 November 2009 03:31:05 am Superpizza wrote:
&gt;<i> Hi everyone.
</I>&gt;<i> 
</I>&gt;<i>  I'm a bit puzzled on how to handle a false positive
</I>&gt;<i>  for a couple of rules belonging to
</I>&gt;<i>  &quot;Comment Evasion Attempt&quot; ruleset.
</I>&gt;<i>  (in modsecurity_crs_41_phpids_converter.conf)
</I>&gt;<i> 
</I>&gt;<i>  I've got a form taking 2 parameters, say &quot;LOGIN&quot; &amp; &quot;PASSWORD&quot;.
</I>&gt;<i>  If password is set to &quot;---aa---&quot; rules are triggered,
</I>&gt;<i>  and this causes a false positive.
</I>&gt;<i>  If I well understood best practice should be modifying:
</I>&gt;<i>  modsecurity_crs_48_local_exceptions.conf
</I>&gt;<i>  I can't understand how to update this file in order
</I>&gt;<i>  to avoid matching  parameter &quot;PASSWORD&quot; against
</I>&gt;<i>  both of the rules.
</I>&gt;<i> 
</I>&gt;<i>  --7a02be68-C--
</I>&gt;<i>  LOGIN=12345678&amp;PASSWD=---aa---
</I>&gt;<i>  --7a02be68-F--
</I>&gt;<i>  HTTP/1.1 403 Forbidden
</I>&gt;<i>  Last-Modified: Thu, 13 Nov 2008 09:30:44 GMT
</I>&gt;<i> 
</I>&gt;<i>  --7a02be68-H--
</I>&gt;<i>  Message: Pattern match &quot;(?:--[^-]*-)&quot; at REQUEST_BODY. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
</I>&gt;<i>  s_converter.conf&quot;] [line &quot;28&quot;] [msg &quot;Comment Evasion Attempt&quot;] [data
</I>&gt;<i>  &quot;---&quot;] [severity &quot;WARNING&quot;] [tag &quot;WEB_ATTACK/EVASION&quot;]
</I>&gt;<i>  Message: Pattern match &quot;(?:--[^-]*-)&quot; at REQUEST_BODY. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
</I>&gt;<i>  s_converter.conf&quot;] [line &quot;28&quot;] [msg &quot;Comment Evasion Attempt&quot;] [data
</I>&gt;<i>  &quot;---&quot;] [severity &quot;WARNING&quot;] [tag &quot;WEB_ATTACK/EVASION&quot;]
</I>&gt;<i>  Message: Pattern match &quot;(?:--[^-]*-)&quot; at ARGS:PASSWD. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
</I>&gt;<i>  _converter.conf&quot;] [line &quot;28&quot;] [msg &quot;Comment Evasion Attempt&quot;] [data &quot;---&quot;]
</I>&gt;<i>  [severity &quot;WARNING&quot;] [tag &quot;WEB_ATTACK/EVASION&quot;]
</I>&gt;<i>  Message: Pattern match &quot;(?:--[^-]*-)&quot; at REQUEST_BODY. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
</I>&gt;<i>  s_converter.conf&quot;] [line &quot;34&quot;] [msg &quot;Comment Evasion Attempt&quot;] [data
</I>&gt;<i>  &quot;---&quot;] [severity &quot;WARNING&quot;] [tag &quot;WEB_ATTACK/EVASION&quot;]
</I>&gt;<i>  Message: Pattern match &quot;(?:--[^-]*-)&quot; at REQUEST_BODY. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpid
</I>&gt;<i>  s_converter.conf&quot;] [line &quot;34&quot;] [msg &quot;Comment Evasion Attempt&quot;] [data
</I>&gt;<i>  &quot;---&quot;] [severity &quot;WARNING&quot;] [tag &quot;WEB_ATTACK/EVASION&quot;]
</I>&gt;<i>  Message: Pattern match &quot;(?:--[^-]*-)&quot; at ARGS:PASSWD. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_41_phpids
</I>&gt;<i>  _converter.conf&quot;] [line &quot;34&quot;] [msg &quot;Comment Evasion Attempt&quot;] [data &quot;---&quot;]
</I>&gt;<i>  [severity &quot;WARNING&quot;] [tag &quot;WEB_ATTACK/EVASION&quot;]
</I>&gt;<i>  Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file
</I>&gt;<i>  &quot;/usr/local/apache/conf/modsecurity/base_rules/modsecurity_crs_60
</I>&gt;<i>  _correlation.conf&quot;] [line &quot;41&quot;] [msg &quot;Transactional Anomaly Score (score
</I>&gt;<i>   60): Comment Evasion Attempt&quot;]
</I>&gt;<i>  Action: Intercepted (phase 2)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>  Thanks for your help.
</I>&gt;<i> 
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000161.html">[Owasp-modsecurity-core-rule-set] False positive
</A></li>
	<LI>Next message: <A HREF="000162.html">[Owasp-modsecurity-core-rule-set] rule bypass question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#166">[ date ]</a>
              <a href="thread.html#166">[ thread ]</a>
              <a href="subject.html#166">[ subject ]</a>
              <a href="author.html#166">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
