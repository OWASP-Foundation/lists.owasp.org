From christian.folini at netnea.com  Wed Nov  2 06:27:37 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Wed, 2 Nov 2016 07:27:37 +0100
Subject: [Owasp-modsecurity-core-rule-set] Core Rules Tutorial Published
Message-ID: <20161102062737.GA6707@elias>

Dear all,

There has been extensive feedback to the draft version of my 
Core Rules 3.0 tutorial (special thanks to Walter Hop).

So here is the finalised version:
https://www.netnea.com/cms/apache-tutorial-7_including-modsecurity-core-rules/

This is written for OWASP ModSecurity Core Rule Set 3.0.0-rc2.
RC3 should be out anytime now. I will update accordingly and when
the full version comes out (scheduled for November 8), then
I'll update again. The differences between rc2 and rc3 and final
are minimal. You can try this out immediately without worrying about
rules upgrades, etc.

Cheers,

Christian

P.S. There is a Rules Exclusion cheatsheet included in the tutorial.
You should check this out.

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From christian.folini at netnea.com  Thu Nov  3 08:01:52 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 3 Nov 2016 09:01:52 +0100
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity CRS Version 3.0
	RC3 Released
Message-ID: <20161103080152.GA7294@elias>

Dear all,

The 3rd release candidate of the upcoming
OWASP ModSecurity Core Rule Set v3.0.0
has been published.

https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.0-rc3

This is essentially RC2 with 
* more false positives weeded out (Walter Hop + github user
   @shimshon70)
* Added rules to detect Shellshock attack (Walter Hop / RedHat)

We somehow missed out on the shellshock probes / exploits until very
late in our release cycle. RedHat kindly allowed us to re-use their
ModSec rules in CRS, so we added them to the RCE rules.

However, being a "new" group of rules we decided it is better to
issue another RCA. This allows us to do the final release very similar
to the last RC and no surprise with the full release.

So we are still aiming for November 8, 2016, with gold.

FYI: Chaim might start to re-arrange the github repository somewhat
a day or two in advance. You have been warned.

As indicated yesterday, I have updated my CRS tutorial to work with
CRS 3.0.0-rc3:
https://www.netnea.com/cms/apache-tutorial-7_including-modsecurity-core-rules/
I will make sure it is ready for CRS 3.0.0 when it comes out.

I'm also writing an extensive tutorial with practical advice on how
to weed out false positives with a Core Rule Set installation. Hope
I get this over until the release.

Cheers,

Christian Folini

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From CSanders at trustwave.com  Fri Nov  4 13:57:50 2016
From: CSanders at trustwave.com (Chaim Sanders)
Date: Fri, 4 Nov 2016 13:57:50 +0000
Subject: [Owasp-modsecurity-core-rule-set] OWASP CRS Repository Changes
Message-ID: <CY1PR0701MB163197A3EEEEAEA098E9FAA4DBA20@CY1PR0701MB1631.namprd07.prod.outlook.com>

Note: THIS IS EMAIL APPLIES TO OWASP CRS AND NOT MODSECURITY'S REPO.

Ladies and Gentlemen,
Thank you for your continued support and interest of the ModSecurity Project. If you have not heard yet, the free and open source OWASP CRS ruleset has gone through some major updates recently. These updates introduce new features/rules and reduced false positives. Of importance is the culminating OWASP CRS 3.0.0 release (final). We have been diligently testing this ruleset, with your help, and are confident in the stability and interoperability of the upcoming version. Currently, the release is slotted for the 8th of November 2016 (next week). As part of this release we will be reorganizing the CRS repository. What this means is that the current 3.x branch will be promoted to become the 'master' repository. CRS version two, which is currently the 'master' branch, will be assigned the title of v2/master branch title and will still be accessible.  if you have scripts running that make use of any of the branches on OWASP CRS GitHub repository, please make adjustments as needed, you can feel free to reach out to my for more information. We hope this transition goes off without a hitch and we look forward to sharing with you our official release announcement next week!

Chaim Sanders
Security Researcher, SpiderLabs

Trustwave|?SMART SECURITY ON DEMAND
www.trustwave.com

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

From christian.folini at netnea.com  Tue Nov  8 05:30:47 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 8 Nov 2016 06:30:47 +0100
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity CRS Version
 3.0 RC3 Released
In-Reply-To: <20161103080152.GA7294@elias>
References: <20161103080152.GA7294@elias>
Message-ID: <20161108053047.GA28522@elias>

Hello,

On Thu, Nov 03, 2016 at 09:01:52AM +0100, Christian Folini wrote:
> So we are still aiming for November 8, 2016, with gold.

Given the US election today, we decided to shift to Thursday, November
10.

So far, we have zero issues reported with RC3, so it looks like the
rules of the final release would be identical with RC3.

Ahoj,

Christian


-- 
History teaches us that men and nations behave wisely once they have
exhausted all other alternatives.
-- Abba Eban

From christian.folini at netnea.com  Thu Nov 10 16:03:55 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 10 Nov 2016 17:03:55 +0100
Subject: [Owasp-modsecurity-core-rule-set] OWASP ModSecurity Core Rule Set
	Version 3.0.0 Released
Message-ID: <20161110160354.GA8244@elias>

The OWASP ModSecurity Core Rule Set team is excited to announce the
CRS release v3.0.0, short CRS3.

Over 4 years in the making, this release represents a huge step forward
in terms of capabilities, usability and protection. Key features
include:

* Over 90% reduction of false alarms in a default install 
  when compared to CRS2
* A user-defined Paranoia Level to enable additional strict checks
* Application-specific exclusions for WordPress Core and Drupal
* Sampling mode: runs the CRS on a user-defined percentage of traffic
* SQLi/XSS parsing using libinjection embedded in ModSecurity

For a complete list of new features and the changes in this release, see 
the new site of the project
https://modsecurity.org/crs
or the CHANGES document on github
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/CHANGES

CRS3 is the best stable release of the OWASP ModSecurity Core Rule Set.
We advise all users and providers of boxed CRS versions to update their
setups. CRS2 will reach its end of life soon.

CRS3 requires an Apache/IIS/Nginx web server with ModSecurity 2.8.0 or
higher.

Our GitHub repository is the preferred way to download and update CRS:
$> git clone https://github.com/SpiderLabs/owasp-modsecurity-crs.git

For detailed installation instructions, see the INSTALL document.
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/INSTALL

The release is accompanied by a series of tutorials that guide you 
through the 
* Setup of ModSecurity
  https://www.netnea.com/cms/apache-tutorial-6_embedding-modsecurity/
* Inclusion of the CRS
  https://www.netnea.com/cms/apache-tutorial-7_including-modsecurity-core-rules/
* Handling of false positives
  https://www.netnea.com/cms/apache-tutorial-8_handling-false-positives-modsecurity-core-rule-set/

Our desire is to see the Core Rules project as a simple baseline
security feature, effectively fighting OWASP TOP 10 weaknesses with few
side effects. As such we attempted to cut down on false positives as
much as possible in the default install. Of course this must not affect
the detection capabilities of the WAF. We honestly believe that the
default install of CRS3 brings at least the same level of security and
higher paranoia levels let you protect your site even more tightly.

We are very excited about this release. So excited, we want to make it 
into a movie. As a first step, we designed the following poster:
https://modsecurity.org/crs/poster
Please share this link and feel free to print it for your personal use!

Sincerely,

Christian Folini on behalf of Chaim Sanders and Walter Hop
(The Core CRS team, so to say)

-- 
https://modsecurity.org/crs

From heinrichm001 at t-online.de  Tue Nov 15 15:44:15 2016
From: heinrichm001 at t-online.de (Heinrich M.)
Date: Tue, 15 Nov 2016 16:44:15 +0100
Subject: [Owasp-modsecurity-core-rule-set] Issues with CRS3
Message-ID: <8ff92906-9eaa-6c34-0c57-3c35e07de981@t-online.de>

Hi Guys,

thank you for your great work! It is just great that there exists an
open source WAF and a corresponding ruleset! Thank you.

I'm quite new to ModSecurity. Today, I found some time to play around
with ModSecurity and the new CRS release in a basic testing setup. I
hope that I will be able to introduce ModSec and the CRS3 in some small
prod environment soon.

During my first tests, I quickly came across some minor issues with the
CRS3. For reference, that is my setup:

Debian GNU/Linux 8.6 (jessie)
 - Apache/2.4.10 (Debian)
 - ModSecurity for Apache/2.8.0
both installed with apt.

I cloned the CRS from the github repository today
(https://github.com/SpiderLabs/owasp-modsecurity-crs.git), branch
v3.0/master, Commit 90596883aa103599e2aa046181c5bb79b0b6b19c.

Now, here are my issues...

1. Issue
After including the new CRS rule files, apache didn't fire up.
journalctl provided the following error messages:

[...] Syntax error on line 36 of
/etc/modsecurity/owasp-modsecurity-crs/rules/RESPONSE-950-DATA-LEAKAGES.conf:
[...] Error parsing actions: Unknown action: \\

Workaround (I don't know what other effects of this might be...): Adding
a space to line 36 resolved the issue: "t:none, \"

2. Issue
Changing the blocking actions did not work as documented in
RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.
I tried to use the example  "send an error 404" (line 67 and below).
With the two rules activated, blocking dind't work anymore. Removing the
"chain" from the actions made blocking work again. The rules then are as
follows:

SecRuleUpdateActionById 949110 "t:none,deny,status:404"
SecRuleUpdateActionById 959100 "t:none,deny,status:404"


Please take a look at these issues. Not sure if this happens on other
platforms as well or if something is wrong with my configuration or
whatever... If you need additional information, let me know.

Best Regards,

Heinrich


From horizn at wp.pl  Tue Nov 15 16:00:19 2016
From: horizn at wp.pl (kamil kapturkiewicz)
Date: Tue, 15 Nov 2016 17:00:19 +0100
Subject: [Owasp-modsecurity-core-rule-set] Issues with CRS3
Message-ID: <582b31137fd757.00132076@wp.pl>

Hi,

I have exactly the same issue in line 36 on my Debian Jessie. Regarding to point two, I haven't tried.



From christian.folini at netnea.com  Tue Nov 15 16:35:31 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 15 Nov 2016 17:35:31 +0100
Subject: [Owasp-modsecurity-core-rule-set] Issues with CRS3
In-Reply-To: <8ff92906-9eaa-6c34-0c57-3c35e07de981@t-online.de>
References: <8ff92906-9eaa-6c34-0c57-3c35e07de981@t-online.de>
Message-ID: <20161115163531.GA5860@elias>

Hi there,

On Tue, Nov 15, 2016 at 04:44:15PM +0100, Heinrich M. wrote:
> thank you for your great work! It is just great that there exists an
> open source WAF and a corresponding ruleset! Thank you.

You are most welcome. Glad you like it. 

> I'm quite new to ModSecurity. Today, I found some time to play around
> with ModSecurity and the new CRS release in a basic testing setup. I
> hope that I will be able to introduce ModSec and the CRS3 in some small
> prod environment soon.

Please keep us posted about your experience. Us, the dev team has 
years of experience and this is in fact a big problem as we do not
even see the small problems and the many questions that new users
like you face. Your perspective is very valuable.

> 1. Issue
> After including the new CRS rule files, apache didn't fire up.
> journalctl provided the following error messages:
> 
> [...] Syntax error on line 36 of
> /etc/modsecurity/owasp-modsecurity-crs/rules/RESPONSE-950-DATA-LEAKAGES.conf:
> [...] Error parsing actions: Unknown action: \\
> 
> Workaround (I don't know what other effects of this might be...): Adding
> a space to line 36 resolved the issue: "t:none, \"

This is a known issue with older Apache versions. It is documented
in the CRS KNOWN_BUGS file:

>* Apache 2.4 prior to 2.4.11 is affected by a bug in parsing multi-line
>  configuration directives, which causes Apache to fail during startup
>  with an error such as:
>    Error parsing actions: Unknown action: \\
>    Action 'configtest' failed.
> ...
>  We advise to upgrade your Apache version. If upgrading is not possible,
>  we have provided a script in the util/join-multiline-rules directory
>  which converts the rules into a format that works around the bug.
>  You have to re-run this script whenever you modify or update 
>  the CRS rules.

Your workaround works equally well.

> 2. Issue
> Changing the blocking actions did not work as documented in
> RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.
> I tried to use the example  "send an error 404" (line 67 and below).
> With the two rules activated, blocking dind't work anymore. Removing the
> "chain" from the actions made blocking work again. The rules then are as
> follows:
> 
> SecRuleUpdateActionById 949110 "t:none,deny,status:404"
> SecRuleUpdateActionById 959100 "t:none,deny,status:404"

Ooops. I need to take a look at this. I'll be back.

Ahoj,

Christian


-- 
Worst-case thinking encourages society to adopt fear as of one 
of the key principles around which the public, the government 
and various institutions should organise their lives. It 
institutionalises insecurity and fosters a mood of confusion 
and powerlessness. Through popularising the belief that worst
cases are normal, it also encourages people to feel defenceless 
and vulnerable to a wide range of future threats. In all but 
name, it is an invitation to social paralysis.
-- Frank Furedi

From horizn at wp.pl  Tue Nov 15 16:54:52 2016
From: horizn at wp.pl (kamil kapturkiewicz)
Date: Tue, 15 Nov 2016 17:54:52 +0100
Subject: [Owasp-modsecurity-core-rule-set] False positive on rule 920300
Message-ID: <582b3ddc6f1875.33671646@wp.pl>

Hi,
I have had this issue with previous 2.2.9 version, but I am not really sure is related to mod_security it self or to CRS. The problem is with some Windows machines, below is the example from one of our corporate user, who is working on Windows 7 machine. I am pretty sure machine is not infected by malware or something, and this problem occures on FF, Chrome, Opera and IE. But in combination with fail2ban, this cut him off from web server every time he is trying to access company website. Do 
you guys have any idea what is causing this?

[Tue Nov 15 16:26:41.962933 2016] [:error] [pid 31434] [client 213.81.82.201] ModSecurity: Warning. Match of "pm 
AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required. [file "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag "WASCTC/WASC-21"] [tag 
"OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
[Tue Nov 15 16:26:41.963976 2016] [:error] [pid 31434] [client 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern match "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h ..." at REQUEST_COOKIES:OutlookSession. [file 
"/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"] [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within REQUEST_COOKIES:OutlookSession: \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-sqli"] [tag 
"OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
[Tue Nov 15 16:26:44.390517 2016] [:error] [pid 31254] [client 213.81.82.201] ModSecurity: Warning. Match of "pm AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required. [file "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag 
"attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
[Tue Nov 15 16:26:44.391535 2016] [:error] [pid 31254] [client 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern match "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h ..." at REQUEST_COOKIES:OutlookSession. [file 
"/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"] [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within REQUEST_COOKIES:OutlookSession: \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-sqli"] [tag 
"OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]





From pablo.valcarcel1980 at gmail.com  Tue Nov 15 17:23:23 2016
From: pablo.valcarcel1980 at gmail.com (=?UTF-8?Q?Jose_Pablo_Valc=C3=A1rcel_L=C3=A1zaro?=)
Date: Tue, 15 Nov 2016 17:23:23 +0000
Subject: [Owasp-modsecurity-core-rule-set] False positive on rule 920300
In-Reply-To: <582b3ddc6f1875.33671646@wp.pl>
References: <582b3ddc6f1875.33671646@wp.pl>
Message-ID: <CABkhgLpN_eQoydWZc3Sx-G-vQF3nZuFNPx1R36zN9q0dwN29_Q@mail.gmail.com>

Hello.

What I can read from logs is that you have 3 errors:
A) Warning about User-Agent required..normally when you use a browser you
send your User-Agent to the web server:"REQUEST_HEADERS:User-Agent"
required. I'm not sure if that computer is hidding it in someway and that's
the reason of that warning

B)Notice concerning about protocol enforcement: Request Missing an Accept
Header: This is similar to ACK sent by servers when a protocol receives a
client SYN.In http/s you can force for a accept header and modsecurity is
checking it.

C)ModSecurity is detecting several sql injection bypasses:
REQUEST_COOKIES:OutlookSession. [file
"/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
[line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
bypass attempts 2/3"]

The first 2 warnings are not very important, you could whitelist ip for the
2 first rules:
1)REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1251"] [id "920300"]

2)[msg "Request Missing an Accept Header"] [severity "NOTICE"] [ver
"OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"]
[tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag
"OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"]

I'm not completely sure that computer is clean of malware because of third
error:
REQUEST_COOKIES:OutlookSession. [file
"/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
[line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
bypass attempts 2/3"]

It seems that computer is trying to access OWA  (Outlook web access) and it
seems is masking USER-AGENT and ignoring ACCEPT header that many bots like
Spasm sources ignore many protocol rules.

You could whitelist that ip but I would perform malware analysis,  memory
dump and forensic stuff on that computer.

I recently had to format my computer because it was doing connections and I
wasn't able to detect the source with TCP view (Mark Russinovich great
windows tool), netstat and process explorer.

Regards



El mar., 15 de noviembre de 2016 17:59, kamil kapturkiewicz <horizn at wp.pl>
escribi?:

> Hi,
> I have had this issue with previous 2.2.9 version, but I am not really
> sure is related to mod_security it self or to CRS. The problem is with some
> Windows machines, below is the example from one of our corporate user, who
> is working on Windows 7 machine. I am pretty sure machine is not infected
> by malware or something, and this problem occures on FF, Chrome, Opera and
> IE. But in combination with fail2ban, this cut him off from web server
> every time he is trying to access company website. Do
> you guys have any idea what is causing this?
>
> [Tue Nov 15 16:26:41.962933 2016] [:error] [pid 31434] [client
> 213.81.82.201] ModSecurity: Warning. Match of "pm
> AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required. [file
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept
> Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag
> "platform-multi"] [tag "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag
> "WASCTC/WASC-21"] [tag
> "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname "
> domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id
> "WCs3QX8AAQEAAHrKJTMAAAAF"]
> [Tue Nov 15 16:26:41.963976 2016] [:error] [pid 31434] [client
> 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern
> match
> "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h
> ..." at REQUEST_COOKIES:OutlookSession. [file
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
> [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
> bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within
> REQUEST_COOKIES:OutlookSession:
> \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"]
> [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag
> "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> "attack-sqli"] [tag
> "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
> "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag
> "paranoia-level/2"] [hostname "domain.com"] [uri
> "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
> [Tue Nov 15 16:26:44.390517 2016] [:error] [pid 31254] [client
> 213.81.82.201] ModSecurity: Warning. Match of "pm AppleWebKit Android"
> against "REQUEST_HEADERS:User-Agent" required. [file
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept
> Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag
> "platform-multi"] [tag
> "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag
> "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag
> "paranoia-level/2"] [hostname "domain.com"] [uri
> "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> [Tue Nov 15 16:26:44.391535 2016] [:error] [pid 31254] [client
> 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern
> match
> "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h
> ..." at REQUEST_COOKIES:OutlookSession. [file
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
> [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
> bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within
> REQUEST_COOKIES:OutlookSession:
> \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"]
> [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag
> "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> "attack-sqli"] [tag
> "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
> "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag
> "paranoia-level/2"] [hostname "domain.com"] [uri
> "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
>
>
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161115/1a86a768/attachment-0001.html>

From pablo.valcarcel1980 at gmail.com  Tue Nov 15 17:28:53 2016
From: pablo.valcarcel1980 at gmail.com (=?UTF-8?Q?Jose_Pablo_Valc=C3=A1rcel_L=C3=A1zaro?=)
Date: Tue, 15 Nov 2016 17:28:53 +0000
Subject: [Owasp-modsecurity-core-rule-set] Issues with CRS3
In-Reply-To: <20161115163531.GA5860@elias>
References: <8ff92906-9eaa-6c34-0c57-3c35e07de981@t-online.de>
	<20161115163531.GA5860@elias>
Message-ID: <CABkhgLp+LHPeCS5aYimEy2UtrXUmrcsJ4gzHZdBkUsFdiv9ghw@mail.gmail.com>

Hello.

Here there's a example where they use chain:
https://samhobbs.co.uk/2015/09/example-whitelisting-rules-apache-modsecurity-and-owasp-core-rule-set
SecRuleUpdateActionById 981175 "chain,deny,status:501"

Have you tried with chain instead?

Regards

El mar., 15 de noviembre de 2016 17:40, Christian Folini <
christian.folini at netnea.com> escribi?:

> Hi there,
>
> On Tue, Nov 15, 2016 at 04:44:15PM +0100, Heinrich M. wrote:
> > thank you for your great work! It is just great that there exists an
> > open source WAF and a corresponding ruleset! Thank you.
>
> You are most welcome. Glad you like it.
>
> > I'm quite new to ModSecurity. Today, I found some time to play around
> > with ModSecurity and the new CRS release in a basic testing setup. I
> > hope that I will be able to introduce ModSec and the CRS3 in some small
> > prod environment soon.
>
> Please keep us posted about your experience. Us, the dev team has
> years of experience and this is in fact a big problem as we do not
> even see the small problems and the many questions that new users
> like you face. Your perspective is very valuable.
>
> > 1. Issue
> > After including the new CRS rule files, apache didn't fire up.
> > journalctl provided the following error messages:
> >
> > [...] Syntax error on line 36 of
> >
> /etc/modsecurity/owasp-modsecurity-crs/rules/RESPONSE-950-DATA-LEAKAGES.conf:
> > [...] Error parsing actions: Unknown action: \\
> >
> > Workaround (I don't know what other effects of this might be...): Adding
> > a space to line 36 resolved the issue: "t:none, \"
>
> This is a known issue with older Apache versions. It is documented
> in the CRS KNOWN_BUGS file:
>
> >* Apache 2.4 prior to 2.4.11 is affected by a bug in parsing multi-line
> >  configuration directives, which causes Apache to fail during startup
> >  with an error such as:
> >    Error parsing actions: Unknown action: \\
> >    Action 'configtest' failed.
> > ...
> >  We advise to upgrade your Apache version. If upgrading is not possible,
> >  we have provided a script in the util/join-multiline-rules directory
> >  which converts the rules into a format that works around the bug.
> >  You have to re-run this script whenever you modify or update
> >  the CRS rules.
>
> Your workaround works equally well.
>
> > 2. Issue
> > Changing the blocking actions did not work as documented in
> > RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.
> > I tried to use the example  "send an error 404" (line 67 and below).
> > With the two rules activated, blocking dind't work anymore. Removing the
> > "chain" from the actions made blocking work again. The rules then are as
> > follows:
> >
> > SecRuleUpdateActionById 949110 "t:none,deny,status:404"
> > SecRuleUpdateActionById 959100 "t:none,deny,status:404"
>
> Ooops. I need to take a look at this. I'll be back.
>
> Ahoj,
>
> Christian
>
>
> --
> Worst-case thinking encourages society to adopt fear as of one
> of the key principles around which the public, the government
> and various institutions should organise their lives. It
> institutionalises insecurity and fosters a mood of confusion
> and powerlessness. Through popularising the belief that worst
> cases are normal, it also encourages people to feel defenceless
> and vulnerable to a wide range of future threats. In all but
> name, it is an invitation to social paralysis.
> -- Frank Furedi
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161115/fb6c33bc/attachment.html>

From christian.folini at netnea.com  Tue Nov 15 19:40:24 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 15 Nov 2016 20:40:24 +0100
Subject: [Owasp-modsecurity-core-rule-set] False positive on rule 920300
In-Reply-To: <582b3ddc6f1875.33671646@wp.pl>
References: <582b3ddc6f1875.33671646@wp.pl>
Message-ID: <20161115194024.GA8155@elias>

Kamil,

Thanks for reporting.

You are facing the following alerts:

920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass

920300 is usually legitimate and likely points to a client not sending
the accept header like it should. This is a widespread misbehaviour.
That is why we pushed the rule to paranoia level 2. You are apparently
running PL2 or higher. You should thus tune this alert away via a rule
exclusion.

The 942260 is likely also legitimate. It's just that your poor client
has a session cookie smelling of SQL authentication bypass. You
should exclude the said cookie from the list of parameters examined
by 942260.

My tutorials at https://www.netnea.com/cms/apache-tutorials give 
you detailed step by step instructions how to do this.

Best,

Christian



On Tue, Nov 15, 2016 at 05:54:52PM +0100, kamil kapturkiewicz wrote:
> Hi,
> I have had this issue with previous 2.2.9 version, but I am not really sure is related to mod_security it self or to CRS. The problem is with some Windows machines, below is the example from one of our corporate user, who is working on Windows 7 machine. I am pretty sure machine is not infected by malware or something, and this problem occures on FF, Chrome, Opera and IE. But in combination with fail2ban, this cut him off from web server every time he is trying to access company website. Do 
> you guys have any idea what is causing this?
> 
> [Tue Nov 15 16:26:41.962933 2016] [:error] [pid 31434] [client 213.81.82.201] ModSecurity: Warning. Match of "pm 
> AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required. [file "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag "WASCTC/WASC-21"] [tag 
> "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
> [Tue Nov 15 16:26:41.963976 2016] [:error] [pid 31434] [client 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern match "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h ..." at REQUEST_COOKIES:OutlookSession. [file 
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"] [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within REQUEST_COOKIES:OutlookSession: \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-sqli"] [tag 
> "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
> [Tue Nov 15 16:26:44.390517 2016] [:error] [pid 31254] [client 213.81.82.201] ModSecurity: Warning. Match of "pm AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required. [file "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag 
> "attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> [Tue Nov 15 16:26:44.391535 2016] [:error] [pid 31254] [client 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern match "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h ..." at REQUEST_COOKIES:OutlookSession. [file 
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"] [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within REQUEST_COOKIES:OutlookSession: \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-sqli"] [tag 
> "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag "paranoia-level/2"] [hostname "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> 
> 
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From pablo.valcarcel1980 at gmail.com  Tue Nov 15 19:53:52 2016
From: pablo.valcarcel1980 at gmail.com (=?UTF-8?Q?Jose_Pablo_Valc=C3=A1rcel_L=C3=A1zaro?=)
Date: Tue, 15 Nov 2016 19:53:52 +0000
Subject: [Owasp-modsecurity-core-rule-set] False positive on rule 920300
In-Reply-To: <20161115194024.GA8155@elias>
References: <582b3ddc6f1875.33671646@wp.pl> <20161115194024.GA8155@elias>
Message-ID: <CABkhgLo7r61Z_uS8Qj=1BUijLLZmm7ukob6xUCweRV+HFt_VpQ@mail.gmail.com>

Sorry Christian. I didn't look in your tutorial CRS3:

152 x 942260 Detects basic SQL authentication bypass attempts 2/3
-----------------------------------------------------------------
      # ModSec Rule Exclusion: 942260 : Detects basic SQL authentication
bypass attempts 2/3
      SecRule REQUEST_URI "@beginsWith /drupal/index.php/search/node"
"phase:2,nolog,pass,id:10003,ctl:ruleRemoveTargetById=942260;ARGS:keys"

Regards

El mar., 15 de noviembre de 2016 20:44, Christian Folini <
christian.folini at netnea.com> escribi?:

> Kamil,
>
> Thanks for reporting.
>
> You are facing the following alerts:
>
> 920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
> 920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
> 942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
> 942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
>
> 920300 is usually legitimate and likely points to a client not sending
> the accept header like it should. This is a widespread misbehaviour.
> That is why we pushed the rule to paranoia level 2. You are apparently
> running PL2 or higher. You should thus tune this alert away via a rule
> exclusion.
>
> The 942260 is likely also legitimate. It's just that your poor client
> has a session cookie smelling of SQL authentication bypass. You
> should exclude the said cookie from the list of parameters examined
> by 942260.
>
> My tutorials at https://www.netnea.com/cms/apache-tutorials give
> you detailed step by step instructions how to do this.
>
> Best,
>
> Christian
>
>
>
> On Tue, Nov 15, 2016 at 05:54:52PM +0100, kamil kapturkiewicz wrote:
> > Hi,
> > I have had this issue with previous 2.2.9 version, but I am not really
> sure is related to mod_security it self or to CRS. The problem is with some
> Windows machines, below is the example from one of our corporate user, who
> is working on Windows 7 machine. I am pretty sure machine is not infected
> by malware or something, and this problem occures on FF, Chrome, Opera and
> IE. But in combination with fail2ban, this cut him off from web server
> every time he is trying to access company website. Do
> > you guys have any idea what is causing this?
> >
> > [Tue Nov 15 16:26:41.962933 2016] [:error] [pid 31434] [client
> 213.81.82.201] ModSecurity: Warning. Match of "pm
> > AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required.
> [file
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept
> Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag
> "platform-multi"] [tag "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag
> "WASCTC/WASC-21"] [tag
> > "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname
> "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id
> "WCs3QX8AAQEAAHrKJTMAAAAF"]
> > [Tue Nov 15 16:26:41.963976 2016] [:error] [pid 31434] [client
> 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern
> match
> "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h
> ..." at REQUEST_COOKIES:OutlookSession. [file
> >
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
> [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
> bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within
> REQUEST_COOKIES:OutlookSession:
> \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"]
> [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag
> "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> "attack-sqli"] [tag
> > "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
> "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag
> "paranoia-level/2"] [hostname "domain.com"] [uri
> "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
> > [Tue Nov 15 16:26:44.390517 2016] [:error] [pid 31254] [client
> 213.81.82.201] ModSecurity: Warning. Match of "pm AppleWebKit Android"
> against "REQUEST_HEADERS:User-Agent" required. [file
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept
> Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag
> "platform-multi"] [tag
> > "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag
> "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag
> "paranoia-level/2"] [hostname "domain.com"] [uri
> "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> > [Tue Nov 15 16:26:44.391535 2016] [:error] [pid 31254] [client
> 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern
> match
> "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h
> ..." at REQUEST_COOKIES:OutlookSession. [file
> >
> "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
> [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
> bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within
> REQUEST_COOKIES:OutlookSession:
> \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"]
> [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag
> "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> "attack-sqli"] [tag
> > "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
> "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag
> "paranoia-level/2"] [hostname "domain.com"] [uri
> "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> >
> >
> >
> >
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161115/79efeff5/attachment-0001.html>

From christian.folini at netnea.com  Tue Nov 15 21:38:04 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 15 Nov 2016 22:38:04 +0100
Subject: [Owasp-modsecurity-core-rule-set] False positive on rule 920300
In-Reply-To: <CABkhgLo7r61Z_uS8Qj=1BUijLLZmm7ukob6xUCweRV+HFt_VpQ@mail.gmail.com>
References: <582b3ddc6f1875.33671646@wp.pl> <20161115194024.GA8155@elias>
	<CABkhgLo7r61Z_uS8Qj=1BUijLLZmm7ukob6xUCweRV+HFt_VpQ@mail.gmail.com>
Message-ID: <20161115213804.GA15494@elias>

On Tue, Nov 15, 2016 at 07:53:52PM +0000, Jose Pablo Valc?rcel L?zaro wrote:
> Sorry Christian. I didn't look in your tutorial CRS3:
> 
> 152 x 942260 Detects basic SQL authentication bypass attempts 2/3
> -----------------------------------------------------------------
>       # ModSec Rule Exclusion: 942260 : Detects basic SQL authentication
> bypass attempts 2/3
>       SecRule REQUEST_URI "@beginsWith /drupal/index.php/search/node"
> "phase:2,nolog,pass,id:10003,ctl:ruleRemoveTargetById=942260;ARGS:keys"

Nevermind. ;)

And the fact, that my tutorial works with the same rule
is a pure coincidence.

Ahoj,

Christian


> 
> Regards
> 
> El mar., 15 de noviembre de 2016 20:44, Christian Folini <
> christian.folini at netnea.com> escribi?:
> 
> > Kamil,
> >
> > Thanks for reporting.
> >
> > You are facing the following alerts:
> >
> > 920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
> > 920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
> > 942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
> > 942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
> >
> > 920300 is usually legitimate and likely points to a client not sending
> > the accept header like it should. This is a widespread misbehaviour.
> > That is why we pushed the rule to paranoia level 2. You are apparently
> > running PL2 or higher. You should thus tune this alert away via a rule
> > exclusion.
> >
> > The 942260 is likely also legitimate. It's just that your poor client
> > has a session cookie smelling of SQL authentication bypass. You
> > should exclude the said cookie from the list of parameters examined
> > by 942260.
> >
> > My tutorials at https://www.netnea.com/cms/apache-tutorials give
> > you detailed step by step instructions how to do this.
> >
> > Best,
> >
> > Christian
> >
> >
> >
> > On Tue, Nov 15, 2016 at 05:54:52PM +0100, kamil kapturkiewicz wrote:
> > > Hi,
> > > I have had this issue with previous 2.2.9 version, but I am not really
> > sure is related to mod_security it self or to CRS. The problem is with some
> > Windows machines, below is the example from one of our corporate user, who
> > is working on Windows 7 machine. I am pretty sure machine is not infected
> > by malware or something, and this problem occures on FF, Chrome, Opera and
> > IE. But in combination with fail2ban, this cut him off from web server
> > every time he is trying to access company website. Do
> > > you guys have any idea what is causing this?
> > >
> > > [Tue Nov 15 16:26:41.962933 2016] [:error] [pid 31434] [client
> > 213.81.82.201] ModSecurity: Warning. Match of "pm
> > > AppleWebKit Android" against "REQUEST_HEADERS:User-Agent" required.
> > [file
> > "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> > [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept
> > Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> > [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag
> > "platform-multi"] [tag "attack-protocol"] [tag
> > "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag
> > "WASCTC/WASC-21"] [tag
> > > "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag "paranoia-level/2"] [hostname
> > "domain.com"] [uri "/autodiscover/autodiscover.xml"] [unique_id
> > "WCs3QX8AAQEAAHrKJTMAAAAF"]
> > > [Tue Nov 15 16:26:41.963976 2016] [:error] [pid 31434] [client
> > 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern
> > match
> > "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h
> > ..." at REQUEST_COOKIES:OutlookSession. [file
> > >
> > "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
> > [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
> > bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within
> > REQUEST_COOKIES:OutlookSession:
> > \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"]
> > [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag
> > "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> > "attack-sqli"] [tag
> > > "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
> > "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag
> > "paranoia-level/2"] [hostname "domain.com"] [uri
> > "/autodiscover/autodiscover.xml"] [unique_id "WCs3QX8AAQEAAHrKJTMAAAAF"]
> > > [Tue Nov 15 16:26:44.390517 2016] [:error] [pid 31254] [client
> > 213.81.82.201] ModSecurity: Warning. Match of "pm AppleWebKit Android"
> > against "REQUEST_HEADERS:User-Agent" required. [file
> > "/usr/share/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]
> > [line "1251"] [id "920300"] [rev "3"] [msg "Request Missing an Accept
> > Header"] [severity "NOTICE"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> > [accuracy "8"] [tag "application-multi"] [tag "language-multi"] [tag
> > "platform-multi"] [tag
> > > "attack-protocol"] [tag
> > "OWASP_CRS/PROTOCOL_VIOLATION/MISSING_HEADER_ACCEPT"] [tag
> > "WASCTC/WASC-21"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"] [tag
> > "paranoia-level/2"] [hostname "domain.com"] [uri
> > "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> > > [Tue Nov 15 16:26:44.391535 2016] [:error] [pid 31254] [client
> > 213.81.82.201] ModSecurity: Access denied with code 403 (phase 2). Pattern
> > match
> > "(?i:(?:union\\\\s*?(?:all|distinct|[(!@]*?)?\\\\s*?[([]*?\\\\s*?select\\\\s+)|(?:\\\\w+\\\\s+like\\\\s+[\\"'`])|(?:like\\\\s*?[\\"'`]\\\\%)|(?:[\\"'`]\\\\s*?like\\\\W*?[\\"'`\\\\d])|(?:[\\"'`]\\\\s*?(?:n?and|x?x?or|div|like|between|and|not|\\\\|\\\\||\\\\&\\\\&)\\\\s+[\\\\s\\\\w]+=\\\\s*?\\\\w+\\\\s*?h
> > ..." at REQUEST_COOKIES:OutlookSession. [file
> > >
> > "/usr/share/owasp-modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf"]
> > [line "705"] [id "942260"] [rev "2"] [msg "Detects basic SQL authentication
> > bypass attempts 2/3"] [data "Matched Data: \\x22{BB1B2590-E found within
> > REQUEST_COOKIES:OutlookSession:
> > \\x22{BB1B2590-EEE9-451E-9ABD-B75491F282EE}\\x22"] [severity "CRITICAL"]
> > [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag
> > "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> > "attack-sqli"] [tag
> > > "OWASP_CRS/WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag
> > "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"] [tag
> > "paranoia-level/2"] [hostname "domain.com"] [uri
> > "/autodiscover/autodiscover.xml"] [unique_id "WCs3RH8AAQEAAHoWjIUAAAAD"]
> > >
> > >
> > >
> > >
> > > _______________________________________________
> > > Owasp-modsecurity-core-rule-set mailing list
> > > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From horizn at wp.pl  Wed Nov 16 14:34:28 2016
From: horizn at wp.pl (kamil kapturkiewicz)
Date: Wed, 16 Nov 2016 15:34:28 +0100
Subject: [Owasp-modsecurity-core-rule-set] Odp: Re: False positive on rule
 920300
Message-ID: <582c6e74e86c21.69408575@wp.pl>

Thanks Christian, and your tutorials are very helpful.

Dnia Wtorek, 15 Listopada 2016 20:40 Christian Folini <christian.folini at netnea.com> napisa?(a) 
> Kamil,
> 
> Thanks for reporting.
> 
> You are facing the following alerts:
> 
> 920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
> 920300 REQUEST_HEADERS:User-Agent     Request Missing an Accept Header
> 942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
> 942260 REQUEST_COOKIES:OutlookSession Detects basic SQL auth bypass
> 
> 920300 is usually legitimate and likely points to a client not sending
> the accept header like it should. This is a widespread misbehaviour.
> That is why we pushed the rule to paranoia level 2. You are apparently
> running PL2 or higher. You should thus tune this alert away via a rule
> exclusion.
> 
> The 942260 is likely also legitimate. It's just that your poor client
> has a session cookie smelling of SQL authentication bypass. You
> should exclude the said cookie from the list of parameters examined
> by 942260.
> 
> My tutorials at https://www.netnea.com/cms/apache-tutorials give 
> you detailed step by step instructions how to do this.
> 
> Best,
> 
> Christian
> 
> 




From jhfranz at gleisnetze.de  Wed Nov 16 14:57:24 2016
From: jhfranz at gleisnetze.de (=?utf-8?Q?J=2E_Franz?=)
Date: Wed, 16 Nov 2016 15:57:24 +0100
Subject: [Owasp-modsecurity-core-rule-set] CSR 3.0
Message-ID: <zarafa.582c73d4.64bb.7f9b116b2372ae3f@prime>

As a dissatisfied MODSEC user with the older CRS, I have waited very much for the new 3 Series CRS. Finally there was then of course a changeover necessary. The big log files seemed to me very difficult. After all, the CRS 3.0 ran for the most part without affecting my website. But some adjustment was necessary (Dispora and gnusocial). Then I have the brilliant documentation at https://www.netnea.com/ helped. Here are fortunately also instructions in German and the whole is also superstructured. You can choose the entrance depth yourself and, if necessary, switch to the more up-to-date English texts. There is a lot of fun. Within a short time all my services went back clean. Very detailed tuition is obtained when the evaluations and preparations are made to have the right working basis. As I said: do not be frightened because it is fun and the instructions motivated also super ...



Best regards JH Germany Saxony



Als unzufriedener MODSEC Anwender mit den ?lteren CRS habe ich sehr auf die neuen 3er CRS gewartet. Endlich da war dann nat?rlich etwas Umstellung n?tig. Sehr schwer schienen mir die gro?en Logdateien. Immerhin liefen die CRS 3.0 erstmal weitgehend ohne Beeintr?chtigungen meiner Webseite. Aber etwas Anpassung war doch n?tig (Dispora und gnusocial). Dabei hat mir dann die geniale Doku auf https://www.netnea.com/ geholfen. Hier sind gl?cklicherweise auch Anleitungen in Deutsch vorhanden und das Ganze ist auch super strukturiert. Man kann sich die Einstiegstiefe selbst w?hlen und bei Bedarf auf die aktuelleren englischen Texte umsteigen. Da macht die ganze Logerei m?chtig Spa?. Innerhalb von kurzer Zeit liefen meine ganzen Severdienste wieder sauber. Sehr ausf?hrliche Nachhilfe bekommt man bei Erstellen der Auswertungen und Aufbereitungen um die richtigen Arbeitsgrundlagen zu haben. Wie gesagt: lasst Euch nicht abschrecken denn es macht Spa? und die Anleitung motiviert auch super...




-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161116/b428ea39/attachment.html>

From heinrichm001 at t-online.de  Thu Nov 17 13:06:11 2016
From: heinrichm001 at t-online.de (Heinrich M.)
Date: Thu, 17 Nov 2016 14:06:11 +0100
Subject: [Owasp-modsecurity-core-rule-set] Issues with CRS3
In-Reply-To: <CABkhgLp+LHPeCS5aYimEy2UtrXUmrcsJ4gzHZdBkUsFdiv9ghw@mail.gmail.com>
References: <8ff92906-9eaa-6c34-0c57-3c35e07de981@t-online.de>
	<20161115163531.GA5860@elias>
	<CABkhgLp+LHPeCS5aYimEy2UtrXUmrcsJ4gzHZdBkUsFdiv9ghw@mail.gmail.com>
Message-ID: <1479387971.32413.2.camel@t-online.de>

Hi,

Christian confirmed that this is a bug. He opened an issue on github:

https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/648

Regards,

Heinrich

Am Dienstag, den 15.11.2016, 17:28 +0000 schrieb Jose Pablo Valc?rcel
L?zaro:
> Hello.
> 
> Here there's a example where they use chain:
> https://samhobbs.co.uk/2015/09/example-whitelisting-rules-apache-mods
> ecurity-and-owasp-core-rule-set
> SecRuleUpdateActionById 981175 "chain,deny,status:501"
> 
> Have you tried with chain instead?
> 
> Regards
> 
> El mar., 15 de noviembre de 2016 17:40, Christian Folini <
> christian.folini at netnea.com> escribi?:
> 
> > 
> > Hi there,
> > 
> > On Tue, Nov 15, 2016 at 04:44:15PM +0100, Heinrich M. wrote:
> > > 
> > > thank you for your great work! It is just great that there exists
> > > an
> > > open source WAF and a corresponding ruleset! Thank you.
> > You are most welcome. Glad you like it.
> > 
> > > 
> > > I'm quite new to ModSecurity. Today, I found some time to play
> > > around
> > > with ModSecurity and the new CRS release in a basic testing
> > > setup. I
> > > hope that I will be able to introduce ModSec and the CRS3 in some
> > > small
> > > prod environment soon.
> > Please keep us posted about your experience. Us, the dev team has
> > years of experience and this is in fact a big problem as we do not
> > even see the small problems and the many questions that new users
> > like you face. Your perspective is very valuable.
> > 
> > > 
> > > 1. Issue
> > > After including the new CRS rule files, apache didn't fire up.
> > > journalctl provided the following error messages:
> > > 
> > > [...] Syntax error on line 36 of
> > > 
> > /etc/modsecurity/owasp-modsecurity-crs/rules/RESPONSE-950-DATA-
> > LEAKAGES.conf:
> > > 
> > > [...] Error parsing actions: Unknown action: \\
> > > 
> > > Workaround (I don't know what other effects of this might be...):
> > > Adding
> > > a space to line 36 resolved the issue: "t:none, \"
> > This is a known issue with older Apache versions. It is documented
> > in the CRS KNOWN_BUGS file:
> > 
> > > 
> > > * Apache 2.4 prior to 2.4.11 is affected by a bug in parsing
> > > multi-line
> > > ?configuration directives, which causes Apache to fail during
> > > startup
> > > ?with an error such as:
> > > ???Error parsing actions: Unknown action: \\
> > > ???Action 'configtest' failed.
> > > ...
> > > ?We advise to upgrade your Apache version. If upgrading is not
> > > possible,
> > > ?we have provided a script in the util/join-multiline-rules
> > > directory
> > > ?which converts the rules into a format that works around the
> > > bug.
> > > ?You have to re-run this script whenever you modify or update
> > > ?the CRS rules.
> > Your workaround works equally well.
> > 
> > > 
> > > 2. Issue
> > > Changing the blocking actions did not work as documented in
> > > RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.
> > > I tried to use the example??"send an error 404" (line 67 and
> > > below).
> > > With the two rules activated, blocking dind't work anymore.
> > > Removing the
> > > "chain" from the actions made blocking work again. The rules then
> > > are as
> > > follows:
> > > 
> > > SecRuleUpdateActionById 949110 "t:none,deny,status:404"
> > > SecRuleUpdateActionById 959100 "t:none,deny,status:404"
> > Ooops. I need to take a look at this. I'll be back.
> > 
> > Ahoj,
> > 
> > Christian
> > 
> > 
> > --
> > Worst-case thinking encourages society to adopt fear as of one
> > of the key principles around which the public, the government
> > and various institutions should organise their lives. It
> > institutionalises insecurity and fosters a mood of confusion
> > and powerlessness. Through popularising the belief that worst
> > cases are normal, it also encourages people to feel defenceless
> > and vulnerable to a wide range of future threats. In all but
> > name, it is an invitation to social paralysis.
> > -- Frank Furedi
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rul
> > e-set
> > 

From heinrichm001 at t-online.de  Thu Nov 17 13:27:14 2016
From: heinrichm001 at t-online.de (Heinrich M.)
Date: Thu, 17 Nov 2016 14:27:14 +0100
Subject: [Owasp-modsecurity-core-rule-set] Missing Component Signature /
	Version Information in Blocking Rules
Message-ID: <1479389234.32413.8.camel@t-online.de>

Hi,

while playing around with the rule set and adding some custom rules, I
found that the blocking rules miss the version tag within Apache's
error log. Is there a reason for this? As fas as I could see, every
other rule is tagged with [ver "OWASP_CRS/3.0.0"] but I may be missing
something.?

I'd like to grep for '[ver "OWASP_CRS/3.0.0"]' in order to separate log
entries from custom rules from the CRS rules. I know that this can also
be done by rule IDs but those regexes are hard ;-).

Regards,

Heinrich

From christian.folini at netnea.com  Fri Nov 18 15:06:57 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 18 Nov 2016 16:06:57 +0100
Subject: [Owasp-modsecurity-core-rule-set] Missing Component Signature /
 Version Information in Blocking Rules
In-Reply-To: <1479389234.32413.8.camel@t-online.de>
References: <1479389234.32413.8.camel@t-online.de>
Message-ID: <20161118150657.GA4193@elias>

Hello Heinrich,

Another well spotted bug. Thank you. It's funny how a new pair of eyes
spots bugs in corners ignored by experienced users.

The support for the "ver" action is only partial. In fact there are
more than only the blocking rules that come without the "ver" action.

I have opened a bug report for this issue:
https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/650

I flagged it for CRS 3.1.0. There is a chance, this will be made
available for 3.0.1, but I doubt it as it's quite a bit of work
and not crucial for the correct functioning of the rule set.

In your situation, you are best off with the following construct
including the mandaory regular expression : Note how the CRS rules
are all in the 900K range, but we lately claimed the 9M range too;
hence {5,6}.

$> cat error.log | egrep "id \"9[0-9]{5,6}\""

Keep these bug reports coming, please.

Best,

Christian



On Thu, Nov 17, 2016 at 02:27:14PM +0100, Heinrich M. wrote:
> Hi,
> 
> while playing around with the rule set and adding some custom rules, I
> found that the blocking rules miss the version tag within Apache's
> error log. Is there a reason for this? As fas as I could see, every
> other rule is tagged with [ver "OWASP_CRS/3.0.0"] but I may be missing
> something.?
> 
> I'd like to grep for '[ver "OWASP_CRS/3.0.0"]' in order to separate log
> entries from custom rules from the CRS rules. I know that this can also
> be done by rule IDs but those regexes are hard ;-).
> 
> Regards,
> 
> Heinrich
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From christian.folini at netnea.com  Sun Nov 20 09:06:51 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Sun, 20 Nov 2016 10:06:51 +0100
Subject: [Owasp-modsecurity-core-rule-set] Issues with CRS3
In-Reply-To: <1479387971.32413.2.camel@t-online.de>
References: <8ff92906-9eaa-6c34-0c57-3c35e07de981@t-online.de>
	<20161115163531.GA5860@elias>
	<CABkhgLp+LHPeCS5aYimEy2UtrXUmrcsJ4gzHZdBkUsFdiv9ghw@mail.gmail.com>
	<1479387971.32413.2.camel@t-online.de>
Message-ID: <20161120090651.GA16295@elias>

On Thu, Nov 17, 2016 at 02:06:11PM +0100, Heinrich M. wrote:
> Hi,
> 
> Christian confirmed that this is a bug. He opened an issue on github:
> 
> https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/648

Chaim did a pull request to solve this issue. 

https://github.com/SpiderLabs/owasp-modsecurity-crs/pull/649

We just merged this into the v3.0/dev branch.

In fact we have 2 v3.0 branches:
 - v3.0/master
 - v3.0/dev

The idea is to continually update v3.0/dev and then sync to v3.0/master
before a point release.

Cheers,

Christian


-- 
When people feel uncertain, they'd rather have somebody that's strong 
and wrong than somebody who's weak and right.
-- Bill Clinton

From christian.folini at netnea.com  Thu Nov 24 06:44:03 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 24 Nov 2016 07:44:03 +0100
Subject: [Owasp-modsecurity-core-rule-set] News from the Core Rules
	(2016-11-24)
Message-ID: <20161124064403.GA23815@elias>

Hi there,

CRS3 has been released two weeks ago. Time for a status update.

We had a successful release with people enjoying the poster, a few
blog posts about the release, a successful reddit thread and eventually
we even hit Slashdot:

https://xiom.com/2016/11/13/anniversary-to-the-modsecurity-core-rule-set-celebrated-with-a-new-major-release/
https://www.reddit.com/r/netsec/comments/5c8wae/owasp_modsecurity_core_rule_set_version_300/
https://news.slashdot.org/story/16/11/12/1918229/owasp-modsecurity-core-rule-set-version-30-released

We are also seeing 50-100 visitors on the tutorials per day and I
have followed up with a guide on how to secure Drupal with ModSecurity
yesterday.

https://github.com/SpiderLabs/owasp-modsecurity-crs/labels/v3.0-dev%20Development

Still in the queue is an article on Linux Weekly News which will 
give an introduction into the project and an overview of the new
features in CRS3.

We have fixed a bug in the comments / recommendations in the rule files
and we are working on a handful of false positives:

https://github.com/SpiderLabs/owasp-modsecurity-crs/labels/v3.0-dev%20Development

Namely the occurrence of semicolons in filenames (html encoding!)
is quite nasty as the semicolon is a very powerful character in attacks
and it usually serves as an indicator something bad is happening.

The other false positives we heard of are a bit less problematic. 

We are certainly relieved that, there has not been an avalanche
of new false positives being reported. So far, we are able to manage.

We are looking into fixing the open issues with false positives and do a
3.0.1 release eventually. The idea is to do maintenance and security
releases on the 3.0 release tree (mainly fixing false positives), while
new features will go into 3.1-dev.

We have also started to clean up the issues on github. About 30 of them
disappeared. 
We still have 13 older issues that we would like to tackle:
https://github.com/SpiderLabs/owasp-modsecurity-crs/issues?utf8=%E2%9C%93&q=is%3Aissue%20is%3Aopen%20no%3Alabel%20
And then of course 58 ideas of what might go into 3.1.
https://github.com/SpiderLabs/owasp-modsecurity-crs/labels/v3.1.0-rc1%20Candidate%20Issue

So even if we have 83 open issues, only 20 or so of them are really
relevant as of now. The rest is feature requests / ideas.

If you are interested you can go to github and chime in on the
discussion of the new features. What is interesting to you, what
does not have any merit and what other features are you missing?
Please add your comments on github.

Helping to fix the other issues is highly welcome too. Especially
LDAP knowledge is needed with two of the older issues. I am afraid
fixing those might lead to false positives unless we really know
what we are doing (and I don't).


Finally, in order to see the CRS spread wide and wider, we need
success stories. That is reports and blog posts of people successfully
using CRS3 on their servers. I am willing to send printed copies
of the release poster to anyone posting a good report as a gimmick
or thank you.

Cheers,

Christian

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From heinrichm001 at t-online.de  Thu Nov 24 06:46:46 2016
From: heinrichm001 at t-online.de (Heinrich M.)
Date: Thu, 24 Nov 2016 07:46:46 +0100
Subject: [Owasp-modsecurity-core-rule-set] Missing Component Signature /
 Version Information in Blocking Rules
In-Reply-To: <20161118150657.GA4193@elias>
References: <1479389234.32413.8.camel@t-online.de>
	<20161118150657.GA4193@elias>
Message-ID: <1479970006.3174.5.camel@t-online.de>

Hi Christian,

thank you for the information and the grep command :-).?

After dealing with some other problems the last days, I'm back to
ModSec today. I will report everything I encounter.

Regards,

Heinrich

P.S. Going to switch to 3.0/dev for further testing.


Am Freitag, den 18.11.2016, 16:06 +0100 schrieb Christian Folini:
> Hello Heinrich,
> 
> Another well spotted bug. Thank you. It's funny how a new pair of
> eyes
> spots bugs in corners ignored by experienced users.
> 
> The support for the "ver" action is only partial. In fact there are
> more than only the blocking rules that come without the "ver" action.
> 
> I have opened a bug report for this issue:
> https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/650
> 
> I flagged it for CRS 3.1.0. There is a chance, this will be made
> available for 3.0.1, but I doubt it as it's quite a bit of work
> and not crucial for the correct functioning of the rule set.
> 
> In your situation, you are best off with the following construct
> including the mandaory regular expression : Note how the CRS rules
> are all in the 900K range, but we lately claimed the 9M range too;
> hence {5,6}.
> 
> $> cat error.log | egrep "id \"9[0-9]{5,6}\""
> 
> Keep these bug reports coming, please.
> 
> Best,
> 
> Christian
> 
> 
> 
> On Thu, Nov 17, 2016 at 02:27:14PM +0100, Heinrich M. wrote:
> > 
> > Hi,
> > 
> > while playing around with the rule set and adding some custom
> > rules, I
> > found that the blocking rules miss the version tag within Apache's
> > error log. Is there a reason for this? As fas as I could see, every
> > other rule is tagged with [ver "OWASP_CRS/3.0.0"] but I may be
> > missing
> > something.?
> > 
> > I'd like to grep for '[ver "OWASP_CRS/3.0.0"]' in order to separate
> > log
> > entries from custom rules from the CRS rules. I know that this can
> > also
> > be done by rule IDs but those regexes are hard ;-).
> > 
> > Regards,
> > 
> > Heinrich
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rul
> > e-set

From mase at partycrew-united.de  Thu Nov 24 15:19:50 2016
From: mase at partycrew-united.de (Muenz, Michael)
Date: Thu, 24 Nov 2016 16:19:50 +0100
Subject: [Owasp-modsecurity-core-rule-set] No rule-id in audit/error log
	with Nginx und MS3/CRS3
Message-ID: <34e3ebbe-5fc6-6b10-bcc6-5731a516e776@partycrew-united.de>

Hey guys,


I've successfully compiled the latest source of ModSecurity, 
ModSecurity-nginx and Nginx (community).
When I include CRS with default setup and open a test URL like:

http://localhost/?s=../../../../../etc/passwd

I receive a 403 and a log in the audit log.
With apache (and CRS2) there was a line in the error log with the 
complaining rule ID.

Now I'm wondering if I would hit a false positive, how to exclude the ID 
when there's nothing logged?

Is this a bug of CRS, or MS3, or MS3 AND Nginx?

Thanks,
Michael


From christian.folini at netnea.com  Thu Nov 24 15:59:36 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 24 Nov 2016 16:59:36 +0100
Subject: [Owasp-modsecurity-core-rule-set] No rule-id in audit/error log
 with Nginx und MS3/CRS3
In-Reply-To: <897dccfa-0dda-1a8b-d4a0-526b0728072b@partycrew-united.de>
References: <34e3ebbe-5fc6-6b10-bcc6-5731a516e776@partycrew-united.de>
	<20161124152748.GA13362@elias>
	<897dccfa-0dda-1a8b-d4a0-526b0728072b@partycrew-united.de>
Message-ID: <20161124155936.GA19862@elias>

On Thu, Nov 24, 2016 at 04:41:49PM +0100, Muenz, Michael wrote:
> Did you reply to the list or PN? :)

Maybe I made a mistake. The idea was to respond via the list.
Doing that now.

> I'm not quite sure if it's nginx itself, I'm a bit new to it.
> 
> This is the auditlog:
> 
> ---CMTQD8zC---A--
> [24/Nov/2016:16:39:45 +0100] 148000198565.715452 XXX
> ---CMTQD8zC---B--
> GET /?s=../../../../etc/passwd HTTP/1.1
> REQUEST_HEADERS:Host: XXX
> REQUEST_HEADERS:Connection: keep-alive
> REQUEST_HEADERS:Upgrade-Insecure-Requests: 1
> REQUEST_HEADERS:User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64;
> x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99
> Safari/537.36
> REQUEST_HEADERS:Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
> REQUEST_HEADERS:Accept-Encoding: gzip, deflate, sdch
> REQUEST_HEADERS:Accept-Language:
> de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4,fr;q=0.2
> ---CMTQD8zC---D--
> ---CMTQD8zC---E--
> ---CMTQD8zC---F--
> RESPONSE_HEADERS:Server: nginx/1.11.5
> RESPONSE_HEADERS:Date: Thu, 24 Nov 2016 15:39:45 GMT
> RESPONSE_HEADERS:Content-Length: 571
> RESPONSE_HEADERS:Content-Type: text/html
> RESPONSE_HEADERS:Connection: keep-alive
> ---CMTQD8zC---H--
> ---CMTQD8zC---I--
> ---CMTQD8zC---J--
> ---CMTQD8zC---Z--

The interesting bit, the H part is empty.

That is very odd. What is your SecAuditLogParts setting?

Maybe you remove it for a test so it reverts to the default which should
bring you the H audit log part.

Ahoj,

Christian


-- 
No man is more unhappy than he who never faces adversity. 
For he is not permitted to prove himself.
-- Seneca

From mase at partycrew-united.de  Thu Nov 24 16:02:43 2016
From: mase at partycrew-united.de (Muenz, Michael)
Date: Thu, 24 Nov 2016 17:02:43 +0100
Subject: [Owasp-modsecurity-core-rule-set] No rule-id in audit/error log
 with Nginx und MS3/CRS3
In-Reply-To: <20161124155936.GA19862@elias>
References: <34e3ebbe-5fc6-6b10-bcc6-5731a516e776@partycrew-united.de>
	<20161124152748.GA13362@elias>
	<897dccfa-0dda-1a8b-d4a0-526b0728072b@partycrew-united.de>
	<20161124155936.GA19862@elias>
Message-ID: <77fe7971-423a-a03f-d700-81d641a88102@partycrew-united.de>

Am 24.11.2016 um 16:59 schrieb Christian Folini:
>
> The interesting bit, the H part is empty.
>
> That is very odd. What is your SecAuditLogParts setting?
>
> Maybe you remove it for a test so it reverts to the default which should
> bring you the H audit log part.
>
> Ahoj,
>
> Christian
>
>
SecAuditLogParts ABIJDEFHZ

What I changed in crs-setup.conf was:

SecDefaultAction "phase:1,log,auditlog,deny,status:403"
SecDefaultAction "phase:2,log,auditlog,deny,status:403"

... instead of the default.


Thanks,

Michael



From christian.folini at netnea.com  Thu Nov 24 16:37:54 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 24 Nov 2016 17:37:54 +0100
Subject: [Owasp-modsecurity-core-rule-set] No rule-id in audit/error log
 with Nginx und MS3/CRS3
In-Reply-To: <77fe7971-423a-a03f-d700-81d641a88102@partycrew-united.de>
References: <34e3ebbe-5fc6-6b10-bcc6-5731a516e776@partycrew-united.de>
	<20161124152748.GA13362@elias>
	<897dccfa-0dda-1a8b-d4a0-526b0728072b@partycrew-united.de>
	<20161124155936.GA19862@elias>
	<77fe7971-423a-a03f-d700-81d641a88102@partycrew-united.de>
Message-ID: <20161124163754.GA27729@elias>

On Thu, Nov 24, 2016 at 05:02:43PM +0100, Muenz, Michael wrote:
> SecAuditLogParts ABIJDEFHZ

It's a little known detail that Audit Log Parts need to be set
in alphabetic order. But I do not think this is the problem here.

For me, this sounds like a ModSec/NginX bug - unless you have some other
base config which tweaks the audit log in the said fashion. But I
do not see how you could.

So to me, this is not a CRS problem, but a ModSec on NginX problem.

Next step would be to remove the complete CRS and then copy
the said rule into the remaining config. And then you change
the rule action form pass to deny and give it another shot.

> What I changed in crs-setup.conf was:
> 
> SecDefaultAction "phase:1,log,auditlog,deny,status:403"
> SecDefaultAction "phase:2,log,auditlog,deny,status:403"
> 
> ... instead of the default.

That is perfectly OK configurationwise (outside of the fact that
anomaly scoring mode is the default for a good reason. Unless you
have thought about this a lot and you really know what you are
doing, I suggest you stay in anomaly scoring mode).

Ahoj,

Christian


-- 
You don't have to be great to start, but you have to 
start to be great. 
-- Zig Ziglar

From mase at partycrew-united.de  Fri Nov 25 10:21:04 2016
From: mase at partycrew-united.de (Muenz, Michael)
Date: Fri, 25 Nov 2016 11:21:04 +0100
Subject: [Owasp-modsecurity-core-rule-set] No rule-id in audit/error log
 with Nginx und MS3/CRS3
In-Reply-To: <20161124163754.GA27729@elias>
References: <34e3ebbe-5fc6-6b10-bcc6-5731a516e776@partycrew-united.de>
	<20161124152748.GA13362@elias>
	<897dccfa-0dda-1a8b-d4a0-526b0728072b@partycrew-united.de>
	<20161124155936.GA19862@elias>
	<77fe7971-423a-a03f-d700-81d641a88102@partycrew-united.de>
	<20161124163754.GA27729@elias>
Message-ID: <14da8c5e-156e-6181-eadc-91e48b25b6b1@partycrew-united.de>

Am 24.11.2016 um 17:37 schrieb Christian Folini:
> On Thu, Nov 24, 2016 at 05:02:43PM +0100, Muenz, Michael wrote:
>> SecAuditLogParts ABIJDEFHZ
> It's a little known detail that Audit Log Parts need to be set
> in alphabetic order. But I do not think this is the problem here.
>
> For me, this sounds like a ModSec/NginX bug - unless you have some other
> base config which tweaks the audit log in the said fashion. But I
> do not see how you could.
>
> So to me, this is not a CRS problem, but a ModSec on NginX problem.
>

LogParts is the default from modsecurity.conf.
Yesterday Nginx updated their guide for the current version, now 
everything gets logged.
It's a bug/change in the MS-Nginx connector where everything is logged 
with info severity.

Thanks,
Michael

From christian.folini at netnea.com  Fri Nov 25 10:36:09 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 25 Nov 2016 11:36:09 +0100
Subject: [Owasp-modsecurity-core-rule-set] No rule-id in audit/error log
 with Nginx und MS3/CRS3
In-Reply-To: <14da8c5e-156e-6181-eadc-91e48b25b6b1@partycrew-united.de>
References: <34e3ebbe-5fc6-6b10-bcc6-5731a516e776@partycrew-united.de>
	<20161124152748.GA13362@elias>
	<897dccfa-0dda-1a8b-d4a0-526b0728072b@partycrew-united.de>
	<20161124155936.GA19862@elias>
	<77fe7971-423a-a03f-d700-81d641a88102@partycrew-united.de>
	<20161124163754.GA27729@elias>
	<14da8c5e-156e-6181-eadc-91e48b25b6b1@partycrew-united.de>
Message-ID: <20161125103609.GB477@elias>

Glad that's solved. Thanks for the update!

Christian

On Fri, Nov 25, 2016 at 11:21:04AM +0100, Muenz, Michael wrote:
> Am 24.11.2016 um 17:37 schrieb Christian Folini:
> >On Thu, Nov 24, 2016 at 05:02:43PM +0100, Muenz, Michael wrote:
> >>SecAuditLogParts ABIJDEFHZ
> >It's a little known detail that Audit Log Parts need to be set
> >in alphabetic order. But I do not think this is the problem here.
> >
> >For me, this sounds like a ModSec/NginX bug - unless you have some other
> >base config which tweaks the audit log in the said fashion. But I
> >do not see how you could.
> >
> >So to me, this is not a CRS problem, but a ModSec on NginX problem.
> >
> 
> LogParts is the default from modsecurity.conf.
> Yesterday Nginx updated their guide for the current version, now
> everything gets logged.
> It's a bug/change in the MS-Nginx connector where everything is
> logged with info severity.
> 
> Thanks,
> Michael
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From christian.folini at netnea.com  Sat Nov 26 09:32:14 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Sat, 26 Nov 2016 10:32:14 +0100
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] CRS3
	WordPress Exclusions
In-Reply-To: <CO2PR0801MB2152B04C149B74F4A312E47FC6BC0@CO2PR0801MB2152.namprd08.prod.outlook.com>
References: <CO2PR0801MB2152B04C149B74F4A312E47FC6BC0@CO2PR0801MB2152.namprd08.prod.outlook.com>
Message-ID: <20161126093213.GA29785@elias>

Jason,

This is an core rule set question, that you asked on the general
ModSecurity mailinglist. I'll move over to the CRS
mailinglist for a response:

The optional WordPress rule exclusions need to be activated in the
crst-setup.conf. There is not yet a blog post or detailed documentation
about it, but it basically follows the Drupal stuff, which I depicted
in this blog post this week:
https://www.netnea.com/cms/2016/11/22/securing-drupal-with-modsecurity-and-the-core-rule-set-crs3/

If you follow that documentation and apply it to WP you should be good.

What is central is, that we are only covering the core stuff so far.
We have bigger plans, but this is only a start. There is a bunch of
additional rule exclusions being discussed on github right now. So you
can expect to get a lot of improvement with subsequent point releases.

So far, you can install and publish and read articles without any
false positives. But the deeper you dig into the admin stuff, the
more likely will you encounter FPs.

Good luck - and let's move over to the CRS mailinglist.

Cheers,

Christian



On Fri, Nov 25, 2016 at 08:12:16PM +0000, Jason Mull wrote:
> Hello,
> 
> 
> 
> While reading over the mailing list post regarding the release of CRS3, I noticed mention of application-level exclusions for WordPress.  Is there anywhere I can find more info on this functionality (Where / how to enable, how to view / add exclusions)?
> 
> 
> Jason

> ------------------------------------------------------------------------------

> _______________________________________________
> mod-security-users mailing list
> mod-security-users at lists.sourceforge.net
> https://lists.sourceforge.net/lists/listinfo/mod-security-users
> Commercial ModSecurity Rules and Support from Trustwave's SpiderLabs:
> http://www.modsecurity.org/projects/commercial/rules/
> http://www.modsecurity.org/projects/commercial/support/


-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From mzuzcak at secit.sk  Mon Nov 28 10:59:56 2016
From: mzuzcak at secit.sk (=?UTF-8?B?TWF0ZWogWnV6xI3DoWs=?=)
Date: Mon, 28 Nov 2016 11:59:56 +0100
Subject: [Owasp-modsecurity-core-rule-set] Drupal 7,
 nginx with ModSecurity - How to resolve that 404 error page please?
Message-ID: <e4741c16-028f-cdc8-6bc4-1a9544a394f5@secit.sk>

Hello all,

I have installed Drupal 7 on latest version of Nginx web server which
was compiled with support of ModSecurity module. I have activated core
OWASP rule set. But when I active ModSecurity in my virtual host config
file for my Drupal 7 web I do not login, register or reset password with
this error in log:

|[error]11158#0: *1 open() "/var/www/MY_WEBSITE/node" failed (2: No such
file or directory), client: IP, server: MY_SERVER, request: "POST
/node?destination=node HTTP/1.1", host: "MY_WEBSITE", referrer:
"http://MY_WEBSITE/"|

And client gets 404 error page.

I applied these practices
https://geekflare.com/modsecurity-owasp-core-rule-set-nginx/ and
https://www.netnea.com/cms/2016/11/22/securing-drupal-with-modsecurity-and-the-core-rule-set-crs3/
||
When I change SecRuleEngine from "On" to "DetectionOnly" result is the
same, For correct operation I have to "switch off" ModSecurity in
virtual host config for domain.
I found some solutions for Apache web server (these solutions use
modifications of htaccess file), but not for Nginx.

So please have you any advices for solving this problem?

Help me please.
Many thanks!

-- 
Best Regards
Matej Zuzcak

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161128/41dc1995/attachment.html>

