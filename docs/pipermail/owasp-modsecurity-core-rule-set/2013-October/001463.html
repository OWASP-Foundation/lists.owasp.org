<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Can Rules drop offending cookie/arg without dropping the entire request?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Can%20Rules%20drop%20offending%0A%20cookie/arg%20without%20dropping%20the%20entire%20request%3F&In-Reply-To=%3CCAAr79n5p%3DkvR15LdLLFEhujv5R-xtuBgdb-EUkDX2pevTWXdPQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001462.html">
   <LINK REL="Next"  HREF="001464.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Can Rules drop offending cookie/arg without dropping the entire request?</H1>
    <B>John McGowan</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Can%20Rules%20drop%20offending%0A%20cookie/arg%20without%20dropping%20the%20entire%20request%3F&In-Reply-To=%3CCAAr79n5p%3DkvR15LdLLFEhujv5R-xtuBgdb-EUkDX2pevTWXdPQ%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Can Rules drop offending cookie/arg without dropping the entire request?">john at lynch2.com
       </A><BR>
    <I>Wed Oct  2 15:09:48 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="001462.html">[Owasp-modsecurity-core-rule-set] Can Rules drop offending cookie/arg without dropping the entire request?
</A></li>
        <LI>Next message: <A HREF="001464.html">[Owasp-modsecurity-core-rule-set] Regression test for XSS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1463">[ date ]</a>
              <a href="thread.html#1463">[ thread ]</a>
              <a href="subject.html#1463">[ subject ]</a>
              <a href="author.html#1463">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Oct 2, 2013 at 8:56 AM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> John,
</I>&gt;<i> What I would recommend is that you utilize the SecRuleUpdateTargetById,
</I>&gt;<i> SecRuleUpdateTargetByTag, etc&#352; directives to customize which local
</I>&gt;<i> variables are inspected. For your scenario, lets say that you only want to
</I>&gt;<i> inspect some Cookie values that your site specifically sets (SESISONID,
</I>&gt;<i> FOO_COOKIE and BAR_COOKIE).  You could add the following to a local custom
</I>&gt;<i> rules file that is processed at the end of Apache/ModSecurity
</I>&gt;<i> initialization (for example in a file called -
</I>&gt;<i> modsecurity_crs_99_custom.conf).  You could place the following in the
</I>&gt;<i> file to replace REQUEST_COOKIES with only your defined cookie values for
</I>&gt;<i> all SQL Injection rules -
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> SecRuleUpdateTargetByTag &quot;SQL_INJECTION&quot; REQUEST_COOKIES
</I>&gt;<i> REQUEST_COOKIES:SESSIONID,REQUEST_COOKIES:FOO_COOKIE,REQUEST_COOKIES:BAR_CO
</I>&gt;<i> OKIE
</I>
Ryan,

I understand what you're suggesting, and I appreciate the feedback,
but unfortunately that technique doesn't really help me.    We are
typically using the SecRuleUpdateTargetById to ignore certain rules
for the cookies/params that we're using.  Usually because our app is
using the cookies in a way that causes a false positive in the CRS
(json data typically).

If I'm understanding your suggestion, you're basically saying that we
should update the rules so that they ignore unexpected (unused)
cookies and args, and only inspect the ones that we know our
application is using.  But that is a catch 22, because it's usually
those rules that we're having to write exceptions to ignore on.

I feel like i'm falling into this trap where I feel like the only way
I can run mos_sec with the CRS is to turn off some major rules
entirely because of this 3rd party cookie issue.    Or else risk that
some users will have a broken experience until we have a chance to
address the false positives that we get notified about.

Luckilly we are using SumoLogic to parse the apache error logs and
deliver us a report every 15 minutes with a list of the blocked
requests.

Thanks again for each of your responses.  Is my original question
something that could possibly be implemented as a feature to
mos_security?  The ability to make it so rules modify a request
instead of dropping it entirely?  Kind of a middle ground between
&quot;notify only&quot; and &quot;drop entirely&quot;.... just &quot;drop the bad part&quot;?

/John
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001462.html">[Owasp-modsecurity-core-rule-set] Can Rules drop offending cookie/arg without dropping the entire request?
</A></li>
	<LI>Next message: <A HREF="001464.html">[Owasp-modsecurity-core-rule-set] Regression test for XSS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1463">[ date ]</a>
              <a href="thread.html#1463">[ thread ]</a>
              <a href="subject.html#1463">[ subject ]</a>
              <a href="author.html#1463">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
