<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule	difficulty
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20cpanel%20modsecurity%20add-rule%0A%09difficulty&In-Reply-To=%3CCAN7RX0Z8N3oLji0%2BZTF%3DRC6_Z7Fvrpnj9HqJHov9raacfTrksQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002294.html">
   <LINK REL="Next"  HREF="002296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule	difficulty</H1>
    <B>Russell Clemings</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20cpanel%20modsecurity%20add-rule%0A%09difficulty&In-Reply-To=%3CCAN7RX0Z8N3oLji0%2BZTF%3DRC6_Z7Fvrpnj9HqJHov9raacfTrksQ%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule	difficulty">rclemings at gmail.com
       </A><BR>
    <I>Fri Dec  2 01:00:38 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002294.html">[Owasp-modsecurity-core-rule-set] Drupal 7, nginx with ModSecurity - How to resolve that 404 error page please?
</A></li>
        <LI>Next message: <A HREF="002296.html">[Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule	difficulty
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2295">[ date ]</a>
              <a href="thread.html#2295">[ thread ]</a>
              <a href="subject.html#2295">[ subject ]</a>
              <a href="author.html#2295">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm having some trouble dealing with two false positives. This is cPanel's
implementation of OWASP ver.3.0.0, as nearly as I can tell (from /etc
&lt;<A HREF="https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc">https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc</A>&gt;
/apache2
&lt;<A HREF="https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc/apache2">https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc/apache2</A>&gt;
/conf.d
&lt;<A HREF="https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc/apache2/conf.d">https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc/apache2/conf.d</A>&gt;
/modsec_vendor_configs
&lt;<A HREF="https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc/apache2/conf.d/modsec_vendor_configs">https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&amp;p=/etc/apache2/conf.d/modsec_vendor_configs</A>&gt;
/OWASP/modsecurity_crs_10_setup.conf). I've masked some possibly sensitive
data.

523939:[Thu Dec 01 10:25:39.244073 2016] [:error] [pid 24880] [client
xx.xx.xxx.xxx] ModSecurity: Access denied with redirection to
<A HREF="http://www.example.com/">http://www.example.com/</A> using status 302 (phase 2). Pattern match
&quot;\\\\%((?!$|\\\\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})&quot; at ARGS:returnUrl.
[file
&quot;/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/REQUEST-20-PROTOCOL-ENFORCEMENT.conf&quot;]
[line &quot;219&quot;] [id &quot;950109&quot;] [rev &quot;2&quot;] [msg &quot;Multiple URL Encoding Detected&quot;]
[severity &quot;WARNING&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;6&quot;] [accuracy &quot;8&quot;]
[tag &quot;Host: www.example.com&quot;] [tag &quot;application-multi&quot;] [tag
&quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-protocol&quot;] [tag
&quot;OWASP_CRS/PROTOCOL_VIOLATION/EVASION&quot;] [hostname &quot;www.example.com&quot;] [uri
&quot;/xxx.php&quot;] [unique_id &quot;WEBA83cQjKbwhNpTYWkudQAAAAQ&quot;]

526747:[Thu Dec 01 10:41:28.958952 2016] [:error] [pid 26285] [client
xx.xx.xxx.xxx] ModSecurity: Access denied with redirection to
<A HREF="http://www.example.com/">http://www.example.com/</A> using status 302 (phase 2). Match of &quot;beginsWith
%{request_headers.host}&quot; against &quot;TX:1&quot; required. [file
&quot;/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/REQUEST-31-APPLICATION-ATTACK-RFI.conf&quot;]
[line &quot;30&quot;] [id &quot;950120&quot;] [rev &quot;3&quot;] [msg &quot;Possible Remote File Inclusion
(RFI) Attack: Off-Domain Reference/Link&quot;] [data &quot;Matched Data:
<A HREF="https://another.example.com/a/account/validatethirdpartycorporateauthresult?redirectUrl=http:%2F%2Fanother.example.com%2Fa">https://another.example.com/a/account/validatethirdpartycorporateauthresult?redirectUrl=http:%2F%2Fanother.example.com%2Fa</A>
found within TX:1:
another.example.com/a/account/validatethirdpartycorporateauthresult?redirectUrl=http:%2F%2Fanother.example.com%2Fa&quot;]
[severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity &quot;9&quot;] [accuracy &quot;9&quot;]
[tag &quot;Host: www.example.com&quot;] [tag &quot;application-multi&quot;] [tag
&quot;language-multi&quot;] [tag &quot;platform-multi&quot;] [tag &quot;attack-remote file
inclusion&quot;] [tag &quot;OWASP_CRS/WEB_ATTACK/RFI&quot;] [hostname &quot;www.example.com&quot;]
[uri &quot;/xxx.php&quot;] [unique_id &quot;WEBEqF9us8Ws-b6n3kgKmAAAAAI&quot;]

I've confirmed that those rules are the problem by temporarily disabling
them, but I would like to create an exception instead. I am trying to use
the &quot;add rule&quot; function in cPanel's WHM/Security
Center/ModSecurity/Tools/Rules List. Here is what I'm trying to add (singly
and both at once):

SecRuleUpdateTargetById 950109 !ARGS:'another.example.com'
SecRuleUpdateTargetByID 950120 !ARGS_NAMES:'another.example.com'

When I try to save and deploy, here is what I get in the cPanel error log:

[2016-12-01 16:09:21 -0500] warn [xml-api] The system failed to deploy the
changes for &#8220;modsec/modsec2.user.conf&#8221;: The system could not validate the
new Apache configuration because httpd exited with a nonzero value. Apache
produced the following error: AH00526: Syntax error on line 1 of
/etc/apache2/conf.d/modsec/modsec2.user.conf:
Updating target by ID with no ruleset in this context

I've tried various combinations of single quotes, double quotes, no quotes,
but to no avail. It's up to the server vendor to file a ticket with cPanel
and they say it's not appropriate to do that for a syntax error.

Suggestions?

I did file reports via cPanel earlier today and got auto-replies from
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">security at modsecurity.org</A> assigning ticket nos. 1332 and 1333, but nothing
further.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161201/1e75bf0e/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161201/1e75bf0e/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002294.html">[Owasp-modsecurity-core-rule-set] Drupal 7, nginx with ModSecurity - How to resolve that 404 error page please?
</A></li>
	<LI>Next message: <A HREF="002296.html">[Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule	difficulty
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2295">[ date ]</a>
              <a href="thread.html#2295">[ thread ]</a>
              <a href="subject.html#2295">[ subject ]</a>
              <a href="author.html#2295">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
