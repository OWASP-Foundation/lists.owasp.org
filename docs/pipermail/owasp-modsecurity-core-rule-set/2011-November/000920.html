<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Lua nil value error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Lua%20nil%20value%20error&In-Reply-To=1320860930.10953.4.camel%40tintin">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000919.html">
   <LINK REL="Next"  HREF="000921.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Lua nil value error</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Lua%20nil%20value%20error&In-Reply-To=1320860930.10953.4.camel%40tintin"
       TITLE="[Owasp-modsecurity-core-rule-set] Lua nil value error">RBarnett at trustwave.com
       </A><BR>
    <I>Wed Nov  9 12:55:53 EST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000919.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
        <LI>Next message: <A HREF="000921.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#920">[ date ]</a>
              <a href="thread.html#920">[ thread ]</a>
              <a href="subject.html#920">[ subject ]</a>
              <a href="author.html#920">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 11/9/11 12:48 PM, &quot;Ross Lawrie&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ross at sentrypayments.com</A>&gt; wrote:

&gt;<i>On Wed, 2011-11-09 at 10:10 +0200, Josh Amishav-Zlatin wrote:
</I>&gt;&gt;<i> On Tue, Nov 8, 2011 at 6:59 PM, Ross Lawrie &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ross at sentrypayments.com</A>&gt;
</I>&gt;&gt;<i>wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &gt; This did help a little, the path was in need of updating, so I made
</I>&gt;&gt;<i>that
</I>&gt;&gt;<i> &gt; change, but the problem persisted. This lead me to try running the lua
</I>&gt;&gt;<i> &gt; scripts from the command line which resulted in &quot;module 'rex_pcre' not
</I>&gt;&gt;<i> &gt; found&quot;. I'm wondering if anyone is aware of a Debian (lenny) rex_pcre
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi Ross,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Have you tried liblua5.1-rex-pcre0?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i>  - Josh
</I>&gt;<i>
</I>&gt;<i>Josh,
</I>&gt;<i>
</I>&gt;<i>Unfortunately that package doesn't exist for Debian Lenny (5.0.9). It
</I>&gt;<i>looks like it exists for Squeeze and higher, but at this point I can't
</I>&gt;<i>quite migrate this system to Squeeze. Thanks!
</I>&gt;<i>
</I>&gt;<i>Ross.
</I>

Hey Ross,
A couple points about the advaced_filter_converter.lua script -

1) As you noted - there are Lua module dependencies.  You will need both
rex (for extended regular expressions) and bitop.  These modules are
needed in order to properly mimic the data conversion that PHPIDS'
converter.php script
(<A HREF="https://dev.itratos.de/projects/php-ids/repository/raw/trunk/lib/IDS/Conve">https://dev.itratos.de/projects/php-ids/repository/raw/trunk/lib/IDS/Conve</A>
rter.php)  is doing.

2) We ran into some issues with that Lua script during the SQL Injection
Challenge
(<A HREF="http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-les">http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-les</A>
sons-learned.html) where certain payloads were actually causing the Lua
script to abort... :(  This script needs more testing.

3) Due to issue #2, we opted, in the latest CRS, to update the actual
PHPIDS regex filters themselves to try and include the converter logic
within the operator vs. requiring the Lua script to first normalize data.
So, if you are running the latest CRS, you can use the
modsecurity_crs_41_sql_injection_attack.conf file and not need to use the
advanced filters conf.

Hope this info helps.

-Ryan


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000919.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
	<LI>Next message: <A HREF="000921.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#920">[ date ]</a>
              <a href="thread.html#920">[ thread ]</a>
              <a href="subject.html#920">[ subject ]</a>
              <a href="author.html#920">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
