<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] How to block one ip address for a period of time
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20block%20one%20ip%20address%0A%20for%20a%20period%20of%20time&In-Reply-To=CANnPkin1auRaxOJ2ARWXvA1%3Dmw6Vrf9Ra_%2BrRTM9Np24cPHu1Q%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000906.html">
   <LINK REL="Next"  HREF="000908.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] How to block one ip address for a period of time</H1>
    <B>Majed B.</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20How%20to%20block%20one%20ip%20address%0A%20for%20a%20period%20of%20time&In-Reply-To=CANnPkin1auRaxOJ2ARWXvA1%3Dmw6Vrf9Ra_%2BrRTM9Np24cPHu1Q%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] How to block one ip address for a period of time">majedb at gmail.com
       </A><BR>
    <I>Wed Nov  2 05:10:49 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000906.html">[Owasp-modsecurity-core-rule-set] How to block one ip address for a period of time
</A></li>
        <LI>Next message: <A HREF="000908.html">[Owasp-modsecurity-core-rule-set] Performance issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#907">[ date ]</a>
              <a href="thread.html#907">[ thread ]</a>
              <a href="subject.html#907">[ subject ]</a>
              <a href="author.html#907">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I don't use a specific rule to block IPs &amp; instead use fail2ban to
block all IPs that are found in the error logs.

mod_sec will prevent the action from occurring then log it, and
fail2ban will pick up the IP and ban it. There should be no harm to
Apache itself in that process, as opposed to letting mod_sec do the
banning. In fact, I think it's better for performance to avoid banning
from within Apache, just deny the action, log it &amp; let another app do
the banning &amp; unbanning.

Here's a description of an Apache section:
<A HREF="http://www.fail2ban.org/wiki/index.php/Fail2ban:Community_Portal#Apache">http://www.fail2ban.org/wiki/index.php/Fail2ban:Community_Portal#Apache</A>
You can easily modify it for whatever rule you'd like to block, or all of them.

On Wed, Nov 2, 2011 at 12:02 PM, Josh Amishav-Zlatin &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamuse at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On Wed, Nov 2, 2011 at 4:55 AM, dreamice &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">dreamice.jiang at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; Dear all,
</I>&gt;<i> &gt; I want to write a rule to block an IP address for a period of time, for
</I>&gt;<i> &gt; example 5 minutes.
</I>&gt;<i> &gt; How can I write this rule?
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> The following example assumes you want to block IPs that send a
</I>&gt;<i> request that have the string blockme in an argument value:
</I>&gt;<i>
</I>&gt;<i> # Initialize the IP collection
</I>&gt;<i> SecAction &quot;phase:1,nolog,pass,initcol:ip=%{REMOTE_ADDR}
</I>&gt;<i>
</I>&gt;<i> # Block IP for 300 seconds
</I>&gt;<i> SecRule ARGS blockme
</I>&gt;<i> &quot;phase:2,block,setvar:ip.blocked=1,expirevar:ip.blocked=300&quot;
</I>&gt;<i>
</I>&gt;<i> # Enforce blocking
</I>&gt;<i> SecRule IP:BLOCKED &quot;@eq 1&quot; &quot;phase:1,deny,log&quot;
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> &#160;- Josh
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>


--
&#160; &#160; &#160;&#160; Majed B.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000906.html">[Owasp-modsecurity-core-rule-set] How to block one ip address for a period of time
</A></li>
	<LI>Next message: <A HREF="000908.html">[Owasp-modsecurity-core-rule-set] Performance issues
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#907">[ date ]</a>
              <a href="thread.html#907">[ thread ]</a>
              <a href="subject.html#907">[ subject ]</a>
              <a href="author.html#907">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
