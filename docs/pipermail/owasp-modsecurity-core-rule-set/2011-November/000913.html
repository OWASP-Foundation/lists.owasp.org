<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Lua nil value error
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Lua%20nil%20value%20error&In-Reply-To=1320438578.18373.16.camel%40tintin">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000912.html">
   <LINK REL="Next"  HREF="000914.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Lua nil value error</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20Lua%20nil%20value%20error&In-Reply-To=1320438578.18373.16.camel%40tintin"
       TITLE="[Owasp-modsecurity-core-rule-set] Lua nil value error">RBarnett at trustwave.com
       </A><BR>
    <I>Fri Nov  4 17:58:20 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000912.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
        <LI>Next message: <A HREF="000914.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#913">[ date ]</a>
              <a href="thread.html#913">[ thread ]</a>
              <a href="subject.html#913">[ subject ]</a>
              <a href="author.html#913">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 11/4/11 4:29 PM, &quot;Ross Lawrie&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">ross at sentrypayments.com</A>&gt; wrote:

&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I've done some searches hoping to find some help, and while I did find a
</I>&gt;<i>reference to the same error earlier in the list, I didn't see a clear
</I>&gt;<i>solution - or at least one that seemed clear to me.
</I>&gt;<i>
</I>&gt;<i>I'm looking at getting ModSecurity upgraded on our web server, using
</I>&gt;<i>2.6.2 with the 2.2.0 CRS. What I'm encountering is a Lua error that has
</I>&gt;<i>me confused.
</I>&gt;<i>
</I>&gt;<i>  Message: Lua: Script execution failed: attempt to call a nil value
</I>&gt;<i>  Message: Rule processing failed.
</I>
Do you happen to have Selinux running?  I believe I ran into this recently
as well with a Lua script.  Although I had set OS level permissions which
allowed my Apache user to read/execute the Lua scripts, the Selinux
permissions were not set correctly and I got a similar error message.  If
this is the case, then you will want to execute the chcon command to set
appropriate context for the Lua scripts/directory to allow the httpd
process to read/execute it.   See a similar post here -
<A HREF="http://permalink.gmane.org/gmane.comp.apache.mod-security.user/7268">http://permalink.gmane.org/gmane.comp.apache.mod-security.user/7268</A>

-Ryan


&gt;<i>
</I>&gt;<i>This is an installation on a Debian 5.0.9 server, I believe that the
</I>&gt;<i>necessary requirements are installed:
</I>&gt;<i>
</I>&gt;<i>libapr1            : 1.2.12-5+lenny4
</I>&gt;<i>libapr1-dev        : 1.2.12-5+lenny4
</I>&gt;<i>libaprutil1        : 1.2.12+dfsg-8+lenny5
</I>&gt;<i>libaprutil1-dev    : 1.2.12+dfsg-8+lenny5
</I>&gt;<i>lua5.1             : 5.1.3-1
</I>&gt;<i>liblua5.1-0        : 5.1.3-1
</I>&gt;<i>liblua5.1-0-dev    : 5.1.3-1
</I>&gt;<i>libpcre3           : 7.6-2.1
</I>&gt;<i>libpcre3-dev       : 7.6-2.1
</I>&gt;<i>libxml2            : 2.6.32.dfsg-5+lenny4
</I>&gt;<i>libxml2-dev        : 2.6.32.dfsg-5+lenny4
</I>&gt;<i>
</I>&gt;<i>Apache 2.2.21 is installed from source using the following configure:
</I>&gt;<i>
</I>&gt;<i>./configure \
</I>&gt;<i>--prefix=/usr/local/apache \
</I>&gt;<i>--disable-userdir \
</I>&gt;<i>--enable-rewrite \
</I>&gt;<i>--enable-so \
</I>&gt;<i>--enable-status \
</I>&gt;<i>--enable-info \
</I>&gt;<i>--enable-ssl \
</I>&gt;<i>--enable-cgi \
</I>&gt;<i>--enable-unique-id \
</I>&gt;<i>--enable-mime-magic \
</I>&gt;<i>--with-included-apr \
</I>&gt;<i>--with-pcre=/usr/bin/pcre-config \
</I>&gt;<i>--enable-deflate \
</I>&gt;<i>--enable-expires \
</I>&gt;<i>--enable-headers
</I>&gt;<i>
</I>&gt;<i>ModSecurity 2.6.2 is installed with the following configure:
</I>&gt;<i>
</I>&gt;<i>./configure \
</I>&gt;<i>--with-apxs=/usr/local/apache/bin/apxs \
</I>&gt;<i>--with-apr=/usr/local/apache/bin/apr-1-config
</I>&gt;<i>
</I>&gt;<i>I've only made minor path changes to the ModSecurity config, and a few
</I>&gt;<i>rule rewrites for some false positives in the CRS configuration.
</I>&gt;<i>
</I>&gt;<i>I'm assuming this is a result of
</I>&gt;<i>modsecurity_crs_41_advanced_filters.conf somehow, but I'm not entirely
</I>&gt;<i>sure how -- or whether this is necessary, or purely optional (although
</I>&gt;<i>it's part of the base_rules).
</I>&gt;<i>
</I>&gt;<i>Appreciate any help or suggestions that anyone can give.
</I>&gt;<i>
</I>&gt;<i>Ross.
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000912.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
	<LI>Next message: <A HREF="000914.html">[Owasp-modsecurity-core-rule-set] Lua nil value error
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#913">[ date ]</a>
              <a href="thread.html#913">[ thread ]</a>
              <a href="subject.html#913">[ subject ]</a>
              <a href="author.html#913">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
