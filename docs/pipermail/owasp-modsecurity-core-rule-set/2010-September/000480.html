<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] FW: WHY Rule &quot;950109&quot; matches for	ARG&quot;passed_id=81&quot; ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20FW%3A%20WHY%20Rule%20%22950109%22%20matches%20for%0A%09ARG%22passed_id%3D81%22%20%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000482.html">
   <LINK REL="Next"  HREF="000483.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] FW: WHY Rule &quot;950109&quot; matches for	ARG&quot;passed_id=81&quot; ?</H1>
    <B>Owens, Mike, DoIT</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20FW%3A%20WHY%20Rule%20%22950109%22%20matches%20for%0A%09ARG%22passed_id%3D81%22%20%3F&In-Reply-To="
       TITLE="[Owasp-modsecurity-core-rule-set] FW: WHY Rule &quot;950109&quot; matches for	ARG&quot;passed_id=81&quot; ?">Mike.Owens at state.nm.us
       </A><BR>
    <I>Wed Sep  8 11:33:42 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000482.html">[Owasp-modsecurity-core-rule-set] WHY Rule &quot;950109&quot; matches for ARG &quot;passed_id=81&quot; ?
</A></li>
        <LI>Next message: <A HREF="000483.html">[Owasp-modsecurity-core-rule-set] WHY Rule &quot;950109&quot; matches for ARG &quot;passed_id=81&quot; ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#480">[ date ]</a>
              <a href="thread.html#480">[ thread ]</a>
              <a href="subject.html#480">[ subject ]</a>
              <a href="author.html#480">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I believe the problem is the way the matching regex is written:

   \%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}

I think the intent of the original regex is to match any instance of a URL-encoded ASCII or Unicode character; the (?!$|\W) construct checks if the 1st character after the '%' is NOT an end-of-line or a non-word character, as a way to avoid an unnessary scan; but the way it's written, it matches any string consisting of a '%' sign that's not followed by end-of-line or a non-word character, OR any string of 2 alphabetic characters, OR any string of a 'u' followed by 4 alphabetic characters i.e.

   \%(?!$|\W)
   --or--
   [0-9a-fA-F]{2}
   --or--
   u[0-9a-fA-F]{4}

I think what was intended was to match any strings of the forms

   \%(?!$|\W)[0-9a-fA-F]{2}
   --or--
   \%(?!$|\W)u[0-9a-fA-F]{4}

If so, the regex could be written as

   \%(?!$|\W)([0-9a-fA-F]{2}|u[0-9a-fA-F]{4})

i.e. removing the '|' after the negative-lookahead group, and grouping the following aternatives.

--Mike Owens &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">mike.owens at state.nm.us</A>&gt;




-----Original Message-----
From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A> on behalf of Dirk Caspari
Sent: Wed 9/8/10 08:44
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule &quot;950109&quot; matches for ARG&quot;passed_id=81&quot; ?
 
--411a3f76-B--
GET /src/read_body.php?mailbox=INBOX&amp;passed_id=81&amp;startMessage=1 HTTP/1.1
Host: xxx.xxxxxxxx.de
User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3) 
Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 115
Connection: keep-alive
Referer: 
<A HREF="https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&amp;sort=0&amp;startMessage=1&amp;mailbox=INBOX">https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&amp;sort=0&amp;startMessage=1&amp;mailbox=INBOX</A>
Cookie: xxxxx


--411a3f76-H--
Message: Pattern match &quot;\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}&quot; at 
ARGS:passed_id. [file 
&quot;/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations.conf&quot;] 
[line &quot;185&quot;] [id &quot;950109&quot;] [rev &quot;2.0.8&quot;] [msg &quot;Multiple URL Encoding 
Detected&quot;] [severity &quot;NOTICE&quot;] [tag &quot;PROTOCOL_VIOLATION/EVASION&quot;]
Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. 
[file 
&quot;/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf&quot;] 
[line &quot;31&quot;] [msg &quot;Inbound Anomaly Score (Total Inbound Score: 5, SQLi=, 
XSS=): Multiple URL Encoding Detected ! 
%{matched_var_name}=%{matched_var} !&quot;]

Thanks.
  D I R K






Confidentiality Notice: This e-mail, including all attachments is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited unless specifically provided under the New Mexico Inspection of Public Records Act. If you are not the intended recipient, please contact the sender and destroy all copies of this message. -- This email has been scanned by the Sybari - Antigen Email System. 



-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/d4e1b104/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/d4e1b104/attachment.html</A> 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT275744.txt
Url: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/d4e1b104/attachment.txt">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/d4e1b104/attachment.txt</A> 
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000482.html">[Owasp-modsecurity-core-rule-set] WHY Rule &quot;950109&quot; matches for ARG &quot;passed_id=81&quot; ?
</A></li>
	<LI>Next message: <A HREF="000483.html">[Owasp-modsecurity-core-rule-set] WHY Rule &quot;950109&quot; matches for ARG &quot;passed_id=81&quot; ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#480">[ date ]</a>
              <a href="thread.html#480">[ thread ]</a>
              <a href="subject.html#480">[ subject ]</a>
              <a href="author.html#480">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
