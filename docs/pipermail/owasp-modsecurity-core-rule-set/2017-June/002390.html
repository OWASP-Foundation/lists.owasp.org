<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Rule 920270 issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20920270%20issue&In-Reply-To=%3CCAE8hE%3DqO30wtS%3DnzcHuVGZDZMOcdnQ3VVhy_v7eDOU7PUy2kVg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002384.html">
   <LINK REL="Next"  HREF="002385.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Rule 920270 issue</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20920270%20issue&In-Reply-To=%3CCAE8hE%3DqO30wtS%3DnzcHuVGZDZMOcdnQ3VVhy_v7eDOU7PUy2kVg%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Rule 920270 issue">chaim at chaimsanders.com
       </A><BR>
    <I>Fri Jun  9 20:15:52 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002384.html">[Owasp-modsecurity-core-rule-set] Rule 920270 issue
</A></li>
        <LI>Next message: <A HREF="002385.html">[Owasp-modsecurity-core-rule-set] newbie question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2390">[ date ]</a>
              <a href="thread.html#2390">[ thread ]</a>
              <a href="subject.html#2390">[ subject ]</a>
              <a href="author.html#2390">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Interesting,
Yes as Manuel pointed out %00 is a null char and is forbidden. tl;dr it is
used to indicate the end of a string in C and as a result languages built
on C (like php) when provided with it may treat that as the end of a string
even when more is provided.

In any event this is actually kinda interesting, the problem is a
disagreement about how webservers versus modsec will handle the code.
Depending on which webserver provides the varabiles and where, it is
already url decoded. For instance Apache. So in this case Apache decoded
the variable and turned %25 back into a percent sign before modsec got it.
Then CRS's rule 920270 applied t:urlDecodeUni decoded it again. this led to
it detected a null byte.

TO BE CLEAR PASSING AN ACTUAL NULLBYTE WILL TRIGGER THIS RULE, IT&quot;S THE %25
THAT IS A POSSIBLE PROBLEM.

Now there is some logic here. Early microsoft IIS would do what's known as
double decode, but we have other rules to detect that, so there is probably
a good reason to open up a ticket and have a discussion about removing that
transformation. The problem is going to be that we have to make sure that
IIS/Nginx/Apache all behave in the same way, but that isn't your problem
that is ours. Would you mind opening up a github ticket so we can properly
attribute this?

On Thu, Jun 8, 2017 at 1:02 PM, Manuel Spartan &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">spartantri at gmail.com</A>&gt; wrote:

&gt;<i> Hi Ed,
</I>&gt;<i>
</I>&gt;<i> Passwords are often problematic, %00 urldecoded is a null character
</I>&gt;<i>
</I>&gt;<i> Try whitelisting the argument vhost wide of it is everywhere, dont know
</I>&gt;<i> ehere it may appear or you are feeling lazy
</I>&gt;<i>
</I>&gt;<i> SecRuleUpdateTargetById 920270 &quot;!ARGS:Password&quot;
</I>&gt;<i>
</I>&gt;<i> Or in the affected uri's with
</I>&gt;<i>
</I>&gt;<i> SecRule REQUEST_URI &quot;@beginsWith /createaccount.php&quot; &quot;id:YOURID,phase:1,t:none,pass, \
</I>&gt;<i>   nolog,noauditlog,ctl:ruleRemoveTargetById=920270;ARGS:Password&quot;
</I>&gt;<i>
</I>&gt;<i> After that add your own rules to validate the length, allowed characters
</I>&gt;<i> and complexity of your passwords.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i> Manuel
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Jun 8, 2017 16:04, &quot;Ed Greenberg&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">edg at greenberg.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> HI, The full audit report is in a pastebin at:
</I>&gt;<i> <A HREF="https://pastebin.com/neKeAm65">https://pastebin.com/neKeAm65</A>
</I>&gt;<i>
</I>&gt;<i> The report is:
</I>&gt;<i>
</I>&gt;<i> Message: Warning. Found 1 byte(s) in ARGS:Password outside range: 1-255.
</I>&gt;<i> [file &quot;/etc/httpd/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf&quot;]
</I>&gt;<i> [line &quot;574&quot;] [id &quot;920270&quot;] [rev &quot;2&quot;] [msg &quot;Invalid character in request
</I>&gt;<i> (null character)&quot;] [severity &quot;CRITICAL&quot;] [ver &quot;OWASP_CRS/3.0.0&quot;] [maturity
</I>&gt;<i> &quot;9&quot;] [accuracy &quot;9&quot;] [tag &quot;application-multi&quot;] [tag &quot;language-multi&quot;] [tag
</I>&gt;<i> &quot;platform-multi&quot;] [tag &quot;attack-protocol&quot;] [tag
</I>&gt;<i> &quot;OWASP_CRS/PROTOCOL_VIOLATION/EVASION&quot;]
</I>&gt;<i>
</I>&gt;<i> The Password field in the request is:
</I>&gt;<i>
</I>&gt;<i> &amp;Password=shadow%250057&amp;ConfirmPassword=shadow%250057&amp;
</I>&gt;<i>
</I>&gt;<i> So he's doing password shadow%0057 which feels pretty normal for a person
</I>&gt;<i> to use.
</I>&gt;<i>
</I>&gt;<i> Not sure where the 'null' character might be.
</I>&gt;<i>
</I>&gt;<i> Any ideas?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
-- 
Chaim Sanders
<A HREF="http://www.ChaimSanders.com">http://www.ChaimSanders.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170609/37eda6dc/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170609/37eda6dc/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002384.html">[Owasp-modsecurity-core-rule-set] Rule 920270 issue
</A></li>
	<LI>Next message: <A HREF="002385.html">[Owasp-modsecurity-core-rule-set] newbie question
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2390">[ date ]</a>
              <a href="thread.html#2390">[ thread ]</a>
              <a href="subject.html#2390">[ subject ]</a>
              <a href="author.html#2390">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
