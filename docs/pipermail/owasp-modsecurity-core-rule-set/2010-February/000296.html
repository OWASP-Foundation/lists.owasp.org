<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] basic questions of apache	exploitation &amp; modsecurity.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20basic%20questions%20of%0A%20apache%09exploitation%20%26%20modsecurity.&In-Reply-To=1f9222b71002130725s35320c6cnfc419981e67239f2%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000295.html">
   <LINK REL="Next"  HREF="000297.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] basic questions of apache	exploitation &amp; modsecurity.</H1>
    <B>Brian Rectanus</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20basic%20questions%20of%0A%20apache%09exploitation%20%26%20modsecurity.&In-Reply-To=1f9222b71002130725s35320c6cnfc419981e67239f2%40mail.gmail.com"
       TITLE="[Owasp-modsecurity-core-rule-set] basic questions of apache	exploitation &amp; modsecurity.">Brian.Rectanus at breach.com
       </A><BR>
    <I>Sat Feb 13 17:25:28 EST 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000295.html">[Owasp-modsecurity-core-rule-set] basic questions of apache	exploitation &amp; modsecurity.
</A></li>
        <LI>Next message: <A HREF="000297.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] base	rules phpids
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#296">[ date ]</a>
              <a href="thread.html#296">[ thread ]</a>
              <a href="subject.html#296">[ subject ]</a>
              <a href="author.html#296">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think that this is deviating from the list topic (core rule set).
Please take it to the mod-security-users list if you want to discuss
ModSecurity itself.  I've CC'd that list, so please reply there.

Some further comments below...

Ivan Ristic wrote:
&gt;<i> Hi David,
</I>&gt;<i> 
</I>&gt;<i> In principle, ModSecurity was not designed to protect Apache itself.
</I>&gt;<i> It may do, but if it can, it's a byproduct of whatever else we are
</I>&gt;<i> trying to accomplish. I never used ModSecurity in that way, although
</I>&gt;<i> others may have. More responses below.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Wed, Feb 10, 2010 at 11:56 PM, David Taveras &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">d3taveras38d3 at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Hello,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Iam trying to build a very general panorama on the paths a hack can
</I>&gt;&gt;<i> take place with modsecurity &amp; an apache webserver. So i have some
</I>&gt;&gt;<i> general questions!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> a.) all possible apache attacks start via a request method, correct ?
</I>&gt;&gt;<i> (DELETE, GET, HEAD, PUT, POST), correct?
</I>&gt;<i> 
</I>&gt;<i> The request method does not matter if there's a vulnerability in the
</I>&gt;<i> code somewhere that can be exploited before Apache evaluates the
</I>&gt;<i> request method. Overall, I don't think Apache cares much about request
</I>&gt;<i> methods.
</I>
Some examples:

* SSL processing

* Parsing the request line (required before you can see the method)

* Header parsing, such as the Host header which may determine the Apache
config (and thus the ModSecurity config) used to process the request.

&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> b.) Although modsecurity inspects the REQUEST_URI, the focus is
</I>&gt;&gt;<i> actually the QUERY_STRING this is what all the rules end up inspecting
</I>&gt;&gt;<i> right (aside from the body content for data leakage). Right?
</I>&gt;<i> 
</I>&gt;<i> You would inspect response bodies for leakage, but input data can also
</I>&gt;<i> be in the request headers and the request body.
</I>
All aspects of the request are used, but generally speaking it is ARGS
that is probably the most common.

Common examples that you seem to have overlooked:

* Cookie values (both incoming and outgoing)

* General HTTP request abnormalities:
  - Known HTTP method
  - Checking for headers that should normally be there (or not there)
  - Using strict parsing for multi-part form posts

* URI based parameters:
  <A HREF="http://my.host.tld/myapp/view/record/record-id-12345">http://my.host.tld/myapp/view/record/record-id-12345</A>

* Auth values (ie check brute forcing and that passwords fall within a
policy guidelines).

&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> c.) If I host an apache webserver with vulerabilities within the
</I>&gt;&gt;<i> apache code and this one hosts no scripts or data. Is it possible to
</I>&gt;&gt;<i> exploit those vulerabilities on apache?
</I>&gt;<i> 
</I>&gt;<i> It depends on the configuration and on the vulnerabilities. It might be.
</I>
I would say yes.  Take an SSL exploit as an example.  Also a buffer
overflow in processing the request line.  Both of these fall before
ModSecurity sees the request and there is zero chance of ModSecurity
stopping anything it never sees ;)

&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> d.) How if a buffer overflow exploited on a webserver hosting images
</I>&gt;&gt;<i> and php scripts?
</I>&gt;<i> 
</I>&gt;<i> Can you please rephrase the question?
</I>
Assuming you meant: How *is* a buffer overflow exploited on a webserver
*only* hosting images and php scripts?

While these may seem like they are both &quot;non-executing&quot; ways of
processing (as apposed to the obvious execution of a CGI script), they
are still executing code.

* All request still require HTTP parsing and there could be a buffer
overflow in this parsing code.

* Most images are static, but they can be dynamic (rendered from a
script - such as CAPTCHAs, routes on maps, etc).  So there could be
external code executed.

* PHP is typically handled in two ways.  You can load mod_php and then
the PHP processing is executed within the Apache processing space.
Another (maybe even more common method due to threading issues in php)
is running PHP as a fast-cgi application, which runs the PHP processing
within a separate processing space which Apache then communicates via
IPC.  In either case any buffer overflow in PHP processing may mean that
protections could be bypassed, or worse allow for arbitrary code
execution.  You may think you are protected because the code normally is
running as a non-admin user (www-data, apache, nobody, etc), but if
there is a local exploit on your machine, then this code could be
escalated into running arbitrary code as root.

* And of course there is the possibility of a buffer overflow in the SSL
processing.

* Other exploits could target the caching sub-system (mod_cache), etc.
which would even put static images and pages at risk.


&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> e.) What is the point of installing modsecurity aside from certain
</I>&gt;&gt;<i> protection of DoS attacks, or security awareness if I host an apache
</I>&gt;&gt;<i> webserver with only html pages?
</I>&gt;<i> 
</I>&gt;<i> I would say that ModSecurity has little to add in that situation.
</I>
You mean only *static*, on disk data, not generated HTML?  Even
seemingly static HTML may be combining headers/footers at runtime.
Also, even static sites generally will have some sort of authentication,
sessions and may even process requests with parameters, but still serve
static data.  But Ivan is correct, ModSecurity really will not help you
as much as it is meant for processing the request/response data.

However, a few exceptions that I can think of:

* Running as a caching reverse-proxy in front of web servers that may be
vulnerable to attacks and cannot be patched/updated for any number of
reasons.

* Aiding in the prevention of path traversal attacks.  That is,
preventing a user from getting to data that the user may not have been
authorized for.

* Aiding in detecting issues with authentication (credentials) and
authorization (sessions).

* Aiding in the detection of site defacement (ie making sure outgoing
data is okay).

* Aiding in the detection of data theft (ie private data leaving the
server, such as confidential documents, etc.)

* Providing a full audit log of requests (all or maybe just for
confidential docs).

* Aiding in the prevention of site scraping.

-B

-- 
Brian Rectanus
Breach Security
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000295.html">[Owasp-modsecurity-core-rule-set] basic questions of apache	exploitation &amp; modsecurity.
</A></li>
	<LI>Next message: <A HREF="000297.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] base	rules phpids
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#296">[ date ]</a>
              <a href="thread.html#296">[ thread ]</a>
              <a href="subject.html#296">[ subject ]</a>
              <a href="author.html#296">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
