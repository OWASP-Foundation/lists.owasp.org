<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] [mod-security-users] Help	formatting XSS block
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5Bmod-security-users%5D%20Help%0A%09formatting%20XSS%20block&In-Reply-To=200907210841.24644.ryan.barnett%40breach.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000002.html">
   <LINK REL="Next"  HREF="000004.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] [mod-security-users] Help	formatting XSS block</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=%5BOwasp-modsecurity-core-rule-set%5D%20%5Bmod-security-users%5D%20Help%0A%09formatting%20XSS%20block&In-Reply-To=200907210841.24644.ryan.barnett%40breach.com"
       TITLE="[Owasp-modsecurity-core-rule-set] [mod-security-users] Help	formatting XSS block">ryan.barnett at breach.com
       </A><BR>
    <I>Fri Jul 31 17:07:53 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000002.html">[Owasp-modsecurity-core-rule-set] Release of OWASP ModSecurity Core	Rule Set (CRS) v2.0.0
</A></li>
        <LI>Next message: <A HREF="000004.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] Help	formatting XSS block
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3">[ date ]</a>
              <a href="thread.html#3">[ thread ]</a>
              <a href="subject.html#3">[ subject ]</a>
              <a href="author.html#3">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please excuse the cross-postings but I want to jumpstart moving these types of 
Mod rules discussions over to the OWASP list.

Just a follow-up - the new CRS 2.0.0 has significant updates for XSS 
protections.  Specifically, the Ha.ckers XSS Cheatsheet 
(<A HREF="http://ha.ckers.org/xss.html">http://ha.ckers.org/xss.html</A>) was reviewed and rules were updated to reflect 
the different vectors.  Additionally, the WASC Script Mapping Project 
(<A HREF="http://projects.webappsec.org/Script-Mapping">http://projects.webappsec.org/Script-Mapping</A>) was reviewed and all html event 
handlers were included.

As a side note - at the Blac

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
<A HREF="http://tacticalwebappsec.blogspot.com">http://tacticalwebappsec.blogspot.com</A>


On Tuesday 21 July 2009 08:41:24 am Ryan Barnett wrote:
&gt;<i> On Tuesday 21 July 2009 12:20:34 am Bill Bradley wrote:
</I>&gt;<i> &gt; Bill Bradley
</I>&gt;<i> &gt;  to mod-security-u.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; show details 11:24 AM (11 hours ago)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Reply
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;         Follow up message
</I>&gt;<i> &gt; Hey All,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I am new to modsecurity
</I>&gt;<i>
</I>&gt;<i> Hey Bill, welcome aboard!
</I>&gt;<i>
</I>&gt;<i> &gt; but have implemented the
</I>&gt;<i> &gt; modsecurity_crs_40_generic_attacks.conf from the optional_rules
</I>&gt;<i> &gt; directory to block and log XSS scripting.  So far it is working great.
</I>&gt;<i>
</I>&gt;<i> The current Core Rule Set (CRS) does a decent job against most attack
</I>&gt;<i> payload classes (including XSS) but as you found out, they are not perfect.
</I>&gt;<i>  The only way that they will get better is if users report these
</I>&gt;<i> bypass/evasion issues. So thank you for reporting this issue.  By the way -
</I>&gt;<i> we have an official JIRA ticketing system so you can report issues there
</I>&gt;<i> and it will be properly tracked to resolution -
</I>&gt;<i> <A HREF="https://www.modsecurity.org/tracker/">https://www.modsecurity.org/tracker/</A>
</I>&gt;<i>
</I>&gt;<i> Also of note - we will be releasing CRS version 2.0 within the week which
</I>&gt;<i> will include significant updates to the rules including a separate rule set
</I>&gt;<i> just for XSS.
</I>&gt;<i>
</I>&gt;<i> &gt; The app is being tested by penetration folks and they are still able
</I>&gt;<i> &gt; to pass on XSS attack:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; XSS vulnerability found in backend parameter. The following attack
</I>&gt;<i> &gt; targets all browser(s) and was successful using plain
</I>&gt;<i> &gt; encoding:
</I>&gt;<i> &gt; &quot;&gt;&lt;iMg SrC=x OnErRoR=window.location=42114&gt;
</I>&gt;<i>
</I>&gt;<i> If you look in the modsecurity_crs_40_generic_attacks.conf file, you will
</I>&gt;<i> see the XSS section.  It starts off with the set-based pattern matching
</I>&gt;<i> pre- qualifiers where it is looking for any core keywords for the attack
</I>&gt;<i> class -
</I>&gt;<i>
</I>&gt;<i> SecRule REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
</I>&gt;<i> XML:/*|!REQUEST_HEADERS:Referer &quot;@pm jscript onsubmit copyparentfolder
</I>&gt;<i> javas cript meta onchange onmove onkeydown onkeyup activexobject onmouseup
</I>&gt;<i> ecmascript bexpression onmouseover vbscript: &lt;![cdata[ http: .innerhtml
</I>&gt;<i> settimeout shell: onabort asfunction: onkeypress onmousedown onclick
</I>&gt;<i> .fromcharcode background-image: .cookie ondragdrop onblur x-javascript
</I>&gt;<i> mocha: javascript: onfocus lowsrc getparentfolder onresize @import alert
</I>&gt;<i> script onselect onmouseout application onmousemove background .execscript
</I>&gt;<i> livescript: vbscript getspecialfolder .addimport iframe onunload
</I>&gt;<i> createtextrange &lt;input onload&quot;
</I>&gt;<i>
</I>&gt;<i> In looking at these keywords, there are other browser/DOM actions such as
</I>&gt;<i> onblur, onfocus, onmousemove, etc...  but it doesn't appear that we have
</I>&gt;<i> one for your example payload - onerror.  So, I would go ahead and add the
</I>&gt;<i> following rule to a modsecurity_crs_15_customrules.conf file -
</I>&gt;<i>
</I>&gt;<i> SecRule REQUEST_FILENAME|ARGS|ARGS_NAMES &quot;\bonerror\b\W*?\=&quot; \
</I>&gt;<i>        
</I>&gt;<i> &quot;phase:2,deny,capture,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
</I>&gt;<i>rcase,ctl:auditLogParts=+E,log,auditlog,msg:'Cross- site Scripting (XSS)
</I>&gt;<i> Attack',id:'1',tag:'WEB_ATTACK/XSS',logdata:'%{TX.0}',severity:'2'&quot;
</I>&gt;<i>
</I>&gt;<i> I tested this new rule against the following example request -
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://www.example.com/cgi-bin/test-cgi?foo=&quot;">http://www.example.com/cgi-bin/test-cgi?foo=&quot;</A>&gt;&lt;iMg SrC=x
</I>&gt;<i> OnErRoR=window.location=42114&gt;
</I>&gt;<i>
</I>&gt;<i> The rule triggered appropriately and generated the following alert in the
</I>&gt;<i> Apache error_log file -
</I>&gt;<i>
</I>&gt;<i> [Sun May 31 02:25:14 2009] [error] [client 192.168.1.103] ModSecurity:
</I>&gt;<i> Access denied with code 403 (phase 2). Pattern match
</I>&gt;<i> &quot;\\bonerror\\b\\W*?\\=&quot; at ARGS:foo. [file
</I>&gt;<i> &quot;/usr/local/apache/conf/enhanced_rule_set-1.7.0/base_rules/modsecurity_ers_
</I>&gt;<i>15_customrules.conf&quot;] [line &quot;2&quot;] [id &quot;958409&quot;] [msg &quot;Cross-site Scripting
</I>&gt;<i> (XSS) Attack&quot;] [data &quot;onerror=&quot;] [severity &quot;CRITICAL&quot;] [tag
</I>&gt;<i> &quot;WEB_ATTACK/XSS&quot;] [hostname &quot;www.example.com&quot;] [uri &quot;/cgi-bin/test-cgi&quot;]
</I>&gt;<i> [unique_id &quot;SiIiyn8AAQEAABGXB- QAAAAA&quot;]
</I>&gt;<i>
</I>&gt;<i> Hope this info helps,
</I>&gt;<i> Ryan
</I>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/36dbe3bc/attachment.html">https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/36dbe3bc/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000002.html">[Owasp-modsecurity-core-rule-set] Release of OWASP ModSecurity Core	Rule Set (CRS) v2.0.0
</A></li>
	<LI>Next message: <A HREF="000004.html">[Owasp-modsecurity-core-rule-set] [mod-security-users] Help	formatting XSS block
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3">[ date ]</a>
              <a href="thread.html#3">[ thread ]</a>
              <a href="subject.html#3">[ subject ]</a>
              <a href="author.html#3">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
