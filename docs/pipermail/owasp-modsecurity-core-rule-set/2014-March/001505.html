<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Session Highjacking Rules, Existence of Variable Collection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Session%20Highjacking%20Rules%2C%0A%20Existence%20of%20Variable%20Collection&In-Reply-To=%3CCF3B60A7.D7D2E%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001504.html">
   <LINK REL="Next"  HREF="001506.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Session Highjacking Rules, Existence of Variable Collection</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Session%20Highjacking%20Rules%2C%0A%20Existence%20of%20Variable%20Collection&In-Reply-To=%3CCF3B60A7.D7D2E%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Session Highjacking Rules, Existence of Variable Collection">RBarnett at trustwave.com
       </A><BR>
    <I>Tue Mar  4 15:53:35 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001504.html">[Owasp-modsecurity-core-rule-set] Session Highjacking Rules,	Existence of Variable Collection
</A></li>
        <LI>Next message: <A HREF="001506.html">[Owasp-modsecurity-core-rule-set] Session Highjacking Rules, Existence of Variable Collection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1505">[ date ]</a>
              <a href="thread.html#1505">[ thread ]</a>
              <a href="subject.html#1505">[ subject ]</a>
              <a href="author.html#1505">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>What CRS version are you running?  In the current verion (2.2.9) in GitHub
repo, there is this line -

<A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/optional_ru">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/optional_ru</A>
les/modsecurity_crs_16_session_hijacking.conf#L27


This checks the inbound request for the existence of popular SessionID
cookie names.  If they are NOT found, then it will skip the inbound
session hijacking checks.

Ryan Barnett
Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com &lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;




On 3/3/14 1:18 PM, &quot;Ramy Darwish&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jackbro.pluckah at gmail.com</A>&gt; wrote:

&gt;<i>Reposting as plain text for formatting...
</I>&gt;<i>------------------------------------------------------------
</I>&gt;<i>Hi everyone!
</I>&gt;<i>
</I>&gt;<i>I'm trying to fit the Session Highjacking rules
</I>&gt;<i>(modsecurity_crs_16_session_hijacking.conf) to my web app.
</I>&gt;<i>My problem was described by someone else (but apparently never solved)
</I>&gt;<i>on that older post on the modsecurity-users list:
</I>&gt;<i><A HREF="http://sourceforge.net/p/mod-security/mailman/message/30069414/">http://sourceforge.net/p/mod-security/mailman/message/30069414/</A>
</I>&gt;<i>
</I>&gt;<i>The Session Highjacking rules look at request and response cookies to
</I>&gt;<i>find or create a new sessions.
</I>&gt;<i>That works perfectly.
</I>&gt;<i>However, the two rules after it will run in ANY case, even when no
</I>&gt;<i>sessions has been initialized:
</I>&gt;<i>-----------------------------------------
</I>&gt;<i>SecRule REMOTE_ADDR
</I>&gt;<i>&quot;^(\d{1,3}\.\d{1,3}\.\d{1,3}\.)&quot;&quot;chain,phase:3,id:'981063',capture,t:none,
</I>&gt;<i>nolog,pass&quot;
</I>&gt;<i>     SecRule TX:1
</I>&gt;<i>&quot;.*&quot;&quot;t:sha1,t:hexEncode,setvar:session.ip_hash=%{matched_var}&quot;
</I>&gt;<i>SecRule REQUEST_HEADERS:User-Agent
</I>&gt;<i>&quot;.*&quot;&quot;phase:3,id:'981064',t:none,t:sha1,t:hexEncode,nolog,pass,setvar:sessi
</I>&gt;<i>on.ua_hash=%{matched_var}&quot;
</I>&gt;<i>-----------------------------------------
</I>&gt;<i>
</I>&gt;<i>Because the session collection wasn't initialized (e.g. for anonymous
</I>&gt;<i>users or bots),
</I>&gt;<i>the setvars fail and the log is filled with errors like:
</I>&gt;<i>-----------------------------------------
</I>&gt;<i>[example.com/sid#7fc5067fe380][rid#7fc4f43380a0][/path/to/file][3] Could
</I>&gt;<i>not set variable &quot;session.ip_hash&quot; as the collection does not exist.
</I>&gt;<i>[example.com/sid#7fc5067fe380][rid#7fc4f43380a0][/path/to/file][3] Could
</I>&gt;<i>not set variable &quot;session.ua_hash&quot; as the collection does not exist.
</I>&gt;<i>-----------------------------------------
</I>&gt;<i>
</I>&gt;<i>To avoid this problem, I would like to chain these rules with a
</I>&gt;<i>Collection existence check, to avoid non-existence errors.
</I>&gt;<i>My two questions:
</I>&gt;<i>
</I>&gt;<i>   1/ I don't know how to test for the existence of the session
</I>&gt;<i>collection.
</I>&gt;<i>      I don't know if it makes a difference that the rule is parsed on
</I>&gt;<i>phase 3 (response headers).
</I>&gt;<i>
</I>&gt;<i>   2/ More importantly, it seems like  even chaining it to an impossible
</I>&gt;<i>rule
</I>&gt;<i>      (e.g. SecRule &amp;ARGS:x58t4z5 &quot;@gt 128&quot;) will not stop it from
</I>&gt;<i>logging these errors!
</I>&gt;<i>      Maybe I misunderstood chaining or variable collections, but I
</I>&gt;<i>can't seem to comprehend this issue!
</I>&gt;<i>
</I>&gt;<i>If anyone can enlighten me on either or both, I'd be delighted to hear
</I>&gt;<i>your advice. Thanks!
</I>&gt;<i>
</I>&gt;<i>Ramy
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001504.html">[Owasp-modsecurity-core-rule-set] Session Highjacking Rules,	Existence of Variable Collection
</A></li>
	<LI>Next message: <A HREF="001506.html">[Owasp-modsecurity-core-rule-set] Session Highjacking Rules, Existence of Variable Collection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1505">[ date ]</a>
              <a href="thread.html#1505">[ thread ]</a>
              <a href="subject.html#1505">[ subject ]</a>
              <a href="author.html#1505">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
