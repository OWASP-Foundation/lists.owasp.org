<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Syntax%20error%20on%20line%2051%20of%0A%09/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf&In-Reply-To=%3CB6DD107C-6E11-489D-95E8-680B5141A73A%40owasp.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001519.html">
   <LINK REL="Next"  HREF="001521.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Syntax%20error%20on%20line%2051%20of%0A%09/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf&In-Reply-To=%3CB6DD107C-6E11-489D-95E8-680B5141A73A%40owasp.org%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf">ryan.barnett at owasp.org
       </A><BR>
    <I>Wed Mar 19 17:22:16 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001519.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
        <LI>Next message: <A HREF="001521.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1520">[ date ]</a>
              <a href="thread.html#1520">[ thread ]</a>
              <a href="subject.html#1520">[ subject ]</a>
              <a href="author.html#1520">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes probably the best option if you can't upgrade. 

Ryan Barnett
OWASP ModSecurity CRS Project Leader

&gt;<i> On Mar 19, 2014, at 1:12 PM, Jamie Jackson &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamiejaxon at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> [I neglected to Reply-All. I accidentally sent the following to just Ryan. Oldest to newest:]
</I>&gt;<i> 
</I>&gt;<i> Thanks, Ryan.
</I>&gt;<i> 
</I>&gt;<i> I'll ask on the ModSecurity mailing list about a package-management-friendly way to upgrade ModSecurity
</I>&gt;<i> 
</I>&gt;<i> -----
</I>&gt;<i> 
</I>&gt;<i> Actually, Ryan, I just came across the 2.7 rule-removing script in your Git repo: <A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/util/rule-management/remove-2.7-actions.pl">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/util/rule-management/remove-2.7-actions.pl</A>
</I>&gt;<i> 
</I>&gt;<i> If it proves too much of a pain (I think it will) to upgrade the distro's (Ubuntu 12.04 and CentOS 6.4) ModSecurity, is that removal script the next best thing?
</I>&gt;<i> 
</I>&gt;<i> -----
</I>&gt;<i> 
</I>&gt;<i> Unless I'm doing something wrong, the script doesn't seem to do anything:
</I>&gt;<i> 
</I>&gt;<i> # perl /tmp/remove-2.7-actions.pl -t 2.6 -f /etc/modsecurity/optional_rules/ -n -v
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_16_authentication_tracking.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_49_header_tagging.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_42_comment_spam.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_55_marketing.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_11_avs_traffic.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_13_xml_enabler.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_47_skip_outbound_checks.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_16_username_tracking.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_55_application_defects.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_16_session_hijacking.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_43_csrf_protection.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_25_cc_known.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_10_ignore_static.conf
</I>&gt;<i> Processing /etc/modsecurity/optional_rules/modsecurity_crs_46_av_scanning.conf
</I>&gt;<i> 
</I>&gt;<i> I diffed a before and after copy of the directory, and they're the same.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;&gt;<i> On Wed, Mar 19, 2014 at 10:01 AM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">RBarnett at trustwave.com</A>&gt; wrote:
</I>&gt;&gt;<i> The &quot;ver&quot; action (<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ver">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ver</A>) is only available in ModSecurity v2.7.x &lt;.  You need to upgrade.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Ryan Barnett
</I>&gt;&gt;<i> Lead Security Researcher, SpiderLabs
</I>&gt;&gt;<i>  
</I>&gt;&gt;<i> Trustwave | SMART SECURITY ON DEMAND
</I>&gt;&gt;<i> www.trustwave.com
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> From: Jamie Jackson &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamiejaxon at gmail.com</A>&gt;
</I>&gt;&gt;<i> Date: Wednesday, March 19, 2014 9:39 AM
</I>&gt;&gt;<i> Cc: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;&gt;<i> Subject: Re: [Owasp-modsecurity-core-rule-set] Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks, Ramy.
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Now I'm past that, and onto the next syntax error:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> $ sudo service apache2 restart
</I>&gt;&gt;<i> [Wed Mar 19 09:37:10 2014] [warn] module jrun_module is already loaded, skipping
</I>&gt;&gt;<i> [Wed Mar 19 09:37:10 2014] [warn] module jrun_module is already loaded, skipping
</I>&gt;&gt;<i> [Wed Mar 19 09:37:10 2014] [warn] module jrun_module is already loaded, skipping
</I>&gt;&gt;<i> Syntax error on line 52 of /etc/modsecurity/activated_rules/modsecurity_crs_20_protocol_violations.conf:
</I>&gt;&gt;<i> Error parsing actions: Unknown action: ver
</I>&gt;&gt;<i> Action 'configtest' failed.
</I>&gt;&gt;<i> The Apache error log may have more information.
</I>&gt;&gt;<i>    ...fail!
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Line 52 is the last of this block:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> SecRule REQUEST_LINE &quot;!^(?i:(?:[a-z]{3,10}\s+(?:\w{3,7}?://[\w\-\./]*(?::\d+)?)?/[^?#]*(?:\?[^#\s]*)?(?:#[\S]*)?|connect (?:\d{1,3}\.){3}\d{1,3}\.?(?::\d+)?|options \*)\s+[\w\./]+|get /[^?#]*(?:\?[^#\s]*)?(?:#[\S]*)?)$&quot;\
</I>&gt;&gt;<i>   &quot;msg:'Invalid HTTP Request Line',\
</I>&gt;&gt;<i>   severity:'4',\
</I>&gt;&gt;<i>   id:'960911',\
</I>&gt;&gt;<i>   ver:'OWASP_CRS/2.2.9',\
</I>&gt;&gt;<i>   rev:'2',\
</I>&gt;&gt;<i>   maturity:'9',\
</I>&gt;&gt;<i>   accuracy:'9',\
</I>&gt;&gt;<i>   logdata:'%{request_line}',\
</I>&gt;&gt;<i>   phase:1,\
</I>&gt;&gt;<i>   block,\
</I>&gt;&gt;<i>   t:none,\
</I>&gt;&gt;<i>   tag:'OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ',\
</I>&gt;&gt;<i>   tag:'CAPEC-272',\
</I>&gt;&gt;<i>   setvar:'tx.msg=%{rule.msg}',\
</I>&gt;&gt;<i>   setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},\
</I>&gt;&gt;<i>   setvar:'tx.%{rule.id}-OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ-%{matched_var_name}=%{matched_var}'&quot;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On Wed, Mar 19, 2014 at 9:31 AM, Ramy Darwish &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jackbro.pluckah at gmail.com</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> Woops, that's actually a new contribution by me. My bad.
</I>&gt;&gt;&gt;<i> I guess a newbie like me needs more supervision on Pull requests =S
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> The problem is actually on line 49, which specifies a &quot;chain&quot; where it should not.
</I>&gt;&gt;&gt;<i> On line 49, replace:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> SecRule TX:1 &quot;.*&quot; &quot;chain,t:sha1,t:hexEncode,setvar:session.ip_hash=%{matched_var}&quot;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> with:
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> SecRule TX:1 &quot;.*&quot; &quot;t:sha1,t:hexEncode,setvar:session.ip_hash=%{matched_var}&quot;
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Issuing a pull request right now.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> So sorry, everyone.
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> Ramy Darwish
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;<i> On 19/03/2014 13:58, Jamie Jackson wrote:
</I>&gt;&gt;&gt;&gt;<i> Hi Folks,
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> [Server version: Apache/2.2.22 (Ubuntu)]
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I'm following along with this guide (<A HREF="http://www.thefanclub.co.za/how-to/how-install-apache2-modsecurity-and-modevasive-ubuntu-1204-lts-server">http://www.thefanclub.co.za/how-to/how-install-apache2-modsecurity-and-modevasive-ubuntu-1204-lts-server</A>), and I got to the apache restart command just before section 5.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> However, I'm getting a rule error:
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> $ sudo service apache2 restart
</I>&gt;&gt;&gt;&gt;<i> [sudo] password for jamie: 
</I>&gt;&gt;&gt;&gt;<i> Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf:
</I>&gt;&gt;&gt;&gt;<i> ModSecurity: Disruptive actions can only be specified by chain starter rules.
</I>&gt;&gt;&gt;&gt;<i> Action 'configtest' failed.
</I>&gt;&gt;&gt;&gt;<i> The Apache error log may have more information.
</I>&gt;&gt;&gt;&gt;<i>    ...fail!
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> The line referenced is the last line of the file (the second of the following):
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> SecRule &amp;SESSION:SESSIONID &quot;@eq 1&quot; &quot;chain,phase:5,id:'981064',nolog,pass,t:none&quot;
</I>&gt;&gt;&gt;&gt;<i>         SecRule REQUEST_HEADERS:User-Agent &quot;.*&quot; &quot;t:none,t:sha1,t:hexEncode,nolog,setvar:session.ua_hash=%{matched_var}&quot;
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> I have zero experience with ModSecurity yet, so I can't troubleshoot.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Please help me get past this.
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> Thanks,
</I>&gt;&gt;&gt;&gt;<i> Jamie
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> 
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.orghttps</A>://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140319/70a8046d/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140319/70a8046d/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001519.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
	<LI>Next message: <A HREF="001521.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1520">[ date ]</a>
              <a href="thread.html#1520">[ thread ]</a>
              <a href="subject.html#1520">[ subject ]</a>
              <a href="author.html#1520">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
