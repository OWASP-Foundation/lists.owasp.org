<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Syntax%20error%20on%20line%2051%20of%0A%20/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf&In-Reply-To=%3CCF4F1B2E.E26C4%25rbarnett%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001517.html">
   <LINK REL="Next"  HREF="001519.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Syntax%20error%20on%20line%2051%20of%0A%20/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf&In-Reply-To=%3CCF4F1B2E.E26C4%25rbarnett%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf">RBarnett at trustwave.com
       </A><BR>
    <I>Wed Mar 19 14:01:29 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001517.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
        <LI>Next message: <A HREF="001519.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1518">[ date ]</a>
              <a href="thread.html#1518">[ thread ]</a>
              <a href="subject.html#1518">[ subject ]</a>
              <a href="author.html#1518">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The &quot;ver&quot; action (<A HREF="https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ver">https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ver</A>) is only available in ModSecurity v2.7.x &lt;.  You need to upgrade.

Ryan Barnett
Lead Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;

From: Jamie Jackson &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamiejaxon at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamiejaxon at gmail.com</A>&gt;&gt;
Date: Wednesday, March 19, 2014 9:39 AM
Cc: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf

Thanks, Ramy.

Now I'm past that, and onto the next syntax error:

$ sudo service apache2 restart
[Wed Mar 19 09:37:10 2014] [warn] module jrun_module is already loaded, skipping
[Wed Mar 19 09:37:10 2014] [warn] module jrun_module is already loaded, skipping
[Wed Mar 19 09:37:10 2014] [warn] module jrun_module is already loaded, skipping
Syntax error on line 52 of /etc/modsecurity/activated_rules/modsecurity_crs_20_protocol_violations.conf:
Error parsing actions: Unknown action: ver
Action 'configtest' failed.
The Apache error log may have more information.
   ...fail!

Line 52 is the last of this block:

SecRule REQUEST_LINE &quot;!^(?i:(?:[a-z]{3,10}\s+(?:\w{3,7}?://[\w\-\./]*(?::\d+)?)?/[^?#]*(?:\?[^#\s]*)?(?:#[\S]*)?|connect (?:\d{1,3}\.){3}\d{1,3}\.?(?::\d+)?|options \*)\s+[\w\./]+|get /[^?#]*(?:\?[^#\s]*)?(?:#[\S]*)?)$&quot;\
  &quot;msg:'Invalid HTTP Request Line',\
  severity:'4',\
  id:'960911',\
  ver:'OWASP_CRS/2.2.9',\
  rev:'2',\
  maturity:'9',\
  accuracy:'9',\
  logdata:'%{request_line}',\
  phase:1,\
  block,\
  t:none,\
  tag:'OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ',\
  tag:'CAPEC-272',\
  setvar:'tx.msg=%{rule.msg}',\
  setvar:tx.anomaly_score=+%{tx.notice_anomaly_score},\
  setvar:'tx.%{rule.id&lt;<A HREF="http://rule.id">http://rule.id</A>&gt;}-OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ-%{matched_var_name}=%{matched_var}'&quot;



On Wed, Mar 19, 2014 at 9:31 AM, Ramy Darwish &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jackbro.pluckah at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jackbro.pluckah at gmail.com</A>&gt;&gt; wrote:
Woops, that's actually a new contribution by me. My bad.
I guess a newbie like me needs more supervision on Pull requests =S

The problem is actually on line 49, which specifies a &quot;chain&quot; where it should not.
On line 49, replace:

SecRule TX:1 &quot;.*&quot; &quot;chain,t:sha1,t:hexEncode,setvar:session.ip_hash=%{matched_var}&quot;

with:

SecRule TX:1 &quot;.*&quot; &quot;t:sha1,t:hexEncode,setvar:session.ip_hash=%{matched_var}&quot;

Issuing a pull request right now.

So sorry, everyone.

Ramy Darwish



On 19/03/2014 13:58, Jamie Jackson wrote:
Hi Folks,

[Server version: Apache/2.2.22 (Ubuntu)]

I'm following along with this guide (<A HREF="http://www.thefanclub.co.za/how-to/how-install-apache2-modsecurity-and-modevasive-ubuntu-1204-lts-server">http://www.thefanclub.co.za/how-to/how-install-apache2-modsecurity-and-modevasive-ubuntu-1204-lts-server</A>), and I got to the apache restart command just before section 5.

However, I'm getting a rule error:

$ sudo service apache2 restart
[sudo] password for jamie:
Syntax error on line 51 of /etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf:
ModSecurity: Disruptive actions can only be specified by chain starter rules.
Action 'configtest' failed.
The Apache error log may have more information.
   ...fail!

The line referenced is the last line of the file (the second of the following):

SecRule &amp;SESSION:SESSIONID &quot;@eq 1&quot; &quot;chain,phase:5,id:'981064',nolog,pass,t:none&quot;
        SecRule REQUEST_HEADERS:User-Agent &quot;.*&quot; &quot;t:none,t:sha1,t:hexEncode,nolog,setvar:session.ua_hash=%{matched_var}&quot;

I have zero experience with ModSecurity yet, so I can't troubleshoot.

Please help me get past this.

Thanks,
Jamie



_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>



________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140319/7db53674/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20140319/7db53674/attachment-0001.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001517.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
	<LI>Next message: <A HREF="001519.html">[Owasp-modsecurity-core-rule-set] Syntax error on line 51 of	/etc/modsecurity/activated_rules/modsecurity_crs_16_session_hijacking.conf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1518">[ date ]</a>
              <a href="thread.html#1518">[ thread ]</a>
              <a href="subject.html#1518">[ subject ]</a>
              <a href="author.html#1518">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
