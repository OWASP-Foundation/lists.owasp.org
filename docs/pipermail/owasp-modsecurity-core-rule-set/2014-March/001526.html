<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Apache%20Error%3A%20Invalid%20URI%20in%0A%09Request.&In-Reply-To=%3CCAHno4i9hhFZRvqXaEFnt8DUpiGJwfXDy%2BabwbdZX7vU0KT8wqw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001525.html">
   <LINK REL="Next"  HREF="001527.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.</H1>
    <B>Jamie Riden</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Apache%20Error%3A%20Invalid%20URI%20in%0A%09Request.&In-Reply-To=%3CCAHno4i9hhFZRvqXaEFnt8DUpiGJwfXDy%2BabwbdZX7vU0KT8wqw%40mail.gmail.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.">jamie.riden at gmail.com
       </A><BR>
    <I>Thu Mar 20 15:13:44 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001525.html">[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.
</A></li>
        <LI>Next message: <A HREF="001527.html">[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in Request.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1526">[ date ]</a>
              <a href="thread.html#1526">[ thread ]</a>
              <a href="subject.html#1526">[ subject ]</a>
              <a href="author.html#1526">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm no expert either, but it seems to be deciding this based on the
Apache response.

If you disable mod_sec briefly, and re-send the request, what response
do you get?

cheers,
 Jamie


<A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules/modsecurity_crs_20_protocol_violations.conf">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules/modsecurity_crs_20_protocol_violations.conf</A>
#
# Identify Invalid URIs Blocked by Apache
#
# -=[ Rule Logic ]=-
#
# There are some request violations that Apache will handle
internally, prior to the
# ModSecurity phase:1 POST-READ-REQUEST hook.  For these requests, we
can still get
# visibility by running a check in phase:5 logging to look for the
Apache error msg.
#
# -=[ References ]=-
#
SecRule WEBSERVER_ERROR_LOG &quot;@contains Invalid URI in request&quot; \
  &quot;msg:'Apache Error: Invalid URI in Request.', \
  severity:'4', \
  id:'981227', \
  ver:'OWASP_CRS/2.2.9', \
  rev:'1', \
  maturity:'9', \
  accuracy:'9', \
  logdata:'%{request_line}', \
  phase:5, \
  pass, \
  t:none, \
  tag:'OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ', \
  tag:'CAPEC-272', \
  setvar:'tx.msg=%{rule.msg}', \
  setvar:tx.anomaly_score=+%{tx.notice_anomaly_score}, \
  setvar:'tx.%{rule.id}-OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ-%{matched_var_name}=%{matched_var}'&quot;

On 20 March 2014 15:02, Jamie Jackson &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamiejaxon at gmail.com</A>&gt; wrote:
&gt;<i> Hi Folks,
</I>&gt;<i>
</I>&gt;<i> I'm just getting started experimenting with the CRS, so I'm going to have a
</I>&gt;<i> bunch of questions about some of the default rules.
</I>&gt;<i>
</I>&gt;<i> Here's the first: I can't spot a problem in the requested URI. (In fact, it
</I>&gt;<i> looks typical to me.) Can you help me figure out what's triggering the
</I>&gt;<i> warning?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i> Jamie
</I>&gt;<i>
</I>&gt;<i> --aa2d203d-A--
</I>&gt;<i> [20/Mar/2014:10:55:14 --0400] UysBUn8AAQEAACbzCEMAAAAK 127.0.0.1 53771
</I>&gt;<i> 127.0.0.1 443
</I>&gt;<i> --aa2d203d-B--
</I>&gt;<i> GET / HTTP/1.1
</I>&gt;<i> Host: local.mysite.info
</I>&gt;<i> Connection: keep-alive
</I>&gt;<i> Accept:
</I>&gt;<i> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
</I>&gt;<i> User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like
</I>&gt;<i> Gecko) Chrome/33.0.1750.146 Safari/537.36
</I>&gt;<i> Referer: <A HREF="https://local.mysite.info/">https://local.mysite.info/</A>
</I>&gt;<i> Accept-Encoding: gzip,deflate,sdch
</I>&gt;<i> Accept-Language: en-US,en;q=0.8
</I>&gt;<i> Cookie: USERID=; USERHASH=;
</I>&gt;<i> ORIGINALURLTOKEN=967683ED%2DD2D8%2D4EFB%2D8EA1F7D5E610EA74;
</I>&gt;<i> MOBILEFORMAT=false; CFID=155102; CFTOKEN=61883191;
</I>&gt;<i> CFAUTHORIZATION_cfadmin=YWRtaW4NNkFBQTRCN0IzNDQ4NTRFQzg0RDQzNEVBNjBDMkE1NDI1Qjk3QTQxQw1jZmFkbWlu;
</I>&gt;<i> CFADMIN_LASTPAGE_ADMIN=%2FCFIDE%2Fadministrator%2Fdebugging%2Findex%2Ecfm;
</I>&gt;<i> JSESSIONID=9830fde5266a22573ad64313382327227d5d;
</I>&gt;<i> __utma=182783035.782843501.1395323759.1395323759.1395326921.2;
</I>&gt;<i> __utmb=182783035.3.10.1395326921; __utmc=182783035;
</I>&gt;<i> __utmz=182783035.1395323759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)
</I>&gt;<i>
</I>&gt;<i> --aa2d203d-F--
</I>&gt;<i> HTTP/1.1 200 OK
</I>&gt;<i> Content-Language: en-US
</I>&gt;<i> Vary: Accept-Encoding
</I>&gt;<i> Content-Encoding: gzip
</I>&gt;<i> Keep-Alive: timeout=5, max=100
</I>&gt;<i> Connection: Keep-Alive
</I>&gt;<i> Transfer-Encoding: chunked
</I>&gt;<i> Content-Type: text/html; charset=UTF-8
</I>&gt;<i>
</I>&gt;<i> --aa2d203d-E--
</I>&gt;<i>
</I>&gt;<i> &lt;snip&gt;
</I>&gt;<i>
</I>&gt;<i> --aa2d203d-H--
</I>&gt;<i> Message: Warning. String match &quot;Invalid URI in request&quot; at
</I>&gt;<i> WEBSERVER_ERROR_LOG. [file
</I>&gt;<i> &quot;/etc/modsecurity/activated_rules/modsecurity_crs_20_protocol_violations.conf&quot;]
</I>&gt;<i> [line &quot;82&quot;] [id &quot;981227&quot;] [rev &quot;1&quot;] [msg &quot;Apache Error: Invalid URI in
</I>&gt;<i> Request.&quot;] [data &quot;GET / HTTP/1.1&quot;] [severity &quot;WARNING&quot;] [tag
</I>&gt;<i> &quot;OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ&quot;] [tag &quot;CAPEC-272&quot;]
</I>&gt;<i> Apache-Error: [file &quot;core.c&quot;] [line 3558] [level 3] Invalid URI in request
</I>&gt;<i> GET / HTTP/1.1, referer: <A HREF="https://local.mysite.info/">https://local.mysite.info/</A>
</I>&gt;<i> Apache-Handler: jrun-handler
</I>&gt;<i> Stopwatch: 1395327314069020 371594 (- - -)
</I>&gt;<i> Stopwatch2: 1395327314069020 371594; combined=23196, p1=524, p2=11283,
</I>&gt;<i> p3=38, p4=10878, p5=467, sr=154, sw=6, l=0, gc=0
</I>&gt;<i> Response-Body-Transformed: Dechunked
</I>&gt;<i> Producer: ModSecurity for Apache/2.6.6 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;<i> OWASP_CRS/2.2.9.
</I>&gt;<i> Server: Apache/2.2.22 (Ubuntu)
</I>&gt;<i> WebApp-Info: &quot;default&quot; &quot;-&quot; &quot;&quot;
</I>&gt;<i>
</I>&gt;<i> --aa2d203d-Z--
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;<i>
</I>


-- 
Jamie Riden / <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamie at honeynet.org</A> / <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamie.riden at gmail.com</A>
<A HREF="http://uk.linkedin.com/in/jamieriden">http://uk.linkedin.com/in/jamieriden</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001525.html">[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.
</A></li>
	<LI>Next message: <A HREF="001527.html">[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in Request.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1526">[ date ]</a>
              <a href="thread.html#1526">[ thread ]</a>
              <a href="subject.html#1526">[ subject ]</a>
              <a href="author.html#1526">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
