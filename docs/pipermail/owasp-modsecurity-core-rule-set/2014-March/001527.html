<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in Request.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Apache%20Error%3A%20Invalid%20URI%20in%0A%20Request.&In-Reply-To=%3CCF508106.E292D%25ryan.barnett%40owasp.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001526.html">
   <LINK REL="Next"  HREF="001529.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in Request.</H1>
    <B>Ryan Barnett</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Apache%20Error%3A%20Invalid%20URI%20in%0A%20Request.&In-Reply-To=%3CCF508106.E292D%25ryan.barnett%40owasp.org%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in Request.">RBarnett at trustwave.com
       </A><BR>
    <I>Thu Mar 20 15:28:11 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="001526.html">[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.
</A></li>
        <LI>Next message: <A HREF="001529.html">[Owasp-modsecurity-core-rule-set] POST body is not inspected by	modsecurity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1527">[ date ]</a>
              <a href="thread.html#1527">[ thread ]</a>
              <a href="subject.html#1527">[ subject ]</a>
              <a href="author.html#1527">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 3/20/14 11:13 AM, &quot;Jamie Riden&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamie.riden at gmail.com</A>&gt; wrote:

&gt;<i>I'm no expert either, but it seems to be deciding this based on the
</I>&gt;<i>Apache response.
</I>
That is correct.  In this case, ModSecurty is alerting on Apache errors
generated by other Apache modules.

-Ryan

&gt;<i>
</I>&gt;<i>If you disable mod_sec briefly, and re-send the request, what response
</I>&gt;<i>do you get?
</I>&gt;<i>
</I>&gt;<i>cheers,
</I>&gt;<i> Jamie
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i><A HREF="https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules">https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/master/base_rules</A>
</I>&gt;<i>/modsecurity_crs_20_protocol_violations.conf
</I>&gt;<i>#
</I>&gt;<i># Identify Invalid URIs Blocked by Apache
</I>&gt;<i>#
</I>&gt;<i># -=[ Rule Logic ]=-
</I>&gt;<i>#
</I>&gt;<i># There are some request violations that Apache will handle
</I>&gt;<i>internally, prior to the
</I>&gt;<i># ModSecurity phase:1 POST-READ-REQUEST hook.  For these requests, we
</I>&gt;<i>can still get
</I>&gt;<i># visibility by running a check in phase:5 logging to look for the
</I>&gt;<i>Apache error msg.
</I>&gt;<i>#
</I>&gt;<i># -=[ References ]=-
</I>&gt;<i>#
</I>&gt;<i>SecRule WEBSERVER_ERROR_LOG &quot;@contains Invalid URI in request&quot; \
</I>&gt;<i>  &quot;msg:'Apache Error: Invalid URI in Request.', \
</I>&gt;<i>  severity:'4', \
</I>&gt;<i>  id:'981227', \
</I>&gt;<i>  ver:'OWASP_CRS/2.2.9', \
</I>&gt;<i>  rev:'1', \
</I>&gt;<i>  maturity:'9', \
</I>&gt;<i>  accuracy:'9', \
</I>&gt;<i>  logdata:'%{request_line}', \
</I>&gt;<i>  phase:5, \
</I>&gt;<i>  pass, \
</I>&gt;<i>  t:none, \
</I>&gt;<i>  tag:'OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ', \
</I>&gt;<i>  tag:'CAPEC-272', \
</I>&gt;<i>  setvar:'tx.msg=%{rule.msg}', \
</I>&gt;<i>  setvar:tx.anomaly_score=+%{tx.notice_anomaly_score}, \
</I>&gt;<i>
</I>&gt;<i>setvar:'tx.%{rule.id}-OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ-%{matched_v
</I>&gt;<i>ar_name}=%{matched_var}'&quot;
</I>&gt;<i>
</I>&gt;<i>On 20 March 2014 15:02, Jamie Jackson &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamiejaxon at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Hi Folks,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm just getting started experimenting with the CRS, so I'm going to
</I>&gt;&gt;<i>have a
</I>&gt;&gt;<i> bunch of questions about some of the default rules.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here's the first: I can't spot a problem in the requested URI. (In
</I>&gt;&gt;<i>fact, it
</I>&gt;&gt;<i> looks typical to me.) Can you help me figure out what's triggering the
</I>&gt;&gt;<i> warning?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Jamie
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --aa2d203d-A--
</I>&gt;&gt;<i> [20/Mar/2014:10:55:14 --0400] UysBUn8AAQEAACbzCEMAAAAK 127.0.0.1 53771
</I>&gt;&gt;<i> 127.0.0.1 443
</I>&gt;&gt;<i> --aa2d203d-B--
</I>&gt;&gt;<i> GET / HTTP/1.1
</I>&gt;&gt;<i> Host: local.mysite.info
</I>&gt;&gt;<i> Connection: keep-alive
</I>&gt;&gt;<i> Accept:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.
</I>&gt;&gt;<i>8
</I>&gt;&gt;<i> User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML,
</I>&gt;&gt;<i>like
</I>&gt;&gt;<i> Gecko) Chrome/33.0.1750.146 Safari/537.36
</I>&gt;&gt;<i> Referer: <A HREF="https://local.mysite.info/">https://local.mysite.info/</A>
</I>&gt;&gt;<i> Accept-Encoding: gzip,deflate,sdch
</I>&gt;&gt;<i> Accept-Language: en-US,en;q=0.8
</I>&gt;&gt;<i> Cookie: USERID=; USERHASH=;
</I>&gt;&gt;<i> ORIGINALURLTOKEN=967683ED%2DD2D8%2D4EFB%2D8EA1F7D5E610EA74;
</I>&gt;&gt;<i> MOBILEFORMAT=false; CFID=155102; CFTOKEN=61883191;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>CFAUTHORIZATION_cfadmin=YWRtaW4NNkFBQTRCN0IzNDQ4NTRFQzg0RDQzNEVBNjBDMkE1N
</I>&gt;&gt;<i>DI1Qjk3QTQxQw1jZmFkbWlu;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>CFADMIN_LASTPAGE_ADMIN=%2FCFIDE%2Fadministrator%2Fdebugging%2Findex%2Ecfm
</I>&gt;&gt;<i>;
</I>&gt;&gt;<i> JSESSIONID=9830fde5266a22573ad64313382327227d5d;
</I>&gt;&gt;<i> __utma=182783035.782843501.1395323759.1395323759.1395326921.2;
</I>&gt;&gt;<i> __utmb=182783035.3.10.1395326921; __utmc=182783035;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>__utmz=182783035.1395323759.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(n
</I>&gt;&gt;<i>one)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --aa2d203d-F--
</I>&gt;&gt;<i> HTTP/1.1 200 OK
</I>&gt;&gt;<i> Content-Language: en-US
</I>&gt;&gt;<i> Vary: Accept-Encoding
</I>&gt;&gt;<i> Content-Encoding: gzip
</I>&gt;&gt;<i> Keep-Alive: timeout=5, max=100
</I>&gt;&gt;<i> Connection: Keep-Alive
</I>&gt;&gt;<i> Transfer-Encoding: chunked
</I>&gt;&gt;<i> Content-Type: text/html; charset=UTF-8
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --aa2d203d-E--
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --aa2d203d-H--
</I>&gt;&gt;<i> Message: Warning. String match &quot;Invalid URI in request&quot; at
</I>&gt;&gt;<i> WEBSERVER_ERROR_LOG. [file
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>&quot;/etc/modsecurity/activated_rules/modsecurity_crs_20_protocol_violations.
</I>&gt;&gt;<i>conf&quot;]
</I>&gt;&gt;<i> [line &quot;82&quot;] [id &quot;981227&quot;] [rev &quot;1&quot;] [msg &quot;Apache Error: Invalid URI in
</I>&gt;&gt;<i> Request.&quot;] [data &quot;GET / HTTP/1.1&quot;] [severity &quot;WARNING&quot;] [tag
</I>&gt;&gt;<i> &quot;OWASP_CRS/PROTOCOL_VIOLATION/INVALID_REQ&quot;] [tag &quot;CAPEC-272&quot;]
</I>&gt;&gt;<i> Apache-Error: [file &quot;core.c&quot;] [line 3558] [level 3] Invalid URI in
</I>&gt;&gt;<i>request
</I>&gt;&gt;<i> GET / HTTP/1.1, referer: <A HREF="https://local.mysite.info/">https://local.mysite.info/</A>
</I>&gt;&gt;<i> Apache-Handler: jrun-handler
</I>&gt;&gt;<i> Stopwatch: 1395327314069020 371594 (- - -)
</I>&gt;&gt;<i> Stopwatch2: 1395327314069020 371594; combined=23196, p1=524, p2=11283,
</I>&gt;&gt;<i> p3=38, p4=10878, p5=467, sr=154, sw=6, l=0, gc=0
</I>&gt;&gt;<i> Response-Body-Transformed: Dechunked
</I>&gt;&gt;<i> Producer: ModSecurity for Apache/2.6.6 (<A HREF="http://www.modsecurity.org/">http://www.modsecurity.org/</A>);
</I>&gt;&gt;<i> OWASP_CRS/2.2.9.
</I>&gt;&gt;<i> Server: Apache/2.2.22 (Ubuntu)
</I>&gt;&gt;<i> WebApp-Info: &quot;default&quot; &quot;-&quot; &quot;&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --aa2d203d-Z--
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>Jamie Riden / <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamie at honeynet.org</A> / <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jamie.riden at gmail.com</A>
</I>&gt;<i><A HREF="http://uk.linkedin.com/in/jamieriden">http://uk.linkedin.com/in/jamieriden</A>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001526.html">[Owasp-modsecurity-core-rule-set] Apache Error: Invalid URI in	Request.
</A></li>
	<LI>Next message: <A HREF="001529.html">[Owasp-modsecurity-core-rule-set] POST body is not inspected by	modsecurity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1527">[ date ]</a>
              <a href="thread.html#1527">[ thread ]</a>
              <a href="subject.html#1527">[ subject ]</a>
              <a href="author.html#1527">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
