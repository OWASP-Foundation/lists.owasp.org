From misc.lists at blueyonder.co.uk  Sat Sep  1 09:41:29 2012
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Sat, 01 Sep 2012 10:41:29 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
Message-ID: <1346492489.2136.10.camel@localhost>

Hello all,

I am part-way through a bare metal rebuild of my small home server on a
Fedora 17 platform. I have always had a problem with ModSec and
Squirrelmail. Most of Squirrelmail's functions seem to hit ModSec rules.
In the past I have dealt with this by means of a custom rule which I put
in modsecurity_localrules.conf which read:
SecRule REQUEST_URI "@rx(compose|delete_message|options|move_messages|
gpg_pop_init.php)\.php" "pass,ctl:ruleEngine=DetectionOnly"
(The URI is usually something like /webmail/src/compose.php)

Now that I am on the latest everything (ModSec 2.2.6, CRS 2.2.5) I
wonder if there was a better way of doing this?

I am surely not the only person who uses ModSec and Squirrelmail.

What is the best way to deal with this?

Thanks in advance for any help / suggestions.

Mark


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120901/7a1087d4/attachment.pgp>

From ivakili at yahoo.com  Tue Sep  4 04:06:28 2012
From: ivakili at yahoo.com (Iman Vakili)
Date: Mon, 3 Sep 2012 21:06:28 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] Encoding
Message-ID: <1346731588.33553.YahooMailNeo@web164902.mail.bf1.yahoo.com>

Hi friends,

I have set parameter matching in UTF8 encoding on modsecurity, but there is a web application which using iso-8859-1 for its encoding, and the thing is modsecurity will detect every parameter encoded in iso-8859-1 in the post and get parameters as an attack, that is natural?behavior?but I wonder how we can support other encoding such as iso-8859-1, also there are some functions which I think are?ambiguous, like?t:urlDecodeUni, ?I couldn't detect any transformation by this function, also?SecUnicodeCodePage and?SecUnicodeMapFile, the thing is it is not clear what exactly mapping do,?
I will be so thankful if you can guide me, do you think I have to change in the developing level to support other encodings?

Thanks a lot,
All the best

~Iman
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120903/9a506da0/attachment.html>

From ivakili at yahoo.com  Tue Sep  4 09:09:59 2012
From: ivakili at yahoo.com (Iman Vakili)
Date: Tue, 4 Sep 2012 02:09:59 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] Fw:  Encoding
In-Reply-To: <1346731588.33553.YahooMailNeo@web164902.mail.bf1.yahoo.com>
References: <1346731588.33553.YahooMailNeo@web164902.mail.bf1.yahoo.com>
Message-ID: <1346749799.36672.YahooMailNeo@web164906.mail.bf1.yahoo.com>



I want to complete my question, when I send a character in iso-8859 , something like "&#1768" will transfer and I don't know how to make modsecurity to understand this (decode it), it seems that I have to change iso-8859 to utf-8 maybe by t.urldecodeuni but I don't know how to transform it, also I don't know what is the meaning of codes in the unicode.mapping somethng like?01e5:67, anyone can explain their procedure? first I thought it is mapping 01e5 to 67 but when I was testing it my hypothesis rejected, even if it can map characters what should we do with "&#"?

Sincerely yours

~IMAN


----- Forwarded Message -----
From: Iman Vakili <ivakili at yahoo.com>
To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
Sent: Tuesday, September 4, 2012 8:36 AM
Subject: [Owasp-modsecurity-core-rule-set] Encoding
 

Hi friends,

I have set parameter matching in UTF8 encoding on modsecurity, but there is a web application which using iso-8859-1 for its encoding, and the thing is modsecurity will detect every parameter encoded in iso-8859-1 in the post and get parameters as an attack, that is natural?behavior?but I wonder how we can support other encoding such as iso-8859-1, also there are some functions which I think are?ambiguous, like?t:urlDecodeUni, ?I couldn't detect any transformation by this function, also?SecUnicodeCodePage and?SecUnicodeMapFile, the thing is it is not clear what exactly mapping do,?
I will be so thankful if you can guide me, do you think I have to change in the developing level to support other encodings?

Thanks a lot,
All the best

~Iman
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120904/cdc394e1/attachment.html>

From ivakili at yahoo.com  Tue Sep  4 09:28:18 2012
From: ivakili at yahoo.com (Iman Vakili)
Date: Tue, 4 Sep 2012 02:28:18 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] Fw:  Fw:  Encoding
In-Reply-To: <1346749799.36672.YahooMailNeo@web164906.mail.bf1.yahoo.com>
References: <1346731588.33553.YahooMailNeo@web164902.mail.bf1.yahoo.com>
	<1346749799.36672.YahooMailNeo@web164906.mail.bf1.yahoo.com>
Message-ID: <1346750898.78078.YahooMailNeo@web164905.mail.bf1.yahoo.com>



Sorry, my bad, the character is?"&#1768;" it uses ";" at the end of the characters as a delimiter, ?and we all know how modsecurity treat with ";"

~IMAN

----- Forwarded Message -----
From: Iman Vakili <ivakili at yahoo.com>
To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
Sent: Tuesday, September 4, 2012 1:39 PM
Subject: [Owasp-modsecurity-core-rule-set] Fw:  Encoding
 



I want to complete my question, when I send a character in iso-8859 , something like "&#1768" will transfer and I don't know how to make modsecurity to understand this (decode it), it seems that I have to change iso-8859 to utf-8 maybe by t.urldecodeuni but I don't know how to transform it, also I don't know what is the meaning of codes in the unicode.mapping somethng like?01e5:67, anyone can explain their procedure? first I thought it is mapping 01e5 to 67 but when I was testing it my hypothesis rejected, even if it can map characters what should we do with "&#"?

Sincerely yours

~IMAN


----- Forwarded Message -----
From: Iman Vakili <ivakili at yahoo.com>
To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
Sent: Tuesday, September 4, 2012 8:36 AM
Subject: [Owasp-modsecurity-core-rule-set] Encoding
 

Hi friends,

I have set parameter matching in UTF8 encoding on modsecurity, but there is a web application which using iso-8859-1 for its encoding, and the thing is modsecurity will detect every parameter encoded in iso-8859-1 in the post and get parameters as an attack, that is natural?behavior?but I wonder how we can support other encoding such as iso-8859-1, also there are some functions which I think are?ambiguous, like?t:urlDecodeUni, ?I couldn't detect any transformation by this function, also?SecUnicodeCodePage and?SecUnicodeMapFile, the thing is it is not clear what exactly mapping do,?
I will be so thankful if you can guide me, do you think I have to change in the developing level to support other encodings?

Thanks a lot,
All the best

~Iman
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set



_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120904/2d151b03/attachment-0001.html>

From owasp at sic-sec.org  Wed Sep  5 06:10:31 2012
From: owasp at sic-sec.org (Achim)
Date: Wed, 05 Sep 2012 08:10:31 +0200
Subject: [Owasp-modsecurity-core-rule-set] Fw:  Fw:  Encoding
In-Reply-To: <1346750898.78078.YahooMailNeo@web164905.mail.bf1.yahoo.com>
References: <1346731588.33553.YahooMailNeo@web164902.mail.bf1.yahoo.com>
	<1346749799.36672.YahooMailNeo@web164906.mail.bf1.yahoo.com>
	<1346750898.78078.YahooMailNeo@web164905.mail.bf1.yahoo.com>
Message-ID: <5046ECD7.5080605@sic-sec.org>

Iman,

can you please post an example of your request. Is it a GET or POST?

Please keep in mind that most characters must be URL-encoded.
This is (character-)"encoding", while you seem to talk/wonder about
character sets (iso-8859). This means that HTML-Entities (like &#1768;)
never appear in the request (except if there're some special settings for
POST requests).

-Achim


Am 04.09.2012 11:28, schrieb Iman Vakili:
> 
> 
> Sorry, my bad, the character is "&#1768;" it uses ";" at the end of the characters as a delimiter,  and we all know how modsecurity treat with ";"
> 
> ~IMAN
> 
> ----- Forwarded Message -----
> From: Iman Vakili <ivakili at yahoo.com>
> To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
> Sent: Tuesday, September 4, 2012 1:39 PM
> Subject: [Owasp-modsecurity-core-rule-set] Fw:  Encoding
>  
> 
> 
> 
> I want to complete my question, when I send a character in iso-8859 , something like "&#1768" will transfer and I don't know how to make modsecurity to understand this (decode it), it seems that I have to change iso-8859 to utf-8 maybe by t.urldecodeuni but I don't know how to transform it, also I don't know what is the meaning of codes in the unicode.mapping somethng like 01e5:67, anyone can explain their procedure? first I thought it is mapping 01e5 to 67 but when I was testing it my hypothesis rejected, even if it can map characters what should we do with "&#"?
> 
> Sincerely yours
> 
> ~IMAN
> 
> 
> ----- Forwarded Message -----
> From: Iman Vakili <ivakili at yahoo.com>
> To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
> Sent: Tuesday, September 4, 2012 8:36 AM
> Subject: [Owasp-modsecurity-core-rule-set] Encoding
>  
> 
> Hi friends,
> 
> I have set parameter matching in UTF8 encoding on modsecurity, but there is a web application which using iso-8859-1 for its encoding, and the thing is modsecurity will detect every parameter encoded in iso-8859-1 in the post and get parameters as an attack, that is natural behavior but I wonder how we can support other encoding such as iso-8859-1, also there are some functions which I think are ambiguous, like t:urlDecodeUni,  I couldn't detect any transformation by this function, also SecUnicodeCodePage and SecUnicodeMapFile, the thing is it is not clear what exactly mapping do, 
> I will be so thankful if you can guide me, do you think I have to change in the developing level to support other encodings?
> 
> Thanks a lot,
> All the best
> 
> ~Iman
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

From leonardo at lbasolutions.com  Wed Sep  5 12:00:38 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Wed, 5 Sep 2012 09:00:38 -0300
Subject: [Owasp-modsecurity-core-rule-set] put two rules together
Message-ID: <CAG+8EEZX7zwgii7FMSbpuN7YjORZ4GRX7-XBfszomFBV6vA7pw@mail.gmail.com>

Hey guys, good morning!

I need to create a rule to allow access to update.php to an specific ip. I
created the rules but I couldn't put them togheter.
I didn't use removerulebyid because the rule will totatlly ignored by
modsecurity.


SecRule REQUEST_URI "^/update.php" id:1,phase:1,log,allow,ctl:ruleEngine=off
SecRule REMOTE_ADDR "^192.168.1.10"
id:2,phase:1,log,allow,ctl:ruleEngine=off


In case above, or I allow everything to ip 192.168.1.10 or everyone can
access update.php, so, I tried it:


SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
id:1,phase:1,log,allow,ctl:ruleEngine=off

I also tried:

SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
id:1,phase:1,log,allow,ctl:ruleEngine=off
"phase:2,log,allow,ctl:ruleEngine=off"

in both case fail. How can I do that ?



many thanks!!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120905/e6d13bb7/attachment.html>

From jamuse at gmail.com  Wed Sep  5 12:09:21 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Wed, 5 Sep 2012 15:09:21 +0300
Subject: [Owasp-modsecurity-core-rule-set] put two rules together
In-Reply-To: <CAG+8EEZX7zwgii7FMSbpuN7YjORZ4GRX7-XBfszomFBV6vA7pw@mail.gmail.com>
References: <CAG+8EEZX7zwgii7FMSbpuN7YjORZ4GRX7-XBfszomFBV6vA7pw@mail.gmail.com>
Message-ID: <CANnPkikDCUuEqNLdORXQKzQhgk_qOLWCnH_eiRsyk9LMi0uLew@mail.gmail.com>

On Wed, Sep 5, 2012 at 3:00 PM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hey guys, good morning!
>
> I need to create a rule to allow access to update.php to an specific ip. I
> created the rules but I couldn't put them togheter.
> I didn't use removerulebyid because the rule will totatlly ignored by
> modsecurity.
>
>
> SecRule REQUEST_URI "^/update.php"
> id:1,phase:1,log,allow,ctl:ruleEngine=off
> SecRule REMOTE_ADDR "^192.168.1.10"
> id:2,phase:1,log,allow,ctl:ruleEngine=off
>

Hi Leonardo,

Take a look at the chain action:
http://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#chain

Something like the following should work (not tested):
SecRule REQUEST_URI "^/update.php"
id:1,phase:1,log,allow,chain,ctl:ruleEngine=off
  SecRule REMOTE_ADDR "^192.168.1.10"

--
 - Josh


> In case above, or I allow everything to ip 192.168.1.10 or everyone can
> access update.php, so, I tried it:
>
>
> SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
> id:1,phase:1,log,allow,ctl:ruleEngine=off
>
> I also tried:
>
> SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
> id:1,phase:1,log,allow,ctl:ruleEngine=off
> "phase:2,log,allow,ctl:ruleEngine=off"
>
> in both case fail. How can I do that ?
>
>
>
> many thanks!!
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120905/e7b2c68b/attachment.html>

From leonardo at lbasolutions.com  Wed Sep  5 18:14:15 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Wed, 5 Sep 2012 15:14:15 -0300
Subject: [Owasp-modsecurity-core-rule-set] put two rules together
In-Reply-To: <CAG+8EEZY+F76g_DUKfkSFF6wEZYkrUzkDeeg7BybfpyFvU6TUQ@mail.gmail.com>
References: <CAG+8EEZX7zwgii7FMSbpuN7YjORZ4GRX7-XBfszomFBV6vA7pw@mail.gmail.com>
	<CANnPkikDCUuEqNLdORXQKzQhgk_qOLWCnH_eiRsyk9LMi0uLew@mail.gmail.com>
	<CAG+8EEZY+F76g_DUKfkSFF6wEZYkrUzkDeeg7BybfpyFvU6TUQ@mail.gmail.com>
Message-ID: <CAG+8EEadCWAErztOcuHsS5NQd9fZRN6oirb=F2tK=4JRjjnG+Q@mail.gmail.com>

Hi Josh,

Please, help me!

I used the rule below, but it is allowing everyone instead of 192.168.1.10.

SecRule REQUEST_URI "^/update.php"
id:1,phase:1,chain,allow,nolog,t:none,ctl:ruleEngine=off
   SecRule REMOTE_ADDR "^192\.168\.1\.10$" t:none

I'm looking for the solution in internet, but I didn't find any solution :(


On Wed, Sep 5, 2012 at 10:15 AM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hi Josh,
>
> Many thanks!!!
>
> I solved the problem with:
>
> SecRule REQUEST_URI "^/update.php"
> id:1,phase:1,chain,allow,nolog,t:none,ctl:ruleEngine=off
>   SecRule REMOTE_ADDR "^192\.168\.1\.10$" t:none
>
>
>
>
> On Wed, Sep 5, 2012 at 9:09 AM, Josh Amishav-Zlatin <jamuse at gmail.com>wrote:
>
>> On Wed, Sep 5, 2012 at 3:00 PM, Leonardo Bacha Abrantes <
>> leonardo at lbasolutions.com> wrote:
>>
>>> Hey guys, good morning!
>>>
>>> I need to create a rule to allow access to update.php to an specific ip.
>>> I created the rules but I couldn't put them togheter.
>>> I didn't use removerulebyid because the rule will totatlly ignored by
>>> modsecurity.
>>>
>>>
>>> SecRule REQUEST_URI "^/update.php"
>>> id:1,phase:1,log,allow,ctl:ruleEngine=off
>>> SecRule REMOTE_ADDR "^192.168.1.10"
>>> id:2,phase:1,log,allow,ctl:ruleEngine=off
>>>
>>
>>  Hi Leonardo,
>>
>> Take a look at the chain action:
>>
>> http://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#chain
>>
>> Something like the following should work (not tested):
>> SecRule REQUEST_URI "^/update.php"
>> id:1,phase:1,log,allow,chain,ctl:ruleEngine=off
>>   SecRule REMOTE_ADDR "^192.168.1.10"
>>
>> --
>>  - Josh
>>
>>
>>> In case above, or I allow everything to ip 192.168.1.10 or everyone can
>>> access update.php, so, I tried it:
>>>
>>>
>>> SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
>>> id:1,phase:1,log,allow,ctl:ruleEngine=off
>>>
>>> I also tried:
>>>
>>> SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
>>> id:1,phase:1,log,allow,ctl:ruleEngine=off
>>> "phase:2,log,allow,ctl:ruleEngine=off"
>>>
>>> in both case fail. How can I do that ?
>>>
>>>
>>>
>>> many thanks!!
>>>
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120905/31db93a7/attachment.html>

From leonardo at lbasolutions.com  Wed Sep  5 18:14:15 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Wed, 5 Sep 2012 15:14:15 -0300
Subject: [Owasp-modsecurity-core-rule-set] put two rules together
In-Reply-To: <CAG+8EEZY+F76g_DUKfkSFF6wEZYkrUzkDeeg7BybfpyFvU6TUQ@mail.gmail.com>
References: <CAG+8EEZX7zwgii7FMSbpuN7YjORZ4GRX7-XBfszomFBV6vA7pw@mail.gmail.com>
	<CANnPkikDCUuEqNLdORXQKzQhgk_qOLWCnH_eiRsyk9LMi0uLew@mail.gmail.com>
	<CAG+8EEZY+F76g_DUKfkSFF6wEZYkrUzkDeeg7BybfpyFvU6TUQ@mail.gmail.com>
Message-ID: <CAG+8EEadCWAErztOcuHsS5NQd9fZRN6oirb=F2tK=4JRjjnG+Q@mail.gmail.com>

Hi Josh,

Please, help me!

I used the rule below, but it is allowing everyone instead of 192.168.1.10.

SecRule REQUEST_URI "^/update.php"
id:1,phase:1,chain,allow,nolog,t:none,ctl:ruleEngine=off
   SecRule REMOTE_ADDR "^192\.168\.1\.10$" t:none

I'm looking for the solution in internet, but I didn't find any solution :(


On Wed, Sep 5, 2012 at 10:15 AM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hi Josh,
>
> Many thanks!!!
>
> I solved the problem with:
>
> SecRule REQUEST_URI "^/update.php"
> id:1,phase:1,chain,allow,nolog,t:none,ctl:ruleEngine=off
>   SecRule REMOTE_ADDR "^192\.168\.1\.10$" t:none
>
>
>
>
> On Wed, Sep 5, 2012 at 9:09 AM, Josh Amishav-Zlatin <jamuse at gmail.com>wrote:
>
>> On Wed, Sep 5, 2012 at 3:00 PM, Leonardo Bacha Abrantes <
>> leonardo at lbasolutions.com> wrote:
>>
>>> Hey guys, good morning!
>>>
>>> I need to create a rule to allow access to update.php to an specific ip.
>>> I created the rules but I couldn't put them togheter.
>>> I didn't use removerulebyid because the rule will totatlly ignored by
>>> modsecurity.
>>>
>>>
>>> SecRule REQUEST_URI "^/update.php"
>>> id:1,phase:1,log,allow,ctl:ruleEngine=off
>>> SecRule REMOTE_ADDR "^192.168.1.10"
>>> id:2,phase:1,log,allow,ctl:ruleEngine=off
>>>
>>
>>  Hi Leonardo,
>>
>> Take a look at the chain action:
>>
>> http://sourceforge.net/apps/mediawiki/mod-security/index.php?title=Reference_Manual#chain
>>
>> Something like the following should work (not tested):
>> SecRule REQUEST_URI "^/update.php"
>> id:1,phase:1,log,allow,chain,ctl:ruleEngine=off
>>   SecRule REMOTE_ADDR "^192.168.1.10"
>>
>> --
>>  - Josh
>>
>>
>>> In case above, or I allow everything to ip 192.168.1.10 or everyone can
>>> access update.php, so, I tried it:
>>>
>>>
>>> SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
>>> id:1,phase:1,log,allow,ctl:ruleEngine=off
>>>
>>> I also tried:
>>>
>>> SecRule REMOTE_ADDR|REQUEST_URI "^192.168.1.10" "^/update.php"
>>> id:1,phase:1,log,allow,ctl:ruleEngine=off
>>> "phase:2,log,allow,ctl:ruleEngine=off"
>>>
>>> in both case fail. How can I do that ?
>>>
>>>
>>>
>>> many thanks!!
>>>
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120905/31db93a7/attachment-0003.html>

From ivakili at yahoo.com  Thu Sep  6 05:33:36 2012
From: ivakili at yahoo.com (Iman Vakili)
Date: Wed, 5 Sep 2012 22:33:36 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] Fw:  Fw:  Encoding
In-Reply-To: <5046ECD7.5080605@sic-sec.org>
References: <1346731588.33553.YahooMailNeo@web164902.mail.bf1.yahoo.com>
	<1346749799.36672.YahooMailNeo@web164906.mail.bf1.yahoo.com>
	<1346750898.78078.YahooMailNeo@web164905.mail.bf1.yahoo.com>
	<5046ECD7.5080605@sic-sec.org>
Message-ID: <1346909616.83210.YahooMailNeo@web164903.mail.bf1.yahoo.com>

Dear Achim

Thanks a lot for your reply,?

It happens in both GET & POST,
Every character which is not English (ASCII capable) will transfer via iso-8859 encoding (if we don't set content type), and when I send a character it becomes something like ?%26%231234%3B%26%235678%3B%26%239101%3B, it is URL encoded, but its decoded is in this form "&#whatever-character;"

I have checked the?back-end web application code and it doesn't have any strange?thing, I found that it is default?behavior?of html <input> tag for text, so it seems to me that I have to change the rule instead of modsecurity, what do you think about it? any recommendation for rule changing??

Sincerely yours

IMAN



________________________________
 From: Achim <owasp at sic-sec.org>
To: Iman Vakili <ivakili at yahoo.com> 
Cc: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
Sent: Wednesday, September 5, 2012 10:40 AM
Subject: Re: [Owasp-modsecurity-core-rule-set] Fw:  Fw:  Encoding
 
Iman,

can you please post an example of your request. Is it a GET or POST?

Please keep in mind that most characters must be URL-encoded.
This is (character-)"encoding", while you seem to talk/wonder about
character sets (iso-8859). This means that HTML-Entities (like ?)
never appear in the request (except if there're some special settings for
POST requests).

-Achim


Am 04.09.2012 11:28, schrieb Iman Vakili:
> 
> 
> Sorry, my bad, the character is "?" it uses ";" at the end of the characters as a delimiter,? and we all know how modsecurity treat with ";"
> 
> ~IMAN
> 
> ----- Forwarded Message -----
> From: Iman Vakili <ivakili at yahoo.com>
> To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
> Sent: Tuesday, September 4, 2012 1:39 PM
> Subject: [Owasp-modsecurity-core-rule-set] Fw:? Encoding
>? 
> 
> 
> 
> I want to complete my question, when I send a character in iso-8859 , something like "&#1768" will transfer and I don't know how to make modsecurity to understand this (decode it), it seems that I have to change iso-8859 to utf-8 maybe by t.urldecodeuni but I don't know how to transform it, also I don't know what is the meaning of codes in the unicode.mapping somethng like 01e5:67, anyone can explain their procedure? first I thought it is mapping 01e5 to 67 but when I was testing it my hypothesis rejected, even if it can map characters what should we do with "&#"?
> 
> Sincerely yours
> 
> ~IMAN
> 
> 
> ----- Forwarded Message -----
> From: Iman Vakili <ivakili at yahoo.com>
> To: "owasp-modsecurity-core-rule-set at lists.owasp.org" <owasp-modsecurity-core-rule-set at lists.owasp.org> 
> Sent: Tuesday, September 4, 2012 8:36 AM
> Subject: [Owasp-modsecurity-core-rule-set] Encoding
>? 
> 
> Hi friends,
> 
> I have set parameter matching in UTF8 encoding on modsecurity, but there is a web application which using iso-8859-1 for its encoding, and the thing is modsecurity will detect every parameter encoded in iso-8859-1 in the post and get parameters as an attack, that is natural behavior but I wonder how we can support other encoding such as iso-8859-1, also there are some functions which I think are ambiguous, like t:urlDecodeUni,? I couldn't detect any transformation by this function, also SecUnicodeCodePage and SecUnicodeMapFile, the thing is it is not clear what exactly mapping do, 
> I will be so thankful if you can guide me, do you think I have to change in the developing level to support other encodings?
> 
> Thanks a lot,
> All the best
> 
> ~Iman
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120905/7ef3f450/attachment.html>

From jamuse at gmail.com  Thu Sep  6 07:09:29 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 6 Sep 2012 10:09:29 +0300
Subject: [Owasp-modsecurity-core-rule-set] put two rules together
In-Reply-To: <CAG+8EEadCWAErztOcuHsS5NQd9fZRN6oirb=F2tK=4JRjjnG+Q@mail.gmail.com>
References: <CAG+8EEZX7zwgii7FMSbpuN7YjORZ4GRX7-XBfszomFBV6vA7pw@mail.gmail.com>
	<CANnPkikDCUuEqNLdORXQKzQhgk_qOLWCnH_eiRsyk9LMi0uLew@mail.gmail.com>
	<CAG+8EEZY+F76g_DUKfkSFF6wEZYkrUzkDeeg7BybfpyFvU6TUQ@mail.gmail.com>
	<CAG+8EEadCWAErztOcuHsS5NQd9fZRN6oirb=F2tK=4JRjjnG+Q@mail.gmail.com>
Message-ID: <CANnPki=QtH+mFRVcwB03mRt7e-Ef6ZXeBYNzvZCqhMSDLzyOeA@mail.gmail.com>

On Wed, Sep 5, 2012 at 9:14 PM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hi Josh,
>
> Please, help me!
>
> I used the rule below, but it is allowing everyone instead of 192.168.1.10.
>
>
> SecRule REQUEST_URI "^/update.php"
> id:1,phase:1,chain,allow,nolog,t:none,ctl:ruleEngine=off
>    SecRule REMOTE_ADDR "^192\.168\.1\.10$" t:none
>
> I'm looking for the solution in internet, but I didn't find any solution :(
>
>
Hi Leonardo,

When dealing with chained rules, non-disruptive actions are executed as
soon as the rule matches. The ctl action is considered a
non-disruptive action (examples of disruptive actions are: allow, deny.
block etc.). That is why the ruleEngine is disabled anytime ModSecurity
sees a request to /update.php (and the 2nd half of the chain isn't even
considered). Try moving the ctl action to the latter half of your rule,
e.g.:

SecRule REQUEST_URI "^/update.php" id:1,phase:1,chain,allow,nolog,t:none
   SecRule REMOTE_ADDR "^192\.168\.1\.10$" t:none,ctl:ruleEngine=off

--
 - Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120906/c1c62afa/attachment.html>

From misc.lists at blueyonder.co.uk  Thu Sep  6 07:41:47 2012
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Thu, 06 Sep 2012 08:41:47 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
In-Reply-To: <1346492489.2136.10.camel@localhost>
References: <1346492489.2136.10.camel@localhost>
Message-ID: <1346917307.2137.6.camel@localhost>

On Sat, 2012-09-01 at 10:41 +0100, Arthur Dent wrote:
> Hello all,
> 
> I am part-way through a bare metal rebuild of my small home server on a
> Fedora 17 platform. I have always had a problem with ModSec and
> Squirrelmail. Most of Squirrelmail's functions seem to hit ModSec rules.
> In the past I have dealt with this by means of a custom rule which I put
> in modsecurity_localrules.conf which read:
> SecRule REQUEST_URI "@rx(compose|delete_message|options|move_messages|
> gpg_pop_init.php)\.php" "pass,ctl:ruleEngine=DetectionOnly"
> (The URI is usually something like /webmail/src/compose.php)
> 
> Now that I am on the latest everything (ModSec 2.2.6, CRS 2.2.5) I
> wonder if there was a better way of doing this?
> 
> I am surely not the only person who uses ModSec and Squirrelmail.
> 
> What is the best way to deal with this?
> 
> Thanks in advance for any help / suggestions.
> 
> Mark

OK. No-one offered any suggestions so I have been trying to do this
myself without any success. I guess things have changed since I last had
this working.

I have created a modsecurity_crs_15_customrules.conf file and tried both
this:
SecRule REQUEST_URI "@rx(compose|delete_message|options|move_messages|
gpg_pop_init.php)\.php" "pass,ctl:ruleEngine=DetectionOnly"

and this:
SecRule REQUEST_URI "@rx \/webmail\/src\/"
"pass,nolog,noauditlog,ctl:ruleEngine=DetectionOnly"

but neither seen to work. Here is the relevant sections from the logs:
==========================8<===========================================
--53208e27-A--
[06/Sep/2012:08:28:57 +0100] UEhQuV5 at KJoAAA-gZOEAAAAA 82.43.145.228 50213 192.168.2.2 443
--53208e27-B--
POST /mywm/src/compose.php HTTP/1.1
Host: www.mydomain.org
Connection: keep-alive
Content-Length: 2032
Cache-Control: max-age=0
Origin: https://www.mydomain.org
User-Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryApZrcLUMZNcW08Hw
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Referer: https://www.mydomain.org/mywm/src/compose.php?mailbox=IN-School&startMessage=1
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8,en-GB;q=0.6
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: key=OYX4xy5pBYc%3D; squirrelmail_language=deleted; SQMSESSID=vdpj7jlonemo25np8cqaac5q84

--53208e27-I--
smtoken=2Mjp0tu7F9D1&startMessage=1&session=1&passed%5fid=&identity=0&send%5fto=mark%40mydomain%2eorg&send%5fto%5fcc=&send%5fto%5fbcc=&subject=Test+Message&mailprio=3&body=Test+Message&send=Send&MAX%5fFILE%5fSIZE=2097152&username=mark&smaction=&mailbox=IN%2dSchool&composesession=1&querystring=mailbox%3dIN%2dSchool%26amp%3bstartMessage%3d1
--53208e27-F--
HTTP/1.1 403 Forbidden
Content-Length: 304
Connection: close
Content-Type: text/html; charset=iso-8859-1

--53208e27-H--
Message: Access denied with code 403 (phase 2). Pattern match "([\\~\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\-\\+\\=\\{\\}\\[\\]\\|\\:\\;\"\\'\\\xc2\xb4\\\xe2\x80\x99\\\xe2\x80\x98\\`\\<\\>].*){4,}" at ARGS:querystring. [file "/etc/httpd/modsecurity.d/activated_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "171"] [id "981173"] [rev "2.2.5"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=1"]
Message: Failed to access DBM file "/var/log/httpd//global": Permission denied
Message: Failed to access DBM file "/var/log/httpd//ip": Permission denied
Action: Intercepted (phase 2)
Apache-Handler: php5-script
Stopwatch: 1346916537512630 18158 (- - -)
Stopwatch2: 1346916537512630 18158; combined=17993, p1=421, p2=12973, p3=0, p4=0, p5=2378, sr=53, sw=1, l=0, gc=2220
Producer: ModSecurity for Apache/2.6.6 (http://www.modsecurity.org/); OWASP_CRS/2.2.5.
Server: Apache/2.2.22 (Fedora)

--53208e27-Z--
==========================8<===========================================

I am particularly mystified by the "Failed to access DBM file" message.
Can anyone assist me in getting this through?

Thanks

Mark

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120906/76b51ca5/attachment-0001.pgp>

From jamuse at gmail.com  Thu Sep  6 08:16:31 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 6 Sep 2012 11:16:31 +0300
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
In-Reply-To: <1346917307.2137.6.camel@localhost>
References: <1346492489.2136.10.camel@localhost>
	<1346917307.2137.6.camel@localhost>
Message-ID: <CANnPkikMGkacN+FH0Y0ESda_TmFi6oh1iEu2bH3qOfEOXzNHmw@mail.gmail.com>

On Thu, Sep 6, 2012 at 10:41 AM, Arthur Dent <misc.lists at blueyonder.co.uk>wrote:

>
> I am particularly mystified by the "Failed to access DBM file" message.
> Can anyone assist me in getting this through?
>
>
What permissions do you have set on /var/log/httpd?

--
 - Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120906/3bb7bde1/attachment.html>

From misc.lists at blueyonder.co.uk  Thu Sep  6 08:23:23 2012
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Thu, 06 Sep 2012 09:23:23 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
In-Reply-To: <CANnPkikMGkacN+FH0Y0ESda_TmFi6oh1iEu2bH3qOfEOXzNHmw@mail.gmail.com>
References: <1346492489.2136.10.camel@localhost>
	<1346917307.2137.6.camel@localhost>
	<CANnPkikMGkacN+FH0Y0ESda_TmFi6oh1iEu2bH3qOfEOXzNHmw@mail.gmail.com>
Message-ID: <1346919803.2137.13.camel@localhost>

On Thu, 2012-09-06 at 11:16 +0300, Josh Amishav-Zlatin wrote:
> On Thu, Sep 6, 2012 at 10:41 AM, Arthur Dent
> <misc.lists at blueyonder.co.uk> wrote:
>         
>         
>         I am particularly mystified by the "Failed to access DBM file"
>         message.
>         Can anyone assist me in getting this through?
>         
> 
> 
> What permissions do you have set on /var/log/httpd?

# ll /var/log/httpd/
total 6192
-rw-r--r--. 1 root root   29601 Sep  6 08:18 access_log
-rw-r--r--. 1 root root   44859 Sep  2 03:00 access_log-20120902
-rw-r--r--. 1 root root   75682 Sep  6 09:10 error_log
-rw-r--r--. 1 root root   79184 Sep  2 03:17 error_log-20120902
-rw-r-----. 1 root root 3308100 Sep  6 09:08 modsec_audit.log
-rw-r-----. 1 root root   66836 Sep  1 23:51 modsec_audit.log-20120902
-rw-r-----. 1 root root       0 Aug 30 22:33 modsec_debug.log
-rw-r--r--. 1 root root  495778 Sep  6 09:21 ssl_access_log
-rw-r--r--. 1 root root   92901 Sep  1 23:51 ssl_access_log-20120902
-rw-r--r--. 1 root root 1422284 Sep  6 09:10 ssl_error_log
-rw-r--r--. 1 root root   17524 Sep  1 23:40 ssl_error_log-20120902
-rw-r--r--. 1 root root  522896 Sep  6 09:21 ssl_request_log
-rw-r--r--. 1 root root  106676 Sep  1 23:51 ssl_request_log-20120902


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120906/2222e4f4/attachment.pgp>

From jamuse at gmail.com  Thu Sep  6 08:32:56 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 6 Sep 2012 11:32:56 +0300
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
In-Reply-To: <1346919803.2137.13.camel@localhost>
References: <1346492489.2136.10.camel@localhost>
	<1346917307.2137.6.camel@localhost>
	<CANnPkikMGkacN+FH0Y0ESda_TmFi6oh1iEu2bH3qOfEOXzNHmw@mail.gmail.com>
	<1346919803.2137.13.camel@localhost>
Message-ID: <CANnPkimkcyqA0Hwuop7L74pN8Jf=kxsOdOPq8-MuDL4F0dar0g@mail.gmail.com>

On Thu, Sep 6, 2012 at 11:23 AM, Arthur Dent <misc.lists at blueyonder.co.uk>wrote:


> > What permissions do you have set on /var/log/httpd?
>
> # ll /var/log/httpd/
> total 6192
> -rw-r--r--. 1 root root   29601 Sep  6 08:18 access_log
> -rw-r--r--. 1 root root   44859 Sep  2 03:00 access_log-20120902
> -rw-r--r--. 1 root root   75682 Sep  6 09:10 error_log
> -rw-r--r--. 1 root root   79184 Sep  2 03:17 error_log-20120902
> -rw-r-----. 1 root root 3308100 Sep  6 09:08 modsec_audit.log
> -rw-r-----. 1 root root   66836 Sep  1 23:51 modsec_audit.log-20120902
> -rw-r-----. 1 root root       0 Aug 30 22:33 modsec_debug.log
> -rw-r--r--. 1 root root  495778 Sep  6 09:21 ssl_access_log
> -rw-r--r--. 1 root root   92901 Sep  1 23:51 ssl_access_log-20120902
> -rw-r--r--. 1 root root 1422284 Sep  6 09:10 ssl_error_log
> -rw-r--r--. 1 root root   17524 Sep  1 23:40 ssl_error_log-20120902
> -rw-r--r--. 1 root root  522896 Sep  6 09:21 ssl_request_log
> -rw-r--r--. 1 root root  106676 Sep  1 23:51 ssl_request_log-20120902
>
>
Hi,

The Apache user needs to be able to access this directory. You need to
adjust the parent directory permissions accordingly.

--
 - Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120906/8a1fa048/attachment.html>

From misc.lists at blueyonder.co.uk  Thu Sep  6 08:50:33 2012
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Thu, 06 Sep 2012 09:50:33 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
In-Reply-To: <CANnPkimkcyqA0Hwuop7L74pN8Jf=kxsOdOPq8-MuDL4F0dar0g@mail.gmail.com>
References: <1346492489.2136.10.camel@localhost>
	<1346917307.2137.6.camel@localhost>
	<CANnPkikMGkacN+FH0Y0ESda_TmFi6oh1iEu2bH3qOfEOXzNHmw@mail.gmail.com>
	<1346919803.2137.13.camel@localhost>
	<CANnPkimkcyqA0Hwuop7L74pN8Jf=kxsOdOPq8-MuDL4F0dar0g@mail.gmail.com>
Message-ID: <1346921433.2137.18.camel@localhost>

On Thu, 2012-09-06 at 11:32 +0300, Josh Amishav-Zlatin wrote:
> On Thu, Sep 6, 2012 at 11:23 AM, Arthur Dent
> <misc.lists at blueyonder.co.uk> wrote:
>  
>         > What permissions do you have set on /var/log/httpd?
>         
>         
>         # ll /var/log/httpd/
>         total 6192
>         -rw-r--r--. 1 root root   29601 Sep  6 08:18 access_log
>         -rw-r--r--. 1 root root   44859 Sep  2 03:00
>         access_log-20120902
>         -rw-r--r--. 1 root root   75682 Sep  6 09:10 error_log
>         -rw-r--r--. 1 root root   79184 Sep  2 03:17
>         error_log-20120902
>         -rw-r-----. 1 root root 3308100 Sep  6 09:08 modsec_audit.log
>         -rw-r-----. 1 root root   66836 Sep  1 23:51
>         modsec_audit.log-20120902
>         -rw-r-----. 1 root root       0 Aug 30 22:33 modsec_debug.log
>         -rw-r--r--. 1 root root  495778 Sep  6 09:21 ssl_access_log
>         -rw-r--r--. 1 root root   92901 Sep  1 23:51
>         ssl_access_log-20120902
>         -rw-r--r--. 1 root root 1422284 Sep  6 09:10 ssl_error_log
>         -rw-r--r--. 1 root root   17524 Sep  1 23:40
>         ssl_error_log-20120902
>         -rw-r--r--. 1 root root  522896 Sep  6 09:21 ssl_request_log
>         -rw-r--r--. 1 root root  106676 Sep  1 23:51
>         ssl_request_log-20120902
>         
> 
> 
> Hi,
> 
> 
> The Apache user needs to be able to access this directory. You need to
> adjust the parent directory permissions accordingly. 

Hi Josh, thanks for helping...

Surely apache can access the directory - after all it writes to
access_log and error_log and modsecurity (through httpd) writes to
modsec_audit.log ?

Could this be a selinux problem?
# ls -laZ /var/log
drwx------. root     root     system_u:object_r:httpd_log_t:s0 httpd

# ls -laZ /var/log/httpd/
drwx------. root root system_u:object_r:httpd_log_t:s0 .
drwxr-xr-x. root root system_u:object_r:var_log_t:s0   ..
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 access_log
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 access_log-20120902
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 error_log
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 error_log-20120902
-rw-r-----. root root system_u:object_r:httpd_log_t:s0 modsec_audit.log
-rw-r-----. root root system_u:object_r:httpd_log_t:s0 modsec_audit.log-20120902
-rw-r-----. root root system_u:object_r:httpd_log_t:s0 modsec_debug.log
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 ssl_access_log
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 ssl_access_log-20120902
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 ssl_error_log
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 ssl_error_log-20120902
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 ssl_request_log
-rw-r--r--. root root system_u:object_r:httpd_log_t:s0 ssl_request_log-20120902


 

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120906/f3de5189/attachment.pgp>

From leonardo at lbasolutions.com  Mon Sep 10 13:39:10 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Mon, 10 Sep 2012 10:39:10 -0300
Subject: [Owasp-modsecurity-core-rule-set] apache 2.4.3 + modsecurity 2.6.7
	Fail
Message-ID: <CAG+8EEZ-oYgqCms1a6cX-N=VG=i0fkBOBUDK0V8ULkdEN-_MrA@mail.gmail.com>

Hey Guys,

I installed apache version 2.4.3 with Modsecurity 2.6.7, and it has been
failing to start:

[root at myserver httpd]# /etc/init.d/httpd start
Starting httpd: AH00526: Syntax error on line 132 of
/etc/httpd/conf.d/base_rules/modsecurity_crs_50_outbound.conf:
Error parsing actions: Unknown action: \\
                                                           [FAILED]

Could you help me please ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120910/89287742/attachment.html>

From RBarnett at trustwave.com  Mon Sep 10 13:45:56 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Mon, 10 Sep 2012 13:45:56 +0000
Subject: [Owasp-modsecurity-core-rule-set] apache 2.4.3 + modsecurity
 2.6.7 Fail
In-Reply-To: <CAG+8EEZ-oYgqCms1a6cX-N=VG=i0fkBOBUDK0V8ULkdEN-_MrA@mail.gmail.com>
Message-ID: <01987910BF74B341B5890120BCCE77DFCCFA@SKYMB1.trustwave.com>

What CRS version are you using?  What is the rule on line 132 of that file?

Is it the SQL Error Leakage rule here -
http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/tags/2.2.5/base_rules/modsecurity_crs_50_outbound.conf?revision=2053&view=markup

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

From: Leonardo Bacha Abrantes <leonardo at lbasolutions.com<mailto:leonardo at lbasolutions.com>>
Date: Monday, September 10, 2012 9:39 AM
To: OWASP Mod Security <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] apache 2.4.3 + modsecurity 2.6.7 Fail

Hey Guys,

I installed apache version 2.4.3 with Modsecurity 2.6.7, and it has been failing to start:

[root at myserver httpd]# /etc/init.d/httpd start
Starting httpd: AH00526: Syntax error on line 132 of /etc/httpd/conf.d/base_rules/modsecurity_crs_50_outbound.conf:
Error parsing actions: Unknown action: \\
                                                           [FAILED]

Could you help me please ?

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120910/6fcf9ddf/attachment.html>

From jamuse at gmail.com  Mon Sep 10 13:46:31 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Mon, 10 Sep 2012 16:46:31 +0300
Subject: [Owasp-modsecurity-core-rule-set] apache 2.4.3 + modsecurity
 2.6.7 Fail
In-Reply-To: <CAG+8EEZ-oYgqCms1a6cX-N=VG=i0fkBOBUDK0V8ULkdEN-_MrA@mail.gmail.com>
References: <CAG+8EEZ-oYgqCms1a6cX-N=VG=i0fkBOBUDK0V8ULkdEN-_MrA@mail.gmail.com>
Message-ID: <CANnPkimztko7g2xQo01Xc+FrO=10+d6TpPqr3aPn_h2cAV8Sbw@mail.gmail.com>

On Mon, Sep 10, 2012 at 4:39 PM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hey Guys,
>
> I installed apache version 2.4.3 with Modsecurity 2.6.7, and it has been
> failing to start:
>
>
Hi Leonardo,

What version of the CRS are you using? It looks like there is a syntax
error on line 132 of modsecurity_crs_50_outbound.conf, did you edit this
file by chance?

--
 - Josh


> [root at myserver httpd]# /etc/init.d/httpd start
> Starting httpd: AH00526: Syntax error on line 132 of
> /etc/httpd/conf.d/base_rules/modsecurity_crs_50_outbound.conf:
> Error parsing actions: Unknown action: \\
>                                                            [FAILED]
>
> Could you help me please ?
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120910/b32e0530/attachment.html>

From leonardo at lbasolutions.com  Mon Sep 10 14:11:08 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Mon, 10 Sep 2012 11:11:08 -0300
Subject: [Owasp-modsecurity-core-rule-set] apache 2.4.3 + modsecurity
 2.6.7 Fail
In-Reply-To: <CANnPkimztko7g2xQo01Xc+FrO=10+d6TpPqr3aPn_h2cAV8Sbw@mail.gmail.com>
References: <CAG+8EEZ-oYgqCms1a6cX-N=VG=i0fkBOBUDK0V8ULkdEN-_MrA@mail.gmail.com>
	<CANnPkimztko7g2xQo01Xc+FrO=10+d6TpPqr3aPn_h2cAV8Sbw@mail.gmail.com>
Message-ID: <CAG+8EEbnUPReJAcRNwOC9aJrNOs-bEMn4mZ3iKTQxTewTAedQg@mail.gmail.com>

Hey guys! thanks for your help!

crs is 2.2.5 - apache 2.4.3 and modsecurity 2.6.7.
I don't make any change in rules.


I'm using this server as reverse proxy, and my configuration is:

ProxyVia On
<VirtualHost xxx.xxx.xxx.xxx:80>
       ServerName myserver
       ProxyPreserveHost       On
       ProxyRequests           Off
       ProxyPass               /               http://xxx.xxx.xxx.xxx:80
       ProxyPassReverse        /               http://xxx.xxx.xxx.xxx:80
       #Redirect Permanent  /               http://xxx.xxx.xxx.xxx:80
</VirtualHost>

If I put this configuration in separeted file, apache fails with the error
Starting httpd: AH00526: Syntax error on line 132 of
/etc/httpd/conf.d/base_rules/
modsecurity_crs_50_outbound.conf, however if I put this configuration in
httpd.conf, apache works!!

I don't understand very well why.

many thanks !




On Mon, Sep 10, 2012 at 10:46 AM, Josh Amishav-Zlatin <jamuse at gmail.com>wrote:

> On Mon, Sep 10, 2012 at 4:39 PM, Leonardo Bacha Abrantes <
> leonardo at lbasolutions.com> wrote:
>
>> Hey Guys,
>>
>> I installed apache version 2.4.3 with Modsecurity 2.6.7, and it has been
>> failing to start:
>>
>>
> Hi Leonardo,
>
> What version of the CRS are you using? It looks like there is a syntax
> error on line 132 of modsecurity_crs_50_outbound.conf, did you edit this
> file by chance?
>
> --
>  - Josh
>
>
>> [root at myserver httpd]# /etc/init.d/httpd start
>> Starting httpd: AH00526: Syntax error on line 132 of
>> /etc/httpd/conf.d/base_rules/modsecurity_crs_50_outbound.conf:
>> Error parsing actions: Unknown action: \\
>>                                                            [FAILED]
>>
>> Could you help me please ?
>>
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120910/ca54b961/attachment.html>

From leonardo at lbasolutions.com  Mon Sep 10 16:18:06 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Mon, 10 Sep 2012 13:18:06 -0300
Subject: [Owasp-modsecurity-core-rule-set] apache 2.4.3 + modsecurity
 2.6.7 Fail
In-Reply-To: <CAG+8EEbnUPReJAcRNwOC9aJrNOs-bEMn4mZ3iKTQxTewTAedQg@mail.gmail.com>
References: <CAG+8EEZ-oYgqCms1a6cX-N=VG=i0fkBOBUDK0V8ULkdEN-_MrA@mail.gmail.com>
	<CANnPkimztko7g2xQo01Xc+FrO=10+d6TpPqr3aPn_h2cAV8Sbw@mail.gmail.com>
	<CAG+8EEbnUPReJAcRNwOC9aJrNOs-bEMn4mZ3iKTQxTewTAedQg@mail.gmail.com>
Message-ID: <CAG+8EEYTuVsusJq1hGnthTegF5UFXndF4rCfddriKezY2CBBmg@mail.gmail.com>

guys,

Sorry for my last stupid email.
It had worked when I change the virtual host to another file, but, not I'm
facing tha same trouble.





On Mon, Sep 10, 2012 at 11:11 AM, Leonardo Bacha Abrantes <
leonardo at lbasolutions.com> wrote:

> Hey guys! thanks for your help!
>
> crs is 2.2.5 - apache 2.4.3 and modsecurity 2.6.7.
> I don't make any change in rules.
>
>
> I'm using this server as reverse proxy, and my configuration is:
>
> ProxyVia On
> <VirtualHost xxx.xxx.xxx.xxx:80>
>        ServerName myserver
>        ProxyPreserveHost       On
>        ProxyRequests           Off
>        ProxyPass               /               http://xxx.xxx.xxx.xxx:80
>        ProxyPassReverse        /               http://xxx.xxx.xxx.xxx:80
>        #Redirect Permanent  /               http://xxx.xxx.xxx.xxx:80
> </VirtualHost>
>
> If I put this configuration in separeted file, apache fails with the error
> Starting httpd: AH00526: Syntax error on line 132 of
> /etc/httpd/conf.d/base_rules/
> modsecurity_crs_50_outbound.conf, however if I put this configuration in
> httpd.conf, apache works!!
>
> I don't understand very well why.
>
> many thanks !
>
>
>
>
>
> On Mon, Sep 10, 2012 at 10:46 AM, Josh Amishav-Zlatin <jamuse at gmail.com>wrote:
>
>> On Mon, Sep 10, 2012 at 4:39 PM, Leonardo Bacha Abrantes <
>> leonardo at lbasolutions.com> wrote:
>>
>>> Hey Guys,
>>>
>>> I installed apache version 2.4.3 with Modsecurity 2.6.7, and it has been
>>> failing to start:
>>>
>>>
>> Hi Leonardo,
>>
>> What version of the CRS are you using? It looks like there is a syntax
>> error on line 132 of modsecurity_crs_50_outbound.conf, did you edit this
>> file by chance?
>>
>> --
>>  - Josh
>>
>>
>>> [root at myserver httpd]# /etc/init.d/httpd start
>>> Starting httpd: AH00526: Syntax error on line 132 of
>>> /etc/httpd/conf.d/base_rules/modsecurity_crs_50_outbound.conf:
>>> Error parsing actions: Unknown action: \\
>>>                                                            [FAILED]
>>>
>>> Could you help me please ?
>>>
>>> _______________________________________________
>>> Owasp-modsecurity-core-rule-set mailing list
>>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>>
>>>
>>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120910/04ba8ba8/attachment-0001.html>

From jamuse at gmail.com  Tue Sep 11 12:20:32 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Tue, 11 Sep 2012 15:20:32 +0300
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity Training
Message-ID: <CANnPkin7K1giZ6B9cSWreZ99mJ7NLY1KwJ4=nH87nrq8sxmbjQ@mail.gmail.com>

Hi Everybody,

Just a reminder if anyone is interested in ModSecurity training, I'm
running a two day session at AppSec USA.  The goal of the training is to
provide a solid framework for managing ModSecurity. There will be a focus
on hands-on labs as we practice creating virtual patches to protect a wide
range of vulns. The training will covers topics such as:

ModSecurity Setup and Deployment
RuleEngine and Rule Processing
Log Analysis and Reporting
Centralized Logging
Event Mangement with the AuditConsole
Creating Rules
Virtual Patching
Advanced Rule Writing with Lua
jwall-tools
OWASP Core Rule Set
Handeling False Positives

More information about the training can be found at
http://www.appsecusa.org/. If you have any questions beforehand, just drop
me an e-mail.

I hope to see you there.

--
 - Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120911/b444824f/attachment.html>

From sanchit.rasiya at gmail.com  Wed Sep 12 16:51:27 2012
From: sanchit.rasiya at gmail.com (Sanchit)
Date: Wed, 12 Sep 2012 22:21:27 +0530
Subject: [Owasp-modsecurity-core-rule-set] Regarding ModSecurity Rules for
	.htaccess
In-Reply-To: <CAD2_gk8G7dUO4pwa9pwmBqx_cp8sa21YGufhYOTk0B-aUBKX5Q@mail.gmail.com>
References: <CAD2_gk8G7dUO4pwa9pwmBqx_cp8sa21YGufhYOTk0B-aUBKX5Q@mail.gmail.com>
Message-ID: <CAD2_gk_mj3w9ak1Ce_U7vwpF_89eQYnta9Pm4Yy08d5GdyrMKw@mail.gmail.com>

Hi,

I would like to know the way by which ModSecurity Rules can be controlled
from the .htaccess file.

Tried doing experiments, but cannot attain the needful.

Please guide asap! :)

-- 
Regards,
Sanchit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120912/13636dc7/attachment.html>

From misc.lists at blueyonder.co.uk  Wed Sep 12 18:33:06 2012
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Wed, 12 Sep 2012 19:33:06 +0100
Subject: [Owasp-modsecurity-core-rule-set] ModSec & Squirrelmail
In-Reply-To: <1346917307.2137.6.camel@localhost>
References: <1346492489.2136.10.camel@localhost>
	<1346917307.2137.6.camel@localhost>
Message-ID: <1347474786.3186.6.camel@localhost>

On Thu, 2012-09-06 at 08:41 +0100, Arthur Dent wrote:
> On Sat, 2012-09-01 at 10:41 +0100, Arthur Dent wrote:
> > Hello all,
> > 
> > I am part-way through a bare metal rebuild of my small home server on a
> > Fedora 17 platform. I have always had a problem with ModSec and
> > Squirrelmail. Most of Squirrelmail's functions seem to hit ModSec rules.
> > In the past I have dealt with this by means of a custom rule which I put
> > in modsecurity_localrules.conf which read:
> > SecRule REQUEST_URI "@rx(compose|delete_message|options|move_messages|
> > gpg_pop_init.php)\.php" "pass,ctl:ruleEngine=DetectionOnly"
> > (The URI is usually something like /webmail/src/compose.php)
> > 
> > Now that I am on the latest everything (ModSec 2.2.6, CRS 2.2.5) I
> > wonder if there was a better way of doing this?
> > 
> > I am surely not the only person who uses ModSec and Squirrelmail.
> > 
> > What is the best way to deal with this?
> > 
> > Thanks in advance for any help / suggestions.
> > 
> > Mark
> 
> OK. No-one offered any suggestions so I have been trying to do this
> myself without any success. I guess things have changed since I last had
> this working.
> 
> I have created a modsecurity_crs_15_customrules.conf file and tried both
> this:
> SecRule REQUEST_URI "@rx(compose|delete_message|options|move_messages|
> gpg_pop_init.php)\.php" "pass,ctl:ruleEngine=DetectionOnly"
> 
> and this:
> SecRule REQUEST_URI "@rx \/webmail\/src\/"
> "pass,nolog,noauditlog,ctl:ruleEngine=DetectionOnly"
> 
> but neither seen to work. Here is the relevant sections from the logs:
> ==========================8<===========================================
> --53208e27-A--
> [06/Sep/2012:08:28:57 +0100] UEhQuV5 at KJoAAA-gZOEAAAAA 82.43.145.228 50213 192.168.2.2 443
> --53208e27-B--
> POST /mywm/src/compose.php HTTP/1.1
> Host: www.mydomain.org
> Connection: keep-alive
> Content-Length: 2032
> Cache-Control: max-age=0
> Origin: https://www.mydomain.org
> User-Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1
> Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryApZrcLUMZNcW08Hw
> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> Referer: https://www.mydomain.org/mywm/src/compose.php?mailbox=IN-School&startMessage=1
> Accept-Encoding: gzip,deflate,sdch
> Accept-Language: en-US,en;q=0.8,en-GB;q=0.6
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
> Cookie: key=OYX4xy5pBYc%3D; squirrelmail_language=deleted; SQMSESSID=vdpj7jlonemo25np8cqaac5q84
> 
> --53208e27-I--
> smtoken=2Mjp0tu7F9D1&startMessage=1&session=1&passed%5fid=&identity=0&send%5fto=mark%40mydomain%2eorg&send%5fto%5fcc=&send%5fto%5fbcc=&subject=Test+Message&mailprio=3&body=Test+Message&send=Send&MAX%5fFILE%5fSIZE=2097152&username=mark&smaction=&mailbox=IN%2dSchool&composesession=1&querystring=mailbox%3dIN%2dSchool%26amp%3bstartMessage%3d1
> --53208e27-F--
> HTTP/1.1 403 Forbidden
> Content-Length: 304
> Connection: close
> Content-Type: text/html; charset=iso-8859-1
> 
> --53208e27-H--
> Message: Access denied with code 403 (phase 2). Pattern match "([\\~\\!\\@\\#\\$\\%\\^\\&\\*\\(\\)\\-\\+\\=\\{\\}\\[\\]\\|\\:\\;\"\\'\\\xc2\xb4\\\xe2\x80\x99\\\xe2\x80\x98\\`\\<\\>].*){4,}" at ARGS:querystring. [file "/etc/httpd/modsecurity.d/activated_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "171"] [id "981173"] [rev "2.2.5"] [msg "Restricted SQL Character Anomaly Detection Alert - Total # of special characters exceeded"] [data "=1"]
> Message: Failed to access DBM file "/var/log/httpd//global": Permission denied
> Message: Failed to access DBM file "/var/log/httpd//ip": Permission denied
> Action: Intercepted (phase 2)
> Apache-Handler: php5-script
> Stopwatch: 1346916537512630 18158 (- - -)
> Stopwatch2: 1346916537512630 18158; combined=17993, p1=421, p2=12973, p3=0, p4=0, p5=2378, sr=53, sw=1, l=0, gc=2220
> Producer: ModSecurity for Apache/2.6.6 (http://www.modsecurity.org/); OWASP_CRS/2.2.5.
> Server: Apache/2.2.22 (Fedora)
> 
> --53208e27-Z--
> ==========================8<===========================================
> 
> I am particularly mystified by the "Failed to access DBM file" message.
> Can anyone assist me in getting this through?

OK - With thanks to Josh - who put me on the right track - I have now
solved the DBM file error (it *was* a selinux problem), but I am still
struggling to get squirrelmail to work with ModSec.

This is an example of what happens when I try to create and send a
message:
==========================8<===========================================
--be01bf35-A--
[12/Sep/2012:19:26:29 +0100] UFDT1V5 at KJoAACBKdaUAAAAA 82.43.145.228 34343 192.168.2.2 443
--be01bf35-B--
POST /mywm/src/compose.php HTTP/1.1
Host: www.mydomain.org
Connection: keep-alive
Content-Length: 2041
Cache-Control: max-age=0
Origin: https://www.mydomain.org
User-Agent: Mozilla/5.0 (X11; Linux i686) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryqAsmrZ53bK174WYX
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Referer: https://www.mydomain.org/webmail/src/compose.php?mailbox=INBOX&startMessage=1
Accept-Encoding: gzip,deflate,sdch
Accept-Language: en-US,en;q=0.8,en-GB;q=0.6
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.3
Cookie: key=Nta%2BtVqpYnE%3D; squirrelmail_language=deleted; SQMSESSID=3lf5on9kt9tmsv8jhppi7r8895; PHPSESSID=kvimuo0q0nsfeh0u4ap90sv777

--be01bf35-I--
smtoken=r2hbuOJf0MiC&startMessage=1&session=1&passed%5fid=&identity=0&send%5fto=mark%40mydomain%2eorg&send%5fto%5fcc=&send%5fto%5fbcc=&subject=Test+Message&mailprio=3&send=Send&body=Another+Test+Message%2e%0d%0a%0d%0aM%2e%0d%0a&MAX%5fFILE%5fSIZE=2097152&username=mark&smaction=&mailbox=INBOX&composesession=1&querystring=mailbox%3dINBOX%26amp%3bstartMessage%3d1
--be01bf35-F--
HTTP/1.1 403 Forbidden
Content-Length: 304
Connection: close
Content-Type: text/html; charset=iso-8859-1

--be01bf35-H--
Message: Access denied with code 403 (phase 2). Pattern match "\\W{4,}" at ARGS:body. [file "/etc/httpd/modsecurity.d/activated_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "155"] [id "960024"] [rev "2.2.5"] [msg "SQL Character Anomaly Detection Alert - Repetative Non-Word Characters"] [data ".\x0d\x0a\x0d\x0a"]
Action: Intercepted (phase 2)
Apache-Handler: php5-script
Stopwatch: 1347474389086911 22910 (- - -)
Stopwatch2: 1347474389086911 22910; combined=14623, p1=397, p2=14178, p3=0, p4=0, p5=47, sr=96, sw=1, l=0, gc=0
Producer: ModSecurity for Apache/2.6.6 (http://www.modsecurity.org/); OWASP_CRS/2.2.5.
Server: Apache/2.2.22 (Fedora)

--be01bf35-Z--
==========================8<===========================================

How do I allow these trough without compromising the security of the rest of the site?

Thanks again...

Mark


-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120912/d4551cf7/attachment.pgp>

From anders at kvistmail.dk  Thu Sep 13 13:03:22 2012
From: anders at kvistmail.dk (Anders Kvist)
Date: Thu, 13 Sep 2012 15:03:22 +0200
Subject: [Owasp-modsecurity-core-rule-set] Rule 990012
Message-ID: <5051D99A.2080309@kvistmail.dk>

Hi

I have a lot of hits on rule 990012 - because some of our users 
(everything would be so much easier if they weren't there :)) have the 
following as User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_35 (The 
Java version may vary).

I did a bit of googling and "Windows XP 5.1" is the correct version of 
XP - some sites list this a as bot, some doesn't. If I do a search for 
"Windows XP 5" the results for User-Agents are bot, bot and bot...

Does anyone know if the intensions are to catch only "Windows XP 5" or both?

I have added a case to the rule here that allows "Windows XP 5.1" as 
User-Agent, but not "Windows XP 5" - guess the question is if the 
updated rule should be submitted for the next ruleset?

/Anders



From jamuse at gmail.com  Thu Sep 13 13:14:23 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 13 Sep 2012 16:14:23 +0300
Subject: [Owasp-modsecurity-core-rule-set] Rule 990012
In-Reply-To: <5051D99A.2080309@kvistmail.dk>
References: <5051D99A.2080309@kvistmail.dk>
Message-ID: <CANnPki=4nXUqyOxC4yKHE-rwbpkRGqKHSBn92TDwgbm_8_R2Ng@mail.gmail.com>

On Thu, Sep 13, 2012 at 4:03 PM, Anders Kvist <anders at kvistmail.dk> wrote:

> Hi
>
> I have a lot of hits on rule 990012 - because some of our users
> (everything would be so much easier if they weren't there :)) have the
> following as User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_35 (The
> Java version may vary).
>
>
Hi Anders,

What version of the CRS are you running? Have you considered building a
more recent version of ModSecurity from source? That would allow you to run
a more up to date version of the CRS as well.

--
 - Josh


> I did a bit of googling and "Windows XP 5.1" is the correct version of XP
> - some sites list this a as bot, some doesn't. If I do a search for
> "Windows XP 5" the results for User-Agents are bot, bot and bot...
>
> Does anyone know if the intensions are to catch only "Windows XP 5" or
> both?
>
> I have added a case to the rule here that allows "Windows XP 5.1" as
> User-Agent, but not "Windows XP 5" - guess the question is if the updated
> rule should be submitted for the next ruleset?
>
> /Anders
>
>
> ______________________________**_________________
> Owasp-modsecurity-core-rule-**set mailing list
> Owasp-modsecurity-core-rule-**set at lists.owasp.org<Owasp-modsecurity-core-rule-set at lists.owasp.org>
> https://lists.owasp.org/**mailman/listinfo/owasp-**
> modsecurity-core-rule-set<https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120913/1c64fd02/attachment.html>

From anders at kvistmail.dk  Thu Sep 13 13:22:03 2012
From: anders at kvistmail.dk (Anders Kvist)
Date: Thu, 13 Sep 2012 15:22:03 +0200
Subject: [Owasp-modsecurity-core-rule-set] Rule 990012
In-Reply-To: <CANnPki=4nXUqyOxC4yKHE-rwbpkRGqKHSBn92TDwgbm_8_R2Ng@mail.gmail.com>
References: <5051D99A.2080309@kvistmail.dk>
	<CANnPki=4nXUqyOxC4yKHE-rwbpkRGqKHSBn92TDwgbm_8_R2Ng@mail.gmail.com>
Message-ID: <5051DDFB.7030500@kvistmail.dk>

On 09/13/2012 03:14 PM, Josh Amishav-Zlatin wrote:
> On Thu, Sep 13, 2012 at 4:03 PM, Anders Kvist <anders at kvistmail.dk 
> <mailto:anders at kvistmail.dk>> wrote:
>
>     Hi
>
>     I have a lot of hits on rule 990012 - because some of our users
>     (everything would be so much easier if they weren't there :)) have
>     the following as User-Agent: Mozilla/4.0 (Windows XP 5.1)
>     Java/1.6.0_35 (The Java version may vary).
>
>
> Hi Anders,
>
> What version of the CRS are you running? Have you considered building 
> a more recent version of ModSecurity from source? That would allow you 
> to run a more up to date version of the CRS as well.
>
I have updated to 2.2.5 - ain't that the newest ruleset?


/Anders




>     I did a bit of googling and "Windows XP 5.1" is the correct
>     version of XP - some sites list this a as bot, some doesn't. If I
>     do a search for "Windows XP 5" the results for User-Agents are
>     bot, bot and bot...
>
>     Does anyone know if the intensions are to catch only "Windows XP
>     5" or both?
>
>     I have added a case to the rule here that allows "Windows XP 5.1"
>     as User-Agent, but not "Windows XP 5" - guess the question is if
>     the updated rule should be submitted for the next ruleset?
>
>     /Anders
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120913/c42bab6e/attachment.html>

From jamuse at gmail.com  Thu Sep 13 13:59:12 2012
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 13 Sep 2012 16:59:12 +0300
Subject: [Owasp-modsecurity-core-rule-set] Rule 990012
In-Reply-To: <5051DDFB.7030500@kvistmail.dk>
References: <5051D99A.2080309@kvistmail.dk>
	<CANnPki=4nXUqyOxC4yKHE-rwbpkRGqKHSBn92TDwgbm_8_R2Ng@mail.gmail.com>
	<5051DDFB.7030500@kvistmail.dk>
Message-ID: <CANnPkik3yKjoLc8vDB3Eyat-tZh=Bx6ExUbEf431-rjRihE61A@mail.gmail.com>

On Thu, Sep 13, 2012 at 4:22 PM, Anders Kvist <anders at kvistmail.dk> wrote:

>  On 09/13/2012 03:14 PM, Josh Amishav-Zlatin wrote:
>
>  On Thu, Sep 13, 2012 at 4:03 PM, Anders Kvist <anders at kvistmail.dk>wrote:
>
>> Hi
>>
>> I have a lot of hits on rule 990012 - because some of our users
>> (everything would be so much easier if they weren't there :)) have the
>> following as User-Agent: Mozilla/4.0 (Windows XP 5.1) Java/1.6.0_35 (The
>> Java version may vary).
>>
>>
>  Hi Anders,
>
>  What version of the CRS are you running? Have you considered building a
> more recent version of ModSecurity from source? That would allow you to run
> a more up to date version of the CRS as well.
>
>   I have updated to 2.2.5 - ain't that the newest ruleset?
>
>
Hi Anders,

My bad then, I based that comment on your previous email. In any case, Ryan
B. and I came up with the following which still stops the original bot and
lets the requests with 'Windows XP 5.1' in the User-Agent string through:

SecRule REQUEST_HEADERS:User-Agent "(Windows XP 5.1)"
"phase:1,id:1,nolog,pass,ctl:ruleRemoveTargetById=990012"

--
 - Josh



> /Anders
>
>
>
>
>
>   I did a bit of googling and "Windows XP 5.1" is the correct version of
>> XP - some sites list this a as bot, some doesn't. If I do a search for
>> "Windows XP 5" the results for User-Agents are bot, bot and bot...
>>
>> Does anyone know if the intensions are to catch only "Windows XP 5" or
>> both?
>>
>> I have added a case to the rule here that allows "Windows XP 5.1" as
>> User-Agent, but not "Windows XP 5" - guess the question is if the updated
>> rule should be submitted for the next ruleset?
>>
>> /Anders
>>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120913/129b884e/attachment.html>

From yanzhenyu at 55tuan.com  Fri Sep 14 02:39:44 2012
From: yanzhenyu at 55tuan.com (=?gb2312?B?48bV8dPu?=)
Date: Fri, 14 Sep 2012 10:39:44 +0800
Subject: [Owasp-modsecurity-core-rule-set] too many visits in a minute
Message-ID: <201209141039436361334@55tuan.com>


Hi,all
I notice  a specific  URL of my webserver has been accessed frequently   by several ip addresses. This url  is a login page.I blocked some IPs with firewall,but  it seems that the attacker change to a new ip and continue trying to visit.
How do I block this sort of attack ? Thanks for any idea.


2012-09-14 



  
??? ???

????????????
?????????????1?????9?? ???100084
???+86-10-59065069     ???+86-10-59065678
Mob?+86-13261949497
E-mail:yanzhenyu at 55tuan.com www.55tuan.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120914/be4dde4b/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 17742_17742_Catc(05-30-01-05-39).jpg
Type: image/jpeg
Size: 17742 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120914/be4dde4b/attachment-0001.jpg>

From sanchit.rasiya at gmail.com  Fri Sep 14 04:03:48 2012
From: sanchit.rasiya at gmail.com (Sanchit)
Date: Fri, 14 Sep 2012 09:33:48 +0530
Subject: [Owasp-modsecurity-core-rule-set] too many visits in a minute
In-Reply-To: <201209141039436361334@55tuan.com>
References: <201209141039436361334@55tuan.com>
Message-ID: <CAD2_gk_vkyA+YK7BxMWB=U8+gYB1JYk2LJo9gpN5H=uG6iz+Uw@mail.gmail.com>

Hi,
You can have something like:

SecReadStateLimit <number of limited connections in SERVER_BUSY_STATE>
SecWriteStateLimit <number of limited connections in SERVER_BUSY_STATE>

Eg.:

SecReadStateLimit 10
SecWriteStateLimit 10

This means only 10 connections will be established in SERVER_BUSY_STATE.
Can help in preventing SlowDOS attack.

OR you can block with the UserAgent, if it is same and specific for
attacker only.



On Fri, Sep 14, 2012 at 8:09 AM, ??? <yanzhenyu at 55tuan.com> wrote:

> **
>
> Hi,all
> I notice  a specific  URL of my webserver has been accessed frequently
> by several ip addresses. This url  is a login page.I blocked some IPs with
> firewall,but  it seems that the attacker change to a new ip and continue
> trying to visit.
> How do I block this sort of attack ? Thanks for any idea.
>
>
> 2012-09-14
> ------------------------------
>
>
> ??? ???
>
> ************************************************************************
>
> *????????????*****
>
> ?????????????1?????9?? ???100084
>
> ???+86-10-59065069     ???+86-10-59065678****
>
> Mob?+86-13261949497
>
> E-mail:yanzhenyu at 55tuan.com www.55tuan.com****
>
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>


-- 
Regards,
Sanchit
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120914/ec8ba637/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 17742_17742_Catc(05-30-01-05-39).jpg
Type: image/jpeg
Size: 17742 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120914/ec8ba637/attachment-0001.jpg>

From anders at kvistmail.dk  Fri Sep 14 09:04:18 2012
From: anders at kvistmail.dk (Anders Kvist)
Date: Fri, 14 Sep 2012 11:04:18 +0200
Subject: [Owasp-modsecurity-core-rule-set] Rule 990012
In-Reply-To: <CANnPkik3yKjoLc8vDB3Eyat-tZh=Bx6ExUbEf431-rjRihE61A@mail.gmail.com>
References: <5051D99A.2080309@kvistmail.dk>
	<CANnPki=4nXUqyOxC4yKHE-rwbpkRGqKHSBn92TDwgbm_8_R2Ng@mail.gmail.com>
	<5051DDFB.7030500@kvistmail.dk>
	<CANnPkik3yKjoLc8vDB3Eyat-tZh=Bx6ExUbEf431-rjRihE61A@mail.gmail.com>
Message-ID: <5052F312.7020105@kvistmail.dk>

On 09/13/2012 03:59 PM, Josh Amishav-Zlatin wrote:
> On Thu, Sep 13, 2012 at 4:22 PM, Anders Kvist <anders at kvistmail.dk 
> <mailto:anders at kvistmail.dk>> wrote:
>
>     On 09/13/2012 03:14 PM, Josh Amishav-Zlatin wrote:
>>     On Thu, Sep 13, 2012 at 4:03 PM, Anders Kvist
>>     <anders at kvistmail.dk <mailto:anders at kvistmail.dk>> wrote:
>>
>>         Hi
>>
>>         I have a lot of hits on rule 990012 - because some of our
>>         users (everything would be so much easier if they weren't
>>         there :)) have the following as User-Agent: Mozilla/4.0
>>         (Windows XP 5.1) Java/1.6.0_35 (The Java version may vary).
>>
>>
>>     Hi Anders,
>>
>>     What version of the CRS are you running? Have you considered
>>     building a more recent version of ModSecurity from source? That
>>     would allow you to run a more up to date version of the CRS as well.
>>
>     I have updated to 2.2.5 - ain't that the newest ruleset?
>
>
> Hi Anders,
>
> My bad then, I based that comment on your previous email. In any case, 
> Ryan B. and I came up with the following which still stops the 
> original bot and lets the requests with 'Windows XP 5.1' in the 
> User-Agent string through:
>
> SecRule REQUEST_HEADERS:User-Agent "(Windows XP 5.1)" 
> "phase:1,id:1,nolog,pass,ctl:ruleRemoveTargetById=990012"

That would work - but first from 2.6.7 as far as I can see ;)

I'm sticking to a change in the rule instead. I have the rules in 
subversion, so I can control the changes and bring them to newer versions...

/Anders



> --
>  - Josh
>
>
>
>     /Anders
>
>
>
>
>
>>         I did a bit of googling and "Windows XP 5.1" is the correct
>>         version of XP - some sites list this a as bot, some doesn't.
>>         If I do a search for "Windows XP 5" the results for
>>         User-Agents are bot, bot and bot...
>>
>>         Does anyone know if the intensions are to catch only "Windows
>>         XP 5" or both?
>>
>>         I have added a case to the rule here that allows "Windows XP
>>         5.1" as User-Agent, but not "Windows XP 5" - guess the
>>         question is if the updated rule should be submitted for the
>>         next ruleset?
>>
>>         /Anders
>>
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120914/0c311072/attachment.html>

From rbarnett at trustwave.com  Fri Sep 14 12:12:24 2012
From: rbarnett at trustwave.com (Ryan Barnett (JIRA))
Date: Fri, 14 Sep 2012 07:12:24 -0500 (CDT)
Subject: [Owasp-modsecurity-core-rule-set] [JIRA] Resolved: (CORERULES-86)
 CLONE - Rules-updater script fails to retrieve latest release from source
 forge repository
Message-ID: <2089217730.7710.1347624744442.JavaMail.root@modsec-apps.modsecurity.org>


     [ https://www.modsecurity.org/tracker/browse/CORERULES-86?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel ]

Ryan Barnett resolved CORERULES-86.
-----------------------------------

    Resolution: Invalid Config

Had to list the latest version in the repo listing.

> CLONE - Rules-updater script fails to retrieve latest release from source forge repository
> ------------------------------------------------------------------------------------------
>
>                 Key: CORERULES-86
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-86
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>          Components: Configuration
>    Affects Versions: 2.3.0
>         Environment: Windows 2008 Server, Apache 2.2 64bit and Mod_security from http://www.apachelounge.com/download/win64/ 
>            Reporter: Jason Huntley
>            Assignee: Ryan Barnett
>              Labels: rules, rules-updater, script, updater
>
> Rules-updater script fails to download latest release. Fails on error:
> $ ./rules-updater.pl -rhttp://www.modsecurity.org/autoupdate/repository -prepository/ -Smodsecurity-crs
> Could not load GnuPG module - cannot verify ruleset signatures
> Fetching: modsecurity-crs/modsecurity-crs_2.2.3.zip ...
> Failed to retrieve ruleset modsecurity-crs/modsecurity-crs_2.2.3.zip: 404 Not Found
> There's also a new release out 2.2.4. For some reason, the script is also still trying to pull the old release.

--
This message is automatically generated by JIRA.
For more information on JIRA, see: http://www.atlassian.com/software/jira

        


From RBarnett at trustwave.com  Fri Sep 14 18:18:49 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 14 Sep 2012 18:18:49 +0000
Subject: [Owasp-modsecurity-core-rule-set] Considering Migration to
	GitHub
In-Reply-To: <ADFA2318-1ADC-41F4-945B-73803522BB48@trustwave.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF012C65@SKYMB1.trustwave.com>

I wanted to update everyone to let them know that I have begun the process
of migrating the OWASP ModSecurity Core Rule Set from SourceForge (SVN) to
GitHub (git).

Here is the current repo/data for testing -

Landing Page - http://spiderlabs.github.com/owasp-modsecurity-crs/
Git Repo - https://github.com/SpiderLabs/owasp-modsecurity-crs

This initial commit to GitHub contains CRS v2.2.6 updates.  If you want to
download packages archives, use these links:
https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/master
https://github.com/SpiderLabs/owasp-modsecurity-crs/zipball/master

If you find any issues with the new CRS, please use the GitHub Issues
interface - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues.
This will most likely replace our current Jira system for bug tracking.

Keep in mind that we have only done this for the OWASP ModSecurity CRS and
not for the ModSecurity source code yet.  We will be doing that in the
near future.

Let me know if anyone has any issues/questions/comments.

Other than that, I say GO FORTH AND FORK AWAY!!!  I am really hoping that
this move will help to make community contributions easier.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader




On 8/9/12 5:54 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

>We are considering a migration of our ModSecurity source code and the
>OWASP CRS from sourceforge (SVN) to GitHub (git).
>
>There are many reasons why we are considering it but the most relevant
>one is enabling community contributions. I had a number of people tell me
>in person at Blackhat that if the project was moved to GitHub they would
>more inclined to contribute.
>
>If you agree or disagree with this rationale then please let me know.
>
>Thanks.
>
>--
>Ryan Barnett
>Researcher Lead
>Trustwave - SpiderLabs
>


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From yersinia.spiros at gmail.com  Sat Sep 15 07:15:30 2012
From: yersinia.spiros at gmail.com (yersinia)
Date: Sat, 15 Sep 2012 09:15:30 +0200
Subject: [Owasp-modsecurity-core-rule-set] Considering Migration to
	GitHub
In-Reply-To: <01987910BF74B341B5890120BCCE77DF012C65@SKYMB1.trustwave.com>
References: <ADFA2318-1ADC-41F4-945B-73803522BB48@trustwave.com>
	<01987910BF74B341B5890120BCCE77DF012C65@SKYMB1.trustwave.com>
Message-ID: <CAH5b-BXCD_wrNeNvPKKKd=FFZPY7vQGFpKGGnHZSx7mTddNCsg@mail.gmail.com>

Just for info i have setup a mirror of the modsecurity code and crs,
years ago, under bazar on launchpad. It live under a my personal
account , but it is public . The original modsecurity mirror on
lauchpad point to a very old cvs repo , and the lauchpad admins did
not want to update it. It is always in sync with the sf svn repo,
thanks to the launchpad platform: so i am tracking the modsecurity
development in real time from years :=).

Github don't offer a similar feature, but i prefer to use git Anyway.

Best regards

2012/9/14, Ryan Barnett <RBarnett at trustwave.com>:
> I wanted to update everyone to let them know that I have begun the process
> of migrating the OWASP ModSecurity Core Rule Set from SourceForge (SVN) to
> GitHub (git).
>
> Here is the current repo/data for testing -
>
> Landing Page - http://spiderlabs.github.com/owasp-modsecurity-crs/
> Git Repo - https://github.com/SpiderLabs/owasp-modsecurity-crs
>
> This initial commit to GitHub contains CRS v2.2.6 updates.  If you want to
> download packages archives, use these links:
> https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/master
> https://github.com/SpiderLabs/owasp-modsecurity-crs/zipball/master
>
> If you find any issues with the new CRS, please use the GitHub Issues
> interface - https://github.com/SpiderLabs/owasp-modsecurity-crs/issues.
> This will most likely replace our current Jira system for bug tracking.
>
> Keep in mind that we have only done this for the OWASP ModSecurity CRS and
> not for the ModSecurity source code yet.  We will be doing that in the
> near future.
>
> Let me know if anyone has any issues/questions/comments.
>
> Other than that, I say GO FORTH AND FORK AWAY!!!  I am really hoping that
> this move will help to make community contributions easier.
>
> --
> Ryan Barnett
> Trustwave SpiderLabs
> ModSecurity Project Leader
> OWASP ModSecurity CRS Project Leader
>
>
>
>
> On 8/9/12 5:54 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:
>
>>We are considering a migration of our ModSecurity source code and the
>>OWASP CRS from sourceforge (SVN) to GitHub (git).
>>
>>There are many reasons why we are considering it but the most relevant
>>one is enabling community contributions. I had a number of people tell me
>>in person at Blackhat that if the project was moved to GitHub they would
>>more inclined to contribute.
>>
>>If you agree or disagree with this rationale then please let me know.
>>
>>Thanks.
>>
>>--
>>Ryan Barnett
>>Researcher Lead
>>Trustwave - SpiderLabs
>>
>
>
> ________________________________
>
> This transmission may contain information that is privileged, confidential,
> and/or exempt from disclosure under applicable law. If you are not the
> intended recipient, you are hereby notified that any disclosure, copying,
> distribution, or use of the information contained herein (including any
> reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
> in error, please immediately contact the sender and destroy the material in
> its entirety, whether in electronic or hard copy format.
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>

-- 
Inviato dal mio dispositivo mobile

From leonardo at lbasolutions.com  Wed Sep 19 17:46:40 2012
From: leonardo at lbasolutions.com (Leonardo Bacha Abrantes)
Date: Wed, 19 Sep 2012 14:46:40 -0300
Subject: [Owasp-modsecurity-core-rule-set] Except rule has been ignoring
Message-ID: <CAG+8EEZe0z6YLYPWaUh-N1-9WmrXnqYovM0kq7kjWfK0dyM=Bw@mail.gmail.com>

Hey people,

I'm using drupal and I created a list of IPs to access it using this rule:

# This rule was created to allow a list of IPs in a file to access
/update.php
SecRule REQUEST_URI "^/update.php"
id:1,phase:1,chain,nolog,t:none,allow,setvar:tx.remote_addr=/%{REMOTE_ADDR}/
  SecRule TX:REMOTE_ADDR "@pmFromFile
/etc/httpd/conf.d/modsecurity/base_rules/Allowed_to_run_update_php"
t:none,ctl:ruleEngine=off

# to access /user interface
SecRule REQUEST_URI "^/user"
id:2,phase:1,chain,nolog,t:none,allow,setvar:tx.remote_add=/%{REMOTE_ADD}/
  SecRule TX:REMOTE_ADD "@pmFromFile
/etc/httpd/conf.d/modsecurity/base_rules/Allowed_to_run_admin"
t:none,ctl:ruleEngine=off

when I try to access /user and log am receiving the error below:


[19/Sep/2012:14:40:36 --0300] [
10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1] Access denied with code
403 (phase 2). Pattern match
"(/\\*!?|\\*/|[';]--|--[\\s\\r\\n\\v\\f]|(?:--[^-]*?-)|([^\\-&])#.*?[\\s\\r\\n\\v\\f]|;?\\x00)"
at ARGS:pass. [file
"/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"]
[line "49"] [id "981231"] [rev "2.2.5"] [msg "SQL Comment Sequence
Detected."] [data "--Ancine-"] [tag "WEB_ATTACK/SQL_INJECTION"] [tag
"WASCTC/WASC-19"] [tag "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag
"PCI/6.5.2"]
[19/Sep/2012:14:40:39 --0300] [
10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1] Access denied with code
501 (phase 2). Pattern match
"^(?:ht|f)tps?:\\/\\/(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" at
ARGS:pass. [file
"/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_40_generic_attacks.conf"]
[line "142"] [id "950117"] [rev "2.2.5"] [msg "Remote File Inclusion
Attack"] [severity "CRITICAL"] [tag "WEB_ATTACK/RFI"]
[19/Sep/2012:14:40:46 --0300] [
10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1] Access denied with code
501 (phase 2). Pattern match
"^(?:ht|f)tps?:\\/\\/(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" at
ARGS:pass. [file
"/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_40_generic_attacks.conf"]
[line "142"] [id "950117"] [rev "2.2.5"] [msg "Remote File Inclusion
Attack"] [severity "CRITICAL"] [tag "WEB_ATTACK/RFI"]


in the exception files I'm doing this:

/10.1.125.204/


what is wrong ?

many thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120919/3eafac33/attachment.html>

From RBarnett at trustwave.com  Wed Sep 19 18:12:05 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 19 Sep 2012 18:12:05 +0000
Subject: [Owasp-modsecurity-core-rule-set] Except rule has been ignoring
In-Reply-To: <CAG+8EEZe0z6YLYPWaUh-N1-9WmrXnqYovM0kq7kjWfK0dyM=Bw@mail.gmail.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF01791F@SKYMB1.trustwave.com>

Leonardo,
How are you activating these rules?  Did you put them in a custom rules file?  Is this rules file included with the other CRS rule files in Apache Include directives?

You are showing debug log snippets below.  If your rules are activated, there should be debug log process regardless of whether the rules matched or not.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

From: Leonardo Bacha Abrantes <leonardo at lbasolutions.com<mailto:leonardo at lbasolutions.com>>
Date: Wednesday, September 19, 2012 1:46 PM
To: OWASP Mod Security <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>, "mod-security-users at lists.sourceforge.net<mailto:mod-security-users at lists.sourceforge.net>" <mod-security-users at lists.sourceforge.net<mailto:mod-security-users at lists.sourceforge.net>>
Subject: [Owasp-modsecurity-core-rule-set] Except rule has been ignoring

Hey people,

I'm using drupal and I created a list of IPs to access it using this rule:

# This rule was created to allow a list of IPs in a file to access /update.php
SecRule REQUEST_URI "^/update.php" id:1,phase:1,chain,nolog,t:none,allow,setvar:tx.remote_addr=/%{REMOTE_ADDR}/
  SecRule TX:REMOTE_ADDR "@pmFromFile /etc/httpd/conf.d/modsecurity/base_rules/Allowed_to_run_update_php"  t:none,ctl:ruleEngine=off

# to access /user interface
SecRule REQUEST_URI "^/user" id:2,phase:1,chain,nolog,t:none,allow,setvar:tx.remote_add=/%{REMOTE_ADD}/
  SecRule TX:REMOTE_ADD "@pmFromFile /etc/httpd/conf.d/modsecurity/base_rules/Allowed_to_run_admin"  t:none,ctl:ruleEngine=off

when I try to access /user and log am receiving the error below:


[19/Sep/2012:14:40:36 --0300] [10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1<http://10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1>] Access denied with code 403 (phase 2). Pattern match "(/\\*!?|\\*/|[';]--|--[\\s\\r\\n\\v\\f]|(?:--[^-]*?-)|([^\\-&])#.*?[\\s\\r\\n\\v\\f]|;?\\x00)" at ARGS:pass. [file "/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_41_sql_injection_attacks.conf"] [line "49"] [id "981231"] [rev "2.2.5"] [msg "SQL Comment Sequence Detected."] [data "--Ancine-"] [tag "WEB_ATTACK/SQL_INJECTION"] [tag "WASCTC/WASC-19"] [tag "OWASP_TOP_10/A1"] [tag "OWASP_AppSensor/CIE1"] [tag "PCI/6.5.2"]
[19/Sep/2012:14:40:39 --0300] [10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1<http://10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1>] Access denied with code 501 (phase 2). Pattern match "^(?:ht|f)tps?:\\/\\/(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" at ARGS:pass. [file "/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_40_generic_attacks.conf"] [line "142"] [id "950117"] [rev "2.2.5"] [msg "Remote File Inclusion Attack"] [severity "CRITICAL"] [tag "WEB_ATTACK/RFI"]
[19/Sep/2012:14:40:46 --0300] [10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1<http://10.1.125.204/sid#228f4e8][rid#35c23f0][/user][1>] Access denied with code 501 (phase 2). Pattern match "^(?:ht|f)tps?:\\/\\/(\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" at ARGS:pass. [file "/etc/httpd/conf.d/modsecurity/base_rules/modsecurity_crs_40_generic_attacks.conf"] [line "142"] [id "950117"] [rev "2.2.5"] [msg "Remote File Inclusion Attack"] [severity "CRITICAL"] [tag "WEB_ATTACK/RFI"]


in the exception files I'm doing this:

/10.1.125.204/<http://10.1.125.204/>


what is wrong ?

many thanks!

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120919/dcb0212c/attachment.html>

From malevo at gmail.com  Wed Sep 19 18:45:33 2012
From: malevo at gmail.com (Pablo Garcia Melga)
Date: Wed, 19 Sep 2012 15:45:33 -0300
Subject: [Owasp-modsecurity-core-rule-set] Cannot start apache after adding
	core rule set
Message-ID: <CAE4+7XEeNO+t0EBYPJ-f9ZzLxHiANQ67UGMyWYYwmJdb059QEg@mail.gmail.com>

Hi, (newbie here), I just finished to compile the mod_security, create a
few rules of my own, and everthing worked fine, Until I added the
SpiderLabs core rules, now I get this error when I try to restart the
apache.

"Syntax error on line 52 of
/opt/modsecurity/etc/activated_rules/modsecurity_crs_20_protocol_violations.conf:
Error parsing actions: Unknown action: ver"

If I comment that rule file I get the same problem with the next one, the
mod_security is 2.6.7, the rule files are 2.2.6, although I get the PCRE
warning in the apache error log, everything works file until I upload this
rules, any ideas ?

Best Regards, Pablo
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120919/f9ef717d/attachment.html>

From RBarnett at trustwave.com  Wed Sep 19 18:50:09 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 19 Sep 2012 18:50:09 +0000
Subject: [Owasp-modsecurity-core-rule-set] Cannot start apache after
 adding core rule set
In-Reply-To: <CAE4+7XEeNO+t0EBYPJ-f9ZzLxHiANQ67UGMyWYYwmJdb059QEg@mail.gmail.com>
Message-ID: <01987910BF74B341B5890120BCCE77DF017A78@SKYMB1.trustwave.com>

The latest rules in the GitHub repo (https://github.com/SpiderLabs/owasp-modsecurity-crs) are v2.6.6.  This version requires features in v2.7.0 of ModSecurity (ver, accuracy and maturity actions).

If you are using < 2.7.0, you should use the CRS version v2.2.5.  Download here -
https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/v2.2.5

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader


From: Pablo Garcia Melga <malevo at gmail.com<mailto:malevo at gmail.com>>
Date: Wednesday, September 19, 2012 2:45 PM
To: <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: [Owasp-modsecurity-core-rule-set] Cannot start apache after adding core rule set

Hi, (newbie here), I just finished to compile the mod_security, create a few rules of my own, and everthing worked fine, Until I added the SpiderLabs core rules, now I get this error when I try to restart the apache.

"Syntax error on line 52 of /opt/modsecurity/etc/activated_rules/modsecurity_crs_20_protocol_violations.conf:
Error parsing actions: Unknown action: ver"

If I comment that rule file I get the same problem with the next one, the mod_security is 2.6.7, the rule files are 2.2.6, although I get the PCRE warning in the apache error log, everything works file until I upload this rules, any ideas ?

Best Regards, Pablo
_______________________________________________ Owasp-modsecurity-core-rule-set mailing list Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120919/d3ef96f5/attachment-0001.html>

From malevo at gmail.com  Wed Sep 19 18:51:46 2012
From: malevo at gmail.com (Pablo Garcia Melga)
Date: Wed, 19 Sep 2012 15:51:46 -0300
Subject: [Owasp-modsecurity-core-rule-set] Cannot start apache after
 adding core rule set
In-Reply-To: <01987910BF74B341B5890120BCCE77DF017A78@SKYMB1.trustwave.com>
References: <CAE4+7XEeNO+t0EBYPJ-f9ZzLxHiANQ67UGMyWYYwmJdb059QEg@mail.gmail.com>
	<01987910BF74B341B5890120BCCE77DF017A78@SKYMB1.trustwave.com>
Message-ID: <CAE4+7XEM82vzU8odWDXuy=y3SJiEJizhya4nynGL8nmdC40LsA@mail.gmail.com>

Thanks Ryan, this is a first time install, nothing productive, should I go
with the 2.7.0 or stay with the stable 2.6.6 ?

Regards, Pablo

On Wed, Sep 19, 2012 at 3:50 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:

>  The latest rules in the GitHub repo (
> https://github.com/SpiderLabs/owasp-modsecurity-crs) are v2.6.6.  This
> version requires features in v2.7.0 of ModSecurity (ver, accuracy and
> maturity actions).
>
>  If you are using < 2.7.0, you should use the CRS version v2.2.5.
>  Download here -
> https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/v2.2.5
>
>   --
> Ryan Barnett
> Trustwave SpiderLabs
> ModSecurity Project Leader
> OWASP ModSecurity CRS Project Leader
>
>
>   From: Pablo Garcia Melga <malevo at gmail.com>
> Date: Wednesday, September 19, 2012 2:45 PM
> To: <owasp-modsecurity-core-rule-set at lists.owasp.org>
> Subject: [Owasp-modsecurity-core-rule-set] Cannot start apache after
> adding core rule set
>
>  Hi, (newbie here), I just finished to compile the mod_security, create a
> few rules of my own, and everthing worked fine, Until I added the
> SpiderLabs core rules, now I get this error when I try to restart the
> apache.
>
>  "Syntax error on line 52 of
> /opt/modsecurity/etc/activated_rules/modsecurity_crs_20_protocol_violations.conf:
>  Error parsing actions: Unknown action: ver"
>
>  If I comment that rule file I get the same problem with the next one,
> the mod_security is 2.6.7, the rule files are 2.2.6, although I get the
> PCRE warning in the apache error log, everything works file until I upload
> this rules, any ideas ?
>
>  Best Regards, Pablo
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
> ------------------------------
>
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120919/ce811f34/attachment.html>

From RBarnett at trustwave.com  Thu Sep 20 17:54:37 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 20 Sep 2012 17:54:37 +0000
Subject: [Owasp-modsecurity-core-rule-set] Blog Post: Web Application
	Defense: Bayesian Attack Analysis
Message-ID: <01987910BF74B341B5890120BCCE77DF018CF7@SKYMB1.trustwave.com>

I just posted this blog entry - http://blog.spiderlabs.com/2012/09/web-application-defense-bayesian-attack-analysis.html

The rule files and Lua scripts have been pushed out to the GitHub repo - https://github.com/SpiderLabs/owasp-modsecurity-crs

Cheers.

--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120920/eb1400cb/attachment.html>

From yanzhenyu at 55tuan.com  Fri Sep 21 07:33:52 2012
From: yanzhenyu at 55tuan.com (=?gb2312?B?48bV8dPu?=)
Date: Fri, 21 Sep 2012 15:33:52 +0800
Subject: [Owasp-modsecurity-core-rule-set] Is modsecurity for nginx avaiable
Message-ID: <201209211533518555281@55tuan.com>

Hi,everyone
Is modsecurity for nginx avaiable ?  I accessed this page ,and there wasn't modsecurity-nginx.
http://sourceforge.net/projects/mod-security/files/ 

where to download ?


2012-09-21 



  
??? ???

????????????
?????????????1?????9?? ???100084
???+86-10-59065069     ???+86-10-59065678
Mob?+86-13261949497
E-mail:yanzhenyu at 55tuan.com www.55tuan.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120921/2e155682/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 17742_17742_Catc(05-30-01-05-39).jpg
Type: image/jpeg
Size: 17742 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120921/2e155682/attachment-0001.jpg>

From paul.freeman at emlchem.com.au  Sun Sep 23 23:17:33 2012
From: paul.freeman at emlchem.com.au (Paul Freeman)
Date: Sun, 23 Sep 2012 23:17:33 +0000
Subject: [Owasp-modsecurity-core-rule-set] Customise a rule to prevent false
	positive for a Joomla extension
Message-ID: <1F13F4C925B73F48A73307A32424FB87014C15482D@chemsur-ex-01.emlchem.local>

Hi
I have recently installed mod-security2 (v 2.6.3-1ubuntu0.2) on Ubuntu 12.04 LTS and the OWASP core rule set (v 2.2.5) as part of securing a web server running Joomla 2.5.6.  I am using a Joomla template from Yootheme based on their Warp Theme framework v6.2 and their Widgetkit toolset v1.2.

Mod-security2 is generating a false positive for the Widgetkit map component and I was wondering how to go about creating a custom local rule exception for this.  I have searched and come across some examples of custom rules but must admit I am a bit unsure about the how to create the rule in this case.

The information from the modsec_audit.log is as follows:

--4a562b4c-B--
GET /component/widgetkit/?tmpl=raw&amp;id=5 HTTP/1.1
Host: sur-static-31.xxxx.yyyy
User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:15.0) Gecko/20100101 Firefox/15.0
Accept: */*
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
X-Requested-With: XMLHttpRequest
Referer: http://sur-static-31.xxxx.yyyy/about-us/contact-us/general-contact-information
Cookie: 8d46d49916e124b333b939f5c4e13acd=pdem1o994m5e29vlsc1dhqhv35; 03698be3bfdfc6348389481d8d00062c=r1tmq1i1pkgboh6fhmr3tl7oo6; jpanesliders_panel-sliders=0; jpanesliders_position-icon=0; jpanesliders_content-sliders-26=0; jpanesliders_permissions-sliders-26=0; jpanesliders_permissions-sliderscom_content=0

--4a562b4c-F--
HTTP/1.1 403 Forbidden
Vary: Accept-Encoding
Content-Encoding: gzip
Content-Length: 192
Keep-Alive: timeout=5, max=99
Connection: Keep-Alive
Content-Type: text/html; charset=iso-8859-1

--4a562b4c-E--
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>403 Forbidden</title>
</head><body>
<h1>Forbidden</h1>
<p>You don't have permission to access /component/widgetkit/
on this server.</p>
</body></html>

--4a562b4c-H--
Message: Access denied with code 403 (phase 2). Pattern match "(?:\\b(?:(?:n(?:et(?:\\b\\W+?\\blocalgroup|\\.exe)|(?:map|c)\\.exe)|t(?:racer(?:oute|t)|elnet\\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\\.exe|echo\\b\\W*?\\by+)\\b|c(?:md(?:(?:\\.exe|32)\\b|\\b\\W*?\\/c)|d(?:\\b\\W*?[\\/]|\\W*?\\.\\.)|hmod.{0,40}?\\ ..." at ARGS_NAMES:amp;id. [file "/etc/modsecurity/activated_rules/modsecurity_crs_40_generic_attacks.conf"] [line "197"] [id "950006"] [rev "2.2.5"] [msg "System Command Injection"] [data ";id"] [severity "CRITICAL"] [tag "WEB_ATTACK/COMMAND_INJECTION"] [tag "WASCTC/WASC-31"] [tag "OWASP_TOP_10/A1"] [tag "PCI/6.5.2"]
Action: Intercepted (phase 2)
Stopwatch: 1348215302952777 4630 (- - -)
Stopwatch2: 1348215302952777 4630; combined=2688, p1=346, p2=2283, p3=0, p4=0, p5=59, sr=100, sw=0, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for Apache/2.6.3 (http://www.modsecurity.org/); OWASP_CRS/2.2.5.
Server: Apache

--4a562b4c-Z--

As I understand the log data, rule 950006 is actvated by the "id" variable in the url GET request GET /component/widgetkit/?tmpl=raw&amp;id=5 HTTP/1.1.

The "id" variable is the unique identity of the particular map created in the Widgetkit Map component.

I tried to create a rule in modsecurity_crs_48_local_exceptions.conf based on the information in the triggered rule using ARGS_NAMES and trying to match the suffix of the url as follows:

SecRule ARGS_NAMES:amp;id "@streq raw&id=5" \
        "phase:2,t:none,nolog,pass,setvar:tx.anomaly_score=-20"

This does not work and I am confident I am not getting the semantics correct.

Also, I notice the url is being displayed in the error as ARGS_NAMES:amp;id whereas I thought it should be &id.

Could anyone provide some pointers or refer me to documentation for how to create the rule correctly (excluding the actual value 5 so as to make it more general) so accessing this component will not trigger this rule without completely disabling the rule.

Thanks in advance.

Regards

Paul Freeman



__________ Information from ESET Smart Security, version of virus signature database 7508 (20120923) __________

The message was checked by ESET Smart Security.

http://www.eset.com



From yanzhenyu at 55tuan.com  Mon Sep 24 10:14:51 2012
From: yanzhenyu at 55tuan.com (=?gb2312?B?48bV8dPu?=)
Date: Mon, 24 Sep 2012 18:14:51 +0800
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Loaded PCRE do not
	match with compiled!
Message-ID: <201209241814502442580@55tuan.com>

Hi,everyone
I installed Apache and Modsecurity.I started apache. When I  checked error_.log  I got the warning message .

[root at localhost logs]# more error_log
[Mon Sep 24 02:58:36 2012] [warn] Init: Session Cache is not configured [hint: SSLSessionCache]
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity for Apache/2.6.7 (http://www.modsecurity.org/) configured.
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity: APR compiled version="1.4.5"; loaded version="1.4.5"
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity: PCRE compiled version="8.10 "; loaded version="5.0 13-Sep-2004"
[Mon Sep 24 02:58:36 2012] [warn] ModSecurity: Loaded PCRE do not match with compiled!
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity: LIBXML compiled version="2.7.8"
[Mon Sep 24 02:58:36 2012] [notice] Digest: generating secret for digest authentication ...
[Mon Sep 24 02:58:36 2012] [notice] Digest: done
[Mon Sep 24 02:58:37 2012] [notice] Apache/2.2.22 (Unix) mod_ssl/2.2.22 OpenSSL/0.9.8e-fips-rhel5 DAV/2 configured -- resuming normal operations


I configed modsecurity with this command:
./configure --with-apxs=/usr/local/apache2/bin/apxs  
--with-pcre=/usr/local/pcre/bin/pcre-config 
--with-apr=/usr/local/apr 
--with-apu=/usr/local/apache/bin/apu-1-config 
--with-libxml=/usr/local/libxml2 
--with-curl=/usr/local/curl 

The version of related software is :
Apache 2.2.2
modsecurity 2.6.7


How could I solve this problem ? thanks for any idea.





2012-09-24 



  
??? ???

????????????
?????????????1?????9?? ???100084
???+86-10-59065069     ???+86-10-59065678
Mob?+86-13261949497
E-mail:yanzhenyu at 55tuan.com www.55tuan.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120924/5999a273/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 17742_17742_Catc(05-30-01-05-39).jpg
Type: image/jpeg
Size: 17742 bytes
Desc: not available
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120924/5999a273/attachment-0001.jpg>

From RBarnett at trustwave.com  Mon Sep 24 11:48:42 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Mon, 24 Sep 2012 11:48:42 +0000
Subject: [Owasp-modsecurity-core-rule-set] ModSecurity: Loaded PCRE do
 not	match with compiled!
In-Reply-To: <201209241814502442580@55tuan.com>
References: <201209241814502442580@55tuan.com>
Message-ID: <7EEB2BEC-8692-4D27-9C89-6E43149FE744@trustwave.com>

This question is better suited for the ModSecurity mail list -
https://lists.sourceforge.net/lists/listinfo/mod-security-users

--
Ryan Barnett
Lead Security Researcher
Trustwave - SpiderLabs


On Sep 24, 2012, at 6:20 AM, "???" <yanzhenyu at 55tuan.com<mailto:yanzhenyu at 55tuan.com>> wrote:

Hi,everyone
I installed Apache and Modsecurity.I started apache. When I  checked error_.log  I got the warning message .

[root at localhost logs]# more error_log
[Mon Sep 24 02:58:36 2012] [warn] Init: Session Cache is not configured [hint: SSLSessionCache]
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity for Apache/2.6.7 (http://www.modsecurity.org/) configured.
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity: APR compiled version="1.4.5"; loaded version="1.4.5"
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity: PCRE compiled version="8.10 "; loaded version="5.0 13-Sep-2004"
[Mon Sep 24 02:58:36 2012] [warn] ModSecurity: Loaded PCRE do not match with compiled!
[Mon Sep 24 02:58:36 2012] [notice] ModSecurity: LIBXML compiled version="2.7.8"
[Mon Sep 24 02:58:36 2012] [notice] Digest: generating secret for digest authentication ...
[Mon Sep 24 02:58:36 2012] [notice] Digest: done
[Mon Sep 24 02:58:37 2012] [notice] Apache/2.2.22 (Unix) mod_ssl/2.2.22 OpenSSL/0.9.8e-fips-rhel5 DAV/2 configured -- resuming normal operations


I configed modsecurity with this command:
./configure --with-apxs=/usr/local/apache2/bin/apxs
--with-pcre=/usr/local/pcre/bin/pcre-config
--with-apr=/usr/local/apr
--with-apu=/usr/local/apache/bin/apu-1-config
--with-libxml=/usr/local/libxml2
--with-curl=/usr/local/curl

The version of related software is :
Apache 2.2.2
modsecurity 2.6.7


How could I solve this problem ? thanks for any idea.





2012-09-24
________________________________

??? ???
<17742_17742_Catc(05-30-01-05-39).jpg>
????????????
?????????????1?????9?? ???100084
???+86-10-59065069     ???+86-10-59065678
Mob?+86-13261949497
E-mail:yanzhenyu at 55tuan.com www.55tuan.com<http://www.55tuan.com/>



_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120924/9f3328a2/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 17742_17742_Catc(05-30-01-05-39).jpg
Type: image/jpeg
Size: 17742 bytes
Desc: 17742_17742_Catc(05-30-01-05-39).jpg
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120924/9f3328a2/attachment-0001.jpg>

From vahidghayoomi at gmail.com  Tue Sep 25 10:29:21 2012
From: vahidghayoomi at gmail.com (vahid ghayoomi)
Date: Tue, 25 Sep 2012 13:59:21 +0330
Subject: [Owasp-modsecurity-core-rule-set] customized logging
Message-ID: <CALDNneEA2Z1s4ab7W8k4XWwa7JuoKgoKGB99R2+s6_Cp+AQG4Q@mail.gmail.com>

Hi guys,

Is there any way to customize Modsecurity index log file in concurrent
mode? (e.g. adding [foo] to every event in audit.log in concurrent mode)

Thanks in advance,
Vahid
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120925/94053ad7/attachment.html>

From vahidghayoomi at gmail.com  Tue Sep 25 10:47:14 2012
From: vahidghayoomi at gmail.com (vahid ghayoomi)
Date: Tue, 25 Sep 2012 14:17:14 +0330
Subject: [Owasp-modsecurity-core-rule-set] customized logging
In-Reply-To: <CALDNneEA2Z1s4ab7W8k4XWwa7JuoKgoKGB99R2+s6_Cp+AQG4Q@mail.gmail.com>
References: <CALDNneEA2Z1s4ab7W8k4XWwa7JuoKgoKGB99R2+s6_Cp+AQG4Q@mail.gmail.com>
Message-ID: <CALDNneGozCHdx5AdjJ7p7+7mEXTt6d-de-PSJc8qWu1dsieahw@mail.gmail.com>

Pardon me for not considering the right place, and asked
an irrelevant question in this mailing list!!
I just found it.

On Tue, Sep 25, 2012 at 1:59 PM, vahid ghayoomi <vahidghayoomi at gmail.com>wrote:

> Hi guys,
>
> Is there any way to customize Modsecurity index log file in concurrent
> mode? (e.g. adding [foo] to every event in audit.log in concurrent mode)
>
> Thanks in advance,
> Vahid
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120925/b9e83fb7/attachment.html>

From RBarnett at trustwave.com  Fri Sep 28 18:14:42 2012
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 28 Sep 2012 18:14:42 +0000
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release of OWASP
	ModSecurity CRS v2.2.6
Message-ID: <01987910BF74B341B5890120BCCE77DF01F02F@SKYMB1.trustwave.com>

New OWASP ModSecurity CRS Repo on GitHub - https://github.com/SpiderLabs/owasp-modsecurity-crs
Download latest rules here - https://github.com/SpiderLabs/owasp-modsecurity-crs/tarball/master

== CHANGES ==

Improvements:
* Started rule formatting update for better readability
* Added maturity and accuracy action data to each rule
* Updated rule revision (rev) action
* Added rule version (ver) action
* Added more regression tests (util/regression_tests/)
* Modified Rule ID 960342 to block large file attachments in phase:1
* Removed all PARANOID rule checks
* Added new Session Fixation rules

Bug Fixes:
* Fixed missing ending double-quotes in XSS rules file
* Moved SecDefaultAction setting from phase:2 to phase:1
* Fixed Session Hijacking SessionID Regex
  https://www.modsecurity.org/tracker/browse/CORERULES-79
* Changed the variable listing for many generic attack rules to exclude REQUEST_FILENAME
  https://www.modsecurity.org/tracker/browse/CORERULES-78


--
Ryan Barnett
Trustwave SpiderLabs
ModSecurity Project Leader
OWASP ModSecurity CRS Project Leader

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20120928/54570b49/attachment.html>

