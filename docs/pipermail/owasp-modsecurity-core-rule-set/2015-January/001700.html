<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Legitimate%20traffic%20being%0A%20blocked&In-Reply-To=%3CF684BDD553BAF1479F5380EDAD3BE371F77877%40SKYMB1.trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001699.html">
   <LINK REL="Next"  HREF="001701.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Legitimate%20traffic%20being%0A%20blocked&In-Reply-To=%3CF684BDD553BAF1479F5380EDAD3BE371F77877%40SKYMB1.trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked">CSanders at trustwave.com
       </A><BR>
    <I>Tue Jan 27 15:56:49 UTC 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="001699.html">[Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked
</A></li>
        <LI>Next message: <A HREF="001701.html">[Owasp-modsecurity-core-rule-set] Legitimate traffic being	blocked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1700">[ date ]</a>
              <a href="thread.html#1700">[ thread ]</a>
              <a href="subject.html#1700">[ subject ]</a>
              <a href="author.html#1700">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Jacob sorry for the slow response,
Based on your log file it seems clear that you are using an out dated version of CRS. Updating may fix *some* of the false positives you are facing. Upon inspecting your log the following rules are being triggered:
        Detects concatenated basic SQL Injection and SQLLFI attempts
        Request from Known SPAM Source
        Restricted SQL Character anomaly detection alert
        SQL Injection Attack: SQL Operator Detected
        Request content type is not allowed by policy
It is possible that some or all of these are false positives based on how the application is functioning. I suggest you follow the guidance set forth in the following blog post (<A HREF="http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-exception-handling.html">http://blog.spiderlabs.com/2011/08/modsecurity-advanced-topic-of-the-week-exception-handling.html</A>) in order to analyze these events. If you are having additional issues please be sure to reach out and we will try to address them as best as possible. Thanks!


Chaim Sanders
Security Researcher, SpiderLabs

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com


-----Original Message-----
From: Ryan Barnett
Sent: Tuesday, January 27, 2015 10:04 AM
To: Chaim Sanders
Subject: FW: [Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked

On 1/23/15, 6:20 PM, &quot;Jacob Lear&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">jacob at fosterclub.com</A>&gt; wrote:

&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>I am working on setting up better security for my Debian 6 server. I am
</I>&gt;<i>new to ModSecurity and OWASP Core Rules. The problem that I'm having is
</I>&gt;<i>that it is blocking legitimate traffic and I don't understand why or
</I>&gt;<i>how to fix it. Can somebody help me? Here is some pretty detailed
</I>&gt;<i>information about my environment and my problem.
</I>&gt;<i>
</I>&gt;<i>Apache2 is my webserver and it is installed from the Debian package.
</I>&gt;<i>The version is 2.2.16-6+squeeze14. I'm using the Worker MPM.
</I>&gt;<i>I installed ModSecurity from the Debian package. The version is:
</I>&gt;<i>2.5.12-1+squeeze4
</I>&gt;<i>Per the recommendation of an article I found online, I installed OWASP
</I>&gt;<i>2.2.5-0. I had initially tried the most recent version of OWASP but
</I>&gt;<i>this gave me errors (due to my version of ModSecurity).
</I>&gt;<i>I'm using PHP compiled from source, version 5.4.24.
</I>&gt;<i>I'm using PHP-FPM FastCGI.
</I>&gt;<i>I'm using MySQL 5.1.73-1+deb6u1.
</I>&gt;<i>I'm using Memcached 2.1.0.
</I>&gt;<i>ZendOpcode Cache 7.0.3 is installed.
</I>&gt;<i>Website is built using the Drupal CMS, version 7.28.
</I>&gt;<i>All non-SSL traffic is redirected to SSL.
</I>&gt;<i>
</I>&gt;<i>I had some troubles getting Apache2 to pass the configtest but I was
</I>&gt;<i>able to find the proper configuration changes needed via Google
</I>&gt;<i>searching. I enabled all of the rules as per the INSTALL instructions
</I>&gt;<i>included in OWASP CRS. I also enabled the experimental Brute Force,
</I>&gt;<i>DOS, and Slow DOS rules (these don't appear to be causing any issues.)
</I>&gt;<i>
</I>&gt;<i>I set ModSecurity to &quot;On&quot; mode but quickly got complaints from our
</I>&gt;<i>staff being blocked by it. So now it is in &quot;DetectionOnly&quot; mode. I
</I>&gt;<i>looked in the AuditLog but didn't see anything helpful in there (just a
</I>&gt;<i>bunch of stuff about cookies -- perhaps because things in the 10 setup
</I>&gt;<i>file are set to nolog?). However, the Apache2 SSL Error log shows a lot
</I>&gt;<i>of information about the block attempts.
</I>&gt;<i>
</I>&gt;<i>Our staff users are connecting from the IP address 63.227.218.204, so I
</I>&gt;<i>filtered the SSL Error Log to dump all entries with that IP address to
</I>&gt;<i>a separate file. All of the warnings/errors in this log are legitimate
</I>&gt;<i>traffic. So I need help tuning ModSecurity and OWASP to permit this
</I>&gt;<i>traffic. I've attached the log file to this post.
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-">http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-</A>
</I>&gt;<i>GhD
</I>&gt;<i>Vv7Jp46g&amp;s=5&amp;u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
</I>&gt;<i>ffi
</I>&gt;<i>les%2ffile%2foutput%2elog
</I>&gt;<i>
</I>&gt;<i>I have also attached my modsecurity.conf file and my
</I>&gt;<i>modsecurity_crs_10_setup.conf file.
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-">http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-</A>
</I>&gt;<i>GhD
</I>&gt;<i>Ns5sp46Q&amp;s=5&amp;u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
</I>&gt;<i>ffi
</I>&gt;<i>les%2ffile%2fmodsecurity%2econf
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-">http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-</A>
</I>&gt;<i>GhG
</I>&gt;<i>Vrusp95w&amp;s=5&amp;u=https%3a%2f%2fwww%2efosterclub%2ecom%2fsites%2fdefault%2
</I>&gt;<i>ffi les%2ffile%2fmodsecurity%5fcrs%5f10%5fsetup%2econf
</I>&gt;<i>
</I>&gt;<i>I would very much appreciate any help anyone can offer. Please let me
</I>&gt;<i>know if you need any additional information. Thanks!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>--
</I>&gt;<i>
</I>&gt;<i>Jacob Lear
</I>&gt;<i>Web Administrator
</I>&gt;<i>FosterClub, Inc.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>---
</I>&gt;<i>This email has been checked for viruses by Avast antivirus software.
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-">http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-</A>
</I>&gt;<i>GhG Ey688p7w&amp;s=5&amp;u=http%3a%2f%2fwww%2eavast%2ecom
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i><A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i><A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-">http://scanmail.trustwave.com/?c=4062&amp;d=rNzC1FWzzHEEgobdigSUf2LNp5DNTN-</A>
</I>&gt;<i>GhG
</I>&gt;<i>Q65sp85w&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2
</I>&gt;<i>fow
</I>&gt;<i>asp-modsecurity-core-rule-set
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001699.html">[Owasp-modsecurity-core-rule-set] Legitimate traffic being blocked
</A></li>
	<LI>Next message: <A HREF="001701.html">[Owasp-modsecurity-core-rule-set] Legitimate traffic being	blocked
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1700">[ date ]</a>
              <a href="thread.html#1700">[ thread ]</a>
              <a href="subject.html#1700">[ subject ]</a>
              <a href="author.html#1700">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
