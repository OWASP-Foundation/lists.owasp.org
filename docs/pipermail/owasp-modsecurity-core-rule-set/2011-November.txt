From Anna.Chulaki at nasa.gov  Tue Nov  1 16:55:37 2011
From: Anna.Chulaki at nasa.gov (Anna Chulaki)
Date: Tue, 1 Nov 2011 16:55:37 -0400
Subject: [Owasp-modsecurity-core-rule-set]
	modsecurity_crs_20_protocol_violations.conf error
Message-ID: <A0C3A461-3874-4973-9EEC-A87E88CF3C89@nasa.gov>

I have upgraded CRS on our server from 2.1.2 to 2.2.2.  I get an error starting Apache server unless I comment out the following rule in base_rules/modsecurity_crs_20_protocol_violations.conf:

SecRule REQBODY_ERROR "!@eq 0" \
       "phase:2,t:none,block,msg:'Failed to parse request body.',id:'960912',logdata:'%{reqbody_error_msg}',severity:2,        setvar:'tx.msg=%{rule.msg}',setvar:'tx.id=%{rule.id}',tag:'RULE_MATURITY/7',tag:'RULE_ACCURACY/8',tag:'https://www.owasp        .org/index.php/ModSecurity_CRS_RuleID-%{tx.id}',setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.protocol        _violation_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/INVALID_REQ-%{matched_var_name}=%        {matched_var}"

Error message:
Starting httpd: Syntax error on line 91 of /etc/httpd/modsecurity.d/base_rules/modsecurity_crs_20_protocol_violations.conf:
Error creating rule: Unknown variable: REQBODY_ERROR

Did I miss something in the installation instructions?

Anna Chulaki


From chris at jwall.org  Tue Nov  1 17:03:03 2011
From: chris at jwall.org (Christian Bockermann)
Date: Tue, 1 Nov 2011 22:03:03 +0100
Subject: [Owasp-modsecurity-core-rule-set]
	modsecurity_crs_20_protocol_violations.conf error
In-Reply-To: <A0C3A461-3874-4973-9EEC-A87E88CF3C89@nasa.gov>
References: <A0C3A461-3874-4973-9EEC-A87E88CF3C89@nasa.gov>
Message-ID: <6F534B32-EFD1-4930-8769-21A912DA8906@jwall.org>

Hi Anna,

no, you did perfectly fine with your configuration. Unfortunately the variable REQBODY_PROCESSOR_ERROR
has been renamed to REQBODY_ERROR without keeping an alias of the old name.
This happened in ModSecurity 2.6 if I remember correctly.

The new versions of the core rules use the new name of the variable.

Since you are obviously using ModSecurity < 2.6, you will need to change the variable name

   REQBODY_ERROR  to   REQBODY_PROCESSOR_ERROR

in your modsecurity_crs_20_protocol_violations.conf file.

That should fix the problem.

Best regards,

   Chris


Am 01.11.2011 um 21:55 schrieb Anna Chulaki:

> I have upgraded CRS on our server from 2.1.2 to 2.2.2.  I get an error starting Apache server unless I comment out the following rule in base_rules/modsecurity_crs_20_protocol_violations.conf:
> 
> SecRule REQBODY_ERROR "!@eq 0" \
>       "phase:2,t:none,block,msg:'Failed to parse request body.',id:'960912',logdata:'%{reqbody_error_msg}',severity:2,        setvar:'tx.msg=%{rule.msg}',setvar:'tx.id=%{rule.id}',tag:'RULE_MATURITY/7',tag:'RULE_ACCURACY/8',tag:'https://www.owasp        .org/index.php/ModSecurity_CRS_RuleID-%{tx.id}',setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.protocol        _violation_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-PROTOCOL_VIOLATION/INVALID_REQ-%{matched_var_name}=%        {matched_var}"
> 
> Error message:
> Starting httpd: Syntax error on line 91 of /etc/httpd/modsecurity.d/base_rules/modsecurity_crs_20_protocol_violations.conf:
> Error creating rule: Unknown variable: REQBODY_ERROR
> 
> Did I miss something in the installation instructions?
> 
> Anna Chulaki
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From dreamice.jiang at gmail.com  Tue Nov  1 22:55:52 2011
From: dreamice.jiang at gmail.com (dreamice)
Date: Wed, 2 Nov 2011 10:55:52 +0800
Subject: [Owasp-modsecurity-core-rule-set] How to block one ip address for a
	period of time
Message-ID: <CAE2E0r2XRL8AzCebu2RFp=j7FZd8oO2Ew4dA06sWCmkVAqf8yw@mail.gmail.com>

Dear all,
I want to write a rule to block an IP address for a period of time, for
example 5 minutes.
How can I write this rule?

Thanks a lot!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111102/fc9cbebf/attachment.html 

From jamuse at gmail.com  Wed Nov  2 05:02:14 2011
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Wed, 2 Nov 2011 11:02:14 +0200
Subject: [Owasp-modsecurity-core-rule-set] How to block one ip address
 for a period of time
In-Reply-To: <CAE2E0r2XRL8AzCebu2RFp=j7FZd8oO2Ew4dA06sWCmkVAqf8yw@mail.gmail.com>
References: <CAE2E0r2XRL8AzCebu2RFp=j7FZd8oO2Ew4dA06sWCmkVAqf8yw@mail.gmail.com>
Message-ID: <CANnPkin1auRaxOJ2ARWXvA1=mw6Vrf9Ra_+rRTM9Np24cPHu1Q@mail.gmail.com>

On Wed, Nov 2, 2011 at 4:55 AM, dreamice <dreamice.jiang at gmail.com> wrote:
> Dear all,
> I want to write a rule to block an IP address for a period of time, for
> example 5 minutes.
> How can I write this rule?

Hi,

The following example assumes you want to block IPs that send a
request that have the string blockme in an argument value:

# Initialize the IP collection
SecAction "phase:1,nolog,pass,initcol:ip=%{REMOTE_ADDR}

# Block IP for 300 seconds
SecRule ARGS blockme
"phase:2,block,setvar:ip.blocked=1,expirevar:ip.blocked=300"

# Enforce blocking
SecRule IP:BLOCKED "@eq 1" "phase:1,deny,log"

--
 - Josh

From majedb at gmail.com  Wed Nov  2 05:10:49 2011
From: majedb at gmail.com (Majed B.)
Date: Wed, 2 Nov 2011 12:10:49 +0300
Subject: [Owasp-modsecurity-core-rule-set] How to block one ip address
 for a period of time
In-Reply-To: <CANnPkin1auRaxOJ2ARWXvA1=mw6Vrf9Ra_+rRTM9Np24cPHu1Q@mail.gmail.com>
References: <CAE2E0r2XRL8AzCebu2RFp=j7FZd8oO2Ew4dA06sWCmkVAqf8yw@mail.gmail.com>
	<CANnPkin1auRaxOJ2ARWXvA1=mw6Vrf9Ra_+rRTM9Np24cPHu1Q@mail.gmail.com>
Message-ID: <CAKA73TAHz5xQi6quh-J4yfjZSv=NDT0Zdb8K6bcZCxq6RABLmg@mail.gmail.com>

Hello,

I don't use a specific rule to block IPs & instead use fail2ban to
block all IPs that are found in the error logs.

mod_sec will prevent the action from occurring then log it, and
fail2ban will pick up the IP and ban it. There should be no harm to
Apache itself in that process, as opposed to letting mod_sec do the
banning. In fact, I think it's better for performance to avoid banning
from within Apache, just deny the action, log it & let another app do
the banning & unbanning.

Here's a description of an Apache section:
http://www.fail2ban.org/wiki/index.php/Fail2ban:Community_Portal#Apache
You can easily modify it for whatever rule you'd like to block, or all of them.

On Wed, Nov 2, 2011 at 12:02 PM, Josh Amishav-Zlatin <jamuse at gmail.com> wrote:
>
> On Wed, Nov 2, 2011 at 4:55 AM, dreamice <dreamice.jiang at gmail.com> wrote:
> > Dear all,
> > I want to write a rule to block an IP address for a period of time, for
> > example 5 minutes.
> > How can I write this rule?
>
> Hi,
>
> The following example assumes you want to block IPs that send a
> request that have the string blockme in an argument value:
>
> # Initialize the IP collection
> SecAction "phase:1,nolog,pass,initcol:ip=%{REMOTE_ADDR}
>
> # Block IP for 300 seconds
> SecRule ARGS blockme
> "phase:2,block,setvar:ip.blocked=1,expirevar:ip.blocked=300"
>
> # Enforce blocking
> SecRule IP:BLOCKED "@eq 1" "phase:1,deny,log"
>
> --
> ?- Josh
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set



--
? ? ?? Majed B.

From rm4dillo at gmail.com  Thu Nov  3 07:39:09 2011
From: rm4dillo at gmail.com (rm4dillo D)
Date: Thu, 3 Nov 2011 12:39:09 +0100
Subject: [Owasp-modsecurity-core-rule-set] Performance issues
In-Reply-To: <09CD5642-8A3C-42B8-A1FC-51C06A83053A@trustwave.com>
References: <CAAzXPXDLXqg2PYNHdzTWzpwu5WtViNn=LB0R=1M3G8YUJ51ibA@mail.gmail.com>
	<09CD5642-8A3C-42B8-A1FC-51C06A83053A@trustwave.com>
Message-ID: <CAAzXPXAz0M5fQ5cCigE02w_Ra9KS4VLvMtgyYqpoHPOHx1=n5Q@mail.gmail.com>

Hi Ryan,

Even by disabling the "initcol" rules the problem was still there but after
some deeper analysis, I finally found the reason and a solution.

Almost all the rules in "modsecurity_crs_40_generic_attacks.conf",
"modsecurity_crs_41_sql_injection_attacks.conf" and
"modsecurity_crs_41_xss_attacks.conf" are applied to the "REQUEST_COOKIES"
and "REQUEST_COOKIES_NAMES" variables, making ModSecurity execute about 500
rules on every cookie's name and every cookie's value which means 10000 (2
* 10 * 500) additional operator calls for each request because every
request I receive contains around 10 cookies.
By applying those rules to the whole "Cookie" header instead of every
cookie's name and value, ModSecurity will only perform 500 additional
operator calls instead of 10000.

I solved the problem by replacing "REQUEST_COOKIES|REQUEST_COOKIES_NAMES"
by "REQUEST_HEADERS:Cookie".

May this change be included in the next CoreRuleSet release?

Thanks!

Rm4dillo


On Mon, Oct 24, 2011 at 8:45 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:

> My guess is that it is related to the initcol at the end of the 10 config
> file. This is used to setup the IP collection for other rules to use. While
> this is helpful, I think it is causing these types of perf issues on high
> traffic sites as it is forcing ModSec to create a persistent collection for
> ALL request.
>
> Try commenting out the final initcol SecRule at the end of the 10 file and
> see if it helps.
>
> We will think of a better approach.
>
> Ryan
>
> On Oct 24, 2011, at 2:30 PM, "rm4dillo D" <rm4dillo at gmail.com> wrote:
>
> > Hi,
> >
> > I recently installed ModSecurity with CRS 2.2.2 (base rules only,
> paranoid mode set to off and SecResponseBodyAccess to off too) on a high
> traffic server and the CPU usage almost reached 100% while it's usually
> around 2 to 5% and I have no errors.
> >
> > By disabling mod_security_crs_4[01]* rules (generic, xss, sqli) it's way
> better but not really useful :).
> >
> > Any clues? Does someone benchmark the rules before every release?
> >
> > Thanks.
> >
> > Rm4dillo
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111103/281b23e6/attachment.html 

From RBarnett at trustwave.com  Thu Nov  3 08:46:40 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 3 Nov 2011 07:46:40 -0500
Subject: [Owasp-modsecurity-core-rule-set] Performance issues
In-Reply-To: <CAAzXPXAz0M5fQ5cCigE02w_Ra9KS4VLvMtgyYqpoHPOHx1=n5Q@mail.gmail.com>
Message-ID: <CAD8035D.393FC%rbarnett@trustwave.com>


From: rm4dillo D <rm4dillo at gmail.com<mailto:rm4dillo at gmail.com>>
Date: Thu, 3 Nov 2011 06:39:09 -0500
To: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>
Cc: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>" <owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>>
Subject: Re: [Owasp-modsecurity-core-rule-set] Performance issues

Hi Ryan,

Even by disabling the "initcol" rules the problem was still there but after some deeper analysis, I finally found the reason and a solution.

Almost all the rules in "modsecurity_crs_40_generic_attacks.conf", "modsecurity_crs_41_sql_injection_attacks.conf" and "modsecurity_crs_41_xss_attacks.conf" are applied to the "REQUEST_COOKIES" and "REQUEST_COOKIES_NAMES" variables, making ModSecurity execute about 500 rules on every cookie's name and every cookie's value which means 10000 (2 * 10 * 500) additional operator calls for each request because every request I receive contains around 10 cookies.
By applying those rules to the whole "Cookie" header instead of every cookie's name and value, ModSecurity will only perform 500 additional operator calls instead of 10000.

I solved the problem by replacing "REQUEST_COOKIES|REQUEST_COOKIES_NAMES" by "REQUEST_HEADERS:Cookie".

May this change be included in the next CoreRuleSet release?

Understood.  This is the whole "Performance vs. Security" debate.  We will need to think a bit as to the best options.  Here is the short background -

 1.  We added the REQUEST_COOKIES variables as a result of the SQL Injection Challenge - http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-lessons-learned.html ? as our SQLi rules were not inspecting Cookie values and these are obviously a valid injection point as many DBs are using this data in queries.
 2.  We added the REQUEST_COOKIES variables vs. REQUEST_HEADERS:Cookie due to false positives.  If you inspect the entire Cookie data as one payloads instead of parsing it into cookie name = cookie value pairs, you will get a higher number of false positives due to many of the SQL Tautology attack rules ( 1 = 1, etc?).

I think that he best option will be to re-architect the "Paranoid Mode" concept and have a different directory of rules that is very aggressive in the variables that it inspects.  Those people that want to be aggressive to minimize the chance of false negatives and are willing to deal with false positives and make exceptions can then activate those rules.

-Ryan


Thanks!

Rm4dillo


On Mon, Oct 24, 2011 at 8:45 PM, Ryan Barnett <RBarnett at trustwave.com<mailto:RBarnett at trustwave.com>> wrote:
My guess is that it is related to the initcol at the end of the 10 config file. This is used to setup the IP collection for other rules to use. While this is helpful, I think it is causing these types of perf issues on high traffic sites as it is forcing ModSec to create a persistent collection for ALL request.

Try commenting out the final initcol SecRule at the end of the 10 file and see if it helps.

We will think of a better approach.

Ryan

On Oct 24, 2011, at 2:30 PM, "rm4dillo D" <rm4dillo at gmail.com<mailto:rm4dillo at gmail.com>> wrote:

> Hi,
>
> I recently installed ModSecurity with CRS 2.2.2 (base rules only, paranoid mode set to off and SecResponseBodyAccess to off too) on a high traffic server and the CPU usage almost reached 100% while it's usually around 2 to 5% and I have no errors.
>
> By disabling mod_security_crs_4[01]* rules (generic, xss, sqli) it's way better but not really useful :).
>
> Any clues? Does someone benchmark the rules before every release?
>
> Thanks.
>
> Rm4dillo
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.



________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From godadada at yahoo.com  Thu Nov  3 08:49:00 2011
From: godadada at yahoo.com (Chunde Shi)
Date: Thu, 3 Nov 2011 05:49:00 -0700 (PDT)
Subject: [Owasp-modsecurity-core-rule-set] unsubscribe me please
Message-ID: <1320324540.94960.YahooMailNeo@web111707.mail.gq1.yahoo.com>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111103/54d18849/attachment.html 

From yjaaidi at gmail.com  Thu Nov  3 10:43:36 2011
From: yjaaidi at gmail.com (Younes JAAIDI)
Date: Thu, 3 Nov 2011 15:43:36 +0100
Subject: [Owasp-modsecurity-core-rule-set] Performance issues
In-Reply-To: <CAD8035D.393FC%rbarnett@trustwave.com>
References: <CAAzXPXAz0M5fQ5cCigE02w_Ra9KS4VLvMtgyYqpoHPOHx1=n5Q@mail.gmail.com>
	<CAD8035D.393FC%rbarnett@trustwave.com>
Message-ID: <CAFgwO0OASmQ0gwdBfCqdN+0wh08F6jKVT4DbZrhsh26hkoZ0jQ@mail.gmail.com>

Great! Thank you!

On Thu, Nov 3, 2011 at 1:46 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:

>
> From: rm4dillo D <rm4dillo at gmail.com<mailto:rm4dillo at gmail.com>>
> Date: Thu, 3 Nov 2011 06:39:09 -0500
> To: Ryan Barnett <rbarnett at trustwave.com<mailto:rbarnett at trustwave.com>>
> Cc: "owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
> owasp-modsecurity-core-rule-set at lists.owasp.org>" <
> owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
> owasp-modsecurity-core-rule-set at lists.owasp.org>>
> Subject: Re: [Owasp-modsecurity-core-rule-set] Performance issues
>
> Hi Ryan,
>
> Even by disabling the "initcol" rules the problem was still there but
> after some deeper analysis, I finally found the reason and a solution.
>
> Almost all the rules in "modsecurity_crs_40_generic_attacks.conf",
> "modsecurity_crs_41_sql_injection_attacks.conf" and
> "modsecurity_crs_41_xss_attacks.conf" are applied to the "REQUEST_COOKIES"
> and "REQUEST_COOKIES_NAMES" variables, making ModSecurity execute about 500
> rules on every cookie's name and every cookie's value which means 10000 (2
> * 10 * 500) additional operator calls for each request because every
> request I receive contains around 10 cookies.
> By applying those rules to the whole "Cookie" header instead of every
> cookie's name and value, ModSecurity will only perform 500 additional
> operator calls instead of 10000.
>
> I solved the problem by replacing "REQUEST_COOKIES|REQUEST_COOKIES_NAMES"
> by "REQUEST_HEADERS:Cookie".
>
> May this change be included in the next CoreRuleSet release?
>
> Understood.  This is the whole "Performance vs. Security" debate.  We will
> need to think a bit as to the best options.  Here is the short background -
>
>  1.  We added the REQUEST_COOKIES variables as a result of the SQL
> Injection Challenge -
> http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-lessons-learned.html? as our SQLi rules were not inspecting Cookie values and these are
> obviously a valid injection point as many DBs are using this data in
> queries.
>  2.  We added the REQUEST_COOKIES variables vs. REQUEST_HEADERS:Cookie due
> to false positives.  If you inspect the entire Cookie data as one payloads
> instead of parsing it into cookie name = cookie value pairs, you will get a
> higher number of false positives due to many of the SQL Tautology attack
> rules ( 1 = 1, etc?).
>
> I think that he best option will be to re-architect the "Paranoid Mode"
> concept and have a different directory of rules that is very aggressive in
> the variables that it inspects.  Those people that want to be aggressive to
> minimize the chance of false negatives and are willing to deal with false
> positives and make exceptions can then activate those rules.
>
> -Ryan
>
>
> Thanks!
>
> Rm4dillo
>
>
> On Mon, Oct 24, 2011 at 8:45 PM, Ryan Barnett <RBarnett at trustwave.com
> <mailto:RBarnett at trustwave.com>> wrote:
> My guess is that it is related to the initcol at the end of the 10 config
> file. This is used to setup the IP collection for other rules to use. While
> this is helpful, I think it is causing these types of perf issues on high
> traffic sites as it is forcing ModSec to create a persistent collection for
> ALL request.
>
> Try commenting out the final initcol SecRule at the end of the 10 file and
> see if it helps.
>
> We will think of a better approach.
>
> Ryan
>
> On Oct 24, 2011, at 2:30 PM, "rm4dillo D" <rm4dillo at gmail.com<mailto:
> rm4dillo at gmail.com>> wrote:
>
> > Hi,
> >
> > I recently installed ModSecurity with CRS 2.2.2 (base rules only,
> paranoid mode set to off and SecResponseBodyAccess to off too) on a high
> traffic server and the CPU usage almost reached 100% while it's usually
> around 2 to 5% and I have no errors.
> >
> > By disabling mod_security_crs_4[01]* rules (generic, xss, sqli) it's way
> better but not really useful :).
> >
> > Any clues? Does someone benchmark the rules before every release?
> >
> > Thanks.
> >
> > Rm4dillo
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
> Owasp-modsecurity-core-rule-set at lists.owasp.org>
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>
>
>
> ________________________________
> This transmission may contain information that is privileged,
> confidential, and/or exempt from disclosure under applicable law. If you
> are not the intended recipient, you are hereby notified that any
> disclosure, copying, distribution, or use of the information contained
> herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
> received this transmission in error, please immediately contact the sender
> and destroy the material in its entirety, whether in electronic or hard
> copy format.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111103/8f464041/attachment-0001.html 

From ross at sentrypayments.com  Fri Nov  4 16:29:38 2011
From: ross at sentrypayments.com (Ross Lawrie)
Date: Fri, 04 Nov 2011 13:29:38 -0700
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
Message-ID: <1320438578.18373.16.camel@tintin>

Hi,

I've done some searches hoping to find some help, and while I did find a
reference to the same error earlier in the list, I didn't see a clear
solution - or at least one that seemed clear to me.

I'm looking at getting ModSecurity upgraded on our web server, using
2.6.2 with the 2.2.0 CRS. What I'm encountering is a Lua error that has
me confused.

  Message: Lua: Script execution failed: attempt to call a nil value
  Message: Rule processing failed.

This is an installation on a Debian 5.0.9 server, I believe that the
necessary requirements are installed:

libapr1            : 1.2.12-5+lenny4
libapr1-dev        : 1.2.12-5+lenny4
libaprutil1        : 1.2.12+dfsg-8+lenny5
libaprutil1-dev    : 1.2.12+dfsg-8+lenny5
lua5.1             : 5.1.3-1
liblua5.1-0        : 5.1.3-1
liblua5.1-0-dev    : 5.1.3-1
libpcre3           : 7.6-2.1
libpcre3-dev       : 7.6-2.1
libxml2            : 2.6.32.dfsg-5+lenny4
libxml2-dev        : 2.6.32.dfsg-5+lenny4

Apache 2.2.21 is installed from source using the following configure:

./configure \
--prefix=/usr/local/apache \
--disable-userdir \
--enable-rewrite \
--enable-so \
--enable-status \
--enable-info \
--enable-ssl \
--enable-cgi \
--enable-unique-id \
--enable-mime-magic \
--with-included-apr \
--with-pcre=/usr/bin/pcre-config \
--enable-deflate \
--enable-expires \
--enable-headers

ModSecurity 2.6.2 is installed with the following configure:

./configure \
--with-apxs=/usr/local/apache/bin/apxs \
--with-apr=/usr/local/apache/bin/apr-1-config

I've only made minor path changes to the ModSecurity config, and a few
rule rewrites for some false positives in the CRS configuration.

I'm assuming this is a result of
modsecurity_crs_41_advanced_filters.conf somehow, but I'm not entirely
sure how -- or whether this is necessary, or purely optional (although
it's part of the base_rules).

Appreciate any help or suggestions that anyone can give.

Ross.


From RBarnett at trustwave.com  Fri Nov  4 17:58:20 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 4 Nov 2011 16:58:20 -0500
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <1320438578.18373.16.camel@tintin>
Message-ID: <CAD9D773.398A1%rbarnett@trustwave.com>


On 11/4/11 4:29 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:

>Hi,
>
>I've done some searches hoping to find some help, and while I did find a
>reference to the same error earlier in the list, I didn't see a clear
>solution - or at least one that seemed clear to me.
>
>I'm looking at getting ModSecurity upgraded on our web server, using
>2.6.2 with the 2.2.0 CRS. What I'm encountering is a Lua error that has
>me confused.
>
>  Message: Lua: Script execution failed: attempt to call a nil value
>  Message: Rule processing failed.

Do you happen to have Selinux running?  I believe I ran into this recently
as well with a Lua script.  Although I had set OS level permissions which
allowed my Apache user to read/execute the Lua scripts, the Selinux
permissions were not set correctly and I got a similar error message.  If
this is the case, then you will want to execute the chcon command to set
appropriate context for the Lua scripts/directory to allow the httpd
process to read/execute it.   See a similar post here -
http://permalink.gmane.org/gmane.comp.apache.mod-security.user/7268

-Ryan


>
>This is an installation on a Debian 5.0.9 server, I believe that the
>necessary requirements are installed:
>
>libapr1            : 1.2.12-5+lenny4
>libapr1-dev        : 1.2.12-5+lenny4
>libaprutil1        : 1.2.12+dfsg-8+lenny5
>libaprutil1-dev    : 1.2.12+dfsg-8+lenny5
>lua5.1             : 5.1.3-1
>liblua5.1-0        : 5.1.3-1
>liblua5.1-0-dev    : 5.1.3-1
>libpcre3           : 7.6-2.1
>libpcre3-dev       : 7.6-2.1
>libxml2            : 2.6.32.dfsg-5+lenny4
>libxml2-dev        : 2.6.32.dfsg-5+lenny4
>
>Apache 2.2.21 is installed from source using the following configure:
>
>./configure \
>--prefix=/usr/local/apache \
>--disable-userdir \
>--enable-rewrite \
>--enable-so \
>--enable-status \
>--enable-info \
>--enable-ssl \
>--enable-cgi \
>--enable-unique-id \
>--enable-mime-magic \
>--with-included-apr \
>--with-pcre=/usr/bin/pcre-config \
>--enable-deflate \
>--enable-expires \
>--enable-headers
>
>ModSecurity 2.6.2 is installed with the following configure:
>
>./configure \
>--with-apxs=/usr/local/apache/bin/apxs \
>--with-apr=/usr/local/apache/bin/apr-1-config
>
>I've only made minor path changes to the ModSecurity config, and a few
>rule rewrites for some false positives in the CRS configuration.
>
>I'm assuming this is a result of
>modsecurity_crs_41_advanced_filters.conf somehow, but I'm not entirely
>sure how -- or whether this is necessary, or purely optional (although
>it's part of the base_rules).
>
>Appreciate any help or suggestions that anyone can give.
>
>Ross.
>
>_______________________________________________
>Owasp-modsecurity-core-rule-set mailing list
>Owasp-modsecurity-core-rule-set at lists.owasp.org
>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From ross at sentrypayments.com  Fri Nov  4 18:41:45 2011
From: ross at sentrypayments.com (Ross Lawrie)
Date: Fri, 04 Nov 2011 15:41:45 -0700
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <CAD9D773.398A1%rbarnett@trustwave.com>
References: <CAD9D773.398A1%rbarnett@trustwave.com>
Message-ID: <1320446505.22872.8.camel@tintin>

On Fri, 2011-11-04 at 16:58 -0500, Ryan Barnett wrote:
> On 11/4/11 4:29 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:
> 
> >Hi,
> >
> >I've done some searches hoping to find some help, and while I did find a
> >reference to the same error earlier in the list, I didn't see a clear
> >solution - or at least one that seemed clear to me.
> >
> >I'm looking at getting ModSecurity upgraded on our web server, using
> >2.6.2 with the 2.2.0 CRS. What I'm encountering is a Lua error that has
> >me confused.
> >
> >  Message: Lua: Script execution failed: attempt to call a nil value
> >  Message: Rule processing failed.
> 
> Do you happen to have Selinux running?  I believe I ran into this recently
> as well with a Lua script.  Although I had set OS level permissions which
> allowed my Apache user to read/execute the Lua scripts, the Selinux
> permissions were not set correctly and I got a similar error message.  If
> this is the case, then you will want to execute the chcon command to set
> appropriate context for the Lua scripts/directory to allow the httpd
> process to read/execute it.   See a similar post here -
> http://permalink.gmane.org/gmane.comp.apache.mod-security.user/7268
> 
> -Ryan

Hi Ryan,

Thanks for the reply, unfortunately selinux is not active on the machine
in question. Events are successfully going to our SecAuditLogStorageDir,
so I believe the permissions are okay on it.

I've increased the SecDebugLogLevel to 9, and I think this is the
relevant entries from the resulting log, not sure if it's of any help:

[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][4] Recipe:
Invoking rule 2ccfde8; [file
"/usr/local/apache/conf/modsecurity-crs_2.2.0/activated_rules/modsecurity_crs_41_advanced_filters.conf"] [line "17"].
[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][5] Rule 2ccfde8:
SecRuleScript "@" "phase:2,log,t:none,pass"
[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][8] Lua: Executing
script: /usr/local/apache/conf/modsecurity-crs_2.2.0/activated_rules/../lua/advanced_filter_converter.lua
[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][1] Lua: Script
execution failed: attempt to call a nil value
[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][4] Rule returned
-1.
[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][1] Rule processing
failed.
[04/Nov/2011:15:31:43 --0700]
[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][9] Rule failed,
not chained -> mode NEXT_RULE.

Ross.




> 
> 
> >
> >This is an installation on a Debian 5.0.9 server, I believe that the
> >necessary requirements are installed:
> >
> >libapr1            : 1.2.12-5+lenny4
> >libapr1-dev        : 1.2.12-5+lenny4
> >libaprutil1        : 1.2.12+dfsg-8+lenny5
> >libaprutil1-dev    : 1.2.12+dfsg-8+lenny5
> >lua5.1             : 5.1.3-1
> >liblua5.1-0        : 5.1.3-1
> >liblua5.1-0-dev    : 5.1.3-1
> >libpcre3           : 7.6-2.1
> >libpcre3-dev       : 7.6-2.1
> >libxml2            : 2.6.32.dfsg-5+lenny4
> >libxml2-dev        : 2.6.32.dfsg-5+lenny4
> >
> >Apache 2.2.21 is installed from source using the following configure:
> >
> >./configure \
> >--prefix=/usr/local/apache \
> >--disable-userdir \
> >--enable-rewrite \
> >--enable-so \
> >--enable-status \
> >--enable-info \
> >--enable-ssl \
> >--enable-cgi \
> >--enable-unique-id \
> >--enable-mime-magic \
> >--with-included-apr \
> >--with-pcre=/usr/bin/pcre-config \
> >--enable-deflate \
> >--enable-expires \
> >--enable-headers
> >
> >ModSecurity 2.6.2 is installed with the following configure:
> >
> >./configure \
> >--with-apxs=/usr/local/apache/bin/apxs \
> >--with-apr=/usr/local/apache/bin/apr-1-config
> >
> >I've only made minor path changes to the ModSecurity config, and a few
> >rule rewrites for some false positives in the CRS configuration.
> >
> >I'm assuming this is a result of
> >modsecurity_crs_41_advanced_filters.conf somehow, but I'm not entirely
> >sure how -- or whether this is necessary, or purely optional (although
> >it's part of the base_rules).
> >
> >Appreciate any help or suggestions that anyone can give.
> >
> >Ross.
> >
> >_______________________________________________
> >Owasp-modsecurity-core-rule-set mailing list
> >Owasp-modsecurity-core-rule-set at lists.owasp.org
> >https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >
> 
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 



From RBarnett at trustwave.com  Fri Nov  4 18:57:10 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 4 Nov 2011 17:57:10 -0500
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <1320446505.22872.8.camel@tintin>
Message-ID: <CAD9E5C9.398AD%rbarnett@trustwave.com>


On 11/4/11 6:41 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:

>On Fri, 2011-11-04 at 16:58 -0500, Ryan Barnett wrote:
>> On 11/4/11 4:29 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:
>>
>> >Hi,
>> >
>> >I've done some searches hoping to find some help, and while I did find
>>a
>> >reference to the same error earlier in the list, I didn't see a clear
>> >solution - or at least one that seemed clear to me.
>> >
>> >I'm looking at getting ModSecurity upgraded on our web server, using
>> >2.6.2 with the 2.2.0 CRS. What I'm encountering is a Lua error that has
>> >me confused.
>> >
>> >  Message: Lua: Script execution failed: attempt to call a nil value
>> >  Message: Rule processing failed.
>>
>> Do you happen to have Selinux running?  I believe I ran into this
>>recently
>> as well with a Lua script.  Although I had set OS level permissions
>>which
>> allowed my Apache user to read/execute the Lua scripts, the Selinux
>> permissions were not set correctly and I got a similar error message.
>>If
>> this is the case, then you will want to execute the chcon command to set
>> appropriate context for the Lua scripts/directory to allow the httpd
>> process to read/execute it.   See a similar post here -
>> http://permalink.gmane.org/gmane.comp.apache.mod-security.user/7268
>>
>> -Ryan
>
>Hi Ryan,
>
>Thanks for the reply, unfortunately selinux is not active on the machine
>in question. Events are successfully going to our SecAuditLogStorageDir,
>so I believe the permissions are okay on it.
>
>I've increased the SecDebugLogLevel to 9, and I think this is the
>relevant entries from the resulting log, not sure if it's of any help:
>
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][4] Recipe:
>Invoking rule 2ccfde8; [file
>"/usr/local/apache/conf/modsecurity-crs_2.2.0/activated_rules/modsecurity_
>crs_41_advanced_filters.conf"] [line "17"].
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][5] Rule 2ccfde8:
>SecRuleScript "@" "phase:2,log,t:none,pass"
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][8] Lua: Executing
>script:
>/usr/local/apache/conf/modsecurity-crs_2.2.0/activated_rules/../lua/advanc
>ed_filter_converter.lua
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][1] Lua: Script
>execution failed: attempt to call a nil value
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][4] Rule returned
>-1.
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][1] Rule processing
>failed.
>[04/Nov/2011:15:31:43 --0700]
>[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][9] Rule failed,
>not chained -> mode NEXT_RULE.
>
>Ross.

Update the path to Lua in the advanced_filter_converter.lua script to
ensure it matches where the lua binary is installed on your system.  See
if that helps.

-Ryan

>
>
>
>
>>
>>
>> >
>> >This is an installation on a Debian 5.0.9 server, I believe that the
>> >necessary requirements are installed:
>> >
>> >libapr1            : 1.2.12-5+lenny4
>> >libapr1-dev        : 1.2.12-5+lenny4
>> >libaprutil1        : 1.2.12+dfsg-8+lenny5
>> >libaprutil1-dev    : 1.2.12+dfsg-8+lenny5
>> >lua5.1             : 5.1.3-1
>> >liblua5.1-0        : 5.1.3-1
>> >liblua5.1-0-dev    : 5.1.3-1
>> >libpcre3           : 7.6-2.1
>> >libpcre3-dev       : 7.6-2.1
>> >libxml2            : 2.6.32.dfsg-5+lenny4
>> >libxml2-dev        : 2.6.32.dfsg-5+lenny4
>> >
>> >Apache 2.2.21 is installed from source using the following configure:
>> >
>> >./configure \
>> >--prefix=/usr/local/apache \
>> >--disable-userdir \
>> >--enable-rewrite \
>> >--enable-so \
>> >--enable-status \
>> >--enable-info \
>> >--enable-ssl \
>> >--enable-cgi \
>> >--enable-unique-id \
>> >--enable-mime-magic \
>> >--with-included-apr \
>> >--with-pcre=/usr/bin/pcre-config \
>> >--enable-deflate \
>> >--enable-expires \
>> >--enable-headers
>> >
>> >ModSecurity 2.6.2 is installed with the following configure:
>> >
>> >./configure \
>> >--with-apxs=/usr/local/apache/bin/apxs \
>> >--with-apr=/usr/local/apache/bin/apr-1-config
>> >
>> >I've only made minor path changes to the ModSecurity config, and a few
>> >rule rewrites for some false positives in the CRS configuration.
>> >
>> >I'm assuming this is a result of
>> >modsecurity_crs_41_advanced_filters.conf somehow, but I'm not entirely
>> >sure how -- or whether this is necessary, or purely optional (although
>> >it's part of the base_rules).
>> >
>> >Appreciate any help or suggestions that anyone can give.
>> >
>> >Ross.
>> >
>> >_______________________________________________
>> >Owasp-modsecurity-core-rule-set mailing list
>> >Owasp-modsecurity-core-rule-set at lists.owasp.org
>>
>>>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>> >
>>
>>
>> This transmission may contain information that is privileged,
>>confidential, and/or exempt from disclosure under applicable law. If you
>>are not the intended recipient, you are hereby notified that any
>>disclosure, copying, distribution, or use of the information contained
>>herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
>>received this transmission in error, please immediately contact the
>>sender and destroy the material in its entirety, whether in electronic
>>or hard copy format.
>>
>
>
>


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From ross at sentrypayments.com  Tue Nov  8 11:59:28 2011
From: ross at sentrypayments.com (Ross Lawrie)
Date: Tue, 08 Nov 2011 08:59:28 -0800
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <CAD9E5C9.398AD%rbarnett@trustwave.com>
References: <CAD9E5C9.398AD%rbarnett@trustwave.com>
Message-ID: <1320771568.5287.3.camel@tintin>

On Fri, 2011-11-04 at 17:57 -0500, Ryan Barnett wrote:
> On 11/4/11 6:41 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:
> 
> >On Fri, 2011-11-04 at 16:58 -0500, Ryan Barnett wrote:
> >> On 11/4/11 4:29 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:
> >>
> >> >Hi,
> >> >
> >> >I've done some searches hoping to find some help, and while I did find
> >>a
> >> >reference to the same error earlier in the list, I didn't see a clear
> >> >solution - or at least one that seemed clear to me.
> >> >
> >> >I'm looking at getting ModSecurity upgraded on our web server, using
> >> >2.6.2 with the 2.2.0 CRS. What I'm encountering is a Lua error that has
> >> >me confused.
> >> >
> >> >  Message: Lua: Script execution failed: attempt to call a nil value
> >> >  Message: Rule processing failed.
> >>
> >> Do you happen to have Selinux running?  I believe I ran into this
> >>recently
> >> as well with a Lua script.  Although I had set OS level permissions
> >>which
> >> allowed my Apache user to read/execute the Lua scripts, the Selinux
> >> permissions were not set correctly and I got a similar error message.
> >>If
> >> this is the case, then you will want to execute the chcon command to set
> >> appropriate context for the Lua scripts/directory to allow the httpd
> >> process to read/execute it.   See a similar post here -
> >> http://permalink.gmane.org/gmane.comp.apache.mod-security.user/7268
> >>
> >> -Ryan
> >
> >Hi Ryan,
> >
> >Thanks for the reply, unfortunately selinux is not active on the machine
> >in question. Events are successfully going to our SecAuditLogStorageDir,
> >so I believe the permissions are okay on it.
> >
> >I've increased the SecDebugLogLevel to 9, and I think this is the
> >relevant entries from the resulting log, not sure if it's of any help:
> >
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][4] Recipe:
> >Invoking rule 2ccfde8; [file
> >"/usr/local/apache/conf/modsecurity-crs_2.2.0/activated_rules/modsecurity_
> >crs_41_advanced_filters.conf"] [line "17"].
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][5] Rule 2ccfde8:
> >SecRuleScript "@" "phase:2,log,t:none,pass"
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][8] Lua: Executing
> >script:
> >/usr/local/apache/conf/modsecurity-crs_2.2.0/activated_rules/../lua/advanc
> >ed_filter_converter.lua
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][1] Lua: Script
> >execution failed: attempt to call a nil value
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][4] Rule returned
> >-1.
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][1] Rule processing
> >failed.
> >[04/Nov/2011:15:31:43 --0700]
> >[xxxxxxxxx.xxx/sid#36acbf0][rid#3ad72f0][/xxxxxx.cgi][9] Rule failed,
> >not chained -> mode NEXT_RULE.
> >
> >Ross.
> 
> Update the path to Lua in the advanced_filter_converter.lua script to
> ensure it matches where the lua binary is installed on your system.  See
> if that helps.
> 
> -Ryan

Ryan,

This did help a little, the path was in need of updating, so I made that
change, but the problem persisted. This lead me to try running the lua
scripts from the command line which resulted in "module 'rex_pcre' not
found". I'm wondering if anyone is aware of a Debian (lenny) rex_pcre
package, or an easy way to install it - I've been struggling with the
source from http://luaforge.net/projects/lrexlib/ with little luck so
far (it's looking like some issues on amd64, but I'm not certain).

Appreciate any pointers that anyone might have.

Ross.



> 
> >
> >
> >
> >
> >>
> >>
> >> >
> >> >This is an installation on a Debian 5.0.9 server, I believe that the
> >> >necessary requirements are installed:
> >> >
> >> >libapr1            : 1.2.12-5+lenny4
> >> >libapr1-dev        : 1.2.12-5+lenny4
> >> >libaprutil1        : 1.2.12+dfsg-8+lenny5
> >> >libaprutil1-dev    : 1.2.12+dfsg-8+lenny5
> >> >lua5.1             : 5.1.3-1
> >> >liblua5.1-0        : 5.1.3-1
> >> >liblua5.1-0-dev    : 5.1.3-1
> >> >libpcre3           : 7.6-2.1
> >> >libpcre3-dev       : 7.6-2.1
> >> >libxml2            : 2.6.32.dfsg-5+lenny4
> >> >libxml2-dev        : 2.6.32.dfsg-5+lenny4
> >> >
> >> >Apache 2.2.21 is installed from source using the following configure:
> >> >
> >> >./configure \
> >> >--prefix=/usr/local/apache \
> >> >--disable-userdir \
> >> >--enable-rewrite \
> >> >--enable-so \
> >> >--enable-status \
> >> >--enable-info \
> >> >--enable-ssl \
> >> >--enable-cgi \
> >> >--enable-unique-id \
> >> >--enable-mime-magic \
> >> >--with-included-apr \
> >> >--with-pcre=/usr/bin/pcre-config \
> >> >--enable-deflate \
> >> >--enable-expires \
> >> >--enable-headers
> >> >
> >> >ModSecurity 2.6.2 is installed with the following configure:
> >> >
> >> >./configure \
> >> >--with-apxs=/usr/local/apache/bin/apxs \
> >> >--with-apr=/usr/local/apache/bin/apr-1-config
> >> >
> >> >I've only made minor path changes to the ModSecurity config, and a few
> >> >rule rewrites for some false positives in the CRS configuration.
> >> >
> >> >I'm assuming this is a result of
> >> >modsecurity_crs_41_advanced_filters.conf somehow, but I'm not entirely
> >> >sure how -- or whether this is necessary, or purely optional (although
> >> >it's part of the base_rules).
> >> >
> >> >Appreciate any help or suggestions that anyone can give.
> >> >
> >> >Ross.
> >> >
> >> >_______________________________________________
> >> >Owasp-modsecurity-core-rule-set mailing list
> >> >Owasp-modsecurity-core-rule-set at lists.owasp.org
> >>
> >>>https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >> >
> >>
> >>
> >> This transmission may contain information that is privileged,
> >>confidential, and/or exempt from disclosure under applicable law. If you
> >>are not the intended recipient, you are hereby notified that any
> >>disclosure, copying, distribution, or use of the information contained
> >>herein (including any reliance thereon) is STRICTLY PROHIBITED. If you
> >>received this transmission in error, please immediately contact the
> >>sender and destroy the material in its entirety, whether in electronic
> >>or hard copy format.
> >>
> >
> >
> >
> 
> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 



From jamuse at gmail.com  Wed Nov  9 03:10:30 2011
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Wed, 9 Nov 2011 10:10:30 +0200
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <1320771568.5287.3.camel@tintin>
References: <CAD9E5C9.398AD%rbarnett@trustwave.com>
	<1320771568.5287.3.camel@tintin>
Message-ID: <CANnPki=-0N=A=BZQpOO7jh-W8_Md1wkULU2e=n3OnqgHK8LnDw@mail.gmail.com>

On Tue, Nov 8, 2011 at 6:59 PM, Ross Lawrie <ross at sentrypayments.com> wrote:

> This did help a little, the path was in need of updating, so I made that
> change, but the problem persisted. This lead me to try running the lua
> scripts from the command line which resulted in "module 'rex_pcre' not
> found". I'm wondering if anyone is aware of a Debian (lenny) rex_pcre

Hi Ross,

Have you tried liblua5.1-rex-pcre0?

--
 - Josh

From shiftzwei at gmail.com  Wed Nov  9 04:35:06 2011
From: shiftzwei at gmail.com (shiftzwei at gmail.com)
Date: Wed, 9 Nov 2011 10:35:06 +0100
Subject: [Owasp-modsecurity-core-rule-set] setvar:'tx.allowed_methods Problem
Message-ID: <FF837279-B531-4958-8ECD-D190A0662F8A@gmail.com>

Hi to all,

I need a little help here. I want to use an newer rule set to my mod_security installations, but it looks like the variables form 
modsecurity_crs_10_config.conf are not propagated to the modsecurity_crs_30_http_policy.conf.

I have downloaded an installed the latest version of OWASP ModSecurity Core Rule Set Project ("core ruleset/2.2.3") and 
mod_security is version 2.5.11

vhost error.log 

ModSecurity: Access denied with code 403 (phase 2). Match of "within %{tx.allowed_methods}" against "REQUEST_METHOD" required. [file "/etc/modsecurity/activated_rules/modsecurity_crs_30_http_policy.conf"] [line "31"] [id "960032"] [msg "Method is not allowed by policy"] [data "GET"] [severity "CRITICAL"] [tag "POLICY/METHOD_NOT_ALLOWED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A6"] [tag "OWASP_AppSensor/RE1"] [tag "PCI/12.1"] [hostname "projekt.standard-sho


modsecurity_crs_10_config.conf:

#
# -=[ HTTP Policy Settings ]=-
#
# Set the following policy settings here and they will be propagated to the 30 rules
# file (modsecurity_crs_30_http_policy.conf) by using macro expansion.  
# If you run into false positves, you can adjust the settings here.
#
SecAction "phase:1,id:'981212',t:none,nolog,pass, \
setvar:'tx.allowed_methods=GET HEAD POST OPTIONS', \
setvar:'tx.allowed_request_content_type=application/x-www-form-urlencoded multipart/form-data text/xml application/xml application/x-amf', \
setvar:'tx.allowed_http_versions=HTTP/0.9 HTTP/1.0 HTTP/1.1', \
setvar:'tx.restricted_extensions=.asa/ .asax/ .ascx/ .axd/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/', \
setvar:'tx.restricted_headers=/Proxy-Connection/ /Lock-Token/ /Content-Range/ /Translate/ /via/ /if/'"

modsecurity_crs_30_http_policy.conf:

SecRule REQUEST_PROTOCOL "!@within %{tx.allowed_http_versions}" "phase:2,t:none,block,msg:'HTTP protocol version is not allowed by policy', severity:'2',id:'960034',tag:'POLICY/PROTOCOL_NOT_ALLOWED',tag:'WASCTC/WASC-21',tag:'OWASP_TOP_10/A6',tag:'PCI/6.5.10',logdata:'%{matched_var}',setvar:'tx.msg=%{rule.msg}',setvar:tx.anomaly_score=+%{tx.warning_anomaly_score},setvar:tx.policy_score=+%{tx.warning_anomaly_score},setvar:tx.%{rule.id}-POLICY/PROTOCOL_NOT_ALLOWED-%{matched_var_name}=%{matched_var}" 

Any hints?
Greets,
Christian

From ross at sentrypayments.com  Wed Nov  9 12:48:50 2011
From: ross at sentrypayments.com (Ross Lawrie)
Date: Wed, 09 Nov 2011 09:48:50 -0800
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <CANnPki=-0N=A=BZQpOO7jh-W8_Md1wkULU2e=n3OnqgHK8LnDw@mail.gmail.com>
References: <CAD9E5C9.398AD%rbarnett@trustwave.com>
	<1320771568.5287.3.camel@tintin>
	<CANnPki=-0N=A=BZQpOO7jh-W8_Md1wkULU2e=n3OnqgHK8LnDw@mail.gmail.com>
Message-ID: <1320860930.10953.4.camel@tintin>

On Wed, 2011-11-09 at 10:10 +0200, Josh Amishav-Zlatin wrote:
> On Tue, Nov 8, 2011 at 6:59 PM, Ross Lawrie <ross at sentrypayments.com> wrote:
> 
> > This did help a little, the path was in need of updating, so I made that
> > change, but the problem persisted. This lead me to try running the lua
> > scripts from the command line which resulted in "module 'rex_pcre' not
> > found". I'm wondering if anyone is aware of a Debian (lenny) rex_pcre
> 
> Hi Ross,
> 
> Have you tried liblua5.1-rex-pcre0?
> 
> --
>  - Josh

Josh,

Unfortunately that package doesn't exist for Debian Lenny (5.0.9). It
looks like it exists for Squeeze and higher, but at this point I can't
quite migrate this system to Squeeze. Thanks!

Ross.


From RBarnett at trustwave.com  Wed Nov  9 12:55:53 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 9 Nov 2011 11:55:53 -0600
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <1320860930.10953.4.camel@tintin>
Message-ID: <CAE02797.39FC1%rbarnett@trustwave.com>


On 11/9/11 12:48 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:

>On Wed, 2011-11-09 at 10:10 +0200, Josh Amishav-Zlatin wrote:
>> On Tue, Nov 8, 2011 at 6:59 PM, Ross Lawrie <ross at sentrypayments.com>
>>wrote:
>>
>> > This did help a little, the path was in need of updating, so I made
>>that
>> > change, but the problem persisted. This lead me to try running the lua
>> > scripts from the command line which resulted in "module 'rex_pcre' not
>> > found". I'm wondering if anyone is aware of a Debian (lenny) rex_pcre
>>
>> Hi Ross,
>>
>> Have you tried liblua5.1-rex-pcre0?
>>
>> --
>>  - Josh
>
>Josh,
>
>Unfortunately that package doesn't exist for Debian Lenny (5.0.9). It
>looks like it exists for Squeeze and higher, but at this point I can't
>quite migrate this system to Squeeze. Thanks!
>
>Ross.


Hey Ross,
A couple points about the advaced_filter_converter.lua script -

1) As you noted - there are Lua module dependencies.  You will need both
rex (for extended regular expressions) and bitop.  These modules are
needed in order to properly mimic the data conversion that PHPIDS'
converter.php script
(https://dev.itratos.de/projects/php-ids/repository/raw/trunk/lib/IDS/Conve
rter.php)  is doing.

2) We ran into some issues with that Lua script during the SQL Injection
Challenge
(http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-les
sons-learned.html) where certain payloads were actually causing the Lua
script to abort... :(  This script needs more testing.

3) Due to issue #2, we opted, in the latest CRS, to update the actual
PHPIDS regex filters themselves to try and include the converter logic
within the operator vs. requiring the Lua script to first normalize data.
So, if you are running the latest CRS, you can use the
modsecurity_crs_41_sql_injection_attack.conf file and not need to use the
advanced filters conf.

Hope this info helps.

-Ryan


This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.


From ross at sentrypayments.com  Wed Nov  9 13:34:56 2011
From: ross at sentrypayments.com (Ross Lawrie)
Date: Wed, 09 Nov 2011 10:34:56 -0800
Subject: [Owasp-modsecurity-core-rule-set] Lua nil value error
In-Reply-To: <CAE02797.39FC1%rbarnett@trustwave.com>
References: <CAE02797.39FC1%rbarnett@trustwave.com>
Message-ID: <1320863696.10953.6.camel@tintin>

On Wed, 2011-11-09 at 11:55 -0600, Ryan Barnett wrote:
> On 11/9/11 12:48 PM, "Ross Lawrie" <ross at sentrypayments.com> wrote:
> 
> >On Wed, 2011-11-09 at 10:10 +0200, Josh Amishav-Zlatin wrote:
> >> On Tue, Nov 8, 2011 at 6:59 PM, Ross Lawrie <ross at sentrypayments.com>
> >>wrote:
> >>
> >> > This did help a little, the path was in need of updating, so I made
> >>that
> >> > change, but the problem persisted. This lead me to try running the lua
> >> > scripts from the command line which resulted in "module 'rex_pcre' not
> >> > found". I'm wondering if anyone is aware of a Debian (lenny) rex_pcre
> >>
> >> Hi Ross,
> >>
> >> Have you tried liblua5.1-rex-pcre0?
> >>
> >> --
> >>  - Josh
> >
> >Josh,
> >
> >Unfortunately that package doesn't exist for Debian Lenny (5.0.9). It
> >looks like it exists for Squeeze and higher, but at this point I can't
> >quite migrate this system to Squeeze. Thanks!
> >
> >Ross.
> 
> 
> Hey Ross,
> A couple points about the advaced_filter_converter.lua script -
> 
> 1) As you noted - there are Lua module dependencies.  You will need both
> rex (for extended regular expressions) and bitop.  These modules are
> needed in order to properly mimic the data conversion that PHPIDS'
> converter.php script
> (https://dev.itratos.de/projects/php-ids/repository/raw/trunk/lib/IDS/Conve
> rter.php)  is doing.
> 
> 2) We ran into some issues with that Lua script during the SQL Injection
> Challenge
> (http://blog.spiderlabs.com/2011/07/modsecurity-sql-injection-challenge-les
> sons-learned.html) where certain payloads were actually causing the Lua
> script to abort... :(  This script needs more testing.
> 
> 3) Due to issue #2, we opted, in the latest CRS, to update the actual
> PHPIDS regex filters themselves to try and include the converter logic
> within the operator vs. requiring the Lua script to first normalize data.
> So, if you are running the latest CRS, you can use the
> modsecurity_crs_41_sql_injection_attack.conf file and not need to use the
> advanced filters conf.
> 
> Hope this info helps.
> 
> -Ryan
> 

Great, I'll try rolling out the latest CRS (v2.2.2 right?) and leave out
the advanced_filters. Thanks so much for the help and advice!

Ross.


> 
> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
> 



From tzury.by at reguluslabs.com  Thu Nov 10 21:41:29 2011
From: tzury.by at reguluslabs.com (Tzury Bar Yochay)
Date: Fri, 11 Nov 2011 04:41:29 +0200
Subject: [Owasp-modsecurity-core-rule-set] a question about rules
	"t:decodeXXX" instructions and owasp codecs
Message-ID: <CAN+tBVOwh9hTCuJpHdBv3v6zrtURYvB6wbjetyhvW67Ke7SFJw@mail.gmail.com>

In the rules, there are transformation instructions which I looked for its
implementation in the modsecurity code and saw they are implemented in a
different way than aswap's esapi project.
I am talking about code found at re_tfns.c and wonder are those
transformation functions compatible with the owasp codecs?
Can I use either one, yet get same results?

Another thing, owasp's canonical decoding functionality from the aspect
of recognizing dual encoding seems to be implemented within the rules, are
those two have the same effect?

thanks,
tzury
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111111/01e3e736/attachment.html 

From danil at whiterose.org  Fri Nov 11 11:30:07 2011
From: danil at whiterose.org (danil at whiterose.org)
Date: Fri, 11 Nov 2011 11:30:07 -0500
Subject: [Owasp-modsecurity-core-rule-set] Limiting Brute Force Blocks to
	protected_urls
Message-ID: <380-220111151116307612@M2W138.mail2web.com>


I'm looking at using modsecurity_crs_11_brute_force as a way of mitigating
a 
short list of urls that are vulnerable to enumeration attacks.

My UX designers are not happy about the fact that the block, when it goes
into 
effect, restricts all requests from the attacking IP address.

So I'm considering adding an entry to skip the brute force checks if 
REQUEST_FILENAME does not match a protected URL.

The current implementation looks like


   Include conf/modsecurity_crs/*.conf

   SecRule REQUEST_FILENAME "!@within %{tx.brute_force_protected_urls}" 
"phase:1,id:'88888',t:none,nolog,pass,skipAfter:END_BRUTE_FORCE_PROTECTION_C
HECK
S"

   Include 
conf/modsecurity_crs/experimental_rules/modsecurity_crs_11_brute_force.conf

Have I introduced a new weakness by doing this?

Thank you,
Danil



--------------------------------------------------------------------
mail2web LIVE ? Free email based on Microsoft? Exchange technology -
http://link.mail2web.com/LIVE



From tzury.by at reguluslabs.com  Sun Nov 13 08:05:59 2011
From: tzury.by at reguluslabs.com (Tzury Bar Yochay)
Date: Sun, 13 Nov 2011 15:05:59 +0200
Subject: [Owasp-modsecurity-core-rule-set] What is this rule means?
Message-ID: <CAN+tBVMawUaMv3xNsqUf2bJ7fQygwaSABNSBWnvj74AAX5HMpg@mail.gmail.com>

Hi,

Within the SLR rules I have came across several joomla rules which all
share a similar syntax
that looks like a query-string, e.g.

SecRule REQUEST_LINE "@contains /index.php" "chain,phase:2..."
> SecRule
> ARGS:option=com_joomlub&controller=auction&view=auction&task=edit&aid
> "(?i:UNION.+SELECT)" "ctl:auditLog..."


In regards to the second part (chained), I wonder if this means:
Check if within ARGS, option=comjoomla, and controller=auction
and view=auction and task=edit and also do @rx matching for ARGS:aid
and "(?i:UNION.+SELECT)"

Did i get the meanings of this rule right?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111113/1b026586/attachment.html 

From piotr.adamocha at gmail.com  Wed Nov 16 18:42:20 2011
From: piotr.adamocha at gmail.com (Piotr)
Date: Wed, 16 Nov 2011 23:42:20 +0000 (UTC)
Subject: [Owasp-modsecurity-core-rule-set]
	=?utf-8?q?Problems_with_UTF-8_e?= =?utf-8?q?ncoding_on=09request?=
References: <CAPNehxojgiu4ijDhE+oyrJquR_RWhR0dN5cT2DpY82ahNe8v6A@mail.gmail.com>
Message-ID: <loom.20111117T003850-683@post.gmane.org>

Jeronimo Zucco <jczucco at ...> writes:

> 
> We have some issues with 960024 rule of CRS 2.2.2 here.
> 
> Our native language is Brazilian Portuguese, UTF-8 enconding (Django),
> and when we have some ARG by POST with special caracter content of our
> language (like "?" for example), we get this modsecurity log:
> 
> Message: Access denied with code 403 (phase 2). Pattern match
> "\\W{4,}" at ARGS:descricao_procedencia. [file
> 
"/dbs1/www/apache2/conf/modsecurity/crs/activated_rules/modsecurity_crs_41_sql_i
njection_attacks.conf"]
> [line "509"] [id "960024"] [rev "2.2.2"] [msg "SQL Character Anomaly
> Detection Alert - Repetative Non-Word Characters"] [data
> "\xc3\x87\xc3\x83"]
> 
> The uncoding can be done this way in a python shell:
> 
> >>> import urllib
> >>> 
b=urllib.unquote_plus('4%C2%AA+COORDENADORIA+REGIONAL+DE+EDUCA%C3%87%C3%83O')
> >>> print b
> 4? COORDENADORIA REGIONAL DE EDUCA??O
> 
> We have enabled the option of UTF-8 enconding in 
modsecurity_crs_10_config.conf:
> 
> SecAction 
"phase:1,id:'981216',t:none,nolog,pass,setvar:tx.crs_validate_utf8_encoding=1"
> 
> How can I solve this issue ?
> 
> Thanks in advance.
> 


I've got the same issue - just disabled this particular rule.
try this:
edit /etc/httpd/conf.d/mod_security.conf
add the following line:
SecRuleRemoveById 960024 

then reload the webserver.

check logs, if you will find any other issues try to remove another rule (I had 
to disable 4 rules before my encoding was accepted).

Regards,



From dreamice.jiang at gmail.com  Thu Nov 24 06:51:06 2011
From: dreamice.jiang at gmail.com (dreamice)
Date: Thu, 24 Nov 2011 19:51:06 +0800
Subject: [Owasp-modsecurity-core-rule-set] How to replace response key words
Message-ID: <CAE2E0r1bQO65Y1TJLoteCK=4-e2bVterdHaT1HEzp3D_zjrfYQ@mail.gmail.com>

Hi,
I want to replace the response key words. Such as if the response data
include "Fuck", I want to write a rule to replace it with "****", how can I
do it?
Thanks in advance!

dreamice
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111124/69250fc4/attachment.html 

From jamuse at gmail.com  Thu Nov 24 06:55:12 2011
From: jamuse at gmail.com (Josh Amishav-Zlatin)
Date: Thu, 24 Nov 2011 13:55:12 +0200
Subject: [Owasp-modsecurity-core-rule-set] How to replace response key
	words
In-Reply-To: <CAE2E0r1bQO65Y1TJLoteCK=4-e2bVterdHaT1HEzp3D_zjrfYQ@mail.gmail.com>
References: <CAE2E0r1bQO65Y1TJLoteCK=4-e2bVterdHaT1HEzp3D_zjrfYQ@mail.gmail.com>
Message-ID: <CANnPkik_bGx+SvU2F+kbpK2tG5q9nWfEFeSBoK-hOy8B3JmCNw@mail.gmail.com>

On Thu, Nov 24, 2011 at 1:51 PM, dreamice <dreamice.jiang at gmail.com> wrote:
> Hi,
> I want to replace the response key words. Such as if the response data
> include "Fuck", I want to write a rule to replace it with "****", how can I
> do it?

If your using 2.6.0 or later then use the @rsub operator.

--
 - Josh

From dreamice.jiang at gmail.com  Wed Nov 30 20:16:26 2011
From: dreamice.jiang at gmail.com (dreamice)
Date: Thu, 1 Dec 2011 09:16:26 +0800
Subject: [Owasp-modsecurity-core-rule-set] How to replace response key
	words
In-Reply-To: <CANnPkik_bGx+SvU2F+kbpK2tG5q9nWfEFeSBoK-hOy8B3JmCNw@mail.gmail.com>
References: <CAE2E0r1bQO65Y1TJLoteCK=4-e2bVterdHaT1HEzp3D_zjrfYQ@mail.gmail.com>
	<CANnPkik_bGx+SvU2F+kbpK2tG5q9nWfEFeSBoK-hOy8B3JmCNw@mail.gmail.com>
Message-ID: <CAE2E0r2u0ACMeH0BqbFyfS_yjPB7wONWqa2hBSK58d-24UcwJQ@mail.gmail.com>

Thanks for your reply!
I use the latest version(httpd-2.2.21 and mod-2.6.2),and I write the rule
as follow:
SecStreamOutBodyInspection On
SecRule STREAM_OUTPUT_BODY "@rsub s/1111/xxxx/"
"phase:4,t:none,log,auditlog,pass"

my default page is:
<html><body><h1>It works!</h1></body></html>
1111

After I restart the httpd, I request the index.html page, the "1111" has
not been replaced.
I global set SecRuleEngine On, what is the problem with my operation?

Thanks in advance!



2011/11/24 Josh Amishav-Zlatin <jamuse at gmail.com>

> On Thu, Nov 24, 2011 at 1:51 PM, dreamice <dreamice.jiang at gmail.com>
> wrote:
> > Hi,
> > I want to replace the response key words. Such as if the response data
> > include "Fuck", I want to write a rule to replace it with "****", how
> can I
> > do it?
>
> If your using 2.6.0 or later then use the @rsub operator.
>
> --
>  - Josh
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20111201/6faf277e/attachment.html 

From RBarnett at trustwave.com  Wed Nov 30 22:00:20 2011
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 30 Nov 2011 21:00:20 -0600
Subject: [Owasp-modsecurity-core-rule-set] How to replace response
	key	words
In-Reply-To: <CAE2E0r2u0ACMeH0BqbFyfS_yjPB7wONWqa2hBSK58d-24UcwJQ@mail.gmail.com>
References: <CAE2E0r1bQO65Y1TJLoteCK=4-e2bVterdHaT1HEzp3D_zjrfYQ@mail.gmail.com>
	<CANnPkik_bGx+SvU2F+kbpK2tG5q9nWfEFeSBoK-hOy8B3JmCNw@mail.gmail.com>
	<CAE2E0r2u0ACMeH0BqbFyfS_yjPB7wONWqa2hBSK58d-24UcwJQ@mail.gmail.com>
Message-ID: <F67F9C70-9005-4799-BD48-0A7F81C3BA99@trustwave.com>

Try enabling SecContentInjection On.

Ryan

On Nov 30, 2011, at 8:16 PM, "dreamice" <dreamice.jiang at gmail.com<mailto:dreamice.jiang at gmail.com>> wrote:

Thanks for your reply!
I use the latest version(httpd-2.2.21 and mod-2.6.2),and I write the rule as follow:
SecStreamOutBodyInspection On
SecRule STREAM_OUTPUT_BODY "@rsub s/1111/xxxx/" "phase:4,t:none,log,auditlog,pass"

my default page is:
<html><body><h1>It works!</h1></body></html>
1111

After I restart the httpd, I request the index.html page, the "1111" has not been replaced.
I global set SecRuleEngine On, what is the problem with my operation?

Thanks in advance!



2011/11/24 Josh Amishav-Zlatin <jamuse at gmail.com<mailto:jamuse at gmail.com>>
On Thu, Nov 24, 2011 at 1:51 PM, dreamice <dreamice.jiang at gmail.com<mailto:dreamice.jiang at gmail.com>> wrote:
> Hi,
> I want to replace the response key words. Such as if the response data
> include "Fuck", I want to write a rule to replace it with "****", how can I
> do it?

If your using 2.6.0 or later then use the @rsub operator.

--
 - Josh

_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

________________________________
This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is STRICTLY PROHIBITED. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.

