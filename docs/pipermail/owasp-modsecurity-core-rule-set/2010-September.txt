From RBarnett at trustwave.com  Wed Sep  1 08:58:41 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 1 Sep 2010 07:58:41 -0500
Subject: [Owasp-modsecurity-core-rule-set] New Blog Post - Advanced Feature
 of the Week: Transformation Functions
Message-ID: <C8A3C641.1357D%rbarnett@trustwave.com>

In this installment of the ?Advanced Feature of the Week?, we take a look at Transformation functions.

http://blog.modsecurity.org/2010/08/advanced-feature-of-the-week-transformation-functions.html

Cheers,
Ryan



From RBarnett at trustwave.com  Wed Sep  1 11:02:10 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 1 Sep 2010 10:02:10 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release
 ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <64DE0FF0-B526-43FE-9A91-BF8229DB1547@trustwave.com>
Message-ID: <C8A3E332.1359C%rbarnett@trustwave.com>

I have created new CRS v2.0.8 packages and uploaded them to the Sourceforge
site.  Please test these out and let me know if you still run into issues.

-Ryan

On 8/31/10 6:02 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

> I will try and create a new gpg key as my old one is from my breach account.
> Once I create the new key I will upload it to the public repo and try to
> create a new package and verify the sigs.
> 
> Sent from my iPhone
> 
> On Aug 31, 2010, at 5:55 PM, "Castle, Shane" <scastle at bouldercounty.org>
> wrote:
> 
>> Hmm - but this still doesn't explain the signature verification failure.
>> 
>> BTW the .zip seems to be fine, as far as extraction goes. Its signature
>> does not verify either.
>> 
>> Checking the MD5 hashes...they seem to match. What's up with the
>> signatures?
>> 
>> --
>> Shane Castle
>> Data Security Mgr, Boulder County IT
>> GSEC GCIH
>> 303-441-3953
>> 
>> 
>> -----Original Message-----
>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
>> Behalf Of MARTIN, JASON (ATTSI)
>> Sent: Tuesday, August 31, 2010 15:19
>> To: Ryan Barnett; Christian Bockermann
>> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
>> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
>> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
>> 
>> I believe this is a tar version compatibility issue:
>> http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
>> html
>> 
>> -Jason Martin
>> 
>> 
>> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 



From scastle at bouldercounty.org  Wed Sep  1 11:18:07 2010
From: scastle at bouldercounty.org (Castle, Shane)
Date: Wed, 1 Sep 2010 09:18:07 -0600
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release
	ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <C8A3E332.1359C%rbarnett@trustwave.com>
References: <64DE0FF0-B526-43FE-9A91-BF8229DB1547@trustwave.com>
	<C8A3E332.1359C%rbarnett@trustwave.com>
Message-ID: <6009E57E59F29A43B7460CE724C42DF1E49637@EVS1B.boco.co.boulder.co.us>

The tar file extracts now, but I still can't verify the signature as I
can find no key to match the signing key, using server pgpkeys.mit.edu.

--
Shane Castle
Data Security Mgr, Boulder County IT
GSEC GCIH

-----Original Message-----
From: Ryan Barnett [mailto:RBarnett at trustwave.com] 
Sent: Wednesday, September 01, 2010 09:02
To: Ryan Barnett; Castle, Shane
Cc: MARTIN, JASON (ATTSI);
owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
ofOWASPModSecurity Core Rule Set (CRS) v2.0.8

I have created new CRS v2.0.8 packages and uploaded them to the
Sourceforge
site.  Please test these out and let me know if you still run into
issues.

-Ryan

On 8/31/10 6:02 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

> I will try and create a new gpg key as my old one is from my breach
account.
> Once I create the new key I will upload it to the public repo and try
to
> create a new package and verify the sigs.
> 
> Sent from my iPhone
> 
> On Aug 31, 2010, at 5:55 PM, "Castle, Shane"
<scastle at bouldercounty.org>
> wrote:
> 
>> Hmm - but this still doesn't explain the signature verification
failure.
>> 
>> BTW the .zip seems to be fine, as far as extraction goes. Its
signature
>> does not verify either.
>> 
>> Checking the MD5 hashes...they seem to match. What's up with the
>> signatures?
>> 
>> --
>> Shane Castle
>> Data Security Mgr, Boulder County IT
>> GSEC GCIH
>> 303-441-3953
>> 
>> 
>> -----Original Message-----
>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
>> Behalf Of MARTIN, JASON (ATTSI)
>> Sent: Tuesday, August 31, 2010 15:19
>> To: Ryan Barnett; Christian Bockermann
>> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
>> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
>> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
>> 
>> I believe this is a tar version compatibility issue:
>>
http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
>> html
>> 
>> -Jason Martin
>> 
>> 
>> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 



From RBarnett at trustwave.com  Wed Sep  1 11:23:41 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 1 Sep 2010 10:23:41 -0500
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release
 ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <6009E57E59F29A43B7460CE724C42DF1E49637@EVS1B.boco.co.boulder.co.us>
Message-ID: <C8A3E83D.135A5%rbarnett@trustwave.com>

It should be up there now -
http://pgp.mit.edu:11371/pks/lookup?op=vindex&search=0xA5C6BF964EF28948


On 9/1/10 11:18 AM, "Castle, Shane" <scastle at bouldercounty.org> wrote:

> The tar file extracts now, but I still can't verify the signature as I
> can find no key to match the signing key, using server pgpkeys.mit.edu.
> 
> --
> Shane Castle
> Data Security Mgr, Boulder County IT
> GSEC GCIH
> 
> -----Original Message-----
> From: Ryan Barnett [mailto:RBarnett at trustwave.com]
> Sent: Wednesday, September 01, 2010 09:02
> To: Ryan Barnett; Castle, Shane
> Cc: MARTIN, JASON (ATTSI);
> owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
> 
> I have created new CRS v2.0.8 packages and uploaded them to the
> Sourceforge
> site.  Please test these out and let me know if you still run into
> issues.
> 
> -Ryan
> 
> On 8/31/10 6:02 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:
> 
>> I will try and create a new gpg key as my old one is from my breach
> account.
>> Once I create the new key I will upload it to the public repo and try
> to
>> create a new package and verify the sigs.
>> 
>> Sent from my iPhone
>> 
>> On Aug 31, 2010, at 5:55 PM, "Castle, Shane"
> <scastle at bouldercounty.org>
>> wrote:
>> 
>>> Hmm - but this still doesn't explain the signature verification
> failure.
>>> 
>>> BTW the .zip seems to be fine, as far as extraction goes. Its
> signature
>>> does not verify either.
>>> 
>>> Checking the MD5 hashes...they seem to match. What's up with the
>>> signatures?
>>> 
>>> --
>>> Shane Castle
>>> Data Security Mgr, Boulder County IT
>>> GSEC GCIH
>>> 303-441-3953
>>> 
>>> 
>>> -----Original Message-----
>>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>>> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
>>> Behalf Of MARTIN, JASON (ATTSI)
>>> Sent: Tuesday, August 31, 2010 15:19
>>> To: Ryan Barnett; Christian Bockermann
>>> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
>>> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
>>> 
>>> I believe this is a tar version compatibility issue:
>>> 
> http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
>>> html
>>> 
>>> -Jason Martin
>>> 
>>> 
>>> 
>> 
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> 
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>> 
> 
> 
> 



From RBarnett at trustwave.com  Wed Sep  1 11:35:34 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 1 Sep 2010 10:35:34 -0500
Subject: [Owasp-modsecurity-core-rule-set] New ModSecurity User Survey for
	2010 is Online
Message-ID: <C8A3EB06.135AD%rbarnett@trustwave.com>

Hello ModSecurity Users!  We want to hear from you.  What do you like about ModSecurity?  What don?t you like?  What can we do better?  Now is your chance to speak up and let us know how we can make ModSecurity better.  Please take the time to complete the brand new ModSecurity User Survey for 2010 -

http://www.surveymonkey.com/s/WWL32K8

The results of this survey will influence both the ModSecurity and OWASP Core Rule Set roadmaps so if there are some features that you would like to see, let us know.  As an added bonus for taking the time to complete the survey, if you provide a ModSecurity Testimonial, you will be eligible for a raffle to win a t-shirt.

Thanks for helping out and I look forward to reviewing your responses.

Ryan Barnett
ModSecurity Community Manager
OWASP ModSecurity Core Rule Set Project Leader


From scastle at bouldercounty.org  Wed Sep  1 11:52:17 2010
From: scastle at bouldercounty.org (Castle, Shane)
Date: Wed, 1 Sep 2010 09:52:17 -0600
Subject: [Owasp-modsecurity-core-rule-set] Announcing Release
	ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
In-Reply-To: <C8A3E83D.135A5%rbarnett@trustwave.com>
References: <6009E57E59F29A43B7460CE724C42DF1E49637@EVS1B.boco.co.boulder.co.us>
	<C8A3E83D.135A5%rbarnett@trustwave.com>
Message-ID: <6009E57E59F29A43B7460CE724C42DF1E4963C@EVS1B.boco.co.boulder.co.us>

OK yes, everything seems to be copacetic now. Good signature (but not
trusted! ;) ). Good extractions. Now for some fun with ModSecurity...

BTW I have a Breach M1100. AFAICT this unit is being abandoned in favor
of WebDefend but I have some of the older CRS rulesets on it, heavily
modified to fit within the M1100 rule structure, and they seem to be
performing well. Any recommendations on how to take the M1100 forward?
Will there be any more releases for it?

--
Shane Castle
Data Security Mgr, Boulder County IT
GSEC GCIH


-----Original Message-----
From: Ryan Barnett [mailto:RBarnett at trustwave.com] 
Sent: Wednesday, September 01, 2010 09:24
To: Castle, Shane
Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
ofOWASPModSecurity Core Rule Set (CRS) v2.0.8

It should be up there now -
http://pgp.mit.edu:11371/pks/lookup?op=vindex&search=0xA5C6BF964EF28948


On 9/1/10 11:18 AM, "Castle, Shane" <scastle at bouldercounty.org> wrote:

> The tar file extracts now, but I still can't verify the signature as I
> can find no key to match the signing key, using server
pgpkeys.mit.edu.
> 
> --
> Shane Castle
> Data Security Mgr, Boulder County IT
> GSEC GCIH
> 
> -----Original Message-----
> From: Ryan Barnett [mailto:RBarnett at trustwave.com]
> Sent: Wednesday, September 01, 2010 09:02
> To: Ryan Barnett; Castle, Shane
> Cc: MARTIN, JASON (ATTSI);
> owasp-modsecurity-core-rule-set at lists.owasp.org
> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
> 
> I have created new CRS v2.0.8 packages and uploaded them to the
> Sourceforge
> site.  Please test these out and let me know if you still run into
> issues.
> 
> -Ryan
> 
> On 8/31/10 6:02 PM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:
> 
>> I will try and create a new gpg key as my old one is from my breach
> account.
>> Once I create the new key I will upload it to the public repo and try
> to
>> create a new package and verify the sigs.
>> 
>> Sent from my iPhone
>> 
>> On Aug 31, 2010, at 5:55 PM, "Castle, Shane"
> <scastle at bouldercounty.org>
>> wrote:
>> 
>>> Hmm - but this still doesn't explain the signature verification
> failure.
>>> 
>>> BTW the .zip seems to be fine, as far as extraction goes. Its
> signature
>>> does not verify either.
>>> 
>>> Checking the MD5 hashes...they seem to match. What's up with the
>>> signatures?
>>> 
>>> --
>>> Shane Castle
>>> Data Security Mgr, Boulder County IT
>>> GSEC GCIH
>>> 303-441-3953
>>> 
>>> 
>>> -----Original Message-----
>>> From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
>>> [mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
>>> Behalf Of MARTIN, JASON (ATTSI)
>>> Sent: Tuesday, August 31, 2010 15:19
>>> To: Ryan Barnett; Christian Bockermann
>>> Cc: owasp-modsecurity-core-rule-set at lists.owasp.org
>>> Subject: Re: [Owasp-modsecurity-core-rule-set] Announcing Release
>>> ofOWASPModSecurity Core Rule Set (CRS) v2.0.8
>>> 
>>> I believe this is a tar version compatibility issue:
>>> 
>
http://unix.derkeiler.com/Mailing-Lists/FreeBSD/stable/2007-05/msg00679.
>>> html
>>> 
>>> -Jason Martin
>>> 
>>> 
>>> 
>> 
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> 
>
https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>> 
> 
> 
> 



From lists at c22.cc  Wed Sep  1 16:45:23 2010
From: lists at c22.cc (Chris John Riley)
Date: Wed, 1 Sep 2010 22:45:23 +0200
Subject: [Owasp-modsecurity-core-rule-set] Integration with mod_headers
Message-ID: <CA4598F4-07D8-4481-9299-26888C411CDD@c22.cc>

Hi,

Apologies if this has already been covered, but I'm trying to use mod_headers to set an additional cookie value based on the results of a mod_security SecRule. I've tried a number of things, including skip/skipAfter, but nothing seems to work for some reason. 

Example:

  SecRule RESPONSE_STATUS "^[345]" "phase:3,skip:1"
  header add Set-Cookie "Test=1"  

Any ideas how I can achieve the desired result (setting a cookie only on a 200 status). It's probably something simple, but darned if I can find it!

Thanks, and sorry for the noob question. 

Chris

---------------------------------------------------------
                     [Chris John Riley]
                        [blog.c22.cc]
---------------------------------------------------------
- All emails XOR'd twice for added security -
--------------------------------------------------------- 

From RBarnett at trustwave.com  Wed Sep  1 16:48:33 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 1 Sep 2010 15:48:33 -0500
Subject: [Owasp-modsecurity-core-rule-set] Integration with mod_headers
In-Reply-To: <CA4598F4-07D8-4481-9299-26888C411CDD@c22.cc>
Message-ID: <C8A43461.13790%rbarnett@trustwave.com>

On 9/1/10 4:45 PM, "Chris John Riley" <lists at c22.cc> wrote:

> Hi,
> 
> Apologies if this has already been covered, but I'm trying to use mod_headers
> to set an additional cookie value based on the results of a mod_security
> SecRule. I've tried a number of things, including skip/skipAfter, but nothing
> seems to work for some reason.
> 
> Example:
> 
>   SecRule RESPONSE_STATUS "^[345]" "phase:3,skip:1"
>   header add Set-Cookie "Test=1"
> 
> Any ideas how I can achieve the desired result (setting a cookie only on a 200
> status). It's probably something simple, but darned if I can find it!
> 
> Thanks, and sorry for the noob question.
> 

Hey Chris,
Take a look at this previous blog post that I did which is somewhat related
(having ModSecurity interact with mod_headers) to choose which to fix
outbound set-cookie sessionids that are missing the httponly cookie flag.

http://blog.modsecurity.org/2008/12/helping-protect-cookies-with-httponly-fl
ag.html

Basically you just need to have modsec set and ENV varaible (with the setenv
action) so that Apache can read it and then conditionally use the header
directive if that ENV token is set.

Hope that helps,
Ryan



From lists at c22.cc  Thu Sep  2 10:01:32 2010
From: lists at c22.cc (mailing lists)
Date: Thu, 2 Sep 2010 16:01:32 +0200
Subject: [Owasp-modsecurity-core-rule-set] Integration with mod_headers
In-Reply-To: <C8A43461.13790%rbarnett@trustwave.com>
References: <CA4598F4-07D8-4481-9299-26888C411CDD@c22.cc>
	<C8A43461.13790%rbarnett@trustwave.com>
Message-ID: <AANLkTi=nyyDMTFJvSxdiX3DNCqxsLwKCetti_esR9R1H@mail.gmail.com>

Hi,

Thanks for the pointer. I was looking at that very post last night in order
to find possible solutions. Looks like I missed the most important part
though (the env=http_cookie at the end of the header line). I'll take
another stab at this tonight and hopefully get it working as desired.

Thanks for the quick reply.

Chris

On Wed, Sep 1, 2010 at 10:48 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:

> On 9/1/10 4:45 PM, "Chris John Riley" <lists at c22.cc> wrote:
>
> > Hi,
> >
> > Apologies if this has already been covered, but I'm trying to use
> mod_headers
> > to set an additional cookie value based on the results of a mod_security
> > SecRule. I've tried a number of things, including skip/skipAfter, but
> nothing
> > seems to work for some reason.
> >
> > Example:
> >
> >   SecRule RESPONSE_STATUS "^[345]" "phase:3,skip:1"
> >   header add Set-Cookie "Test=1"
> >
> > Any ideas how I can achieve the desired result (setting a cookie only on
> a 200
> > status). It's probably something simple, but darned if I can find it!
> >
> > Thanks, and sorry for the noob question.
> >
>
> Hey Chris,
> Take a look at this previous blog post that I did which is somewhat related
> (having ModSecurity interact with mod_headers) to choose which to fix
> outbound set-cookie sessionids that are missing the httponly cookie flag.
>
>
> http://blog.modsecurity.org/2008/12/helping-protect-cookies-with-httponly-fl
> ag.html<http://blog.modsecurity.org/2008/12/helping-protect-cookies-with-httponly-fl%0Aag.html>
>
> Basically you just need to have modsec set and ENV varaible (with the
> setenv
> action) so that Apache can read it and then conditionally use the header
> directive if that ENV token is set.
>
> Hope that helps,
> Ryan
>
>
>


-- 
--
? Chris John Riley ?
? http://blog.c22.cc ?
--
------------------------------------------
All emails ROT-26 encrypted
------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100902/f1c85b83/attachment.html 

From yersinia.spiros at gmail.com  Fri Sep  3 11:16:59 2010
From: yersinia.spiros at gmail.com (yersinia)
Date: Fri, 3 Sep 2010 17:16:59 +0200
Subject: [Owasp-modsecurity-core-rule-set] CRS configuration files questions
Message-ID: <AANLkTinLuKmM4dOc+XRJspzAewMXMjjE+izrJx3_ULCu@mail.gmail.com>

hi

I wanted to know which files CRS 2.0.x are really configuration files,
for customization, such that an upgrade via a package manager don't
overwritten them. In particular, besides

/ etc/httpd/modsecurity.d/modsecurity_crs_10_config.conf
/ etc / httpd / modsecurity.d / modsecurity_localrules.conf
(in EPEL/Fedora)
I think that these that follow are comparable to the configuration files also:

In / etc / httpd / modsecurity.d / base_rules

modsecurity_crs_48_local_exceptions.conf

modsecurity_crs_49_inbound_blocking.conf

modsecurity_crs_30_http_policy.conf

In Fedora/EPEL the mod_security RPM DON'T MARK them (in base_rules) as
config file so an update override them, i think incorrectly so. So
before opening an issue I thought to ask here.

Related to this issue: There are policies to update the CRS 2.0.x
upstream to ensure consistency in the rules if these files are
changed?

Thanks in advance

From c.klossek at apo-discounter.de  Fri Sep  3 15:50:22 2010
From: c.klossek at apo-discounter.de (Christian Klossek)
Date: Fri, 03 Sep 2010 21:50:22 +0200
Subject: [Owasp-modsecurity-core-rule-set] Response Body checking
Message-ID: <4C81517E.2050801@apo-discounter.de>

Hi,

I'm using Apache 2.2.9 with modsecurity 2.5.12 and the core rulset 2.0.7.

I tried to enable response body checking. I enabled "SecResponseBodyAccess On".

I have a testpage with an mysql error "1064 - You have an error in your SQL syntax; check the manual..." I think it
should be detected by the rule 971150 out of "modsecurity_crs_50_outbound.conf":

SecRule RESPONSE_BODY "\bYou have an error in your SQL syntax;" \
        "phase:4,rev:'2.0.7',t:none,capture,ctl:auditLogParts=+E,pass,nolog,auditlog,msg:'SQL Information
Leakage',id:'971150',tag:'LEAKAGE/ERRORS',tag:'WASCTC/WASC-13',tag:'OWASP_TOP_10/A6',tag:'PCI/6.5.6',severity:'3',setvar:'tx.msg=%{rule.msg}',setvar:tx.outbound_anomaly_score=+%{tx.error_anomaly_score},setvar:tx.anomaly_score=+{tx.error_anomaly_score},setvar:tx.%{rule.id}-LEAKAGE/ERRORS-%{matched_var_name}=%{tx.0}"

But unfortunately the sql information leakage gets not detected. Why?

Thanks for your help

Christian


From c.klossek at apo-discounter.de  Fri Sep  3 16:22:01 2010
From: c.klossek at apo-discounter.de (Christian Klossek)
Date: Fri, 03 Sep 2010 22:22:01 +0200
Subject: [Owasp-modsecurity-core-rule-set] looking for a rule
Message-ID: <4C8158E9.8080501@apo-discounter.de>

Hi,

in the core ruleset 2.0.8 is there any rule against this kind of attack?:

http://<domain>/test-12345/*!union+select+1,concat_ws(0x3a,user(),database(),version())*/.html

Thanks for your help

Christian

From spooker at gmail.com  Fri Sep  3 16:26:02 2010
From: spooker at gmail.com (Rodrigo Montoro(Sp0oKeR))
Date: Fri, 3 Sep 2010 17:26:02 -0300
Subject: [Owasp-modsecurity-core-rule-set] looking for a rule
In-Reply-To: <4C8158E9.8080501@apo-discounter.de>
References: <4C8158E9.8080501@apo-discounter.de>
Message-ID: <AANLkTi=AU33Qa09aKkOqmgfFVxVPN5iR9qaQ9ShxW51h@mail.gmail.com>

Hi Christian,

You can test your payloads here http://www.modsecurity.org/demo/

Probably couple of rules will detect this payload.

Regards,

On Fri, Sep 3, 2010 at 5:22 PM, Christian Klossek
<c.klossek at apo-discounter.de> wrote:
> Hi,
>
> in the core ruleset 2.0.8 is there any rule against this kind of attack?:
>
> http://<domain>/test-12345/*!union+select+1,concat_ws(0x3a,user(),database(),version())*/.html
>
> Thanks for your help
>
> Christian
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Rodrigo Montoro (Sp0oKeR)
http://spookerlabs.blogspot.com
http://www.twitter.com/spookerlabs
http://www.linkedin.com/in/spooker

From spooker at gmail.com  Fri Sep  3 16:28:41 2010
From: spooker at gmail.com (Rodrigo Montoro(Sp0oKeR))
Date: Fri, 3 Sep 2010 17:28:41 -0300
Subject: [Owasp-modsecurity-core-rule-set] Response Body checking
In-Reply-To: <4C81517E.2050801@apo-discounter.de>
References: <4C81517E.2050801@apo-discounter.de>
Message-ID: <AANLkTi=iM0a5Qdto=V+AXMuGqug3kapPfkGNVfBUFGGD@mail.gmail.com>

This rule is to be fired with this payload.

I tested this "1064 - You have an error in your SQL syntax; check the
manual..." at demo page and this rule triggered
http://www.modsecurity.org/demo/

Did you load this file in your modsecurity configuration ?

Regards,

On Fri, Sep 3, 2010 at 4:50 PM, Christian Klossek
<c.klossek at apo-discounter.de> wrote:
> Hi,
>
> I'm using Apache 2.2.9 with modsecurity 2.5.12 and the core rulset 2.0.7.
>
> I tried to enable response body checking. I enabled "SecResponseBodyAccess On".
>
> I have a testpage with an mysql error "1064 - You have an error in your SQL syntax; check the manual..." I think it
> should be detected by the rule 971150 out of "modsecurity_crs_50_outbound.conf":
>
> SecRule RESPONSE_BODY "\bYou have an error in your SQL syntax;" \
> ? ? ? ?"phase:4,rev:'2.0.7',t:none,capture,ctl:auditLogParts=+E,pass,nolog,auditlog,msg:'SQL Information
> Leakage',id:'971150',tag:'LEAKAGE/ERRORS',tag:'WASCTC/WASC-13',tag:'OWASP_TOP_10/A6',tag:'PCI/6.5.6',severity:'3',setvar:'tx.msg=%{rule.msg}',setvar:tx.outbound_anomaly_score=+%{tx.error_anomaly_score},setvar:tx.anomaly_score=+{tx.error_anomaly_score},setvar:tx.%{rule.id}-LEAKAGE/ERRORS-%{matched_var_name}=%{tx.0}"
>
> But unfortunately the sql information leakage gets not detected. Why?
>
> Thanks for your help
>
> Christian
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
Rodrigo Montoro (Sp0oKeR)
http://spookerlabs.blogspot.com
http://www.twitter.com/spookerlabs
http://www.linkedin.com/in/spooker

From RBarnett at trustwave.com  Fri Sep  3 16:30:48 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 3 Sep 2010 15:30:48 -0500
Subject: [Owasp-modsecurity-core-rule-set] looking for a rule
In-Reply-To: <AANLkTi=AU33Qa09aKkOqmgfFVxVPN5iR9qaQ9ShxW51h@mail.gmail.com>
Message-ID: <C8A6D338.1390B%rbarnett@trustwave.com>

On 9/3/10 4:26 PM, "Rodrigo Montoro(Sp0oKeR)" <spooker at gmail.com> wrote:

> Hi Christian,
> 
> You can test your payloads here http://www.modsecurity.org/demo/
> 
> Probably couple of rules will detect this payload.
> 
> Regards,

Rodrigo beat me to the punch on this one :)  He is right, there are a number
CRS rules that trigger on that payload -

http://www.modsecurity.org/demo/phpids?test=*!union%2Bselect%2B1,concat_ws(0
x3a,user(),database(),version())*/.html




From c.klossek at apo-discounter.de  Sat Sep  4 07:57:38 2010
From: c.klossek at apo-discounter.de (Christian Klossek)
Date: Sat, 04 Sep 2010 13:57:38 +0200
Subject: [Owasp-modsecurity-core-rule-set] looking for a rule
In-Reply-To: <C8A6D338.1390B%rbarnett@trustwave.com>
References: <C8A6D338.1390B%rbarnett@trustwave.com>
Message-ID: <4C823432.1040402@apo-discounter.de>

Hi all,

I found out what caused my problem with the payload and that one with the information leakage as well. Let me try to explain:

I tested it on a completely new debian-machine. I installed Apache2, Modsecurity 2.5.12 and CRS 2.0.8 (with default action "deny") and PHP 5.

1. I enabled mod_rewrite
2. I put the file "test.php" in my webfolder "/var/www":
--------------------
<?php
echo "1064 - You have an error in your SQL syntax; check the manual...";
?>
--------------------
3. I created a ".htaccess" in the webfolder:
--------------------
RewriteEngine On
RewriteBase /
RewriteRule ^test-(.*).html$ test.php?id=$1
--------------------

When I access the page with "http://<ip>/test.php" Modsecurity detects the sql information leakage and displays a "forbidden"-page.
But when I access the page with "http://<ip>/test-12345.html" the SQL-Error is displayed.
And when I access the page with "http://<ip>/test-12345/*!union+select+1,concat_ws(0x3a,user(),database(),version())*/.html Modsecurity doesn't detect the sql injection and also not the sql
information leakage.

Is there a way to configure modsecurity so that it detects those payloads even after a url rewrite?

Thanks for your help.

Christian

Ryan Barnett wrote:
> On 9/3/10 4:26 PM, "Rodrigo Montoro(Sp0oKeR)" <spooker at gmail.com> wrote:
> 
>> Hi Christian,
>>
>> You can test your payloads here http://www.modsecurity.org/demo/
>>
>> Probably couple of rules will detect this payload.
>>
>> Regards,
> 
> Rodrigo beat me to the punch on this one :)  He is right, there are a number
> CRS rules that trigger on that payload -
> 
> http://www.modsecurity.org/demo/phpids?test=*!union%2Bselect%2B1,concat_ws(0
> x3a,user(),database(),version())*/.html
> 
> 

From RBarnett at trustwave.com  Sat Sep  4 09:27:06 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Sat, 4 Sep 2010 08:27:06 -0500
Subject: [Owasp-modsecurity-core-rule-set] looking for a rule
In-Reply-To: <4C823432.1040402@apo-discounter.de>
References: <C8A6D338.1390B%rbarnett@trustwave.com>
	<4C823432.1040402@apo-discounter.de>
Message-ID: <5A5E7BA7-8D78-42EC-85DC-E6E16E241E3F@trustwave.com>

A couple of things -

The sqli payload you are sending is part of the request filename and not a parameter payload as we tested. Did you set PARANOID_MODE in your 10 conf file?  If you set this to 1 the rules will inspect beyond parameter data. 

You could also try and run those rules in phase:1 to see if they trigger before the mod_rewrite rules. 

Also there are some source code checks you can verify to ensure that modsec rules before/after other apache modules for inbound/outbound data. 

This seems like it might be a sub-request issue as we have seen in the past. I will look into it further. 

Sent from my iPhone

On Sep 4, 2010, at 7:57 AM, Christian Klossek <c.klossek at apo-discounter.de> wrote:

> Hi all,
> 
> I found out what caused my problem with the payload and that one with the information leakage as well. Let me try to explain:
> 
> I tested it on a completely new debian-machine. I installed Apache2, Modsecurity 2.5.12 and CRS 2.0.8 (with default action "deny") and PHP 5.
> 
> 1. I enabled mod_rewrite
> 2. I put the file "test.php" in my webfolder "/var/www":
> --------------------
> <?php
> echo "1064 - You have an error in your SQL syntax; check the manual...";
> ?>
> --------------------
> 3. I created a ".htaccess" in the webfolder:
> --------------------
> RewriteEngine On
> RewriteBase /
> RewriteRule ^test-(.*).html$ test.php?id=$1
> --------------------
> 
> When I access the page with "http://<ip>/test.php" Modsecurity detects the sql information leakage and displays a "forbidden"-page.
> But when I access the page with "http://<ip>/test-12345.html" the SQL-Error is displayed.
> And when I access the page with "http://<ip>/test-12345/*!union+select+1,concat_ws(0x3a,user(),database(),version())*/.html Modsecurity doesn't detect the sql injection and also not the sql
> information leakage.
> 
> Is there a way to configure modsecurity so that it detects those payloads even after a url rewrite?
> 
> Thanks for your help.
> 
> Christian
> 
> Ryan Barnett wrote:
>> On 9/3/10 4:26 PM, "Rodrigo Montoro(Sp0oKeR)" <spooker at gmail.com> wrote:
>> 
>>> Hi Christian,
>>> 
>>> You can test your payloads here http://www.modsecurity.org/demo/
>>> 
>>> Probably couple of rules will detect this payload.
>>> 
>>> Regards,
>> 
>> Rodrigo beat me to the punch on this one :)  He is right, there are a number
>> CRS rules that trigger on that payload -
>> 
>> http://www.modsecurity.org/demo/phpids?test=*!union%2Bselect%2B1,concat_ws(0
>> x3a,user(),database(),version())*/.html
>> 
>> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 


From oxdef at oxdef.info  Mon Sep  6 10:43:08 2010
From: oxdef at oxdef.info (Taras)
Date: Mon, 6 Sep 2010 18:43:08 +0400
Subject: [Owasp-modsecurity-core-rule-set] Right way to write own configs
 and stay updated with last version of CRS
Message-ID: <20100906184308.82b4352d.oxdef@oxdef.info>

Hi, all!

I want to have my own main CRS config and in same time stay updated with last version of CRS.
My workaround is to have my main config like:

---------- conf.d/modsecurity_main_config.conf ----------
Include conf.d/modsecurity_crs/modsecurity_crs_10_config.conf
...
# My settings
SecRuleEngine On
SecRequestBodyAccess on
SecRequestBodyLimit 1024k
SecDefaultAction "phase:2,deny" 
...
Include conf.d/modsecurity_crs/base_rules/*.conf
---------- conf.d/modsecurity_main_config.conf ----------

So when new CRS is realsed I need to update only all CRS files except 
my modsecurity_main_config.conf.

Is it right way to keep my settings and stay updated with last CRS?

-- 
Taras
http://oxdef.info

From RBarnett at trustwave.com  Mon Sep  6 13:11:38 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Mon, 6 Sep 2010 12:11:38 -0500
Subject: [Owasp-modsecurity-core-rule-set] Right way to write own
 configs and stay updated with last version of CRS
In-Reply-To: <20100906184308.82b4352d.oxdef@oxdef.info>
References: <20100906184308.82b4352d.oxdef@oxdef.info>
Message-ID: <E44687A1-2D67-4069-99DC-BEFD2E747D19@trustwave.com>

What you are doing is good however we need to update the CRS files so that we rename the 10 config file to have a .template extension so that you can customize the local file and then unpacking a new archive won't overwrite your local version. We will add that soon. 

Sent from my iPhone

On Sep 6, 2010, at 10:43 AM, Taras <oxdef at oxdef.info> wrote:

> Hi, all!
> 
> I want to have my own main CRS config and in same time stay updated with last version of CRS.
> My workaround is to have my main config like:
> 
> ---------- conf.d/modsecurity_main_config.conf ----------
> Include conf.d/modsecurity_crs/modsecurity_crs_10_config.conf
> ...
> # My settings
> SecRuleEngine On
> SecRequestBodyAccess on
> SecRequestBodyLimit 1024k
> SecDefaultAction "phase:2,deny" 
> ...
> Include conf.d/modsecurity_crs/base_rules/*.conf
> ---------- conf.d/modsecurity_main_config.conf ----------
> 
> So when new CRS is realsed I need to update only all CRS files except 
> my modsecurity_main_config.conf.
> 
> Is it right way to keep my settings and stay updated with last CRS?
> 
> -- 
> Taras
> http://oxdef.info
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 


From RBarnett at trustwave.com  Tue Sep  7 11:07:34 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 7 Sep 2010 10:07:34 -0500
Subject: [Owasp-modsecurity-core-rule-set] New ModSecurity User Survey
	for 2010 is Online
In-Reply-To: <C8A3EB06.135AD%rbarnett@trustwave.com>
Message-ID: <C8ABCD76.13A05%rbarnett@trustwave.com>

Just a reminder to the community to please take a few minutes and fill-out the ModSecurity User Survey at the link below.  We need your feedback!

Thanks,
Ryan


On 9/1/10 11:35 AM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

Hello ModSecurity Users!  We want to hear from you.  What do you like about ModSecurity?  What don?t you like?  What can we do better?  Now is your chance to speak up and let us know how we can make ModSecurity better.  Please take the time to complete the brand new ModSecurity User Survey for 2010 -

http://www.surveymonkey.com/s/WWL32K8

The results of this survey will influence both the ModSecurity and OWASP Core Rule Set roadmaps so if there are some features that you would like to see, let us know.  As an added bonus for taking the time to complete the survey, if you provide a ModSecurity Testimonial, you will be eligible for a raffle to win a t-shirt.

Thanks for helping out and I look forward to reviewing your responses.

Ryan Barnett
ModSecurity Community Manager
OWASP ModSecurity Core Rule Set Project Leader




From oxdef at oxdef.info  Tue Sep  7 15:42:11 2010
From: oxdef at oxdef.info (Taras)
Date: Tue, 07 Sep 2010 23:42:11 +0400
Subject: [Owasp-modsecurity-core-rule-set] Right way to write own
 configs and stay updated with last version of CRS
In-Reply-To: <E44687A1-2D67-4069-99DC-BEFD2E747D19@trustwave.com>
References: <20100906184308.82b4352d.oxdef@oxdef.info>
	<E44687A1-2D67-4069-99DC-BEFD2E747D19@trustwave.com>
Message-ID: <1283888531.6536.2.camel@moon>

Hi, Ryan!

Thanks for answer! Idea with template file looks good!

> What you are doing is good however we need to update the CRS files so
>  that we rename the 10 config file to have a .template extension so
>  that you can customize the local file and then unpacking a new archive
>  won't overwrite your local version. We will add that soon.

>  
> 
> Sent from my iPhone
> 
> On Sep 6, 2010, at 10:43 AM, Taras <oxdef at oxdef.info> wrote:
> 
> > Hi, all!
> > 
> > I want to have my own main CRS config and in same time stay updated with last version of CRS.
> > My workaround is to have my main config like:
> > 
> > ---------- conf.d/modsecurity_main_config.conf ----------
> > Include conf.d/modsecurity_crs/modsecurity_crs_10_config.conf
> > ...
> > # My settings
> > SecRuleEngine On
> > SecRequestBodyAccess on
> > SecRequestBodyLimit 1024k
> > SecDefaultAction "phase:2,deny" 
> > ...
> > Include conf.d/modsecurity_crs/base_rules/*.conf
> > ---------- conf.d/modsecurity_main_config.conf ----------
> > 
> > So when new CRS is realsed I need to update only all CRS files except 
> > my modsecurity_main_config.conf.
> > 
> > Is it right way to keep my settings and stay updated with last CRS?
> > 
> > -- 
> > Taras
> > http://oxdef.info
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> > 
> 

-- 
Taras
http://oxdef.info
----
"Software is like sex: it's better when it's free." - Linus Torvalds


From RBarnett at trustwave.com  Tue Sep  7 19:20:48 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 7 Sep 2010 18:20:48 -0500
Subject: [Owasp-modsecurity-core-rule-set] Advanced feature of the week:
	Real-time blacklist lookups
Message-ID: <03E8C72F-A066-4B2F-8FBE-B40596989F8A@trustwave.com>

http://blog.modsecurity.org/2010/09/advanced-feature-of-the-week-real-time-blacklist-lookups.html


Sent from my iPhone

From d.caspari at eurodata.de  Wed Sep  8 10:44:17 2010
From: d.caspari at eurodata.de (Dirk Caspari)
Date: Wed, 08 Sep 2010 16:44:17 +0200
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule "950109" matches for ARG
	"passed_id=81" ?
Message-ID: <4C87A141.2040400@eurodata.de>

--411a3f76-B--
GET /src/read_body.php?mailbox=INBOX&passed_id=81&startMessage=1 HTTP/1.1
Host: xxx.xxxxxxxx.de
User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3) 
Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 115
Connection: keep-alive
Referer: 
https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&sort=0&startMessage=1&mailbox=INBOX
Cookie: xxxxx


--411a3f76-H--
Message: Pattern match "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" at 
ARGS:passed_id. [file 
"/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations.conf"] 
[line "185"] [id "950109"] [rev "2.0.8"] [msg "Multiple URL Encoding 
Detected"] [severity "NOTICE"] [tag "PROTOCOL_VIOLATION/EVASION"]
Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. 
[file 
"/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf"] 
[line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=, 
XSS=): Multiple URL Encoding Detected ! 
%{matched_var_name}=%{matched_var} !"]

Thanks.
  D I R K



-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 7675 bytes
Desc: S/MIME Cryptographic Signature
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/53de10ad/attachment.bin 

From RBarnett at trustwave.com  Wed Sep  8 11:16:32 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 8 Sep 2010 10:16:32 -0500
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule "950109" matches for
 ARG "passed_id=81" ?
In-Reply-To: <4C87A141.2040400@eurodata.de>
Message-ID: <C8AD2110.13AC1%rbarnett@trustwave.com>

On 9/8/10 10:44 AM, "Dirk Caspari" <d.caspari at eurodata.de> wrote:

> --411a3f76-B--
> GET /src/read_body.php?mailbox=INBOX&passed_id=81&startMessage=1 HTTP/1.1
> Host: xxx.xxxxxxxx.de
> User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3)
> Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
> Accept-Encoding: gzip,deflate
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive: 115
> Connection: keep-alive
> Referer: 
> https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&sort=0&startMessage=1
> &mailbox=INBOX
> Cookie: xxxxx
> 
> 
> --411a3f76-H--
> Message: Pattern match "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" at
> ARGS:passed_id. [file
> "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations
> .conf"] 
> [line "185"] [id "950109"] [rev "2.0.8"] [msg "Multiple URL Encoding
> Detected"] [severity "NOTICE"] [tag "PROTOCOL_VIOLATION/EVASION"]
> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score.
> [file 
> "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf"]
> [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=,
> XSS=): Multiple URL Encoding Detected !
> %{matched_var_name}=%{matched_var} !"]
> 
> Thanks.
>   D I R K
> 
> 
> 

Hmm.. Looks like the previous version in SVN was missing the parentheses in
the RegEx.  Use this latest version -

http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_r
ules/modsecurity_crs_20_protocol_violations.conf?revision=1535




From Mike.Owens at state.nm.us  Wed Sep  8 11:33:42 2010
From: Mike.Owens at state.nm.us (Owens, Mike, DoIT)
Date: Wed, 8 Sep 2010 09:33:42 -0600
Subject: [Owasp-modsecurity-core-rule-set] FW: WHY Rule "950109" matches for
	ARG"passed_id=81" ?
References: <4C87A141.2040400@eurodata.de>
Message-ID: <C37AE69DD1B4204B891D29A0E66AD42406F05B97@CEXMB5.nmes.lcl>

I believe the problem is the way the matching regex is written:

   \%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}

I think the intent of the original regex is to match any instance of a URL-encoded ASCII or Unicode character; the (?!$|\W) construct checks if the 1st character after the '%' is NOT an end-of-line or a non-word character, as a way to avoid an unnessary scan; but the way it's written, it matches any string consisting of a '%' sign that's not followed by end-of-line or a non-word character, OR any string of 2 alphabetic characters, OR any string of a 'u' followed by 4 alphabetic characters i.e.

   \%(?!$|\W)
   --or--
   [0-9a-fA-F]{2}
   --or--
   u[0-9a-fA-F]{4}

I think what was intended was to match any strings of the forms

   \%(?!$|\W)[0-9a-fA-F]{2}
   --or--
   \%(?!$|\W)u[0-9a-fA-F]{4}

If so, the regex could be written as

   \%(?!$|\W)([0-9a-fA-F]{2}|u[0-9a-fA-F]{4})

i.e. removing the '|' after the negative-lookahead group, and grouping the following aternatives.

--Mike Owens <mike.owens at state.nm.us>




-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org on behalf of Dirk Caspari
Sent: Wed 9/8/10 08:44
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule "950109" matches for ARG"passed_id=81" ?
 
--411a3f76-B--
GET /src/read_body.php?mailbox=INBOX&passed_id=81&startMessage=1 HTTP/1.1
Host: xxx.xxxxxxxx.de
User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3) 
Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive: 115
Connection: keep-alive
Referer: 
https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&sort=0&startMessage=1&mailbox=INBOX
Cookie: xxxxx


--411a3f76-H--
Message: Pattern match "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" at 
ARGS:passed_id. [file 
"/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations.conf"] 
[line "185"] [id "950109"] [rev "2.0.8"] [msg "Multiple URL Encoding 
Detected"] [severity "NOTICE"] [tag "PROTOCOL_VIOLATION/EVASION"]
Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. 
[file 
"/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf"] 
[line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=, 
XSS=): Multiple URL Encoding Detected ! 
%{matched_var_name}=%{matched_var} !"]

Thanks.
  D I R K






Confidentiality Notice: This e-mail, including all attachments is for the sole use of the intended recipient(s) and may contain confidential and privileged information. Any unauthorized review, use, disclosure or distribution is prohibited unless specifically provided under the New Mexico Inspection of Public Records Act. If you are not the intended recipient, please contact the sender and destroy all copies of this message. -- This email has been scanned by the Sybari - Antigen Email System. 



-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/d4e1b104/attachment.html 
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: ATT275744.txt
Url: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/d4e1b104/attachment.txt 

From luis.silva at axiomasoft.pt  Wed Sep  8 11:39:44 2010
From: luis.silva at axiomasoft.pt (=?ISO-8859-1?Q?Lu=EDs?= Silva)
Date: Wed, 08 Sep 2010 16:39:44 +0100
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule "950109" matches for
 ARG "passed_id=81" ?
In-Reply-To: <C8AD2110.13AC1%rbarnett@trustwave.com>
References: <C8AD2110.13AC1%rbarnett@trustwave.com>
Message-ID: <1283960384.2566.97.camel@luis-port>

Hello,

On Wed, 2010-09-08 at 10:16 -0500, Ryan Barnett wrote:

> On 9/8/10 10:44 AM, "Dirk Caspari" <d.caspari at eurodata.de> wrote:
> 
> > --411a3f76-B--
> > GET /src/read_body.php?mailbox=INBOX&passed_id=81&startMessage=1 HTTP/1.1
> > Host: xxx.xxxxxxxx.de
> > User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3)
> > Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
> > Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> > Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
> > Accept-Encoding: gzip,deflate
> > Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> > Keep-Alive: 115
> > Connection: keep-alive
> > Referer: 
> > https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&sort=0&startMessage=1
> > &mailbox=INBOX
> > Cookie: xxxxx
> > 
> > 
> > --411a3f76-H--
> > Message: Pattern match "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" at
> > ARGS:passed_id. [file
> > "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations
> > .conf"] 
> > [line "185"] [id "950109"] [rev "2.0.8"] [msg "Multiple URL Encoding
> > Detected"] [severity "NOTICE"] [tag "PROTOCOL_VIOLATION/EVASION"]
> > Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score.
> > [file 
> > "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf"]
> > [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=,
> > XSS=): Multiple URL Encoding Detected !
> > %{matched_var_name}=%{matched_var} !"]
> > 
> > Thanks.
> >   D I R K
> > 
> > 
> > 
> 
> Hmm.. Looks like the previous version in SVN was missing the parentheses in
> the RegEx.  Use this latest version -
> 
> http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_r
> ules/modsecurity_crs_20_protocol_violations.conf?revision=1535
> 
> 

The regular expression in rules 950107, 950109 and 950108 shouldn't
instead be something like "\%[0-9a-fA-F]{2}(?![0-9a-fA-F])|\%
u[0-9a-fA-F]{4}(?![0-9a-fA-F])"?
The expression provided will still match for example "%1" and, unless I
missed the point on what the rules should do, this would be a false
positive.

> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 

Thanks,
Lu?s
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/44e038ee/attachment.html 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/44e038ee/attachment.bin 

From d.caspari at eurodata.de  Wed Sep  8 11:59:50 2010
From: d.caspari at eurodata.de (Dirk Caspari)
Date: Wed, 08 Sep 2010 17:59:50 +0200
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule "950109" matches for
 ARG "passed_id=81" ?
In-Reply-To: <C8AD2110.13AC1%rbarnett@trustwave.com>
References: <C8AD2110.13AC1%rbarnett@trustwave.com>
Message-ID: <4C87B2F6.6080907@eurodata.de>

On 09/08/10 17:16, Ryan Barnett wrote:
> On 9/8/10 10:44 AM, "Dirk Caspari"<d.caspari at eurodata.de>  wrote:
>
>    
>> --411a3f76-B--
>> GET /src/read_body.php?mailbox=INBOX&passed_id=81&startMessage=1 HTTP/1.1
>> Host: xxx.xxxxxxxx.de
>> User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3)
>> Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
>> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
>> Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
>> Accept-Encoding: gzip,deflate
>> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
>> Keep-Alive: 115
>> Connection: keep-alive
>> Referer:
>> https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&sort=0&startMessage=1
>> &mailbox=INBOX
>> Cookie: xxxxx
>>
>>
>> --411a3f76-H--
>> Message: Pattern match "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" at
>> ARGS:passed_id. [file
>> "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations
>> .conf"]
>> [line "185"] [id "950109"] [rev "2.0.8"] [msg "Multiple URL Encoding
>> Detected"] [severity "NOTICE"] [tag "PROTOCOL_VIOLATION/EVASION"]
>> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score.
>> [file
>> "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf"]
>> [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=,
>> XSS=): Multiple URL Encoding Detected !
>> %{matched_var_name}=%{matched_var} !"]
>>
>> Thanks.
>>    D I R K
>>
>>
>>
>>      
> Hmm.. Looks like the previous version in SVN was missing the parentheses in
> the RegEx.  Use this latest version -
>
> http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_r
> ules/modsecurity_crs_20_protocol_violations.conf?revision=1535
>
>
>
>    

RIGHT.

the parentheses was missing ->  revision=1535 works correctly.

Thanks.



-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 7675 bytes
Desc: S/MIME Cryptographic Signature
Url : https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100908/460c68f4/attachment-0001.bin 

From yersinia.spiros at gmail.com  Wed Sep  8 12:14:51 2010
From: yersinia.spiros at gmail.com (yersinia)
Date: Wed, 8 Sep 2010 18:14:51 +0200
Subject: [Owasp-modsecurity-core-rule-set] WHY Rule "950109" matches for
 ARG "passed_id=81" ?
In-Reply-To: <4C87A141.2040400@eurodata.de>
References: <4C87A141.2040400@eurodata.de>
Message-ID: <AANLkTim+5GeB2R=GgswNjdE0qcmf09Oregh4OoZB0LJb@mail.gmail.com>

On Wed, Sep 8, 2010 at 4:44 PM, Dirk Caspari <d.caspari at eurodata.de> wrote:
> --411a3f76-B--
> GET /src/read_body.php?mailbox=INBOX&passed_id=81&startMessage=1 HTTP/1.1
> Host: xxx.xxxxxxxx.de
> User-Agent: Mozilla/5.0 (X11; U; Linux i686; de-DE; rv:1.9.2.3)
> Gecko/20100423 Ubuntu/10.04 (lucid) Firefox/3.6.3
> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
> Accept-Language: de-DE,de;q=0.8,de-de;q=0.6,en-us;q=0.4,en;q=0.2
> Accept-Encoding: gzip,deflate
> Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7
> Keep-Alive: 115
> Connection: keep-alive
> Referer:
> https://xxx.xxxxxxxxx.de/src/right_main.php?PG_SHOWALL=0&sort=0&startMessage=1&mailbox=INBOX
> Cookie: xxxxx
>
>
> --411a3f76-H--
> Message: Pattern match "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" at
> ARGS:passed_id. [file
> "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_20_protocol_violations.conf"]
> [line "185"] [id "950109"] [rev "2.0.8"] [msg "Multiple URL Encoding
> Detected"] [severity "NOTICE"] [tag "PROTOCOL_VIOLATION/EVASION"]
> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score. [file
> "/etc/apache2/modsecurity/rules-enabled/modsecurity_crs_60_correlation.conf"]
> [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=,
> XSS=): Multiple URL Encoding Detected ! %{matched_var_name}=%{matched_var}
> !"]


No. The rule, IMHO, is not correct. It is a probably bug introduced in
2.0.8 probably : in 2.0.5 the rule logic

# Check URL encodings
#
# -=[ Rule Logic ]=-
# There are two different chained rules.  We need to separate them as
we are inspecting two
# different variables - REQUEST_URI and REQUEST_BODY.  For
REQUEST_BODY, we only want to
# run the @validateUrlEncoding operator if the content-type is
application/x-www-form-urlencoding.
#
# -=[ References ]=-
# http://www.ietf.org/rfc/rfc1738.txt

don't have a match against ARGS, that to me not seem correct


>
> Thanks.
> ?D I R K
>
>
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>

From misc.lists at blueyonder.co.uk  Fri Sep 10 15:14:36 2010
From: misc.lists at blueyonder.co.uk (Arthur Dent)
Date: Fri, 10 Sep 2010 20:14:36 +0100
Subject: [Owasp-modsecurity-core-rule-set] Deprecated PHP function problem
Message-ID: <3027005cf22be69814401a68cce87c3e.squirrel@www.troodos.org.uk>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello all,

I have Squirrelmail (a webmail application) running on my server. Whenever
I use the GPG plugin module whilst composing and sending mail (such as
this one) I get a raft of alerts in ModSec.

The problem relates to the fact that the Squirrelmail code for the plugin
uses a deprecated php function. This seems to upset ModSec and it issues a
"Multiple URL Encoding Detected" or "directory traversal" warning.

I have reported this to the Squirrelmail team and they are aware of it. It
will not however be fixed in the near future as it is, after all, merely a
warning not an error from the Squirrelmail point of view.

My question is - how do I allow for this in ModSec without disabling the
rule?

Example
=======

- --922b274e-H--
Message: Pattern match
"(?:(?:\/|\\)?\.+(\/|\\)(?:\.+)?)|(?:\w+\.exe\??\s)|(?:;\s*\w+\s*\/[\w*-]+\/)|(?:\d\.\dx\|)|(?:%(?:c0\.|af\.|5c\.))|(?:\/(?:%2e){2})"
at ARGS:addbasepath. [file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_41_phpids_filters.conf"]
[line "86"] [id "900010"] [msg "Detects basic directory traversal"] [data
"../.."] [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"]
[tag "WEB_ATTACK/LFI"]
Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score.
[file
"/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
[line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=,
XSS=): 900010-Detects basic directory traversal"]
Apache-Error: [file
"/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
[line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
/usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
referer:
https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_error=1&session=1
Apache-Error: [file
"/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
[line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
/usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
referer:
https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_error=1&session=1
Apache-Error: [file
"/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
[line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
/usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
referer:
https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_error=1&session=1

[ Snip - about 50 or so of the same thing... ]

Apache-Error: [file
"/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
[line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
/usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
referer:
https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_error=1&session=1
Apache-Handler: php5-script
Stopwatch: 1284144444492963 143505 (553 8540 -)
Response-Body-Transformed: Dechunked
Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/);
core ruleset/2.0.8.
Server: Apache/2.2.16 (Fedora)

- --922b274e-Z--



-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAkyKg5wACgkQ75heFf3niHKcygCdFaXosQzeifLuseJJxJLGjcTM
kFgAoKWxs5i1KwXwx2e33j0MaGfRTACF
=kR0r
-----END PGP SIGNATURE-----



From RBarnett at trustwave.com  Fri Sep 10 15:24:10 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 10 Sep 2010 14:24:10 -0500
Subject: [Owasp-modsecurity-core-rule-set] Deprecated PHP function
 problem
In-Reply-To: <3027005cf22be69814401a68cce87c3e.squirrel@www.troodos.org.uk>
Message-ID: <C8AFFE1A.13D0F%rbarnett@trustwave.com>

On 9/10/10 3:14 PM, "Arthur Dent" <misc.lists at blueyonder.co.uk> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello all,
> 
> I have Squirrelmail (a webmail application) running on my server. Whenever
> I use the GPG plugin module whilst composing and sending mail (such as
> this one) I get a raft of alerts in ModSec.
> 
> The problem relates to the fact that the Squirrelmail code for the plugin
> uses a deprecated php function. This seems to upset ModSec and it issues a
> "Multiple URL Encoding Detected" or "directory traversal" warning.
> 

Hey Arthur,
ModSecurity is not the one complaining about the deprecated php function,
that is an Apache generated message and ModSecurity is just listing it along
side other other messages.

As for the ones that are being triggered by ModSec, it seems as though the
squirrelmail ARGS:addbasepath payload is including a local path of
some-sort.  If you want to allow this, then I would add a rule to your
modsecurity_crs_48_local_exceptions.conf file that will inspect this saved
TX data and then re-adjust the anomaly score back down (decrease it by 5 as
that is what the false positive has done) -

SecRule TX:'/^900010.*ARGS:addbasepath/' ".*"
"phase:2,t:none,nolog,pass,setvar:tx.anomaly_score=-5"

Let me know if this helps.
-Ryan


> I have reported this to the Squirrelmail team and they are aware of it. It
> will not however be fixed in the near future as it is, after all, merely a
> warning not an error from the Squirrelmail point of view.
> 
> My question is - how do I allow for this in ModSec without disabling the
> rule?
> 
> Example
> =======
> 
> - --922b274e-H--
> Message: Pattern match
> "(?:(?:\/|\\)?\.+(\/|\\)(?:\.+)?)|(?:\w+\.exe\??\s)|(?:;\s*\w+\s*\/[\w*-]+\/)|
> (?:\d\.\dx\|)|(?:%(?:c0\.|af\.|5c\.))|(?:\/(?:%2e){2})"
> at ARGS:addbasepath. [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_41_phpids_filters.conf"]
> [line "86"] [id "900010"] [msg "Detects basic directory traversal"] [data
> "../.."] [severity "CRITICAL"] [tag "WEB_ATTACK/DT"] [tag "WEB_ATTACK/ID"]
> [tag "WEB_ATTACK/LFI"]
> Message: Warning. Operator LT matched 20 at TX:inbound_anomaly_score.
> [file
> "/etc/httpd/modsecurity.d/base_rules/modsecurity_crs_60_correlation.conf"]
> [line "31"] [msg "Inbound Anomaly Score (Total Inbound Score: 5, SQLi=,
> XSS=): 900010-Detects basic directory traversal"]
> Apache-Error: [file
> "/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
> [line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
> /usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
> referer:
> https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_e
> rror=1&session=1
> Apache-Error: [file
> "/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
> [line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
> /usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
> referer:
> https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_e
> rror=1&session=1
> Apache-Error: [file
> "/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
> [line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
> /usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
> referer:
> https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_e
> rror=1&session=1
> 
> [ Snip - about 50 or so of the same thing... ]
> 
> Apache-Error: [file
> "/builddir/build/BUILD/php-5.3.3/sapi/apache2handler/sapi_apache2.c"]
> [line 326] [level 3] PHP Deprecated:  Function eregi() is deprecated in
> /usr/share/squirrelmail/plugins/gpg/gpg_pref_functions.php on line 57,
> referer:
> https://www.mydomain.com/webmail/plugins/gpg/gpg_encrypt.php?encrypt_on_send_e
> rror=1&session=1
> Apache-Handler: php5-script
> Stopwatch: 1284144444492963 143505 (553 8540 -)
> Response-Body-Transformed: Dechunked
> Producer: ModSecurity for Apache/2.5.12 (http://www.modsecurity.org/);
> core ruleset/2.0.8.
> Server: Apache/2.2.16 (Fedora)
> 
> - --922b274e-Z--
> 
> 
> 
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> 
> iEYEARECAAYFAkyKg5wACgkQ75heFf3niHKcygCdFaXosQzeifLuseJJxJLGjcTM
> kFgAoKWxs5i1KwXwx2e33j0MaGfRTACF
> =kR0r
> -----END PGP SIGNATURE-----
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 


--
Ryan Barnett
Senior Security Researcher
Trustwave - SpiderLabs
Email: rbarnett at trustwave.com
Phone: (703) 794-2248
Cell: (571) 382-0476
www.trustwave.com

This transmission may contain information that is privileged, confidential,
and/or exempt from disclosure under applicable law. If you are not the
intended recipient, you are hereby notified that any disclosure, copying,
distribution, or use of the information contained herein (including any
reliance thereon) is STRICTLY PROHIBITED. If you received this transmission
in error, please immediately contact the sender and destroy the material in
its entirety, whether in electronic or hard copy format. Thank you.



From mlavi at sgi.com  Fri Sep 10 17:07:42 2010
From: mlavi at sgi.com (Mark Lavi)
Date: Fri, 10 Sep 2010 16:07:42 -0500
Subject: [Owasp-modsecurity-core-rule-set] Deprecated PHP function
	problem
In-Reply-To: <C8AFFE1A.13D0F%rbarnett@trustwave.com>
References: <3027005cf22be69814401a68cce87c3e.squirrel@www.troodos.org.uk>
	<C8AFFE1A.13D0F%rbarnett@trustwave.com>
Message-ID: <074F0C4BE8F9FB4CB1410BF8D1E10B54F1B346@CF--AMER002E--3.americas.sgi.com>

Arthur, you should be able to set PHP error reporting (per page) or for
the entire server by altering php.ini, which you may wish to do for a
production server.

http://us3.php.net/manual/en/function.error-reporting.php

Cheers,

Mark Lavi
Senior Web Producer

sgi

46600 Landing Parkway
Fremont, CA 94538
(510) 933-5234 direct
mlavi at sgi.com 
www.sgi.com


-----Original Message-----
From: owasp-modsecurity-core-rule-set-bounces at lists.owasp.org
[mailto:owasp-modsecurity-core-rule-set-bounces at lists.owasp.org] On
Behalf Of Ryan Barnett
Sent: Friday, September 10, 2010 12:24 PM
To: Arthur Dent; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Deprecated PHP function
problem

On 9/10/10 3:14 PM, "Arthur Dent" <misc.lists at blueyonder.co.uk> wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello all,
> 
> I have Squirrelmail (a webmail application) running on my server. 
> Whenever I use the GPG plugin module whilst composing and sending mail

> (such as this one) I get a raft of alerts in ModSec.
> 
> The problem relates to the fact that the Squirrelmail code for the 
> plugin uses a deprecated php function. 

From tsj at swampthing.dk  Tue Sep 14 08:09:13 2010
From: tsj at swampthing.dk (Torben Schou Jensen)
Date: Tue, 14 Sep 2010 14:09:13 +0200 (CEST)
Subject: [Owasp-modsecurity-core-rule-set] Whitelist SquirrelMail ?
Message-ID: <5ed05f4619073fdd39a4d77847dba9d5.squirrel@swampthing.dk>

On Debian Stable I have recently setup
modsecurity-apache_2.5.12
and
ruleset modsecurity-crs_2.0.8

Currently using
SecDefaultAction "phase:2,pass"
but would like to get better protected with
SecDefaultAction "phase:2,deny"

I only allow SquirrelMail usage by HTTPS.
My problem is that SquirrelMail from time to time trigger different
protection rules, and until now I have removed several rules by use of
"SecRuleRemoveById", but not sure all have been found.

It would be great if I could use "phase:2,deny" in general, but only
"phase:2,pass" for SquirrelMail.

Or in any other way Whitelist all SquirrelMail traffic.

I trust my SquirrelMail users.

Brgds
Torben



From jamuse at gmail.com  Tue Sep 14 08:32:12 2010
From: jamuse at gmail.com (Jamuse)
Date: Tue, 14 Sep 2010 14:32:12 +0200
Subject: [Owasp-modsecurity-core-rule-set] Whitelist SquirrelMail ?
In-Reply-To: <5ed05f4619073fdd39a4d77847dba9d5.squirrel@swampthing.dk>
References: <5ed05f4619073fdd39a4d77847dba9d5.squirrel@swampthing.dk>
Message-ID: <AANLkTi=67L1KZmFRRJGy2icCZprzRLf3KW2H5XFeJ+Mc@mail.gmail.com>

On Tue, Sep 14, 2010 at 2:09 PM, Torben Schou Jensen <tsj at swampthing.dk>wrote:

>
> I only allow SquirrelMail usage by HTTPS.
> My problem is that SquirrelMail from time to time trigger different
> protection rules, and until now I have removed several rules by use of
> "SecRuleRemoveById", but not sure all have been found.
>
> It would be great if I could use "phase:2,deny" in general, but only
> "phase:2,pass" for SquirrelMail.
>

Assuming SquirrelMail is under a certain directory you can create a custom
rule to change the default action for that directory or just put the rule
engine in detectiononly mode (just in case) for everything under a that
directory, i.e:

SecRule REQUEST_URI "@rx SquirrelMail" "pass,ctl:ruleEngine=DetectionOnly"

or

<LocationMatch \/Path\/To\/SquirrelMail\/>
  SecRuleEngine DetectionOnly
</LocationMatch>

--
 - Josh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100914/e6c25651/attachment.html 

From RBarnett at trustwave.com  Tue Sep 14 09:09:55 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 14 Sep 2010 08:09:55 -0500
Subject: [Owasp-modsecurity-core-rule-set] New ModSecurity User Survey
	for 2010 is Online
In-Reply-To: <C8A3EB06.135AD%rbarnett@trustwave.com>
Message-ID: <C8B4EC63.13E5F%rbarnett@trustwave.com>

Sorry to SPAM those of you who have already completed the survey.

For those of you who haven?t yet, please take a few minutes and fill-out the ModSecurity User Survey at the link below.  We need your feedback!

Thanks,
Ryan


On 9/1/10 11:35 AM, "Ryan Barnett" <RBarnett at trustwave.com> wrote:

Hello ModSecurity Users!  We want to hear from you.  What do you like about ModSecurity?  What don?t you like?  What can we do better?  Now is your chance to speak up and let us know how we can make ModSecurity better.  Please take the time to complete the brand new ModSecurity User Survey for 2010 -

http://www.surveymonkey.com/s/WWL32K8

The results of this survey will influence both the ModSecurity and OWASP Core Rule Set roadmaps so if there are some features that you would like to see, let us know.  As an added bonus for taking the time to complete the survey, if you provide a ModSecurity Testimonial, you will be eligible for a raffle to win a t-shirt.

Thanks for helping out and I look forward to reviewing your responses.

Ryan Barnett
ModSecurity Community Manager
OWASP ModSecurity Core Rule Set Project Leader




From RBarnett at trustwave.com  Tue Sep 14 11:33:34 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 14 Sep 2010 10:33:34 -0500
Subject: [Owasp-modsecurity-core-rule-set] Advanced Topic of the Week:
	Validating SessionIDs
Message-ID: <C8B50E0E.13E77%rbarnett@trustwave.com>

http://blog.modsecurity.org/2010/09/advanced-topic-of-the-week-validating-sessionids.html

--
Ryan Barnett
ModSecurity Community Manager
OWASP ModSecurity CRS Project Lead


From rcbarnett at gmail.com  Wed Sep 15 16:33:09 2010
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Wed, 15 Sep 2010 16:33:09 -0400
Subject: [Owasp-modsecurity-core-rule-set] OWASP CRS Documentation Templates
Message-ID: <C8B6A5C5.13F68%rcbarnett@gmail.com>

Greetings everyone,
I wanted to let you all know that I have created some CRS rule documentation
information on the OWASP project site -
http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Proj
ect#tab=Documentation

Specifically, I have created a Rule Documentation Template file -
http://www.owasp.org/index.php/ModSecurity_CRS_Rule_Description_Template

* Project participants are encouraged to copy this template and create
landing pages for each CRS rule
* Use this template and create a new page using the following format
-?http://www.owasp.org/index.php?title=ModSecurity_CRS_RuleID-XXXXX?(where
XXXXX is the CRS ruleID)

Example:
http://www.owasp.org/index.php/ModSecurity_CRS_RuleID-960911

I will be updating the CRS package in the future to add in new ?tag? data
which will provide a URL link to the corresponding documentation page.

So, with this, I hope that the community can now help with documenting the
CRS :)

Cheers,
Ryan


-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100915/34237b83/attachment.html 

From artagesw at gmail.com  Fri Sep 17 18:11:07 2010
From: artagesw at gmail.com (Art Age Software)
Date: Fri, 17 Sep 2010 15:11:07 -0700
Subject: [Owasp-modsecurity-core-rule-set] False Positives Due to Possibly
	Malformed Rule
Message-ID: <AANLkTinnaE33t0rHPSVTFrbvcJ6_q-jytOHRaPxqVi_5@mail.gmail.com>

Just upgraded from core rules 1.6.1 to 2.0.8 and I'm getting false
positives on this rule:

Multiple URL Encoding Detected',id:'950109'

Updating the rule's regex to group the three disjunctive terms solves
the problem for me, but I'd like confirmation that the change enforces
the rule's true intent:

Original:

SecRule ARGS "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" \

Changed to:

SecRule ARGS "\%((?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})" \

Thanks!

From RBarnett at trustwave.com  Fri Sep 17 18:28:16 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Fri, 17 Sep 2010 17:28:16 -0500
Subject: [Owasp-modsecurity-core-rule-set] False Positives Due to
 Possibly	Malformed Rule
In-Reply-To: <AANLkTinnaE33t0rHPSVTFrbvcJ6_q-jytOHRaPxqVi_5@mail.gmail.com>
References: <AANLkTinnaE33t0rHPSVTFrbvcJ6_q-jytOHRaPxqVi_5@mail.gmail.com>
Message-ID: <DE861A7B-4EC9-4A83-BE3B-9EF678D5CEF3@trustwave.com>

Yes that is the current rule from svn trunk -

http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_20_protocol_violations.conf


Sent from my iPhone

On Sep 17, 2010, at 6:11 PM, Art Age Software <artagesw at gmail.com> wrote:

> Just upgraded from core rules 1.6.1 to 2.0.8 and I'm getting false
> positives on this rule:
> 
> Multiple URL Encoding Detected',id:'950109'
> 
> Updating the rule's regex to group the three disjunctive terms solves
> the problem for me, but I'd like confirmation that the change enforces
> the rule's true intent:
> 
> Original:
> 
> SecRule ARGS "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" \
> 
> Changed to:
> 
> SecRule ARGS "\%((?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})" \
> 
> Thanks!
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> 


From artagesw at gmail.com  Fri Sep 17 18:33:32 2010
From: artagesw at gmail.com (Art Age Software)
Date: Fri, 17 Sep 2010 15:33:32 -0700
Subject: [Owasp-modsecurity-core-rule-set] False Positives Due to
 Possibly Malformed Rule
In-Reply-To: <DE861A7B-4EC9-4A83-BE3B-9EF678D5CEF3@trustwave.com>
References: <AANLkTinnaE33t0rHPSVTFrbvcJ6_q-jytOHRaPxqVi_5@mail.gmail.com>
	<DE861A7B-4EC9-4A83-BE3B-9EF678D5CEF3@trustwave.com>
Message-ID: <AANLkTi=uidAAyB0J70jqP82cKYgti2pHP5=5FYoEgzin@mail.gmail.com>

Thanks. And sorry, I just realized you mentioned a newer version in
svn trunk on the mod-security list. Somehow, I missed that in your
earlier reply.

Thanks again for your help and time.

On Fri, Sep 17, 2010 at 3:28 PM, Ryan Barnett <RBarnett at trustwave.com> wrote:
> Yes that is the current rule from svn trunk -
>
> http://mod-security.svn.sourceforge.net/viewvc/mod-security/crs/trunk/base_rules/modsecurity_crs_20_protocol_violations.conf
>
>
> Sent from my iPhone
>
> On Sep 17, 2010, at 6:11 PM, Art Age Software <artagesw at gmail.com> wrote:
>
>> Just upgraded from core rules 1.6.1 to 2.0.8 and I'm getting false
>> positives on this rule:
>>
>> Multiple URL Encoding Detected',id:'950109'
>>
>> Updating the rule's regex to group the three disjunctive terms solves
>> the problem for me, but I'd like confirmation that the change enforces
>> the rule's true intent:
>>
>> Original:
>>
>> SecRule ARGS "\%(?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}" \
>>
>> Changed to:
>>
>> SecRule ARGS "\%((?!$|\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})" \
>>
>> Thanks!
>> _______________________________________________
>> Owasp-modsecurity-core-rule-set mailing list
>> Owasp-modsecurity-core-rule-set at lists.owasp.org
>> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>>
>
>

From rcbarnett at gmail.com  Tue Sep 21 12:35:44 2010
From: rcbarnett at gmail.com (Ryan Barnett)
Date: Tue, 21 Sep 2010 12:35:44 -0400
Subject: [Owasp-modsecurity-core-rule-set] Advanced Topic of the Week:
 Identifying Improper Output Handling (XSS Flaws)
Message-ID: <C8BE5720.1426A%rcbarnett@gmail.com>

This week?s blog post is very timely considering the new Twitter XSS/CSRF
worm that exploded this morning -
http://www.computerworld.com/s/article/9186980/Twitter_fixes_cross_site_scri
pting_flaw?taxonomyId=16

Hope this post is helpful -
http://blog.modsecurity.org/2010/09/advanced-topic-of-the-week-identifying-i
mproper-output-handling-xss-flaws.html

These rules are BETA/Experimental.  If you try them out, please let me know
how they work.

-Ryan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100921/1a8b62d5/attachment.html 

From rclemings at gmail.com  Wed Sep 22 19:55:37 2010
From: rclemings at gmail.com (Russell Clemings)
Date: Wed, 22 Sep 2010 16:55:37 -0700
Subject: [Owasp-modsecurity-core-rule-set] false positive on 959006
Message-ID: <AANLkTimvJEi=Vkd0ysWK6d31K7MtYFYrwxnm83pkupK4@mail.gmail.com>

I could use some help dealing with the following false positive (some
identifying details masked):

116818:[Tue Sep 21 22:52:43 2010] [error] [client XX.XX.XX.XX] ModSecurity:
Access denied with code 501 (phase 2). Pattern match
"(?:\\b(?:(?:n(?:et(?:\\b\\W+?\\blocalgroup|\\.exe)|(?:map|c)\\.exe)|t(?:racer(?:oute|t)|elnet\\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\\.exe|echo\\b\\W*?\\by+)\\b|c(?:md(?:(?:32)?\\.exe\\b|\\b\\W*?\\/c)|d(?:\\b\\W*?[\\\\/]|\\W*?\\.\\.)|hmod.{0,40}?\\+.{0,3}x))|[\\;\\|\\`]\\W*?
..." at REQUEST_COOKIES:__utmz. [file
"/usr/local/apache/conf/modsec2.user.conf"] [line "149"] [id "959006"] [msg
"System Command Injection"] [data "/mail"] [severity "CRITICAL"] [tag
"WEB_ATTACK/COMMAND_INJECTION"] [hostname "xxx.xxx.xxx"] [uri
"/xxxx-xxxxx-xxxxxxxx"] [unique_id "TJlve0CDUIUAAHyD6SMAAAAL"]

A couple of previous posts suggest that this is hitting on a Google
Analytics cookie (REQUEST_COOKIES:__utmz) that tracks where the user came
from. It only seems to affect a few users. I've commented out the rule, and
that fixed the immediate problem, but of course I would rather create a
narrow exemption and leave the rule intact otherwise.

How would I do that? FWIW, this is a cPanel VPS so the exceptions have to go
in an unusual place (e.g. /usr/local/apache/conf/userdata/std/2/etc/etc/etc)
but I can handle that part. It's how to write the rule that confuses me.

Here's the rule as it stands now:

SecRule
REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES
\

"(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))"
\

"phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'959006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"

I probably should add that I'm functionally regex-illiterate, so please
speak slowly :)

rac
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100922/914dc7e9/attachment.html 

From RBarnett at trustwave.com  Wed Sep 22 20:06:57 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 22 Sep 2010 19:06:57 -0500
Subject: [Owasp-modsecurity-core-rule-set] false positive on 959006
In-Reply-To: <AANLkTimvJEi=Vkd0ysWK6d31K7MtYFYrwxnm83pkupK4@mail.gmail.com>
References: <AANLkTimvJEi=Vkd0ysWK6d31K7MtYFYrwxnm83pkupK4@mail.gmail.com>
Message-ID: <003CAA36-AD7F-4C61-AF64-922AF4272AA0@trustwave.com>

Rus,
What CRS version are you using?  This looks old as the newer versions are listed in the alert using the rev action.  Also i believe the variable listing/targets for this rule were updated as it is missing ARGS. 

Sent from my iPhone

On Sep 22, 2010, at 7:56 PM, "Russell Clemings" <rclemings at gmail.com> wrote:

> I could use some help dealing with the following false positive (some identifying details masked):
> 
> 116818:[Tue Sep 21 22:52:43 2010] [error] [client XX.XX.XX.XX] ModSecurity: Access denied with code 501 (phase 2). Pattern match "(?:\\b(?:(?:n(?:et(?:\\b\\W+?\\blocalgroup|\\.exe)|(?:map|c)\\.exe)|t(?:racer(?:oute|t)|elnet\\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\\.exe|echo\\b\\W*?\\by+)\\b|c(?:md(?:(?:32)?\\.exe\\b|\\b\\W*?\\/c)|d(?:\\b\\W*?[\\\\/]|\\W*?\\.\\.)|hmod.{0,40}?\\+.{0,3}x))|[\\;\\|\\`]\\W*? ..." at REQUEST_COOKIES:__utmz. [file "/usr/local/apache/conf/modsec2.user.conf"] [line "149"] [id "959006"] [msg "System Command Injection"] [data "/mail"] [severity "CRITICAL"] [tag "WEB_ATTACK/COMMAND_INJECTION"] [hostname "xxx.xxx.xxx"] [uri "/xxxx-xxxxx-xxxxxxxx"] [unique_id "TJlve0CDUIUAAHyD6SMAAAAL"]
> 
> A couple of previous posts suggest that this is hitting on a Google Analytics cookie (REQUEST_COOKIES:__utmz) that tracks where the user came from. It only seems to affect a few users. I've commented out the rule, and that fixed the immediate problem, but of course I would rather create a narrow exemption and leave the rule intact otherwise.
> 
> How would I do that? FWIW, this is a cPanel VPS so the exceptions have to go in an unusual place (e.g. /usr/local/apache/conf/userdata/std/2/etc/etc/etc) but I can handle that part. It's how to write the rule that confuses me.
> 
> Here's the rule as it stands now:
> 
> SecRule REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES \
>     "(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))" \
>     "phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System Command Injection',id:'959006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
> 
> I probably should add that I'm functionally regex-illiterate, so please speak slowly :)
> 
> rac
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


From rclemings at gmail.com  Wed Sep 22 20:12:03 2010
From: rclemings at gmail.com (Russell Clemings)
Date: Wed, 22 Sep 2010 17:12:03 -0700
Subject: [Owasp-modsecurity-core-rule-set] false positive on 959006
In-Reply-To: <003CAA36-AD7F-4C61-AF64-922AF4272AA0@trustwave.com>
References: <AANLkTimvJEi=Vkd0ysWK6d31K7MtYFYrwxnm83pkupK4@mail.gmail.com>
	<003CAA36-AD7F-4C61-AF64-922AF4272AA0@trustwave.com>
Message-ID: <AANLkTimJAMqmxiMR57G6bNU49G7eX+KmdmciKhd_OvBN@mail.gmail.com>

It's whatever cPanel supplies by default. Maybe that's part of the problem.

On the ARGS, I just stopped copying too soon. I think this is it:

SecRule ARGS \
        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \

"phase:2,capture,t:none,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'950907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
SecRule
"REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs|User-Agent)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES"
\
        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \

"phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'959907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"



On Wed, Sep 22, 2010 at 5:06 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:

> Rus,
> What CRS version are you using?  This looks old as the newer versions are
> listed in the alert using the rev action.  Also i believe the variable
> listing/targets for this rule were updated as it is missing ARGS.
>
> Sent from my iPhone
>
> On Sep 22, 2010, at 7:56 PM, "Russell Clemings" <rclemings at gmail.com>
> wrote:
>
> > I could use some help dealing with the following false positive (some
> identifying details masked):
> >
> > 116818:[Tue Sep 21 22:52:43 2010] [error] [client XX.XX.XX.XX]
> ModSecurity: Access denied with code 501 (phase 2). Pattern match
> "(?:\\b(?:(?:n(?:et(?:\\b\\W+?\\blocalgroup|\\.exe)|(?:map|c)\\.exe)|t(?:racer(?:oute|t)|elnet\\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\\.exe|echo\\b\\W*?\\by+)\\b|c(?:md(?:(?:32)?\\.exe\\b|\\b\\W*?\\/c)|d(?:\\b\\W*?[\\\\/]|\\W*?\\.\\.)|hmod.{0,40}?\\+.{0,3}x))|[\\;\\|\\`]\\W*?
> ..." at REQUEST_COOKIES:__utmz. [file
> "/usr/local/apache/conf/modsec2.user.conf"] [line "149"] [id "959006"] [msg
> "System Command Injection"] [data "/mail"] [severity "CRITICAL"] [tag
> "WEB_ATTACK/COMMAND_INJECTION"] [hostname "xxx.xxx.xxx"] [uri
> "/xxxx-xxxxx-xxxxxxxx"] [unique_id "TJlve0CDUIUAAHyD6SMAAAAL"]
> >
> > A couple of previous posts suggest that this is hitting on a Google
> Analytics cookie (REQUEST_COOKIES:__utmz) that tracks where the user came
> from. It only seems to affect a few users. I've commented out the rule, and
> that fixed the immediate problem, but of course I would rather create a
> narrow exemption and leave the rule intact otherwise.
> >
> > How would I do that? FWIW, this is a cPanel VPS so the exceptions have to
> go in an unusual place (e.g.
> /usr/local/apache/conf/userdata/std/2/etc/etc/etc) but I can handle that
> part. It's how to write the rule that confuses me.
> >
> > Here's the rule as it stands now:
> >
> > SecRule
> REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES
> \
> >
> "(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))"
> \
> >
> "phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
> Command
> Injection',id:'959006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
> >
> > I probably should add that I'm functionally regex-illiterate, so please
> speak slowly :)
> >
> > rac
> >
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>


-- 
============================================
Russell Clemings
<russell at clemings.com>
National Association of Science Writers cybrarian:
<cybrarian at nasw.org>
============================================
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100922/82dad086/attachment.html 

From RBarnett at trustwave.com  Wed Sep 22 20:18:22 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 22 Sep 2010 19:18:22 -0500
Subject: [Owasp-modsecurity-core-rule-set] false positive on 959006
In-Reply-To: <AANLkTimJAMqmxiMR57G6bNU49G7eX+KmdmciKhd_OvBN@mail.gmail.com>
References: <AANLkTimvJEi=Vkd0ysWK6d31K7MtYFYrwxnm83pkupK4@mail.gmail.com>
	<003CAA36-AD7F-4C61-AF64-922AF4272AA0@trustwave.com>
	<AANLkTimJAMqmxiMR57G6bNU49G7eX+KmdmciKhd_OvBN@mail.gmail.com>
Message-ID: <574A77A5-A649-44E1-A65C-BAB21ABFA312@trustwave.com>

Those have different rule id's vs the alert you showed -  [id "959006"]

Sent from my iPhone

On Sep 22, 2010, at 8:12 PM, "Russell Clemings" <rclemings at gmail.com<mailto:rclemings at gmail.com>> wrote:

It's whatever cPanel supplies by default. Maybe that's part of the problem.

On the ARGS, I just stopped copying too soon. I think this is it:

SecRule ARGS \
        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \
        "phase:2,capture,t:none,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System Command Injection',id:'950907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
SecRule "REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs|User-Agent)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES" \
        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \
        "phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System Command Injection',id:'959907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"



On Wed, Sep 22, 2010 at 5:06 PM, Ryan Barnett <<mailto:RBarnett at trustwave.com>RBarnett at trustwave.com<mailto:RBarnett at trustwave.com>> wrote:
Rus,
What CRS version are you using?  This looks old as the newer versions are listed in the alert using the rev action.  Also i believe the variable listing/targets for this rule were updated as it is missing ARGS.

Sent from my iPhone

On Sep 22, 2010, at 7:56 PM, "Russell Clemings" <<mailto:rclemings at gmail.com>rclemings at gmail.com<mailto:rclemings at gmail.com>> wrote:

> I could use some help dealing with the following false positive (some identifying details masked):
>
> 116818:[Tue Sep 21 22:52:43 2010] [error] [client XX.XX.XX.XX] ModSecurity: Access denied with code 501 (phase 2). Pattern match "(?:\\b(?:(?:n(?:et(?:\\b\\W+?\\blocalgroup|\\.exe)|(?:map|c)\\.exe)|t(?:racer(?:oute|t)|elnet\\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\\.exe|echo\\b\\W*?\\by+)\\b|c(?:md(?:(?:32)?\\.exe\\b|\\b\\W*?\\/c)|d(?:\\b\\W*?[\\\\/]|\\W*?\\.\\.)|hmod.{0,40}?\\+.{0,3}x))|[\\;\\|\\`]\\W*? ..." at REQUEST_COOKIES:__utmz. [file "/usr/local/apache/conf/modsec2.user.conf"] [line "149"] [id "959006"] [msg "System Command Injection"] [data "/mail"] [severity "CRITICAL"] [tag "WEB_ATTACK/COMMAND_INJECTION"] [hostname "xxx.xxx.xxx"] [uri "/xxxx-xxxxx-xxxxxxxx"] [unique_id "TJlve0CDUIUAAHyD6SMAAAAL"]
>
> A couple of previous posts suggest that this is hitting on a Google Analytics cookie (REQUEST_COOKIES:__utmz) that tracks where the user came from. It only seems to affect a few users. I've commented out the rule, and that fixed the immediate problem, but of course I would rather create a narrow exemption and leave the rule intact otherwise.
>
> How would I do that? FWIW, this is a cPanel VPS so the exceptions have to go in an unusual place (e.g. /usr/local/apache/conf/userdata/std/2/etc/etc/etc) but I can handle that part. It's how to write the rule that confuses me.
>
> Here's the rule as it stands now:
>
> SecRule REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES \
>     "(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))" \
>     "phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System Command Injection',id:'959006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
>
> I probably should add that I'm functionally regex-illiterate, so please speak slowly :)
>
> rac
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> <mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
> <https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set




--
============================================
Russell Clemings
<<mailto:russell at clemings.com>russell at clemings.com<mailto:russell at clemings.com>>
National Association of Science Writers cybrarian:
<<mailto:cybrarian at nasw.org>cybrarian at nasw.org<mailto:cybrarian at nasw.org>>
============================================


From rclemings at gmail.com  Wed Sep 22 20:28:54 2010
From: rclemings at gmail.com (Russell Clemings)
Date: Wed, 22 Sep 2010 17:28:54 -0700
Subject: [Owasp-modsecurity-core-rule-set] false positive on 959006
In-Reply-To: <574A77A5-A649-44E1-A65C-BAB21ABFA312@trustwave.com>
References: <AANLkTimvJEi=Vkd0ysWK6d31K7MtYFYrwxnm83pkupK4@mail.gmail.com>
	<003CAA36-AD7F-4C61-AF64-922AF4272AA0@trustwave.com>
	<AANLkTimJAMqmxiMR57G6bNU49G7eX+KmdmciKhd_OvBN@mail.gmail.com>
	<574A77A5-A649-44E1-A65C-BAB21ABFA312@trustwave.com>
Message-ID: <AANLkTinRrYesWVjt5tK4-Rk-+vy1aBPgkzOYNZDZTT3d@mail.gmail.com>

So they do, sorry. I don't see anything else with that ID except the
SecAction line. Here's the whole section in case it clarifies.

# Command injection
SecRule ARGS "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm
finger tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe
/ftp ls tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl
passwd wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm
/ls nc.exe id /chmod /nc /g++ /id /chown cmd /nmap chsh /gcc net.exe /python
/lsof ftp.exe ftp xterm mail /mail tracert nmap rm cd chmod cpp telnet
cmd32.exe gcc g++" \
        "phase:2,t:none,t:htmlEntityDecode,t:lowercase,pass,nolog,skip:1"
SecAction phase:2,pass,nolog,skipAfter:950006
SecRule ARGS
"(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))"
\

"phase:2,capture,t:none,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'950006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
SecRule
REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES
\
        "@pm uname wguest.exe /perl /nasm rcmd.exe nc tclsh /xterm finger
tftp chown /echo nmap.exe ping /passwd /chsh ps /uname telnet.exe /ftp ls
tclsh8 lsof /ping echo cmd.exe /kill python traceroute /ps perl passwd
wsh.exe /rm /cpp chgrp /telnet localgroup kill /chgrp /finger nasm /ls
nc.exe id /chmod /nc /g++ /id /chown cmd /nmap chsh /gcc net.exe /python
/lsof ftp.exe ftp xterm mail /mail tracert nmap rm cd chmod cpp telnet
cmd32.exe gcc g++" \

"phase:2,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,pass,nolog,skip:1"
SecAction pass,nolog,skipAfter:959006
SecRule
REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES
\

"(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))"
\

"phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'959006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
SecRule ARGS \
        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \

"phase:2,capture,t:none,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'950907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
SecRule
"REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs|User-Agent)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES"
\
        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \

"phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
Command
Injection',id:'959907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"


On Wed, Sep 22, 2010 at 5:18 PM, Ryan Barnett <RBarnett at trustwave.com>wrote:

> Those have different rule id's vs the alert you showed -  [id "959006"]
>
> Sent from my iPhone
>
> On Sep 22, 2010, at 8:12 PM, "Russell Clemings" <rclemings at gmail.com
> <mailto:rclemings at gmail.com>> wrote:
>
> It's whatever cPanel supplies by default. Maybe that's part of the problem.
>
> On the ARGS, I just stopped copying too soon. I think this is it:
>
> SecRule ARGS \
>        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \
>
>  "phase:2,capture,t:none,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
> Command
> Injection',id:'950907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
> SecRule
> "REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs|User-Agent)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES"
> \
>        "(?:(?:[\;\|\`]\W*?\bcc|\bwget)\b|\/cc(?:[\'\"\|\;\`\-\s]|$))" \
>
>  "phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
> Command
> Injection',id:'959907',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
>
>
>
> On Wed, Sep 22, 2010 at 5:06 PM, Ryan Barnett <<mailto:
> RBarnett at trustwave.com>RBarnett at trustwave.com<mailto:
> RBarnett at trustwave.com>> wrote:
> Rus,
> What CRS version are you using?  This looks old as the newer versions are
> listed in the alert using the rev action.  Also i believe the variable
> listing/targets for this rule were updated as it is missing ARGS.
>
> Sent from my iPhone
>
> On Sep 22, 2010, at 7:56 PM, "Russell Clemings" <<mailto:
> rclemings at gmail.com>rclemings at gmail.com<mailto:rclemings at gmail.com>>
> wrote:
>
> > I could use some help dealing with the following false positive (some
> identifying details masked):
> >
> > 116818:[Tue Sep 21 22:52:43 2010] [error] [client XX.XX.XX.XX]
> ModSecurity: Access denied with code 501 (phase 2). Pattern match
> "(?:\\b(?:(?:n(?:et(?:\\b\\W+?\\blocalgroup|\\.exe)|(?:map|c)\\.exe)|t(?:racer(?:oute|t)|elnet\\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\\.exe|echo\\b\\W*?\\by+)\\b|c(?:md(?:(?:32)?\\.exe\\b|\\b\\W*?\\/c)|d(?:\\b\\W*?[\\\\/]|\\W*?\\.\\.)|hmod.{0,40}?\\+.{0,3}x))|[\\;\\|\\`]\\W*?
> ..." at REQUEST_COOKIES:__utmz. [file
> "/usr/local/apache/conf/modsec2.user.conf"] [line "149"] [id "959006"] [msg
> "System Command Injection"] [data "/mail"] [severity "CRITICAL"] [tag
> "WEB_ATTACK/COMMAND_INJECTION"] [hostname "xxx.xxx.xxx"] [uri
> "/xxxx-xxxxx-xxxxxxxx"] [unique_id "TJlve0CDUIUAAHyD6SMAAAAL"]
> >
> > A couple of previous posts suggest that this is hitting on a Google
> Analytics cookie (REQUEST_COOKIES:__utmz) that tracks where the user came
> from. It only seems to affect a few users. I've commented out the rule, and
> that fixed the immediate problem, but of course I would rather create a
> narrow exemption and leave the rule intact otherwise.
> >
> > How would I do that? FWIW, this is a cPanel VPS so the exceptions have to
> go in an unusual place (e.g.
> /usr/local/apache/conf/userdata/std/2/etc/etc/etc) but I can handle that
> part. It's how to write the rule that confuses me.
> >
> > Here's the rule as it stands now:
> >
> > SecRule
> REQUEST_HEADERS|XML:/*|!REQUEST_HEADERS:'/^(Cookie|Referer|X-OS-Prefs)$/'|REQUEST_COOKIES|REQUEST_COOKIES_NAMES
> \
> >
> "(?:\b(?:(?:n(?:et(?:\b\W+?\blocalgroup|\.exe)|(?:map|c)\.exe)|t(?:racer(?:oute|t)|elnet\.exe|clsh8?|ftp)|(?:w(?:guest|sh)|rcmd|ftp)\.exe|echo\b\W*?\by+)\b|c(?:md(?:(?:32)?\.exe\b|\b\W*?\/c)|d(?:\b\W*?[\\\/]|\W*?\.\.)|hmod.{0,40}?\+.{0,3}x))|[\;\|\`]\W*?\b(?:(?:c(?:h(?:grp|mod|own|sh)|md|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)\b|g(?:\+\+|cc\b))|\/(?:c(?:h(?:grp|mod|own|sh)|pp)|p(?:asswd|ython|erl|ing|s)|n(?:asm|map|c)|f(?:inger|tp)|(?:kil|mai)l|g(?:\+\+|cc)|(?:xte)?rm|ls(?:of)?|telnet|uname|echo|id)(?:[\'\"\|\;\`\-\s]|$))"
> \
> >
> "phase:2,capture,t:none,t:urlDecodeUni,t:htmlEntityDecode,t:lowercase,ctl:auditLogParts=+E,deny,log,auditlog,status:501,msg:'System
> Command
> Injection',id:'959006',tag:'WEB_ATTACK/COMMAND_INJECTION',logdata:'%{TX.0}',severity:'2'"
> >
> > I probably should add that I'm functionally regex-illiterate, so please
> speak slowly :)
> >
> > rac
> >
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > <mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
> Owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:
> Owasp-modsecurity-core-rule-set at lists.owasp.org>
> > <
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20100922/45f2fa46/attachment.html 

From RBarnett at trustwave.com  Tue Sep 28 14:24:53 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Tue, 28 Sep 2010 13:24:53 -0500
Subject: [Owasp-modsecurity-core-rule-set] Advanced Topic of the Week: XSS
	Defense via Content Injection
Message-ID: <C8C7AB35.1453E%rbarnett@trustwave.com>

New blog post this week to help fight XSS flaws -
http://blog.modsecurity.org/2010/09/advanced-topic-of-the-week-xss-defense-via-content-injection.html

I also setup a demo so you can see how it works and/or try and find evasions -
http://www.modsecurity.org/demo/demo-deny-noescape.html

This will most likely make it into a future version of the OWASP CRS in an experimental rules directory.

Cheers,
Ryan





From RBarnett at trustwave.com  Wed Sep 29 08:44:18 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Wed, 29 Sep 2010 07:44:18 -0500
Subject: [Owasp-modsecurity-core-rule-set] Only 2 days left for ModSecurity
	User Survey
Message-ID: <C8C8ACE2.145A1%rbarnett@trustwave.com>

If you have yet done so, please take a few minutes and fill out the ModSecurity User Survey - http://bit.ly/dr9aIU

We will be closing the survey Friday morning, Oct 1st.

Thanks,
Ryan




From RBarnett at trustwave.com  Thu Sep 30 10:24:44 2010
From: RBarnett at trustwave.com (Ryan Barnett)
Date: Thu, 30 Sep 2010 09:24:44 -0500
Subject: [Owasp-modsecurity-core-rule-set] Only 2 days left for
	ModSecurity User Survey
In-Reply-To: <C8C8ACE2.145A1%rbarnett@trustwave.com>
Message-ID: <C8CA15EC.1465F%rbarnett@trustwave.com>

Last day for the ModSecurity User Survey - http://bit.ly/dr9aIU

Speak up now so you can help drive the ModSecurity roadmap!

-Ryan


