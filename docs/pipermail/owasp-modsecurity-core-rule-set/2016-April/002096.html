<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Is%20it%20possible%20to%20use%0A%20modsecurity%20rules%20to%20prevent%20logins%20by%20specific%20user%20accounts%3F&In-Reply-To=%3C20160405045755.GA16512%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002107.html">
   <LINK REL="Next"  HREF="002101.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Is%20it%20possible%20to%20use%0A%20modsecurity%20rules%20to%20prevent%20logins%20by%20specific%20user%20accounts%3F&In-Reply-To=%3C20160405045755.GA16512%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?">christian.folini at netnea.com
       </A><BR>
    <I>Tue Apr  5 04:57:55 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002107.html">[Owasp-modsecurity-core-rule-set] How to generate graphs of	modsecurity?
</A></li>
        <LI>Next message: <A HREF="002101.html">[Owasp-modsecurity-core-rule-set] XSS payload from Reddit used	against OWASP ModSecurity Core Rules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2096">[ date ]</a>
              <a href="thread.html#2096">[ thread ]</a>
              <a href="subject.html#2096">[ subject ]</a>
              <a href="author.html#2096">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Any luck, Gary?

Suggestions: 
- Try the debug log
- do this step by step. Step #1: Try the match the encoded Header value
  (the one with the username:password in base64)

Ahoj,

Christian


On Thu, Mar 31, 2016 at 04:33:09PM +0000, Chaim Sanders wrote:
&gt;<i> Hey Gary,
</I>&gt;<i> While I'm not sure what's going wrong with your rule I suggest you check out the debug log... it will usually contain valuable information to help you debug your issues :). Maybe someone else will be able to spot the issue.
</I>



&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Mansell, Gary [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Gary.Mansell at ricardo.com</A>]
</I>&gt;<i> Sent: Thursday, March 31, 2016 12:31 PM
</I>&gt;<i> To: Chaim Sanders &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> Subject: Re: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</I>&gt;<i> 
</I>&gt;<i> Is there no one who can help me further on this, as it seems exactly the sort of thing that modsecurity should be able to do (but I am struggling with)?
</I>&gt;<i> 
</I>&gt;<i> All of my Web Application admin accounts end in the string &quot;admin&quot;, and I would like to be able to use a modsecurity rule on the reverse proxy server in the DMZ to prevent any admin logins (as admins should only ever login directly via the internal apache server rather than the reverse proxy)?
</I>&gt;<i> 
</I>&gt;<i> It is my understanding that even though this is a https request, as this application uses basic authentication, every request via the reverse apache server includes a base64 encoded username and password in the authorisation header - I can't understand why I can't block this with a simple modsecurity rule.
</I>&gt;<i> 
</I>&gt;<i> The rule suggestion that I was sent by Chaim seems to make sense to me, but I just can't get it to work - it seems to be looking to deny any request with authorization Header containing the string &quot;admin:&quot;
</I>&gt;<i> 
</I>&gt;<i> SecRule REQUEST_HEADERS:Authorization &quot;@contains admin:&quot; &quot;id:1,t:base64Decode,deny,status:403&quot;
</I>&gt;<i> 
</I>&gt;<i> Can anyone help me on this - is there just a simple typo in the rule perhaps? Do I have to choose a unique ID value other than 1 (as I had the Owasp core rule set configured too)?
</I>&gt;<i> 
</I>&gt;<i> Rgds
</I>&gt;<i> 
</I>&gt;<i> Gary
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I have had a good crack at trying to get this to work, but to no avail, unfortunately.
</I>&gt;<i> 
</I>&gt;<i> SecRule REQUEST_HEADERS:Authorization &quot;@contains admin:&quot; &quot;id:1,t:base64Decode,deny,status:403&quot;
</I>&gt;<i> 
</I>&gt;<i> I tried changing the contains string to various things that may be relevant, but still no joy.
</I>&gt;<i> 
</I>&gt;<i> Is it perhaps because both the reverse proxy and the internal apache server are configured for https?
</I>&gt;<i> 
</I>&gt;<i> How do I tell whether my system is using base64 to encode the username in the header?
</I>&gt;<i> 
</I>&gt;<i> I have to say I am completely lost with this now, it seems like something that modsecurity should be able to do, but I don't know where to start with debugging, or testing this to get it to work?
</I>&gt;<i> 
</I>&gt;<i> Any ideas anyone?
</I>&gt;<i> 
</I>&gt;<i> Rgds
</I>&gt;<i> 
</I>&gt;<i> Gary
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Chaim Sanders [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">CSanders at trustwave.com</A>]
</I>&gt;<i> Sent: 14 March 2016 15:58
</I>&gt;<i> To: Mansell, Gary &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Gary.Mansell at ricardo.com</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</I>&gt;<i> 
</I>&gt;<i> Hey Gary,
</I>&gt;<i> This Is actually a great question and should be very easily possible. Typically Basic Authentication uses base64. So you could do something similar to the following (untested) SecRule REQUEST_HEADERS:Authorization &quot;@contains admin:&quot; &quot;id:1, t:base64Decode,deny,status:403'
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A> [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>] On Behalf Of Mansell, Gary
</I>&gt;<i> Sent: Monday, March 14, 2016 11:13 AM
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> Subject: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</I>&gt;<i> 
</I>&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I have an internal Web application that uses Apache Basic Authentication, checking user account logins against an internal LDAP Server for authentication.
</I>&gt;<i> 
</I>&gt;<i> I am now looking to present this Web Application to whitelisted IP's on the Internet, by means of a Reverse Proxy Apache Server in a DMZ with modsecurity enabled and one of the free rulesets to protect the application being abused. Both the Reverse Proxy and the Internal Apache server are configured for https only.
</I>&gt;<i> 
</I>&gt;<i> It occurs to me that Administrative users should never be able to login to the Web Application from the via the Reverse Proxy Apache server - I hence wonder if it is possible to use modsecurity on the Reverse Apache server to prevent specific Admin user accounts from logging in to the Web Application?
</I>&gt;<i> 
</I>&gt;<i> If so, please can someone point me in the direction of how I might achieve this?
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> 
</I>&gt;<i> Gary
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
</I>&gt;<i> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
</I>&gt;<i> &quot;Ricardo&quot; means Ricardo plc and its subsidiary companies.
</I>&gt;<i> Ricardo plc is a public limited company registered in England with registered number 00222915.
</I>&gt;<i> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set">http://scanmail.trustwave.com/?c=4062&amp;d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set</A>
</I>&gt;<i> 
</I>&gt;<i> ________________________________
</I>&gt;<i> 
</I>&gt;<i> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</I>&gt;<i> 
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
</I>&gt;<i> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
</I>&gt;<i> &quot;Ricardo&quot; means Ricardo plc and its subsidiary companies.
</I>&gt;<i> Ricardo plc is a public limited company registered in England with registered number 00222915.
</I>&gt;<i> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set">http://scanmail.trustwave.com/?c=4062&amp;d=wND91tX1TZq0UB15loWcH4RfFlxJe-IvfXYgFS8s2g&amp;s=5&amp;u=https%3a%2f%2flists%2eowasp%2eorg%2fmailman%2flistinfo%2fowasp-modsecurity-core-rule-set</A>
</I>&gt;<i> 
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> This e-mail and any files transmitted with it are confidential and intended solely for the use of the individual or entity to whom they are addressed. If you have received this e-mail in error please notify the sender immediately and delete this e-mail from your system.
</I>&gt;<i> Please note that any views or opinions presented in this e-mail are solely those of the author and do not necessarily represent those of Ricardo (save for reports and other documentation formally approved and signed for release to the intended recipient). Only Directors are authorised to enter into legally binding obligations on behalf of Ricardo. Ricardo may monitor outgoing and incoming e-mails and other telecommunications systems. By replying to this e-mail you give consent to such monitoring. The recipient should check e-mail and any attachments for the presence of viruses. Ricardo accepts no liability for any damage caused by any virus transmitted by this e-mail.
</I>&gt;<i> &quot;Ricardo&quot; means Ricardo plc and its subsidiary companies.
</I>&gt;<i> Ricardo plc is a public limited company registered in England with registered number 00222915.
</I>&gt;<i> The registered office of Ricardo plc is Shoreham Technical Centre, Shoreham-by Sea, West Sussex, BN43 5FG.
</I>&gt;<i> --------------------------------------------------------------------------------------------------------------------------------------------------------------
</I>&gt;<i> 
</I>&gt;<i> ________________________________
</I>&gt;<i> 
</I>&gt;<i> This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
-- 
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
<A HREF="http://www.christian-folini.ch">http://www.christian-folini.ch</A>
twitter: @ChrFolini
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002107.html">[Owasp-modsecurity-core-rule-set] How to generate graphs of	modsecurity?
</A></li>
	<LI>Next message: <A HREF="002101.html">[Owasp-modsecurity-core-rule-set] XSS payload from Reddit used	against OWASP ModSecurity Core Rules
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2096">[ date ]</a>
              <a href="thread.html#2096">[ thread ]</a>
              <a href="subject.html#2096">[ subject ]</a>
              <a href="author.html#2096">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
