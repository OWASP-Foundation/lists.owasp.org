<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Is%20it%20possible%20to%20use%0A%20modsecurity%20rules%20to%20prevent%20logins%20by%20specific%20user%20accounts%3F&In-Reply-To=%3CD336571E.1C592%25csanders%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002104.html">
   <LINK REL="Next"  HREF="002106.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Is%20it%20possible%20to%20use%0A%20modsecurity%20rules%20to%20prevent%20logins%20by%20specific%20user%20accounts%3F&In-Reply-To=%3CD336571E.1C592%25csanders%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?">CSanders at trustwave.com
       </A><BR>
    <I>Fri Apr 15 12:31:53 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002104.html">[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</A></li>
        <LI>Next message: <A HREF="002106.html">[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2105">[ date ]</a>
              <a href="thread.html#2105">[ thread ]</a>
              <a href="subject.html#2105">[ subject ]</a>
              <a href="author.html#2105">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>You know, I should have thought about this to begin with but that makes perfect sense - Barry, good eye! There is an open ticket right now for indicating when there is a base64 decoding issue, this will be included within ModSecurityv3. Generally spaces are not valid Base64 chars and would have resulted in such a fix firing and saved us all a little bit of headache.
--
Chaim Sanders
Security Researcher

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;


From: Barry Pollard &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">barry_pollard at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">barry_pollard at hotmail.com</A>&gt;&gt;
Date: Friday, April 15, 2016 at 8:29 AM
To: &quot;Mansell, Gary&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gary.mansell at ricardo.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">gary.mansell at ricardo.com</A>&gt;&gt;, Chaim Sanders &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&gt;&gt;, &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?

OK so the audit log shows shows this in your header:

   Authorization: Basic Z3JtYXdjYWRtaW46dGVzdA==

The value of the Authorization header is therefore &quot;Basic Z3JtYXdjYWRtaW46dGVzdA==&quot; which cannot be base64 decoded due to that initial &quot;Basic &quot; part which is not Base 64 encoded. This is what you are supposed to send so nothing wrong with your header, but it explains why your rule is not working as ModSecurity does not know you only want to base64 decode part of the header.

So you need to write a chained rule to capture the actual base64 encoded part using backets and &quot;capture&quot; and then base 64 decode the TX:1 variable which is captured:

SecRule &quot;REQUEST_HEADERS:Authorization&quot; &quot;^Basic (.*)$&quot; &quot;phase:1,id:1003,log,capture,chain,deny,status:403&quot;
        SecRule TX:1 &quot;@contains admin&quot; &quot;t:base64Decode&quot;

I've tested this and it seems to work.

Thanks,
Barry


&gt;<i> From: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Gary.Mansell at ricardo.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Gary.Mansell at ricardo.com</A>&gt;
</I>&gt;<i> To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">barry_pollard at hotmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">barry_pollard at hotmail.com</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">csanders at trustwave.com</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
</I>&gt;<i> Subject: RE: [Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</I>&gt;<i> Date: Fri, 15 Apr 2016 10:37:16 +0000
</I>&gt;<i>
</I>&gt;<i> I added the rule, cleared the logs and logged in again with the grmawcadmin user
</I>&gt;<i>
</I>&gt;<i> Here are the updated logs as requested.
</I>&gt;<i>
</I>

________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160415/43cdb50f/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160415/43cdb50f/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002104.html">[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</A></li>
	<LI>Next message: <A HREF="002106.html">[Owasp-modsecurity-core-rule-set] Is it possible to use modsecurity rules to prevent logins by specific user accounts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2105">[ date ]</a>
              <a href="thread.html#2105">[ thread ]</a>
              <a href="subject.html#2105">[ subject ]</a>
              <a href="author.html#2105">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
