From ryan.barnett at breach.com  Fri Jul 31 15:33:10 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 31 Jul 2009 15:33:10 -0400
Subject: [Owasp-modsecurity-core-rule-set] Release of OWASP ModSecurity Core
	Rule Set (CRS) v2.0.0
Message-ID: <200907311533.10841.ryan.barnett@breach.com>

Greetings everyone,
We have some big news/changes with regards to the Core Rule Set (CRS).  Please 
follow the information here to make sure that you understand the changes 
moving forward.

1) New Home for CRS
The Core Rule Set is now an official OWASP Project!  Here is the new project 
site - 
http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project.  

This is the new home of the CRS.  The main goal of moving the CRS to OWASP is 
to better facilitate documentation and development of the rules.  As you know, 
the OWASP pages are wiki-based so you all can go in there and help to document 
them :)  I will add some example template pages soon to help get the ball 
rolling however my thinking is that we should emulate what Snort Sigs DB used 
to do and document the goal of each group of rules, what are they looking for, 
how are they looking for it and any false positive/exception fixes, etc...

Here is the new Download link page -
http://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project#tab=Download

2) Changes to the CRS
The latest version of the CRS is v2.0.0 and there are significant changes.  The 
most important ones are related to running in an anomaly scoring mode which 
allows the rules to collaborate to an overall anomaly score.  This will allow 
users to set appropriate thresholds for their sites for logging/blocking.  
There are too many other changes to mention directly here so please review the 
CHANGELOG file - http://voxel.dl.sourceforge.net/project/mod-
security/modsecurity-crs/0-CURRENT/CHANGELOG

3) Rule Update Tracking for the CRS
While the new OWASP project site will mainly be used for documentation 
purposes, all CRS rule issues will be tracked by using our Jira app - 
https://www.modsecurity.org/tracker/.  We want to track all bugs, false 
positives and false negatives (if there are any bypass evasion issues that you 
find), etc...

We are very excited about this new momentum for the CRS and we look forward to 
a more collaborative exchange with the community!

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com/


-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/f3662e9a/attachment.html 

From ryan.barnett at breach.com  Fri Jul 31 17:07:53 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 31 Jul 2009 17:07:53 -0400
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] Help
	formatting XSS block
In-Reply-To: <200907210841.24644.ryan.barnett@breach.com>
References: <cd66d4790907202120x255874e0m752e28f34fb4b674@mail.gmail.com>
	<200907210841.24644.ryan.barnett@breach.com>
Message-ID: <200907311707.53341.ryan.barnett@breach.com>

Please excuse the cross-postings but I want to jumpstart moving these types of 
Mod rules discussions over to the OWASP list.

Just a follow-up - the new CRS 2.0.0 has significant updates for XSS 
protections.  Specifically, the Ha.ckers XSS Cheatsheet 
(http://ha.ckers.org/xss.html) was reviewed and rules were updated to reflect 
the different vectors.  Additionally, the WASC Script Mapping Project 
(http://projects.webappsec.org/Script-Mapping) was reviewed and all html event 
handlers were included.

As a side note - at the Blac

-- 
Ryan C. Barnett
WASC Distributed Open Proxy Honeypot Project Leader
OWASP ModSecurity Core Rule Set Project Leader
Tactical Web Application Security
http://tacticalwebappsec.blogspot.com


On Tuesday 21 July 2009 08:41:24 am Ryan Barnett wrote:
> On Tuesday 21 July 2009 12:20:34 am Bill Bradley wrote:
> > Bill Bradley
> >  to mod-security-u.
> >
> > show details 11:24 AM (11 hours ago)
> >
> >
> > Reply
> >
> >         Follow up message
> > Hey All,
> >
> > I am new to modsecurity
>
> Hey Bill, welcome aboard!
>
> > but have implemented the
> > modsecurity_crs_40_generic_attacks.conf from the optional_rules
> > directory to block and log XSS scripting.  So far it is working great.
>
> The current Core Rule Set (CRS) does a decent job against most attack
> payload classes (including XSS) but as you found out, they are not perfect.
>  The only way that they will get better is if users report these
> bypass/evasion issues. So thank you for reporting this issue.  By the way -
> we have an official JIRA ticketing system so you can report issues there
> and it will be properly tracked to resolution -
> https://www.modsecurity.org/tracker/
>
> Also of note - we will be releasing CRS version 2.0 within the week which
> will include significant updates to the rules including a separate rule set
> just for XSS.
>
> > The app is being tested by penetration folks and they are still able
> > to pass on XSS attack:
> >
> >
> > XSS vulnerability found in backend parameter. The following attack
> > targets all browser(s) and was successful using plain
> > encoding:
> > "><iMg SrC=x OnErRoR=window.location=42114>
>
> If you look in the modsecurity_crs_40_generic_attacks.conf file, you will
> see the XSS section.  It starts off with the set-based pattern matching
> pre- qualifiers where it is looking for any core keywords for the attack
> class -
>
> SecRule REQUEST_FILENAME|ARGS|ARGS_NAMES|REQUEST_HEADERS|
> XML:/*|!REQUEST_HEADERS:Referer "@pm jscript onsubmit copyparentfolder
> javas cript meta onchange onmove onkeydown onkeyup activexobject onmouseup
> ecmascript bexpression onmouseover vbscript: <![cdata[ http: .innerhtml
> settimeout shell: onabort asfunction: onkeypress onmousedown onclick
> .fromcharcode background-image: .cookie ondragdrop onblur x-javascript
> mocha: javascript: onfocus lowsrc getparentfolder onresize @import alert
> script onselect onmouseout application onmousemove background .execscript
> livescript: vbscript getspecialfolder .addimport iframe onunload
> createtextrange <input onload"
>
> In looking at these keywords, there are other browser/DOM actions such as
> onblur, onfocus, onmousemove, etc...  but it doesn't appear that we have
> one for your example payload - onerror.  So, I would go ahead and add the
> following rule to a modsecurity_crs_15_customrules.conf file -
>
> SecRule REQUEST_FILENAME|ARGS|ARGS_NAMES "\bonerror\b\W*?\=" \
>        
> "phase:2,deny,capture,t:none,t:htmlEntityDecode,t:compressWhiteSpace,t:lowe
>rcase,ctl:auditLogParts=+E,log,auditlog,msg:'Cross- site Scripting (XSS)
> Attack',id:'1',tag:'WEB_ATTACK/XSS',logdata:'%{TX.0}',severity:'2'"
>
> I tested this new rule against the following example request -
>
> http://www.example.com/cgi-bin/test-cgi?foo="><iMg SrC=x
> OnErRoR=window.location=42114>
>
> The rule triggered appropriately and generated the following alert in the
> Apache error_log file -
>
> [Sun May 31 02:25:14 2009] [error] [client 192.168.1.103] ModSecurity:
> Access denied with code 403 (phase 2). Pattern match
> "\\bonerror\\b\\W*?\\=" at ARGS:foo. [file
> "/usr/local/apache/conf/enhanced_rule_set-1.7.0/base_rules/modsecurity_ers_
>15_customrules.conf"] [line "2"] [id "958409"] [msg "Cross-site Scripting
> (XSS) Attack"] [data "onerror="] [severity "CRITICAL"] [tag
> "WEB_ATTACK/XSS"] [hostname "www.example.com"] [uri "/cgi-bin/test-cgi"]
> [unique_id "SiIiyn8AAQEAABGXB- QAAAAA"]
>
> Hope this info helps,
> Ryan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/36dbe3bc/attachment.html 

From ryan.barnett at breach.com  Fri Jul 31 17:26:26 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 31 Jul 2009 17:26:26 -0400
Subject: [Owasp-modsecurity-core-rule-set] [mod-security-users] Help
	formatting XSS block
In-Reply-To: <200907311707.53341.ryan.barnett@breach.com>
References: <cd66d4790907202120x255874e0m752e28f34fb4b674@mail.gmail.com>
	<200907210841.24644.ryan.barnett@breach.com>
	<200907311707.53341.ryan.barnett@breach.com>
Message-ID: <200907311726.27095.ryan.barnett@breach.com>

On Friday 31 July 2009 05:07:53 pm Ryan Barnett wrote:
> Please excuse the cross-postings but I want to jumpstart moving these types
> of Mod rules discussions over to the OWASP list.
>
> Just a follow-up - the new CRS 2.0.0 has significant updates for XSS
> protections.  Specifically, the Ha.ckers XSS Cheatsheet
> (http://ha.ckers.org/xss.html) was reviewed and rules were updated to
> reflect the different vectors.  Additionally, the WASC Script Mapping
> Project (http://projects.webappsec.org/Script-Mapping) was reviewed and all
> html event handlers were included.
>
> As a side note - at the Blac

Had a slight misfire there...  

Anyways, at Blackhat this week, there was a great presentation on bypassing 
XSS filters - http://p42.us/favxss.  In the preso they showed many ways to 
bypass the CRS v1.6.1 rules.  Many of the deficiencies that they highlighted 
have been addressed (above) and we are going to be adding an XSS testing page 
soon to the modsecurity site so the community can bang on them and hopefully 
they will become stronger.  This is what PHP-IDS has been doing here - 
http://demo.php-ids.org/ - and it has been very helpful.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/0a8e1837/attachment-0001.html 

From ryan.barnett at breach.com  Fri Jul 31 17:42:55 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 31 Jul 2009 17:42:55 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-1) modsec-clamscan.pl is no longer distributed
	with ModSecurity
Message-ID: <200907311742.55254.ryan.barnett@breach.com>

----------  Forwarded Message  ----------

Subject: [JIRA] Resolved: (CORERULES-1) modsec-clamscan.pl is no longer 
distributed with ModSecurity
Date: Friday 31 July 2009
From: "Ryan Barnett (JIRA)" <modsecurity at tracker.modsecurity.org>
To: Ryan Barnett <Ryan.Barnett at breach.com>


     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-1?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-1.
----------------------------------

       Resolution: Fixed
    Fix Version/s:     (was: 1.6.2)
                   2.0.0

We have put the clamscan script back in the CRS release under the /util dir.

> modsec-clamscan.pl is no longer distributed with ModSecurity
> ------------------------------------------------------------
>
>                 Key: CORERULES-1
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-1
>             Project: Core Rules
>          Issue Type: Improvement
>      Security Level: Normal
>    Affects Versions: 1.6.1
>            Reporter: Brian Rectanus
>            Assignee: Ryan Barnett
>            Priority: Low
>             Fix For: 2.0.0
>
>
> modsecurity_crs_10_config.conf
> This file mentions the following, but this is a ModSecurity 1.9.x utility:
> {noformat}
> # Inspect uploaded files.
> #
> # TODO If there is a danger of attack through uploaded files then it
> #      is possible to configure an external script to inspect each file
> #      before it is seen by the application. An example script is
> #      included with ModSecurity (/util/modsec-clamscan.pl).
> #
> #      Inspecting uploaded files is especially important in a hosting,
> #      community or blogging environments where uploading files is permitted.
> {noformat}

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/5b5bce7b/attachment.html 

From ryan.barnett at breach.com  Fri Jul 31 17:47:44 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 31 Jul 2009 17:47:44 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-8) Filter Bypass Vulnerability
Message-ID: <200907311747.44310.ryan.barnett@breach.com>

----------  Forwarded Message  ----------

Subject: [JIRA] Resolved: (CORERULES-8) Filter Bypass Vulnerability
Date: Friday 31 July 2009
From: "Ryan Barnett (JIRA)" <modsecurity at tracker.modsecurity.org>
To: Ryan Barnett <Ryan.Barnett at breach.com>


     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-8?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-8.
----------------------------------

       Resolution: Fixed
    Fix Version/s:     (was: 1.7.0)
                   2.0.0

We added this HTTP Parameter Pollution (HPP) rule to the CRS v.2.0.0.

> Filter Bypass Vulnerability
> ---------------------------
>
>                 Key: CORERULES-8
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-8
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>    Affects Versions: 1.6.1
>            Reporter: Samiux AU
>            Assignee: Ryan Barnett
>             Fix For: 2.0.0
>
>
> Details please refer to this link.
> http://www.milw0rm.com/exploits/8930

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/cbcc4d59/attachment.html 

From ryan.barnett at breach.com  Fri Jul 31 18:10:43 2009
From: ryan.barnett at breach.com (Ryan Barnett)
Date: Fri, 31 Jul 2009 18:10:43 -0400
Subject: [Owasp-modsecurity-core-rule-set] Fwd: [JIRA] Resolved:
	(CORERULES-6) Some core rules files have not been upgraded to
	use the SecDefaultAction given in file 10
Message-ID: <200907311810.43174.ryan.barnett@breach.com>

----------  Forwarded Message  ----------

Subject: [JIRA] Resolved: (CORERULES-6) Some core rules files have not been 
upgraded to use the SecDefaultAction given in file 10
Date: Friday 31 July 2009
From: "Ryan Barnett (JIRA)" <modsecurity at tracker.modsecurity.org>
To: Ryan Barnett <Ryan.Barnett at breach.com>


     [ 
https://www.modsecurity.org/tracker/browse/CORERULES-6?page=com.atlassian.jira.plugin.system.issuetabpanels:all-
tabpanel ]

Ryan Barnett resolved CORERULES-6.
----------------------------------

       Resolution: Fixed
    Fix Version/s:     (was: 1.6.2)
                   2.0.0

The new CRS v2.0.0 now uses the block action within rules so that they will 
defer to the SecDefaultAction setting.

> Some core rules files have not been upgraded to use the SecDefaultAction 
given in file 10
> 
-----------------------------------------------------------------------------------------
>
>                 Key: CORERULES-6
>                 URL: https://www.modsecurity.org/tracker/browse/CORERULES-6
>             Project: Core Rules
>          Issue Type: Bug
>      Security Level: Normal
>    Affects Versions: 1.6.1
>         Environment: modsecurity 2.5.9  -- Core Rule Set ver. 1.6.1
>            Reporter: john smith
>            Assignee: Ryan Barnett
>             Fix For: 2.0.0
>
>
> Earlier rules files had a SecDefaultAction in each file which set pass as the 
default action.  In 1.6.1, the only SecDefaultAction is in  _crs_10_config 
which (as in earlier rule sets) sets deny as the default action.   Several 
rules still depend on the assumption that pass is the default although this is 
no loger the case.
> This also effectively eliminates the difference between main rule set and the 
"optional" rule set.
> Although several rules in several files are affected, a specifi example would 
be all the rules in _crs_55_marketing.conf, which without modification of the 
rules or addition of a SecDefaultAction to set pass, have the effect of denying 
the major search engine crawlers.
> Several examples in the documentation also seem to implicitly assume that 
'pass' is the default action even though this is no loger the case.

--
This message is automatically generated by JIRA.
-
If you think it was sent incorrectly contact one of the administrators: 
https://www.modsecurity.org/tracker/secure/Administrators.jspa
-
For more information on JIRA, see: http://www.atlassian.com/software/jira



-------------------------------------------------------
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20090731/150aa2fc/attachment.html 

