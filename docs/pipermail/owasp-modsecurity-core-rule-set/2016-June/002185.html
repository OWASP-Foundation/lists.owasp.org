<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Rule 958291 (byte-range request begins with 0-) really correct?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20958291%20%28byte-range%0A%20request%20begins%20with%200-%29%20really%20correct%3F&In-Reply-To=%3C20160629104601.GA22596%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002184.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Rule 958291 (byte-range request begins with 0-) really correct?</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Rule%20958291%20%28byte-range%0A%20request%20begins%20with%200-%29%20really%20correct%3F&In-Reply-To=%3C20160629104601.GA22596%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Rule 958291 (byte-range request begins with 0-) really correct?">christian.folini at netnea.com
       </A><BR>
    <I>Wed Jun 29 10:46:01 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002184.html">[Owasp-modsecurity-core-rule-set] Rule 958291 (byte-range request	begins with 0-) really correct?
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2185">[ date ]</a>
              <a href="thread.html#2185">[ thread ]</a>
              <a href="subject.html#2185">[ subject ]</a>
              <a href="author.html#2185">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Jens,

Thank you for reporting this. I agree with you, that the operator
parameter in the said rule  (bytes=0-) is bogus:

SecRule REQUEST_HEADERS:Range &quot;@beginsWith bytes=0-&quot; \
&quot;phase:2,rev:'2',ver:'OWASP_CRS/2.2.9',maturity:'6',accuracy:'8',\
t:none,block,msg:'Range: field exists and begins with\
0.',logdata:'%{matched_var}',severity:'4',id:'958291',...

However, the msg action seems to support the way it is written
and the comment above the rule starting with paragraph 1 confirms this:

# 1. Range Header exists and begins with 0 - normal browsers don't do this.
# Automated programs and bots often do not obey the HTTP RFC

However, normal browsers do this all the time. Hence the
false positives everybody is seeing on requests downloading big
files.

I usually tune the rule away completely. I guess you are aware that
outcommenting is a bad way of handling a false positive. The preferred
way in this case is probably:

SecRuleRemoveById 958291

Now looking forward, this rule has been removed for the 3.0 release,
so the false positive problem will be gone in the future. It is
unclear if a new release in the 2.2.X range will be released.
Unlikely actually.

Summing it up: Yes, the way the rule is written right now, brings
false positives like mad. It blocks a behaviour the browsers
use. It is a bad rule. It's gone for good.

Cheers,

Christian

P.S. Nice catch on the apache configure script problem on httpd-dev!



On Wed, Jun 29, 2016 at 12:00:56PM +0200, Jens Schleusener wrote:
&gt;<i> after downloading
</I>&gt;<i> SpiderLabs-owasp-modsecurity-crs-2.2.9-30-g520a94b.tar.gz I just
</I>&gt;<i> compared the changed rules with that used on &quot;my&quot; server. One rule
</I>&gt;<i> that I have outcommented but that still exists unchanged is rule
</I>&gt;<i> 958291 in base_rules/modsecurity_crs_20_protocol_violations.conf.
</I>&gt;<i> 
</I>&gt;<i> That rule is commented with
</I>&gt;<i> 
</I>&gt;<i>  # 1. Range Header exists and begins with 0 - normal browsers don't do this.
</I>&gt;<i>  # Automated programs and bots often do not obey the HTTP RFC
</I>&gt;<i>  #
</I>&gt;<i>  # -=[ Rule Logic ]=-
</I>&gt;<i>  # This rule inspects the Range request header to see if it starts with 0.
</I>&gt;<i>  #
</I>&gt;<i>  # -=[ References ]=-
</I>&gt;<i>  # <A HREF="http://www.bad-behavior.ioerror.us/documentation/how-it-works/">http://www.bad-behavior.ioerror.us/documentation/how-it-works/</A>
</I>&gt;<i> 
</I>&gt;<i> But that I am not really understanding since at least
</I>&gt;<i>  <A HREF="https://tools.ietf.org/html/rfc7233">https://tools.ietf.org/html/rfc7233</A>
</I>&gt;<i> seems to allow it:
</I>&gt;<i> 
</I>&gt;<i>  2.1.  Byte Ranges
</I>&gt;<i>        [...]
</I>&gt;<i>        Examples of byte-ranges-specifier values:
</I>&gt;<i>         o  The first 500 bytes (byte offsets 0-499, inclusive):
</I>&gt;<i>             bytes=0-499
</I>&gt;<i> 
</I>&gt;<i> Maybe a pure &quot;bytes=0-&quot; is meant but the rule seems to match also
</I>&gt;<i> &quot;bytes=0-last-byte-pos&quot;.
</I>&gt;<i> 
</I>&gt;<i> Additionally the referenced URL
</I>&gt;<i>  <A HREF="http://www.bad-behavior.ioerror.us/documentation/how-it-works/">http://www.bad-behavior.ioerror.us/documentation/how-it-works/</A>
</I>&gt;<i> is not (or no longer) existent.
</I>&gt;<i> 
</I>&gt;<i> Regards
</I>&gt;<i> 
</I>&gt;<i> Jens
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-modsecurity-core-rule-set mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>
</I>
-- 
ModSecurity Training in London: Sep 22/23, 2016
<A HREF="https://www.feistyduck.com/training/modsecurity-training-course">https://www.feistyduck.com/training/modsecurity-training-course</A>
mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">christian.folini at netnea.com</A>
twitter: @ChrFolini
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002184.html">[Owasp-modsecurity-core-rule-set] Rule 958291 (byte-range request	begins with 0-) really correct?
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2185">[ date ]</a>
              <a href="thread.html#2185">[ thread ]</a>
              <a href="subject.html#2185">[ subject ]</a>
              <a href="author.html#2185">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
