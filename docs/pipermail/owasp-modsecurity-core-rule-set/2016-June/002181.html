<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] rule 920350 - &quot;host header is a numeric ip address&quot; - redirect loop using default 3.0.0 conf
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20rule%20920350%20-%20%22host%20header%20is%0A%20a%20numeric%20ip%20address%22%20-%20redirect%20loop%20using%20default%203.0.0%20conf&In-Reply-To=%3CD37AF893.1D1CF%25csanders%40trustwave.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002180.html">
   <LINK REL="Next"  HREF="002182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] rule 920350 - &quot;host header is a numeric ip address&quot; - redirect loop using default 3.0.0 conf</H1>
    <B>Chaim Sanders</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20rule%20920350%20-%20%22host%20header%20is%0A%20a%20numeric%20ip%20address%22%20-%20redirect%20loop%20using%20default%203.0.0%20conf&In-Reply-To=%3CD37AF893.1D1CF%25csanders%40trustwave.com%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] rule 920350 - &quot;host header is a numeric ip address&quot; - redirect loop using default 3.0.0 conf">CSanders at trustwave.com
       </A><BR>
    <I>Mon Jun  6 13:56:11 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002180.html">[Owasp-modsecurity-core-rule-set] rule 920350 - &quot;host header is a numeric ip address&quot; - redirect loop using default 3.0.0 conf
</A></li>
        <LI>Next message: <A HREF="002182.html">[Owasp-modsecurity-core-rule-set] ModSecurity Job in Cologne Germany
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2181">[ date ]</a>
              <a href="thread.html#2181">[ thread ]</a>
              <a href="subject.html#2181">[ subject ]</a>
              <a href="author.html#2181">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>We can certainly change the default, but certainly the idea is that users will actually go through the configuration file and change it to their liking.  One of the things particularly of interest here is that 920350 will always fire if you are using IP access anyway - this is most certainly confusing to first time users - I'd be nice to think of a good solution, since this rule, when a domain is in use, is a really effective rule.
--
Chaim Sanders
Security Researcher

Trustwave | SMART SECURITY ON DEMAND
www.trustwave.com&lt;<A HREF="http://www.trustwave.com/">http://www.trustwave.com/</A>&gt;


From: &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set-bounces at lists.owasp.org</A>&gt;&gt; on behalf of Walter Hop &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">modsec at spam.lifeforms.nl</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">modsec at spam.lifeforms.nl</A>&gt;&gt;
Date: Sunday, June 5, 2016 at 7:02 AM
To: &quot;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&quot; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] rule 920350 - &quot;host header is a numeric ip address&quot; - redirect loop using default 3.0.0 conf

It looks to me that rule 920350, &quot;Host header is a numeric IP address&quot; (REQUEST-20-PROTOCOL-ENFORCEMENT.conf) will cause a redirect loop when combined with the default &quot;modsecurity_crs_10_setup.conf&quot; action..

SecDefaultAction &quot;phase:1,log,redirect:'<A HREF="http://%{request_headers.host">http://%{request_headers.host</A>}/',tag:'Host:&lt;<A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=3IzU13mVgqBUXoqE6Tbxbpqy708ilxnGznm-IuvyRg&amp;s=5&amp;u=http%3a%2f%2f%25%7brequest%5fheaders%2ehost%7d%2f%27%2ctag%3a%27Host%3a">http://scanmail.trustwave.com/?c=4062&amp;d=3IzU13mVgqBUXoqE6Tbxbpqy708ilxnGznm-IuvyRg&amp;s=5&amp;u=http%3a%2f%2f%25%7brequest%5fheaders%2ehost%7d%2f%27%2ctag%3a%27Host%3a</A>&gt; %{request_headers.host}'&quot;
SecDefaultAction &quot;phase:2,log,redirect:'<A HREF="http://%{request_headers.host">http://%{request_headers.host</A>}/',tag:'Host:&lt;<A HREF="http://scanmail.trustwave.com/?c=4062&amp;d=3IzU13mVgqBUXoqE6Tbxbpqy708ilxnGznm-IuvyRg&amp;s=5&amp;u=http%3a%2f%2f%25%7brequest%5fheaders%2ehost%7d%2f%27%2ctag%3a%27Host%3a">http://scanmail.trustwave.com/?c=4062&amp;d=3IzU13mVgqBUXoqE6Tbxbpqy708ilxnGznm-IuvyRg&amp;s=5&amp;u=http%3a%2f%2f%25%7brequest%5fheaders%2ehost%7d%2f%27%2ctag%3a%27Host%3a</A>&gt; %{request_headers.host}'&quot;

request_headers.host will always be the IP address, and the rule therefore will keep firing.

1. Is this the intended action even for this rule?
2. Is there a way to override the action for this (or any specific) rule?

It seems like this could really hammer a site unintentionally, especially if you have a browser that isn't catching the redirect or some other script??

You make a very good point. It's a bigger problem and not restricted to this rule though. I think the redirect loop will also happen if the client has been blocked due to a cookie. After all, the client will usually re-send the same cookie on the redirect to the homepage. And I think it will then redirect again and again. I'd have to check to make sure though.

Personally I am not a fan of doing this redirect in case of a block.

I can see how the redirect would be an interesting choice for some sites. An error page might scare the visitor too much. If they get thrown back to the homepage, that is still extremely frustrating, but they might re-try their request in some other way. At the other hand, it seems much better to configure a friendly error page and send the customer to a &quot;report the problem, what did you do?&quot; form which will help ironing out false positives much better.

I would prefer that the default would be to just serve an error 403, but leaving the redirect as a commented-out example.

What do others think?

--
Walter Hop | PGP key: <A HREF="https://lifeforms.nl/pgp&lt;http://scanmail.trustwave.com/?c=4062&amp;d=3IzU13mVgqBUXoqE6Tbxbpqy708ilxnGziy9IOynEQ&amp;s=5&amp;u=https%3a%2f%2flifeforms%2enl%2fpgp">https://lifeforms.nl/pgp&lt;http://scanmail.trustwave.com/?c=4062&amp;d=3IzU13mVgqBUXoqE6Tbxbpqy708ilxnGziy9IOynEQ&amp;s=5&amp;u=https%3a%2f%2flifeforms%2enl%2fpgp</A>&gt;


________________________________

This transmission may contain information that is privileged, confidential, and/or exempt from disclosure under applicable law. If you are not the intended recipient, you are hereby notified that any disclosure, copying, distribution, or use of the information contained herein (including any reliance thereon) is strictly prohibited. If you received this transmission in error, please immediately contact the sender and destroy the material in its entirety, whether in electronic or hard copy format.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160606/60527153/attachment.html">http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20160606/60527153/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002180.html">[Owasp-modsecurity-core-rule-set] rule 920350 - &quot;host header is a numeric ip address&quot; - redirect loop using default 3.0.0 conf
</A></li>
	<LI>Next message: <A HREF="002182.html">[Owasp-modsecurity-core-rule-set] ModSecurity Job in Cologne Germany
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2181">[ date ]</a>
              <a href="thread.html#2181">[ thread ]</a>
              <a href="subject.html#2181">[ subject ]</a>
              <a href="author.html#2181">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
