From christian.folini at netnea.com  Thu Dec  1 08:26:17 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 1 Dec 2016 09:26:17 +0100
Subject: [Owasp-modsecurity-core-rule-set] Drupal 7,
 nginx with ModSecurity - How to resolve that 404 error page please?
In-Reply-To: <e4741c16-028f-cdc8-6bc4-1a9544a394f5@secit.sk>
References: <e4741c16-028f-cdc8-6bc4-1a9544a394f5@secit.sk>
Message-ID: <20161201082617.GA20668@elias>

Hello Matej,

I had hoped somebody with an NginX could shed some light on this. But
apparently not.

It is very odd. Your server says he can not open a certain file
(does it exist? permissions ok?) but then it seems that ModSec
influences the behaviour of the server down to opening files.
And that sounds quite crazy.

On Mon, Nov 28, 2016 at 11:59:56AM +0100, Matej Zuz??k wrote:
> OWASP rule set. But when I active ModSecurity in my virtual host config
> file for my Drupal 7 web I do not login, register or reset password with
> this error in log:

You English is a bit hard to understand here. Could you rephrase,
please?

> I found some solutions for Apache web server (these solutions use
> modifications of htaccess file), but not for Nginx.

What was the problem with Apache exactly and what did you modify in
the .htaccess file to make it go away?

Cheers,

Christian


-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From ehsan.mahdavi at gmail.com  Thu Dec  1 09:53:41 2016
From: ehsan.mahdavi at gmail.com (Ehsan Mahdavi)
Date: Thu, 1 Dec 2016 13:23:41 +0330
Subject: [Owasp-modsecurity-core-rule-set] Drupal 7,
 nginx with ModSecurity - How to resolve that 404 error page please?
In-Reply-To: <20161201082617.GA20668@elias>
References: <e4741c16-028f-cdc8-6bc4-1a9544a394f5@secit.sk>
	<20161201082617.GA20668@elias>
Message-ID: <CAC7V=myCZUWkiC2=__kCNmToyzzuSMUuX2fdLEVZ4twBD3Wp4A@mail.gmail.com>

Dear Christian
It isn't very odd to me if Matej uses Nginx with Modsec V2.x.

As an experienced Nginx + Modsec V2.x(nginx_refactoring) user, it looks
like to a known bug. While using nginx+modsecV2.x in reverse proxy mode
(which is not the case for Matej) we have the very same issue for some post
requests.
I can refer you to these links:

http://permalink.gmane.org/gmane.comp.apache.mod-security.user/12502
https://github.com/SpiderLabs/ModSecurity/issues/115
https://github.com/SpiderLabs/ModSecurity/issues/582
https://github.com/SpiderLabs/ModSecurity/issues/664
https://github.com/SpiderLabs/ModSecurity/issues/748


All complaining about this problem and no one takes the responsibility.
The only way is to disable modsec for the requested uri and wait for the
community to release modsec V3.0 or higher and hope that this bug will be
fixed.

Meantime he/she might find ctl:ruleEngine=off
<https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ctl> useful
.

Br. Ehsan

On Thu, Dec 1, 2016 at 11:56 AM, Christian Folini <
christian.folini at netnea.com> wrote:

> Hello Matej,
>
> I had hoped somebody with an NginX could shed some light on this. But
> apparently not.
>
> It is very odd. Your server says he can not open a certain file
> (does it exist? permissions ok?) but then it seems that ModSec
> influences the behaviour of the server down to opening files.
> And that sounds quite crazy.
>
> On Mon, Nov 28, 2016 at 11:59:56AM +0100, Matej Zuz??k wrote:
> > OWASP rule set. But when I active ModSecurity in my virtual host config
> > file for my Drupal 7 web I do not login, register or reset password with
> > this error in log:
>
> You English is a bit hard to understand here. Could you rephrase,
> please?
>
> > I found some solutions for Apache web server (these solutions use
> > modifications of htaccess file), but not for Nginx.
>
> What was the problem with Apache exactly and what did you modify in
> the .htaccess file to make it go away?
>
> Cheers,
>
> Christian
>
>
> --
> https://www.feistyduck.com/training/modsecurity-training-course
> mailto:christian.folini at netnea.com
> twitter: @ChrFolini
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161201/50d8bc86/attachment.html>

From mase at partycrew-united.de  Thu Dec  1 11:05:01 2016
From: mase at partycrew-united.de (Muenz, Michael)
Date: Thu, 1 Dec 2016 12:05:01 +0100
Subject: [Owasp-modsecurity-core-rule-set] Drupal 7,
 nginx with ModSecurity - How to resolve that 404 error page please?
In-Reply-To: <CAC7V=myCZUWkiC2=__kCNmToyzzuSMUuX2fdLEVZ4twBD3Wp4A@mail.gmail.com>
References: <e4741c16-028f-cdc8-6bc4-1a9544a394f5@secit.sk>
	<20161201082617.GA20668@elias>
	<CAC7V=myCZUWkiC2=__kCNmToyzzuSMUuX2fdLEVZ4twBD3Wp4A@mail.gmail.com>
Message-ID: <9c95f2f0-d3ec-b4b9-24c1-ebab43052c8e@partycrew-united.de>

Am 01.12.2016 um 10:53 schrieb Ehsan Mahdavi:
> Dear Christian
> It isn't very odd to me if Matej uses Nginx with Modsec V2.x.
>
> As an experienced Nginx + Modsec V2.x(nginx_refactoring) user, it 
> looks like to a known bug. While using nginx+modsecV2.x in reverse 
> proxy mode (which is not the case for Matej) we have the very same 
> issue for some post requests.
> I can refer you to these links:
>
> http://permalink.gmane.org/gmane.comp.apache.mod-security.user/12502 
> <http://permalink.gmane.org/gmane.comp.apache.mod-security.user/12502>
> https://github.com/SpiderLabs/ModSecurity/issues/115 
> <https://github.com/SpiderLabs/ModSecurity/issues/115>
> https://github.com/SpiderLabs/ModSecurity/issues/582 
> <https://github.com/SpiderLabs/ModSecurity/issues/582>
> https://github.com/SpiderLabs/ModSecurity/issues/664 
> <https://github.com/SpiderLabs/ModSecurity/issues/664>
> https://github.com/SpiderLabs/ModSecurity/issues/748 
> <https://github.com/SpiderLabs/ModSecurity/issues/748>
>
>
> All complaining about this problem and no one takes the responsibility.
> The only way is to disable modsec for the requested uri and wait for 
> the community to release modsec V3.0 or higher and hope that this bug 
> will be fixed.
>
> Meantime he/she might findctl:ruleEngine=off 
> <https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ctl> 
> useful.
>
> Br. Ehsan

Hi,

I didn't follow all the bugs and issues but how can I reproduce this?
I have a running test setup with nginx 1.11.5, Modsecurity-nginx 
connector (source 2 weeks old) and Modsecurity v3.

Then I could try to find out if it's already fixed ..

BR,
Michael

From mzuzcak at secit.sk  Thu Dec  1 15:20:29 2016
From: mzuzcak at secit.sk (=?UTF-8?B?TWF0ZWogWnV6xI3DoWs=?=)
Date: Thu, 1 Dec 2016 16:20:29 +0100
Subject: [Owasp-modsecurity-core-rule-set] Drupal 7,
 nginx with ModSecurity - How to resolve that 404 error page please?
In-Reply-To: <CAC7V=myCZUWkiC2=__kCNmToyzzuSMUuX2fdLEVZ4twBD3Wp4A@mail.gmail.com>
References: <e4741c16-028f-cdc8-6bc4-1a9544a394f5@secit.sk>
	<20161201082617.GA20668@elias>
	<CAC7V=myCZUWkiC2=__kCNmToyzzuSMUuX2fdLEVZ4twBD3Wp4A@mail.gmail.com>
Message-ID: <460a068b-b0fe-2e4a-7398-4ce07b99cf9d@secit.sk>

Hello Ehsan, Christian and Michael

thank you for your replies. So I will try use of nginx connector module.

Best Regards
Matej Zuzcak

D?a 1.12.2016 o 10:53 Ehsan Mahdavi nap?sal(a):
> Dear Christian
> It isn't very odd to me if Matej uses Nginx with Modsec V2.x.
>
> As an experienced Nginx + Modsec V2.x(nginx_refactoring) user, it
> looks like to a known bug. While using nginx+modsecV2.x in reverse
> proxy mode (which is not the case for Matej) we have the very same
> issue for some post requests.
> I can refer you to these links:
>
> http://permalink.gmane.org/gmane.comp.apache.mod-security.user/12502
> <http://permalink.gmane.org/gmane.comp.apache.mod-security.user/12502>
> https://github.com/SpiderLabs/ModSecurity/issues/115
> <https://github.com/SpiderLabs/ModSecurity/issues/115>
> https://github.com/SpiderLabs/ModSecurity/issues/582
> <https://github.com/SpiderLabs/ModSecurity/issues/582>
> https://github.com/SpiderLabs/ModSecurity/issues/664
> <https://github.com/SpiderLabs/ModSecurity/issues/664>
> https://github.com/SpiderLabs/ModSecurity/issues/748
> <https://github.com/SpiderLabs/ModSecurity/issues/748>
>
>
> All complaining about this problem and no one takes the responsibility.
> The only way is to disable modsec for the requested uri and wait for
> the community to release modsec V3.0 or higher and hope that this bug
> will be fixed.
>
> Meantime he/she might find ctl:ruleEngine=off
> <https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#ctl> useful.
>
> Br. Ehsan
>
> On Thu, Dec 1, 2016 at 11:56 AM, Christian Folini
> <christian.folini at netnea.com <mailto:christian.folini at netnea.com>> wrote:
>
>     Hello Matej,
>
>     I had hoped somebody with an NginX could shed some light on this. But
>     apparently not.
>
>     It is very odd. Your server says he can not open a certain file
>     (does it exist? permissions ok?) but then it seems that ModSec
>     influences the behaviour of the server down to opening files.
>     And that sounds quite crazy.
>
>     On Mon, Nov 28, 2016 at 11:59:56AM +0100, Matej Zuz??k wrote:
>     > OWASP rule set. But when I active ModSecurity in my virtual host
>     config
>     > file for my Drupal 7 web I do not login, register or reset
>     password with
>     > this error in log:
>
>     You English is a bit hard to understand here. Could you rephrase,
>     please?
>
>     > I found some solutions for Apache web server (these solutions use
>     > modifications of htaccess file), but not for Nginx.
>
>     What was the problem with Apache exactly and what did you modify in
>     the .htaccess file to make it go away?
>
>     Cheers,
>
>     Christian
>
>
>     --
>     https://www.feistyduck.com/training/modsecurity-training-course
>     <https://www.feistyduck.com/training/modsecurity-training-course>
>     mailto:christian.folini at netnea.com
>     <mailto:christian.folini at netnea.com>
>     twitter: @ChrFolini
>     _______________________________________________
>     Owasp-modsecurity-core-rule-set mailing list
>     Owasp-modsecurity-core-rule-set at lists.owasp.org
>     <mailto:Owasp-modsecurity-core-rule-set at lists.owasp.org>
>     https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>     <https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set>
>
>
>
>
>
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161201/1aef71b4/attachment.html>

From rclemings at gmail.com  Fri Dec  2 01:00:38 2016
From: rclemings at gmail.com (Russell Clemings)
Date: Thu, 1 Dec 2016 17:00:38 -0800
Subject: [Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule
	difficulty
Message-ID: <CAN7RX0Z8N3oLji0+ZTF=RC6_Z7Fvrpnj9HqJHov9raacfTrksQ@mail.gmail.com>

I'm having some trouble dealing with two false positives. This is cPanel's
implementation of OWASP ver.3.0.0, as nearly as I can tell (from /etc
<https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc>
/apache2
<https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc/apache2>
/conf.d
<https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc/apache2/conf.d>
/modsec_vendor_configs
<https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc/apache2/conf.d/modsec_vendor_configs>
/OWASP/modsecurity_crs_10_setup.conf). I've masked some possibly sensitive
data.

523939:[Thu Dec 01 10:25:39.244073 2016] [:error] [pid 24880] [client
xx.xx.xxx.xxx] ModSecurity: Access denied with redirection to
http://www.example.com/ using status 302 (phase 2). Pattern match
"\\\\%((?!$|\\\\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})" at ARGS:returnUrl.
[file
"/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/REQUEST-20-PROTOCOL-ENFORCEMENT.conf"]
[line "219"] [id "950109"] [rev "2"] [msg "Multiple URL Encoding Detected"]
[severity "WARNING"] [ver "OWASP_CRS/3.0.0"] [maturity "6"] [accuracy "8"]
[tag "Host: www.example.com"] [tag "application-multi"] [tag
"language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag
"OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [hostname "www.example.com"] [uri
"/xxx.php"] [unique_id "WEBA83cQjKbwhNpTYWkudQAAAAQ"]

526747:[Thu Dec 01 10:41:28.958952 2016] [:error] [pid 26285] [client
xx.xx.xxx.xxx] ModSecurity: Access denied with redirection to
http://www.example.com/ using status 302 (phase 2). Match of "beginsWith
%{request_headers.host}" against "TX:1" required. [file
"/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/REQUEST-31-APPLICATION-ATTACK-RFI.conf"]
[line "30"] [id "950120"] [rev "3"] [msg "Possible Remote File Inclusion
(RFI) Attack: Off-Domain Reference/Link"] [data "Matched Data:
https://another.example.com/a/account/validatethirdpartycorporateauthresult?redirectUrl=http:%2F%2Fanother.example.com%2Fa
found within TX:1:
another.example.com/a/account/validatethirdpartycorporateauthresult?redirectUrl=http:%2F%2Fanother.example.com%2Fa"]
[severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"]
[tag "Host: www.example.com"] [tag "application-multi"] [tag
"language-multi"] [tag "platform-multi"] [tag "attack-remote file
inclusion"] [tag "OWASP_CRS/WEB_ATTACK/RFI"] [hostname "www.example.com"]
[uri "/xxx.php"] [unique_id "WEBEqF9us8Ws-b6n3kgKmAAAAAI"]

I've confirmed that those rules are the problem by temporarily disabling
them, but I would like to create an exception instead. I am trying to use
the "add rule" function in cPanel's WHM/Security
Center/ModSecurity/Tools/Rules List. Here is what I'm trying to add (singly
and both at once):

SecRuleUpdateTargetById 950109 !ARGS:'another.example.com'
SecRuleUpdateTargetByID 950120 !ARGS_NAMES:'another.example.com'

When I try to save and deploy, here is what I get in the cPanel error log:

[2016-12-01 16:09:21 -0500] warn [xml-api] The system failed to deploy the
changes for ?modsec/modsec2.user.conf?: The system could not validate the
new Apache configuration because httpd exited with a nonzero value. Apache
produced the following error: AH00526: Syntax error on line 1 of
/etc/apache2/conf.d/modsec/modsec2.user.conf:
Updating target by ID with no ruleset in this context

I've tried various combinations of single quotes, double quotes, no quotes,
but to no avail. It's up to the server vendor to file a ticket with cPanel
and they say it's not appropriate to do that for a syntax error.

Suggestions?

I did file reports via cPanel earlier today and got auto-replies from
security at modsecurity.org assigning ticket nos. 1332 and 1333, but nothing
further.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161201/1e75bf0e/attachment-0001.html>

From rclemings at gmail.com  Sat Dec  3 16:07:22 2016
From: rclemings at gmail.com (Russell Clemings)
Date: Sat, 3 Dec 2016 08:07:22 -0800
Subject: [Owasp-modsecurity-core-rule-set] cpanel modsecurity add-rule
	difficulty
In-Reply-To: <CAN7RX0Z8N3oLji0+ZTF=RC6_Z7Fvrpnj9HqJHov9raacfTrksQ@mail.gmail.com>
References: <CAN7RX0Z8N3oLji0+ZTF=RC6_Z7Fvrpnj9HqJHov9raacfTrksQ@mail.gmail.com>
Message-ID: <CAN7RX0ZxO7M_wfC4xPY8Ts3Qe92hUOtHaQt8a1ty3Gb-WFCd6Q@mail.gmail.com>

Update:

I finally persuaded my server vendor to ask cPanel about this and cPanel
had this to say:

-----

I did confirm I am seeing the same issue when attempting to add the rules,
which appear to be an issue noted here as well :

https://github.com/SpiderLabs/ModSecurity/issues/89

This would entail that this requires the configurations be added manually
in a separate configuration as you had suggested, which I added in the file
the specific rule ID to be updated is present in at
/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/REQUEST-20-PROTOCOL-ENFORCEMENT.conf
and confirmed that it did allow the directive to be added without issue.

-----

So I added my two SecRuleUpdateTargetById directives to a new file
(/etc/apache2/conf.d/modsec_vendor_configs/OWASP/modsecurity_crs_20_customrules.conf)
and restarted Apache.

Everything works fine now.

H/T to Christian Folini and Spork Schivago for some help offlist.


On Thu, Dec 1, 2016 at 5:00 PM, Russell Clemings <rclemings at gmail.com>
wrote:

> I'm having some trouble dealing with two false positives. This is cPanel's
> implementation of OWASP ver.3.0.0, as nearly as I can tell (from /etc
> <https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc>
> /apache2
> <https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc/apache2>
> /conf.d
> <https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc/apache2/conf.d>
> /modsec_vendor_configs
> <https://nasw2.sciencewriters.us:2087/cpsess2553782837/cgi/configserver/cse.cgi?do=b&p=/etc/apache2/conf.d/modsec_vendor_configs>
> /OWASP/modsecurity_crs_10_setup.conf). I've masked some possibly
> sensitive data.
>
> 523939:[Thu Dec 01 10:25:39.244073 2016] [:error] [pid 24880] [client
> xx.xx.xxx.xxx] ModSecurity: Access denied with redirection to
> http://www.example.com/ using status 302 (phase 2). Pattern match
> "\\\\%((?!$|\\\\W)|[0-9a-fA-F]{2}|u[0-9a-fA-F]{4})" at ARGS:returnUrl.
> [file "/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/
> REQUEST-20-PROTOCOL-ENFORCEMENT.conf"] [line "219"] [id "950109"] [rev
> "2"] [msg "Multiple URL Encoding Detected"] [severity "WARNING"] [ver
> "OWASP_CRS/3.0.0"] [maturity "6"] [accuracy "8"] [tag "Host:
> www.example.com"] [tag "application-multi"] [tag "language-multi"] [tag
> "platform-multi"] [tag "attack-protocol"] [tag
> "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [hostname "www.example.com"] [uri
> "/xxx.php"] [unique_id "WEBA83cQjKbwhNpTYWkudQAAAAQ"]
>
> 526747:[Thu Dec 01 10:41:28.958952 2016] [:error] [pid 26285] [client
> xx.xx.xxx.xxx] ModSecurity: Access denied with redirection to
> http://www.example.com/ using status 302 (phase 2). Match of "beginsWith
> %{request_headers.host}" against "TX:1" required. [file
> "/etc/apache2/conf.d/modsec_vendor_configs/OWASP/rules/
> REQUEST-31-APPLICATION-ATTACK-RFI.conf"] [line "30"] [id "950120"] [rev
> "3"] [msg "Possible Remote File Inclusion (RFI) Attack: Off-Domain
> Reference/Link"] [data "Matched Data: https://another.example.com/a/
> account/validatethirdpartycorporateauthresult?redirectUrl=http:%2F%
> 2Fanother.example.com%2Fa found within TX:1:
> another.example.com/a/account/validatethirdpartycorporateaut
> hresult?redirectUrl=http:%2F%2Fanother.example.com%2Fa"] [severity
> "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag
> "Host: www.example.com"] [tag "application-multi"] [tag "language-multi"]
> [tag "platform-multi"] [tag "attack-remote file inclusion"] [tag
> "OWASP_CRS/WEB_ATTACK/RFI"] [hostname "www.example.com"] [uri "/xxx.php"]
> [unique_id "WEBEqF9us8Ws-b6n3kgKmAAAAAI"]
>
> I've confirmed that those rules are the problem by temporarily disabling
> them, but I would like to create an exception instead. I am trying to use
> the "add rule" function in cPanel's WHM/Security
> Center/ModSecurity/Tools/Rules List. Here is what I'm trying to add (singly
> and both at once):
>
> SecRuleUpdateTargetById 950109 !ARGS:'another.example.com'
> SecRuleUpdateTargetByID 950120 !ARGS_NAMES:'another.example.com'
>
> When I try to save and deploy, here is what I get in the cPanel error log:
>
> [2016-12-01 16:09:21 -0500] warn [xml-api] The system failed to deploy the
> changes for ?modsec/modsec2.user.conf?: The system could not validate the
> new Apache configuration because httpd exited with a nonzero value. Apache
> produced the following error: AH00526: Syntax error on line 1 of
> /etc/apache2/conf.d/modsec/modsec2.user.conf:
> Updating target by ID with no ruleset in this context
>
> I've tried various combinations of single quotes, double quotes, no
> quotes, but to no avail. It's up to the server vendor to file a ticket with
> cPanel and they say it's not appropriate to do that for a syntax error.
>
> Suggestions?
>
> I did file reports via cPanel earlier today and got auto-replies from
> security at modsecurity.org assigning ticket nos. 1332 and 1333, but nothing
> further.
>
>
>


-- 
===============================================
Russell Clemings
<russell at clemings.com>
===============================================
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20161203/c50dbb66/attachment.html>

From heinrichm001 at t-online.de  Thu Dec  8 10:07:31 2016
From: heinrichm001 at t-online.de (Heinrich M.)
Date: Thu, 08 Dec 2016 11:07:31 +0100
Subject: [Owasp-modsecurity-core-rule-set] Missing Component Signature /
 Version Information in Blocking Rules
In-Reply-To: <1479970006.3174.5.camel@t-online.de>
References: <1479389234.32413.8.camel@t-online.de>
	<20161118150657.GA4193@elias> <1479970006.3174.5.camel@t-online.de>
Message-ID: <1481191651.7490.8.camel@t-online.de>

Hi,

after a few weeks with ModSec, CRS3, some custom rules and several
exepction rules, things seems to run smoothly now.

@Christian: With help of your tutorials, I was able to solve some other
issues. Thanks for that!

Regards,

Heinrich


Am Donnerstag, den 24.11.2016, 07:46 +0100 schrieb Heinrich M.:
> Hi Christian,
> 
> thank you for the information and the grep command :-).?
> 
> After dealing with some other problems the last days, I'm back to
> ModSec today. I will report everything I encounter.
> 
> Regards,
> 
> Heinrich
> 
> P.S. Going to switch to 3.0/dev for further testing.
> 
> 
> Am Freitag, den 18.11.2016, 16:06 +0100 schrieb Christian Folini:
> > 
> > Hello Heinrich,
> > 
> > Another well spotted bug. Thank you. It's funny how a new pair of
> > eyes
> > spots bugs in corners ignored by experienced users.
> > 
> > The support for the "ver" action is only partial. In fact there are
> > more than only the blocking rules that come without the "ver"
> > action.
> > 
> > I have opened a bug report for this issue:
> > https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/650
> > 
> > I flagged it for CRS 3.1.0. There is a chance, this will be made
> > available for 3.0.1, but I doubt it as it's quite a bit of work
> > and not crucial for the correct functioning of the rule set.
> > 
> > In your situation, you are best off with the following construct
> > including the mandaory regular expression : Note how the CRS rules
> > are all in the 900K range, but we lately claimed the 9M range too;
> > hence {5,6}.
> > 
> > $> cat error.log | egrep "id \"9[0-9]{5,6}\""
> > 
> > Keep these bug reports coming, please.
> > 
> > Best,
> > 
> > Christian
> > 
> > 
> > 
> > On Thu, Nov 17, 2016 at 02:27:14PM +0100, Heinrich M. wrote:
> > > 
> > > 
> > > Hi,
> > > 
> > > while playing around with the rule set and adding some custom
> > > rules, I
> > > found that the blocking rules miss the version tag within
> > > Apache's
> > > error log. Is there a reason for this? As fas as I could see,
> > > every
> > > other rule is tagged with [ver "OWASP_CRS/3.0.0"] but I may be
> > > missing
> > > something.?
> > > 
> > > I'd like to grep for '[ver "OWASP_CRS/3.0.0"]' in order to
> > > separate
> > > log
> > > entries from custom rules from the CRS rules. I know that this
> > > can
> > > also
> > > be done by rule IDs but those regexes are hard ;-).
> > > 
> > > Regards,
> > > 
> > > Heinrich
> > > _______________________________________________
> > > Owasp-modsecurity-core-rule-set mailing list
> > > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-r
> > > ul
> > > e-set
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-
> set

From christian.folini at netnea.com  Fri Dec 23 05:12:54 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 23 Dec 2016 06:12:54 +0100
Subject: [Owasp-modsecurity-core-rule-set] News from the Core Rules
	(2016-12-23)
Message-ID: <20161223051254.GA29692@elias>

Hi there,

It's been a few weeks, and I thought I'd do another status update.

The CRS3 release was six weeks ago. We were a bit afraid, that adoption
would lead to many reports of new false positives. That is clearly not
the case. Feeling better now. You can check the open issues with CRS
3.0.0 on github:
https://github.com/SpiderLabs/owasp-modsecurity-crs/issues?q=is%3Aissue+is%3Aopen+label%3A%22v3.0-dev+Development%22

There is a mini-tutorial at How-To-Forge on how to run CRS3 with
ISPConfig. We may look into integrating the documented rule exclusions
in a future CRS version.
https://www.howtoforge.com/community/threads/mini-howto-modsecurity-crs-3-0-on-debian-jessie.74898

Longtime Debian packager Alberto Gonzalez Iniesta has packaged CRS3 for
debian and published the new package. I worked with him on package
optimization (better paths, simpler includes, better description, etc.).
That work will be uploaded right before Debian Stretch (the next Debian
release) will be frozen. The Debian package is of course very important
as it will be picked up by many other distributions depending on Debian.
https://packages.debian.org/jessie-backports/modsecurity-crs

The tutorials about Apache/ModSecurity that I updated for CRS3 have been
translated to German. You can get them here:
https://www.netnea.com/cms/apache-tutorials-de/

While staying at a hotel in Germany during a ModSec course I ran, I
hacked together a Core Rule Set inventory. It gives you an overview
over all CRS3 rules and serves as link to the definition of the rule
on github. There are also options for easy access like typing
"crs 942100" in the address bar of the browser and being taken to
the right rule entry in the rule inventory immediately. So if you
face an alert, you can type the rule id in the browser and it
gives you all you need to know about the rule that triggered the alarm:
https://www.netnea.com/cms/core-rule-set-inventory

The next course will be in Zurich, Switzerland, near the end of
February. There is now a single early bird ticket left. And afterwards
a hand full of regular price tickets:
https://www.feistyduck.com/training/modsecurity-training-course

Chaim, Walter and I are planning to make an appearance at the
OWASP AppSecEurope conference in Belfast in May. We are planning various
talks and activities around the Core Rule Set. If you want to join
(or support and contribute!), you can follow our plans on the OWASP
wiki:
https://www.owasp.org/index.php/CRSAppSecEU2017

And finally, Linux Weekly News published an article on ModSecurity last
week: 
https://lwn.net/Articles/708673/ 
A second one about CRS3 came out yesterday. It is paywalled for seven
days, afterwards it will become freely available. If you are not a
subscriber, but you want instant access nevertheless, then let me know
and I can send you a subscriber's link.

That's all that springs to mind right now.

All the best!

Christian

-- 
CRS website: https://www.modsecurity.org/crs
CRS at OWASP: https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project
CRS tutorials: https://netnea.com/apache-tutorials

From wbmilleriii at comcast.net  Fri Dec 23 05:15:56 2016
From: wbmilleriii at comcast.net (Bill Miller)
Date: Thu, 22 Dec 2016 23:15:56 -0600
Subject: [Owasp-modsecurity-core-rule-set] News from the Core Rules
 (2016-12-23)
In-Reply-To: <20161223051254.GA29692@elias>
References: <20161223051254.GA29692@elias>
Message-ID: <8160502f-0e31-b865-2f97-a3a5ef0c1d9b@comcast.net>

Thanks for that inventory.  It will be helpful.

On 12/22/2016 11:12 PM, Christian Folini wrote:
> Hi there,
>
> It's been a few weeks, and I thought I'd do another status update.
>
> The CRS3 release was six weeks ago. We were a bit afraid, that adoption
> would lead to many reports of new false positives. That is clearly not
> the case. Feeling better now. You can check the open issues with CRS
> 3.0.0 on github:
> https://github.com/SpiderLabs/owasp-modsecurity-crs/issues?q=is%3Aissue+is%3Aopen+label%3A%22v3.0-dev+Development%22
>
> There is a mini-tutorial at How-To-Forge on how to run CRS3 with
> ISPConfig. We may look into integrating the documented rule exclusions
> in a future CRS version.
> https://www.howtoforge.com/community/threads/mini-howto-modsecurity-crs-3-0-on-debian-jessie.74898
>
> Longtime Debian packager Alberto Gonzalez Iniesta has packaged CRS3 for
> debian and published the new package. I worked with him on package
> optimization (better paths, simpler includes, better description, etc.).
> That work will be uploaded right before Debian Stretch (the next Debian
> release) will be frozen. The Debian package is of course very important
> as it will be picked up by many other distributions depending on Debian.
> https://packages.debian.org/jessie-backports/modsecurity-crs
>
> The tutorials about Apache/ModSecurity that I updated for CRS3 have been
> translated to German. You can get them here:
> https://www.netnea.com/cms/apache-tutorials-de/
>
> While staying at a hotel in Germany during a ModSec course I ran, I
> hacked together a Core Rule Set inventory. It gives you an overview
> over all CRS3 rules and serves as link to the definition of the rule
> on github. There are also options for easy access like typing
> "crs 942100" in the address bar of the browser and being taken to
> the right rule entry in the rule inventory immediately. So if you
> face an alert, you can type the rule id in the browser and it
> gives you all you need to know about the rule that triggered the alarm:
> https://www.netnea.com/cms/core-rule-set-inventory
>
> The next course will be in Zurich, Switzerland, near the end of
> February. There is now a single early bird ticket left. And afterwards
> a hand full of regular price tickets:
> https://www.feistyduck.com/training/modsecurity-training-course
>
> Chaim, Walter and I are planning to make an appearance at the
> OWASP AppSecEurope conference in Belfast in May. We are planning various
> talks and activities around the Core Rule Set. If you want to join
> (or support and contribute!), you can follow our plans on the OWASP
> wiki:
> https://www.owasp.org/index.php/CRSAppSecEU2017
>
> And finally, Linux Weekly News published an article on ModSecurity last
> week:
> https://lwn.net/Articles/708673/
> A second one about CRS3 came out yesterday. It is paywalled for seven
> days, afterwards it will become freely available. If you are not a
> subscriber, but you want instant access nevertheless, then let me know
> and I can send you a subscriber's link.
>
> That's all that springs to mind right now.
>
> All the best!
>
> Christian
>


From christian.folini at netnea.com  Fri Dec 23 05:24:30 2016
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 23 Dec 2016 06:24:30 +0100
Subject: [Owasp-modsecurity-core-rule-set] News from the Core Rules
 (2016-12-23)
In-Reply-To: <8160502f-0e31-b865-2f97-a3a5ef0c1d9b@comcast.net>
References: <20161223051254.GA29692@elias>
	<8160502f-0e31-b865-2f97-a3a5ef0c1d9b@comcast.net>
Message-ID: <20161223052430.GA3613@elias>

On Thu, Dec 22, 2016 at 11:15:56PM -0600, Bill Miller wrote:
> Thanks for that inventory.  It will be helpful.

Glad you like it. :)

-- 
Experience is what you get while looking for something else.
-- Federico Fellini

