<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Issues with CRS3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Issues%20with%20CRS3&In-Reply-To=%3C20161115163531.GA5860%40elias%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002266.html">
   <LINK REL="Next"  HREF="002271.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Issues with CRS3</H1>
    <B>Christian Folini</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Issues%20with%20CRS3&In-Reply-To=%3C20161115163531.GA5860%40elias%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Issues with CRS3">christian.folini at netnea.com
       </A><BR>
    <I>Tue Nov 15 16:35:31 UTC 2016</I>
    <P><UL>
        <LI>Previous message: <A HREF="002266.html">[Owasp-modsecurity-core-rule-set] Issues with CRS3
</A></li>
        <LI>Next message: <A HREF="002271.html">[Owasp-modsecurity-core-rule-set] Issues with CRS3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2268">[ date ]</a>
              <a href="thread.html#2268">[ thread ]</a>
              <a href="subject.html#2268">[ subject ]</a>
              <a href="author.html#2268">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi there,

On Tue, Nov 15, 2016 at 04:44:15PM +0100, Heinrich M. wrote:
&gt;<i> thank you for your great work! It is just great that there exists an
</I>&gt;<i> open source WAF and a corresponding ruleset! Thank you.
</I>
You are most welcome. Glad you like it. 

&gt;<i> I'm quite new to ModSecurity. Today, I found some time to play around
</I>&gt;<i> with ModSecurity and the new CRS release in a basic testing setup. I
</I>&gt;<i> hope that I will be able to introduce ModSec and the CRS3 in some small
</I>&gt;<i> prod environment soon.
</I>
Please keep us posted about your experience. Us, the dev team has 
years of experience and this is in fact a big problem as we do not
even see the small problems and the many questions that new users
like you face. Your perspective is very valuable.

&gt;<i> 1. Issue
</I>&gt;<i> After including the new CRS rule files, apache didn't fire up.
</I>&gt;<i> journalctl provided the following error messages:
</I>&gt;<i> 
</I>&gt;<i> [...] Syntax error on line 36 of
</I>&gt;<i> /etc/modsecurity/owasp-modsecurity-crs/rules/RESPONSE-950-DATA-LEAKAGES.conf:
</I>&gt;<i> [...] Error parsing actions: Unknown action: \\
</I>&gt;<i> 
</I>&gt;<i> Workaround (I don't know what other effects of this might be...): Adding
</I>&gt;<i> a space to line 36 resolved the issue: &quot;t:none, \&quot;
</I>
This is a known issue with older Apache versions. It is documented
in the CRS KNOWN_BUGS file:

&gt;<i>* Apache 2.4 prior to 2.4.11 is affected by a bug in parsing multi-line
</I>&gt;<i>  configuration directives, which causes Apache to fail during startup
</I>&gt;<i>  with an error such as:
</I>&gt;<i>    Error parsing actions: Unknown action: \\
</I>&gt;<i>    Action 'configtest' failed.
</I>&gt;<i> ...
</I>&gt;<i>  We advise to upgrade your Apache version. If upgrading is not possible,
</I>&gt;<i>  we have provided a script in the util/join-multiline-rules directory
</I>&gt;<i>  which converts the rules into a format that works around the bug.
</I>&gt;<i>  You have to re-run this script whenever you modify or update 
</I>&gt;<i>  the CRS rules.
</I>
Your workaround works equally well.

&gt;<i> 2. Issue
</I>&gt;<i> Changing the blocking actions did not work as documented in
</I>&gt;<i> RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.
</I>&gt;<i> I tried to use the example  &quot;send an error 404&quot; (line 67 and below).
</I>&gt;<i> With the two rules activated, blocking dind't work anymore. Removing the
</I>&gt;<i> &quot;chain&quot; from the actions made blocking work again. The rules then are as
</I>&gt;<i> follows:
</I>&gt;<i> 
</I>&gt;<i> SecRuleUpdateActionById 949110 &quot;t:none,deny,status:404&quot;
</I>&gt;<i> SecRuleUpdateActionById 959100 &quot;t:none,deny,status:404&quot;
</I>
Ooops. I need to take a look at this. I'll be back.

Ahoj,

Christian


-- 
Worst-case thinking encourages society to adopt fear as of one 
of the key principles around which the public, the government 
and various institutions should organise their lives. It 
institutionalises insecurity and fosters a mood of confusion 
and powerlessness. Through popularising the belief that worst
cases are normal, it also encourages people to feel defenceless 
and vulnerable to a wide range of future threats. In all but 
name, it is an invitation to social paralysis.
-- Frank Furedi
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002266.html">[Owasp-modsecurity-core-rule-set] Issues with CRS3
</A></li>
	<LI>Next message: <A HREF="002271.html">[Owasp-modsecurity-core-rule-set] Issues with CRS3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2268">[ date ]</a>
              <a href="thread.html#2268">[ thread ]</a>
              <a href="subject.html#2268">[ subject ]</a>
              <a href="author.html#2268">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
