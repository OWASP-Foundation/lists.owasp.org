<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Possibility%20of%20fine%20tuning%0A%20libinjection%20results&In-Reply-To=%3C1507891180187.69009%40nadra.gov.pk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002485.html">
   <LINK REL="Next"  HREF="002488.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results</H1>
    <B>Waqas Ali Khan (47247)</B> 
    <A HREF="mailto:owasp-modsecurity-core-rule-set%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-modsecurity-core-rule-set%5D%20Possibility%20of%20fine%20tuning%0A%20libinjection%20results&In-Reply-To=%3C1507891180187.69009%40nadra.gov.pk%3E"
       TITLE="[Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results">waqas.khan at nadra.gov.pk
       </A><BR>
    <I>Fri Oct 13 10:39:39 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="002485.html">[Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results
</A></li>
        <LI>Next message: <A HREF="002488.html">[Owasp-modsecurity-core-rule-set] Trustwave Position: Security	Researcher - ModSecurity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2486">[ date ]</a>
              <a href="thread.html#2486">[ thread ]</a>
              <a href="subject.html#2486">[ subject ]</a>
              <a href="author.html#2486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thank you Manuel Spartan for the response. Yes it is always good to create very specific disable rules to make sure the rules are ignored only for the specific requests.


@Bob Jolliffe?, please take note of the SecRule from Manuel Spartan. These are more specific and the matching rule ID will only be ignored for the request causing problem.


Regards

Waqas Ali

________________________________
From: Manuel Spartan &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">spartantri at gmail.com</A>&gt;
Sent: Friday, October 13, 2017 3:29 PM
To: Waqas Ali Khan (47247)
Cc: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>
Subject: Re: [Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results

You can do some checks before killing the rule by chaining that rule and verifying the contents of &quot;fields&quot; if it is always the same use a streq as the example below, otherwise do a rx including a pattern that match your different values.

SecRule REQUEST_URI &quot;@beginsWith /dhis/api/26/dimensions.json&quot; &quot;id:10000,phase:1,pass,nolog,chain&quot;
    SecRule ARGS:fields &quot;@streq id,displayName~rename(name),dimensionType&quot; &quot;ctl:ruleRemoveTargetById=942100;ARGS:fields&quot;

You may want to use phase 2 instead of phase 1 or viceversa, if you have issues depending of your setup

2017-10-12 16:00 GMT+02:00 Waqas Ali Khan (47247) &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">waqas.khan at nadra.gov.pk</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">waqas.khan at nadra.gov.pk</A>&gt;&gt;:
The ctl action should be ruleRemoveTargetById. Sorry for the typo. So the final rule should be:

SecRule REQUEST_URI &quot;@beginsWith /dhis/api/26/dimensions.json&quot; &quot;id:10000,phase:1,pass,nolog,ctl:ruleRemoveTargetById=942100&quot;

Regards
Waqas Ali
________________________________________
From: Waqas Ali Khan (47247)
Sent: Thursday, October 12, 2017 6:56 PM
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: Re: [Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results

Hi Bob

To determine what exactly is triggering the rule, you can view the error logs that are created in response to the detected rule. Data matched variable is going to show exactly what is being detected as a threat.

You can disable the mentioned rule just for this particular URI like:

SecRule REQUEST_URI &quot;@beginsWith /dhis/api/26/dimensions.json&quot; &quot;id:10000,phase:1,pass,nolog,ctl:ruleRemoveById=942100&quot;

You will have to include the above rule before the rule file 942100.

Regards
Waqas Ali
----------------------------------------------------------------------

Message: 1
Date: Thu, 12 Oct 2017 13:39:53 +0200
From: Bob Jolliffe &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">bobjolliffe at gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">bobjolliffe at gmail.com</A>&gt;&gt;
To: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
Subject: [Owasp-modsecurity-core-rule-set] Possibility of fine tuning
        libinjection results
Message-ID:
        &lt;CACd=f9ehJ9t24UG9fJch=<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">__59Q4rKb4jTUBBZC2v_dMR5VUNyw at mail.gmail.com</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">59Q4rKb4jTUBBZC2v_dMR5VUNyw at mail.gmail.com</A>&gt;&gt;
Content-Type: text/plain; charset=&quot;UTF-8&quot;

Hi

I am not very experienced with owcrs so please bear with me if I say
silly things.

I have a problem that rule 942100 (libinjection) is getting falsely
triggered in response to a legitimate api call on our application.  In
particular the the offending URL is:

GET /dhis/api/26/dimensions.json?fields=id,displayName~rename(name),dimensionType&amp;paging=false

Which triggers 942100 with a fingerprint of 'nok(n'.

I don't really want to disable the whole rule as I am sure
libinjection is valuable and it seems it is just this nok thing which
is tripping.   I also will not easily get developers to change the api
in a hurry.  Does anybody know is there a way to keep 942100 but just
disable responding to this particular fingerprint?

Bonus question: can anybody tell me what it is exactly in the URL
which is upsetting libinjection?  I am suspecting it has to do with
'rename(name)'

Regards
Bob


------------------------------
_______________________________________________
Owasp-modsecurity-core-rule-set mailing list
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">Owasp-modsecurity-core-rule-set at lists.owasp.org</A>&gt;
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set</A>

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002485.html">[Owasp-modsecurity-core-rule-set] Possibility of fine tuning libinjection results
</A></li>
	<LI>Next message: <A HREF="002488.html">[Owasp-modsecurity-core-rule-set] Trustwave Position: Security	Researcher - ModSecurity
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2486">[ date ]</a>
              <a href="thread.html#2486">[ thread ]</a>
              <a href="subject.html#2486">[ subject ]</a>
              <a href="author.html#2486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set">More information about the Owasp-modsecurity-core-rule-set
mailing list</a><br>
</body></html>
