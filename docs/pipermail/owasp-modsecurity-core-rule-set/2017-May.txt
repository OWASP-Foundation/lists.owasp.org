From christian.folini at netnea.com  Fri May  5 19:56:11 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Fri, 5 May 2017 21:56:11 +0200
Subject: [Owasp-modsecurity-core-rule-set] News from the Core Rule Set
	(2017-05-05)
Message-ID: <20170505195611.zno5k3fahs5in5uz@leander>

Dear all,

This is the CRS newsletter covering the period from April until today.

What has happened during the last few weeks:

- We held our 3rd community chat last Monday. We have been eight people
  and we had an extremely efficient meeting. We sorted out a strategy
  for the remaining 3.0dev issues and cleared the path for the 3.0.1
  release.  The next community chats will be held on the following
  dates:
  - Jun 5, 2017, 20:30 CEST (14:30 EST, 19:30 GMT)
  - Jul 3, 2017, 20:30 CEST
  - Aug 7, 2017, 20:30 CEST
  - Sep 4, 2017, 20:30 CEST
  - Oct 2, 2017, 20:30 CEST
  - Nov 6, 2017, 20:30 CET
  - Dec 4, 2017, 20:30 CET

- There are three open pull requests and three issues keeping us
  from releasing 3.0.1. The idea is to clear this during the weekend
  and release 3.0.1 on Tuesday, May 9.

- The release policy discussed last month has been described briefly
  at:
  https://github.com/SpiderLabs/owasp-modsecurity-crs/wiki/Release-Policy

- After the release policy last month, we decided on a way to organise
  CRS developers. We settled on the following roles
  - Project lead
  - Core team
  - Project contributors with commit permission
  - Contributors without commit permission

  As you know, Chaim is project lead and he forms the core team with
  Walter Hop and me. We also promoted regular contributors Franziska
  B?hler and Christoph Hansen to project contributors with commit
  permission.  There have been more people contributing to CRS 3.0.1
  and we hope to work with them so they can eventually be promoted to a
  commit permission level.

  The idea with the core team is, that every PR needs to be reviewed by
  at least one core team member. This also applies to PRs by core team
  members: They have to be reviewed by at least one additional
  core team member.

- There is general interest to publish more blog posts around CRS
  and also additional information.  We are working on a useful 
  platform here.

- Once CRS 3.0.1 is out the door, testing will be formalized and
  automated, we will close the very old issues and then start with the
  development for 3.1; incorporating new features and new rules.

- Hugo Costa is working on our new logo, but he is also working on
  various other tasks for AppSecEU. In the end AppSecEU won and we
  have to wait until after the conference.

- The security scanner research project resulted in 13 new issues so
  far: false negatives. That is requests which should be blocked but
  were not - or at least not on a reasonably low paranoia level.
  See all these tickets here:
  https://github.com/SpiderLabs/owasp-modsecurity-crs/issues?q=is%3Aissue+is%3Aopen+label%3Azhaw-research-project
  The most severe false negative seems to be this payload
  which goes undetected at Paranoia Level 3:
  userinput=textvalue95920'%3balert(1)%2f%2f153
  Obviously, there is a transformation missing before the XSS rule
  in question is being executed.
  Other findings are not as dangerous, but also much harder to
  detect like out-of-band communication, where a request parameter
  is passed to nslookup to perform a DNS request.

Upcoming stuff

- CRS 3.0.1 release planned for Tuesday, May 9.

- The CRS meetup at AppSecEU will be rather informal. We were probably
  to late to announce it and fairly few people from the community
  will be making it. Chaim and I will be at the conference from
  Tuesday / Wednesday though. Please get in touch if you are around.
  The idea is to hang out together Wednesday night.

- My Core Rule Set 3.0 Intro talk at AppSecEU in Belfast has been
  scheduled for Thursday May 11, 4.15pm. Would be cool to see
  you.

  I will present the first part of the research (Burp vs. CRS3)
  at the SIGS Technology Conference in Zurich, May 18, 2017:
  www.sig-switzerland.ch/de/technology_conference/

- Next CRS chat: June 5, 2017, 20:30 CEST on Freenode IRC, channel
  #modsecurity (14:30 EST, 19:30 GMT)

Ahoj,

Christian


-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From sthayyilekan at BarclaycardUS.com  Tue May  9 16:27:30 2017
From: sthayyilekan at BarclaycardUS.com (Thayyile kandy, Subin : CSO GIS)
Date: Tue, 9 May 2017 16:27:30 +0000
Subject: [Owasp-modsecurity-core-rule-set] Issues with
	tx.restricted_extensions
Message-ID: <C310131DD0004743B2508B65C77B66317CEC6A06@PMEXGMB04.juniper.com>


Hello

Im having some issues with some of my requests being blocked based on extension , I do not have .php or .html on my restricted extensions list.
Has anyone come across this before ?

This happens when I run in  detection mode by default and turn on blocking using

SecRuleUpdateActionById 920440 "deny,ctl:ruleEngine=On"

http://localhost /forms.php  (works fine)
http://localhost /forms.php?  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] )
http://localhost /forms.php?id=0  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] )
http://localhost /forms.html  (works fine)
http://localhost /forms.html?  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] )
http://localhost /forms.html?id=0  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] )


debug logs
-------------


[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Recipe: Invoking rule b6536900; [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1031"] [id "920430"] [rev "2"].

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][5] Rule b6536900:

SecRule "REQUEST_PROTOCOL" "!@within %{tx.allowed_http_versions}<mailto:!@within%20%25%7btx.allowed_http_versions%7d>"

"phase:request,nolog,auditlog,t:none,block,msg:'HTTP protocol version is not allowed by policy',severity:CRITICAL,rev:2,ver:OWASP_CRS/3.0.0,maturity:9,accuracy:9,id:920430,tag:application-multi,tag:language-multi,tag:platform-multi,tag:attack-protocol,tag:OWASP_CRS/POLICY/PROTOCOL_NOT_ALLOWED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A6,tag:PCI/6.5.10,logdata:%{matched_var},setvar:tx.msg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-OWASP_CRS/POLICY/PROTOCOL_NOT_ALLOWED-%{matched_var_name}=%{matched_var}"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Transformation completed in 0 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Executing operator "!within" with param "%{tx.allowed_http_versions}" against REQUEST_PROTOCOL.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Target value: "HTTP/1.1"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{tx.allowed_http_versions} to: HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Operator completed in 6 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Rule returned 0.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] No match, not chained -> mode NEXT_RULE.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Recipe: Invoking rule b652be08; [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"].

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][5] Rule b652be08: SecRule "REQUEST_BASENAME" "@rx \\.(.*)$<file:///\\.(.*)$>" "phase:request,nolog,auditlog,chain,capture,t:none,t:urlDecodeUni,t:lowercase,msg:'URL

file extension is restricted by policy',severity:CRITICAL,rev:2,ver:OWASP_CRS/3.0.0,maturity:9,accuracy:9,id:920440,logdata:%{TX.0},tag:application-multi,tag:language-multi,tag:platform-multi,tag:attack-protocol,tag:OWASP_CRS/POLICY/EXT_RESTRICTED,tag:WASCTC/WASC-15,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,setvar:tx.extension=.%{tx.1}/,deny,ctl:ruleEngine=On"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] T (0) urlDecodeUni: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] T (0) lowercase: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Transformation completed in 12 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Executing operator "rx" with param "\\.(.*)$<file:///\\.(.*)$>" against REQUEST_BASENAME.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Target value: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Added regex subexpression to TX.0: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Added regex subexpression to TX.1: php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Operator completed in 11 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Setting variable: tx.extension=.%{tx.1}/

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{tx.1} to: php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Set variable "tx.extension" to ".php/".

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Ctl: Set ruleEngine to On.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Rule returned 1.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Match, intercepted -> returning.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{TX.0} to: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{TX.0} to: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Access denied with code 403 (phase 2). Pattern match "\\.(.*)$<file:///\\.(.*)$>" at REQUEST_BASENAME.

[file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]




audit logs
------------


--54296d51-A--

[08/May/2017:11:28:14 --0500] WRCcnn8AAQEAAAt0ypkAAAAE 127.0.0.1 36183

127.0.0.1 80

--54296d51-B--

GET /forms.html? HTTP/1.1

Host: localhost

User-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive



--54296d51-F--

HTTP/1.1 403 Forbidden

Content-Length: 286

Keep-Alive: timeout=5, max=100

Connection: Keep-Alive

Content-Type: text/html; charset=iso-8859-1



--54296d51-H--

Message: Access denied with code 403 (phase 2). [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]

Action: Intercepted (phase 2)

Stopwatch: 1494260894110924 11283 (- - -)

Stopwatch2: 1494260894110924 11283; combined=6030, p1=2122, p2=3429, p3=0, p4=0, p5=479, sr=14, sw=0, l=0, gc=0

Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.

Server: Apache/2.4.7 (Ubuntu)

Engine-Mode: "ENABLED"



--54296d51-Z--


audit log when in detection mode  ( please note this is in case of an extension that is in the list )



--8092f761-A--
[09/May/2017:13:39:38 +0000] WRHGmawSZJUAADb7nuwAAAHN 40.77.167.66 54957 10.176.10.21 4464
--8092f761-B--
GET /activate.com?domainCPC=HCL&legacy=true HTTP/1.1

User-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive

--8092f761-F--
HTTP/1.1 404 Not Found
Content-Type: text/html;charset=UTF-8
Content-Language: en-US
Vary: Accept-Encoding,User-Agent
Content-Encoding: gzip
Connection: Keep-Alive
Transfer-Encoding: chunked

--8092f761-H--
Message: String match within ".asa/ .asax/ .ascx/ .axd/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/" at TX:extension. [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".com"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
Apache-Handler: proxy-server
Stopwatch: 1494337177995510 28864 (- - -)
Stopwatch2: 1494337177995510 28864; combined=1228, p1=291, p2=865, p3=1, p4=2, p5=69, sr=32, sw=0, l=0, gc=0
Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.
Server: Apache
Engine-Mode: "DETECTION_ONLY"

--8092f761-Z--


Thanks
Subin


Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170509/0d527d8a/attachment-0001.html>

From barry_pollard at hotmail.com  Tue May  9 18:59:53 2017
From: barry_pollard at hotmail.com (Barry Pollard)
Date: Tue, 9 May 2017 18:59:53 +0000
Subject: [Owasp-modsecurity-core-rule-set] Issues
	with	tx.restricted_extensions
In-Reply-To: <C310131DD0004743B2508B65C77B66317CEC6A06@PMEXGMB04.juniper.com>
References: <C310131DD0004743B2508B65C77B66317CEC6A06@PMEXGMB04.juniper.com>
Message-ID: <DB6PR0902MB219794A2D05469522178EA8682EF0@DB6PR0902MB2197.eurprd09.prod.outlook.com>

Rule 920440 looks to be in two parts but basically is this:


    SecRule REQUEST_BASENAME "\.(.*)$" "id:920440,chain,block...etc."
SecRule TX:EXTENSION "@within %{tx.restricted_extensions}" "..."

This basically says is there a dot in the request basename?
And, if so, is the Extension of that request a restricted one?

When you are running this:

SecRuleUpdateActionById 920440 "deny,ctl:ruleEngine=On"


You are overwriting the whole "action" part of first rule in this chain - and removing the "chain" part of this, so breaking the chain and splitting this into two rules:

    SecRule REQUEST_BASENAME "\.(.*)$" "id:920440,deny,ctl:ruleEngine=On"
    SecRule TX:EXTENSION "@within %{tx.restricted_extensions}" "..."


Effectively you're ignoring the second rule in the chain completely, so EVERY request with a dot in the basename is suddenly matching.


I'd imagine if you did something like this, to keep this as a chained rule, then it should work:


SecRuleUpdateActionById 920440 "deny,chain,ctl:ruleEngine=On"


Though not tried this myself admittedly.


In fact the ModSecurity Reference Manual (https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleUpdateActionById) does state:


Note : If the target rule is a chained rule, you must currently specify chain in the SecRuleUpdateActionById action list as well. This will be fixed in a future version.


Hope that helps,

Barry




________________________________
From: owasp-modsecurity-core-rule-set-bounces+barry_pollard=hotmail.com at lists.owasp.org <owasp-modsecurity-core-rule-set-bounces+barry_pollard=hotmail.com at lists.owasp.org> on behalf of Thayyile kandy, Subin : CSO GIS <sthayyilekan at BarclaycardUS.com>
Sent: 09 May 2017 17:27:30
To: owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: [Owasp-modsecurity-core-rule-set] Issues with tx.restricted_extensions


Hello

Im having some issues with some of my requests being blocked based on extension , I do not have .php or .html on my restricted extensions list.
Has anyone come across this before ?

This happens when I run in  detection mode by default and turn on blocking using

SecRuleUpdateActionById 920440 "deny,ctl:ruleEngine=On"

http://localhost /forms.php  (works fine)
http://localhost /forms.php?  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] )
http://localhost /forms.php?id=0  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] )
http://localhost /forms.html  (works fine)
http://localhost /forms.html?  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] )
http://localhost /forms.html?id=0  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] )


debug logs
-------------


[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Recipe: Invoking rule b6536900; [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1031"] [id "920430"] [rev "2"].

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][5] Rule b6536900:

SecRule "REQUEST_PROTOCOL" "!@within %{tx.allowed_http_versions}<mailto:!@within%20%25%7btx.allowed_http_versions%7d>"

"phase:request,nolog,auditlog,t:none,block,msg:'HTTP protocol version is not allowed by policy',severity:CRITICAL,rev:2,ver:OWASP_CRS/3.0.0,maturity:9,accuracy:9,id:920430,tag:application-multi,tag:language-multi,tag:platform-multi,tag:attack-protocol,tag:OWASP_CRS/POLICY/PROTOCOL_NOT_ALLOWED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A6,tag:PCI/6.5.10,logdata:%{matched_var},setvar:tx.msg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-OWASP_CRS/POLICY/PROTOCOL_NOT_ALLOWED-%{matched_var_name}=%{matched_var}"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Transformation completed in 0 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Executing operator "!within" with param "%{tx.allowed_http_versions}" against REQUEST_PROTOCOL.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Target value: "HTTP/1.1"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{tx.allowed_http_versions} to: HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Operator completed in 6 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Rule returned 0.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] No match, not chained -> mode NEXT_RULE.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Recipe: Invoking rule b652be08; [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"].

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][5] Rule b652be08: SecRule "REQUEST_BASENAME" "@rx \\.(.*)$<file:///\\.(.*)$>" "phase:request,nolog,auditlog,chain,capture,t:none,t:urlDecodeUni,t:lowercase,msg:'URL

file extension is restricted by policy',severity:CRITICAL,rev:2,ver:OWASP_CRS/3.0.0,maturity:9,accuracy:9,id:920440,logdata:%{TX.0},tag:application-multi,tag:language-multi,tag:platform-multi,tag:attack-protocol,tag:OWASP_CRS/POLICY/EXT_RESTRICTED,tag:WASCTC/WASC-15,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,setvar:tx.extension=.%{tx.1}/,deny,ctl:ruleEngine=On"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] T (0) urlDecodeUni: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] T (0) lowercase: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Transformation completed in 12 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Executing operator "rx" with param "\\.(.*)$<file:///\\.(.*)$>" against REQUEST_BASENAME.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Target value: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Added regex subexpression to TX.0: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Added regex subexpression to TX.1: php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Operator completed in 11 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Setting variable: tx.extension=.%{tx.1}/

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{tx.1} to: php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Set variable "tx.extension" to ".php/".

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Ctl: Set ruleEngine to On.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Rule returned 1.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Match, intercepted -> returning.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{TX.0} to: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{TX.0} to: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Access denied with code 403 (phase 2). Pattern match "\\.(.*)$<file:///\\.(.*)$>" at REQUEST_BASENAME.

[file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]




audit logs
------------


--54296d51-A--

[08/May/2017:11:28:14 --0500] WRCcnn8AAQEAAAt0ypkAAAAE 127.0.0.1 36183

127.0.0.1 80

--54296d51-B--

GET /forms.html? HTTP/1.1

Host: localhost

User-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive



--54296d51-F--

HTTP/1.1 403 Forbidden

Content-Length: 286

Keep-Alive: timeout=5, max=100

Connection: Keep-Alive

Content-Type: text/html; charset=iso-8859-1



--54296d51-H--

Message: Access denied with code 403 (phase 2). [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]

Action: Intercepted (phase 2)

Stopwatch: 1494260894110924 11283 (- - -)

Stopwatch2: 1494260894110924 11283; combined=6030, p1=2122, p2=3429, p3=0, p4=0, p5=479, sr=14, sw=0, l=0, gc=0

Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.

Server: Apache/2.4.7 (Ubuntu)

Engine-Mode: "ENABLED"



--54296d51-Z--


audit log when in detection mode  ( please note this is in case of an extension that is in the list )



--8092f761-A--
[09/May/2017:13:39:38 +0000] WRHGmawSZJUAADb7nuwAAAHN 40.77.167.66 54957 10.176.10.21 4464
--8092f761-B--
GET /activate.com?domainCPC=HCL&legacy=true HTTP/1.1

User-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive

--8092f761-F--
HTTP/1.1 404 Not Found
Content-Type: text/html;charset=UTF-8
Content-Language: en-US
Vary: Accept-Encoding,User-Agent
Content-Encoding: gzip
Connection: Keep-Alive
Transfer-Encoding: chunked

--8092f761-H--
Message: String match within ".asa/ .asax/ .ascx/ .axd/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/" at TX:extension. [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".com"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
Apache-Handler: proxy-server
Stopwatch: 1494337177995510 28864 (- - -)
Stopwatch2: 1494337177995510 28864; combined=1228, p1=291, p2=865, p3=1, p4=2, p5=69, sr=32, sw=0, l=0, gc=0
Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.
Server: Apache
Engine-Mode: "DETECTION_ONLY"

--8092f761-Z--


Thanks
Subin


Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170509/9882cc19/attachment-0001.html>

From sthayyilekan at BarclaycardUS.com  Tue May  9 19:25:05 2017
From: sthayyilekan at BarclaycardUS.com (Thayyile kandy, Subin : CSO GIS)
Date: Tue, 9 May 2017 19:25:05 +0000
Subject: [Owasp-modsecurity-core-rule-set] Issues
	with	tx.restricted_extensions
In-Reply-To: <DB6PR0902MB219794A2D05469522178EA8682EF0@DB6PR0902MB2197.eurprd09.prod.outlook.com>
References: <C310131DD0004743B2508B65C77B66317CEC6A06@PMEXGMB04.juniper.com>
	<DB6PR0902MB219794A2D05469522178EA8682EF0@DB6PR0902MB2197.eurprd09.prod.outlook.com>
Message-ID: <C310131DD0004743B2508B65C77B66317CEC6B49@PMEXGMB04.juniper.com>

Thanks very much Barry, It works perfectly after adding the chain in SecRuleUpdateActionById

Thanks
Subin

From: Barry Pollard [mailto:barry_pollard at hotmail.com]
Sent: Tuesday, May 09, 2017 15:00
To: Thayyile kandy, Subin : CSO GIS; owasp-modsecurity-core-rule-set at lists.owasp.org
Subject: Re: [Owasp-modsecurity-core-rule-set] Issues with tx.restricted_extensions


Rule 920440 looks to be in two parts but basically is this:


    SecRule REQUEST_BASENAME "\.(.*)$" "id:920440,chain,block...etc."
SecRule TX:EXTENSION "@within %{tx.restricted_extensions}" "..."

This basically says is there a dot in the request basename?
And, if so, is the Extension of that request a restricted one?

When you are running this:

SecRuleUpdateActionById 920440 "deny,ctl:ruleEngine=On"



You are overwriting the whole "action" part of first rule in this chain - and removing the "chain" part of this, so breaking the chain and splitting this into two rules:

    SecRule REQUEST_BASENAME "\.(.*)$" "id:920440,deny,ctl:ruleEngine=On"
    SecRule TX:EXTENSION "@within %{tx.restricted_extensions}" "..."


Effectively you're ignoring the second rule in the chain completely, so EVERY request with a dot in the basename is suddenly matching.



I'd imagine if you did something like this, to keep this as a chained rule, then it should work:


SecRuleUpdateActionById 920440 "deny,chain,ctl:ruleEngine=On"

Though not tried this myself admittedly.



In fact the ModSecurity Reference Manual (https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleUpdateActionById) does state:



Note : If the target rule is a chained rule, you must currently specify chain in the SecRuleUpdateActionById action list as well. This will be fixed in a future version.



Hope that helps,

Barry


________________________________
From: owasp-modsecurity-core-rule-set-bounces+barry_pollard=hotmail.com at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces+barry_pollard=hotmail.com at lists.owasp.org> <owasp-modsecurity-core-rule-set-bounces+barry_pollard=hotmail.com at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set-bounces+barry_pollard=hotmail.com at lists.owasp.org>> on behalf of Thayyile kandy, Subin : CSO GIS <sthayyilekan at BarclaycardUS.com<mailto:sthayyilekan at BarclaycardUS.com>>
Sent: 09 May 2017 17:27:30
To: owasp-modsecurity-core-rule-set at lists.owasp.org<mailto:owasp-modsecurity-core-rule-set at lists.owasp.org>
Subject: [Owasp-modsecurity-core-rule-set] Issues with tx.restricted_extensions


Hello

Im having some issues with some of my requests being blocked based on extension , I do not have .php or .html on my restricted extensions list.
Has anyone come across this before ?

This happens when I run in  detection mode by default and turn on blocking using

SecRuleUpdateActionById 920440 "deny,ctl:ruleEngine=On"

http://localhost /forms.php  (works fine)
http://localhost /forms.php?  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] )
http://localhost /forms.php?id=0  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] )
http://localhost /forms.html  (works fine)
http://localhost /forms.html?  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] )
http://localhost /forms.html?id=0  (blocked by : [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] )


debug logs
-------------


[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Recipe: Invoking rule b6536900; [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1031"] [id "920430"] [rev "2"].

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][5] Rule b6536900:

SecRule "REQUEST_PROTOCOL" "!@within %{tx.allowed_http_versions}<mailto:!@within%20%25%7btx.allowed_http_versions%7d>"

"phase:request,nolog,auditlog,t:none,block,msg:'HTTP protocol version is not allowed by policy',severity:CRITICAL,rev:2,ver:OWASP_CRS/3.0.0,maturity:9,accuracy:9,id:920430,tag:application-multi,tag:language-multi,tag:platform-multi,tag:attack-protocol,tag:OWASP_CRS/POLICY/PROTOCOL_NOT_ALLOWED,tag:WASCTC/WASC-21,tag:OWASP_TOP_10/A6,tag:PCI/6.5.10,logdata:%{matched_var},setvar:tx.msg=%{rule.msg},setvar:tx.anomaly_score=+%{tx.critical_anomaly_score},setvar:tx.%{rule.id}-OWASP_CRS/POLICY/PROTOCOL_NOT_ALLOWED-%{matched_var_name}=%{matched_var}"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Transformation completed in 0 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Executing operator "!within" with param "%{tx.allowed_http_versions}" against REQUEST_PROTOCOL.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Target value: "HTTP/1.1"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{tx.allowed_http_versions} to: HTTP/1.0 HTTP/1.1 HTTP/2 HTTP/2.0

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Operator completed in 6 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Rule returned 0.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] No match, not chained -> mode NEXT_RULE.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Recipe: Invoking rule b652be08; [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"].

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][5] Rule b652be08: SecRule "REQUEST_BASENAME" "@rx \\.(.*)$<file:///\\.(.*)$>" "phase:request,nolog,auditlog,chain,capture,t:none,t:urlDecodeUni,t:lowercase,msg:'URL

file extension is restricted by policy',severity:CRITICAL,rev:2,ver:OWASP_CRS/3.0.0,maturity:9,accuracy:9,id:920440,logdata:%{TX.0},tag:application-multi,tag:language-multi,tag:platform-multi,tag:attack-protocol,tag:OWASP_CRS/POLICY/EXT_RESTRICTED,tag:WASCTC/WASC-15,tag:OWASP_TOP_10/A7,tag:PCI/6.5.10,setvar:tx.extension=.%{tx.1}/,deny,ctl:ruleEngine=On"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] T (0) urlDecodeUni: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] T (0) lowercase: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Transformation completed in 12 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Executing operator "rx" with param "\\.(.*)$<file:///\\.(.*)$>" against REQUEST_BASENAME.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Target value: "forms.php"

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Added regex subexpression to TX.0: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Added regex subexpression to TX.1: php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Operator completed in 11 usec.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Setting variable: tx.extension=.%{tx.1}/

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{tx.1} to: php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Set variable "tx.extension" to ".php/".

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Ctl: Set ruleEngine to On.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Rule returned 1.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Match, intercepted -> returning.

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{TX.0} to: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][9] Resolved macro %{TX.0} to: .php

[08/May/2017:11:27:18 --0500]

[localhost/sid#b6968228][rid#b69c8058][/forms.php][4] Access denied with code 403 (phase 2). Pattern match "\\.(.*)$<file:///\\.(.*)$>" at REQUEST_BASENAME.

[file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".php"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]




audit logs
------------


--54296d51-A--

[08/May/2017:11:28:14 --0500] WRCcnn8AAQEAAAt0ypkAAAAE 127.0.0.1 36183

127.0.0.1 80

--54296d51-B--

GET /forms.html? HTTP/1.1

Host: localhost

User-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive



--54296d51-F--

HTTP/1.1 403 Forbidden

Content-Length: 286

Keep-Alive: timeout=5, max=100

Connection: Keep-Alive

Content-Type: text/html; charset=iso-8859-1



--54296d51-H--

Message: Access denied with code 403 (phase 2). [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"]

[line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".html"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]

Action: Intercepted (phase 2)

Stopwatch: 1494260894110924 11283 (- - -)

Stopwatch2: 1494260894110924 11283; combined=6030, p1=2122, p2=3429, p3=0, p4=0, p5=479, sr=14, sw=0, l=0, gc=0

Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.

Server: Apache/2.4.7 (Ubuntu)

Engine-Mode: "ENABLED"



--54296d51-Z--


audit log when in detection mode  ( please note this is in case of an extension that is in the list )



--8092f761-A--
[09/May/2017:13:39:38 +0000] WRHGmawSZJUAADb7nuwAAAHN 40.77.167.66 54957 10.176.10.21 4464
--8092f761-B--
GET /activate.com?domainCPC=HCL&legacy=true HTTP/1.1

User-Agent: Mozilla/5.0 (X11; Linux i686; rv:16.0) Gecko/20100101 Firefox/16.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive

--8092f761-F--
HTTP/1.1 404 Not Found
Content-Type: text/html;charset=UTF-8
Content-Language: en-US
Vary: Accept-Encoding,User-Agent
Content-Encoding: gzip
Connection: Keep-Alive
Transfer-Encoding: chunked

--8092f761-H--
Message: String match within ".asa/ .asax/ .ascx/ .axd/ .backup/ .bak/ .bat/ .cdx/ .cer/ .cfg/ .cmd/ .com/ .config/ .conf/ .cs/ .csproj/ .csr/ .dat/ .db/ .dbf/ .dll/ .dos/ .htr/ .htw/ .ida/ .idc/ .idq/ .inc/ .ini/ .key/ .licx/ .lnk/ .log/ .mdb/ .old/ .pass/ .pdb/ .pol/ .printer/ .pwd/ .resources/ .resx/ .sql/ .sys/ .vb/ .vbs/ .vbproj/ .vsdisco/ .webinfo/ .xsd/ .xsx/" at TX:extension. [file "/etc/modsecurity/modsecurity/owasp-modsecurity-crs-3.0-master/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "1058"] [id "920440"] [rev "2"] [msg "URL file extension is restricted by policy"] [data ".com"] [severity "CRITICAL"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/POLICY/EXT_RESTRICTED"] [tag "WASCTC/WASC-15"] [tag "OWASP_TOP_10/A7"] [tag "PCI/6.5.10"]
Apache-Handler: proxy-server
Stopwatch: 1494337177995510 28864 (- - -)
Stopwatch2: 1494337177995510 28864; combined=1228, p1=291, p2=865, p3=1, p4=2, p5=69, sr=32, sw=0, l=0, gc=0
Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.
Server: Apache
Engine-Mode: "DETECTION_ONLY"

--8092f761-Z--


Thanks
Subin


Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.

Barclaycard

www.barclaycardus.com<http://www.barclaycardus.com>

This email and any files transmitted with it may contain confidential and/or proprietary information. It is intended solely for the use of the individual or entity who is the intended recipient. Unauthorized use of this information is prohibited. If you have received this in error, please contact the sender by replying to this message and delete this material from any system it may be on.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170509/4203f2e9/attachment-0001.html>

From chaim at chaimsanders.com  Wed May 10 04:35:46 2017
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Wed, 10 May 2017 00:35:46 -0400
Subject: [Owasp-modsecurity-core-rule-set] Announcing OWASP Core Rule Set
	Version 3.0.1
Message-ID: <CAE8hE=ruqoj8apGTQTWPrK6ULkikLjOBSPbTHnBiq+LAua4mJQ@mail.gmail.com>

Dear community members,
The OWASP Core Rule Set team is pleased to announce the immediate
availability of CRS release v3.0.1 (
https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.1).

This is a maintenance release fixing a minor security issue and multiple
false positives. It also clarifies multiple comments in the documentation.

Highlights:

   - SECURITY: Removed insecure handling of X-Forwarded-For header. This
   request header can easily be faked by clients and is no longer being taken
   into consideration to define the TX.real_ip variable. It is still used in
   the generation of REMOTE_ADDR. Apache users may want to configure
   mod_remoteip. For Nginx and IIS, there are alternative approaches to take
   X-Forwarded-For into correct consideration.
   - Added support for MIME type application/soap+xml (as defined in RFC
   3902) This also means that you'll need to update the ModSecurity
   recommended rule 200000 if you make use of the XML request body processor:
      SecRule REQUEST_HEADERS:Content-Type
      "(?:application(?:/soap\+|/)|text/)xml" \
      "id:'200000',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML"
      - Reduced FPs in rules 920120, 932140, 941100, 941120, 942190,
   942360, and 942410
   - Extended rule 931000 to support the "file" scheme to fix a false
   negative
   - Fixed a bug in rule 931150 and moved the rule to PL2
   - Closed multiple @pmf evasions via the lowercase transformation
   - Reduced FPs by adding Wordpress Rule Exclusions


This release incorporates pull requests from 11 different people. The
project is also very happy to add Franziska B?hler and Christoph Hansen as
new CRS committers in the CONTRIBUTORS file!

In line with the new release policy, minor releases (e.g. 3.0.1), will not
add new detection rules or new features. Instead, they are meant as
maintenance releases reducing false positives, false negatives, and fixing
bugs.

Ideally you should be able to update your 3.0.0 rules with the new 3.0.1
rules without experiencing any problems. However, be aware that the
addition of the application/soap+xml content type demands an update of the
ModSecurity project recommended rule 200000. Additionally, if you run your
ModSecurity behind a proxy that sets the X-Forwarded-For header, your IP
collection will probably fail to work properly. You may want to look into
mod_remoteip or similar means to fill the variable REMOTE_ADDR correctly.

For a complete list of the changes in this release, see the CHANGES
document on GitHub
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/CHANGES

CRS 3.0.1 is the best stable release of the OWASP Core Rule Set. We advise
all users and providers of boxed CRS versions to update their setups.

CRS3 requires an Apache/IIS/Nginx web server with ModSecurity 2.8.0 or
higher.

Our GitHub repository is the preferred way to download and update CRS: $>
git clone https://github.com/SpiderLabs/owasp-modsecurity-crs.git

For detailed installation instructions, see the INSTALL document.
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/INSTALL


Sincerely,

The OWASP Core Rule Set Team

-- 
-- 
Chaim Sanders
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170510/56b23f41/attachment.html>

From Jens.Schleusener at t-online.de  Thu May 11 11:05:16 2017
From: Jens.Schleusener at t-online.de (Jens Schleusener)
Date: Thu, 11 May 2017 13:05:16 +0200 (CEST)
Subject: [Owasp-modsecurity-core-rule-set] Announcing OWASP Core Rule
	Set Version 3.0.1
In-Reply-To: <CAE8hE=ruqoj8apGTQTWPrK6ULkikLjOBSPbTHnBiq+LAua4mJQ@mail.gmail.com>
References: <CAE8hE=ruqoj8apGTQTWPrK6ULkikLjOBSPbTHnBiq+LAua4mJQ@mail.gmail.com>
Message-ID: <alpine.LSU.2.20.1705111245570.11781@schiller.site>

Hi,

> The OWASP Core Rule Set team is pleased to announce the immediate availability of CRS release v3.0.1
> (https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.1).

[... lines deleted ...]

> Ideally you should be able to update your 3.0.0 rules with the new 3.0.1 rules without experiencing any
> problems.

Unfortunately not: The access to my server was blocked!

But fortunately the problem was easily to find and after removing the 
("forgotten" debugging) line number 500

  SecRule REQUEST_URI "(.*)" "msg:'got %{tx.0}',id:22,capture"

in the file REQUEST-920-PROTOCOL-ENFORCEMENT.conf all seems to work again.

The difference in that file between 3.0.0 and 3.0.1 can be seen for e.g. 
on this page

  https://fossies.org/diffs/owasp-modsecurity-crs/3.0.0_vs_3.0.1/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf-diff.html

But the problem seems known

  https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/771

and I report it here only to save some people from potential trouble.

Regards

Jens

From christian.folini at netnea.com  Thu May 11 11:23:03 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Thu, 11 May 2017 13:23:03 +0200
Subject: [Owasp-modsecurity-core-rule-set] Announcing OWASP Core Rule
 Set Version 3.0.1
In-Reply-To: <alpine.LSU.2.20.1705111245570.11781@schiller.site>
References: <CAE8hE=ruqoj8apGTQTWPrK6ULkikLjOBSPbTHnBiq+LAua4mJQ@mail.gmail.com>
	<alpine.LSU.2.20.1705111245570.11781@schiller.site>
Message-ID: <20170511112303.4ch47hwv5krgexxh@leander>

Hi there,

Spot on. Thanks for reporting.
We noticed this issue last night and are currently preparing 3.0.2.

In the default install, a request passes that debug message.
A custom crs-setup.conf can lead to a block, though.

The messup came via mis-merging of a commit to solve the github issue 
719. Let's say Chaim and I cooperated to make this happen and
sneak it pass our pre-release testing
(See https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/771
for a writeup).

For the time being (until 3.0.2 is out like tonight or so):
 - Do as Jens described.
 or
 - SecRuleRemoveById 22
 or
 - Clone the latest v3.0/dev tree

We are sorry for pushing a broken rule out with a release. 
We are reviewing our release procedure now and hope to learn from this.
https://github.com/SpiderLabs/owasp-modsecurity-crs/wiki/Release-Procedure

If you have feedback on that, it's very welcome.

Best,

Christian







On Thu, May 11, 2017 at 01:05:16PM +0200, Jens Schleusener wrote:
> Hi,
> 
> > The OWASP Core Rule Set team is pleased to announce the immediate availability of CRS release v3.0.1
> > (https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.1).
> 
> [... lines deleted ...]
> 
> > Ideally you should be able to update your 3.0.0 rules with the new 3.0.1 rules without experiencing any
> > problems.
> .`

> Unfortunately not: The access to my server was blocked!
> 
> But fortunately the problem was easily to find and after removing the
> ("forgotten" debugging) line number 500
> 
>  SecRule REQUEST_URI "(.*)" "msg:'got %{tx.0}',id:22,capture"
> 
> in the file REQUEST-920-PROTOCOL-ENFORCEMENT.conf all seems to work again.
> 
> The difference in that file between 3.0.0 and 3.0.1 can be seen for e.g. on
> this page
> 
>  https://fossies.org/diffs/owasp-modsecurity-crs/3.0.0_vs_3.0.1/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf-diff.html
> 
> But the problem seems known
> 
>  https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/771
> 
> and I report it here only to save some people from potential trouble.
> 
> Regards
> 
> Jens
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From chaim at chaimsanders.com  Fri May 12 20:05:32 2017
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Fri, 12 May 2017 16:05:32 -0400
Subject: [Owasp-modsecurity-core-rule-set] OWASP Core Rule Set Version 3.0.2
	Released
Message-ID: <CAE8hE=pKkBGh8pUkBTEF-yrSgz8cjdNX3T7F4QiTV_3GfPEPtQ@mail.gmail.com>

Today we released OWASP CRS v3.0.2
<https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.2> (
https://github.com/SpiderLabs/owasp-modsecurity-crs/releases/tag/v3.0.2).
Earlier this week we released CRS 3.0.1. Unfortunately, there was an issue
where a debug rule, was included in the release. As a result of this we
have released a fix in the form of version 3.0.2. We are working hard on
our testing requirements to ensure that this doesn't happen again going
forward. In addition to the debug rule being removed, we've updated some of
the documentation and metadata tags to reflect the new 3.0.2 version. We
apologize for the inconvenience and thank those of you who reached out to
us with feedback on CRS v3.0.1. Have a wonderful day.

-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170512/721de355/attachment.html>

From ekb at bins.priv.at  Mon May 15 14:10:35 2017
From: ekb at bins.priv.at (Elmar K. Bins)
Date: Mon, 15 May 2017 16:10:35 +0200
Subject: [Owasp-modsecurity-core-rule-set] 500-to-403 rule failing
Message-ID: <20170515141034.ci6f3misqth5m5m4@nbmacvieebi.int.jumio.com>

Hello,

We're running mod_security plus current CRS (3.0.0-4) as an Apache module here.
I have set paranoia_mode to 2, so the rule in question (950100) fires, and it
should translate all internal errors to 403s towards the outside.

Now, some internal errors (500s) are NOT translated to 403s. :-(

I wonder if anybody else has run into this problem and whether there is
a solution out there. Googling got me nowhere yet.


Obfuscated curl, result and log output is below.

Thank you for any direction you could point me to,
							Elmar.



=== Client View ===

curl --insecure -X DELETE https://***** -H 'accept: application/json' -H 'authorization: Basic *****' -H 'cache-control: no-cache' -H ...

-->

{"httpStatus":"500","message":"Internal Server Error","requestURI":"https://*****"}


=== Server View ===

--b962e37c-A--
[15/May/2017:14:03:22 +0000] ************** 10.**.**.** 61134 10.**.**.** 443
--b962e37c-B--
DELETE /***** HTTP/1.1
Host: *****
accept: application/json
authorization: Basic *****
cache-control: no-cache
content-type: application/json

--b962e37c-F--
HTTP/1.1 403 Forbidden
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-TrackingId: 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc
Vary: Accept-Encoding
Content-Type: application/json
Connection: close
Transfer-Encoding: chunked

--b962e37c-E--

--b962e37c-H--
Message: Access denied with code 403 (phase 4). Pattern match "^5\\d{2}$" at RESPONSE_STATUS. [file "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-950-DATA-LEAKAGES.conf"] [line "93"] [id "950100"] [rev "3"] [msg "The Application Returned a 500-Level Status Code"] [data "Matched Data: 500 found within RESPONSE_STATUS: 500"] [severity "ERROR"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-disclosure"] [tag "WASCTC/WASC-13"] [tag "OWASP_TOP_10/A6"] [tag "PCI/6.5.6"] [tag "paranoia-level/2"]
Message: Warning. Operator GE matched 4 at TX:outbound_anomaly_score. [file "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf"] [line "82"] [id "980140"] [msg "Outbound Anomaly Score Exceeded (score 4): The Application Returned a 500-Level Status Code"] [tag "event-correlation"]
Action: Intercepted (phase 4)
Apache-Handler: proxy-server
Stopwatch: 1494857002287297 207077 (- - -)
Stopwatch2: 1494857002287297 207077; combined=18441, p1=681, p2=14548, p3=1891, p4=724, p5=597, sr=91, sw=0, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); OWASP_CRS/3.0.0.
Server: Apache
WebApp-Info: "netverify" "-" "-"
Engine-Mode: "ENABLED"

--b962e37c-Z--


==> apache-request.log <==
2017-05-15 14:03:22 UTC 10.**.**.** ***** - "DELETE ***** HTTP/1.1" 500 168 "-" "*****" 1071 3634 207355 on WRm1KgoKGoMAAD-yLjgAAABU - ***** TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 false 128 128 NULL 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc

==> apache-error.log <==
[Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity: Access denied with code 403 (phase 4). Pattern match "^5\\\\d{2}$" at RESPONSE_STATUS. [file "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-950-DATA-LEAKAGES.conf"] [line "93"] [id "950100"] [rev "3"] [msg "The Application Returned a 500-Level Status Code"] [data "Matched Data: 500 found within RESPONSE_STATUS: 500"] [severity "ERROR"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-disclosure"] [tag "WASCTC/WASC-13"] [tag "OWASP_TOP_10/A6"] [tag "PCI/6.5.6"] [tag "paranoia-level/2"] [hostname "*****"] [uri "/*****"] [unique_id "WRm1KgoKGoMAAD-yLjgAAABU"]

[Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity: Warning. Operator GE matched 4 at TX:outbound_anomaly_score. [file "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf"] [line "82"] [id "980140"] [msg "Outbound Anomaly Score Exceeded (score 4): The Application Returned a 500-Level Status Code"] [tag "event-correlation"] [hostname "*****"] [uri "/*****"] [unique_id "WRm1KgoKGoMAAD-yLjgAAABU"]


From edg at greenberg.org  Wed May 17 15:45:03 2017
From: edg at greenberg.org (Ed Greenberg)
Date: Wed, 17 May 2017 11:45:03 -0400
Subject: [Owasp-modsecurity-core-rule-set] Help interpreting rule violation
Message-ID: <a0363ab8-4fe9-b994-d26a-43da18de4070@greenberg.org>

I have a violation of 941100 as follows. I believe that it is 
false-positive, and I'm not sure whether it should be whitelisted.

--bf187d07-B--
GET /indexj.php HTTP/1.1
Accept: text/html, application/xhtml+xml, */*
Referer: 
http://www.bing.com/search?q=xxxxxxxx+online&src=IE-SearchBox&FORM=IE11SR
Accept-Language: en-US
User-Agent: Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko
Accept-Encoding: gzip, deflate
Host: www.xxxxxxxx.com
DNT: 1
Connection: Keep-Alive


--bf187d07-H--
Message: Warning. detected XSS using libinjection. [file 
"/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/REQUEST-941-APPLICATION-ATTACK-XSS.conf"] 
[line "56"] [id "941100"] [rev "2"] [msg "XSS Attack Detected via 
libinjection"] [data "Matched Data: connection found within 
REQUEST_HEADERS:Referer: http://www.bing.com/search?q=xxxxxxxx 
online&src=IE-SearchBox&FORM=IE11SR"] [severity "CRITICAL"] [ver 
"OWASP_CRS/3.0.0"] [maturity "1"] [accuracy "9"] [tag 
"application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag 
"attack-xss"] [tag "OWASP_CRS/WEB_ATTACK/XSS"] [tag "WASCTC/WASC-8"] 
[tag "WASCTC/WASC-22"] [tag "OWASP_TOP_10/A3"] [tag 
"OWASP_AppSensor/IE1"] [tag "CAPEC-242"]
Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file 
"/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] 
[line "57"] [id "949110"] [msg "Inbound Anomaly Score Exceeded (Total 
Score: 5)"] [severity "CRITICAL"] [tag "application-multi"] [tag 
"language-multi"] [tag "platform-multi"] [tag "attack-generic"]
Message: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. 
[file 
"/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/RESPONSE-980-CORRELATION.conf"] 
[line "73"] [id "980130"] [msg "Inbound Anomaly Score Exceeded (Total 
Inbound Score: 5 - SQLI=0,XSS=5,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0): 
XSS Attack Detected via libinjection"] [tag "event-correlation"]
Apache-Error: [file "apache2_util.c"] [line 271] [level 3] [client %s] 
ModSecurity: %s%s [uri "%s"]%s
Apache-Error: [file "apache2_util.c"] [line 271] [level 3] [client %s] 
ModSecurity: %s%s [uri "%s"]%s
Apache-Error: [file "apache2_util.c"] [line 271] [level 3] [client %s] 
ModSecurity: %s%s [uri "%s"]%s
Apache-Handler: proxy:unix:/var/run/php5-fpm.sock|fcgi://localhost
Stopwatch: 1495034424961653 46331 (- - -)
Stopwatch2: 1495034424961653 46331; combined=1346, p1=337, p2=706, 
p3=52, p4=155, p5=95, sr=53, sw=1, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/); 
OWASP_CRS/3.0.0.
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.1e-fips
Engine-Mode: "DETECTION_ONLY"

I will post more of the log entry if desired.

The request is legit - the index page of the site, and the error seems 
to object to the contents of the refering-page header line, which is a 
bing search request.

I don't understand how this is an XSS  attack.   The only special 
characters in it are & and ?.

I read the rule, but didn't see how it works. I am only an egg.

Could somebody explain?


From modsec at spam.lifeforms.nl  Wed May 17 16:55:38 2017
From: modsec at spam.lifeforms.nl (Walter Hop)
Date: Wed, 17 May 2017 18:55:38 +0200
Subject: [Owasp-modsecurity-core-rule-set] Help interpreting rule
 violation
In-Reply-To: <a0363ab8-4fe9-b994-d26a-43da18de4070@greenberg.org>
References: <a0363ab8-4fe9-b994-d26a-43da18de4070@greenberg.org>
Message-ID: <1EE59FF2-A9AA-4E49-A1B4-8D31B1AD3225@spam.lifeforms.nl>

Hi Ed,

> I have a violation of 941100 as follows. I believe that it is false-positive, and I'm not sure whether it should be whitelisted.
> 
> --bf187d07-B--
> GET /indexj.php HTTP/1.1
> Accept: text/html, application/xhtml+xml, */*
> Referer: http://www.bing.com/search?q=xxxxxxxx+online&src=IE-SearchBox&FORM=IE11SR <http://www.bing.com/search?q=xxxxxxxx+online&src=IE-SearchBox&FORM=IE11SR>

This is a known false positive in 3.0.0.

https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/663 <https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/663>

It has been solved in the new version 3.0.2.
If you upgrade your ruleset you will no longer have the problem.

Cheers!
WH
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170517/ab2020a5/attachment.html>

From paolo.luiseit at gmail.com  Thu May 18 15:52:59 2017
From: paolo.luiseit at gmail.com (Paolo Luise)
Date: Thu, 18 May 2017 17:52:59 +0200
Subject: [Owasp-modsecurity-core-rule-set] 500-to-403 rule failing
Message-ID: <CAPF6YCmQF3X7CPD5nNjqAcr0ZexJ=iUUSmDvMVtomwN5XyMr0A@mail.gmail.com>

Hello Elmar,
how is your SecRuleEngine directive configured?
If it's in DetectionOnly, as stated in the manual, in this way the WAF
engine "process rules but never executes any disruptive actions (block,
deny, drop, allow, proxy and redirect)"; rif.
https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleEngine

The rule you are speaking about contains the block (disruptive) action.

Please return us your feedback.

Regards
Paolo Luise



> Hello,
>
> We're running mod_security plus current CRS (3.0.0-4) as an Apache module
> here.
> I have set paranoia_mode to 2, so the rule in question (950100) fires, and
> it
> should translate all internal errors to 403s towards the outside.
>
> Now, some internal errors (500s) are NOT translated to 403s. :-(
>
> I wonder if anybody else has run into this problem and whether there is
> a solution out there. Googling got me nowhere yet.
>
>
> Obfuscated curl, result and log output is below.
>
> Thank you for any direction you could point me to,
>                                                         Elmar.
>
>
>
> === Client View ===
>
> curl --insecure -X DELETE https://***** -H 'accept: application/json' -H
> 'authorization: Basic *****' -H 'cache-control: no-cache' -H ...
>
> -->
>
> {"httpStatus":"500","message":"Internal Server
> Error","requestURI":"https://*****"}
>
>
> === Server View ===
>
> --b962e37c-A--
> [15/May/2017:14:03:22 +0000] ************** 10.**.**.** 61134 10.**.**.**
> 443
> --b962e37c-B--
> DELETE /***** HTTP/1.1
> Host: *****
> accept: application/json
> authorization: Basic *****
> cache-control: no-cache
> content-type: application/json
>
> --b962e37c-F--
> HTTP/1.1 403 Forbidden
> Strict-Transport-Security: max-age=31536000; includeSubDomains
> X-TrackingId: 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc
> Vary: Accept-Encoding
> Content-Type: application/json
> Connection: close
> Transfer-Encoding: chunked
>
> --b962e37c-E--
>
> --b962e37c-H--
> Message: Access denied with code 403 (phase 4). Pattern match "^5\\d{2}$"
> at RESPONSE_STATUS. [file "/etc/httpd/modsecurity.d/
> activated_rules/RESPONSE-950-DATA-LEAKAGES.conf"] [line "93"] [id
> "950100"] [rev "3"] [msg "The Application Returned a 500-Level Status
> Code"] [data "Matched Data: 500 found within RESPONSE_STATUS: 500"]
> [severity "ERROR"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"]
> [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"]
> [tag "attack-disclosure"] [tag "WASCTC/WASC-13"] [tag "OWASP_TOP_10/A6"]
> [tag "PCI/6.5.6"] [tag "paranoia-level/2"]
> Message: Warning. Operator GE matched 4 at TX:outbound_anomaly_score.
> [file "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf"]
> [line "82"] [id "980140"] [msg "Outbound Anomaly Score Exceeded (score 4):
> The Application Returned a 500-Level Status Code"] [tag "event-correlation"]
> Action: Intercepted (phase 4)
> Apache-Handler: proxy-server
> Stopwatch: 1494857002287297 207077 (- - -)
> Stopwatch2: 1494857002287297 207077; combined=18441, p1=681, p2=14548,
> p3=1891, p4=724, p5=597, sr=91, sw=0, l=0, gc=0
> Response-Body-Transformed: Dechunked
> Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/);
> OWASP_CRS/3.0.0.
> Server: Apache
> WebApp-Info: "netverify" "-" "-"
> Engine-Mode: "ENABLED"
>
> --b962e37c-Z--
>
>
> ==> apache-request.log <==
> 2017-05-15 14:03:22 UTC 10.**.**.** ***** - "DELETE ***** HTTP/1.1" 500
> 168 "-" "*****" 1071 3634 207355 on WRm1KgoKGoMAAD-yLjgAAABU - *****
> TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 false 128 128 NULL
> 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc
>
> ==> apache-error.log <==
> [Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity:
> Access denied with code 403 (phase 4). Pattern match "^5\\\\d{2}$" at
> RESPONSE_STATUS. [file "/etc/httpd/modsecurity.d/
> activated_rules/RESPONSE-950-DATA-LEAKAGES.conf"] [line "93"] [id
> "950100"] [rev "3"] [msg "The Application Returned a 500-Level Status
> Code"] [data "Matched Data: 500 found within RESPONSE_STATUS: 500"]
> [severity "ERROR"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"]
> [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"]
> [tag "attack-disclosure"] [tag "WASCTC/WASC-13"] [tag "OWASP_TOP_10/A6"]
> [tag "PCI/6.5.6"] [tag "paranoia-level/2"] [hostname "*****"] [uri
> "/*****"] [unique_id "WRm1KgoKGoMAAD-yLjgAAABU"]
>
> [Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity:
> Warning. Operator GE matched 4 at TX:outbound_anomaly_score. [file
> "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf"]
> [line "82"] [id "980140"] [msg "Outbound Anomaly Score Exceeded (score 4):
> The Application Returned a 500-Level Status Code"] [tag
> "event-correlation"] [hostname "*****"] [uri "/*****"] [unique_id
> "WRm1KgoKGoMAAD-yLjgAAABU"]
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170518/6e9dc41d/attachment.html>

From ekb at bins.priv.at  Mon May 22 06:04:45 2017
From: ekb at bins.priv.at (Elmar K. Bins)
Date: Mon, 22 May 2017 08:04:45 +0200
Subject: [Owasp-modsecurity-core-rule-set] 500-to-403 rule failing
Message-ID: <20170522060445.b6qts323xee62vb7@nbmacvieebi.local>

Re Paolo,

paolo.luiseit at gmail.com (Paolo Luise) wrote:

> how is your SecRuleEngine directive configured?

For most of our vhosts, including this one, it is of course set to "On".
Otherwise mod_security would have logged a "Warning" ;-)

I'm really curious if I'm the only one experiencing this strange issue,
where modsec logs "I'm sending a 403", but Apache giving me a 500, and
I can see nowhere in any log, why this would happen...

HTH,
	Elmar.


> If it's in DetectionOnly, as stated in the manual, in this way the WAF
> engine "process rules but never executes any disruptive actions (block,
> deny, drop, allow, proxy and redirect)"; rif.
> https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#SecRuleEngine
> 
> The rule you are speaking about contains the block (disruptive) action.
> 
> Please return us your feedback.
> 
> Regards
> Paolo Luise
> 
> 
> 
> > Hello,
> >
> > We're running mod_security plus current CRS (3.0.0-4) as an Apache module
> > here.
> > I have set paranoia_mode to 2, so the rule in question (950100) fires, and
> > it
> > should translate all internal errors to 403s towards the outside.
> >
> > Now, some internal errors (500s) are NOT translated to 403s. :-(
> >
> > I wonder if anybody else has run into this problem and whether there is
> > a solution out there. Googling got me nowhere yet.
> >
> >
> > Obfuscated curl, result and log output is below.
> >
> > Thank you for any direction you could point me to,
> >                                                         Elmar.
> >
> >
> >
> > === Client View ===
> >
> > curl --insecure -X DELETE https://***** -H 'accept: application/json' -H
> > 'authorization: Basic *****' -H 'cache-control: no-cache' -H ...
> >
> > -->
> >
> > {"httpStatus":"500","message":"Internal Server
> > Error","requestURI":"https://*****"}
> >
> >
> > === Server View ===
> >
> > --b962e37c-A--
> > [15/May/2017:14:03:22 +0000] ************** 10.**.**.** 61134 10.**.**.**
> > 443
> > --b962e37c-B--
> > DELETE /***** HTTP/1.1
> > Host: *****
> > accept: application/json
> > authorization: Basic *****
> > cache-control: no-cache
> > content-type: application/json
> >
> > --b962e37c-F--
> > HTTP/1.1 403 Forbidden
> > Strict-Transport-Security: max-age=31536000; includeSubDomains
> > X-TrackingId: 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc
> > Vary: Accept-Encoding
> > Content-Type: application/json
> > Connection: close
> > Transfer-Encoding: chunked
> >
> > --b962e37c-E--
> >
> > --b962e37c-H--
> > Message: Access denied with code 403 (phase 4). Pattern match "^5\\d{2}$"
> > at RESPONSE_STATUS. [file "/etc/httpd/modsecurity.d/
> > activated_rules/RESPONSE-950-DATA-LEAKAGES.conf"] [line "93"] [id
> > "950100"] [rev "3"] [msg "The Application Returned a 500-Level Status
> > Code"] [data "Matched Data: 500 found within RESPONSE_STATUS: 500"]
> > [severity "ERROR"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"]
> > [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"]
> > [tag "attack-disclosure"] [tag "WASCTC/WASC-13"] [tag "OWASP_TOP_10/A6"]
> > [tag "PCI/6.5.6"] [tag "paranoia-level/2"]
> > Message: Warning. Operator GE matched 4 at TX:outbound_anomaly_score.
> > [file "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf"]
> > [line "82"] [id "980140"] [msg "Outbound Anomaly Score Exceeded (score 4):
> > The Application Returned a 500-Level Status Code"] [tag "event-correlation"]
> > Action: Intercepted (phase 4)
> > Apache-Handler: proxy-server
> > Stopwatch: 1494857002287297 207077 (- - -)
> > Stopwatch2: 1494857002287297 207077; combined=18441, p1=681, p2=14548,
> > p3=1891, p4=724, p5=597, sr=91, sw=0, l=0, gc=0
> > Response-Body-Transformed: Dechunked
> > Producer: ModSecurity for Apache/2.9.1 (http://www.modsecurity.org/);
> > OWASP_CRS/3.0.0.
> > Server: Apache
> > WebApp-Info: "netverify" "-" "-"
> > Engine-Mode: "ENABLED"
> >
> > --b962e37c-Z--
> >
> >
> > ==> apache-request.log <==
> > 2017-05-15 14:03:22 UTC 10.**.**.** ***** - "DELETE ***** HTTP/1.1" 500
> > 168 "-" "*****" 1071 3634 207355 on WRm1KgoKGoMAAD-yLjgAAABU - *****
> > TLSv1.2 ECDHE-RSA-AES128-GCM-SHA256 false 128 128 NULL
> > 8ab4dc14-fbd0-4ecd-a2e4-5697a67017dc
> >
> > ==> apache-error.log <==
> > [Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity:
> > Access denied with code 403 (phase 4). Pattern match "^5\\\\d{2}$" at
> > RESPONSE_STATUS. [file "/etc/httpd/modsecurity.d/
> > activated_rules/RESPONSE-950-DATA-LEAKAGES.conf"] [line "93"] [id
> > "950100"] [rev "3"] [msg "The Application Returned a 500-Level Status
> > Code"] [data "Matched Data: 500 found within RESPONSE_STATUS: 500"]
> > [severity "ERROR"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"]
> > [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"]
> > [tag "attack-disclosure"] [tag "WASCTC/WASC-13"] [tag "OWASP_TOP_10/A6"]
> > [tag "PCI/6.5.6"] [tag "paranoia-level/2"] [hostname "*****"] [uri
> > "/*****"] [unique_id "WRm1KgoKGoMAAD-yLjgAAABU"]
> >
> > [Mon May 15 14:03:22 2017] [error] [client 10.**.**.**] ModSecurity:
> > Warning. Operator GE matched 4 at TX:outbound_anomaly_score. [file
> > "/etc/httpd/modsecurity.d/activated_rules/RESPONSE-980-CORRELATION.conf"]
> > [line "82"] [id "980140"] [msg "Outbound Anomaly Score Exceeded (score 4):
> > The Application Returned a 500-Level Status Code"] [tag
> > "event-correlation"] [hostname "*****"] [uri "/*****"] [unique_id
> > "WRm1KgoKGoMAAD-yLjgAAABU"]



From edg at greenberg.org  Tue May 23 13:06:21 2017
From: edg at greenberg.org (Ed Greenberg)
Date: Tue, 23 May 2017 09:06:21 -0400
Subject: [Owasp-modsecurity-core-rule-set] Inbound Anomaly Score Exceeded
Message-ID: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>

Something I don't understand. Here is a sample:



--6e7a4c70-E--

--6e7a4c70-H--
Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file 
"/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] 
[line "57"] [id "949110"] [msg "Inbound Anomaly Score Exceeded (Total 
Score: 5)"] [severity "CRITICAL"] [tag "application-multi"] [tag 
"language-multi"] [tag "platform-multi"] [tag "attack-generic"]
Message: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. 
[file 
"/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/RESPONSE-980-CORRELATION.conf"] 
[line "73"] [id "980130"] [msg "Inbound Anomaly Score Exceeded (Total 
Inbound Score: 5 - SQLI=0,XSS=5,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0):
Engine-Mode: "DETECTION_ONLY"

--6e7a4c70-Z--

I tried to post the entire log entry, but the barracuda that protects 
this list objected. I'm hoping that cutting down the content will work.

So I know that this is some sort of XSS problem, but no more than that. 
I checked with our web apps people, and the url parameters are quite 
legitimate.

What is the underlying rule that triggered this?  More importantly, how 
would I tell?

Finally, how do I turn this off so that the call continues to work once 
we take ModSecurity out of DETECTION_ONLY?


Thanks

Ed



From christian.folini at netnea.com  Tue May 23 13:37:18 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 23 May 2017 15:37:18 +0200
Subject: [Owasp-modsecurity-core-rule-set] Inbound Anomaly Score Exceeded
In-Reply-To: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>
References: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>
Message-ID: <20170523133718.5rjaasl23xawxwqi@leander>

Hey Ed,

It is hard to help you without seeing the rule alert. The alerts you
showed us are only the evaluation at the end.

Ahoj,

Christian

On Tue, May 23, 2017 at 09:06:21AM -0400, Ed Greenberg wrote:
> Something I don't understand. Here is a sample:
> 
> 
> 
> --6e7a4c70-E--
> 
> --6e7a4c70-H--
> Message: Warning. Operator GE matched 5 at TX:anomaly_score. [file "/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/REQUEST-949-BLOCKING-EVALUATION.conf"]
> [line "57"] [id "949110"] [msg "Inbound Anomaly Score Exceeded (Total Score:
> 5)"] [severity "CRITICAL"] [tag "application-multi"] [tag "language-multi"]
> [tag "platform-multi"] [tag "attack-generic"]
> Message: Warning. Operator GE matched 5 at TX:inbound_anomaly_score. [file
> "/etc/httpd/owasp-modsecurity-crs-3.0.0/rules/RESPONSE-980-CORRELATION.conf"]
> [line "73"] [id "980130"] [msg "Inbound Anomaly Score Exceeded (Total
> Inbound Score: 5 - SQLI=0,XSS=5,RFI=0,LFI=0,RCE=0,PHPI=0,HTTP=0,SESS=0):
> Engine-Mode: "DETECTION_ONLY"
> 
> --6e7a4c70-Z--
> 
> I tried to post the entire log entry, but the barracuda that protects this
> list objected. I'm hoping that cutting down the content will work.
> 
> So I know that this is some sort of XSS problem, but no more than that. I
> checked with our web apps people, and the url parameters are quite
> legitimate.
> 
> What is the underlying rule that triggered this?  More importantly, how
> would I tell?
> 
> Finally, how do I turn this off so that the call continues to work once we
> take ModSecurity out of DETECTION_ONLY?
> 
> 
> Thanks
> 
> Ed
> 
> 
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From edg at greenberg.org  Tue May 23 13:40:07 2017
From: edg at greenberg.org (Ed Greenberg)
Date: Tue, 23 May 2017 09:40:07 -0400
Subject: [Owasp-modsecurity-core-rule-set] Inbound Anomaly Score Exceeded
In-Reply-To: <20170523133718.5rjaasl23xawxwqi@leander>
References: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>
	<20170523133718.5rjaasl23xawxwqi@leander>
Message-ID: <2e9abb4d-fe26-c45c-545f-d6d2e42e12b7@greenberg.org>

On 05/23/2017 09:37 AM, Christian Folini wrote:
> Hey Ed,
>
> It is hard to help you without seeing the rule alert. The alerts you
> showed us are only the evaluation at the end.

Christian,

Thanks for all you do to support these rules. I appreciate it.

The entire log entry can be found at https://pastebin.com/6RSqP9Js

Even pastebin required me to solve a captcha to post it, so it must 
trigger some sort of filter.

Thanks,

Ed

From christian.folini at netnea.com  Tue May 23 14:03:06 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 23 May 2017 16:03:06 +0200
Subject: [Owasp-modsecurity-core-rule-set] Inbound Anomaly Score Exceeded
In-Reply-To: <2e9abb4d-fe26-c45c-545f-d6d2e42e12b7@greenberg.org>
References: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>
	<20170523133718.5rjaasl23xawxwqi@leander>
	<2e9abb4d-fe26-c45c-545f-d6d2e42e12b7@greenberg.org>
Message-ID: <20170523140306.wzl2uzd7ez4fgbx6@leander>

Hi Ed,

That's a mean one.

You are suffering from this bug:
https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/704

It's raising your score silently to 5 - without showing you the rule
that triggered.

Upgrading to 3.0.2 will solve this. If you still have problems, then
you should hand the false positives. The tutorials at netnea.com
can teach you how.

Ahoj,

Christian

On Tue, May 23, 2017 at 09:40:07AM -0400, Ed Greenberg wrote:
> On 05/23/2017 09:37 AM, Christian Folini wrote:
> > Hey Ed,
> > 
> > It is hard to help you without seeing the rule alert. The alerts you
> > showed us are only the evaluation at the end.
> 
> Christian,
> 
> Thanks for all you do to support these rules. I appreciate it.
> 
> The entire log entry can be found at https://pastebin.com/6RSqP9Js
> 
> Even pastebin required me to solve a captcha to post it, so it must trigger
> some sort of filter.
> 
> Thanks,
> 
> Ed

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From edg at greenberg.org  Tue May 23 14:06:00 2017
From: edg at greenberg.org (Ed Greenberg)
Date: Tue, 23 May 2017 10:06:00 -0400
Subject: [Owasp-modsecurity-core-rule-set] Inbound Anomaly Score Exceeded
In-Reply-To: <20170523140306.wzl2uzd7ez4fgbx6@leander>
References: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>
	<20170523133718.5rjaasl23xawxwqi@leander>
	<2e9abb4d-fe26-c45c-545f-d6d2e42e12b7@greenberg.org>
	<20170523140306.wzl2uzd7ez4fgbx6@leander>
Message-ID: <904f9345-ac9e-1168-5ada-4972ec15e51e@greenberg.org>

We've deployed 3.0.2 today. I had it in testing, and forgot that I 
needed to push it out.  I'll keep an eye on things.

Thanks,
Ed

On 05/23/2017 10:03 AM, Christian Folini wrote:
> Hi Ed,
>
> That's a mean one.
>
> You are suffering from this bug:
> https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/704
>
> It's raising your score silently to 5 - without showing you the rule
> that triggered.
>
> Upgrading to 3.0.2 will solve this. If you still have problems, then
> you should hand the false positives. The tutorials at netnea.com
> can teach you how.
>
> Ahoj,
>
> Christian
>
> On Tue, May 23, 2017 at 09:40:07AM -0400, Ed Greenberg wrote:
>> On 05/23/2017 09:37 AM, Christian Folini wrote:
>>> Hey Ed,
>>>
>>> It is hard to help you without seeing the rule alert. The alerts you
>>> showed us are only the evaluation at the end.
>> Christian,
>>
>> Thanks for all you do to support these rules. I appreciate it.
>>
>> The entire log entry can be found at https://pastebin.com/6RSqP9Js
>>
>> Even pastebin required me to solve a captcha to post it, so it must trigger
>> some sort of filter.
>>
>> Thanks,
>>
>> Ed



From christian.folini at netnea.com  Tue May 23 14:07:03 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 23 May 2017 16:07:03 +0200
Subject: [Owasp-modsecurity-core-rule-set] Inbound Anomaly Score Exceeded
In-Reply-To: <904f9345-ac9e-1168-5ada-4972ec15e51e@greenberg.org>
References: <e0931298-0af6-6120-fe47-b1be54326794@greenberg.org>
	<20170523133718.5rjaasl23xawxwqi@leander>
	<2e9abb4d-fe26-c45c-545f-d6d2e42e12b7@greenberg.org>
	<20170523140306.wzl2uzd7ez4fgbx6@leander>
	<904f9345-ac9e-1168-5ada-4972ec15e51e@greenberg.org>
Message-ID: <20170523140703.hzeah2a3ozwaxk4q@leander>

+1

On Tue, May 23, 2017 at 10:06:00AM -0400, Ed Greenberg wrote:
> We've deployed 3.0.2 today. I had it in testing, and forgot that I needed to
> push it out.  I'll keep an eye on things.
> 
> Thanks,
> Ed
> 
> On 05/23/2017 10:03 AM, Christian Folini wrote:
> > Hi Ed,
> > 
> > That's a mean one.
> > 
> > You are suffering from this bug:
> > https://github.com/SpiderLabs/owasp-modsecurity-crs/issues/704
> > 
> > It's raising your score silently to 5 - without showing you the rule
> > that triggered.
> > 
> > Upgrading to 3.0.2 will solve this. If you still have problems, then
> > you should hand the false positives. The tutorials at netnea.com
> > can teach you how.
> > 
> > Ahoj,
> > 
> > Christian
> > 
> > On Tue, May 23, 2017 at 09:40:07AM -0400, Ed Greenberg wrote:
> > > On 05/23/2017 09:37 AM, Christian Folini wrote:
> > > > Hey Ed,
> > > > 
> > > > It is hard to help you without seeing the rule alert. The alerts you
> > > > showed us are only the evaluation at the end.
> > > Christian,
> > > 
> > > Thanks for all you do to support these rules. I appreciate it.
> > > 
> > > The entire log entry can be found at https://pastebin.com/6RSqP9Js
> > > 
> > > Even pastebin required me to solve a captcha to post it, so it must trigger
> > > some sort of filter.
> > > 
> > > Thanks,
> > > 
> > > Ed
> 

-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From edg at greenberg.org  Tue May 23 19:30:27 2017
From: edg at greenberg.org (Ed Greenberg)
Date: Tue, 23 May 2017 15:30:27 -0400
Subject: [Owasp-modsecurity-core-rule-set] 503, 404,
	etc from underlying web server
Message-ID: <076b760c-7430-9914-9e7f-60bec76bcaf2@greenberg.org>

When a web server throws an error (>399)  does that automagically 
trigger an entry in modsec_audit.log?

Example at: https://pastebin.com/Uur7rmes

Note: paste expires May 30.

If this is the case, can this log entry be turned off?

Thanks,

Ed


From christian.folini at netnea.com  Tue May 23 19:43:23 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Tue, 23 May 2017 21:43:23 +0200
Subject: [Owasp-modsecurity-core-rule-set] 503, 404,
 etc from underlying web server
In-Reply-To: <076b760c-7430-9914-9e7f-60bec76bcaf2@greenberg.org>
References: <076b760c-7430-9914-9e7f-60bec76bcaf2@greenberg.org>
Message-ID: <20170523194323.wejivdmb7mqneyyu@leander>

Ed,

On Tue, May 23, 2017 at 03:30:27PM -0400, Ed Greenberg wrote:
> When a web server throws an error (>399)  does that automagically trigger an
> entry in modsec_audit.log?

It depends on your setting of SecAuditLogRelevantStatus (and
also the setting of SecAuditEngine).

Ahoj,

Christian


-- 
The intersection of all majorities is the empty set - The 
union of even the smallest minorities is the universal set.
--- Linus Thorvalds

From oelnaggar04 at gmail.com  Sun May 28 03:02:08 2017
From: oelnaggar04 at gmail.com (Osama Elnaggar)
Date: Sat, 27 May 2017 23:02:08 -0400
Subject: [Owasp-modsecurity-core-rule-set] OWASP AppSecEU Videos + OWASP CRS
	Presentation
Message-ID: <CACva_gHSNKuOmJHDbjNSp=VdN5BkQCKWs47N6ZpO3iK6yFVDEA@mail.gmail.com>

Hi,

OWASP AppSec Europe (https://2017.appsec.eu/) just released the videos for
all the sessions.  Lots of good presentations (all application security
specific), including one on the OWASP CRS by Christian Folini -
https://www.youtube.com/watch?v=eO9gBAmKS58&index=27&list=PLpr-xdpM8wG8RHOguwOZhUHkKiDeWpvFp


The full video list is available over here -
https://www.youtube.com/playlist?list=PLpr-xdpM8wG8RHOguwOZhUHkKiDeWpvFp

-- 
Osama Elnaggar
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170527/a9d737d4/attachment.html>

From christian.folini at netnea.com  Mon May 29 03:38:04 2017
From: christian.folini at netnea.com (Christian Folini)
Date: Mon, 29 May 2017 05:38:04 +0200
Subject: [Owasp-modsecurity-core-rule-set] OWASP AppSecEU Videos + OWASP
 CRS Presentation
In-Reply-To: <CACva_gHSNKuOmJHDbjNSp=VdN5BkQCKWs47N6ZpO3iK6yFVDEA@mail.gmail.com>
References: <CACva_gHSNKuOmJHDbjNSp=VdN5BkQCKWs47N6ZpO3iK6yFVDEA@mail.gmail.com>
Message-ID: <20170529033804.dll2e72hiotwyjwx@leander>

Thank you Osama. I was not even aware they have been uploaded.

That was quick (given there were over 60 talks!)

Christian

On Sat, May 27, 2017 at 11:02:08PM -0400, Osama Elnaggar wrote:
> Hi,
> 
> OWASP AppSec Europe (https://2017.appsec.eu/) just released the videos for
> all the sessions.  Lots of good presentations (all application security
> specific), including one on the OWASP CRS by Christian Folini -
> https://www.youtube.com/watch?v=eO9gBAmKS58&index=27&list=PLpr-xdpM8wG8RHOguwOZhUHkKiDeWpvFp
> 
> 
> The full video list is available over here -
> https://www.youtube.com/playlist?list=PLpr-xdpM8wG8RHOguwOZhUHkKiDeWpvFp
> 
> -- 
> Osama Elnaggar

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


-- 
https://www.feistyduck.com/training/modsecurity-training-course
mailto:christian.folini at netnea.com
twitter: @ChrFolini

From Brian.Bird at securetrading.com  Tue May 30 09:45:26 2017
From: Brian.Bird at securetrading.com (Brian Bird)
Date: Tue, 30 May 2017 09:45:26 +0000
Subject: [Owasp-modsecurity-core-rule-set] SecRuleUpdateActionById and
	chained rules
Message-ID: <560828A85A22484C8AA3AD2538FDFC27173B9F85@STEXCHANGE-01.ad.securetrading.com>

I'm deploying modsecurity 2.9.1 with the OWASP CRS 3.0.2 rules.

I'd like to update a few rules to have different anomaly scores. This is quite easy for a normal rule: eg.
SecRuleUpdateActionById 920350 "setvar:tx.anomaly_score=+100"

However, for chained rules this type of update will only update the first rule in the chain. Eg.
SecRuleUpdateActionById 920440 "setvar:tx.anomaly_score=+100,chain"

Since the action is non-disruptive the score addition takes place whenever the first rule in the chain matches (as referenced http://blog.modsecurity.org/2008/07/modsecurity-tri.html).

Has anything been done to allow SecRuleUpdateActionById to specify offsets (eg. as suggested at https://github.com/SpiderLabs/ModSecurity/issues/190)?

I tried this:
SecRuleUpdateActionById 920440:1 "setvar:tx.anomaly_score=+100,chain"
and there is no error about the Rule Id not existing, but it doesn't seem like the update has taken place. I'm assuming this feature suggestion hasn't been implemented yet and the update action is ignored because there is no rule id "920440:1"?

So my question is: Is it possible to change the anomaly score for a specified chained rule in the CRS without editing the CRS files directly?

Thanks

Brian


-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170530/25a97dfa/attachment.html>

From airween at gmail.com  Tue May 30 14:19:46 2017
From: airween at gmail.com (Ervin =?utf-8?Q?Heged=C3=BCs?=)
Date: Tue, 30 May 2017 16:19:46 +0200
Subject: [Owasp-modsecurity-core-rule-set] Matched rule modification
Message-ID: <20170530141946.GA26620@arxnet.hu>

Hi,

there is an existing web application, which have an API: the
client sends the requests to server in a fixed structure, and the
server answers to them. This app works since 4 years.

Now I've installed Libmodsecurity, and OWASP CRS (3.0.2).

Here is a client request (HTTP POST)

action	filter_tree
extraParams	{"sort":"folderid"}
node	0
table	tea_user_folders

In extraParams, there could be several keys and values.

The modsecurity bans this request with these lines (in
audit.log):

---1InxQ6aA---B--
POST /api/tree HTTP/1.1
Referer: http://my.app/
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip, deflate
Cookie: _ga=GA1.2.978766370.1489422665; PHPSESSID=bbfcaq0r0ahruiqn49mjg9bcc6
Content-Length: 94
Accept-Language: hu-HU,hu;q=0.8,en-US;q=0.5,en;q=0.3
Accept: */*
Cache-Control: max-age=0
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0
Host: my.app
Connection: keep-alive

---1InxQ6aA---D--

---1InxQ6aA---F--
Server: nginx/1.6.2
Date: Tue, 30 May 2017 13:55:47 GMT
Content-Length: 168
Content-Type: text/html
Connection: keep-alive

---1InxQ6aA---H--
ModSecurity: Warning. Matched "Operator `Rx' with parameter `(?i)(?:;|\{|\||\|\||&|&&|\n|\r|`)\s*[\(,@\'\"\s]*(?:[\w'\"\./]+/|[\\\\'\"\^]*\w[\\\\'\"\^]*:.*\\\\|[\^\.\w'\"/\\\\]*\\\\)?[\"\^]*(?:s[\"\^]*(?:y[\"\^]*s[\"\^]*(?:t[\"\^]*e[\"\^]*m[\"\^]*(?:p[\"\^]*r[ (5092 characters omitted)' against variable `ARGS:extraParams' (Value: `{"sort":"folderid"}' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf"] [line "182"] [id "932115"] [rev "4"] [msg "Remote Command Execution: Windows Command Injection"] [data "Matched Data: {"sort found within ARGS:extraParams: {"sort":"folderid"}"] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "8"] [tag "application-multi"] [tag "language-shell"] [tag "platform-windows"] [tag "attack-rce"] [tag "OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION"] [tag "WASCTC/WASC-31"] [tag "OWASP_TOP_10/A1"] [tag "PCI/6.5.2"] [ref "o0,6v621,19"]
ModSecurity: Warning. Matched "Operator `Ge' with parameter `%{tx.inbound_anomaly_score_threshold}' against variable `TX:ANOMALY_SCORE' (Value: `5' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] [line "36"] [id "949110"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Score: 5)"] [data ""] [severity "2"] [ver ""] [maturity "0"] [accuracy "0"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-generic"] [ref ""]
ModSecurity: Warning. Matched "Operator `Ge' with parameter `%{tx.inbound_anomaly_score_threshold}' against variable `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf"] [line "61"] [id "980130"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Inbound Score: 5 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=5,PHPI=0,HTTP=0,SESS=0): Remote Command Execution: Windows Command Injection'"] [data ""] [severity "0"] [ver ""] [maturity "0"] [accuracy "0"] [tag "event-correlation"] [ref ""]

---1InxQ6aA---I--


My question is: what can I do?
- ignore that rule (remove the /etc/nginx/owasp-modsecurity-crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf file?)
- change the "sort" keyword in full API (that would be a very
  hard work)? (and what should be the good choice? eg.
  "sorting"?)

There isn't any Windows based OS, there are several Linux
containers, and nGInx is a front-end proxy.


Many thanks,


a.

From chaim at chaimsanders.com  Wed May 31 01:15:53 2017
From: chaim at chaimsanders.com (Chaim Sanders)
Date: Tue, 30 May 2017 21:15:53 -0400
Subject: [Owasp-modsecurity-core-rule-set] Matched rule modification
In-Reply-To: <20170530141946.GA26620@arxnet.hu>
References: <20170530141946.GA26620@arxnet.hu>
Message-ID: <CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>

Hey Ervin,
Thanks for the report. It it is a combination of the curly and the word
'sort' (https://regex101.com/r/oV5rl6/1). As you noted this is a new rule
to the 3.x branch. Put together based on the list available here:
https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/util/regexp-assemble/regexp-932115.txt.
There is probably an argument to be made for removing 'sort' from this
list. The other item of interest here is ModSecurity's pretty poor job at
being able to parse JSON (which this looks to be). In any event, I think it
is something we can probably address. At least for this version (3.0.2) you
can either add an exception for that argument to this rule (see below), or
rebuild the regex as outlined in the rule. If you wouldn't mind opening an
issue on our GitHub, we'll be able to have a more persistent log of the
issue and also be able to reach out to you if we have more questions. If
you don't have a GitHub or don't want to take the time I can also do it,
just let me know! Thanks!

SecRule REQUEST_URI "@beginsWith /api/tree"
"id:1001,phase:1,pass,nolog,ctl:ruleRemoveTargetById=932115;ARGS:ExtraParams"

On Tue, May 30, 2017 at 10:19 AM, Ervin Heged?s <airween at gmail.com> wrote:

> Hi,
>
> there is an existing web application, which have an API: the
> client sends the requests to server in a fixed structure, and the
> server answers to them. This app works since 4 years.
>
> Now I've installed Libmodsecurity, and OWASP CRS (3.0.2).
>
> Here is a client request (HTTP POST)
>
> action  filter_tree
> extraParams     {"sort":"folderid"}
> node    0
> table   tea_user_folders
>
> In extraParams, there could be several keys and values.
>
> The modsecurity bans this request with these lines (in
> audit.log):
>
> ---1InxQ6aA---B--
> POST /api/tree HTTP/1.1
> Referer: http://my.app/
> Content-Type: application/x-www-form-urlencoded; charset=UTF-8
> X-Requested-With: XMLHttpRequest
> Accept-Encoding: gzip, deflate
> Cookie: _ga=GA1.2.978766370.1489422665; PHPSESSID=
> bbfcaq0r0ahruiqn49mjg9bcc6
> Content-Length: 94
> Accept-Language: hu-HU,hu;q=0.8,en-US;q=0.5,en;q=0.3
> Accept: */*
> Cache-Control: max-age=0
> User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101
> Firefox/53.0
> Host: my.app
> Connection: keep-alive
>
> ---1InxQ6aA---D--
>
> ---1InxQ6aA---F--
> Server: nginx/1.6.2
> Date: Tue, 30 May 2017 13:55:47 GMT
> Content-Length: 168
> Content-Type: text/html
> Connection: keep-alive
>
> ---1InxQ6aA---H--
> ModSecurity: Warning. Matched "Operator `Rx' with parameter
> `(?i)(?:;|\{|\||\|\||&|&&|\n|\r|`)\s*[\(,@\'\"\s]*(?:[\w'\"\
> ./]+/|[\\\\'\"\^]*\w[\\\\'\"\^]*:.*\\\\|[\^\.\w'\"/\\\\]*\\\
> \)?[\"\^]*(?:s[\"\^]*(?:y[\"\^]*s[\"\^]*(?:t[\"\^]*e[\"\^]*m[\"\^]*(?:p[\"\^]*r[
> (5092 characters omitted)' against variable `ARGS:extraParams' (Value:
> `{"sort":"folderid"}' ) [file "/etc/nginx/owasp-modsecurity-
> crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf"] [line "182"] [id
> "932115"] [rev "4"] [msg "Remote Command Execution: Windows Command
> Injection"] [data "Matched Data: {"sort found within ARGS:extraParams:
> {"sort":"folderid"}"] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> [accuracy "8"] [tag "application-multi"] [tag "language-shell"] [tag
> "platform-windows"] [tag "attack-rce"] [tag "OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION"]
> [tag "WASCTC/WASC-31"] [tag "OWASP_TOP_10/A1"] [tag "PCI/6.5.2"] [ref
> "o0,6v621,19"]
> ModSecurity: Warning. Matched "Operator `Ge' with parameter
> `%{tx.inbound_anomaly_score_threshold}' against variable
> `TX:ANOMALY_SCORE' (Value: `5' ) [file "/etc/nginx/owasp-modsecurity-
> crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] [line "36"] [id
> "949110"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Score: 5)"]
> [data ""] [severity "2"] [ver ""] [maturity "0"] [accuracy "0"] [tag
> "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> "attack-generic"] [ref ""]
> ModSecurity: Warning. Matched "Operator `Ge' with parameter
> `%{tx.inbound_anomaly_score_threshold}' against variable
> `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file
> "/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf"]
> [line "61"] [id "980130"] [rev ""] [msg "Inbound Anomaly Score Exceeded
> (Total Inbound Score: 5 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=5,PHPI=0,HTTP=0,SESS=0):
> Remote Command Execution: Windows Command Injection'"] [data ""] [severity
> "0"] [ver ""] [maturity "0"] [accuracy "0"] [tag "event-correlation"] [ref
> ""]
>
> ---1InxQ6aA---I--
>
>
> My question is: what can I do?
> - ignore that rule (remove the /etc/nginx/owasp-modsecurity-
> crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf file?)
> - change the "sort" keyword in full API (that would be a very
>   hard work)? (and what should be the good choice? eg.
>   "sorting"?)
>
> There isn't any Windows based OS, there are several Linux
> containers, and nGInx is a front-end proxy.
>
>
> Many thanks,
>
>
> a.
> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
>



-- 
-- 
Chaim Sanders
http://www.ChaimSanders.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.owasp.org/pipermail/owasp-modsecurity-core-rule-set/attachments/20170530/743f7c06/attachment.html>

From airween at gmail.com  Wed May 31 06:32:03 2017
From: airween at gmail.com (Ervin =?utf-8?Q?Heged=C3=BCs?=)
Date: Wed, 31 May 2017 08:32:03 +0200
Subject: [Owasp-modsecurity-core-rule-set] Matched rule modification
In-Reply-To: <CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
References: <20170530141946.GA26620@arxnet.hu>
	<CAE8hE=q5=TCD+3SgucWpLv1HiQPXooHFiSOnm4KFMMoNiuY9sQ@mail.gmail.com>
Message-ID: <20170531063203.GB1908@arxnet.hu>

Hi Chaim,

many thanks for your detailed answer.

On Tue, May 30, 2017 at 09:15:53PM -0400, Chaim Sanders wrote:
> Hey Ervin,
> Thanks for the report. It it is a combination of the curly and the word
> 'sort' (https://regex101.com/r/oV5rl6/1). As you noted this is a new rule
> to the 3.x branch. Put together based on the list available here:
> https://github.com/SpiderLabs/owasp-modsecurity-crs/blob/v3.0/master/util/regexp-assemble/regexp-932115.txt.
> There is probably an argument to be made for removing 'sort' from this
> list. 

you propose should I remove the "sort" word from that list, and
re-assemble the CSR? (I just grabbed the CSR rules, and made a
package for my Debian distros.)

> The other item of interest here is ModSecurity's pretty poor job at
> being able to parse JSON (which this looks to be). In any event, I think it
> is something we can probably address. At least for this version (3.0.2) you
> can either add an exception for that argument to this rule (see below),

thanks, I'll check out your example.

>  or
> rebuild the regex as outlined in the rule.

yep', now I reviewed the rule file, and I found the rebuild flow - thanks.

> If you wouldn't mind opening an
> issue on our GitHub, we'll be able to have a more persistent log of the
> issue and also be able to reach out to you if we have more questions. If
> you don't have a GitHub or don't want to take the time I can also do it,
> just let me know! Thanks!

I thank you - I have Github account (@airween), and I think that
would be bigger help to you, when I open a new issue. Just let me
know, what should I put the riport?

> SecRule REQUEST_URI "@beginsWith /api/tree"
> "id:1001,phase:1,pass,nolog,ctl:ruleRemoveTargetById=932115;ARGS:ExtraParams"

thanks again.

And there is an another issue with 3.0.2 (but may be that affects
another versions too).

The request is similar that I detailed in my first post. The
"extraParams" value (JSON field) is this:

extraParams {"node":"3","text":"v?gs? fejezet"}

As you can see, this is a UTF8 text, and client sends it as UTF8:

Content-Type: application/x-www-form-urlencoded; charset=UTF-8
X-Requested-With: XMLHttpRequest
Accept-Encoding: gzip, deflate

The encoded URI will be:

extraParams=%7B%22node%22%3A%223%22%2C%22text%22%3A%22v%C3%A9gs%C5%91%20fejezet%22

The characters "?" and "?" are two bytes utf8 characters:
\xC3\xA9 and \xC5\x91.

But in audit log I get:

ModSecurity: Warning. Matched "Operator `ValidadeByteRange' with parameter `1-255' against variable `ARGS:extraParams' (Value: `{"node":"3","text":"v\xffffffc3\xffffffa9gs\xffffffc5\xffffff91 fejezet","parentNode":"0","tid":"144 (3 characters omitted)' ) [file "/etc/nginx/owasp-modsecurity-crs/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf"] [line "488"] [id "920270"] [rev "2"] [msg "Invalid character in request (null character)"] [data ""] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"] [accuracy "9"] [tag "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag "attack-protocol"] [tag "OWASP_CRS/PROTOCOL_VIOLATION/EVASION"] [ref "o21,1o22,1o25,1o26,1v921,67t:urlDecodeUni"]

Why is the ValidadeByteRange is 1-255? And why converts the
urlDecodeUni the UTF8 chars to UTF32? What would be the right way
to send legal UTF8 (or UTF32) characters to server?


(An addition note: I just see the "ver OWASP_CRS/3.0.0" string
now, when I copied the line, but I'm sure I've pulled out the
3.0.2:

$ git log
commit e4e0497be4d598cce0e0a8fef20d1f1e5578c8d0
Merge: d46913e 9d2465d
Author: Chaim Sanders <chaim.sanders at gmail.com>
Date:   Fri May 12 13:11:20 2017 -0400

    pushing to v3.0.2

)


Many thanks again!


a.


> On Tue, May 30, 2017 at 10:19 AM, Ervin Heged?s <airween at gmail.com> wrote:
> 
> > Hi,
> >
> > there is an existing web application, which have an API: the
> > client sends the requests to server in a fixed structure, and the
> > server answers to them. This app works since 4 years.
> >
> > Now I've installed Libmodsecurity, and OWASP CRS (3.0.2).
> >
> > Here is a client request (HTTP POST)
> >
> > action  filter_tree
> > extraParams     {"sort":"folderid"}
> > node    0
> > table   tea_user_folders
> >
> > In extraParams, there could be several keys and values.
> >
> > The modsecurity bans this request with these lines (in
> > audit.log):
> >
> > ---1InxQ6aA---B--
> > POST /api/tree HTTP/1.1
> > Referer: http://my.app/
> > Content-Type: application/x-www-form-urlencoded; charset=UTF-8
> > X-Requested-With: XMLHttpRequest
> > Accept-Encoding: gzip, deflate
> > Cookie: _ga=GA1.2.978766370.1489422665; PHPSESSID=
> > bbfcaq0r0ahruiqn49mjg9bcc6
> > Content-Length: 94
> > Accept-Language: hu-HU,hu;q=0.8,en-US;q=0.5,en;q=0.3
> > Accept: */*
> > Cache-Control: max-age=0
> > User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101
> > Firefox/53.0
> > Host: my.app
> > Connection: keep-alive
> >
> > ---1InxQ6aA---D--
> >
> > ---1InxQ6aA---F--
> > Server: nginx/1.6.2
> > Date: Tue, 30 May 2017 13:55:47 GMT
> > Content-Length: 168
> > Content-Type: text/html
> > Connection: keep-alive
> >
> > ---1InxQ6aA---H--
> > ModSecurity: Warning. Matched "Operator `Rx' with parameter
> > `(?i)(?:;|\{|\||\|\||&|&&|\n|\r|`)\s*[\(,@\'\"\s]*(?:[\w'\"\
> > ./]+/|[\\\\'\"\^]*\w[\\\\'\"\^]*:.*\\\\|[\^\.\w'\"/\\\\]*\\\
> > \)?[\"\^]*(?:s[\"\^]*(?:y[\"\^]*s[\"\^]*(?:t[\"\^]*e[\"\^]*m[\"\^]*(?:p[\"\^]*r[
> > (5092 characters omitted)' against variable `ARGS:extraParams' (Value:
> > `{"sort":"folderid"}' ) [file "/etc/nginx/owasp-modsecurity-
> > crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf"] [line "182"] [id
> > "932115"] [rev "4"] [msg "Remote Command Execution: Windows Command
> > Injection"] [data "Matched Data: {"sort found within ARGS:extraParams:
> > {"sort":"folderid"}"] [severity "2"] [ver "OWASP_CRS/3.0.0"] [maturity "9"]
> > [accuracy "8"] [tag "application-multi"] [tag "language-shell"] [tag
> > "platform-windows"] [tag "attack-rce"] [tag "OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION"]
> > [tag "WASCTC/WASC-31"] [tag "OWASP_TOP_10/A1"] [tag "PCI/6.5.2"] [ref
> > "o0,6v621,19"]
> > ModSecurity: Warning. Matched "Operator `Ge' with parameter
> > `%{tx.inbound_anomaly_score_threshold}' against variable
> > `TX:ANOMALY_SCORE' (Value: `5' ) [file "/etc/nginx/owasp-modsecurity-
> > crs/rules/REQUEST-949-BLOCKING-EVALUATION.conf"] [line "36"] [id
> > "949110"] [rev ""] [msg "Inbound Anomaly Score Exceeded (Total Score: 5)"]
> > [data ""] [severity "2"] [ver ""] [maturity "0"] [accuracy "0"] [tag
> > "application-multi"] [tag "language-multi"] [tag "platform-multi"] [tag
> > "attack-generic"] [ref ""]
> > ModSecurity: Warning. Matched "Operator `Ge' with parameter
> > `%{tx.inbound_anomaly_score_threshold}' against variable
> > `TX:INBOUND_ANOMALY_SCORE' (Value: `5' ) [file
> > "/etc/nginx/owasp-modsecurity-crs/rules/RESPONSE-980-CORRELATION.conf"]
> > [line "61"] [id "980130"] [rev ""] [msg "Inbound Anomaly Score Exceeded
> > (Total Inbound Score: 5 - SQLI=0,XSS=0,RFI=0,LFI=0,RCE=5,PHPI=0,HTTP=0,SESS=0):
> > Remote Command Execution: Windows Command Injection'"] [data ""] [severity
> > "0"] [ver ""] [maturity "0"] [accuracy "0"] [tag "event-correlation"] [ref
> > ""]
> >
> > ---1InxQ6aA---I--
> >
> >
> > My question is: what can I do?
> > - ignore that rule (remove the /etc/nginx/owasp-modsecurity-
> > crs/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf file?)
> > - change the "sort" keyword in full API (that would be a very
> >   hard work)? (and what should be the good choice? eg.
> >   "sorting"?)
> >
> > There isn't any Windows based OS, there are several Linux
> > containers, and nGInx is a front-end proxy.
> >
> >
> > Many thanks,
> >
> >
> > a.
> > _______________________________________________
> > Owasp-modsecurity-core-rule-set mailing list
> > Owasp-modsecurity-core-rule-set at lists.owasp.org
> > https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set
> >
> 
> 
> 
> -- 
> -- 
> Chaim Sanders
> http://www.ChaimSanders.com

> _______________________________________________
> Owasp-modsecurity-core-rule-set mailing list
> Owasp-modsecurity-core-rule-set at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-modsecurity-core-rule-set


