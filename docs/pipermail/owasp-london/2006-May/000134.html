<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-london] Re: [WEB SECURITY] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-london%40lists.owasp.org?Subject=%5BOwasp-london%5D%20Re%3A%20%5BWEB%20SECURITY%5D%20Review%20of%20Owasp-London%20Chapter%20meeting%20on%20WAF%0A%20%28Web%20Application%20Firewalls%29&In-Reply-To=Pine.LNX.4.33.0605011710540.25564-100000%40bali.secure-net.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000139.html">
   <LINK REL="Next"  HREF="000135.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-london] Re: [WEB SECURITY] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)</H1>
    <B>Dinis Cruz</B> 
    <A HREF="mailto:owasp-london%40lists.owasp.org?Subject=%5BOwasp-london%5D%20Re%3A%20%5BWEB%20SECURITY%5D%20Review%20of%20Owasp-London%20Chapter%20meeting%20on%20WAF%0A%20%28Web%20Application%20Firewalls%29&In-Reply-To=Pine.LNX.4.33.0605011710540.25564-100000%40bali.secure-net.de"
       TITLE="[Owasp-london] Re: [WEB SECURITY] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)">dinis at ddplus.net
       </A><BR>
    <I>Mon May  1 18:47:25 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000139.html">[Owasp-london] RE: [WEB SECURITY] Re: [Owasp-dotnet] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)
</A></li>
        <LI>Next message: <A HREF="000135.html">[Owasp-london] Re: [WEB SECURITY] Re: [Owasp-dotnet] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#134">[ date ]</a>
              <a href="thread.html#134">[ thread ]</a>
              <a href="subject.html#134">[ subject ]</a>
              <a href="author.html#134">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Achim Hoffmann wrote:
&gt;<i> hmm, does this mean that nobody is able to configure WebProxy to test ALL
</I>&gt;<i> (known) vulnerabilities of a categorie? Come on ;-)
</I>&gt;<i>   
</I>I am not saying that nobody would able to use a WebProxy to test ALL 
(known) vulnerabilities. That is even doable with notepad and NetCat :)

But that is not my point. My point is that these guys build WAF for a 
living, and I was expecting a more sophisticated method to automatically 
test these issues.

Remember that most HacmeBank vulnerabilities (namely the ones the WAF 
vendors did their demos on) are basic examples, which would be easy to 
implement in a automated test suite (if they had one)
&gt;<i> I guess that the majority of cases in the logical and semantical layer could
</I>&gt;<i> not be detected by a WAF. 
</I>My argument is that they should be detected by a WAF (we might agree to 
disagree on this one :).
&gt;<i> That would require that the WAF knows the business
</I>&gt;<i> logic of all applications it protects.
</I>&gt;<i>   
</I>Exactly, and because that is a complex task, the WAF's vendors don't do 
it today (but in my point of view will need to do it in the future)

Think about this, normal firewalls don't do Layer 7 (port 80,443 traffic 
is not checked), if then you have WAFs (at layer 7) that only check for 
basic exploits, what happens next?

XYZ appliance that handles the Layer 7.5? (i.e. the application logic)
&gt;<i> Let the WAF detect the simplistic attacks, that's currently still a challenge.
</I>&gt;<i>   
</I>Well I refuse to accept that WAFs can only handle simplistic attacks.

That said, If the bottom line is that (for now) WAFs can only handle 
simple attacks, then somebody needs to update they marketing material:

&quot;...TrafficShield&#174; is a web application firewall that provides 
comprehensive, proactive, network and application-layer protection from 
generalized and targeted attacks...&quot; 
(<A HREF="http://www.f5.com/products/TrafficShield/">http://www.f5.com/products/TrafficShield/</A>)

&quot;...The SecureSphere Web Application Firewall is the only solution to 
provide automated attack protection for Web and Web Services 
applications....Dynamic Profiling is the foundation of a multi-layer 
security architecture that provides complete protection for all layers 
of the application infrastructure, including the network, server and 
application&quot; 
(<A HREF="http://www.imperva.com/products/securesphere/web_application_firewall.html">http://www.imperva.com/products/securesphere/web_application_firewall.html</A>)

&quot;...WebDefend is a next-generation Internet security appliance that 
provides comprehensive Web application protection to resolve information 
security challenges such as Identity Theft, Information Leakage, 
regulatory compliance, and insecurely coded applications...&quot; 
(<A HREF="http://www.breach.com/products_breachgatewebdefend.asp">http://www.breach.com/products_breachgatewebdefend.asp</A>)
&gt;<i> !!        d) another area which I still think the WAF don't get it, is the
</I>&gt;<i> !! fact that no solution allows for the easy manipulation of the data being
</I>&gt;<i> !! analyzed (both at input and at output). At the moment you only have two
</I>&gt;<i> !! choices: 1) let the request go, 2) block the request and either show a
</I>&gt;<i> !! custom error page or logout the user. This is to radical.
</I>&gt;<i>
</I>&gt;<i> hmm, the F in WAF stands for firewall and not for (substituting) filter.
</I>&gt;<i>   
</I>That depends on your definition of Firewall :)

Here is a good one:

&quot;What is a Web Application Firewall?
An intermediary device, sitting between a web-client and a web server, 
analyzing OSI Layer-7 messages for violations in the programmed security 
policy. A web application firewall is used as a security device 
protecting the web server from attack.&quot; 
(<A HREF="http://www.cgisecurity.com/questions/webappfirewall.shtml">http://www.cgisecurity.com/questions/webappfirewall.shtml</A>)

So unless you want to start dividing Layer 7 traffic into multiple 
sub-layers (Data Validation basic, Data Validation advanced, 
Authentication, Strong Authentication, Authorization, Deep Authorization 
(I made up this last one :), etc...) I would argue that Web Application 
Firewalls are layer 7 firewalls, and should be able to protect against 
all attacks deployed via that layer.
&gt;<i> Do you know of any network firewall which behaves this way?
</I>&gt;<i>   
</I>No I don't know of a WAF Appliance that behaves like this (which is a 
shame because I would have several clients for them). This gap in the 
market is exactly why I am defending that this is were the new 
generation of WAF vendors should be focusing their effort on.
&gt;<i> It's dangerous that a WAF has its own idea how to sort data out (even if
</I>&gt;<i> configuerable). 
</I>Why? Remember that I defend that the point where WAFs are most effective 
and valuable is when they are being configured by an experienced and 
knowledgeable security consultant (preferably not the one that found the 
vulnerability).

Note that I am not defending that you should actively use a WAF on the 
entire website (especially the functions that dynamically change data).

What I am defending is that If I (the client) know that a certain 
vulnerability exist (discovered by a security consultant or by analyzing 
the logs of a 'live' attack (occurring at that moment)), then what I 
(the client) want, is to be able to as quickly as possible (and with the 
least amount of side effects) deploy a 'patch' to my application which 
will a) mitigate the vulnerability and b) have zero or minimal impact on 
my normal user's session experience.

Being able to dynamically manipulate form's (and other http) content has 
the following advantages:

    1) There are some security issues that you cannot mitigate in any 
other way (for example information leakage, or certain types of data 
validation)
    2) It minimizes site effects and allows much more flexibility on how 
do you handle (potential) malicious input (remember that at the moment 
you get a black or white decision (allow or deny))
    3) It allows for the detection of an attack without giving the 
attackers any clue that the attack was detected (of course that I am 
assuming here that there are incident escalation procedures in place)
&gt;<i> Just an example: the username comes as O'Reilly and your
</I>&gt;<i> smart WAF replaces the '. Does it replace for SQL injection or for XSS?
</I>&gt;<i> Which one would you prefer if the application needs both?
</I>&gt;<i>   
</I>That depends on the case and on the specific vulnerability. What I know 
is that I don't want Mr O'Reilly to get a 404 page or to be logged out 
every time he signs up for a newsletter (let's assume that the login 
page was not vulnerable to SQL Injection, since Mr O'Reilly needs to 
login :) )

I also like to have the possibility to replace one ' with '' (two ' ) or 
with an html version of a ' (&amp;#39;)  or with an _ (underscore) or with a 
&quot;[quote was here]&quot; tag (to be replaced on the way out with a ' again :)

The bottom line is that you need to be able to have the flexibility to 
provide the business with a solution that A) solves/mitigates the 
security vulnerability and B) doesn't affect the user's experience
&gt;<i> Input data validation has to be done by each application for each value
</I>&gt;<i> and this validation is bound to the destination of the data. 
</I>Of course, Data Validation should ultimately be the responsibility of 
the Application. But with development cycles of weeks or months, WAFs 
'patches' are the perfect solution to stop current or future attacks on 
known vulnerabilities.

In the medium term, what would also help would be if web applications 
were able to provide (to the WAFs) xml feeds containing detailed 
information about all input points (i.e. the attack surface). Think 
Struts (<A HREF="http://struts.apache.org/">http://struts.apache.org/</A>)
&gt;<i> Something
</I>&gt;<i> a WAF usually does not know.
</I>&gt;<i>   
</I>It doesn't do know, but I wish they did
&gt;<i> !! We need the
</I>&gt;<i> !! ability to change the contents of form fields (or page contents)
</I>&gt;<i> !! dynamically. This will be the only way that some vulnerabilities can be
</I>&gt;<i> !! effectively managed and mitigated (while limiting the damage cause by
</I>&gt;<i> !! false positives). Note: same WAFs have the functionality to replace
</I>&gt;<i> !! cookies with their own (WAF controlled value)
</I>&gt;<i>
</I>&gt;<i> Don't know what you mean here. If you mean values of input fields, see above.
</I>&gt;<i>   
</I>Do you still disagree with me that sometimes you NEED to be able to 
dynamically change the contents of an HTTP request (namely Form values)
&gt;<i> If you mean values of fields in output (response), then there're still a
</I>&gt;<i> couple of WAFs which could encrypt values in responses and check if the
</I>&gt;<i> correct value comes back in the next request.
</I>&gt;<i>   
</I>Sure and that is a good thing they do.

But what about when secret data is sent on a response? Shouldn't we be 
able to stop that?
&gt;<i> !!        e) Why don't they use their WAFs to protect the WAF's web
</I>&gt;<i> !! interface? Clearly a great test for the usability of a WAF product is to
</I>&gt;<i> !! use it to protect the complex GUIs used on the WAF management and
</I>&gt;<i> !! monitoring. Also, when (not if) vulnerabilities are found in their
</I>&gt;<i> !! product, they could use their WAF to mitigate those security issues.
</I>&gt;<i>
</I>&gt;<i> OK, i.g. this is a true requirement. But keep in mind that a WAF is not
</I>&gt;<i> reachable from the internet, but it should only be reachable from trusted
</I>&gt;<i> hosts. Most WAFs support such a protection.
</I>True, but in large enterprises the number of nodes that will be able to 
connect to those boxes will be quite high, but (as I explain below) the 
main reason for this request is not to reduce the risk created by these 
web applications
&gt;<i>  Why should a WAF protect itself
</I>&gt;<i> from trusted hosts, that sounds overkill.
</I>&gt;<i>   
</I>Why? Surely a WAF should be able to handle such task without any 
problems? Aren't they all designed to handle complex websites generating 
large amounts of traffic?
&gt;<i> IMHO, such a protection is sufficient 'cause it only leaves the administration
</I>&gt;<i> interface open to session riding (which could be solved with isolated
</I>&gt;<i> administration hosts).
</I>&gt;<i>   
</I>If isolation administration hosts worked in large corporate 
environments.... :)
&gt;<i> Anyway, I agree that it's a shame that some WAF have XSS, SQL injection
</I>&gt;<i> and some other vulnerabilities.
</I>&gt;<i>   
</I>The problem here is not that they have those issues (that is a problem 
with the software industry), the problem is that these WAF don't have a 
quick way to deploy patches for those vulnerabilities.

Also by using the WAF to protect their web applications (which are 
complex and feature rich) they (the WAF vendors) would gain a huge 
amount of experience on what a complex application looks like, and how 
to handle the issues that are created by protecting it with their product.

I would also be a great demo for them (unless they couldn't protect 
their WAF security issues with their WAF :)
&gt;<i> !!        g) And what about their website? Are the vendor's websites
</I>&gt;<i> !! protected by their WAFs?
</I>&gt;<i>
</I>&gt;<i> a simple LOL could be the comment here, but I'm aware that some vendors
</I>&gt;<i> are listening ...
</I>&gt;<i>   
</I>:<i>)
</I>&gt;<i> !!        i) What about the Web Application Firewall Evaluation Criteria
</I>&gt;<i> !! (<A HREF="http://www.webappsec.org/projects/wafec/">http://www.webappsec.org/projects/wafec/</A>)? How do this WAF appliances
</I>&gt;<i> !! rate to this? I might have missed it, but where is the public disclose
</I>&gt;<i> !! of this information?
</I>&gt;<i>
</I>&gt;<i> yes the WAFEC could be used for that. But did you read at least the first 3
</I>&gt;<i> paragraphs in the Introduction of that document before asking this question?
</I>&gt;<i>   
</I>I had read the WAFEC document before, and just to make sure I didn't 
miss any thing major I just re-read those first the paragraphs 
(<A HREF="http://www.webappsec.org/projects/wafec/v1/wasc-wafec-v1.0.html">http://www.webappsec.org/projects/wafec/v1/wasc-wafec-v1.0.html</A>), and I 
don't understand your question. What is there in these 3 paragraphs that 
I should be aware of?

Note that all that I am asking for is for the WAF vendors to publicly 
disclose their WAFEC results.

Dinis Cruz
Owasp .Net Project
www.owasp.net



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000139.html">[Owasp-london] RE: [WEB SECURITY] Re: [Owasp-dotnet] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)
</A></li>
	<LI>Next message: <A HREF="000135.html">[Owasp-london] Re: [WEB SECURITY] Re: [Owasp-dotnet] Review of Owasp-London Chapter meeting on WAF (Web Application Firewalls)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#134">[ date ]</a>
              <a href="thread.html#134">[ thread ]</a>
              <a href="subject.html#134">[ subject ]</a>
              <a href="author.html#134">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.owasp.org/mailman/listinfo/owasp-london">More information about the Owasp-london
mailing list</a><br>
</body></html>
