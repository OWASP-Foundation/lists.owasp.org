<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OWASP-cheat-sheets] REST and STS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%20REST%20and%20STS&In-Reply-To=%3CCAGRYwJy1TsymncWaO9we%3DjuhQKC4W7_wb8wR0BbC6%2BycqC%3D0jQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000101.html">
   <LINK REL="Next"  HREF="000103.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OWASP-cheat-sheets] REST and STS</H1>
    <B>Erlend Oftedal</B> 
    <A HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%20REST%20and%20STS&In-Reply-To=%3CCAGRYwJy1TsymncWaO9we%3DjuhQKC4W7_wb8wR0BbC6%2BycqC%3D0jQ%40mail.gmail.com%3E"
       TITLE="[OWASP-cheat-sheets] REST and STS">erlend.oftedal at owasp.org
       </A><BR>
    <I>Tue Nov 14 15:20:53 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="000101.html">[OWASP-cheat-sheets] REST and STS
</A></li>
        <LI>Next message: <A HREF="000103.html">[OWASP-cheat-sheets] REST and STS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102">[ date ]</a>
              <a href="thread.html#102">[ thread ]</a>
              <a href="subject.html#102">[ subject ]</a>
              <a href="author.html#102">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If you have multiple resource servers and/or clients I completely agree
that it makes sense to use an STS/IdP, but I don't see how that dictates
what a REST API is.
I still think it's perfectly possible to have a single resource server
which also serves as the authentication service, and call it a REST API.
Because at least to me it's more about the design of the RESTful resources
than how it interacts with authentication.
Also one could also argue that artifact/identifier tokens imply server side
state (tables of valid refresh and access tokens tied to users accounts).
JWTs are a different story as they can be self-contained.
I would also argue that services still need to authz/authn logic. They need
to validate the token, they may need to check claims/roles/scope (allthough
this should probably be handled at the idp), they need to horisontal
authorization checks etc.

I don't see how sessions are more of an attack service than tokens. There
have been a lot of issues with how redirects etc. are handled in OAuth 2
IdPs, tokens can still be stolen etc. The problems don't disappear, they
just change form IMHO.


Erlend









On 14 November 2017 at 15:40, Johan Peeters &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">yo at johanpeeters.com</A>&gt; wrote:

&gt;<i> An SPA with REST API back-ends seems to me to be the obvious
</I>&gt;<i> architecture for today's web apps. No argument there.
</I>&gt;<i> Having made that choice and assuming you need access control in your
</I>&gt;<i> REST APIs you could try to let the REST API handle authN. But here are
</I>&gt;<i> the problems that you hit upon or, arguably, create:
</I>&gt;<i> + if you have several resource servers, your authN/Z code is
</I>&gt;<i> duplicated in all of them
</I>&gt;<i> + users must pass their credentials to the clients, which in turn pass
</I>&gt;<i> them to the resource servers. Contrast this with an architecture in
</I>&gt;<i> which only a central IdP receives credentials..
</I>&gt;<i> + authN mechanisms are evolving. You want to decouple this from your
</I>&gt;<i> resource servers.
</I>&gt;<i> + IdP and STS are part of your TCB, so you want this to be as small as
</I>&gt;<i> possible and coded by experts - most shops would do well to use a 3rd
</I>&gt;<i> party component.
</I>&gt;<i> + ...
</I>&gt;<i> Sessions are always a problem in the sense that they are part of the
</I>&gt;<i> attack surface, and rather vulnerable/attractive targets, so you don't
</I>&gt;<i> want sessions unless they are absolutely indispensable.
</I>&gt;<i>
</I>&gt;<i> The OAuth authorization servers (IdP/STS) I have worked with so far
</I>&gt;<i> have indeed offered a REST API, but only for
</I>&gt;<i> + management APIs
</I>&gt;<i> + the /token endpoint
</I>&gt;<i> The /authorize endpoint is invoked with a redirect URI and returns a
</I>&gt;<i> web form for the user. In other words, the only OAuth grants that are
</I>&gt;<i> completely handled via APIs are Client Credentials and Resource Owner.
</I>&gt;<i> Authorization Code and variants only use an API for trading the code
</I>&gt;<i> in for a token.
</I>&gt;<i> Does that answer your question?
</I>&gt;<i>
</I>&gt;<i> Yo
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 14 November 2017 at 12:24, Erlend Oftedal &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">erlend.oftedal at owasp.org</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt; Even if you have a single client and a single resource server, you can
</I>&gt;<i> still
</I>&gt;<i> &gt; benefit from REST APIs. My example would be building a single page web
</I>&gt;<i> app.
</I>&gt;<i> &gt; By using a REST API you can separate frontend from backend properly and
</I>&gt;<i> &gt; deploy them independently. You can completely rewrite the frontend with
</I>&gt;<i> no
</I>&gt;<i> &gt; changes to the backend. But why does that imply the need for an STS/IdP?
</I>&gt;<i> Why
</I>&gt;<i> &gt; is sessions a problem here?
</I>&gt;<i> &gt; Resources can still work as they are supposed to, without depending on
</I>&gt;<i> &gt; session state. The session is for authentication information only. It
</I>&gt;<i> &gt; carries authentication information, but that information doesn't affect
</I>&gt;<i> the
</I>&gt;<i> &gt; way resources are processed (except for the auth, but that holds for
</I>&gt;<i> basic
</I>&gt;<i> &gt; auth, tokens, and all other types of authentication as well).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Is it possible to design an STS/IdP with a REST API?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 14 November 2017 at 10:56, Johan Peeters &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">yo at johanpeeters.com</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; No sooner did Jim move the REST cheat sheet from draft to approved
</I>&gt;<i> &gt;&gt; mode than old controversies reared up again. The principal one was
</I>&gt;<i> &gt;&gt; whether we should cover session management, but I won't go into that
</I>&gt;<i> &gt;&gt; in this post.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Here I want to discuss what the deal is with Security Token Services
</I>&gt;<i> &gt;&gt; (STS).
</I>&gt;<i> &gt;&gt; Erlend asked me: can't you have a REST service without an STS? Sure,
</I>&gt;<i> &gt;&gt; if no authN/Z is needed, obviously. If the REST API is sensitive,
</I>&gt;<i> &gt;&gt; serves multiple clients and there are several resource servers, on the
</I>&gt;<i> &gt;&gt; other hand, then I would strongly recommend using an STS. This
</I>&gt;<i> &gt;&gt; centralises authentication logic in a dedicated component and avoids
</I>&gt;<i> &gt;&gt; passing credentials around.
</I>&gt;<i> &gt;&gt; If you do not have and do not anticipate having multiple clients or
</I>&gt;<i> &gt;&gt; resource servers, maybe REST APIs are not the right choice - probably
</I>&gt;<i> &gt;&gt; there are simpler designs that serve your purpose.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Yo
</I>&gt;<i> &gt;&gt; --
</I>&gt;<i> &gt;&gt; Johan Peeters
</I>&gt;<i> &gt;&gt; <A HREF="https://www.johanpeeters.com">https://www.johanpeeters.com</A>
</I>&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt; OWASP-cheat-sheets mailing list
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">OWASP-cheat-sheets at lists.owasp.org</A>
</I>&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Johan Peeters
</I>&gt;<i> <A HREF="https://www.johanpeeters.com">https://www.johanpeeters.com</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-cheat-sheets/attachments/20171114/696634a8/attachment.html">http://lists.owasp.org/pipermail/owasp-cheat-sheets/attachments/20171114/696634a8/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000101.html">[OWASP-cheat-sheets] REST and STS
</A></li>
	<LI>Next message: <A HREF="000103.html">[OWASP-cheat-sheets] REST and STS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#102">[ date ]</a>
              <a href="thread.html#102">[ thread ]</a>
              <a href="subject.html#102">[ subject ]</a>
              <a href="author.html#102">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">More information about the OWASP-cheat-sheets
mailing list</a><br>
</body></html>
