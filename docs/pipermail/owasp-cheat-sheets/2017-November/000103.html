<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OWASP-cheat-sheets] REST and STS
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%20REST%20and%20STS&In-Reply-To=%3CCADFnxGfrxK2YPZ9NO7bWrSdfL-93n%3DfaZYkNOcgi6RNxmbFaLw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000102.html">
   <LINK REL="Next"  HREF="000111.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OWASP-cheat-sheets] REST and STS</H1>
    <B>Johan Peeters</B> 
    <A HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%20REST%20and%20STS&In-Reply-To=%3CCADFnxGfrxK2YPZ9NO7bWrSdfL-93n%3DfaZYkNOcgi6RNxmbFaLw%40mail.gmail.com%3E"
       TITLE="[OWASP-cheat-sheets] REST and STS">yo at johanpeeters.com
       </A><BR>
    <I>Tue Nov 14 16:18:34 UTC 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="000102.html">[OWASP-cheat-sheets] REST and STS
</A></li>
        <LI>Next message: <A HREF="000111.html">[OWASP-cheat-sheets] REST and STS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103">[ date ]</a>
              <a href="thread.html#103">[ thread ]</a>
              <a href="subject.html#103">[ subject ]</a>
              <a href="author.html#103">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't think I said that you can't do REST without a separate
STS/IdP, just that it is advisable to have one.
The .NET community seem to be doing a lot of stuff along the lines you
suggest: IdentityServer gets deployed within the same project as the
resources and offers the authorization server endpoints. Note however
that these are distinct from the REST APIs. You first get your token
and then call the API.
Co-locating STS and resource servers does not seem to me to be an
approach that scales well, but hey, not everyone needs to scale.
I have no problem calling JWT validation 'authentication'. We must be
clear, however, that it is not the user that is being authenticated,
nor the client, but the token. Resource servers may need to make an
authorization decision based on the contents of a valid JWT. However,
the more of the authZ we can do in the STS/IdP the better - security
policies are more easily/reliably enforced centrally.

If we have both tokens AND session cookies, we would have a larger
attack surface than if we only have tokens, right?
Of course tokens are not invincible. Of course I agree with you that
they have a pretty bad track record. But surely that's not a reason to
also add session cookies!

On 14 November 2017 at 16:20, Erlend Oftedal &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">erlend.oftedal at owasp.org</A>&gt; wrote:
&gt;<i> If you have multiple resource servers and/or clients I completely agree that
</I>&gt;<i> it makes sense to use an STS/IdP, but I don't see how that dictates what a
</I>&gt;<i> REST API is.
</I>&gt;<i> I still think it's perfectly possible to have a single resource server which
</I>&gt;<i> also serves as the authentication service, and call it a REST API. Because
</I>&gt;<i> at least to me it's more about the design of the RESTful resources than how
</I>&gt;<i> it interacts with authentication.
</I>&gt;<i> Also one could also argue that artifact/identifier tokens imply server side
</I>&gt;<i> state (tables of valid refresh and access tokens tied to users accounts).
</I>&gt;<i> JWTs are a different story as they can be self-contained.
</I>&gt;<i> I would also argue that services still need to authz/authn logic. They need
</I>&gt;<i> to validate the token, they may need to check claims/roles/scope (allthough
</I>&gt;<i> this should probably be handled at the idp), they need to horisontal
</I>&gt;<i> authorization checks etc.
</I>&gt;<i>
</I>&gt;<i> I don't see how sessions are more of an attack service than tokens. There
</I>&gt;<i> have been a lot of issues with how redirects etc. are handled in OAuth 2
</I>&gt;<i> IdPs, tokens can still be stolen etc. The problems don't disappear, they
</I>&gt;<i> just change form IMHO.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Erlend
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 14 November 2017 at 15:40, Johan Peeters &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">yo at johanpeeters.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> An SPA with REST API back-ends seems to me to be the obvious
</I>&gt;&gt;<i> architecture for today's web apps. No argument there.
</I>&gt;&gt;<i> Having made that choice and assuming you need access control in your
</I>&gt;&gt;<i> REST APIs you could try to let the REST API handle authN. But here are
</I>&gt;&gt;<i> the problems that you hit upon or, arguably, create:
</I>&gt;&gt;<i> + if you have several resource servers, your authN/Z code is
</I>&gt;&gt;<i> duplicated in all of them
</I>&gt;&gt;<i> + users must pass their credentials to the clients, which in turn pass
</I>&gt;&gt;<i> them to the resource servers. Contrast this with an architecture in
</I>&gt;&gt;<i> which only a central IdP receives credentials..
</I>&gt;&gt;<i> + authN mechanisms are evolving. You want to decouple this from your
</I>&gt;&gt;<i> resource servers.
</I>&gt;&gt;<i> + IdP and STS are part of your TCB, so you want this to be as small as
</I>&gt;&gt;<i> possible and coded by experts - most shops would do well to use a 3rd
</I>&gt;&gt;<i> party component.
</I>&gt;&gt;<i> + ...
</I>&gt;&gt;<i> Sessions are always a problem in the sense that they are part of the
</I>&gt;&gt;<i> attack surface, and rather vulnerable/attractive targets, so you don't
</I>&gt;&gt;<i> want sessions unless they are absolutely indispensable.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The OAuth authorization servers (IdP/STS) I have worked with so far
</I>&gt;&gt;<i> have indeed offered a REST API, but only for
</I>&gt;&gt;<i> + management APIs
</I>&gt;&gt;<i> + the /token endpoint
</I>&gt;&gt;<i> The /authorize endpoint is invoked with a redirect URI and returns a
</I>&gt;&gt;<i> web form for the user. In other words, the only OAuth grants that are
</I>&gt;&gt;<i> completely handled via APIs are Client Credentials and Resource Owner.
</I>&gt;&gt;<i> Authorization Code and variants only use an API for trading the code
</I>&gt;&gt;<i> in for a token.
</I>&gt;&gt;<i> Does that answer your question?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yo
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 14 November 2017 at 12:24, Erlend Oftedal &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">erlend.oftedal at owasp.org</A>&gt;
</I>&gt;&gt;<i> wrote:
</I>&gt;&gt;<i> &gt; Even if you have a single client and a single resource server, you can
</I>&gt;&gt;<i> &gt; still
</I>&gt;&gt;<i> &gt; benefit from REST APIs. My example would be building a single page web
</I>&gt;&gt;<i> &gt; app.
</I>&gt;&gt;<i> &gt; By using a REST API you can separate frontend from backend properly and
</I>&gt;&gt;<i> &gt; deploy them independently. You can completely rewrite the frontend with
</I>&gt;&gt;<i> &gt; no
</I>&gt;&gt;<i> &gt; changes to the backend. But why does that imply the need for an STS/IdP?
</I>&gt;&gt;<i> &gt; Why
</I>&gt;&gt;<i> &gt; is sessions a problem here?
</I>&gt;&gt;<i> &gt; Resources can still work as they are supposed to, without depending on
</I>&gt;&gt;<i> &gt; session state. The session is for authentication information only. It
</I>&gt;&gt;<i> &gt; carries authentication information, but that information doesn't affect
</I>&gt;&gt;<i> &gt; the
</I>&gt;&gt;<i> &gt; way resources are processed (except for the auth, but that holds for
</I>&gt;&gt;<i> &gt; basic
</I>&gt;&gt;<i> &gt; auth, tokens, and all other types of authentication as well).
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; Is it possible to design an STS/IdP with a REST API?
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; On 14 November 2017 at 10:56, Johan Peeters &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">yo at johanpeeters.com</A>&gt; wrote:
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; No sooner did Jim move the REST cheat sheet from draft to approved
</I>&gt;&gt;<i> &gt;&gt; mode than old controversies reared up again. The principal one was
</I>&gt;&gt;<i> &gt;&gt; whether we should cover session management, but I won't go into that
</I>&gt;&gt;<i> &gt;&gt; in this post.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Here I want to discuss what the deal is with Security Token Services
</I>&gt;&gt;<i> &gt;&gt; (STS).
</I>&gt;&gt;<i> &gt;&gt; Erlend asked me: can't you have a REST service without an STS? Sure,
</I>&gt;&gt;<i> &gt;&gt; if no authN/Z is needed, obviously. If the REST API is sensitive,
</I>&gt;&gt;<i> &gt;&gt; serves multiple clients and there are several resource servers, on the
</I>&gt;&gt;<i> &gt;&gt; other hand, then I would strongly recommend using an STS. This
</I>&gt;&gt;<i> &gt;&gt; centralises authentication logic in a dedicated component and avoids
</I>&gt;&gt;<i> &gt;&gt; passing credentials around.
</I>&gt;&gt;<i> &gt;&gt; If you do not have and do not anticipate having multiple clients or
</I>&gt;&gt;<i> &gt;&gt; resource servers, maybe REST APIs are not the right choice - probably
</I>&gt;&gt;<i> &gt;&gt; there are simpler designs that serve your purpose.
</I>&gt;&gt;<i> &gt;&gt;
</I>&gt;&gt;<i> &gt;&gt; Yo
</I>&gt;&gt;<i> &gt;&gt; --
</I>&gt;&gt;<i> &gt;&gt; Johan Peeters
</I>&gt;&gt;<i> &gt;&gt; <A HREF="https://www.johanpeeters.com">https://www.johanpeeters.com</A>
</I>&gt;&gt;<i> &gt;&gt; _______________________________________________
</I>&gt;&gt;<i> &gt;&gt; OWASP-cheat-sheets mailing list
</I>&gt;&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">OWASP-cheat-sheets at lists.owasp.org</A>
</I>&gt;&gt;<i> &gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets</A>
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Johan Peeters
</I>&gt;&gt;<i> <A HREF="https://www.johanpeeters.com">https://www.johanpeeters.com</A>
</I>&gt;<i>
</I>&gt;<i>
</I>


-- 
Johan Peeters
<A HREF="https://www.johanpeeters.com">https://www.johanpeeters.com</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000102.html">[OWASP-cheat-sheets] REST and STS
</A></li>
	<LI>Next message: <A HREF="000111.html">[OWASP-cheat-sheets] REST and STS
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#103">[ date ]</a>
              <a href="thread.html#103">[ thread ]</a>
              <a href="subject.html#103">[ subject ]</a>
              <a href="author.html#103">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">More information about the OWASP-cheat-sheets
mailing list</a><br>
</body></html>
