<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%0A%09https%3A//www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet&In-Reply-To=%3CCANos97fYHfTXHHUzAzP9j4cvR%3D56EhCbn4FjKMVF86vuBiWcDQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000168.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet</H1>
    <B>Dominique Righetto</B> 
    <A HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%0A%09https%3A//www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet&In-Reply-To=%3CCANos97fYHfTXHHUzAzP9j4cvR%3D56EhCbn4FjKMVF86vuBiWcDQ%40mail.gmail.com%3E"
       TITLE="[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet">dominique.righetto at owasp.org
       </A><BR>
    <I>Fri Sep 21 07:43:57 UTC 2018</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000168.html">[OWASP-cheat-sheets] https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#167">[ date ]</a>
              <a href="thread.html#167">[ thread ]</a>
              <a href="subject.html#167">[ subject ]</a>
              <a href="author.html#167">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

OK for the split of the refactoring in 2 phases, first you will deliver the
CS refactored, secondly code samples will be added right after. To be fully
honest, i'm not a fan of this approach because one bad point that has been
regularly reproached to the CS project is that most of the CS are only text
flow/long list of advice and are not directly actionable by a dev team.
Since around 1 year we work with Jim to tackle this point and the task is
huge...It's the reason why we have setup he CS guideline for new CS and we
try to made them more actionable with code sample. However, I respect your
allocation time and thanks you for your contribution so we stick to your
plan.

About the point[1], let's a take a case of a stored XSS on a page in a
application using server side user session:

=&gt; Usage of CSRF token that stay the same for the user &quot;session&quot; and added
as hidden field in form that have always the same name like &quot;csrf_token&quot; in
all forms
Protection defeated because token can be steal and reused across the
application/user session to call others state changing services
Same remark if CSRF token is stored in Local/Session storage (for session
storage, the tab/window must be the same)
Same remark if CSRF token is stored in a cookie readable by JS code

=&gt; Single validation of ORIGIN/REFERRER headers matching
Protection defeated because browser session will be used as proxy (via BEEF
for example) to call any state changing services with the expected ORIGIN
and REFERRER domains

=&gt; Usage of CSRF token that is usable one time (in this mode, most of the
time, the service respond with the next token to use)
Protection defeated because the JS code can call the service with the
expected token, grab the new token and call the next service and so on...

My personal opinion:
You cannot have one protection fit CSRF + XSS and be &quot;unbreakable&quot;. You
should implements protection against these 2 attacks with taking in account
the easiness to implements and maintains for each one.
CSRF protection should go back to the origin and protect against requests
from cross domain and then a combination of ORIGIN/REFERRER checks +
SameSite/HttpOnly/Secure attributes for authentication cookie along a
static long non-guessable token issued at authentication time is a good
start.
Same approach for XSS: Input validation on services side + Output escaping
on client side + Content-Security-Policy headers to prevent exploitation of
any hole let it's also a good start...

So to bring one point of view to your question:
&quot;If there is an XSS vulnerability at a single place on a domain (it can add
custom header), it can be used to make CSRF on all other state changing
operations within that domain done to that AJAX endpoint&quot;.
==&gt; If the token is static or be guessed then it impact all app services
==&gt; If the token is usable one time but response include the next token to
use then it impact all app services
==&gt; If CSRF protection is only performed via the validation of
ORIGIN/REFERRER header then it impact all app services
==&gt; Otherwise the protection is effective only if JS code cannot
obtains/grab/deduce the token to use to call the services...

--
Cordialement, Best regards,
Dominique Righetto
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>
&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
<A HREF="https://righettod.eu">https://righettod.eu</A>
GPG: 323D19BA


On Thu, Sep 20, 2018 at 11:12 PM Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
wrote:

&gt;<i> Yeah, I understand that any XSS and CSRF game is over but I am stressing
</I>&gt;<i> out on the highlighted part in [1]. I am trying to highlight and get an
</I>&gt;<i> affirmation on why my understanding on token based mitigation is better
</I>&gt;<i> than origin/referrer header check will also apply to &#8220;token based
</I>&gt;<i> mitigation Vs custom header mitigation (if static tokens are used in custom
</I>&gt;<i> headers)&#8221;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In case of tokens, we have an option to use different tokens on each page
</I>&gt;<i> (taking things like URL, timestamp etc. into consideration) and hence XSS
</I>&gt;<i> vulnerability on one page will only make state changing operations in that
</I>&gt;<i> page vulnerable to CSRF but not state changing operations on other pages
</I>&gt;<i> within that domain (because token value is different) but whereas in
</I>&gt;<i> origin/referrer header check and custom header check, the token value is
</I>&gt;<i> constant and hence XSS vulnerability in one page will also cause state
</I>&gt;<i> changing operations in other pages to be vulnerable to CSRF as well. Off
</I>&gt;<i> course, this can be mitigated in custom header checks by adding tokens to
</I>&gt;<i> custom headers rather than static constant but this cannot be mitigated in
</I>&gt;<i> origin/referrer check because those headers cannot be modified. So, yeah a
</I>&gt;<i> single XSS any CSRF is bypassed but the breadth of the impact is different
</I>&gt;<i> for each of them.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regarding code samples &#8211; I currently was able to allocate only some time
</I>&gt;<i> for this task and I don&#8217;t think I will be able to do code samples within
</I>&gt;<i> this time frame. I am also leaving for a long vacation starting Oct 12 and
</I>&gt;<i> hence let&#8217;s try to get this out first and we can add code samples later on
</I>&gt;<i> considering my work load after I return from vacation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] If there is an XSS vulnerability at a single place on a domain (it can
</I>&gt;<i> add custom header), it can be used to make CSRF *on all other state
</I>&gt;<i> changing operations* *within that domain *done to that AJAX endpoint. Do
</I>&gt;<i> you agree?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, September 20, 2018 8:45 AM
</I>&gt;<i> *To:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt;
</I>&gt;<i> *Cc:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;; Jim Manico &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your contribution.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I like very much your plan &#128521;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I ask for some favor in addition :
</I>&gt;<i>
</I>&gt;<i> - can you provide code sample (in one language like java or .net or the
</I>&gt;<i> one you want but it must be easy to read and understand) or libraires along
</I>&gt;<i> your proposal for each section?
</I>&gt;<i>
</I>&gt;<i> - can you use the syntaxhighlight tag for code?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'am agree with Jim, XSS  means game over because your browsing context
</I>&gt;<i> can be used as proxy so csrf protection will be defeated because request
</I>&gt;<i> came from the legitimate user.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks you again for all your help &#128077;&#128077;&#128077;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le jeu. 20 sept. 2018 &#224; 18:31, Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt; a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> &gt; If there is an XSS vulnerability at a single place on a domain (it can
</I>&gt;<i> add custom header), it can be used to make CSRF on all other state changing
</I>&gt;<i> operations within that domain done to that AJAX endpoint. Do you agree?
</I>&gt;<i>
</I>&gt;<i> Any XSS is game over and all CSRF are useless in the face of XSS. I Agree!
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 9/19/18 10:52 PM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> Hey Guys,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] is what I said for origin/referrer header check in this e-mail thread.
</I>&gt;<i> I also believe that this applies for custom headers for AJAX endpoints as
</I>&gt;<i> well. If there is an XSS vulnerability at a single place on a domain (it
</I>&gt;<i> can add custom header), it can be used to make CSRF on all other state
</I>&gt;<i> changing operations within that domain done to that AJAX endpoint. Do you
</I>&gt;<i> agree?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here is how I am keeping the new re-factored cheatsheet. Does this look
</I>&gt;<i> good to you guys?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1.       Use token based method as primary defense
</I>&gt;<i>
</I>&gt;<i> a.       Can use synchronizer pattern for stateful applications
</I>&gt;<i>
</I>&gt;<i> b.       Can use hah based/ encryption based token pattern for stateless
</I>&gt;<i> applications
</I>&gt;<i>
</I>&gt;<i> 2.       Defense in depth measures along with drawbacks of each one
</I>&gt;<i>
</I>&gt;<i> a.       Origin/referrer header check
</I>&gt;<i>
</I>&gt;<i> b.       Double submit cookie
</I>&gt;<i>
</I>&gt;<i> c.       Samesite cookie
</I>&gt;<i>
</I>&gt;<i> d.       Custom headers (people still need to use tokens for forms etc.
</I>&gt;<i> if they have mix of ajax endpoints and general HTML)
</I>&gt;<i>
</I>&gt;<i> 3.       Strong CSRF defenses but very less usable : captcha etc.
</I>&gt;<i>
</I>&gt;<i> 4.       CSRF Myths / techniques that do not work section
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] if we solely rely on origin/referrer header check - an XSS
</I>&gt;<i> vulnerability within a single page on that domain will also give CSRF
</I>&gt;<i> vulnerability to all other state changing operations under that entire
</I>&gt;<i> domain.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Wednesday, September 12, 2018 1:31 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave
</I>&gt;<i> Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks you very much for the update
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le mer. 12 sept. 2018 &#224; 21:33, Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> Just an update: I started working on this along with other sprint tasks of
</I>&gt;<i> mine today. I am hoping to get it completed by end of next week and then
</I>&gt;<i> send it for legal/PR approvals.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, August 23, 2018 6:49 AM
</I>&gt;<i> *To:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;; Konakandla,
</I>&gt;<i> Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Awesome! Thank you! :)
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8/23/18 2:41 AM, Dominique Righetto wrote:
</I>&gt;<i>
</I>&gt;<i> You are welcome :)
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Cordialement, Best regards,
</I>&gt;<i> Dominique Righetto
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://righettod.eu">https://righettod.eu</A>
</I>&gt;<i> GPG: 323D19BA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 23, 2018 at 10:33 AM Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> Np. I will keep u guys posted. Thanks for the support and have good rest
</I>&gt;<i> of your day!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, August 23, 2018 1:29 AM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sounds goods for me.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks again for the contribution :)
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Cordialement, Best regards,
</I>&gt;<i> Dominique Righetto
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://righettod.eu">https://righettod.eu</A>
</I>&gt;<i> GPG: 323D19BA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 23, 2018 at 10:03 AM Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> Ok, I received necessary approvals for working on this. I am hoping to
</I>&gt;<i> start the work in 2 weeks and then deliver the document to you guys for
</I>&gt;<i> review by end of September/1st week of October (might be 1-2 weeks delay
</I>&gt;<i> if approvals from Legal and other teams get delayed). My plan is to work on
</I>&gt;<i> below things &#8211; Please let me know if I missed anything/you feel something
</I>&gt;<i> else has to be added to this list.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1.       Change the order of primary and defense in depth measures
</I>&gt;<i>
</I>&gt;<i> 2.       Include the pitfalls/caveats for each CSRF mitigation technique
</I>&gt;<i> (origin/referrer header, samesite, double submit cookie etc.)
</I>&gt;<i>
</I>&gt;<i> 3.       Re-structure entire page and remove outdated/ non-relevant stuff
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, August 16, 2018 12:02 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ok i perfectly understand.
</I>&gt;<i>
</I>&gt;<i> Thanks for the info.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le jeu. 16 ao&#251;t 2018 &#224; 20:33, Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> I had an offline discussion with Jim and informed him that I will have to
</I>&gt;<i> check few details before I give any commitment to update the guidance&#8217;s
</I>&gt;<i> here.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Update: I got approval internally from my team to work on this (fix issues
</I>&gt;<i> and re-structure entire page) but I still need to get approval from Legal
</I>&gt;<i> team to work on this. I will let you guys know when I hear back from them.
</I>&gt;<i> Most likely they will ask me to just get it reviewed with them before
</I>&gt;<i> sending it to you guys for review/get it published on OWASP page.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Tuesday, August 14, 2018 11:02 PM
</I>&gt;<i> *To:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Roadmap has been updated: <A HREF="https://trello.com/b/w020m3jQ/cs-roadmap">https://trello.com/b/w020m3jQ/cs-roadmap</A>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Cordialement, Best regards,
</I>&gt;<i> Dominique Righetto
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://righettod.eu">https://righettod.eu</A>
</I>&gt;<i> GPG: 323D19BA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Aug 13, 2018 at 6:03 AM Dominique Righetto &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> I have finally achieved to read the thread, very interesting  &#128521;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I understand the need to simplify the cheat sheet and the solutions
</I>&gt;<i> proposed. It is one of the reason why i have add code sample. So this
</I>&gt;<i> contribution is a very good point.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just a little thing about header, take care to ensure that the referrer
</I>&gt;<i> policy of the site is not set to no-referrer otherwise you cannot use
</I>&gt;<i> origin/referrer headers couple to create a protection layer.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Tanks you for the helps proposal &#128521;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le dim. 12 ao&#251;t 2018 &#224; 22:21, Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> That makes sense. We're not going to get consensus but you demonstrated
</I>&gt;<i> mastery over this material. I am impressed.
</I>&gt;<i>
</I>&gt;<i> Please consider yourself owner of the page and edit as you see fit. I'll
</I>&gt;<i> keep an eye on your edits and make comments as you go.
</I>&gt;<i>
</I>&gt;<i> But please go ahead and charge.
</I>&gt;<i>
</I>&gt;<i> &gt; I also personally don&#8217;t recommend double submit cookies for enterprises
</I>&gt;<i> that have lot of subdomains for which they might not be sure if they are
</I>&gt;<i> 100% secure
</I>&gt;<i>
</I>&gt;<i> Makes sense, but what DO you suggest for stateless services and CSRF
</I>&gt;<i> defense?
</I>&gt;<i>
</I>&gt;<i> Aloha, Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8/10/18 10:41 AM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> Thanks. I also personally don&#8217;t recommend double submit cookies for
</I>&gt;<i> enterprises that have lot of subdomains for which they might not be sure if
</I>&gt;<i> they are 100% secure. More details are explained here
</I>&gt;<i> &lt;<A HREF="https://media.blackhat.com/eu-13/briefings/Lundeen/bh-eu-13-deputies-still-confused-lundeen-wp.pdf">https://media.blackhat.com/eu-13/briefings/Lundeen/bh-eu-13-deputies-still-confused-lundeen-wp.pdf</A>&gt;
</I>&gt;<i> (section 2.1.1). I think this is something that has to be mentioned in the
</I>&gt;<i> wiki as well.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Do we have a consensus process before we edit the page? Or current
</I>&gt;<i> discussion is enough?  How do we want to go next? I am not quite sure at
</I>&gt;<i> the moment if I will be able to contribute (I can let you know after
</I>&gt;<i> checking few details).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Friday, August 10, 2018 1:23 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;;
</I>&gt;<i> Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> All I'm saying is that it's a good idea to split browser standard based
</I>&gt;<i> CSRF defense and defenses that require tokens.
</I>&gt;<i>
</I>&gt;<i> And you know, I am not at all opposed to making tokens the primary
</I>&gt;<i> defense. I think that's totally fair. In fact for my words its...
</I>&gt;<i>
</I>&gt;<i> 1) Use a token method - either normal syncronizer tokens or
</I>&gt;<i> double-submit-cookies for stateless services. This is the main defense in
</I>&gt;<i> use today.
</I>&gt;<i>
</I>&gt;<i> 2) I also do header defense and think it's secondary. I only use headers
</I>&gt;<i> by themselves for lower risk services and it's normally easy to deploy as
</I>&gt;<i> long as I only need to defense posts. If get and posts transact, this
</I>&gt;<i> becomes tough to deploy.
</I>&gt;<i>
</I>&gt;<i> 3) I always use the samesite cookie for single-domain applications. This
</I>&gt;<i> gets weird in mash-up cases.
</I>&gt;<i>
</I>&gt;<i> So yea, I am totally ok for moving tokens to the primary defense of this
</I>&gt;<i> guide.
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i> On 8/10/18 10:16 AM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> *This is a false argument. *
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; I am not sure if you got the context there. It was is in response to
</I>&gt;<i> Dominique statement which said that we are delegating part of protection to
</I>&gt;<i> browsers if we solely reply on referrer/origin headers properly and hence
</I>&gt;<i> we need to depend on token as well (for which you +1&#8217;ed). I am confused now
</I>&gt;<i> that you are saying it as an browser standard (which means nothing should
</I>&gt;<i> wrong and we don&#8217;t need to worry about delegating protection to browser).
</I>&gt;<i> The discussion was also about browsers handling the data. Origin/referrer
</I>&gt;<i> header check is not easy deployment as well (considering proxies,
</I>&gt;<i> individual domains when a company has, around 50+ subdomains etc.). I feel
</I>&gt;<i> token mitigation is more easy using some OWASP libraries that provide
</I>&gt;<i> auto-tokening (this anyway is my personal opinion).
</I>&gt;<i>
</I>&gt;<i> One more thing we need to remember is that, if we solely rely on
</I>&gt;<i> origin/referrer header check - an XSS vulnerability within a single page on
</I>&gt;<i> that domain will also give CSRF vulnerability to all other state changing
</I>&gt;<i> operations under that entire domain. Considering that and also that
</I>&gt;<i> depending on browsers to send origin/referrer header &#8211; I feel token should
</I>&gt;<i> be used as a primary mitigation and origin/referrer header check as
</I>&gt;<i> defense-in-depth. Do we have any similar issues for tokens? If not &#8211; maybe
</I>&gt;<i> we should just do that. Either ways, it&#8217;s just my opinion &#8211; if there is no
</I>&gt;<i> consensus for it, we can just stop the debate and let it be the way it is.
</I>&gt;<i> I will be more than happy to always learn if there is something that I am
</I>&gt;<i> missing J
</I>&gt;<i>
</I>&gt;<i> *&gt; **Also, I know that samesite cookie itself is not supported on all
</I>&gt;<i> browsers but I&#8217;m more looking towards the text written on the wiki
</I>&gt;<i> (provides some protection against cross-site request forgery attacks), is
</I>&gt;<i> the &#8220;some&#8221; here refers to the partial support of the browsers? &#8211; Yes*
</I>&gt;<i>
</I>&gt;<i> It frankly does not provide that impression here. When me/couple of other
</I>&gt;<i> colleagues/friends of mine read it, we were thinking on the angle of issue
</I>&gt;<i> with the technology itself. I will be more than happy to edit it if you
</I>&gt;<i> guys agree or else again &#8211; we can just let the way it is :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Friday, August 10, 2018 12:51 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;;
</I>&gt;<i> Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; In a sense/In fact, we rely on browsers to protect CSRF tokens as well
</I>&gt;<i> &#8211; so if we do not trust browsers for sending referrer/origin headers
</I>&gt;<i> properly, we shouldn&#8217;t be trusting them to secure our tokens
</I>&gt;<i>
</I>&gt;<i> This is a false argument. One of these is fully controlled by the browser
</I>&gt;<i> via browser standards, one of these is controlled by individual programmers.
</I>&gt;<i>
</I>&gt;<i> &gt; Unless there is anything additional that origin/referrer header check
</I>&gt;<i> provides that&#8217;s not provided by token based mitigation
</I>&gt;<i>
</I>&gt;<i> What it also provides is VERY easy deployment capabilities like the same
</I>&gt;<i> site token. One of these is based on browser standards and again tokens
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-cheat-sheets/attachments/20180921/a8f93c36/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-cheat-sheets/attachments/20180921/a8f93c36/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000168.html">[OWASP-cheat-sheets] https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#167">[ date ]</a>
              <a href="thread.html#167">[ thread ]</a>
              <a href="subject.html#167">[ subject ]</a>
              <a href="author.html#167">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">More information about the OWASP-cheat-sheets
mailing list</a><br>
</body></html>
