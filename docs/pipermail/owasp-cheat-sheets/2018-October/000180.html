<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%0A%09https%3A//www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet&In-Reply-To=%3CCAL%3D9OGyNxb0eKf4mhS%3DjJTUfBNfbQvuV%3DsNVZ5BLNoVzVb6O6A%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000179.html">
   <LINK REL="Next"  HREF="000181.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet</H1>
    <B>Pankaj Upadhyay</B> 
    <A HREF="mailto:owasp-cheat-sheets%40lists.owasp.org?Subject=Re%3A%20%5BOWASP-cheat-sheets%5D%0A%09https%3A//www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet&In-Reply-To=%3CCAL%3D9OGyNxb0eKf4mhS%3DjJTUfBNfbQvuV%3DsNVZ5BLNoVzVb6O6A%40mail.gmail.com%3E"
       TITLE="[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet">p.upadhyay9999 at gmail.com
       </A><BR>
    <I>Sat Oct  6 19:51:00 UTC 2018</I>
    <P><UL>
        <LI>Previous message: <A HREF="000179.html">[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
</A></li>
        <LI>Next message: <A HREF="000181.html">[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#180">[ date ]</a>
              <a href="thread.html#180">[ thread ]</a>
              <a href="subject.html#180">[ subject ]</a>
              <a href="author.html#180">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Do we know, regarding login CSRF, why validating the custom header as well
as the Origin/Host header is not a sufficient mitigation?

On Fri, Sep 28, 2018 at 9:35 PM Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
wrote:

&gt;<i> Login CSRF is a way of exploiting CSRF on login forms (details here
</I>&gt;<i> &lt;<A HREF="https://seclab.stanford.edu/websec/csrf/csrf.pdf">https://seclab.stanford.edu/websec/csrf/csrf.pdf</A>&gt;). Though there is a
</I>&gt;<i> line about it in referrer validation section, it was not explained clearly
</I>&gt;<i> and how it can scale with other techniques such as token based mitigation.
</I>&gt;<i> No worries, I added a section about it!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Finally, I am done with the document from my side and its sent for
</I>&gt;<i> internal reviews now. It should take 1-2 weeks before it comes to you guys.
</I>&gt;<i> Meanwhile, I still need help on below items from you guys. If no one was
</I>&gt;<i> able to find references for a), we can very well remove it.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> a.     Under double submit cookie section, it is mentioned that DWR uses
</I>&gt;<i> that approach but I could not find that anywhere within DWR documentation
</I>&gt;<i> that it uses double submit cookie. Can someone help me finding reference if
</I>&gt;<i> they know any?
</I>&gt;<i>
</I>&gt;<i> b.     One thing I wouldn&#8217;t be reviewing is the ASP.NET references mentioned
</I>&gt;<i> in the wiki
</I>&gt;<i> &lt;<A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet#ASP.NET.2C_MVC_and_.NET_Web_Pages&gt;.
</I>&gt;<i> Can someone with .NET expertize verify if these are still accurate? Looks
</I>&gt;<i> to me like there are latest resources than the one&#8217;s linked in current
</I>&gt;<i> cheatsheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Happy weekend folks J
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt;
</I>&gt;<i> *Sent:* Thursday, September 27, 2018 3:02 AM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;; Jim Manico &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">owasp-cheat-sheets at lists.owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ...as for (d) I dont see any problems with passing tokens as headers or
</I>&gt;<i> parameters
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I dont understand (e) can you explain that again?
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Jim Manico
</I>&gt;<i>
</I>&gt;<i> @Manicode
</I>&gt;<i>
</I>&gt;<i> Secure Coding Education
</I>&gt;<i>
</I>&gt;<i> +1 (808) 652-3805
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Sep 26, 2018, at 4:46 PM, Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> 2 more questions added  (Jim already started helping me on #a)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> a.     I requested for an OWASP account and it&#8217;s still in pending. @JIM &#8211;
</I>&gt;<i> Can you please help me in getting my account approved? (registered with
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mani.konakandla at gmail.com</A>)
</I>&gt;<i>
</I>&gt;<i> b.     Under double submit cookie section, it is mentioned that DWR uses
</I>&gt;<i> that approach but I could not find that anywhere within DWR documentation
</I>&gt;<i> that it uses double submit cookie. Can someone help me finding reference if
</I>&gt;<i> they know any?
</I>&gt;<i>
</I>&gt;<i> c.     One thing I wouldn&#8217;t be reviewing is the ASP.NET references mentioned
</I>&gt;<i> in the wiki
</I>&gt;<i> &lt;<A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet#ASP.NET.2C_MVC_and_.NET_Web_Pages&gt;.
</I>&gt;<i> Can someone with .NET expertize verify if these are still accurate? Looks
</I>&gt;<i> to me like there are latest resources than the one&#8217;s linked
</I>&gt;<i>
</I>&gt;<i> d.     At few places within the wiki, I have seen recommending to include
</I>&gt;<i> token in headers for Ajax requests. I also don&#8217;t see a problem in passing
</I>&gt;<i> them as parameters as well. Do you guys see any?
</I>&gt;<i>
</I>&gt;<i> e.     I also have not seen at any place within the wiki talking about
</I>&gt;<i> login CSRF issues and how each of the techniques described can be
</I>&gt;<i> prone/immune to it. Is there any reason for it or are we open to include
</I>&gt;<i> that?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Konakandla, Manideep
</I>&gt;<i> *Sent:* Wednesday, September 26, 2018 5:27 PM
</I>&gt;<i> *To:* 'Jim Manico' &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt;; 'Dominique Righetto' &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* 'Jim Manico' &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; 'Dave Wichers' &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; '<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>' &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">owasp-cheat-sheets at lists.owasp.org</A>
</I>&gt;<i> *Subject:* RE:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Yeah. My understanding of the breadth of exploitation of XSS in an
</I>&gt;<i> application protected with just origin/referrer and other application
</I>&gt;<i> protected with just token based mitigation earlier was wrong. Dominique
</I>&gt;<i> earlier email thread cleared that to me (breadth of exploitation is same in
</I>&gt;<i> both the cases. i.e., if an XSS vulnerability is found in any individual
</I>&gt;<i> application protected with only one of those techniques, it still can
</I>&gt;<i> exploit all state changing operations on entire application [though the
</I>&gt;<i> complexity of exploitation is easy in origin/referrer check than token
</I>&gt;<i> based mitigation]).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Anyway, I am all clear and also almost done with re-factoring the
</I>&gt;<i> cheatsheet  [1] J Should be fully completed by Friday unless something
</I>&gt;<i> comes up meanwhile. I will then send it to my colleagues for review and
</I>&gt;<i> then for Legal, PR approvals. Before that, I need help from you guys on
</I>&gt;<i> below items
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> a.     I requested for an OWASP account and it&#8217;s still in pending. @JIM &#8211;
</I>&gt;<i> Can you please help me in getting my account approved? (registered with
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mani.konakandla at gmail.com</A>)
</I>&gt;<i>
</I>&gt;<i> b.     Under double submit cookie section, it is mentioned that DWR uses
</I>&gt;<i> that approach but I could not find that anywhere within DWR documentation
</I>&gt;<i> that it uses double submit cookie. Can someone help me finding reference if
</I>&gt;<i> they know any?
</I>&gt;<i>
</I>&gt;<i> c.     One thing I wouldn&#8217;t be reviewing is the ASP.NET references mentioned
</I>&gt;<i> in the wiki
</I>&gt;<i> &lt;<A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet#ASP.NET.2C_MVC_and_.NET_Web_Pages&gt;.
</I>&gt;<i> Can someone with .NET expertize verify if these are still accurate? Looks
</I>&gt;<i> to me like there are latest resources than the one&#8217;s linked
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] Below are changes done so far
</I>&gt;<i>
</I>&gt;<i> a. Switched primary, secondary defense and our reasoning behind it (added
</I>&gt;<i> lot of reasons on issues with origin/referrer header check and why token
</I>&gt;<i> should be made primary)
</I>&gt;<i>
</I>&gt;<i> b. Added CSRF mitigation myths (CORS, content-type validation etc.)
</I>&gt;<i>
</I>&gt;<i> c. Added a section called &#8220;Not so popular CSRF mitigations&#8221; (mentioned
</I>&gt;<i> details about triple submit cookie)
</I>&gt;<i>
</I>&gt;<i> d. Included limitations / issues associated with double submit cookie,
</I>&gt;<i> same site cookie, captcha as a CSRF defense etc.
</I>&gt;<i>
</I>&gt;<i> e. Removed lot of obsolete content and added some new content to some of
</I>&gt;<i> the mitigations
</I>&gt;<i>
</I>&gt;<i> f. Made document look more better by adding RFC&#8217;s links wherever possible
</I>&gt;<i> and lot of other minor changes.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt;
</I>&gt;<i> *Sent:* Wednesday, September 26, 2018 4:19 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;; Dominique Righetto &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well tokens can be placed in cookies.
</I>&gt;<i>
</I>&gt;<i> The real answer to avoid CSRF is tokens in JavaScript variable as opposed
</I>&gt;<i> to cookies. They are not automatically sent and indeed make CSRF impossible
</I>&gt;<i> - at the expense of tokens being fully stolen via XSS. Pick your poison!
</I>&gt;<i>
</I>&gt;<i> I recommend a COMBO of these defenses. For web apps, sychronizer token +
</I>&gt;<i> header verification + re-authentication for sensitive features.
</I>&gt;<i>
</I>&gt;<i> For API's double-cookie submit or just use JavaScript variable based
</I>&gt;<i> tokens + header verification for same-site API's + re-authentication for
</I>&gt;<i> sensitive features.
</I>&gt;<i>
</I>&gt;<i> &gt; [1] If there is an XSS vulnerability at a single place on a domain (it
</I>&gt;<i> can add custom header), it can be used to make CSRF *on all other state
</I>&gt;<i> changing operationswithin that domain *done to that AJAX endpoint. Do you
</I>&gt;<i> agree?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Absolutely!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 9/20/18 11:12 AM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> Yeah, I understand that any XSS and CSRF game is over but I am stressing
</I>&gt;<i> out on the highlighted part in [1]. I am trying to highlight and get an
</I>&gt;<i> affirmation on why my understanding on token based mitigation is better
</I>&gt;<i> than origin/referrer header check will also apply to &#8220;token based
</I>&gt;<i> mitigation Vs custom header mitigation (if static tokens are used in custom
</I>&gt;<i> headers)&#8221;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> In case of tokens, we have an option to use different tokens on each page
</I>&gt;<i> (taking things like URL, timestamp etc. into consideration) and hence XSS
</I>&gt;<i> vulnerability on one page will only make state changing operations in that
</I>&gt;<i> page vulnerable to CSRF but not state changing operations on other pages
</I>&gt;<i> within that domain (because token value is different) but whereas in
</I>&gt;<i> origin/referrer header check and custom header check, the token value is
</I>&gt;<i> constant and hence XSS vulnerability in one page will also cause state
</I>&gt;<i> changing operations in other pages to be vulnerable to CSRF as well. Off
</I>&gt;<i> course, this can be mitigated in custom header checks by adding tokens to
</I>&gt;<i> custom headers rather than static constant but this cannot be mitigated in
</I>&gt;<i> origin/referrer check because those headers cannot be modified. So, yeah a
</I>&gt;<i> single XSS any CSRF is bypassed but the breadth of the impact is different
</I>&gt;<i> for each of them.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Regarding code samples &#8211; I currently was able to allocate only some time
</I>&gt;<i> for this task and I don&#8217;t think I will be able to do code samples within
</I>&gt;<i> this time frame. I am also leaving for a long vacation starting Oct 12 and
</I>&gt;<i> hence let&#8217;s try to get this out first and we can add code samples later on
</I>&gt;<i> considering my work load after I return from vacation.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] If there is an XSS vulnerability at a single place on a domain (it can
</I>&gt;<i> add custom header), it can be used to make CSRF *on all other state
</I>&gt;<i> changing operations* *within that domain *done to that AJAX endpoint. Do
</I>&gt;<i> you agree?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, September 20, 2018 8:45 AM
</I>&gt;<i> *To:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt;
</I>&gt;<i> *Cc:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;;
</I>&gt;<i> Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your contribution.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I like very much your plan &#128521;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I ask for some favor in addition :
</I>&gt;<i>
</I>&gt;<i> - can you provide code sample (in one language like java or .net or the
</I>&gt;<i> one you want but it must be easy to read and understand) or libraires along
</I>&gt;<i> your proposal for each section?
</I>&gt;<i>
</I>&gt;<i> - can you use the syntaxhighlight tag for code?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'am agree with Jim, XSS  means game over because your browsing context
</I>&gt;<i> can be used as proxy so csrf protection will be defeated because request
</I>&gt;<i> came from the legitimate user.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks you again for all your help &#128077;&#128077;&#128077;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le jeu. 20 sept. 2018 &#224; 18:31, Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim at manicode.com</A>&gt; a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> &gt; If there is an XSS vulnerability at a single place on a domain (it can
</I>&gt;<i> add custom header), it can be used to make CSRF on all other state changing
</I>&gt;<i> operations within that domain done to that AJAX endpoint. Do you agree?
</I>&gt;<i>
</I>&gt;<i> Any XSS is game over and all CSRF are useless in the face of XSS. I Agree!
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 9/19/18 10:52 PM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> Hey Guys,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] is what I said for origin/referrer header check in this e-mail thread.
</I>&gt;<i> I also believe that this applies for custom headers for AJAX endpoints as
</I>&gt;<i> well. If there is an XSS vulnerability at a single place on a domain (it
</I>&gt;<i> can add custom header), it can be used to make CSRF on all other state
</I>&gt;<i> changing operations within that domain done to that AJAX endpoint. Do you
</I>&gt;<i> agree?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here is how I am keeping the new re-factored cheatsheet. Does this look
</I>&gt;<i> good to you guys?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1.       Use token based method as primary defense
</I>&gt;<i>
</I>&gt;<i> a.       Can use synchronizer pattern for stateful applications
</I>&gt;<i>
</I>&gt;<i> b.       Can use hah based/ encryption based token pattern for stateless
</I>&gt;<i> applications
</I>&gt;<i>
</I>&gt;<i> 2.       Defense in depth measures along with drawbacks of each one
</I>&gt;<i>
</I>&gt;<i> a.       Origin/referrer header check
</I>&gt;<i>
</I>&gt;<i> b.       Double submit cookie
</I>&gt;<i>
</I>&gt;<i> c.       Samesite cookie
</I>&gt;<i>
</I>&gt;<i> d.       Custom headers (people still need to use tokens for forms etc.
</I>&gt;<i> if they have mix of ajax endpoints and general HTML)
</I>&gt;<i>
</I>&gt;<i> 3.       Strong CSRF defenses but very less usable : captcha etc.
</I>&gt;<i>
</I>&gt;<i> 4.       CSRF Myths / techniques that do not work section
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> [1] if we solely rely on origin/referrer header check - an XSS
</I>&gt;<i> vulnerability within a single page on that domain will also give CSRF
</I>&gt;<i> vulnerability to all other state changing operations under that entire
</I>&gt;<i> domain.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Wednesday, September 12, 2018 1:31 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave
</I>&gt;<i> Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks you very much for the update
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le mer. 12 sept. 2018 &#224; 21:33, Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> Just an update: I started working on this along with other sprint tasks of
</I>&gt;<i> mine today. I am hoping to get it completed by end of next week and then
</I>&gt;<i> send it for legal/PR approvals.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, August 23, 2018 6:49 AM
</I>&gt;<i> *To:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;; Konakandla,
</I>&gt;<i> Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Awesome! Thank you! :)
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8/23/18 2:41 AM, Dominique Righetto wrote:
</I>&gt;<i>
</I>&gt;<i> You are welcome :)
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Cordialement, Best regards,
</I>&gt;<i> Dominique Righetto
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://righettod.eu">https://righettod.eu</A>
</I>&gt;<i> GPG: 323D19BA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 23, 2018 at 10:33 AM Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> Np. I will keep u guys posted. Thanks for the support and have good rest
</I>&gt;<i> of your day!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, August 23, 2018 1:29 AM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sounds goods for me.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks again for the contribution :)
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Cordialement, Best regards,
</I>&gt;<i> Dominique Righetto
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://righettod.eu">https://righettod.eu</A>
</I>&gt;<i> GPG: 323D19BA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Thu, Aug 23, 2018 at 10:03 AM Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;<i> Ok, I received necessary approvals for working on this. I am hoping to
</I>&gt;<i> start the work in 2 weeks and then deliver the document to you guys for
</I>&gt;<i> review by end of September/1st week of October (might be 1-2 weeks delay
</I>&gt;<i> if approvals from Legal and other teams get delayed). My plan is to work on
</I>&gt;<i> below things &#8211; Please let me know if I missed anything/you feel something
</I>&gt;<i> else has to be added to this list.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1.       Change the order of primary and defense in depth measures
</I>&gt;<i>
</I>&gt;<i> 2.       Include the pitfalls/caveats for each CSRF mitigation technique
</I>&gt;<i> (origin/referrer header, samesite, double submit cookie etc.)
</I>&gt;<i>
</I>&gt;<i> 3.       Re-structure entire page and remove outdated/ non-relevant stuff
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Thursday, August 16, 2018 12:02 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> *Cc:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ok i perfectly understand.
</I>&gt;<i>
</I>&gt;<i> Thanks for the info.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le jeu. 16 ao&#251;t 2018 &#224; 20:33, Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;
</I>&gt;<i> a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> I had an offline discussion with Jim and informed him that I will have to
</I>&gt;<i> check few details before I give any commitment to update the guidance&#8217;s
</I>&gt;<i> here.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Update: I got approval internally from my team to work on this (fix issues
</I>&gt;<i> and re-structure entire page) but I still need to get approval from Legal
</I>&gt;<i> team to work on this. I will let you guys know when I hear back from them.
</I>&gt;<i> Most likely they will ask me to just get it reviewed with them before
</I>&gt;<i> sending it to you guys for review/get it published on OWASP page.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Tuesday, August 14, 2018 11:02 PM
</I>&gt;<i> *To:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;; Dave Wichers &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Roadmap has been updated: <A HREF="https://trello.com/b/w020m3jQ/cs-roadmap">https://trello.com/b/w020m3jQ/cs-roadmap</A>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Cordialement, Best regards,
</I>&gt;<i> Dominique Righetto
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at gmail.com</A>&gt;
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://righettod.eu">https://righettod.eu</A>
</I>&gt;<i> GPG: 323D19BA
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On Mon, Aug 13, 2018 at 6:03 AM Dominique Righetto &lt;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> I have finally achieved to read the thread, very interesting  &#128521;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I understand the need to simplify the cheat sheet and the solutions
</I>&gt;<i> proposed. It is one of the reason why i have add code sample. So this
</I>&gt;<i> contribution is a very good point.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just a little thing about header, take care to ensure that the referrer
</I>&gt;<i> policy of the site is not set to no-referrer otherwise you cannot use
</I>&gt;<i> origin/referrer headers couple to create a protection layer.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Tanks you for the helps proposal &#128521;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Le dim. 12 ao&#251;t 2018 &#224; 22:21, Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; a &#233;crit :
</I>&gt;<i>
</I>&gt;<i> That makes sense. We're not going to get consensus but you demonstrated
</I>&gt;<i> mastery over this material. I am impressed.
</I>&gt;<i>
</I>&gt;<i> Please consider yourself owner of the page and edit as you see fit. I'll
</I>&gt;<i> keep an eye on your edits and make comments as you go.
</I>&gt;<i>
</I>&gt;<i> But please go ahead and charge.
</I>&gt;<i>
</I>&gt;<i> &gt; I also personally don&#8217;t recommend double submit cookies for enterprises
</I>&gt;<i> that have lot of subdomains for which they might not be sure if they are
</I>&gt;<i> 100% secure
</I>&gt;<i>
</I>&gt;<i> Makes sense, but what DO you suggest for stateless services and CSRF
</I>&gt;<i> defense?
</I>&gt;<i>
</I>&gt;<i> Aloha, Jim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 8/10/18 10:41 AM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> Thanks. I also personally don&#8217;t recommend double submit cookies for
</I>&gt;<i> enterprises that have lot of subdomains for which they might not be sure if
</I>&gt;<i> they are 100% secure. More details are explained here
</I>&gt;<i> &lt;<A HREF="https://media.blackhat.com/eu-13/briefings/Lundeen/bh-eu-13-deputies-still-confused-lundeen-wp.pdf">https://media.blackhat.com/eu-13/briefings/Lundeen/bh-eu-13-deputies-still-confused-lundeen-wp.pdf</A>&gt;
</I>&gt;<i> (section 2.1.1). I think this is something that has to be mentioned in the
</I>&gt;<i> wiki as well.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Do we have a consensus process before we edit the page? Or current
</I>&gt;<i> discussion is enough?  How do we want to go next? I am not quite sure at
</I>&gt;<i> the moment if I will be able to contribute (I can let you know after
</I>&gt;<i> checking few details).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Friday, August 10, 2018 1:23 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;;
</I>&gt;<i> Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> All I'm saying is that it's a good idea to split browser standard based
</I>&gt;<i> CSRF defense and defenses that require tokens.
</I>&gt;<i>
</I>&gt;<i> And you know, I am not at all opposed to making tokens the primary
</I>&gt;<i> defense. I think that's totally fair. In fact for my words its...
</I>&gt;<i>
</I>&gt;<i> 1) Use a token method - either normal syncronizer tokens or
</I>&gt;<i> double-submit-cookies for stateless services. This is the main defense in
</I>&gt;<i> use today.
</I>&gt;<i>
</I>&gt;<i> 2) I also do header defense and think it's secondary. I only use headers
</I>&gt;<i> by themselves for lower risk services and it's normally easy to deploy as
</I>&gt;<i> long as I only need to defense posts. If get and posts transact, this
</I>&gt;<i> becomes tough to deploy.
</I>&gt;<i>
</I>&gt;<i> 3) I always use the samesite cookie for single-domain applications. This
</I>&gt;<i> gets weird in mash-up cases.
</I>&gt;<i>
</I>&gt;<i> So yea, I am totally ok for moving tokens to the primary defense of this
</I>&gt;<i> guide.
</I>&gt;<i>
</I>&gt;<i> - Jim
</I>&gt;<i>
</I>&gt;<i> On 8/10/18 10:16 AM, Konakandla, Manideep wrote:
</I>&gt;<i>
</I>&gt;<i> *This is a false argument. *
</I>&gt;<i>
</I>&gt;<i> &gt;&gt; I am not sure if you got the context there. It was is in response to
</I>&gt;<i> Dominique statement which said that we are delegating part of protection to
</I>&gt;<i> browsers if we solely reply on referrer/origin headers properly and hence
</I>&gt;<i> we need to depend on token as well (for which you +1&#8217;ed). I am confused now
</I>&gt;<i> that you are saying it as an browser standard (which means nothing should
</I>&gt;<i> wrong and we don&#8217;t need to worry about delegating protection to browser).
</I>&gt;<i> The discussion was also about browsers handling the data. Origin/referrer
</I>&gt;<i> header check is not easy deployment as well (considering proxies,
</I>&gt;<i> individual domains when a company has, around 50+ subdomains etc.). I feel
</I>&gt;<i> token mitigation is more easy using some OWASP libraries that provide
</I>&gt;<i> auto-tokening (this anyway is my personal opinion).
</I>&gt;<i>
</I>&gt;<i> One more thing we need to remember is that, if we solely rely on
</I>&gt;<i> origin/referrer header check - an XSS vulnerability within a single page on
</I>&gt;<i> that domain will also give CSRF vulnerability to all other state changing
</I>&gt;<i> operations under that entire domain. Considering that and also that
</I>&gt;<i> depending on browsers to send origin/referrer header &#8211; I feel token should
</I>&gt;<i> be used as a primary mitigation and origin/referrer header check as
</I>&gt;<i> defense-in-depth. Do we have any similar issues for tokens? If not &#8211; maybe
</I>&gt;<i> we should just do that. Either ways, it&#8217;s just my opinion &#8211; if there is no
</I>&gt;<i> consensus for it, we can just stop the debate and let it be the way it is.
</I>&gt;<i> I will be more than happy to always learn if there is something that I am
</I>&gt;<i> missing J
</I>&gt;<i>
</I>&gt;<i> *&gt; **Also, I know that samesite cookie itself is not supported on all
</I>&gt;<i> browsers but I&#8217;m more looking towards the text written on the wiki
</I>&gt;<i> (provides some protection against cross-site request forgery attacks), is
</I>&gt;<i> the &#8220;some&#8221; here refers to the partial support of the browsers? &#8211; Yes*
</I>&gt;<i>
</I>&gt;<i> It frankly does not provide that impression here. When me/couple of other
</I>&gt;<i> colleagues/friends of mine read it, we were thinking on the angle of issue
</I>&gt;<i> with the technology itself. I will be more than happy to edit it if you
</I>&gt;<i> guys agree or else again &#8211; we can just let the way it is :)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *From:* Jim Manico &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">jim.manico at owasp.org</A>&gt;
</I>&gt;<i> *Sent:* Friday, August 10, 2018 12:51 PM
</I>&gt;<i> *To:* Konakandla, Manideep &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">mkonakan at amazon.com</A>&gt;;
</I>&gt;<i> Dominique Righetto &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dominique.righetto at owasp.org</A>&gt;
</I>&gt;<i> *Cc:* Dave Wichers &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt; &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">dave.wichers at owasp.org</A>&gt;;
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">eric.sheridan at owasp.org</A>
</I>&gt;<i> *Subject:* Re:
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF">https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF</A>)_Prevention_Cheat_Sheet
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> &gt; In a sense/In fact, we rely on browsers to protect CSRF tokens as well
</I>&gt;<i> &#8211; so if we do not trust browsers for sending referrer/origin headers
</I>&gt;<i> properly, we shouldn&#8217;t be trusting them to secure our tokens
</I>&gt;<i>
</I>&gt;<i> This is a false argument. One of these is fully controlled by the browser
</I>&gt;<i> via browser standards, one of these is controlled by individual programmers.
</I>&gt;<i>
</I>&gt;<i> &gt; Unless there is anything additional that origin/referrer header check
</I>&gt;<i> provides that&#8217;s not provided by token based mitigation
</I>&gt;<i>
</I>&gt;<i> What it also provides is VERY easy deployment capabilities like the same
</I>&gt;<i> site token. One of these is based on browser standards and again tokens
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> Jim Manico
</I>&gt;<i>
</I>&gt;<i> Manicode Security
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://www.manicode.com">https://www.manicode.com</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> OWASP-cheat-sheets mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">OWASP-cheat-sheets at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.owasp.org/pipermail/owasp-cheat-sheets/attachments/20181006/e59ac743/attachment-0001.html">http://lists.owasp.org/pipermail/owasp-cheat-sheets/attachments/20181006/e59ac743/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000179.html">[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
</A></li>
	<LI>Next message: <A HREF="000181.html">[OWASP-cheat-sheets]	https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#180">[ date ]</a>
              <a href="thread.html#180">[ thread ]</a>
              <a href="subject.html#180">[ subject ]</a>
              <a href="author.html#180">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-cheat-sheets">More information about the OWASP-cheat-sheets
mailing list</a><br>
</body></html>
