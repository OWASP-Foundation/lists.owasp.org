<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-turkey] Ar&#305;zay&#305; Bul #6
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-turkey%40lists.owasp.org?Subject=%5BOwasp-turkey%5D%20%3D%3Futf-8%3Fb%3FQXLEsXphecSxIEJ1bCAjNg%3D%3D%3F%3D&In-Reply-To=4B196360.3010800%40isadamlari.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000801.html">
   <LINK REL="Next"  HREF="000800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-turkey] Ar&#305;zay&#305; Bul #6</H1>
    <B>Bedirhan Urgun</B> 
    <A HREF="mailto:owasp-turkey%40lists.owasp.org?Subject=%5BOwasp-turkey%5D%20%3D%3Futf-8%3Fb%3FQXLEsXphecSxIEJ1bCAjNg%3D%3D%3F%3D&In-Reply-To=4B196360.3010800%40isadamlari.org"
       TITLE="[Owasp-turkey] Ar&#305;zay&#305; Bul #6">bedirhanurgun at gmail.com
       </A><BR>
    <I>Sat Dec  5 11:05:19 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000801.html">[Owasp-turkey] Ar&#305;zay&#305; Bul #6
</A></li>
        <LI>Next message: <A HREF="000800.html">[Owasp-turkey] Owasp-turkey Digest, Vol 33, Issue 3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#804">[ date ]</a>
              <a href="thread.html#804">[ thread ]</a>
              <a href="subject.html#804">[ subject ]</a>
              <a href="author.html#804">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>evet soru biraz genel oldu. daha fazla aciklama yapmam gerekiyordu, hata
benim.

bu bir j2ee web uygulamasi ve *session*, HttpSession implementasyonunun
instance'i. Yani klasik

*public void doPost (HttpServletRequest req, HttpServletResponse res) throws
ServletException, IOException
{
   HttpSession session = req.getSession(true);*
   ...
*   synchronized (session) {
      // ... CS
   }*
  ...

developer boyle bir kod ile critical section'i senkronize etmeye
calisiyor. Web uygulamalarinda HTTP istekleri thread'ler ile karsilaniyor
genel olarak (ASP.NET ve PHP'de de ayni, yanlissam duzeltin). Ayni kullanici
ayni anda iki istek gonderdiginde, yukaridaki kodu calistiran iki thread
olusturuluyor sunucu tarafinda. Ve bu iki thread'in yukaridaki critical
section'a tek tek girmesi ve cikmasi isteniyor (mesela bir havale/eft islemi
veya bilet alimi...).

Senkronizasyonun saglanmasi icin degismeyen bir nesne lazim bize. Developer,
hakli olarak, kullanicinin *session *nesnesini kullaniyor cunku bu nesne
istekler boyunca degismez. session'in mantigi bu.

Ama gelin gorun ki, getSession() metodu iki ayri cagirista ayni session
instance'ini donmeyebiliyormus. Yani icindeki bilgiler (kullanici ismi,
profili, en onemlisi session id, v.b.) ayni ama instance farkli. Servlet
specification'i boyle buyuruyormus. Ayni nesne donmeyince de, ayni nesne
uzerine lock/unlock islemi yapilmayinca senkronizasyon calismiyor. Bu
nedenle senkronizasyonu saglamak icin baska birsey lazim. O da

*synchronized ( session.getId().intern() ) {
 // CS
}*

iste burasi derin geldi bana. getId() metodu istekler boyunca degismeyen
bildigimiz sessionid (mesela, JSESSIONID=ab34126506708923j2). Bu bir Java
string. Peki Java String sinifinin intern() metodu ne yapiyor?

<A HREF="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#intern(">http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#intern(</A>)

*A pool of strings, initially empty, is maintained privately by the class
String. *

*When the intern method is invoked, if the pool already contains a string
equal to this String object as determined by the
**equals(Object)*&lt;<A HREF="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#equals(java.lang.Object">http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html#equals(java.lang.Object</A>)&gt;
* method, then the string from the pool is returned. Otherwise, this
Stringobject is added to the pool and a reference to this
String object is returned.*

Yani *session* ayni instance olmayabilir ama *String* sinifi bir havuz
tutuyormus ve eger bu string (JSESSIONID=...) bu havuzda varsa, yeniden
olusturmayip burdan donuyormus. En azindan benim anladigim bu. Yani ayni
String nesnesi. Boylece synchronized, iki istekte de ayni nesne
kullanildigindan lock/unlock beklendigi gibi calisiyor.

Not: Soruyu gecen sene bir mail listesinde okumustum. Apache-Tomcat mail
listesi olabilir, hatirlamiyorum.

bedirhan
04 Aral&#196;&#177;k 2009 21:30 tarihinde Mehmet Salih YILDIRIM
&lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">linux at isadamlari.org</A>&gt;yazd&#196;&#177;:

&gt;<i> Soru a&#197;&#159;&#196;&#177;r&#196;&#177; genel olmakla beraber,
</I>&gt;<i>
</I>&gt;<i> //sample critical section 1
</I>&gt;<i> syncronized (session1){
</I>&gt;<i>     // ...
</I>&gt;<i>     // ..
</I>&gt;<i>     // .
</I>&gt;<i>     syncronized(session2){
</I>&gt;<i>        //...
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i> //sample critical section2
</I>&gt;<i> syncronized (session2){
</I>&gt;<i>     // ...
</I>&gt;<i>     // ..
</I>&gt;<i>     // .
</I>&gt;<i>     syncronized(session1){
</I>&gt;<i>        //...
</I>&gt;<i>     }
</I>&gt;<i> }
</I>&gt;<i>
</I>&gt;<i> durumunda kullan&#196;&#177;l&#196;&#177;rsa, bir thread CS1 e girip, bir ba&#197;&#159;ka thread ayn&#196;&#177; anda
</I>&gt;<i> CS2'ye girerse, &#195;&#188;zerine bunlar hold and wait yaparsa, bunun da &#195;&#188;st&#195;&#188;ne
</I>&gt;<i> i&#197;&#159;letim sisteminin scheduling management k&#196;&#177;sm&#196;&#177; kalitesizse deadlock olur
</I>&gt;<i> efendim. Muhtemelen aranan cevap bu de&#196;&#159;il ama soru &#195;&#167;ok genel oldu&#196;&#159;undan bu
</I>&gt;<i> kadar yazabildim ancak.
</I>&gt;<i>
</I>&gt;<i> Bu senaryoya g&#195;&#182;re &#195;&#167;&#195;&#182;z&#195;&#188;m bir ka&#195;&#167; &#197;&#159;ekilde olabilir, birincisi thread lerden
</I>&gt;<i> bir tanesini &#195;&#182;ld&#195;&#188;rmek :D
</I>&gt;<i> ikincisi nested syncronized kullanmamak olabilir.
</I>&gt;<i> &#195;&#156;&#195;&#167;&#195;&#188;nc&#195;&#188; &#195;&#167;&#195;&#182;z&#195;&#188;m en g&#195;&#188;zeli, bu iki critical section'&#196;&#177; ayn&#196;&#177; lock de&#196;&#159;i&#197;&#159;keni
</I>&gt;<i> koruyabilir. B&#195;&#182;ylece birisine bir process girdi&#196;&#159;inde di&#196;&#159;erine ba&#197;&#159;ka bir
</I>&gt;<i> process giremeyecektir.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Bedirhan Urgun wrote:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> arizalara bi tane daha.
</I>&gt;<i>
</I>&gt;<i> *synchronized (session) {
</I>&gt;<i>  // ...
</I>&gt;<i> }*
</I>&gt;<i>
</I>&gt;<i> yukaridaki Java kod parcasindaki muhtemel problem ne olabilir ve nasil
</I>&gt;<i> duzeltilebilir?
</I>&gt;<i>
</I>&gt;<i> bedirhan
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-turkey mailing <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">listOwasp-turkey at lists.owasp.orghttps</A>://lists.owasp.org/mailman/listinfo/owasp-turkey
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-turkey mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">Owasp-turkey at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">https://lists.owasp.org/mailman/listinfo/owasp-turkey</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Bedirhan Urgun
<A HREF="http://www.webguvenligi.org">http://www.webguvenligi.org</A>
<A HREF="http://www.owasp.org/index.php/Turkey">http://www.owasp.org/index.php/Turkey</A>

T&#195;&#188;rk&#195;&#167;e Web Uygulama G&#195;&#188;venli&#196;&#159;i E-Posta Listesine &#195;&#188;ye olmak i&#195;&#167;in:
<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">https://lists.owasp.org/mailman/listinfo/owasp-turkey</A>
-------------- sonraki b&#246;l&#252;m --------------
Bir HTML eklentisi temizlendi...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-turkey/attachments/20091205/bb0c12fe/attachment.html">https://lists.owasp.org/pipermail/owasp-turkey/attachments/20091205/bb0c12fe/attachment.html</A> 
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000801.html">[Owasp-turkey] Ar&#305;zay&#305; Bul #6
</A></li>
	<LI>Next message: <A HREF="000800.html">[Owasp-turkey] Owasp-turkey Digest, Vol 33, Issue 3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#804">[ date ]</a>
              <a href="thread.html#804">[ thread ]</a>
              <a href="subject.html#804">[ subject ]</a>
              <a href="author.html#804">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-turkey">More information about the Owasp-turkey
mailing list</a><br>
</body></html>
