<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-turkey] [netsec] Re:  Under DDos Attack
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-turkey%40lists.owasp.org?Subject=%5BOwasp-turkey%5D%20%5Bnetsec%5D%20Re%3A%20%20Under%20DDos%20Attack&In-Reply-To=4911E8B9.6090409%40lifeoverip.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000489.html">
   <LINK REL="Next"  HREF="000492.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-turkey] [netsec] Re:  Under DDos Attack</H1>
    <B>Ferruh Mavituna</B> 
    <A HREF="mailto:owasp-turkey%40lists.owasp.org?Subject=%5BOwasp-turkey%5D%20%5Bnetsec%5D%20Re%3A%20%20Under%20DDos%20Attack&In-Reply-To=4911E8B9.6090409%40lifeoverip.net"
       TITLE="[Owasp-turkey] [netsec] Re:  Under DDos Attack">ferruh at mavituna.com
       </A><BR>
    <I>Wed Nov  5 22:00:08 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000489.html">[Owasp-turkey] [netsec] Re:  Under DDos Attack
</A></li>
        <LI>Next message: <A HREF="000492.html">[Owasp-turkey] [netsec] Re:  Under DDos Attack
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#491">[ date ]</a>
              <a href="thread.html#491">[ thread ]</a>
              <a href="subject.html#491">[ subject ]</a>
              <a href="author.html#491">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Simdi tabii ki haklisin firewall bu istekleri gorebiliyor ama isteklerin
gercek bir kullanicidan mi saldirgandan mi oldugunu bilmiyor. Dolayisiyla
firewall saldirganin yaptigi bit GET istegi ile gercek bir kullanicinin
yaptigi GET istegini ayirt edemeyecektir, bunu en iyi yapabilmek icin istegi
anlayabilmek lazim. Olay application seviyesine gelince session vs. gibi
cozumler isin icine giriyor.

Mesela diyelim ki firewall da 80 portuna 10 sn. 50 istek limiti koydunuz,
firewall bu istekler resimlere mi? Javascriptlere mi, yoksa PHP ye mi
yapiliyor bilemeyecek, yani PHP ye 50 GET istegi yapan kisi ile ana sayfayi
ziyaret edip 50 kaynaga istek yapan iki kiside banlanmis olacak ki, bu
kaynak tuketiminden daha gecerli bir DoS olabilir :)

Simdi Musa soylediklerine bakilirsa olay agir PHP de (Oscommerce hakikatan
hantal) ve MySQL de kitleniyor. Bunun anlami eger apache noktasinda bu ayrim
yapilabilirse sorun cikmayacaktir. Eger

Tabi binlerce ip adresinden gelecek birer istek karsisinda cok birsey
&gt;<i> yapamaz ama boyle bir saldiri tipi ile henuz karsilasmadim ben.
</I>

Acikcasi benim yakin donemde karsilastigim bir saldiri bu sekildeydi,
nitekim ne application seviyesinde ne de firewall seviyesinde elimizdeki
kisitli butce ile guzel bir cozum uretemedik, bir noktadan sonra DDoS
saldiri basarili ise, ayni OSYM ornegi gibi konu tamamen fiziksel donanim ve
uygulamanin kalitesine dayaniyor. Bunun bir ornegi de Iframe ile DoS yapmak.


Mesela ebay' i hack etti birisi ebay' in anasayfasina iframe ile sizin
sayfayi acti. Bunun anlami ebay' in trafiginin %50 sinin size gelmesi demek
bu da slashdot effect gibi bir durum, 10 dk. icerisinde sistem cokecek cunku
yapabilecek cok bir sey yok. Bu application seviyesinde (bir noktaya kadar)
cozulebilir ama firewall seviyesinde bu ayrimi yapmak mumkun degil.

OSYM orneginde yapilacak sey buyuk sitelerin yaptigi, load balancer arkasina
gerektigi kadar web server ve database clustering. Ve uygulamaya gore
donanim, mesela uygulama tum datayi RAM de tutabilecek gibiyse ona gore
donanima agirlik vermek.

2008/11/5 Huzeyfe ONAL &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">huzeyfe at lifeoverip.net</A>&gt;

&gt;<i> Selamlar,
</I>&gt;<i>
</I>&gt;<i> bir saldirgan GET flood islemini nasil yapabilir dusunelim;
</I>&gt;<i>
</I>&gt;<i> ilk bakista benim aklima bu isin farkli IP adreslerinden yuzlerce/binlerce
</I>&gt;<i> http istegi olusturrarak yapilmasi geliyor.
</I>&gt;<i>
</I>&gt;<i> Oncelikle GET flood yapabilmesi icin TCP 3way handshake islemini tamamlamak
</I>&gt;<i> zorundadir. Demekki yapilacak her GET flood islemi bizim Firewall tarafindan
</I>&gt;<i> gorulecek.
</I>&gt;<i>
</I>&gt;<i> Yani ben Firewallumda SYNProxy ve stateful tracking ozelliklerini
</I>&gt;<i> kullanarak farkli ip adreslerinden gelecek get floodlarini TCP/IP
</I>&gt;<i> seviyesinde gorebilecegim icin daha web sunucuya ulastirmadan
</I>&gt;<i> engelleyebilirim. Tabi binlerce ip adresinden gelecek birer istek karsisinda
</I>&gt;<i> cok birsey yapamaz ama boyle bir saldiri tipi ile henuz karsilasmadim ben.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Firewalllar icin Linux Iptables'in tarpitting patch'i var, Free/OpenBSD
</I>&gt;<i> Packet Filter tum bu ozellikleri yamasiz sagliyor.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Ferruh Mavituna wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Benim gordugum DDOS konusunda yapilan en buyuk yanlis islem
</I>&gt;&gt;<i>    saldiriyi application seviyesinde eritmeye calismak ki bu da
</I>&gt;&gt;<i>    network seviyesine gore %60-%70 daha pahaliya mal oluyor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Durumuna gore degisir tabii ki, ama hafif zeki olan herhangi bir GET
</I>&gt;&gt;<i> istegi bazli DDoS da firewall bazinda engelleme yapmak (/firewall cok zeki
</I>&gt;&gt;<i> bir sey degils/e) pek mumkun degil. Tahminim buradaki durumda o. Ama HTTP
</I>&gt;&gt;<i> istegini analiz edebilen cozumler varsa sonuc uretecektir, bu konuda oneri
</I>&gt;&gt;<i> varsa acikcasi bende merak ediyorum. Cunku s&#305;k s&#305;k karsima gelen konulardan
</I>&gt;&gt;<i> biri ve maalesef pek basit bir cozumu yok.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2008/11/5 Huzeyfe ONAL &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">huzeyfe at lifeoverip.net</A> &lt;mailto:
</I>&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">huzeyfe at lifeoverip.net</A>&gt;&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Musa selamlar,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    mumkunse kullanilan software firewall'un ismini ogrenebilir miyim?
</I>&gt;&gt;<i>    Zira bana degerler cok az geldi. Yani en basit Firewall bile bu
</I>&gt;&gt;<i>    degerler karsisinda rahatlikla ayakta durur. Es zamanli 30000~
</I>&gt;&gt;<i>    paket ya da ortalama 20000~ state durumunda bile %5 civarinda CPU
</I>&gt;&gt;<i>    harcayan software firewallar var.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Mesela OpenBSD Packet Filter ve benzeri firewallar icin yogun
</I>&gt;&gt;<i>     paketler 80. port(uygulamaya ulasmadan)a gitmeden network
</I>&gt;&gt;<i>    seviyesinde bloklanabilir. Bunun icin firewall'a  tek bir ip
</I>&gt;&gt;<i>    adresinden su porta max baglanti sayisi y dir demek yeterli.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Paketler uygulama seviyesine ciktiginda engellemek hem daha zor
</I>&gt;&gt;<i>    hem de cok daha fazla kaynak tuketiyorlar.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Benim gordugum DDOS konusunda yapilan en buyuk yanlis islem
</I>&gt;&gt;<i>    saldiriyi application seviyesinde eritmeye calismak ki bu da
</I>&gt;&gt;<i>    network seviyesine gore %60-%70 daha pahaliya mal oluyor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Musa Ulker wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Tekrar merhabalar,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Ferruh; &#199;ok ilgin&#231;tir denedi&#287;im modlar kald&#305;ramad&#305; apachede
</I>&gt;&gt;<i>        ciddi y&#252;k
</I>&gt;&gt;<i>        durmaya devam etti.  Buradaki bottleneck software firewall
</I>&gt;&gt;<i>        ataklar&#305;
</I>&gt;&gt;<i>        durdurmad&#305; yeterli olmad&#305;. Y&#252;klenen ip say&#305;s&#305; ba&#351;ta 1 5 10
</I>&gt;&gt;<i>        diye de&#287;il
</I>&gt;&gt;<i>        de ayn&#305; anda 100+ &#351;eklinde olunca ve iplerde de&#287;i&#351;ti&#287;i i&#231;in
</I>&gt;&gt;<i>        &#231;ok k&#305;sa
</I>&gt;&gt;<i>        aral&#305;klarla (1dkdan az s&#252;re i&#231;in) yeni ipleri yakalayamad&#305; ve
</I>&gt;&gt;<i>        apacheyi, apachede &#231;al&#305;&#351;an uygulama da mysql i kilitledi..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Benim &#246;rnek verdi&#287;im %30 sadece bir tane apache forku i&#231;in.
</I>&gt;&gt;<i>        Maksimum
</I>&gt;&gt;<i>        olan&#305; i&#231;indi. Firewall &#231;al&#305;&#351;madan sistem kitleniyordu, ssha bile
</I>&gt;&gt;<i>        eri&#351;ilmiyordu. Firewallla CPU kullan&#305;m&#305; %80-85 civar&#305;nda
</I>&gt;&gt;<i>        seyretmeye
</I>&gt;&gt;<i>        ba&#351;lad&#305;. Ayn&#305; anda mevcut 80 portuna connection say&#305;s&#305; 200+
</I>&gt;&gt;<i>        civar&#305;ndayd&#305;..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Sald&#305;r&#305; detay&#305;: Connect flood. S&#252;rekli GET iste&#287;i. Sald&#305;r&#305; &#231;al&#305;&#351;an
</I>&gt;&gt;<i>        uygulama &#252;zerinden mysql i devre d&#305;&#351;&#305; b&#305;rakmaya y&#246;nelik oldu&#287;unu
</I>&gt;&gt;<i>        d&#252;&#351;&#252;n&#252;yorum. Daha &#246;nceden benzer bir sald&#305;rr&#305;yla kar&#351;&#305;la&#351;m&#305;&#351;t&#305;m..
</I>&gt;&gt;<i>        Gelen paketler gayet normal g&#246;z&#252;k&#252;yor. Arada malformed
</I>&gt;&gt;<i>        requestlerde
</I>&gt;&gt;<i>        geliyordu ama ba&#351;ka bir kaynaktan olabilir.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Kubilay; Rusya IP bloklar&#305; konusunda ara&#351;t&#305;rma yaparken &#351;&#246;yle bir
</I>&gt;&gt;<i>        siteyle kar&#351;&#305;la&#351;t&#305;m, incelemenizi tavsiye ederim:
</I>&gt;&gt;<i>        <A HREF="http://www.countryipblocks.net/">http://www.countryipblocks.net/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Bedirhan; Apache KeepAlive konfigurasyonda kapal&#305;yd&#305;. Apache
</I>&gt;&gt;<i>        backdoor
</I>&gt;&gt;<i>        module gibi bir&#351;eyler buldum ama buldu&#287;um apache &#252;zerinden
</I>&gt;&gt;<i>        backdoor
</I>&gt;&gt;<i>        a&#231;an bir moduledu. Senin bahsetti&#287;in mod&#252;l&#252; payla&#351;&#305;r m&#305;s&#305;n?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        DNS g&#252;ncellemsi akl&#305;ma geldi ama zararlar&#305;n&#305; k&#305;yaslay&#305;nca &#231;&#246;z&#252;mler
</I>&gt;&gt;<i>        aras&#305;ndan &#231;&#305;kard&#305;m..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Akl&#305;n yolu bir: HW firewallarla &#231;&#246;z&#252;ld&#252; olay. Reverse proxy
</I>&gt;&gt;<i>        ile ba&#351;ka
</I>&gt;&gt;<i>        bir sunucuya y&#246;nlendirildi istekler ve o sunucu &#246;n&#252;nde Layer 7
</I>&gt;&gt;<i>        filtering yap&#305;ld&#305;. (Juniper &#252;zerinden custom filterlarla)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Herkese g&#246;sterdi&#287;i a&#231;&#305;l&#305;mlar ve verdi&#287;i cevaplardan dolay&#305;
</I>&gt;&gt;<i>        te&#351;ekk&#252;r ediyorum..
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        Selamlar,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        M.Musa &#220;lker
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>        2008/11/4 Ferruh Mavituna &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">ferruh at mavituna.com</A>
</I>&gt;&gt;<i>        &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">ferruh at mavituna.com</A>&gt;&gt;:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            Merhabalar Musa,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            Benim merak ettigim esas kilit noktasi neresi? (gavurlarin
</I>&gt;&gt;<i>            tabiri ile
</I>&gt;&gt;<i>            bottleneck). Yani application da mi is kitleniyor, ondeki
</I>&gt;&gt;<i>            firewall mu
</I>&gt;&gt;<i>            sapitmaya basliyor, load balancer mi vs. ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            Apache process' i %30 ise , uygulamada veya Apache de bir
</I>&gt;&gt;<i>            sorun  yok diye
</I>&gt;&gt;<i>            varsayiyorum. Database server ne alemde onda da ciddi bir
</I>&gt;&gt;<i>            yuklenme yok mu?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            Bir de saldirinin detaylari ne? Syn-flood, connect-flood,
</I>&gt;&gt;<i>            yogun application
</I>&gt;&gt;<i>            istekleri (HTTP vs.)?  veya baska bir port acikta onun
</I>&gt;&gt;<i>            uzerinden mi bir sey
</I>&gt;&gt;<i>            yapiliyor? gelen paketlerin tum degerleri normal mi?
</I>&gt;&gt;<i>            Mesela tuhaf window
</I>&gt;&gt;<i>            size lari var mi vs.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            Sonucta DDoS ataklari engellemek cok zor olabiliyor ama bu
</I>&gt;&gt;<i>            bilgileri
</I>&gt;&gt;<i>            verirsen daha detayli yardimci olunabilir sanirim.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            Iyi Calismalar,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            2008/11/4 Musa Ulker &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">musaulker at gmail.com</A>
</I>&gt;&gt;<i>            &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">musaulker at gmail.com</A>&gt;&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                Merhabalar,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                Dedicated bir sunucuya bir &#231;ok koldan DDos sald&#305;r&#305;s&#305;
</I>&gt;&gt;<i>                ger&#231;ekle&#351;tiriliyor. En &#231;ok y&#252;k Apache &#252;zerinde. Apache
</I>&gt;&gt;<i>                CPU load'&#305; %30u
</I>&gt;&gt;<i>                ge&#231;ebiliyor farkl&#305; apache processleri &#231;al&#305;&#351;&#305;yor. T&#252;rl&#252;
</I>&gt;&gt;<i>                &#231;al&#305;&#351;malar
</I>&gt;&gt;<i>                yapt&#305;m; firewallar (salt iptables, apf, csf vs)
</I>&gt;&gt;<i>                denedim, ddos
</I>&gt;&gt;<i>                protectionlar&#305; test ettim ama sald&#305;r&#305;y&#305; tam olarak
</I>&gt;&gt;<i>                kesemedim. Birazc&#305;k
</I>&gt;&gt;<i>                y&#252;k&#252; hafifletebildim. Zombie makinalar &#252;zerinden
</I>&gt;&gt;<i>                sald&#305;r&#305; halen devam
</I>&gt;&gt;<i>                ediyor.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                Bu konuda nas&#305;l bir yol izlemem gerekiyor?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                Te&#351;ekk&#252;rler
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                --
</I>&gt;&gt;<i>                M.Musa &#220;lker
</I>&gt;&gt;<i>                _______________________________________________
</I>&gt;&gt;<i>                Owasp-turkey mailing list
</I>&gt;&gt;<i>                <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">Owasp-turkey at lists.owasp.org</A>
</I>&gt;&gt;<i>                &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">Owasp-turkey at lists.owasp.org</A>&gt;
</I>&gt;&gt;<i>                <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">https://lists.owasp.org/mailman/listinfo/owasp-turkey</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>            --
</I>&gt;&gt;<i>            Ferruh Mavituna
</I>&gt;&gt;<i>            <A HREF="http://ferruh.mavituna.com">http://ferruh.mavituna.com</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    ---------------------------------------------------------------------
</I>&gt;&gt;<i>    To unsubscribe, e-mail: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">netsec-unsubscribe at lifeoverip.net</A>
</I>&gt;&gt;<i>    &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">netsec-unsubscribe at lifeoverip.net</A>&gt;
</I>&gt;&gt;<i>    For additional commands, e-mail: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">netsec-help at lifeoverip.net</A>
</I>&gt;&gt;<i>    &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">netsec-help at lifeoverip.net</A>&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Ferruh Mavituna
</I>&gt;&gt;<i> <A HREF="http://ferruh.mavituna.com">http://ferruh.mavituna.com</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ---------------------------------------------------------------------
</I>&gt;<i> To unsubscribe, e-mail: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">netsec-unsubscribe at lifeoverip.net</A>
</I>&gt;<i> For additional commands, e-mail: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-turkey">netsec-help at lifeoverip.net</A>
</I>&gt;<i>
</I>&gt;<i>
</I>

-- 
Ferruh Mavituna
<A HREF="http://ferruh.mavituna.com">http://ferruh.mavituna.com</A>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-turkey/attachments/20081106/d313535e/attachment.html">https://lists.owasp.org/pipermail/owasp-turkey/attachments/20081106/d313535e/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000489.html">[Owasp-turkey] [netsec] Re:  Under DDos Attack
</A></li>
	<LI>Next message: <A HREF="000492.html">[Owasp-turkey] [netsec] Re:  Under DDos Attack
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#491">[ date ]</a>
              <a href="thread.html#491">[ thread ]</a>
              <a href="subject.html#491">[ subject ]</a>
              <a href="author.html#491">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-turkey">More information about the Owasp-turkey
mailing list</a><br>
</body></html>
