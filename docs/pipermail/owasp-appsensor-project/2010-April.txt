From michael.coates at owasp.org  Mon Apr  5 13:16:06 2010
From: michael.coates at owasp.org (Michael Coates)
Date: Mon, 5 Apr 2010 10:16:06 -0700
Subject: [Owasp-appsensor-project] Fwd: AppSensor update
In-Reply-To: <m2kd67ecf7a1004021837s745dac54z5005150add09093a@mail.gmail.com>
References: <m2kd67ecf7a1004021837s745dac54z5005150add09093a@mail.gmail.com>
Message-ID: <s2z74ae57801004051016n802789l52ea50a63efd9bc5@mail.gmail.com>

Lots of awesome work taking place with AppSensor. Forwarding this on to the
list so others can keep in the loop.

-Michael


Michael Coates
OWASP Global Membership Committee
AppSensor Project Lead - http://DefendTheApp.com


>From John Melton...

All,

I'm glad to say that after a bit of fussing, I made some progress with
AppSensor.  I got unit tests written for all of the core classes.  Not quite
sure of the test coverage just yet, but I think most of the important things
are hit.  As we find bugs, we'll add more tests (kinda the way it goes).
Also, I separated out the core code over to it's own project, and set it up
to use Maven (most of the painful work was here).  Finally, I setup the
project in a maven repository.  That way, when we put out releases, it's
trivial (dead easy if using maven) to grab the code and go.  I also removed
the code from the AppSensorDemo2 project and changed it to use the newly
built jar file from the core code - so the demo is quite small now.

The actual maven repo is here -
http://repo1.maven.org/maven2/org/owasp/appsensor/AppSensor/0.1.0/  (I'm
using sonatype and it pushes to the main repo).

The googlecode url for just the core code is here:
http://code.google.com/p/appsensor/source/browse/#svn/trunk/AppSensor

and for the updated demo is here:
http://code.google.com/p/appsensor/source/browse/#svn/trunk/AppSensorDemo2

Let me know what questions/concerns you have.  I'm taking the Easter weekend
off, and have some personal stuff to catch up on after that, but I'll get
back to it soon enough.  Unless there are objections, my next planned task
will be adding detection points and documenting them on the wiki.  At some
point we'll need a code review.  As far as I'm concerned, though, we are at
a point where people can at least try plugging it in as an alpha product and
letting us know what breaks.  (by the way, my personal project is planned to
use AppSensor as well, so I hope to find bugs myself, and also try to
document things like "how to get started w/ appsensor")

AppSensor is now at 0.1.0 - woohoo!  Seems like a lot of work for such a
small number though :>.

Thanks,
John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-appsensor-project/attachments/20100405/1e9238c4/attachment.html 

From michael.coates at owasp.org  Fri Apr  9 14:43:58 2010
From: michael.coates at owasp.org (Michael Coates)
Date: Fri, 09 Apr 2010 14:43:58 -0400
Subject: [Owasp-appsensor-project] AppSensor Dev
Message-ID: <4BBF756E.2070601@owasp.org>

John & John (...great same name )

JohnM as you've seen the AppSensor stuff is really starting to pick up.  
I spoke with Jim & Dave last week about the integration with ESAPI. 
They'd like to make that happen soon.  I think the discussions in the 
ESAPI dev list are great and going to help facilitate that integration.

Last night I spoke at the NoVA OWASP chapter meeting about AppSensor 
(slides going online soon).  There was lots of great discussion during 
the meeting and also a good dev/debug/discussion session between JohnS 
and I for several hours that night. JohnS had some great ideas and will 
be working on a few enhancements this week - I think he's already 
communicated some of these ideas to the ESAPI list and maybe to you in 
other emails.  JohnS is going to branch the AppSensor project with his 
ideas and then we can review them and discuss before integrating into 
the main trunk.

Keep the ideas moving! I'm going to get some more documentation together 
on the code, revamp our wiki page so its usable and keep pushing this 
thing forward.  Things are really moving well and we've got a lot of 
great minds pitching in. As you guys continue with the awesome dev 
please copy me and the appsensor mailing list on those emails.


Thanks!

Michael

From michael.coates at owasp.org  Fri Apr  9 16:45:53 2010
From: michael.coates at owasp.org (Michael Coates)
Date: Fri, 09 Apr 2010 16:45:53 -0400
Subject: [Owasp-appsensor-project] AppSensor Documentation
In-Reply-To: <4BBF756E.2070601@owasp.org>
References: <4BBF756E.2070601@owasp.org>
Message-ID: <4BBF9201.8040805@owasp.org>

This should help explain AppSensor's architecture and flow a bit.


Description of main objects:

IntrusionStore - 1 Exists in Program
Interface for storage of all AppSensorIntrusion. Accepts a generic 
exception which is added to a new AppSensorIntrusion. The user's 
Intrusion Record is then updated with the new AppSensor Intrusion. The 
default implementation (DefalutIntrusionStore.java) stores this data in 
memory via a hashmap of <userID,IntusionRecord>

IntrusionRecord - 1 Exists per User
Each user has zero or one IntrusionRecord. An IntrusionRecord is created 
with the first AppSensorException processed for a user. The 
IntrusionRecord stores 1..n AppSensorIntrusion objects.

AppSensorIntrusion - 1 exists per AppSensorException
Holds exactly 1 exception event. 1:1 mapping of AppSensorExceptions to 
AppSensorIntrusions. AppSensorIntrusion contains all related information 
such as eventCode, user, timeStamp, location (url)

AppSensorException - 1 created per detected malicious action
Extend to generic exception. This is created (not thrown) in JSPs when 
an attack is detected from the context of a user. Main purpose is to use 
constructor to add exception to IntrusionDetector and begin processing 
of the malicious event.

AppSensorSystemException - 1 created per detected malicious action
Extend to generic exception. Same as AppSensorException except this is 
used for system based events where a user is not associated (e.g. System 
Trend Exception, high number of same transaction across site). Note: for 
processing simplicity a "system user" is created for use with these 
exceptions

ResponseAction - 1 Created
Handler to describe how to deal with response events. 
DefaultResponseAction contains code to log, logout, disable, 
disableComponent, disableComponentForUser.




Attack Detection Flow


JSP/Detection Point
- If else to determine malicious action
- Create (don't throw) AppSensorException
new org.owasp.appsensor.errors.AppSensorException("ACE3", "User Message 
ACE3", "Attacker is requesting a non-existent (404) page (" + 
requestedPage + ")");

AppSensorException.java
/AppSensor-SVN/src/main/java/org/owasp/appsensor/errors/AppSensorException.java
- Constructor makes call to add exception to ESAPI.intrsionDetector
   ESAPI.intrusionDetector().addException(this); //this being the 
AppSensorException

AppSensorIntrusionDetector.java (implements intrusionDetector)
/AppSensor-SVN/src/main/java/org/owasp/appsensor/intrusiondetection/AppSensorIntrusionDetector.java
- Takes the exception and calls 
"intrusionStore.addExceptionToIntrusionStore" which takes the exception 
and creates an AppSensorIntrusion,gets the user's IntrusionRecord, adds 
the new AppSensorIntrusion to the IntrusionRecord and returns the 
AppSensorIntrusion
- Checks if violation has occurred (e.g. has a threshold been crossed)
- If so, calls takeSecurityAction (within AppSensorIntrusionDetector.java)

takeSecurityAction
- Gets the lastViolation (e.g. last action taken against the user)
- Gets threshold for event and determines what action should be taken next
- Calls responseAction.handleResponse to dispatch the response action





From jtmelton at gmail.com  Fri Apr  9 21:36:21 2010
From: jtmelton at gmail.com (John Melton)
Date: Fri, 9 Apr 2010 21:36:21 -0400
Subject: [Owasp-appsensor-project] AppSensor Dev
In-Reply-To: <4BBF756E.2070601@owasp.org>
References: <4BBF756E.2070601@owasp.org>
Message-ID: <t2yd67ecf7a1004091836u5297a7abu472eecf1bfa07cc4@mail.gmail.com>

Sounds great about the integration w/ ESAPI - that will definitely get
AppSensor in the hands of users who can give some great feedback for
improvement.

JohnS - thanks for jumping in and offering to patch in your ideas - great
suggestions!  I'll hold off on making any more changes related to core for a
bit.  If I do anything this week, it will be towards documentation likely.
If you have any questions I can help w/, I'd be more than happy to.

Michael, One quick question.  I did add a couple of things to the wiki -
under your detection points doc - a few of them have the Java section filled
in.  For now, there's just sample code, but there should probably also be a
snippet of the ESAPI.properties intrusion detection config for that
detection point for clarity - at least an attempt at it.  Any thoughts
towards that?  We'll certainly document it, but some may take the defaults
only to find out they've disabled a component of the app b/c there were 20
of some type of exception in 3 seconds for example.  There's really no
reasonable default for these configs - it will be totally dependent on the
site.  (traffic numbers/risk level is going to vary greatly for different
apps obviously)  If it helps, ESAPI's properties file comes w/ config for 2
or 3 exceptions (of their 10 or so) and then has one for total.

JohnM

On Fri, Apr 9, 2010 at 2:43 PM, Michael Coates <michael.coates at owasp.org>wrote:

> John & John (...great same name )
>
> JohnM as you've seen the AppSensor stuff is really starting to pick up.  I
> spoke with Jim & Dave last week about the integration with ESAPI. They'd
> like to make that happen soon.  I think the discussions in the ESAPI dev
> list are great and going to help facilitate that integration.
>
> Last night I spoke at the NoVA OWASP chapter meeting about AppSensor
> (slides going online soon).  There was lots of great discussion during the
> meeting and also a good dev/debug/discussion session between JohnS and I for
> several hours that night. JohnS had some great ideas and will be working on
> a few enhancements this week - I think he's already communicated some of
> these ideas to the ESAPI list and maybe to you in other emails.  JohnS is
> going to branch the AppSensor project with his ideas and then we can review
> them and discuss before integrating into the main trunk.
>
> Keep the ideas moving! I'm going to get some more documentation together on
> the code, revamp our wiki page so its usable and keep pushing this thing
> forward.  Things are really moving well and we've got a lot of great minds
> pitching in. As you guys continue with the awesome dev please copy me and
> the appsensor mailing list on those emails.
>
>
> Thanks!
>
> Michael
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-appsensor-project/attachments/20100409/d79554f9/attachment.html 

From jtmelton at gmail.com  Fri Apr 23 22:16:03 2010
From: jtmelton at gmail.com (John Melton)
Date: Fri, 23 Apr 2010 22:16:03 -0400
Subject: [Owasp-appsensor-project] appsensor updates
Message-ID: <n2kd67ecf7a1004231916w6087bc91l366e1c67ff3fb5a9@mail.gmail.com>

All,

Just a heads up on progress.  I've recently added a couple more response
actions to the default response action handler.  You can now email and sms
(via email) an administrator as one of the possible response actions in
appsensor.  These have a couple of junit tests to cover them which I've
commented out since they'll fail if you don't enter your mail server info in
the config file.  As part of this, updates were made to appsensor.properties
to cover the mail properties, and there is now also a setting in the
appsensor.properties file where you can point to another encrypted
properties file (encrypted by running DefaultEncryptedProperties.main) that
holds mail server username / password auth info so it's not in the clear in
the properties file.  Finally, the pom.xml was updated to add mail.jar and
activation.jar (for handling email) to the path.

I've not been spending a lot of time adding things as of late.  I'm waiting
a bit for John S. (who graciously offered to help us out with some of the
ESAPI integration work) to get some of his changes in before changing much
more around.

Hopefully all of this is clear.  Let me know if not.

Thanks,
John
-------------- next part --------------
An HTML attachment was scrubbed...
URL: https://lists.owasp.org/pipermail/owasp-appsensor-project/attachments/20100423/cd513e07/attachment.html 

From colin.watson at owasp.org  Sat Apr 24 07:02:11 2010
From: colin.watson at owasp.org (Colin Watson)
Date: Sat, 24 Apr 2010 12:02:11 +0100
Subject: [Owasp-appsensor-project] appsensor updates
In-Reply-To: <n2kd67ecf7a1004231916w6087bc91l366e1c67ff3fb5a9@mail.gmail.com>
References: <n2kd67ecf7a1004231916w6087bc91l366e1c67ff3fb5a9@mail.gmail.com>
Message-ID: <l2zb46e4cdd1004240402sfc6d8c1fl96765599acdec275@mail.gmail.com>

John

This all sounds great.  Sorry I haven't had time to look at it yet,
but will do so shortly.

Regards Colin

On 24 April 2010 03:16, John Melton <jtmelton at gmail.com> wrote:
> All,
>
> Just a heads up on progress.? I've recently added a couple more response
> actions to the default response action handler.? You can now email and sms
> (via email) an administrator as one of the possible response actions in
> appsensor.? These have a couple of junit tests to cover them which I've
> commented out since they'll fail if you don't enter your mail server info in
> the config file.? As part of this, updates were made to appsensor.properties
> to cover the mail properties, and there is now also a setting in the
> appsensor.properties file where you can point to another encrypted
> properties file (encrypted by running DefaultEncryptedProperties.main) that
> holds mail server username / password auth info so it's not in the clear in
> the properties file.? Finally, the pom.xml was updated to add mail.jar and
> activation.jar (for handling email) to the path.
>
> I've not been spending a lot of time adding things as of late.? I'm waiting
> a bit for John S. (who graciously offered to help us out with some of the
> ESAPI integration work) to get some of his changes in before changing much
> more around.
>
> Hopefully all of this is clear.? Let me know if not.
>
> Thanks,
> John
>
> _______________________________________________
> Owasp-appsensor-project mailing list
> Owasp-appsensor-project at lists.owasp.org
> https://lists.owasp.org/mailman/listinfo/owasp-appsensor-project
>
>

