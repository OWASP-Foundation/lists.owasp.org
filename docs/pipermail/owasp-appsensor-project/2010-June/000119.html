<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-appsensor-project%40lists.owasp.org?Subject=%5BOwasp-appsensor-project%5D%20%5BEsapi-dev%5D%20AppSensor%20%26%20ESAPI%0A%09Integration&In-Reply-To=B9A412898630124ABE8350F4EBD32E8401394074%40mymail.aspectsecurity.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000115.html">
   <LINK REL="Next"  HREF="000120.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration</H1>
    <B>Michael Coates</B> 
    <A HREF="mailto:owasp-appsensor-project%40lists.owasp.org?Subject=%5BOwasp-appsensor-project%5D%20%5BEsapi-dev%5D%20AppSensor%20%26%20ESAPI%0A%09Integration&In-Reply-To=B9A412898630124ABE8350F4EBD32E8401394074%40mymail.aspectsecurity.com"
       TITLE="[Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration">michael.coates at owasp.org
       </A><BR>
    <I>Tue Jun 22 13:59:21 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="000115.html">[Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration
</A></li>
        <LI>Next message: <A HREF="000120.html">[Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#119">[ date ]</a>
              <a href="thread.html#119">[ thread ]</a>
              <a href="subject.html#119">[ subject ]</a>
              <a href="author.html#119">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Kevin,

Thanks for your questions.  My responses are below. By all means, keep 
the questions coming. We can use these questions to help build an FAQ to 
help others that are new to AppSensor.

Michael Coates
OWASP


On 6/22/10 5:48 AM, Jeff Williams wrote:
&gt;<i>
</I>&gt;<i> Here's my understanding, but I'd really like to get Michael's 
</I>&gt;<i> interpretation too.
</I>&gt;<i>
</I>&gt;<i> Do you see AppSensor as *replacing* this built-in WAF or as augmenting 
</I>&gt;<i> it? If the former, what are the advantages of using AppSensor rather 
</I>&gt;<i> than ESAPI's WAF feature? If it is to augment it, could you explain 
</I>&gt;<i> how it does this because it would seem to me that there is a lot of 
</I>&gt;<i> overlapping functionality. Is there some difference in _intent_? Or is 
</I>&gt;<i> ESAPI's WAF simply a JavaEE Servlet Filter that invokes a more 
</I>&gt;<i> rudimentary intrusion detector (DefaultIntrusionDetector) and 
</I>&gt;<i> AppSensor is simply a more advanced version of an intrusion detector?
</I>&gt;<i>
</I>&gt;<i> Although there is a bit of overlap in the input validation area, there 
</I>&gt;<i> **is** a difference in intent and capability. To me, the primary WAF 
</I>&gt;<i> use case is to block attacks with **known** signatures (virtual 
</I>&gt;<i> patch). Of course it can do positive HTTP validation and other things 
</I>&gt;<i> as well. The IntrusionDetector, on the other hand can detect 
</I>&gt;<i> **unknown** attacks using much more general heuristics and contextual 
</I>&gt;<i> information from the entire application, not just the request and 
</I>&gt;<i> response.
</I>&gt;<i>
</I>AppSensor can be seen as an enhanced alternative to ESAPI's intrusion 
detector. AppSensor is not a replacement for the ESAPI WAF, nor is 
AppSensor a WAF at all.  AppSensor works by deep integration into the 
application to identify custom application attacks that could not be 
detected by a WAF. A prime example is an access control violation via 
direct object tampering

www.site.com?account=1234
www.site.com?account=1235

An attacker attempting to exploit weak access control policies may 
enumerate the direct object references to hopefully gain access to 
another account's data. A good app will throw access control denied 
errors on each attempt. AppSensor is positioned within the application 
so that an AppSensor specific exception could also be created in this 
situation.  This allows AppSensor to record the malicious event against 
the specific user. Once a defined threshold is reached, AppSensor logs 
out the user (or locks them, emails someone, whatever).  This is the 
idea of AppSensor; placing detection points within the app to see attack 
activity that is specific and targeted to a unique app and then tie 
these actions back to the logged in user. These attacks are typically 
otherwise invisible to a WAF with no application specific knowledge and 
the WAF often lacks the ability to take action against the malicious 
user. All the detection points are listed here: 
<A HREF="http://www.owasp.org/index.php/AppSensor_DetectionPoints">http://www.owasp.org/index.php/AppSensor_DetectionPoints</A>
&gt;<i>
</I>&gt;<i> It seems to me that some intrusion attempts can best be detected from 
</I>&gt;<i> deep within ESAPI where the relevant context is available. A good 
</I>&gt;<i> example of this is if someone were to be attempting a known ciphertext 
</I>&gt;<i> attack on ESAPI's crypto, such as the Padded Oracle attack described 
</I>&gt;<i> by Rizzo and Duong. In such cases, is adding explicit intrusion 
</I>&gt;<i> detection points required or is it sufficient to just through some 
</I>&gt;<i> exception derived from ESAPI's EnterpriseSecurityException class?
</I>&gt;<i>
</I>&gt;<i> This is exactly the contract that the IntrusionDetector (AppSensor) is 
</I>&gt;<i> intended to fulfill. The IntrusionDetector implementation is notified 
</I>&gt;<i> of  all EnterpriseSecurityExceptions. The job of the detector is to 
</I>&gt;<i> identify attacks in that stream of events and respond to them in 
</I>&gt;<i> realtime. This type of attack could never be identified by the WAF.
</I>&gt;<i>
</I>&gt;<i>  --Jeff
</I>&gt;<i>
</I>
Yep. This is the idea.  Within the application cypto's code you would 
perform sort of check for the padded oracle attack. If you detected this 
attack then you would add one more line to create the appsensor 
exception.  At this point you could choose to also add a message to be 
displayed to the user, or just leave that blank.  After this, the 
AppSensor code would take over to again record the attack event against 
the particular user and take responsive action if necessary.

Pseudo Code
if (oracle padded attack){

new AppSensorException(&quot;ECE1&quot;, &quot;(optional user msg) Sorry user, you are bad&quot;, &quot;(system log message) Attacker is attempting an Oracle Padded Attack);

}
&gt;<i>
</I>&gt;<i> My second question is about the intrusion detection properties built 
</I>&gt;<i> into ESAPI.
</I>&gt;<i>
</I>&gt;<i> Your Getting Started wiki page mentions replacing
</I>&gt;<i>
</I>&gt;<i> ESAPI.IntrusionDetector=org.owasp.esapi.reference.DefaultIntrusionDetector
</I>&gt;<i>
</I>&gt;<i> with
</I>&gt;<i>
</I>&gt;<i> ESAPI.IntrusionDetector=org.owasp.appsensor.intrusiondetection.AppSensorIntrusionDetector
</I>&gt;<i>
</I>&gt;<i> but there are also these other properties (see below). Do these 
</I>&gt;<i> properties also
</I>&gt;<i>
</I>&gt;<i> control AppSensor or does it have it's own config file?
</I>&gt;<i>
</I>
Good catch. We need to add a little more info here.  After setting the 
intrusion detector to AppSensorIntrusionDetector then the user needs to 
customize the appsensor.properties document. This is basically an 
enhanced version of the ESAPI Intrusion Detection properties file.  So 
essentially the portion of the ESAPI.properties file that you've 
mentioned below is no longer used by ESAPI (or AppSensor).
&gt;<i>
</I>&gt;<i> E.g., from the latest ESAPI.properties:
</I>&gt;<i>
</I>&gt;<i> #===========================================================================
</I>&gt;<i>
</I>&gt;<i> # ESAPI Intrusion Detection
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i> # Each event has a base to which .count, .interval, and .action are added
</I>&gt;<i>
</I>&gt;<i> # The IntrusionException will fire if we receive &quot;count&quot; events within
</I>&gt;<i>
</I>&gt;<i> &quot;interval&quot; seconds
</I>&gt;<i>
</I>&gt;<i> # The IntrusionDetector is configurable to take the following actions: 
</I>&gt;<i> log,
</I>&gt;<i>
</I>&gt;<i> logout, and disable
</I>&gt;<i>
</I>&gt;<i> #  (multiple actions separated by commas are allowed e.g.
</I>&gt;<i>
</I>&gt;<i> event.test.actions=log,disable
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i> # Custom Events
</I>&gt;<i>
</I>&gt;<i> # Names must start with &quot;event.&quot; as the base
</I>&gt;<i>
</I>&gt;<i> # Use IntrusionDetector.addEvent( &quot;test&quot; ) in your code to trigger 
</I>&gt;<i> &quot;event.test&quot; here
</I>&gt;<i>
</I>&gt;<i> # You can also disable intrusion detection completely by changing
</I>&gt;<i>
</I>&gt;<i> # the following parameter to true
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.Disable=false
</I>&gt;<i>
</I>&gt;<i> #
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.event.test.count=2
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.event.test.interval=10
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.event.test.actions=disable,log
</I>&gt;<i>
</I>&gt;<i> # Exception Events
</I>&gt;<i>
</I>&gt;<i> # All EnterpriseSecurityExceptions are registered automatically
</I>&gt;<i>
</I>&gt;<i> # Call IntrusionDetector.getInstance().addException(e) for Exceptions 
</I>&gt;<i> that do
</I>&gt;<i>
</I>&gt;<i> not extend EnterpriseSecurityException
</I>&gt;<i>
</I>&gt;<i> # Use the fully qualified classname of the exception as the base
</I>&gt;<i>
</I>&gt;<i> # any intrusion is an attack
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.IntrusionException.count=1
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.IntrusionException.interval=1
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.IntrusionException.actions=log,disable,logout
</I>&gt;<i>
</I>&gt;<i> # for test purposes
</I>&gt;<i>
</I>&gt;<i> # CHECKME: Shouldn't there be something in the property name itself 
</I>&gt;<i> that designates
</I>&gt;<i>
</I>&gt;<i> #              that these are for testing???
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.IntegrityException.count=10
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.IntegrityException.interval=5
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.IntegrityException.actions=log,disable,logout
</I>&gt;<i>
</I>&gt;<i> # rapid validation errors indicate scans or attacks in progress
</I>&gt;<i>
</I>&gt;<i> # org.owasp.esapi.errors.ValidationException.count=10
</I>&gt;<i>
</I>&gt;<i> # org.owasp.esapi.errors.ValidationException.interval=10
</I>&gt;<i>
</I>&gt;<i> # org.owasp.esapi.errors.ValidationException.actions=log,logout
</I>&gt;<i>
</I>&gt;<i> # sessions jumping between hosts indicates session hijacking
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.AuthenticationHostException.count=2
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.AuthenticationHostException.interval=10
</I>&gt;<i>
</I>&gt;<i> IntrusionDetector.org.owasp.esapi.errors.AuthenticationHostException.actions=log,logout
</I>&gt;<i>
</I>&gt;<i> #===========================================================================
</I>&gt;<i>
</I>&gt;<i> Finally, a last question. It seems to me that some intrusion attempts 
</I>&gt;<i> can best
</I>&gt;<i>
</I>&gt;<i> be detected from deep within ESAPI where the relevant context is 
</I>&gt;<i> available. A
</I>&gt;<i>
</I>&gt;<i> good example of this is if someone were to be attempting a known 
</I>&gt;<i> ciphertext
</I>&gt;<i>
</I>&gt;<i> attack on ESAPI's crypto, such as the Padded Oracle attack described 
</I>&gt;<i> by Rizzo
</I>&gt;<i>
</I>&gt;<i> and Duong. In such cases, is adding explicit intrusion detection 
</I>&gt;<i> points required
</I>&gt;<i>
</I>&gt;<i> or is it sufficient to just through some exception derived from ESAPI's
</I>&gt;<i>
</I>&gt;<i> EnterpriseSecurityException class? In the case of crypto at least, 
</I>&gt;<i> there are
</I>&gt;<i>
</I>&gt;<i> different things that can go wrong, but you need to be very careful not to
</I>&gt;<i>
</I>&gt;<i> reveal what went long as that can leak information to an attacker 
</I>&gt;<i> leading to
</I>&gt;<i>
</I>&gt;<i> a successful attack. (Such is the case with the Padded Oracle attack.)
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> -kevin
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i>
</I>&gt;<i> Kevin W. Wall
</I>&gt;<i>
</I>&gt;<i> &quot;The most likely way for the world to be destroyed, most experts agree,
</I>&gt;<i>
</I>&gt;<i> is by accident. That's where we come in; we're computer professionals.
</I>&gt;<i>
</I>&gt;<i> We cause accidents.&quot;        -- Nathaniel Borenstein, co-creator of MIME
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i>
</I>&gt;<i> Esapi-dev mailing list
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-appsensor-project">Esapi-dev at lists.owasp.org</A>
</I>&gt;<i>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/esapi-dev">https://lists.owasp.org/mailman/listinfo/esapi-dev</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-appsensor-project/attachments/20100622/b18af123/attachment.html">https://lists.owasp.org/pipermail/owasp-appsensor-project/attachments/20100622/b18af123/attachment.html</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000115.html">[Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration
</A></li>
	<LI>Next message: <A HREF="000120.html">[Owasp-appsensor-project] [Esapi-dev] AppSensor &amp; ESAPI	Integration
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#119">[ date ]</a>
              <a href="thread.html#119">[ thread ]</a>
              <a href="subject.html#119">[ subject ]</a>
              <a href="author.html#119">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-appsensor-project">More information about the Owasp-appsensor-project
mailing list</a><br>
</body></html>
