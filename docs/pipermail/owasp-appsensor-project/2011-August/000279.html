<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-appsensor-project] Question about SE4: Substituting Another User's Valid Session ID or Cookie
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-appsensor-project%40lists.owasp.org?Subject=%5BOwasp-appsensor-project%5D%20Question%20about%20SE4%3A%20Substituting%0A%20Another%20User%27s%20Valid%20Session%20ID%20or%20Cookie&In-Reply-To=CA82D67A.31071%25ryan.barnett%40owasp.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000278.html">
   <LINK REL="Next"  HREF="000280.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-appsensor-project] Question about SE4: Substituting Another User's Valid Session ID or Cookie</H1>
    <B>Kevin W. Wall</B> 
    <A HREF="mailto:owasp-appsensor-project%40lists.owasp.org?Subject=%5BOwasp-appsensor-project%5D%20Question%20about%20SE4%3A%20Substituting%0A%20Another%20User%27s%20Valid%20Session%20ID%20or%20Cookie&In-Reply-To=CA82D67A.31071%25ryan.barnett%40owasp.org"
       TITLE="[Owasp-appsensor-project] Question about SE4: Substituting Another User's Valid Session ID or Cookie">kevin.w.wall at gmail.com
       </A><BR>
    <I>Tue Aug 30 19:36:30 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="000278.html">[Owasp-appsensor-project] Question about SE4: Substituting Another User's Valid Session ID or Cookie
</A></li>
        <LI>Next message: <A HREF="000280.html">[Owasp-appsensor-project] Implementing OWASP AppSensor Detection Points in the OWASP ModSecurity Core Rule Set
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#279">[ date ]</a>
              <a href="thread.html#279">[ thread ]</a>
              <a href="subject.html#279">[ subject ]</a>
              <a href="author.html#279">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Aug 30, 2011 at 6:03 PM, Ryan Barnett &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-appsensor-project">ryan.barnett at owasp.org</A>&gt; wrote:
&gt;<i> This email is more about implementation of Detection Points as I am in the
</I>&gt;<i> process implementing AppSensor Detection Points in the OWASP ModSecurity
</I>&gt;<i> CRS.
</I>&gt;<i> I am currently looking at the Session Exception category and have a question
</I>&gt;<i> about SE4 -
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/AppSensor_DetectionPoints#SE4:_Substituting_Another_User.27s_Valid_Session_ID_or_Cookie">https://www.owasp.org/index.php/AppSensor_DetectionPoints#SE4:_Substituting_Another_User.27s_Valid_Session_ID_or_Cookie</A>
</I>&gt;<i> SE4, SE5 and SE6 all seem to be related to Session Hijacking where an
</I>&gt;<i> attacker is able to somehow obtain an authenticated user's SessionID and
</I>&gt;<i> they then simultaneously log into the application. &#160;At this point, Detection
</I>&gt;<i> Points SE5 and SE6 would most likely trigger as the Source IP/Range and the
</I>&gt;<i> User-Agent string values would most likely change. &#160;Without correlating
</I>&gt;<i> SE5/SE6, how would you suggest SE4 be detected? &#160;How would you know that the
</I>&gt;<i> SessionID/Cookie data is not correct for that user? &#160;In ModSecurity CRS, we
</I>&gt;<i> use the SessionID as the key for persistent storage of data. &#160;The Session
</I>&gt;<i> Hijacking rules grab the User-Agent and IP block hashes and save them in the
</I>&gt;<i> Session collection. &#160;If there is ever a mismatch, they alerts for SE5 and
</I>&gt;<i> SE6 are triggered.
</I>&gt;<i> I am not sure how to trigger SE4 on its own.
</I>&gt;<i> Suggestions welcome.
</I>
I guess that 'SE4' could depend on how you interpret the term 'Session Cookie',
or perhaps just how it is implemented. If we are talking about
something other than
the normal, run-of-the-mill 'JSESSIONID' or 'ASPSESSIONID' cookies /
identifiers that
are generally used for session identity, then I could see one way that
this could happen.
Suppose instead of merely using hashed-based session identifiers or ones from a
cryptographically strong PRNG, one instead created an *encrypted*
cookie and used
them for session identities.

On could include any reasonably unchanging HTTP request header values in
the encrypted session identifier (e.g., Locale:, User-Agent, the names [or even
values] of other cookies that are present, etc.) BTW, it is also
common to include a
last update time and the user name in such cookies.

So, in the example that Ryan was discussing, lets suppose that the
session cookie
itself contained the encrypted value for the User-Agent header in it
along with other
things (e.g., probably a cryptographically secure random # of N-bits).  So Eve
is playing the role of the passive attacker and steals Alice's encrypted session
cookie and then plays it back to the site. The server gets the cookie, decrypts
it, and checks the individual values. Lo and behold it finds a
discrepancy between
Alice's User-Agent value (from the decrypted cookie) and Eve's User-Agent
value. The conclusion is that one cookie was substituted for another.

So that is one way that SE4 could happen.

And lest you think that this is a far-fetched example, it actually is pretty
common with &quot;web application management&quot; systems such as CA's SiteMinder
or RSA Security's Access Manager.

HTH,
-kevin
--
Blog: <A HREF="http://off-the-wall-security.blogspot.com/">http://off-the-wall-security.blogspot.com/</A>
&quot;The most likely way for the world to be destroyed, most experts agree,
is by accident. That's where we come in; we're computer professionals.
We *cause* accidents.&quot; &#160; &#160; &#160; &#160;-- Nathaniel Borenstein
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000278.html">[Owasp-appsensor-project] Question about SE4: Substituting Another User's Valid Session ID or Cookie
</A></li>
	<LI>Next message: <A HREF="000280.html">[Owasp-appsensor-project] Implementing OWASP AppSensor Detection Points in the OWASP ModSecurity Core Rule Set
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#279">[ date ]</a>
              <a href="thread.html#279">[ thread ]</a>
              <a href="subject.html#279">[ subject ]</a>
              <a href="author.html#279">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-appsensor-project">More information about the Owasp-appsensor-project
mailing list</a><br>
</body></html>
