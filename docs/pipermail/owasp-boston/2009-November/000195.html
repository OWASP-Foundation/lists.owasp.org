<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-boston] Checking file types on upload
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-boston%40lists.owasp.org?Subject=%5BOwasp-boston%5D%20Checking%20file%20types%20on%20upload&In-Reply-To=09DED73804A95B42ACFEFF57AEA3B24E070D891F%40MAIL3.AD.Brown.Edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000194.html">
   <LINK REL="Next"  HREF="000196.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-boston] Checking file types on upload</H1>
    <B>Javed Ikbal</B> 
    <A HREF="mailto:owasp-boston%40lists.owasp.org?Subject=%5BOwasp-boston%5D%20Checking%20file%20types%20on%20upload&In-Reply-To=09DED73804A95B42ACFEFF57AEA3B24E070D891F%40MAIL3.AD.Brown.Edu"
       TITLE="[Owasp-boston] Checking file types on upload">javed at zsquad.com
       </A><BR>
    <I>Thu Nov 12 09:57:18 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000194.html">[Owasp-boston] Checking file types on upload
</A></li>
        <LI>Next message: <A HREF="000196.html">[Owasp-boston] Checking file types on upload
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#195">[ date ]</a>
              <a href="thread.html#195">[ thread ]</a>
              <a href="subject.html#195">[ subject ]</a>
              <a href="author.html#195">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The most common (and error-prone) method is to use the $_FILES array.
The browser supplies this information to the server, and IE is notorious
for using the extension to tell the server what the filetype is.

As it uses the filename extension, it is easy to fool (or make the mistake)

With PHP 5.3 or above, you can use fileinfo

<A HREF="http://www.php.net/manual/en/function.finfo-file.php">http://www.php.net/manual/en/function.finfo-file.php</A>

For older versions, fileinfo is a loadable module.

I guess you can run grep in the upload dirs to catch misnamed php files
that have already been upload, something like:

grep -R &quot;&lt;?&quot; *.jpg *.gif *.png

Regards

Javed

Laverty, Patrick wrote:
&gt;<i> Sorry for all the questions lately, but I'm wondering if someone has
</I>&gt;<i> come up with a reliable way to check actual file types when they get
</I>&gt;<i> uploaded to a server, preferably with PHP.  We've had some issues where
</I>&gt;<i> people uploaded php files with a .jpg or .gif extension, so they slipped
</I>&gt;<i> by for a while.
</I>&gt;<i>
</I>&gt;<i> We are turning off php in upload directories, among other security
</I>&gt;<i> steps, but I just wanted to see if I could do more than just checking
</I>&gt;<i> the file extension.  Looking for that extra layer of security.
</I>&gt;<i>
</I>&gt;<i> Thanks!
</I>&gt;<i>
</I>&gt;<i> Patrick Laverty
</I>&gt;<i> Brown University
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-boston mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">Owasp-boston at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">https://lists.owasp.org/mailman/listinfo/owasp-boston</A>
</I>&gt;<i>   
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000194.html">[Owasp-boston] Checking file types on upload
</A></li>
	<LI>Next message: <A HREF="000196.html">[Owasp-boston] Checking file types on upload
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#195">[ date ]</a>
              <a href="thread.html#195">[ thread ]</a>
              <a href="subject.html#195">[ subject ]</a>
              <a href="author.html#195">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-boston">More information about the Owasp-boston
mailing list</a><br>
</body></html>
