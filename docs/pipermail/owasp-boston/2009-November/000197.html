<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-boston] Checking file types on upload
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-boston%40lists.owasp.org?Subject=%5BOwasp-boston%5D%20Checking%20file%20types%20on%20upload&In-Reply-To=1452bf810911120715l56176cb7q690a6ad691d7137a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000196.html">
   <LINK REL="Next"  HREF="000199.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-boston] Checking file types on upload</H1>
    <B>Javed Ikbal</B> 
    <A HREF="mailto:owasp-boston%40lists.owasp.org?Subject=%5BOwasp-boston%5D%20Checking%20file%20types%20on%20upload&In-Reply-To=1452bf810911120715l56176cb7q690a6ad691d7137a%40mail.gmail.com"
       TITLE="[Owasp-boston] Checking file types on upload">javed at zsquad.com
       </A><BR>
    <I>Thu Nov 12 10:25:00 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000196.html">[Owasp-boston] Checking file types on upload
</A></li>
        <LI>Next message: <A HREF="000199.html">[Owasp-boston] Checking file types on upload
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#197">[ date ]</a>
              <a href="thread.html#197">[ thread ]</a>
              <a href="subject.html#197">[ subject ]</a>
              <a href="author.html#197">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes,  &quot;&lt;?&quot; may exist in an image file.

But:
Given the upload dirs may have hundreds, if not thousands of files,
finding the suspicious files would be a chore--hence my recommendation.

grep will narrow down the list of suspects very quickly for the manual
examination, or the output of the grep could be piped to the php syntax
check as you suggested.

Javed

Stephane Corlosquet wrote:
&gt;<i>
</I>&gt;<i>     I guess you can run grep in the upload dirs to catch misnamed php
</I>&gt;<i>     files
</I>&gt;<i>     that have already been upload, something like:
</I>&gt;<i>
</I>&gt;<i>     grep -R &quot;&lt;?&quot; *.jpg *.gif *.png
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> An image file could contain &quot;&lt;?&quot; but that does not mean it's a PHP
</I>&gt;<i> file. Maybe you could run php --syntax-check on the command line to
</I>&gt;<i> check the syntax of a suspicious file.
</I>&gt;<i>
</I>&gt;<i> Steph.
</I>&gt;<i>
</I>&gt;<i> On Thu, Nov 12, 2009 at 9:57 AM, Javed Ikbal &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">javed at zsquad.com</A>
</I>&gt;<i> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">javed at zsquad.com</A>&gt;&gt; wrote:
</I>&gt;<i>
</I>&gt;<i>     The most common (and error-prone) method is to use the $_FILES array.
</I>&gt;<i>     The browser supplies this information to the server, and IE is
</I>&gt;<i>     notorious
</I>&gt;<i>     for using the extension to tell the server what the filetype is.
</I>&gt;<i>
</I>&gt;<i>     As it uses the filename extension, it is easy to fool (or make the
</I>&gt;<i>     mistake)
</I>&gt;<i>
</I>&gt;<i>     With PHP 5.3 or above, you can use fileinfo
</I>&gt;<i>
</I>&gt;<i>     <A HREF="http://www.php.net/manual/en/function.finfo-file.php">http://www.php.net/manual/en/function.finfo-file.php</A>
</I>&gt;<i>
</I>&gt;<i>     For older versions, fileinfo is a loadable module.
</I>&gt;<i>
</I>&gt;<i>     I guess you can run grep in the upload dirs to catch misnamed php
</I>&gt;<i>     files
</I>&gt;<i>     that have already been upload, something like:
</I>&gt;<i>
</I>&gt;<i>     grep -R &quot;&lt;?&quot; *.jpg *.gif *.png
</I>&gt;<i>
</I>&gt;<i>     Regards
</I>&gt;<i>
</I>&gt;<i>     Javed
</I>&gt;<i>
</I>&gt;<i>     Laverty, Patrick wrote:
</I>&gt;<i>     &gt; Sorry for all the questions lately, but I'm wondering if someone has
</I>&gt;<i>     &gt; come up with a reliable way to check actual file types when they get
</I>&gt;<i>     &gt; uploaded to a server, preferably with PHP.  We've had some
</I>&gt;<i>     issues where
</I>&gt;<i>     &gt; people uploaded php files with a .jpg or .gif extension, so they
</I>&gt;<i>     slipped
</I>&gt;<i>     &gt; by for a while.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; We are turning off php in upload directories, among other security
</I>&gt;<i>     &gt; steps, but I just wanted to see if I could do more than just
</I>&gt;<i>     checking
</I>&gt;<i>     &gt; the file extension.  Looking for that extra layer of security.
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Thanks!
</I>&gt;<i>     &gt;
</I>&gt;<i>     &gt; Patrick Laverty
</I>&gt;<i>     &gt; Brown University
</I>&gt;<i>     &gt; _______________________________________________
</I>&gt;<i>     &gt; Owasp-boston mailing list
</I>&gt;<i>     &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">Owasp-boston at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">Owasp-boston at lists.owasp.org</A>&gt;
</I>&gt;<i>     &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">https://lists.owasp.org/mailman/listinfo/owasp-boston</A>
</I>&gt;<i>     &gt;
</I>&gt;<i>
</I>&gt;<i>     _______________________________________________
</I>&gt;<i>     Owasp-boston mailing list
</I>&gt;<i>     <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">Owasp-boston at lists.owasp.org</A> &lt;mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">Owasp-boston at lists.owasp.org</A>&gt;
</I>&gt;<i>     <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">https://lists.owasp.org/mailman/listinfo/owasp-boston</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-boston mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">Owasp-boston at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">https://lists.owasp.org/mailman/listinfo/owasp-boston</A>
</I>&gt;<i>   
</I>
-- 

Best regards

Javed
-------------------------------------------------------------------
Javed Ikbal, CISSP, CISM, CISA
Principal
www.zsquad.com | E: <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-boston">javed at zsquad.com</A>
P: 617 780 9052 | F: 781 723 0590
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-boston/attachments/20091112/2d39f53a/attachment-0001.html">https://lists.owasp.org/pipermail/owasp-boston/attachments/20091112/2d39f53a/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000196.html">[Owasp-boston] Checking file types on upload
</A></li>
	<LI>Next message: <A HREF="000199.html">[Owasp-boston] Checking file types on upload
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#197">[ date ]</a>
              <a href="thread.html#197">[ thread ]</a>
              <a href="subject.html#197">[ subject ]</a>
              <a href="author.html#197">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-boston">More information about the Owasp-boston
mailing list</a><br>
</body></html>
