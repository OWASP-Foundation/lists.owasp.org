<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-delhi] Attack Scenerio
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-delhi%40lists.owasp.org?Subject=%5BOwasp-delhi%5D%20Attack%20Scenerio&In-Reply-To=498c4610.04686e0a.591b.ffffe598%40mx.google.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000317.html">
   <LINK REL="Next"  HREF="000318.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-delhi] Attack Scenerio</H1>
    <B>Parmendra Sharma</B> 
    <A HREF="mailto:owasp-delhi%40lists.owasp.org?Subject=%5BOwasp-delhi%5D%20Attack%20Scenerio&In-Reply-To=498c4610.04686e0a.591b.ffffe598%40mx.google.com"
       TITLE="[Owasp-delhi] Attack Scenerio">s.parmendra at gmail.com
       </A><BR>
    <I>Fri Feb  6 09:43:29 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000317.html">[Owasp-delhi] Attack Scenerio
</A></li>
        <LI>Next message: <A HREF="000318.html">[Owasp-delhi] Generate encrypted page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#316">[ date ]</a>
              <a href="thread.html#316">[ thread ]</a>
              <a href="subject.html#316">[ subject ]</a>
              <a href="author.html#316">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks a Lot for resolving the issue. :-)

On 2/6/09, Soi, Dhruv &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">dhruv.soi at owasp.org</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>  I think for most of the IPS it should be packet/traffic direction and not
</I>&gt;<i> connection direction.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Many Thanks,
</I>&gt;<i>
</I>&gt;<i> Dhruv
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  ------------------------------
</I>&gt;<i>
</I>&gt;<i> *From:* Parmendra Sharma [mailto:<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">s.parmendra at gmail.com</A>]
</I>&gt;<i> *Sent:* Friday, February 06, 2009 7:39 PM
</I>&gt;<i> *To:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">dhruv.soi at owasp.org</A>
</I>&gt;<i> *Subject:* Re: [Owasp-delhi] Attack Scenerio
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> O.K Sir,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This means that No fresh OUTGOING connection is being made by the server
</I>&gt;<i> but the traffic that is blocked is the response from the server for an
</I>&gt;<i> already maintained connection.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Is there any mechanism or interface within the IPS which distinguishes
</I>&gt;<i> between the two IN to OUT requests mentioned below:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> A malicious program on the server sends the REQUEST (the first request)
</I>&gt;<i> from IN to OUT and
</I>&gt;<i>
</I>&gt;<i> A response from the server for the request &quot;
</I>&gt;<i> <A HREF="http://www.fileopen.com/open.php?file=someexcel.xls">http://www.fileopen.com/open.php?file=someexcel.xls</A> &quot;. Naturally this will
</I>&gt;<i> also be the traffic from IN to OUT
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I mean to say that is there any intelligence within the IPS which let it
</I>&gt;<i> know that the packets that are send from IN to OUT are:
</I>&gt;<i>
</I>&gt;<i> -&gt; a request for a new connection
</I>&gt;<i>
</I>&gt;<i> -&gt; a response for the request for an already maintained connection.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Waiting for your reply......
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 2/6/09, *Soi, Dhruv* &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">dhruv.soi at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> Client makes a request &#224;
</I>&gt;<i> <A HREF="http://www.fileopen.com/open.php?file=someexcel.xls">http://www.fileopen.com/open.php?file=someexcel.xls</A> towards the server.
</I>&gt;<i> This is incoming request and contains file name in HTTP GET, but filename
</I>&gt;<i> won't bring up an alert.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Server responds to above request by passing on the XLS file in HTTP Data
</I>&gt;<i> which would be outgoing traffic from server to client. XLS contents will be
</I>&gt;<i> parsed by IPS, signature match will happen and alert will be triggered.
</I>&gt;<i> Connection is for sure INCOMING but the malicious traffic would be outgoing.
</I>&gt;<i> IPS signature would be checking the traffic from IN to OUT in this case, I
</I>&gt;<i> believe.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Simple way to check this would be to block incoming requests to the server
</I>&gt;<i> from external clients and see if outbound connections are still being made
</I>&gt;<i> from the server. That would clearly tell you if the triggers are due to
</I>&gt;<i> incoming connections made from clients or server is running some malicious
</I>&gt;<i> program and making outbound connections.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  ------------------------------
</I>&gt;<i>
</I>&gt;<i> *From:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">owasp-delhi-bounces at lists.owasp.org</A> [mailto:
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">owasp-delhi-bounces at lists.owasp.org</A>] *On Behalf Of *Parmendra Sharma
</I>&gt;<i> *Sent:* Friday, February 06, 2009 5:27 PM
</I>&gt;<i> *To:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">dhruv.soi at owasp.org</A>
</I>&gt;<i> *Cc:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">owasp-delhi at lists.owasp.org</A>
</I>&gt;<i> *Subject:* Re: [Owasp-delhi] Attack Scenerio
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Sir,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your answer..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I am worry about the OUTGOING connection that is blocked by the firewall
</I>&gt;<i> and If i am right then an OUTGOING connection is that for which the first
</I>&gt;<i> request (A SYN packet to complete the TCP three way handshaking) is sent
</I>&gt;<i> from from internal network to the external machine.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now if an Excel file is there on the Server then to accessing that file by
</I>&gt;<i> the attacker or someone else (a user) would create an INCOMING CONNECTION
</I>&gt;<i> with the server to exploit the vulnerability within the excel file and for
</I>&gt;<i> this NO OUTGOING CONNNECTION IS REQUIRED.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please clarify......:-)
</I>&gt;<i>
</I>&gt;<i> On Thu, Feb 5, 2009 at 5:09 PM, Soi, Dhruv &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">dhruv.soi at owasp.org</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> I am not really sure about the practical scenario due to no access to
</I>&gt;<i> server/IPS logs but just making a blind guess to your problem:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -&gt; What can be the possible thing that is making the oubound connection to
</I>&gt;<i> the malicious server.
</I>&gt;<i>
</I>&gt;<i>    - Basic and stupid answer could be &quot;false positive&quot; J
</I>&gt;<i>    - Possibility could be that there is some Excel file located in web
</I>&gt;<i>    server path and whenever, a request is made from the client, web server
</I>&gt;<i>    returns the excel file and IPS triggers an alert. This would be outbound
</I>&gt;<i>    traffic for the IPS.
</I>&gt;<i>    - If you can check the web server logs for the timestamp when IPS alert
</I>&gt;<i>    was generated and you don't see any log entry where Excel file was served to
</I>&gt;<i>    some external client then above point is ruled out. Look for other programs
</I>&gt;<i>    making connection to external web servers and you may use SysInternal tools
</I>&gt;<i>    to dig further
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -&gt; If IPS is capable of detecting the abovementioned signatures for the
</I>&gt;<i> outgoing requests, then why it doesnot blok the same request for the
</I>&gt;<i> incoming request so that the attack can be blocked at the Perimeter.
</I>&gt;<i>
</I>&gt;<i> I think this is not some network/web attack coming that can be launched
</I>&gt;<i> towards the web server as such till the time your web application doesn't
</I>&gt;<i> allow users to upload excel files into the application. The attack is
</I>&gt;<i> crafted on the top of the function HrShellOpenWithMonikerDisplayName in
</I>&gt;<i> hlink.dll that overflows the stack due to long URIs [Refer: CVE-2006-3086].
</I>&gt;<i> Such malicious excel files could infect the server/client when a user opens
</I>&gt;<i> the excel file and clicks on long URIs. Now, source for such excel files
</I>&gt;<i> could be FTP, Website, Mail, SMB Share, other media, etc. Obviously, excel
</I>&gt;<i> files could be embedded in Word/PPT files to fool around the users and make
</I>&gt;<i> the investigation more time consuming.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hope helpful!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Many Thanks,
</I>&gt;<i>
</I>&gt;<i> Dhruv
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  ------------------------------
</I>&gt;<i>
</I>&gt;<i> *From:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">owasp-delhi-bounces at lists.owasp.org</A> [mailto:
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">owasp-delhi-bounces at lists.owasp.org</A>] *On Behalf Of *Parmendra Sharma
</I>&gt;<i> *Sent:* Thursday, February 05, 2009 2:23 PM
</I>&gt;<i> *To:* <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-delhi">owasp-delhi at lists.owasp.org</A>
</I>&gt;<i> *Subject:* [Owasp-delhi] Attack Scenerio
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hello OWASP Members,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Please clarify the Attack that is done by the Attacker on the WebServer in
</I>&gt;<i> the belowmentioned scenerio:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Network description:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Network threat protection (IPS) installed as a part of Symantec endpoint
</I>&gt;<i> protection on Microsoft ISA firewall.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now there are certain requests that are blocked by the firewall which are
</I>&gt;<i> making the OUTGOING connections (which are malicious) and IPS detected those
</I>&gt;<i> attack signatures as &quot;[SID=21672] HTTP MS Excel Unicode HLINK BO Detected&quot;.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Now my question are:
</I>&gt;<i>
</I>&gt;<i> -&gt; What can be the possible thing that is making the oubound connection to
</I>&gt;<i> the malicious server.
</I>&gt;<i>
</I>&gt;<i> -&gt; If IPS is capable of detecting the abovementioned signatures for the
</I>&gt;<i> outgoing requests, then why it doesnot blok the same request for the
</I>&gt;<i> incoming request so that the attack can be blocked at the Perimeter.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Thanks and Regards:
</I>&gt;<i>
</I>&gt;<i> Parmendra Sharma
</I>&gt;<i> Indian Computer Emergency Response Team (CERT-In)
</I>&gt;<i> Ministry of Information Technology
</I>&gt;<i> Government of India
</I>&gt;<i> 6 C.G.O Complex
</I>&gt;<i> Lodhi Road
</I>&gt;<i> New Delhi
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Thanks and Regards:
</I>&gt;<i>
</I>&gt;<i> Parmendra Sharma
</I>&gt;<i> Indian Computer Emergency Response Team (CERT-In)
</I>&gt;<i> Ministry of Information Technology
</I>&gt;<i> Government of India
</I>&gt;<i> 6 C.G.O Complex
</I>&gt;<i> Lodhi Road
</I>&gt;<i> New Delhi
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> --
</I>&gt;<i> Thanks and Regards:
</I>&gt;<i>
</I>&gt;<i> Parmendra Sharma
</I>&gt;<i> Indian Computer Emergency Response Team (CERT-In)
</I>&gt;<i> Ministry of Information Technology
</I>&gt;<i> Government of India
</I>&gt;<i> 6 C.G.O Complex
</I>&gt;<i> Lodhi Road
</I>&gt;<i> New Delhi
</I>&gt;<i>
</I>


-- 
Thanks and Regards:

Parmendra Sharma
Indian Computer Emergency Response Team (CERT-In)
Ministry of Information Technology
Government of India
6 C.G.O Complex
Lodhi Road
New Delhi
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="https://lists.owasp.org/pipermail/owasp-delhi/attachments/20090206/2794db18/attachment-0001.html">https://lists.owasp.org/pipermail/owasp-delhi/attachments/20090206/2794db18/attachment-0001.html</A> 
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000317.html">[Owasp-delhi] Attack Scenerio
</A></li>
	<LI>Next message: <A HREF="000318.html">[Owasp-delhi] Generate encrypted page
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#316">[ date ]</a>
              <a href="thread.html#316">[ thread ]</a>
              <a href="subject.html#316">[ subject ]</a>
              <a href="author.html#316">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-delhi">More information about the Owasp-delhi
mailing list</a><br>
</body></html>
