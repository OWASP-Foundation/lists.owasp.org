<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-webgoat] SQL Injection Lab
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-webgoat%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-webgoat%5D%20SQL%20Injection%20Lab&In-Reply-To=%3CCAGDRRCd0fm7HGGS_WtQsKAPaWQaEKx2c0E4CtjRnW53ZVgOXkA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-webgoat] SQL Injection Lab</H1>
    <B>John Scott</B> 
    <A HREF="mailto:owasp-webgoat%40lists.owasp.org?Subject=Re%3A%20%5BOwasp-webgoat%5D%20SQL%20Injection%20Lab&In-Reply-To=%3CCAGDRRCd0fm7HGGS_WtQsKAPaWQaEKx2c0E4CtjRnW53ZVgOXkA%40mail.gmail.com%3E"
       TITLE="[Owasp-webgoat] SQL Injection Lab">praiserock at gmail.com
       </A><BR>
    <I>Mon Oct  7 18:46:51 UTC 2013</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#755">[ date ]</a>
              <a href="thread.html#755">[ thread ]</a>
              <a href="subject.html#755">[ subject ]</a>
              <a href="author.html#755">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

Up front, I'm not a programmer.  That said, I've run into a problem and
could use some help.

I'm a student and the class uses Web Goat 5.3 RC1 for labs.  I downloaded
web goat zip file and have it running on Windows.  I'm using Kali to
execute the labs.

On Stage 2: Parameterized Query #1 I've run into a problem.  I need to edit
a file (login.java) to prevent sql injection attacks against the password
field from Stage 1.  The login.java file I've found is at
WebGoat-5.3_RC1\tomcat\webapps\webgoat\WEB-INF\classes\java\org\owasp\webgoat\lessons\SQLInjection
(extracted out on Windows filesystem).

I changed the lines as mentioned below.

Found line:
String query = &quot;SELECT * FROM employee WHERE userid = &quot; + userId + &quot; and
password = '&quot; + password + &quot;'&quot;;

and changed to:
String query = &quot;SELECT * FROM employee WHERE userid = ? and password = ?&quot;;

changed these lines:
Statement answer_statement = WebSession.getConnection(s)
.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_READ_ONLY);
ResultSet answer_results = answer_statement.executeQuery(query);

to this:
PreparedStatement answer_statement = WebSession.getConnection(s)
.prepareStatement( query,    ResultSet.TYPE_SCROLL_INSENSITIVE,
ResultSet.CONCUR_READ_ONLY);
answer_statement.setString(1, userId);
answer_statement.setString(2, password);
ResultSet answer_results = answer_statement.executeQuery();


Bounced the webgoat server and tried Stage 2. If what I read is correct and
my code mod is correct, this should prevent the sql injection, but it
doesn't.

Can you provide some direction as to what I'm getting wrong here?

Thanks.
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#755">[ date ]</a>
              <a href="thread.html#755">[ thread ]</a>
              <a href="subject.html#755">[ subject ]</a>
              <a href="author.html#755">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">More information about the Owasp-webgoat
mailing list</a><br>
</body></html>
