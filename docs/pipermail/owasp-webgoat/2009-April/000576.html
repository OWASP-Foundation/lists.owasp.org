<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-webgoat%40lists.owasp.org?Subject=%5BOwasp-webgoat%5D%20stealthy%20client-side%0A%09DOM-based%09cross-site%09scripting&In-Reply-To=f66cf98a2898.49e65369%40naist.jp">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000575.html">
   <LINK REL="Next"  HREF="000577.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting</H1>
    <B>Benjamin Ernst</B> 
    <A HREF="mailto:owasp-webgoat%40lists.owasp.org?Subject=%5BOwasp-webgoat%5D%20stealthy%20client-side%0A%09DOM-based%09cross-site%09scripting&In-Reply-To=f66cf98a2898.49e65369%40naist.jp"
       TITLE="[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting">benjamin.ernst at unifr.ch
       </A><BR>
    <I>Wed Apr 15 09:23:03 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000575.html">[Owasp-webgoat] stealthy client-side	DOM-basedcross-site	scripting
</A></li>
        <LI>Next message: <A HREF="000577.html">[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#576">[ date ]</a>
              <a href="thread.html#576">[ thread ]</a>
              <a href="subject.html#576">[ subject ]</a>
              <a href="author.html#576">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey gregory,

You are totally right with the assumption that DOM-based XSS are never 
reaching the server. Basically what this type of XSS exploits is the 
fact that
the AJAX code supplied by the application is vulnerable. Amit Klein has 
written a great paper on DOM XSS (link below)
Take for instance this code (also in Amit's paper) where the name 
parameter is supplied in the URL. Using the DOM the value is retrieved 
and passed
without filtration to the html part of the document. Now you can change 
the name to &lt;script&gt;alert('foo')&lt;/script&gt; and there you go with your DOM 
based XSS.

&lt;HTML&gt;
&lt;TITLE&gt;Welcome!&lt;/TITLE&gt;
Hi
&lt;SCRIPT&gt;
var pos=document.URL.indexOf(&#8220;name=&#8221;)+5;
document.write(document.URL.substring(pos,document.URL.length));
&lt;/SCRIPT&gt;
&lt;BR&gt;
Welcome to our system
&#8230;
&lt;/HTML&gt;

Since all the manipulation was done within the client, the server is 
never notified.
DOM XSS are &quot;stealthy&quot; because the server doesn't pick up any trace of 
the attack (there is nothing to log if there is no client request)

Client makes a page request to the server -&gt; Server sends response page 
(including the vulnerable Ajax part. For instance parsing some URL value 
without sanitizing the input) -&gt; DOM makes the client side magic (here 
getting the URL name parameter) -&gt; the page is displayed with the 
exploit code triggering the XSS attack.

I suck at explaining but I hope you get the point :)

As for your problem with the way WebGoat explains DOM based XSS.
It's true that the explanation is kind of weird but you'll find that the 
function used in order to display the name is actually executed only by 
client.
Which makes it a DOM based XSS...

function displayGreeting(name) {

	if (name != ''){

		document.getElementById(&quot;greeting&quot;).innerHTML=&quot;Hello, &quot; + escapeHTML(name)+ &quot;!&quot;;

	}

}


If you want a nice explanation on DOM based XSS
Here is Amit Klein's paper: 
<A HREF="http://www.webappsec.org/projects/articles/071105.shtml">http://www.webappsec.org/projects/articles/071105.shtml</A>
And I can also highly recommend the book &quot;Cross Site Scripting Attacks 
and Defense&quot; or something like that (Syngress)

Hope I could help

Benjamin


<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">gregory at is.naist.jp</A> wrote:
&gt;<i> Hi Stephan,
</I>&gt;<i>
</I>&gt;<i> I actually I read the paper of Ryan Barnett published at BH-DC09 on your work. It was
</I>&gt;<i> very inspiring for me as I am researching on the subject. Actually, I understand the fact
</I>&gt;<i> that it is difficult to provide a realistic environment and that is why I try as much as possible
</I>&gt;<i> creating attack websites with links that a victim would click in order to carry out  attacks on
</I>&gt;<i> WebGoat. 
</I>&gt;<i>
</I>&gt;<i> However, my point here is that the incriminated lesson (AJAX security/Lab: DOM-based Cross-site
</I>&gt;<i> scripting) might be difficult to understand. The whole idea of DOM-based XSS is summarized
</I>&gt;<i> as an user inputting malicious payload to own herself. That is why one can get confused.
</I>&gt;<i> And it confuses me because it suggests that DOM-based is ultimately stealthy as it never
</I>&gt;<i> reaches the server. Is it true? I have never encountered such flavor though you can
</I>&gt;<i> find some circumvention techniques that would truncate some of the payload (usually the most
</I>&gt;<i> characteristic part) using characters such as #. 
</I>&gt;<i> (see <A HREF="http://www.thespanner.co.uk/2008/12/01/location-based-xss-attacks/">http://www.thespanner.co.uk/2008/12/01/location-based-xss-attacks/</A> )
</I>&gt;<i>
</I>&gt;<i> IMHO, if there were outside such stealthy DOM-based XSS attacks, there will be no way to mitigate
</I>&gt;<i> these on the server side or using a WAF. Maybe someone can enlighten me with some knowledge
</I>&gt;<i> I definitely do not have at the moment and that may have gone undetected to my research so far.
</I>&gt;<i>
</I>&gt;<i> Sorry also for the length of my emails, it made these really difficult to understand. Next time I will
</I>&gt;<i> make it shorter.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Gregory
</I>&gt;<i>
</I>&gt;<i> ----- Original Message -----
</I>&gt;<i> From: Stephen Craig Evans &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">stephencraig.evans at gmail.com</A>&gt;
</I>&gt;<i> Date: Wednesday, April 15, 2009 6:56 pm
</I>&gt;<i> Subject: Re: [Owasp-webgoat] stealthy client-side DOM-based cross-site	scripting
</I>&gt;<i>
</I>&gt;<i>   
</I>&gt;&gt;<i> Hi Gregory,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> You might check the WebGoat section of my project,  Securing WebGoat
</I>&gt;&gt;<i> using ModSecurity, at:
</I>&gt;&gt;<i> <A HREF="http://www.owasp.org/index.php/OWASP_Securing_WebGoat_using_ModSecurity_Project.">http://www.owasp.org/index.php/OWASP_Securing_WebGoat_using_ModSecurity_Project.</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I give some detailed explanations that might supplement what you've 
</I>&gt;&gt;<i> seen so far.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> (The project page is at:
</I>&gt;&gt;<i> <A HREF="https://www.owasp.org/index.php/Category:OWASP_Securing_WebGoat_using_ModSecurity_Project">https://www.owasp.org/index.php/Category:OWASP_Securing_WebGoat_using_ModSecurity_Project</A>)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Don't worry, I am not getting paid for page hits :-)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Off the top of my head, some of the WebGoat lessons simulate the
</I>&gt;&gt;<i> demonstration of an attack, mainly because it's necessary, and some
</I>&gt;&gt;<i> IMHO take shortcuts - which I documented. In particular, there's a
</I>&gt;&gt;<i> lesson with the solution of typing in javascript in the browser's
</I>&gt;&gt;<i> address field, which simulates a user that clicks on a malicious link
</I>&gt;&gt;<i> in the web page.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's impossible for WebGoat to accommodate every browser and browser
</I>&gt;&gt;<i> version, so there are going to be some quirks and you have to
</I>&gt;&gt;<i> experiment. One good habit is to erase the WebGoat cookies when
</I>&gt;&gt;<i> re-trying a lesson, and it's always good practice to switch back and
</I>&gt;&gt;<i> forth between at least 2 browsers; e.g. the AJAX lessons worked best
</I>&gt;&gt;<i> for me on Windows XP using Opera rather than IE and Firefox.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Stephen
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Wed, Apr 15, 2009 at 4:16 PM,  &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">gregory at is.naist.jp</A>&gt; wrote:
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> Hello,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am currently using the version 5.2 of OWASP WebGoat.
</I>&gt;&gt;&gt;<i> I am particularly interested in AJAX security and one major XSS 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> threat&gt; is the DOM-based one. However, I wanted to discuss the way 
</I>&gt;&gt;<i> the scenario
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> is presented in the lesson AJAX Security/LAB: DOM-based cross-
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> site scripting&quot;
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> First, because I do not understand the point of this lesson in 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> the way
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> it is explained. It remains unclear how such an attack could 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> occur given the
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> initial parsing of the webserver (removes every &lt;,&gt;,&quot; characters 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> and some others).
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> Usually, DOM-based XSS is particularly prone to be triggered by a 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> fished victim.
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> In this lesson, however, it seems that one should input already 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> the JavaScript code
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> within the browser.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Second, because of that unclear scenario, a beginner may not be 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> able to grab the idea
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> of DOM-based XSS.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Maybe, I am wrong somewhere but I was unable to provide the 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> JavaScript payload without
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> specific characters (such as &lt;,&gt;) and was not able to inject it 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> on the browser, preventing
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> the server side from seeing it, on top of that without the victim 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> doing a thing.
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> I tried submitting a link which would get parsed by the server 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> removing specific characters.
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> I tried embedding it in an iframe and consequently inject it 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> using JavaScript which does
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> not work since my crafted webpage was not allowed to grab the 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> iframe contents.
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> I may miss some skills. Can anyone show me a way to conduct such 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> an attack on the WebGoat
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> server in order to illustrate the DOM-based XSS attack since even 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> the yehg.net solution video
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> is merely copy/pasting the payload in the input field (sounds a 
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i> high level of social engineering
</I>&gt;&gt;<i>     
</I>&gt;&gt;&gt;<i> for subverting the user into inputting such an obvious payload...).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Regards,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Gregory BLANC.
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Owasp-webgoat mailing list
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">Owasp-webgoat at lists.owasp.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">https://lists.owasp.org/mailman/listinfo/owasp-webgoat</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>       
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -- 
</I>&gt;&gt;<i> <A HREF="http://www.linkedin.com/in/stephencraigevans">http://www.linkedin.com/in/stephencraigevans</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Owasp-webgoat mailing list
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">Owasp-webgoat at lists.owasp.org</A>
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">https://lists.owasp.org/mailman/listinfo/owasp-webgoat</A>
</I>&gt;<i>
</I>&gt;<i>   
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000575.html">[Owasp-webgoat] stealthy client-side	DOM-basedcross-site	scripting
</A></li>
	<LI>Next message: <A HREF="000577.html">[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#576">[ date ]</a>
              <a href="thread.html#576">[ thread ]</a>
              <a href="subject.html#576">[ subject ]</a>
              <a href="author.html#576">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">More information about the Owasp-webgoat
mailing list</a><br>
</body></html>
