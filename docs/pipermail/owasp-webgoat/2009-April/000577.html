<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:owasp-webgoat%40lists.owasp.org?Subject=%5BOwasp-webgoat%5D%20stealthy%20client-side%0A%09DOM-based%09cross-site%09scripting&In-Reply-To=49E5DFB7.6080001%40unifr.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000576.html">
   <LINK REL="Next"  HREF="000578.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting</H1>
    <B>gregory at is.naist.jp</B> 
    <A HREF="mailto:owasp-webgoat%40lists.owasp.org?Subject=%5BOwasp-webgoat%5D%20stealthy%20client-side%0A%09DOM-based%09cross-site%09scripting&In-Reply-To=49E5DFB7.6080001%40unifr.ch"
       TITLE="[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting">gregory at is.naist.jp
       </A><BR>
    <I>Wed Apr 15 10:14:17 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000576.html">[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting
</A></li>
        <LI>Next message: <A HREF="000578.html">[Owasp-webgoat] stealthy	client-sideDOM-based	cross-site	scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#577">[ date ]</a>
              <a href="thread.html#577">[ thread ]</a>
              <a href="subject.html#577">[ subject ]</a>
              <a href="author.html#577">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everyone,

thank you for your replies. Actually Benjamin you made it clear to me. Of course I also
came across Amit Klein's paper and noticed that the WebGoat's DOM-based XSS
vulnerability was similar to the sample you provided from Klein's paper.

Actually, it is the fact that I failed to reproduce such an attack that made me to doubt
from the stealthiness of such attacks.

Also, the lesson is well designed and there is no problem with it since it has all
the essential features that make a DOM-based XSS vulnerability.

Moreover, as Bruce highlighted, the mitigation has to be done on the server side,
though it is still vulnerable to JavaScript clobbering. The lesson actually shows it
very well in the second part in which I think the novice user would get the idea.

As for the first part, it is just that the user is made to always input malicious data
to own herself which is confusing. On a few other lessons, it is specified that such
kind of attacks do occur due to a user clicking on a maliciously crafted link or provided
with malicious scripts while visiting a malicious website. Here is not the case.
This is not undesirable feature but a lack of explanation IMHO. 

Anyway, all your replies helped me greatly.

Thank you very much.

Gregory

----- Original Message -----
From: Benjamin Ernst &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">benjamin.ernst at unifr.ch</A>&gt;
Date: Wednesday, April 15, 2009 10:23 pm
Subject: Re: [Owasp-webgoat] stealthy client-side DOM-based	cross-site	scripting

&gt;<i> Hey gregory,
</I>&gt;<i> 
</I>&gt;<i> You are totally right with the assumption that DOM-based XSS are 
</I>&gt;<i> never 
</I>&gt;<i> reaching the server. Basically what this type of XSS exploits is 
</I>&gt;<i> the 
</I>&gt;<i> fact that
</I>&gt;<i> the AJAX code supplied by the application is vulnerable. Amit Klein 
</I>&gt;<i> has 
</I>&gt;<i> written a great paper on DOM XSS (link below)
</I>&gt;<i> Take for instance this code (also in Amit's paper) where the name 
</I>&gt;<i> parameter is supplied in the URL. Using the DOM the value is 
</I>&gt;<i> retrieved 
</I>&gt;<i> and passed
</I>&gt;<i> without filtration to the html part of the document. Now you can 
</I>&gt;<i> change 
</I>&gt;<i> the name to &lt;script&gt;alert('foo')&lt;/script&gt; and there you go with 
</I>&gt;<i> your DOM 
</I>&gt;<i> based XSS.
</I>&gt;<i> 
</I>&gt;<i> &lt;HTML&gt;
</I>&gt;<i> &lt;TITLE&gt;Welcome!&lt;/TITLE&gt;
</I>&gt;<i> Hi
</I>&gt;<i> &lt;SCRIPT&gt;
</I>&gt;<i> var pos=document.URL.indexOf(&#8220;name=&#8221;)+5;
</I>&gt;<i> document.write(document.URL.substring(pos,document.URL.length));
</I>&gt;<i> &lt;/SCRIPT&gt;
</I>&gt;<i> &lt;BR&gt;
</I>&gt;<i> Welcome to our system
</I>&gt;<i> &#8230;
</I>&gt;<i> &lt;/HTML&gt;
</I>&gt;<i> 
</I>&gt;<i> Since all the manipulation was done within the client, the server 
</I>&gt;<i> is 
</I>&gt;<i> never notified.
</I>&gt;<i> DOM XSS are &quot;stealthy&quot; because the server doesn't pick up any trace 
</I>&gt;<i> of 
</I>&gt;<i> the attack (there is nothing to log if there is no client request)
</I>&gt;<i> 
</I>&gt;<i> Client makes a page request to the server -&gt; Server sends response 
</I>&gt;<i> page 
</I>&gt;<i> (including the vulnerable Ajax part. For instance parsing some URL 
</I>&gt;<i> value 
</I>&gt;<i> without sanitizing the input) -&gt; DOM makes the client side magic 
</I>&gt;<i> (here 
</I>&gt;<i> getting the URL name parameter) -&gt; the page is displayed with the 
</I>&gt;<i> exploit code triggering the XSS attack.
</I>&gt;<i> 
</I>&gt;<i> I suck at explaining but I hope you get the point :)
</I>&gt;<i> 
</I>&gt;<i> As for your problem with the way WebGoat explains DOM based XSS.
</I>&gt;<i> It's true that the explanation is kind of weird but you'll find 
</I>&gt;<i> that the 
</I>&gt;<i> function used in order to display the name is actually executed 
</I>&gt;<i> only by 
</I>&gt;<i> client.
</I>&gt;<i> Which makes it a DOM based XSS...
</I>&gt;<i> 
</I>&gt;<i> function displayGreeting(name) {
</I>&gt;<i> 
</I>&gt;<i> 	if (name != ''){
</I>&gt;<i> 
</I>&gt;<i>        	document.getElementById(&quot;greeting&quot;).innerHTML=&quot;Hello, &quot; + 
</I>&gt;<i> escapeHTML(name)+ &quot;!&quot;;
</I>&gt;<i> 
</I>&gt;<i> 	}
</I>&gt;<i> 
</I>&gt;<i> }
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> If you want a nice explanation on DOM based XSS
</I>&gt;<i> Here is Amit Klein's paper: 
</I>&gt;<i> <A HREF="http://www.webappsec.org/projects/articles/071105.shtml">http://www.webappsec.org/projects/articles/071105.shtml</A>
</I>&gt;<i> And I can also highly recommend the book &quot;Cross Site Scripting 
</I>&gt;<i> Attacks 
</I>&gt;<i> and Defense&quot; or something like that (Syngress)
</I>&gt;<i> 
</I>&gt;<i> Hope I could help
</I>&gt;<i> 
</I>&gt;<i> Benjamin
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">gregory at is.naist.jp</A> wrote:
</I>&gt;<i> &gt; Hi Stephan,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I actually I read the paper of Ryan Barnett published at BH-DC09 
</I>&gt;<i> on your work. It was
</I>&gt;<i> &gt; very inspiring for me as I am researching on the subject. 
</I>&gt;<i> Actually, I understand the fact
</I>&gt;<i> &gt; that it is difficult to provide a realistic environment and that 
</I>&gt;<i> is why I try as much as possible
</I>&gt;<i> &gt; creating attack websites with links that a victim would click in 
</I>&gt;<i> order to carry out  attacks on
</I>&gt;<i> &gt; WebGoat. 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; However, my point here is that the incriminated lesson (AJAX 
</I>&gt;<i> security/Lab: DOM-based Cross-site
</I>&gt;<i> &gt; scripting) might be difficult to understand. The whole idea of 
</I>&gt;<i> DOM-based XSS is summarized
</I>&gt;<i> &gt; as an user inputting malicious payload to own herself. That is 
</I>&gt;<i> why one can get confused.
</I>&gt;<i> &gt; And it confuses me because it suggests that DOM-based is 
</I>&gt;<i> ultimately stealthy as it never
</I>&gt;<i> &gt; reaches the server. Is it true? I have never encountered such 
</I>&gt;<i> flavor though you can
</I>&gt;<i> &gt; find some circumvention techniques that would truncate some of 
</I>&gt;<i> the payload (usually the most
</I>&gt;<i> &gt; characteristic part) using characters such as #. 
</I>&gt;<i> &gt; (see <A HREF="http://www.thespanner.co.uk/2008/12/01/location-based-xss-">http://www.thespanner.co.uk/2008/12/01/location-based-xss-</A>
</I>&gt;<i> attacks/ )
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; IMHO, if there were outside such stealthy DOM-based XSS attacks, 
</I>&gt;<i> there will be no way to mitigate
</I>&gt;<i> &gt; these on the server side or using a WAF. Maybe someone can 
</I>&gt;<i> enlighten me with some knowledge
</I>&gt;<i> &gt; I definitely do not have at the moment and that may have gone 
</I>&gt;<i> undetected to my research so far.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry also for the length of my emails, it made these really 
</I>&gt;<i> difficult to understand. Next time I will
</I>&gt;<i> &gt; make it shorter.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Gregory
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; ----- Original Message -----
</I>&gt;<i> &gt; From: Stephen Craig Evans &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">stephencraig.evans at gmail.com</A>&gt;
</I>&gt;<i> &gt; Date: Wednesday, April 15, 2009 6:56 pm
</I>&gt;<i> &gt; Subject: Re: [Owasp-webgoat] stealthy client-side DOM-based cross-
</I>&gt;<i> site	scripting&gt;
</I>&gt;<i> &gt;   
</I>&gt;<i> &gt;&gt; Hi Gregory,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; You might check the WebGoat section of my project,  Securing 
</I>&gt;<i> WebGoat&gt;&gt; using ModSecurity, at:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> <A HREF="http://www.owasp.org/index.php/OWASP_Securing_WebGoat_using_ModSecurity_Project.">http://www.owasp.org/index.php/OWASP_Securing_WebGoat_using_ModSecurity_Project.</A>&gt;&gt;
</I>&gt;<i> &gt;&gt; I give some detailed explanations that might supplement what 
</I>&gt;<i> you've 
</I>&gt;<i> &gt;&gt; seen so far.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; (The project page is at:
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> <A HREF="https://www.owasp.org/index.php/Category:OWASP_Securing_WebGoat_using_ModSecurity_Project">https://www.owasp.org/index.php/Category:OWASP_Securing_WebGoat_using_ModSecurity_Project</A>)&gt;&gt;
</I>&gt;<i> &gt;&gt; Don't worry, I am not getting paid for page hits :-)
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Off the top of my head, some of the WebGoat lessons simulate the
</I>&gt;<i> &gt;&gt; demonstration of an attack, mainly because it's necessary, and some
</I>&gt;<i> &gt;&gt; IMHO take shortcuts - which I documented. In particular, there's a
</I>&gt;<i> &gt;&gt; lesson with the solution of typing in javascript in the browser's
</I>&gt;<i> &gt;&gt; address field, which simulates a user that clicks on a malicious 
</I>&gt;<i> link&gt;&gt; in the web page.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; It's impossible for WebGoat to accommodate every browser and 
</I>&gt;<i> browser&gt;&gt; version, so there are going to be some quirks and you 
</I>&gt;<i> have to
</I>&gt;<i> &gt;&gt; experiment. One good habit is to erase the WebGoat cookies when
</I>&gt;<i> &gt;&gt; re-trying a lesson, and it's always good practice to switch back 
</I>&gt;<i> and&gt;&gt; forth between at least 2 browsers; e.g. the AJAX lessons 
</I>&gt;<i> worked best
</I>&gt;<i> &gt;&gt; for me on Windows XP using Opera rather than IE and Firefox.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Stephen
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; On Wed, Apr 15, 2009 at 4:16 PM,  &lt;<A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">gregory at is.naist.jp</A>&gt; wrote:
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; Hello,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; I am currently using the version 5.2 of OWASP WebGoat.
</I>&gt;<i> &gt;&gt;&gt; I am particularly interested in AJAX security and one major XSS 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; threat&gt; is the DOM-based one. However, I wanted to discuss the 
</I>&gt;<i> way 
</I>&gt;<i> &gt;&gt; the scenario
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; is presented in the lesson AJAX Security/LAB: DOM-based cross-
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; site scripting&quot;
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; First, because I do not understand the point of this lesson in 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; the way
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; it is explained. It remains unclear how such an attack could 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; occur given the
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; initial parsing of the webserver (removes every &lt;,&gt;,&quot; 
</I>&gt;<i> characters 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; and some others).
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; Usually, DOM-based XSS is particularly prone to be triggered by 
</I>&gt;<i> a 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; fished victim.
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; In this lesson, however, it seems that one should input already 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; the JavaScript code
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; within the browser.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Second, because of that unclear scenario, a beginner may not be 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; able to grab the idea
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; of DOM-based XSS.
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Maybe, I am wrong somewhere but I was unable to provide the 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; JavaScript payload without
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; specific characters (such as &lt;,&gt;) and was not able to inject it 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; on the browser, preventing
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; the server side from seeing it, on top of that without the 
</I>&gt;<i> victim 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; doing a thing.
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; I tried submitting a link which would get parsed by the server 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; removing specific characters.
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; I tried embedding it in an iframe and consequently inject it 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; using JavaScript which does
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; not work since my crafted webpage was not allowed to grab the 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; iframe contents.
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; I may miss some skills. Can anyone show me a way to conduct 
</I>&gt;<i> such 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; an attack on the WebGoat
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; server in order to illustrate the DOM-based XSS attack since 
</I>&gt;<i> even 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; the yehg.net solution video
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; is merely copy/pasting the payload in the input field (sounds a 
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt; high level of social engineering
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt;&gt;&gt; for subverting the user into inputting such an obvious 
</I>&gt;<i> payload...).&gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Regards,
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt; Gregory BLANC.
</I>&gt;<i> &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt;&gt;&gt; Owasp-webgoat mailing list
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">Owasp-webgoat at lists.owasp.org</A>
</I>&gt;<i> &gt;&gt;&gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">https://lists.owasp.org/mailman/listinfo/owasp-webgoat</A>
</I>&gt;<i> &gt;&gt;&gt;
</I>&gt;<i> &gt;&gt;&gt;       
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; -- 
</I>&gt;<i> &gt;&gt; <A HREF="http://www.linkedin.com/in/stephencraigevans">http://www.linkedin.com/in/stephencraigevans</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;     
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Owasp-webgoat mailing list
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">Owasp-webgoat at lists.owasp.org</A>
</I>&gt;<i> &gt; <A HREF="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">https://lists.owasp.org/mailman/listinfo/owasp-webgoat</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   
</I>&gt;<i> 
</I>&gt;<i> 
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000576.html">[Owasp-webgoat] stealthy client-side	DOM-based	cross-site	scripting
</A></li>
	<LI>Next message: <A HREF="000578.html">[Owasp-webgoat] stealthy	client-sideDOM-based	cross-site	scripting
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#577">[ date ]</a>
              <a href="thread.html#577">[ thread ]</a>
              <a href="subject.html#577">[ subject ]</a>
              <a href="author.html#577">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.owasp.org/mailman/listinfo/owasp-webgoat">More information about the Owasp-webgoat
mailing list</a><br>
</body></html>
